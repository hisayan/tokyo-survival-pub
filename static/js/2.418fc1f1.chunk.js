/*! For license information please see 2.418fc1f1.chunk.js.LICENSE.txt */
(this["webpackJsonptokyo-survival"]=this["webpackJsonptokyo-survival"]||[]).push([[2],[function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return m})),n.d(t,"b",(function(){return E})),n.d(t,"c",(function(){return N})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return l})),n.d(t,"f",(function(){return c})),n.d(t,"g",(function(){return h})),n.d(t,"h",(function(){return P})),n.d(t,"i",(function(){return z})),n.d(t,"j",(function(){return d})),n.d(t,"k",(function(){return p})),n.d(t,"l",(function(){return j})),n.d(t,"m",(function(){return I})),n.d(t,"n",(function(){return _})),n.d(t,"o",(function(){return L})),n.d(t,"p",(function(){return y})),n.d(t,"q",(function(){return g})),n.d(t,"r",(function(){return x})),n.d(t,"s",(function(){return b})),n.d(t,"t",(function(){return A})),n.d(t,"u",(function(){return k})),n.d(t,"v",(function(){return O})),n.d(t,"w",(function(){return D})),n.d(t,"x",(function(){return R})),n.d(t,"y",(function(){return W})),n.d(t,"z",(function(){return G})),n.d(t,"A",(function(){return M})),n.d(t,"B",(function(){return U})),n.d(t,"C",(function(){return V})),n.d(t,"D",(function(){return H}));var r=n(6),i=!1,a=!1,o="${JSCORE_VERSION}",s=function(e,t){if(!e)throw l(t)},l=function(e){return new Error("Firebase Database ("+o+") INTERNAL ASSERT FAILED: "+e)},u=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):55296===(64512&i)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++r)),t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},c={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<e.length;i+=3){var a=e[i],o=i+1<e.length,s=o?e[i+1]:0,l=i+2<e.length,u=l?e[i+2]:0,c=a>>2,h=(3&a)<<4|s>>4,f=(15&s)<<2|u>>6,d=63&u;l||(d=64,o||(f=64)),r.push(n[c],n[h],n[f],n[d])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(u(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var i=e[n++];if(i<128)t[r++]=String.fromCharCode(i);else if(i>191&&i<224){var a=e[n++];t[r++]=String.fromCharCode((31&i)<<6|63&a)}else if(i>239&&i<365){var o=((7&i)<<18|(63&(a=e[n++]))<<12|(63&(s=e[n++]))<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(o>>10)),t[r++]=String.fromCharCode(56320+(1023&o))}else{a=e[n++];var s=e[n++];t[r++]=String.fromCharCode((15&i)<<12|(63&a)<<6|63&s)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<e.length;){var a=n[e.charAt(i++)],o=i<e.length?n[e.charAt(i)]:0,s=++i<e.length?n[e.charAt(i)]:64,l=++i<e.length?n[e.charAt(i)]:64;if(++i,null==a||null==o||null==s||null==l)throw Error();var u=a<<2|o>>4;if(r.push(u),64!==s){var c=o<<4&240|s>>2;if(r.push(c),64!==l){var h=s<<6&192|l;r.push(h)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},h=function(e){var t=u(e);return c.encodeByteArray(t,!0)},f=function(e){try{return c.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function d(e){return p(void 0,e)}function p(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=p(e[n],t[n]));return e}var m=function(){function e(){var e=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(t,n){e.resolve=t,e.reject=n}))}return e.prototype.wrapCallback=function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"===typeof e&&(t.promise.catch((function(){})),1===e.length?e(n):e(n,r))}},e}();function v(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function y(){return"undefined"!==typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(v())}function g(){try{return"[object process]"===Object.prototype.toString.call(e.process)}catch(t){return!1}}function _(){return"object"===typeof self&&self.self===self}function b(){return"object"===typeof navigator&&"ReactNative"===navigator.product}function x(){return!0===i||!0===a}var w=function(e){function t(n,r,i){var a=e.call(this,r)||this;return a.code=n,a.customData=i,a.name="FirebaseError",Object.setPrototypeOf(a,t.prototype),Error.captureStackTrace&&Error.captureStackTrace(a,E.prototype.create),a}return Object(r.c)(t,e),t}(Error),E=function(){function e(e,t,n){this.service=e,this.serviceName=t,this.errors=n}return e.prototype.create=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=t[0]||{},i=this.service+"/"+e,a=this.errors[e],o=a?S(a,r):"Error",s=this.serviceName+": "+o+" ("+i+").",l=new w(i,s,r);return l},e}();function S(e,t){return e.replace(T,(function(e,n){var r=t[n];return null!=r?String(r):"<"+n+"?>"}))}var T=/\{\$([^}]+)}/g;function k(e){return JSON.parse(e)}function M(e){return JSON.stringify(e)}var C=function(e){var t={},n={},r={},i="";try{var a=e.split(".");t=k(f(a[0])||""),n=k(f(a[1])||""),i=a[2],r=n.d||{},delete n.d}catch(o){}return{header:t,claims:n,data:r,signature:i}},A=function(e){var t=C(e).claims;return!!t&&"object"===typeof t&&t.hasOwnProperty("iat")},I=function(e){var t=C(e).claims;return"object"===typeof t&&!0===t.admin};function P(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function R(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function L(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function O(e,t,n){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(r[i]=t.call(n,e[i],i,e));return r}function D(e){for(var t=[],n=function(e,n){Array.isArray(n)?n.forEach((function(n){t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))})):t.push(encodeURIComponent(e)+"="+encodeURIComponent(n))},r=0,i=Object.entries(e);r<i.length;r++){var a=i[r];n(a[0],a[1])}return t.length?"&"+t.join("&"):""}var N=function(){function e(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}return e.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},e.prototype.compress_=function(e,t){t||(t=0);var n=this.W_;if("string"===typeof e)for(var r=0;r<16;r++)n[r]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(r=0;r<16;r++)n[r]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(r=16;r<80;r++){var i=n[r-3]^n[r-8]^n[r-14]^n[r-16];n[r]=4294967295&(i<<1|i>>>31)}var a,o,s=this.chain_[0],l=this.chain_[1],u=this.chain_[2],c=this.chain_[3],h=this.chain_[4];for(r=0;r<80;r++){r<40?r<20?(a=c^l&(u^c),o=1518500249):(a=l^u^c,o=1859775393):r<60?(a=l&u|c&(l|u),o=2400959708):(a=l^u^c,o=3395469782);i=(s<<5|s>>>27)+a+h+o+n[r]&4294967295;h=c,c=u,u=4294967295&(l<<30|l>>>2),l=s,s=i}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+l&4294967295,this.chain_[2]=this.chain_[2]+u&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+h&4294967295},e.prototype.update=function(e,t){if(null!=e){void 0===t&&(t=e.length);for(var n=t-this.blockSize,r=0,i=this.buf_,a=this.inbuf_;r<t;){if(0===a)for(;r<=n;)this.compress_(e,r),r+=this.blockSize;if("string"===typeof e){for(;r<t;)if(i[a]=e.charCodeAt(r),++r,++a===this.blockSize){this.compress_(i),a=0;break}}else for(;r<t;)if(i[a]=e[r],++r,++a===this.blockSize){this.compress_(i),a=0;break}}this.inbuf_=a,this.total_+=t}},e.prototype.digest=function(){var e=[],t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&t,t/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)e[r]=this.chain_[n]>>i&255,++r;return e},e}();function z(e,t){var n=new F(e,t);return n.subscribe.bind(n)}var F=function(){function e(e,t){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((function(){e(n)})).catch((function(e){n.error(e)}))}return e.prototype.next=function(e){this.forEachObserver((function(t){t.next(e)}))},e.prototype.error=function(e){this.forEachObserver((function(t){t.error(e)})),this.close(e)},e.prototype.complete=function(){this.forEachObserver((function(e){e.complete()})),this.close()},e.prototype.subscribe=function(e,t,n){var r,i=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"!==typeof e||null===e)return!1;for(var n=0,r=t;n<r.length;n++){var i=r[n];if(i in e&&"function"===typeof e[i])return!0}return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n}).next&&(r.next=B),void 0===r.error&&(r.error=B),void 0===r.complete&&(r.complete=B);var a=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(e){}})),this.observers.push(r),a},e.prototype.unsubscribeOne=function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},e.prototype.forEachObserver=function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)},e.prototype.sendOne=function(e,t){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(r){"undefined"!==typeof console&&console.error&&console.error(r)}}))},e.prototype.close=function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((function(){t.observers=void 0,t.onNoObservers=void 0})))},e}();function B(){}var U=function(e,t,n,r){var i;if(r<t?i="at least "+t:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(e+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")};function j(e,t,n){var r="";switch(t){case 1:r=n?"first":"First";break;case 2:r=n?"second":"Second";break;case 3:r=n?"third":"Third";break;case 4:r=n?"fourth":"Fourth";break;default:throw new Error("errorPrefix called with argumentNumber > 4.  Need to update it?")}var i=e+" failed: ";return i+=r+" argument "}function V(e,t,n,r){if((!r||n)&&"function"!==typeof n)throw new Error(j(e,t,r)+"must be a valid function.")}function H(e,t,n,r){if((!r||n)&&("object"!==typeof n||null===n))throw new Error(j(e,t,r)+"must be a valid context object.")}var G=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var i=e.charCodeAt(r);if(i>=55296&&i<=56319){var a=i-55296;r++,s(r<e.length,"Surrogate pair missing trail surrogate."),i=65536+(a<<10)+(e.charCodeAt(r)-56320)}i<128?t[n++]=i:i<2048?(t[n++]=i>>6|192,t[n++]=63&i|128):i<65536?(t[n++]=i>>12|224,t[n++]=i>>6&63|128,t[n++]=63&i|128):(t[n++]=i>>18|240,t[n++]=i>>12&63|128,t[n++]=i>>6&63|128,t[n++]=63&i|128)}return t},W=function(e){for(var t=0,n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t++:r<2048?t+=2:r>=55296&&r<=56319?(t+=4,n++):t+=3}return t}}).call(this,n(49))},function(e,t,n){"use strict";e.exports=n(63)},function(e,t,n){"use strict";function r(e){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function i(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function a(e,t){return!t||"object"!==r(t)&&"function"!==typeof t?i(e):t}n.d(t,"a",(function(){return _s})),n.d(t,"b",(function(){return Ql})),n.d(t,"c",(function(){return Ba})),n.d(t,"d",(function(){return Ce})),n.d(t,"e",(function(){return $t})),n.d(t,"f",(function(){return xn})),n.d(t,"g",(function(){return qn})),n.d(t,"h",(function(){return mo})),n.d(t,"i",(function(){return M})),n.d(t,"j",(function(){return Ol})),n.d(t,"k",(function(){return qt})),n.d(t,"l",(function(){return hl})),n.d(t,"m",(function(){return b})),n.d(t,"n",(function(){return ks})),n.d(t,"o",(function(){return _})),n.d(t,"p",(function(){return ia})),n.d(t,"q",(function(){return xl})),n.d(t,"r",(function(){return ha})),n.d(t,"s",(function(){return pa})),n.d(t,"t",(function(){return ss})),n.d(t,"u",(function(){return W})),n.d(t,"v",(function(){return q})),n.d(t,"w",(function(){return eo})),n.d(t,"x",(function(){return Za})),n.d(t,"y",(function(){return io})),n.d(t,"z",(function(){return ro})),n.d(t,"A",(function(){return R})),n.d(t,"B",(function(){return O})),n.d(t,"C",(function(){return L})),n.d(t,"D",(function(){return Ss})),n.d(t,"E",(function(){return yl})),n.d(t,"F",(function(){return Kt})),n.d(t,"G",(function(){return me})),n.d(t,"H",(function(){return $e})),n.d(t,"I",(function(){return Bn})),n.d(t,"J",(function(){return Yt})),n.d(t,"K",(function(){return Qo})),n.d(t,"L",(function(){return Jo})),n.d(t,"M",(function(){return C})),n.d(t,"N",(function(){return A})),n.d(t,"O",(function(){return P})),n.d(t,"P",(function(){return I})),n.d(t,"Q",(function(){return ps})),n.d(t,"R",(function(){return St})),n.d(t,"S",(function(){return ul})),n.d(t,"T",(function(){return Xn})),n.d(t,"U",(function(){return ll})),n.d(t,"V",(function(){return co})),n.d(t,"W",(function(){return ao})),n.d(t,"X",(function(){return Yl})),n.d(t,"Y",(function(){return vs})),n.d(t,"Z",(function(){return j})),n.d(t,"ab",(function(){return k})),n.d(t,"bb",(function(){return ca})),n.d(t,"cb",(function(){return Va})),n.d(t,"db",(function(){return Fa})),n.d(t,"eb",(function(){return Ge})),n.d(t,"fb",(function(){return ol})),n.d(t,"gb",(function(){return ae})),n.d(t,"hb",(function(){return Rs})),n.d(t,"ib",(function(){return ee})),n.d(t,"jb",(function(){return $})),n.d(t,"kb",(function(){return ve})),n.d(t,"lb",(function(){return Te})),n.d(t,"mb",(function(){return gs})),n.d(t,"nb",(function(){return la})),n.d(t,"ob",(function(){return ne}));var o=n(18),s=n.n(o),l=n(26),u=n(35);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t,n){return(f="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function d(e,t){return(d=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&d(e,t)}function m(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=h(e);if(t){var i=h(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return a(this,n)}}var v,y=n(4),g=n(5),_=0,b=2,x=100,w=301,E=302,S=306,T=307,k=1e3,M=1001,C=1002,A=1003,I=1004,P=1005,R=1006,L=1007,O=1008,D=1009,N=1012,z=1014,F=1015,B=1016,U=1020,j=1022,V=1023,H=1026,G=1027,W=2300,q=2301,X=2302,Z=2400,K=2401,Y=2402,J=2500,Q=2501,$=1,ee=2,te=3e3,ne=3001,re=3007,ie=3002,ae=0,oe=7680,se=35044,le=35048,ue="300 es";function ce(){}Object.assign(ce.prototype,{addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,i=n.length;r<i;r++)n[r].call(this,e)}}}});for(var he=[],fe=0;fe<256;fe++)he[fe]=(fe<16?"0":"")+fe.toString(16);var de,pe=1234567,me={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(he[255&e]+he[e>>8&255]+he[e>>16&255]+he[e>>24&255]+"-"+he[255&t]+he[t>>8&255]+"-"+he[t>>16&15|64]+he[t>>24&255]+"-"+he[63&n|128]+he[n>>8&255]+"-"+he[n>>16&255]+he[n>>24&255]+he[255&r]+he[r>>8&255]+he[r>>16&255]+he[r>>24&255]).toUpperCase()},clamp:function(e,t,n){return Math.max(t,Math.min(n,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},lerp:function(e,t,n){return(1-n)*e+n*t},damp:function(e,t,n,r){return me.lerp(e,t,1-Math.exp(-n*r))},pingpong:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(me.euclideanModulo(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(pe=e%2147483647),((pe=16807*pe%2147483647)-1)/2147483646},degToRad:function(e){return e*me.DEG2RAD},radToDeg:function(e){return e*me.RAD2DEG},isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,n,r,i){var a=Math.cos,o=Math.sin,s=a(n/2),l=o(n/2),u=a((t+r)/2),c=o((t+r)/2),h=a((t-r)/2),f=o((t-r)/2),d=a((r-t)/2),p=o((r-t)/2);switch(i){case"XYX":e.set(s*c,l*h,l*f,s*u);break;case"YZY":e.set(l*f,s*c,l*h,s*u);break;case"ZXZ":e.set(l*h,l*f,s*c,s*u);break;case"XZX":e.set(s*c,l*p,l*d,s*u);break;case"YXY":e.set(l*d,s*c,l*p,s*u);break;case"ZYZ":e.set(l*p,l*d,s*c,s*u);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}},ve=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Object(y.a)(this,e),Object.defineProperty(this,"isVector2",{value:!0}),this.x=t,this.y=n}return Object(g.a)(e,[{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=this.x-e.x,a=this.y-e.y;return this.x=i*n-a*r+e.x,this.y=i*r+a*n+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}}]),e}(),ye=function(){function e(){Object(y.a)(this,e),Object.defineProperty(this,"isMatrix3",{value:!0}),this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}return Object(g.a)(e,[{key:"set",value:function(e,t,n,r,i,a,o,s,l){var u=this.elements;return u[0]=e,u[1]=r,u[2]=o,u[3]=t,u[4]=i,u[5]=s,u[6]=n,u[7]=a,u[8]=l,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[3],s=n[6],l=n[1],u=n[4],c=n[7],h=n[2],f=n[5],d=n[8],p=r[0],m=r[3],v=r[6],y=r[1],g=r[4],_=r[7],b=r[2],x=r[5],w=r[8];return i[0]=a*p+o*y+s*b,i[3]=a*m+o*g+s*x,i[6]=a*v+o*_+s*w,i[1]=l*p+u*y+c*b,i[4]=l*m+u*g+c*x,i[7]=l*v+u*_+c*w,i[2]=h*p+f*y+d*b,i[5]=h*m+f*g+d*x,i[8]=h*v+f*_+d*w,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8];return t*a*u-t*o*l-n*i*u+n*o*s+r*i*l-r*a*s}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=u*a-o*l,h=o*s-u*i,f=l*i-a*s,d=t*c+n*h+r*f;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);var p=1/d;return e[0]=c*p,e[1]=(r*l-u*n)*p,e[2]=(o*n-r*a)*p,e[3]=h*p,e[4]=(u*t-r*s)*p,e[5]=(r*i-o*t)*p,e[6]=f*p,e[7]=(n*s-l*t)*p,e[8]=(a*t-n*i)*p,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).copy(this).invert().transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,r,i,a,o){var s=Math.cos(i),l=Math.sin(i);return this.set(n*s,n*l,-n*(s*a+l*o)+a+e,-r*l,r*s,-r*(-l*a+s*o)+o+t,0,0,1),this}},{key:"scale",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.elements,i=r[0],a=r[3],o=r[6],s=r[1],l=r[4],u=r[7];return r[0]=t*i+n*s,r[3]=t*a+n*l,r[6]=t*o+n*u,r[1]=-n*i+t*s,r[4]=-n*a+t*l,r[7]=-n*o+t*u,this}},{key:"translate",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}}]),e}(),ge={getDataURL:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===de&&(de=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),de.width=e.width,de.height=e.height;var n=de.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=de}return t.width>2048||t.height>2048?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},_e=0;function be(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:be.DEFAULT_IMAGE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:be.DEFAULT_MAPPING,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:M,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:M,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:R,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:O,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:V,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:D,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,u=arguments.length>9&&void 0!==arguments[9]?arguments[9]:te;Object.defineProperty(this,"id",{value:_e++}),this.uuid=me.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=n,this.wrapT=r,this.magFilter=i,this.minFilter=a,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=s,this.offset=new ve(0,0),this.repeat=new ve(1,1),this.center=new ve(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ye,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=u,this.version=0,this.onUpdate=null}function xe(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?ge.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}be.DEFAULT_IMAGE=void 0,be.DEFAULT_MAPPING=300,be.prototype=Object.assign(Object.create(ce.prototype),{constructor:be,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){var r=this.image;if(void 0===r.uuid&&(r.uuid=me.generateUUID()),!t&&void 0===e.images[r.uuid]){var i;if(Array.isArray(r)){i=[];for(var a=0,o=r.length;a<o;a++)r[a].isDataTexture?i.push(xe(r[a].image)):i.push(xe(r[a]))}else i=xe(r);e.images[r.uuid]={uuid:r.uuid,url:i}}n.image=r.uuid}return t||(e.textures[this.uuid]=n),n},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(300!==this.mapping)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case k:e.x=e.x-Math.floor(e.x);break;case M:e.x=e.x<0?0:1;break;case C:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case k:e.y=e.y-Math.floor(e.y);break;case M:e.y=e.y<0?0:1;break;case C:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(be.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}});var we=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(y.a)(this,e),Object.defineProperty(this,"isVector4",{value:!0}),this.x=t,this.y=n,this.z=r,this.w=i}return Object(g.a)(e,[{key:"set",value:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setW",value:function(e){return this.w=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r+a[12]*i,this.y=a[1]*t+a[5]*n+a[9]*r+a[13]*i,this.z=a[2]*t+a[6]*n+a[10]*r+a[14]*i,this.w=a[3]*t+a[7]*n+a[11]*r+a[15]*i,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,n,r,i,a=.01,o=.1,s=e.elements,l=s[0],u=s[4],c=s[8],h=s[1],f=s[5],d=s[9],p=s[2],m=s[6],v=s[10];if(Math.abs(u-h)<a&&Math.abs(c-p)<a&&Math.abs(d-m)<a){if(Math.abs(u+h)<o&&Math.abs(c+p)<o&&Math.abs(d+m)<o&&Math.abs(l+f+v-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var y=(l+1)/2,g=(f+1)/2,_=(v+1)/2,b=(u+h)/4,x=(c+p)/4,w=(d+m)/4;return y>g&&y>_?y<a?(n=0,r=.707106781,i=.707106781):(r=b/(n=Math.sqrt(y)),i=x/n):g>_?g<a?(n=.707106781,r=0,i=.707106781):(n=b/(r=Math.sqrt(g)),i=w/r):_<a?(n=.707106781,r=.707106781,i=0):(n=x/(i=Math.sqrt(_)),r=w/i),this.set(n,r,i,t),this}var E=Math.sqrt((m-d)*(m-d)+(c-p)*(c-p)+(h-u)*(h-u));return Math.abs(E)<.001&&(E=1),this.x=(m-d)/E,this.y=(c-p)/E,this.z=(h-u)/E,this.w=Math.acos((l+f+v-1)/2),this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}},{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}}]),e}(),Ee=function(e){p(n,e);var t=m(n);function n(e,r,a){var o;return Object(y.a)(this,n),o=t.call(this),Object.defineProperty(i(o),"isWebGLRenderTarget",{value:!0}),o.width=e,o.height=r,o.scissor=new we(0,0,e,r),o.scissorTest=!1,o.viewport=new we(0,0,e,r),a=a||{},o.texture=new be(void 0,a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.encoding),o.texture.image={},o.texture.image.width=e,o.texture.image.height=r,o.texture.generateMipmaps=void 0!==a.generateMipmaps&&a.generateMipmaps,o.texture.minFilter=void 0!==a.minFilter?a.minFilter:R,o.depthBuffer=void 0===a.depthBuffer||a.depthBuffer,o.stencilBuffer=void 0!==a.stencilBuffer&&a.stencilBuffer,o.depthTexture=void 0!==a.depthTexture?a.depthTexture:null,o}return Object(g.a)(n,[{key:"setSize",value:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(ce),Se=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(y.a)(this,e),Object.defineProperty(this,"isQuaternion",{value:!0}),this._x=t,this._y=n,this._z=r,this._w=i}return Object(g.a)(e,[{key:"set",value:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,i=e._z,a=e._order,o=Math.cos,s=Math.sin,l=o(n/2),u=o(r/2),c=o(i/2),h=s(n/2),f=s(r/2),d=s(i/2);switch(a){case"XYZ":this._x=h*u*c+l*f*d,this._y=l*f*c-h*u*d,this._z=l*u*d+h*f*c,this._w=l*u*c-h*f*d;break;case"YXZ":this._x=h*u*c+l*f*d,this._y=l*f*c-h*u*d,this._z=l*u*d-h*f*c,this._w=l*u*c+h*f*d;break;case"ZXY":this._x=h*u*c-l*f*d,this._y=l*f*c+h*u*d,this._z=l*u*d+h*f*c,this._w=l*u*c-h*f*d;break;case"ZYX":this._x=h*u*c-l*f*d,this._y=l*f*c+h*u*d,this._z=l*u*d-h*f*c,this._w=l*u*c+h*f*d;break;case"YZX":this._x=h*u*c+l*f*d,this._y=l*f*c+h*u*d,this._z=l*u*d-h*f*c,this._w=l*u*c-h*f*d;break;case"XZY":this._x=h*u*c-l*f*d,this._y=l*f*c-h*u*d,this._z=l*u*d+h*f*c,this._w=l*u*c+h*f*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return!1!==t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],r=t[4],i=t[8],a=t[1],o=t[5],s=t[9],l=t[2],u=t[6],c=t[10],h=n+o+c;if(h>0){var f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(u-s)*f,this._y=(i-l)*f,this._z=(a-r)*f}else if(n>o&&n>c){var d=2*Math.sqrt(1+n-o-c);this._w=(u-s)/d,this._x=.25*d,this._y=(r+a)/d,this._z=(i+l)/d}else if(o>c){var p=2*Math.sqrt(1+o-n-c);this._w=(i-l)/p,this._x=(r+a)/p,this._y=.25*p,this._z=(s+u)/p}else{var m=2*Math.sqrt(1+c-n-o);this._w=(a-r)/m,this._x=(i+l)/m,this._y=(s+u)/m,this._z=.25*m}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return n<1e-6?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(me.clamp(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);if(0===n)return this;var r=Math.min(1,t/n);return this.slerp(e,r),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,r=e._y,i=e._z,a=e._w,o=t._x,s=t._y,l=t._z,u=t._w;return this._x=n*u+a*o+r*l-i*s,this._y=r*u+a*s+i*o-n*l,this._z=i*u+a*l+n*s-r*o,this._w=a*u-n*o-r*s-i*l,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,i=this._z,a=this._w,o=a*e._w+n*e._x+r*e._y+i*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=a,this._x=n,this._y=r,this._z=i,this;var s=1-o*o;if(s<=Number.EPSILON){var l=1-t;return this._w=l*a+t*this._w,this._x=l*n+t*this._x,this._y=l*r+t*this._y,this._z=l*i+t*this._z,this.normalize(),this._onChangeCallback(),this}var u=Math.sqrt(s),c=Math.atan2(u,o),h=Math.sin((1-t)*c)/u,f=Math.sin(t*c)/u;return this._w=a*h+this._w*f,this._x=n*h+this._x*f,this._y=r*h+this._y*f,this._z=i*h+this._z*f,this._onChangeCallback(),this}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}],[{key:"slerp",value:function(e,t,n,r){return n.copy(e).slerp(t,r)}},{key:"slerpFlat",value:function(e,t,n,r,i,a,o){var s=n[r+0],l=n[r+1],u=n[r+2],c=n[r+3],h=i[a+0],f=i[a+1],d=i[a+2],p=i[a+3];if(c!==p||s!==h||l!==f||u!==d){var m=1-o,v=s*h+l*f+u*d+c*p,y=v>=0?1:-1,g=1-v*v;if(g>Number.EPSILON){var _=Math.sqrt(g),b=Math.atan2(_,v*y);m=Math.sin(m*b)/_,o=Math.sin(o*b)/_}var x=o*y;if(s=s*m+h*x,l=l*m+f*x,u=u*m+d*x,c=c*m+p*x,m===1-o){var w=1/Math.sqrt(s*s+l*l+u*u+c*c);s*=w,l*=w,u*=w,c*=w}}e[t]=s,e[t+1]=l,e[t+2]=u,e[t+3]=c}},{key:"multiplyQuaternionsFlat",value:function(e,t,n,r,i,a){var o=n[r],s=n[r+1],l=n[r+2],u=n[r+3],c=i[a],h=i[a+1],f=i[a+2],d=i[a+3];return e[t]=o*d+u*c+s*f-l*h,e[t+1]=s*d+u*h+l*c-o*f,e[t+2]=l*d+u*f+o*h-s*c,e[t+3]=u*d-o*c-s*h-l*f,e}}]),e}(),Te=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(y.a)(this,e),Object.defineProperty(this,"isVector3",{value:!0}),this.x=t,this.y=n,this.z=r}return Object(g.a)(e,[{key:"set",value:function(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Me.setFromEuler(e))}},{key:"applyAxisAngle",value:function(e,t){return this.applyQuaternion(Me.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6]*r,this.y=i[1]*t+i[4]*n+i[7]*r,this.z=i[2]*t+i[5]*n+i[8]*r,this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements,a=1/(i[3]*t+i[7]*n+i[11]*r+i[15]);return this.x=(i[0]*t+i[4]*n+i[8]*r+i[12])*a,this.y=(i[1]*t+i[5]*n+i[9]*r+i[13])*a,this.z=(i[2]*t+i[6]*n+i[10]*r+i[14])*a,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,a=e.y,o=e.z,s=e.w,l=s*t+a*r-o*n,u=s*n+o*t-i*r,c=s*r+i*n-a*t,h=-i*t-a*n-o*r;return this.x=l*s+h*-i+u*-o-c*-a,this.y=u*s+h*-a+c*-i-l*-o,this.z=c*s+h*-o+l*-a-u*-i,this}},{key:"project",value:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,r=this.z,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r,this.y=i[1]*t+i[5]*n+i[9]*r,this.z=i[2]*t+i[6]*n+i[10]*r,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}},{key:"cross",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=t.x,o=t.y,s=t.z;return this.x=r*s-i*o,this.y=i*a-n*s,this.z=n*o-r*a,this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}},{key:"projectOnPlane",value:function(e){return ke.copy(this).projectOnVector(e),this.sub(ke)}},{key:"reflect",value:function(e){return this.sub(ke.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(me.clamp(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}},{key:"setFromCylindrical",value:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}}]),e}(),ke=new Te,Me=new Se,Ce=function(){function e(t,n){Object(y.a)(this,e),Object.defineProperty(this,"isBox3",{value:!0}),this.min=void 0!==t?t:new Te(1/0,1/0,1/0),this.max=void 0!==n?n:new Te(-1/0,-1/0,-1/0)}return Object(g.a)(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.length;s<l;s+=3){var u=e[s],c=e[s+1],h=e[s+2];u<t&&(t=u),c<n&&(n=c),h<r&&(r=h),u>i&&(i=u),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,n=1/0,r=1/0,i=-1/0,a=-1/0,o=-1/0,s=0,l=e.count;s<l;s++){var u=e.getX(s),c=e.getY(s),h=e.getZ(s);u<t&&(t=u),c<n&&(n=c),h<r&&(r=h),u>i&&(i=u),c>a&&(a=c),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(i,a,o),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=Pe.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){return this.makeEmpty(),this.expandByObject(e)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){return void 0===e&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Te),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return void 0===e&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Te),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),Re.copy(t.boundingBox),Re.applyMatrix4(e.matrixWorld),this.union(Re));for(var n=e.children,r=0,i=n.length;r<i;r++)this.expandByObject(n[r]);return this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Te),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,Pe),Pe.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"intersectsTriangle",value:function(e){if(this.isEmpty())return!1;this.getCenter(Be),Ue.subVectors(this.max,Be),Le.subVectors(e.a,Be),Oe.subVectors(e.b,Be),De.subVectors(e.c,Be),Ne.subVectors(Oe,Le),ze.subVectors(De,Oe),Fe.subVectors(Le,De);var t=[0,-Ne.z,Ne.y,0,-ze.z,ze.y,0,-Fe.z,Fe.y,Ne.z,0,-Ne.x,ze.z,0,-ze.x,Fe.z,0,-Fe.x,-Ne.y,Ne.x,0,-ze.y,ze.x,0,-Fe.y,Fe.x,0];return!!Ae(t,Le,Oe,De,Ue)&&(!!Ae(t=[1,0,0,0,1,0,0,0,1],Le,Oe,De,Ue)&&(je.crossVectors(Ne,ze),Ae(t=[je.x,je.y,je.z],Le,Oe,De,Ue)))}},{key:"clampPoint",value:function(e,t){return void 0===t&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Te),t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return Pe.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"getBoundingSphere",value:function(e){return void 0===e&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(Pe).length(),e}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){return this.isEmpty()||(Ie[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ie[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ie[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ie[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ie[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ie[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ie[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ie[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ie)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}();function Ae(e,t,n,r,i){for(var a=0,o=e.length-3;a<=o;a+=3){Ve.fromArray(e,a);var s=i.x*Math.abs(Ve.x)+i.y*Math.abs(Ve.y)+i.z*Math.abs(Ve.z),l=t.dot(Ve),u=n.dot(Ve),c=r.dot(Ve);if(Math.max(-Math.max(l,u,c),Math.min(l,u,c))>s)return!1}return!0}var Ie=[new Te,new Te,new Te,new Te,new Te,new Te,new Te,new Te],Pe=new Te,Re=new Ce,Le=new Te,Oe=new Te,De=new Te,Ne=new Te,ze=new Te,Fe=new Te,Be=new Te,Ue=new Te,je=new Te,Ve=new Te,He=new Ce,Ge=function(){function e(t,n){Object(y.a)(this,e),this.center=void 0!==t?t:new Te,this.radius=void 0!==n?n:-1}return Object(g.a)(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"setFromPoints",value:function(e,t){var n=this.center;void 0!==t?n.copy(t):He.setFromPoints(e).getCenter(n);for(var r=0,i=0,a=e.length;i<a;i++)r=Math.max(r,n.distanceToSquared(e[i]));return this.radius=Math.sqrt(r),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(e,t){var n=this.center.distanceToSquared(e);return void 0===t&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Te),t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"getBoundingBox",value:function(e){return void 0===e&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Ce),this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}},{key:"applyMatrix4",value:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}}]),e}(),We=new Te,qe=new Te,Xe=new Te,Ze=new Te,Ke=new Te,Ye=new Te,Je=new Te,Qe=function(){function e(t,n){Object(y.a)(this,e),this.origin=void 0!==t?t:new Te,this.direction=void 0!==n?n:new Te(0,0,-1)}return Object(g.a)(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"at",value:function(e,t){return void 0===t&&(console.warn("THREE.Ray: .at() target is now required"),t=new Te),t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,We)),this}},{key:"closestPointToPoint",value:function(e,t){void 0===t&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Te),t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}},{key:"distanceToPoint",value:function(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function(e){var t=We.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(We.copy(this.direction).multiplyScalar(t).add(this.origin),We.distanceToSquared(e))}},{key:"distanceSqToSegment",value:function(e,t,n,r){qe.copy(e).add(t).multiplyScalar(.5),Xe.copy(t).sub(e).normalize(),Ze.copy(this.origin).sub(qe);var i,a,o,s,l=.5*e.distanceTo(t),u=-this.direction.dot(Xe),c=Ze.dot(this.direction),h=-Ze.dot(Xe),f=Ze.lengthSq(),d=Math.abs(1-u*u);if(d>0)if(a=u*c-h,s=l*d,(i=u*h-c)>=0)if(a>=-s)if(a<=s){var p=1/d;o=(i*=p)*(i+u*(a*=p)+2*c)+a*(u*i+a+2*h)+f}else a=l,o=-(i=Math.max(0,-(u*a+c)))*i+a*(a+2*h)+f;else a=-l,o=-(i=Math.max(0,-(u*a+c)))*i+a*(a+2*h)+f;else a<=-s?o=-(i=Math.max(0,-(-u*l+c)))*i+(a=i>0?-l:Math.min(Math.max(-l,-h),l))*(a+2*h)+f:a<=s?(i=0,o=(a=Math.min(Math.max(-l,-h),l))*(a+2*h)+f):o=-(i=Math.max(0,-(u*l+c)))*i+(a=i>0?l:Math.min(Math.max(-l,-h),l))*(a+2*h)+f;else a=u>0?-l:l,o=-(i=Math.max(0,-(u*a+c)))*i+a*(a+2*h)+f;return n&&n.copy(this.direction).multiplyScalar(i).add(this.origin),r&&r.copy(Xe).multiplyScalar(a).add(qe),o}},{key:"intersectSphere",value:function(e,t){We.subVectors(e.center,this.origin);var n=We.dot(this.direction),r=We.dot(We)-n*n,i=e.radius*e.radius;if(r>i)return null;var a=Math.sqrt(i-r),o=n-a,s=n+a;return o<0&&s<0?null:o<0?this.at(s,t):this.at(o,t)}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}},{key:"intersectPlane",value:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}},{key:"intersectBox",value:function(e,t){var n,r,i,a,o,s,l=1/this.direction.x,u=1/this.direction.y,c=1/this.direction.z,h=this.origin;return l>=0?(n=(e.min.x-h.x)*l,r=(e.max.x-h.x)*l):(n=(e.max.x-h.x)*l,r=(e.min.x-h.x)*l),u>=0?(i=(e.min.y-h.y)*u,a=(e.max.y-h.y)*u):(i=(e.max.y-h.y)*u,a=(e.min.y-h.y)*u),n>a||i>r?null:((i>n||n!==n)&&(n=i),(a<r||r!==r)&&(r=a),c>=0?(o=(e.min.z-h.z)*c,s=(e.max.z-h.z)*c):(o=(e.max.z-h.z)*c,s=(e.min.z-h.z)*c),n>s||o>r?null:((o>n||n!==n)&&(n=o),(s<r||r!==r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,We)}},{key:"intersectTriangle",value:function(e,t,n,r,i){Ke.subVectors(t,e),Ye.subVectors(n,e),Je.crossVectors(Ke,Ye);var a,o=this.direction.dot(Je);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}Ze.subVectors(this.origin,e);var s=a*this.direction.dot(Ye.crossVectors(Ze,Ye));if(s<0)return null;var l=a*this.direction.dot(Ke.cross(Ze));if(l<0)return null;if(s+l>o)return null;var u=-a*Ze.dot(Je);return u<0?null:this.at(u/o,i)}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}}]),e}(),$e=function(){function e(){Object(y.a)(this,e),Object.defineProperty(this,"isMatrix4",{value:!0}),this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}return Object(g.a)(e,[{key:"set",value:function(e,t,n,r,i,a,o,s,l,u,c,h,f,d,p,m){var v=this.elements;return v[0]=e,v[4]=t,v[8]=n,v[12]=r,v[1]=i,v[5]=a,v[9]=o,v[13]=s,v[2]=l,v[6]=u,v[10]=c,v[14]=h,v[3]=f,v[7]=d,v[11]=p,v[15]=m,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setFromMatrix3",value:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,r=1/et.setFromMatrixColumn(e,0).length(),i=1/et.setFromMatrixColumn(e,1).length(),a=1/et.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*i,t[5]=n[5]*i,t[6]=n[6]*i,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,r=e.y,i=e.z,a=Math.cos(n),o=Math.sin(n),s=Math.cos(r),l=Math.sin(r),u=Math.cos(i),c=Math.sin(i);if("XYZ"===e.order){var h=a*u,f=a*c,d=o*u,p=o*c;t[0]=s*u,t[4]=-s*c,t[8]=l,t[1]=f+d*l,t[5]=h-p*l,t[9]=-o*s,t[2]=p-h*l,t[6]=d+f*l,t[10]=a*s}else if("YXZ"===e.order){var m=s*u,v=s*c,y=l*u,g=l*c;t[0]=m+g*o,t[4]=y*o-v,t[8]=a*l,t[1]=a*c,t[5]=a*u,t[9]=-o,t[2]=v*o-y,t[6]=g+m*o,t[10]=a*s}else if("ZXY"===e.order){var _=s*u,b=s*c,x=l*u,w=l*c;t[0]=_-w*o,t[4]=-a*c,t[8]=x+b*o,t[1]=b+x*o,t[5]=a*u,t[9]=w-_*o,t[2]=-a*l,t[6]=o,t[10]=a*s}else if("ZYX"===e.order){var E=a*u,S=a*c,T=o*u,k=o*c;t[0]=s*u,t[4]=T*l-S,t[8]=E*l+k,t[1]=s*c,t[5]=k*l+E,t[9]=S*l-T,t[2]=-l,t[6]=o*s,t[10]=a*s}else if("YZX"===e.order){var M=a*s,C=a*l,A=o*s,I=o*l;t[0]=s*u,t[4]=I-M*c,t[8]=A*c+C,t[1]=c,t[5]=a*u,t[9]=-o*u,t[2]=-l*u,t[6]=C*c+A,t[10]=M-I*c}else if("XZY"===e.order){var P=a*s,R=a*l,L=o*s,O=o*l;t[0]=s*u,t[4]=-c,t[8]=l*u,t[1]=P*c+O,t[5]=a*u,t[9]=R*c-L,t[2]=L*c-R,t[6]=o*u,t[10]=O*c+P}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(nt,e,rt)}},{key:"lookAt",value:function(e,t,n){var r=this.elements;return ot.subVectors(e,t),0===ot.lengthSq()&&(ot.z=1),ot.normalize(),it.crossVectors(n,ot),0===it.lengthSq()&&(1===Math.abs(n.z)?ot.x+=1e-4:ot.z+=1e-4,ot.normalize(),it.crossVectors(n,ot)),it.normalize(),at.crossVectors(ot,it),r[0]=it.x,r[4]=at.x,r[8]=ot.x,r[1]=it.y,r[5]=at.y,r[9]=ot.y,r[2]=it.z,r[6]=at.z,r[10]=ot.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,i=this.elements,a=n[0],o=n[4],s=n[8],l=n[12],u=n[1],c=n[5],h=n[9],f=n[13],d=n[2],p=n[6],m=n[10],v=n[14],y=n[3],g=n[7],_=n[11],b=n[15],x=r[0],w=r[4],E=r[8],S=r[12],T=r[1],k=r[5],M=r[9],C=r[13],A=r[2],I=r[6],P=r[10],R=r[14],L=r[3],O=r[7],D=r[11],N=r[15];return i[0]=a*x+o*T+s*A+l*L,i[4]=a*w+o*k+s*I+l*O,i[8]=a*E+o*M+s*P+l*D,i[12]=a*S+o*C+s*R+l*N,i[1]=u*x+c*T+h*A+f*L,i[5]=u*w+c*k+h*I+f*O,i[9]=u*E+c*M+h*P+f*D,i[13]=u*S+c*C+h*R+f*N,i[2]=d*x+p*T+m*A+v*L,i[6]=d*w+p*k+m*I+v*O,i[10]=d*E+p*M+m*P+v*D,i[14]=d*S+p*C+m*R+v*N,i[3]=y*x+g*T+_*A+b*L,i[7]=y*w+g*k+_*I+b*O,i[11]=y*E+g*M+_*P+b*D,i[15]=y*S+g*C+_*R+b*N,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],a=e[1],o=e[5],s=e[9],l=e[13],u=e[2],c=e[6],h=e[10],f=e[14];return e[3]*(+i*s*c-r*l*c-i*o*h+n*l*h+r*o*f-n*s*f)+e[7]*(+t*s*f-t*l*h+i*a*h-r*a*f+r*l*u-i*s*u)+e[11]*(+t*l*c-t*o*f-i*a*c+n*a*f+i*o*u-n*l*u)+e[15]*(-r*o*u-t*s*c+t*o*h+r*a*c-n*a*h+n*s*u)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,n){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],a=e[4],o=e[5],s=e[6],l=e[7],u=e[8],c=e[9],h=e[10],f=e[11],d=e[12],p=e[13],m=e[14],v=e[15],y=c*m*l-p*h*l+p*s*f-o*m*f-c*s*v+o*h*v,g=d*h*l-u*m*l-d*s*f+a*m*f+u*s*v-a*h*v,_=u*p*l-d*c*l+d*o*f-a*p*f-u*o*v+a*c*v,b=d*c*s-u*p*s-d*o*h+a*p*h+u*o*m-a*c*m,x=t*y+n*g+r*_+i*b;if(0===x)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var w=1/x;return e[0]=y*w,e[1]=(p*h*i-c*m*i-p*r*f+n*m*f+c*r*v-n*h*v)*w,e[2]=(o*m*i-p*s*i+p*r*l-n*m*l-o*r*v+n*s*v)*w,e[3]=(c*s*i-o*h*i-c*r*l+n*h*l+o*r*f-n*s*f)*w,e[4]=g*w,e[5]=(u*m*i-d*h*i+d*r*f-t*m*f-u*r*v+t*h*v)*w,e[6]=(d*s*i-a*m*i-d*r*l+t*m*l+a*r*v-t*s*v)*w,e[7]=(a*h*i-u*s*i+u*r*l-t*h*l-a*r*f+t*s*f)*w,e[8]=_*w,e[9]=(d*c*i-u*p*i-d*n*f+t*p*f+u*n*v-t*c*v)*w,e[10]=(a*p*i-d*o*i+d*n*l-t*p*l-a*n*v+t*o*v)*w,e[11]=(u*o*i-a*c*i-u*n*l+t*c*l+a*n*f-t*o*f)*w,e[12]=b*w,e[13]=(u*p*r-d*c*r+d*n*h-t*p*h-u*n*m+t*c*m)*w,e[14]=(d*o*r-a*p*r-d*n*s+t*p*s+a*n*m-t*o*m)*w,e[15]=(a*c*r-u*o*r+u*n*s-t*c*s-a*n*h+t*o*h)*w,this}},{key:"scale",value:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z;return t[0]*=n,t[4]*=r,t[8]*=i,t[1]*=n,t[5]*=r,t[9]*=i,t[2]*=n,t[6]*=r,t[10]*=i,t[3]*=n,t[7]*=r,t[11]*=i,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,a=e.x,o=e.y,s=e.z,l=i*a,u=i*o;return this.set(l*a+n,l*o-r*s,l*s+r*o,0,l*o+r*s,u*o+n,u*s-r*a,0,l*s-r*o,u*s+r*a,i*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n){return this.set(1,t,n,0,e,1,n,0,e,t,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var r=this.elements,i=t._x,a=t._y,o=t._z,s=t._w,l=i+i,u=a+a,c=o+o,h=i*l,f=i*u,d=i*c,p=a*u,m=a*c,v=o*c,y=s*l,g=s*u,_=s*c,b=n.x,x=n.y,w=n.z;return r[0]=(1-(p+v))*b,r[1]=(f+_)*b,r[2]=(d-g)*b,r[3]=0,r[4]=(f-_)*x,r[5]=(1-(h+v))*x,r[6]=(m+y)*x,r[7]=0,r[8]=(d+g)*w,r[9]=(m-y)*w,r[10]=(1-(h+p))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}},{key:"decompose",value:function(e,t,n){var r=this.elements,i=et.set(r[0],r[1],r[2]).length(),a=et.set(r[4],r[5],r[6]).length(),o=et.set(r[8],r[9],r[10]).length();this.determinant()<0&&(i=-i),e.x=r[12],e.y=r[13],e.z=r[14],tt.copy(this);var s=1/i,l=1/a,u=1/o;return tt.elements[0]*=s,tt.elements[1]*=s,tt.elements[2]*=s,tt.elements[4]*=l,tt.elements[5]*=l,tt.elements[6]*=l,tt.elements[8]*=u,tt.elements[9]*=u,tt.elements[10]*=u,t.setFromRotationMatrix(tt),n.x=i,n.y=a,n.z=o,this}},{key:"makePerspective",value:function(e,t,n,r,i,a){void 0===a&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*i/(t-e),l=2*i/(n-r),u=(t+e)/(t-e),c=(n+r)/(n-r),h=-(a+i)/(a-i),f=-2*a*i/(a-i);return o[0]=s,o[4]=0,o[8]=u,o[12]=0,o[1]=0,o[5]=l,o[9]=c,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,r,i,a){var o=this.elements,s=1/(t-e),l=1/(n-r),u=1/(a-i),c=(t+e)*s,h=(n+r)*l,f=(a+i)*u;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*u,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}]),e}(),et=new Te,tt=new $e,nt=new Te(0,0,0),rt=new Te(1,1,1),it=new Te,at=new Te,ot=new Te,st=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.DefaultOrder;Object(y.a)(this,e),Object.defineProperty(this,"isEuler",{value:!0}),this._x=t,this._y=n,this._z=r,this._order=i}return Object(g.a)(e,[{key:"set",value:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e,t,n){var r=me.clamp,i=e.elements,a=i[0],o=i[4],s=i[8],l=i[1],u=i[5],c=i[9],h=i[2],f=i[6],d=i[10];switch(t=t||this._order){case"XYZ":this._y=Math.asin(r(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,d),this._z=Math.atan2(-o,a)):(this._x=Math.atan2(f,u),this._z=0);break;case"YXZ":this._x=Math.asin(-r(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(s,d),this._z=Math.atan2(l,u)):(this._y=Math.atan2(-h,a),this._z=0);break;case"ZXY":this._x=Math.asin(r(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,d),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(l,a));break;case"ZYX":this._y=Math.asin(-r(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,d),this._z=Math.atan2(l,a)):(this._x=0,this._z=Math.atan2(-o,u));break;case"YZX":this._z=Math.asin(r(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-h,a)):(this._x=0,this._y=Math.atan2(s,d));break;case"XZY":this._z=Math.asin(-r(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(s,a)):(this._x=Math.atan2(-c,d),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!1!==n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(e,t,n){return lt.makeRotationFromQuaternion(e),this.setFromRotationMatrix(lt,t,n)}},{key:"setFromVector3",value:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)}},{key:"reorder",value:function(e){return ut.setFromEuler(this),this.setFromQuaternion(ut,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}},{key:"toVector3",value:function(e){return e?e.set(this._x,this._y,this._z):new Te(this._x,this._y,this._z)}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}]),e}();st.DefaultOrder="XYZ",st.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var lt=new $e,ut=new Se,ct=function(){function e(){Object(y.a)(this,e),this.mask=1}return Object(g.a)(e,[{key:"set",value:function(e){this.mask=1<<e|0}},{key:"enable",value:function(e){this.mask|=1<<e|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(e){this.mask^=1<<e|0}},{key:"disable",value:function(e){this.mask&=~(1<<e|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(e){return 0!==(this.mask&e.mask)}}]),e}(),ht=0,ft=new Te,dt=new Se,pt=new $e,mt=new Te,vt=new Te,yt=new Te,gt=new Se,_t=new Te(1,0,0),bt=new Te(0,1,0),xt=new Te(0,0,1),wt={type:"added"},Et={type:"removed"};function St(){Object.defineProperty(this,"id",{value:ht++}),this.uuid=me.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=St.DefaultUp.clone();var e=new Te,t=new st,n=new Se,r=new Te(1,1,1);t._onChange((function(){n.setFromEuler(t,!1)})),n._onChange((function(){t.setFromQuaternion(n,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new $e},normalMatrix:{value:new ye}}),this.matrix=new $e,this.matrixWorld=new $e,this.matrixAutoUpdate=St.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new ct,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}St.DefaultUp=new Te(0,1,0),St.DefaultMatrixAutoUpdate=!0,St.prototype=Object.assign(Object.create(ce.prototype),{constructor:St,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return dt.setFromAxisAngle(e,t),this.quaternion.multiply(dt),this},rotateOnWorldAxis:function(e,t){return dt.setFromAxisAngle(e,t),this.quaternion.premultiply(dt),this},rotateX:function(e){return this.rotateOnAxis(_t,e)},rotateY:function(e){return this.rotateOnAxis(bt,e)},rotateZ:function(e){return this.rotateOnAxis(xt,e)},translateOnAxis:function(e,t){return ft.copy(e).applyQuaternion(this.quaternion),this.position.add(ft.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(_t,e)},translateY:function(e){return this.translateOnAxis(bt,e)},translateZ:function(e){return this.translateOnAxis(xt,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(pt.copy(this.matrixWorld).invert())},lookAt:function(e,t,n){e.isVector3?mt.copy(e):mt.set(e,t,n);var r=this.parent;this.updateWorldMatrix(!0,!1),vt.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?pt.lookAt(vt,mt,this.up):pt.lookAt(mt,vt,this.up),this.quaternion.setFromRotationMatrix(pt),r&&(pt.extractRotation(r.matrixWorld),dt.setFromRotationMatrix(pt),this.quaternion.premultiply(dt.invert()))},add:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(wt)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)},remove:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(Et)),this},clear:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];t.parent=null,t.dispatchEvent(Et)}return this.children.length=0,this},attach:function(e){return this.updateWorldMatrix(!0,!1),pt.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),pt.multiply(e.parent.matrixWorld)),e.applyMatrix4(pt),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n].getObjectByProperty(e,t);if(void 0!==i)return i}},getWorldPosition:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Te),this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Se),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(vt,e,yt),e},getWorldScale:function(e){return void 0===e&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new Te),this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(vt,gt,e),e},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Te),this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)},traverseVisible:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,i=0,a=r.length;i<a;i++)r[i].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function i(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){r.geometry=i(e.geometries,this.geometry);var a=this.geometry.parameters;if(void 0!==a&&void 0!==a.shapes){var o=a.shapes;if(Array.isArray(o))for(var s=0,l=o.length;s<l;s++){var u=o[s];i(e.shapes,u)}else i(e.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(i(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var c=[],h=0,f=this.material.length;h<f;h++)c.push(i(e.materials,this.material[h]));r.material=c}else r.material=i(e.materials,this.material);if(this.children.length>0){r.children=[];for(var d=0;d<this.children.length;d++)r.children.push(this.children[d].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(var p=0;p<this.animations.length;p++){var m=this.animations[p];r.animations.push(i(e.animations,m))}}if(t){var v=E(e.geometries),y=E(e.materials),g=E(e.textures),_=E(e.images),b=E(e.shapes),x=E(e.skeletons),w=E(e.animations);v.length>0&&(n.geometries=v),y.length>0&&(n.materials=y),g.length>0&&(n.textures=g),_.length>0&&(n.images=_),b.length>0&&(n.shapes=b),x.length>0&&(n.skeletons=x),w.length>0&&(n.animations=w)}return n.object=r,n;function E(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}},clone:function(e){return(new this.constructor).copy(this,e)},copy:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}});var Tt=new Te,kt=new Te,Mt=new ye,Ct=function(){function e(t,n){Object(y.a)(this,e),Object.defineProperty(this,"isPlane",{value:!0}),this.normal=void 0!==t?t:new Te(1,0,0),this.constant=void 0!==n?n:0}return Object(g.a)(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var r=Tt.subVectors(n,t).cross(kt.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return void 0===t&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Te),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"intersectLine",value:function(e,t){void 0===t&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new Te);var n=e.delta(Tt),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):void 0;var i=-(e.start.dot(this.normal)+this.constant)/r;return i<0||i>1?void 0:t.copy(n).multiplyScalar(i).add(e.start)}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function(e){return void 0===e&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Te),e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(e,t){var n=t||Mt.getNormalMatrix(e),r=this.coplanarPoint(Tt).applyMatrix4(e),i=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(i),this}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}}]),e}(),At=new Te,It=new Te,Pt=new Te,Rt=new Te,Lt=new Te,Ot=new Te,Dt=new Te,Nt=new Te,zt=new Te,Ft=new Te,Bt=function(){function e(t,n,r){Object(y.a)(this,e),this.a=void 0!==t?t:new Te,this.b=void 0!==n?n:new Te,this.c=void 0!==r?r:new Te}return Object(g.a)(e,[{key:"set",value:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}},{key:"setFromPointsAndIndices",value:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}},{key:"getArea",value:function(){return At.subVectors(this.c,this.b),It.subVectors(this.a,this.b),.5*At.cross(It).length()}},{key:"getMidpoint",value:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Te),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(t){return e.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function(e){return void 0===e&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new Ct),e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(t,n){return e.getBarycoord(t,this.a,this.b,this.c,n)}},{key:"getUV",value:function(t,n,r,i,a){return e.getUV(t,this.a,this.b,this.c,n,r,i,a)}},{key:"containsPoint",value:function(t){return e.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(t){return e.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(e,t){void 0===t&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new Te);var n,r,i=this.a,a=this.b,o=this.c;Lt.subVectors(a,i),Ot.subVectors(o,i),Nt.subVectors(e,i);var s=Lt.dot(Nt),l=Ot.dot(Nt);if(s<=0&&l<=0)return t.copy(i);zt.subVectors(e,a);var u=Lt.dot(zt),c=Ot.dot(zt);if(u>=0&&c<=u)return t.copy(a);var h=s*c-u*l;if(h<=0&&s>=0&&u<=0)return n=s/(s-u),t.copy(i).addScaledVector(Lt,n);Ft.subVectors(e,o);var f=Lt.dot(Ft),d=Ot.dot(Ft);if(d>=0&&f<=d)return t.copy(o);var p=f*l-s*d;if(p<=0&&l>=0&&d<=0)return r=l/(l-d),t.copy(i).addScaledVector(Ot,r);var m=u*d-f*c;if(m<=0&&c-u>=0&&f-d>=0)return Dt.subVectors(o,a),r=(c-u)/(c-u+(f-d)),t.copy(a).addScaledVector(Dt,r);var v=1/(m+p+h);return n=p*v,r=h*v,t.copy(i).addScaledVector(Lt,n).addScaledVector(Ot,r)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function(e,t,n,r){void 0===r&&(console.warn("THREE.Triangle: .getNormal() target is now required"),r=new Te),r.subVectors(n,t),At.subVectors(e,t),r.cross(At);var i=r.lengthSq();return i>0?r.multiplyScalar(1/Math.sqrt(i)):r.set(0,0,0)}},{key:"getBarycoord",value:function(e,t,n,r,i){At.subVectors(r,t),It.subVectors(n,t),Pt.subVectors(e,t);var a=At.dot(At),o=At.dot(It),s=At.dot(Pt),l=It.dot(It),u=It.dot(Pt),c=a*l-o*o;if(void 0===i&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),i=new Te),0===c)return i.set(-2,-1,-1);var h=1/c,f=(l*s-o*u)*h,d=(a*u-o*s)*h;return i.set(1-f-d,d,f)}},{key:"containsPoint",value:function(e,t,n,r){return this.getBarycoord(e,t,n,r,Rt),Rt.x>=0&&Rt.y>=0&&Rt.x+Rt.y<=1}},{key:"getUV",value:function(e,t,n,r,i,a,o,s){return this.getBarycoord(e,t,n,r,Rt),s.set(0,0),s.addScaledVector(i,Rt.x),s.addScaledVector(a,Rt.y),s.addScaledVector(o,Rt.z),s}},{key:"isFrontFacing",value:function(e,t,n,r){return At.subVectors(n,t),It.subVectors(e,t),At.cross(It).dot(r)<0}}]),e}(),Ut={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},jt={h:0,s:0,l:0},Vt={h:0,s:0,l:0};function Ht(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Gt(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Wt(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var qt=function(){function e(t,n,r){return Object(y.a)(this,e),Object.defineProperty(this,"isColor",{value:!0}),void 0===n&&void 0===r?this.set(t):this.setRGB(t,n,r)}return Object(g.a)(e,[{key:"set",value:function(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}},{key:"setRGB",value:function(e,t,n){return this.r=e,this.g=t,this.b=n,this}},{key:"setHSL",value:function(e,t,n){if(e=me.euclideanModulo(e,1),t=me.clamp(t,0,1),n=me.clamp(n,0,1),0===t)this.r=this.g=this.b=n;else{var r=n<=.5?n*(1+t):n+t-n*t,i=2*n-r;this.r=Ht(i,r,e+1/3),this.g=Ht(i,r,e),this.b=Ht(i,r,e-1/3)}return this}},{key:"setStyle",value:function(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var n;if(n=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){var r,i=n[1],a=n[2];switch(i){case"rgb":case"rgba":if(r=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(255,parseInt(r[1],10))/255,this.g=Math.min(255,parseInt(r[2],10))/255,this.b=Math.min(255,parseInt(r[3],10))/255,t(r[4]),this;if(r=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a))return this.r=Math.min(100,parseInt(r[1],10))/100,this.g=Math.min(100,parseInt(r[2],10))/100,this.b=Math.min(100,parseInt(r[3],10))/100,t(r[4]),this;break;case"hsl":case"hsla":if(r=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(a)){var o=parseFloat(r[1])/360,s=parseInt(r[2],10)/100,l=parseInt(r[3],10)/100;return t(r[4]),this.setHSL(o,s,l)}}}else if(n=/^\#([A-Fa-f\d]+)$/.exec(e)){var u=n[1],c=u.length;if(3===c)return this.r=parseInt(u.charAt(0)+u.charAt(0),16)/255,this.g=parseInt(u.charAt(1)+u.charAt(1),16)/255,this.b=parseInt(u.charAt(2)+u.charAt(2),16)/255,this;if(6===c)return this.r=parseInt(u.charAt(0)+u.charAt(1),16)/255,this.g=parseInt(u.charAt(2)+u.charAt(3),16)/255,this.b=parseInt(u.charAt(4)+u.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}},{key:"setColorName",value:function(e){var t=Ut[e];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copyGammaToLinear",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}},{key:"copyLinearToGamma",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=t>0?1/t:1;return this.r=Math.pow(e.r,n),this.g=Math.pow(e.g,n),this.b=Math.pow(e.b,n),this}},{key:"convertGammaToLinear",value:function(e){return this.copyGammaToLinear(this,e),this}},{key:"convertLinearToGamma",value:function(e){return this.copyLinearToGamma(this,e),this}},{key:"copySRGBToLinear",value:function(e){return this.r=Gt(e.r),this.g=Gt(e.g),this.b=Gt(e.b),this}},{key:"copyLinearToSRGB",value:function(e){return this.r=Wt(e.r),this.g=Wt(e.g),this.b=Wt(e.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}},{key:"getHexString",value:function(){return("000000"+this.getHex().toString(16)).slice(-6)}},{key:"getHSL",value:function(e){void 0===e&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,n,r=this.r,i=this.g,a=this.b,o=Math.max(r,i,a),s=Math.min(r,i,a),l=(s+o)/2;if(s===o)t=0,n=0;else{var u=o-s;switch(n=l<=.5?u/(o+s):u/(2-o-s),o){case r:t=(i-a)/u+(i<a?6:0);break;case i:t=(a-r)/u+2;break;case a:t=(r-i)/u+4}t/=6}return e.h=t,e.s=n,e.l=l,e}},{key:"getStyle",value:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}},{key:"offsetHSL",value:function(e,t,n){return this.getHSL(jt),jt.h+=e,jt.s+=t,jt.l+=n,this.setHSL(jt.h,jt.s,jt.l),this}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpColors",value:function(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}},{key:"lerpHSL",value:function(e,t){this.getHSL(jt),e.getHSL(Vt);var n=me.lerp(jt.h,Vt.h,t),r=me.lerp(jt.s,Vt.s,t),i=me.lerp(jt.l,Vt.l,t);return this.setHSL(n,r,i),this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}},{key:"toJSON",value:function(){return this.getHex()}}]),e}();qt.NAMES=Ut,qt.prototype.r=1,qt.prototype.g=1,qt.prototype.b=1;var Xt=function(){function e(t,n,r,i,a){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;Object(y.a)(this,e),this.a=t,this.b=n,this.c=r,this.normal=i&&i.isVector3?i:new Te,this.vertexNormals=Array.isArray(i)?i:[],this.color=a&&a.isColor?a:new qt,this.vertexColors=Array.isArray(a)?a:[],this.materialIndex=o}return Object(g.a)(e,[{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,n=e.vertexNormals.length;t<n;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(var r=0,i=e.vertexColors.length;r<i;r++)this.vertexColors[r]=e.vertexColors[r].clone();return this}}]),e}(),Zt=0;function Kt(){Object.defineProperty(this,"id",{value:Zt++}),this.uuid=me.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=1,this.side=_,this.flatShading=!1,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=x,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=oe,this.stencilZFail=oe,this.stencilZPass=oe,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function Yt(e){Kt.call(this),this.type="MeshBasicMaterial",this.color=new qt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}Kt.prototype=Object.assign(Object.create(ce.prototype),{constructor:Kt,isMaterial:!0,onBeforeCompile:function(){},customProgramCacheKey:function(){return this.onBeforeCompile.toString()},setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===n;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(n.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,n.reflectivity=this.reflectivity,n.refractionRatio=this.refractionRatio,void 0!==this.combine&&(n.combine=this.combine),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.size&&(n.size=this.size),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(n.blending=this.blending),!0===this.flatShading&&(n.flatShading=this.flatShading),this.side!==_&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.morphTargets&&(n.morphTargets=!0),!0===this.morphNormals&&(n.morphNormals=!0),!0===this.skinning&&(n.skinning=!0),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var i=r(e.textures),a=r(e.images);i.length>0&&(n.textures=i),a.length>0&&(n.images=a)}return n},clone:function(){return(new this.constructor).copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var r=t.length;n=new Array(r);for(var i=0;i!==r;++i)n[i]=t[i].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(Kt.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Yt.prototype=Object.create(Kt.prototype),Yt.prototype.constructor=Yt,Yt.prototype.isMeshBasicMaterial=!0,Yt.prototype.copy=function(e){return Kt.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};var Jt=new Te,Qt=new ve;function $t(e,t,n){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===n,this.usage=se,this.updateRange={offset:0,count:-1},this.version=0}function en(e,t,n){$t.call(this,new Int8Array(e),t,n)}function tn(e,t,n){$t.call(this,new Uint8Array(e),t,n)}function nn(e,t,n){$t.call(this,new Uint8ClampedArray(e),t,n)}function rn(e,t,n){$t.call(this,new Int16Array(e),t,n)}function an(e,t,n){$t.call(this,new Uint16Array(e),t,n)}function on(e,t,n){$t.call(this,new Int32Array(e),t,n)}function sn(e,t,n){$t.call(this,new Uint32Array(e),t,n)}function ln(e,t,n){$t.call(this,new Uint16Array(e),t,n)}function un(e,t,n){$t.call(this,new Float32Array(e),t,n)}function cn(e,t,n){$t.call(this,new Float64Array(e),t,n)}function hn(e){if(0===e.length)return-1/0;for(var t=e[0],n=1,r=e.length;n<r;++n)e[n]>t&&(t=e[n]);return t}Object.defineProperty($t.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign($t.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,i=this.itemSize;r<i;r++)this.array[e+r]=t.array[n+r];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),a=new qt),t[n++]=a.r,t[n++]=a.g,t[n++]=a.b}return this},copyVector2sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),a=new ve),t[n++]=a.x,t[n++]=a.y}return this},copyVector3sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),a=new Te),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z}return this},copyVector4sArray:function(e){for(var t=this.array,n=0,r=0,i=e.length;r<i;r++){var a=e[r];void 0===a&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),a=new we),t[n++]=a.x,t[n++]=a.y,t[n++]=a.z,t[n++]=a.w}return this},applyMatrix3:function(e){if(2===this.itemSize)for(var t=0,n=this.count;t<n;t++)Qt.fromBufferAttribute(this,t),Qt.applyMatrix3(e),this.setXY(t,Qt.x,Qt.y);else if(3===this.itemSize)for(var r=0,i=this.count;r<i;r++)Jt.fromBufferAttribute(this,r),Jt.applyMatrix3(e),this.setXYZ(r,Jt.x,Jt.y,Jt.z);return this},applyMatrix4:function(e){for(var t=0,n=this.count;t<n;t++)Jt.x=this.getX(t),Jt.y=this.getY(t),Jt.z=this.getZ(t),Jt.applyMatrix4(e),this.setXYZ(t,Jt.x,Jt.y,Jt.z);return this},applyNormalMatrix:function(e){for(var t=0,n=this.count;t<n;t++)Jt.x=this.getX(t),Jt.y=this.getY(t),Jt.z=this.getZ(t),Jt.applyNormalMatrix(e),this.setXYZ(t,Jt.x,Jt.y,Jt.z);return this},transformDirection:function(e){for(var t=0,n=this.count;t<n;t++)Jt.x=this.getX(t),Jt.y=this.getY(t),Jt.z=this.getZ(t),Jt.transformDirection(e),this.setXYZ(t,Jt.x,Jt.y,Jt.z);return this},set:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=i,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),en.prototype=Object.create($t.prototype),en.prototype.constructor=en,tn.prototype=Object.create($t.prototype),tn.prototype.constructor=tn,nn.prototype=Object.create($t.prototype),nn.prototype.constructor=nn,rn.prototype=Object.create($t.prototype),rn.prototype.constructor=rn,an.prototype=Object.create($t.prototype),an.prototype.constructor=an,on.prototype=Object.create($t.prototype),on.prototype.constructor=on,sn.prototype=Object.create($t.prototype),sn.prototype.constructor=sn,ln.prototype=Object.create($t.prototype),ln.prototype.constructor=ln,ln.prototype.isFloat16BufferAttribute=!0,un.prototype=Object.create($t.prototype),un.prototype.constructor=un,cn.prototype=Object.create($t.prototype),cn.prototype.constructor=cn;var fn={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!==typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function dn(e,t){return new fn[e](t)}var pn=0,mn=new $e,vn=new St,yn=new Te,gn=new Ce,_n=new Ce,bn=new Te;function xn(){Object.defineProperty(this,"id",{value:pn++}),this.uuid=me.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}xn.prototype=Object.assign(Object.create(ce.prototype),{constructor:xn,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){return Array.isArray(e)?this.index=new(hn(e)>65535?sn:an)(e,1):this.index=e,this},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},hasAttribute:function(e){return void 0!==this.attributes[e]},addGroup:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new ye).getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}var i=this.attributes.tangent;return void 0!==i&&(i.transformDirection(e),i.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this},rotateX:function(e){return mn.makeRotationX(e),this.applyMatrix4(mn),this},rotateY:function(e){return mn.makeRotationY(e),this.applyMatrix4(mn),this},rotateZ:function(e){return mn.makeRotationZ(e),this.applyMatrix4(mn),this},translate:function(e,t,n){return mn.makeTranslation(e,t,n),this.applyMatrix4(mn),this},scale:function(e,t,n){return mn.makeScale(e,t,n),this.applyMatrix4(mn),this},lookAt:function(e){return vn.lookAt(e),vn.updateMatrix(),this.applyMatrix4(vn.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(yn).negate(),this.translate(yn.x,yn.y,yn.z),this},setFromPoints:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];t.push(i.x,i.y,i.z||0)}return this.setAttribute("position",new un(t,3)),this},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new Ce);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Te(-1/0,-1/0,-1/0),new Te(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,r=t.length;n<r;n++){var i=t[n];gn.setFromBufferAttribute(i),this.morphTargetsRelative?(bn.addVectors(this.boundingBox.min,gn.min),this.boundingBox.expandByPoint(bn),bn.addVectors(this.boundingBox.max,gn.max),this.boundingBox.expandByPoint(bn)):(this.boundingBox.expandByPoint(gn.min),this.boundingBox.expandByPoint(gn.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new Ge);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Te,1/0);if(e){var n=this.boundingSphere.center;if(gn.setFromBufferAttribute(e),t)for(var r=0,i=t.length;r<i;r++){var a=t[r];_n.setFromBufferAttribute(a),this.morphTargetsRelative?(bn.addVectors(gn.min,_n.min),gn.expandByPoint(bn),bn.addVectors(gn.max,_n.max),gn.expandByPoint(bn)):(gn.expandByPoint(_n.min),gn.expandByPoint(_n.max))}gn.getCenter(n);for(var o=0,s=0,l=e.count;s<l;s++)bn.fromBufferAttribute(e,s),o=Math.max(o,n.distanceToSquared(bn));if(t)for(var u=0,c=t.length;u<c;u++)for(var h=t[u],f=this.morphTargetsRelative,d=0,p=h.count;d<p;d++)bn.fromBufferAttribute(h,d),f&&(yn.fromBufferAttribute(e,d),bn.add(yn)),o=Math.max(o,n.distanceToSquared(bn));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeTangents:function(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var n=e.array,r=t.position.array,i=t.normal.array,a=t.uv.array,o=r.length/3;void 0===t.tangent&&this.setAttribute("tangent",new $t(new Float32Array(4*o),4));for(var s=t.tangent.array,l=[],u=[],c=0;c<o;c++)l[c]=new Te,u[c]=new Te;var h=new Te,f=new Te,d=new Te,p=new ve,m=new ve,v=new ve,y=new Te,g=new Te,_=this.groups;0===_.length&&(_=[{start:0,count:n.length}]);for(var b=0,x=_.length;b<x;++b)for(var w=_[b],E=w.start,S=E,T=E+w.count;S<T;S+=3)N(n[S+0],n[S+1],n[S+2]);for(var k=new Te,M=new Te,C=new Te,A=new Te,I=0,P=_.length;I<P;++I)for(var R=_[I],L=R.start,O=L,D=L+R.count;O<D;O+=3)z(n[O+0]),z(n[O+1]),z(n[O+2])}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function N(e,t,n){h.fromArray(r,3*e),f.fromArray(r,3*t),d.fromArray(r,3*n),p.fromArray(a,2*e),m.fromArray(a,2*t),v.fromArray(a,2*n),f.sub(h),d.sub(h),m.sub(p),v.sub(p);var i=1/(m.x*v.y-v.x*m.y);isFinite(i)&&(y.copy(f).multiplyScalar(v.y).addScaledVector(d,-m.y).multiplyScalar(i),g.copy(d).multiplyScalar(m.x).addScaledVector(f,-v.x).multiplyScalar(i),l[e].add(y),l[t].add(y),l[n].add(y),u[e].add(g),u[t].add(g),u[n].add(g))}function z(e){C.fromArray(i,3*e),A.copy(C);var t=l[e];k.copy(t),k.sub(C.multiplyScalar(C.dot(t))).normalize(),M.crossVectors(A,t);var n=M.dot(u[e])<0?-1:1;s[4*e]=k.x,s[4*e+1]=k.y,s[4*e+2]=k.z,s[4*e+3]=n}},computeVertexNormals:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var n=this.getAttribute("normal");if(void 0===n)n=new $t(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(var r=0,i=n.count;r<i;r++)n.setXYZ(r,0,0,0);var a=new Te,o=new Te,s=new Te,l=new Te,u=new Te,c=new Te,h=new Te,f=new Te;if(e)for(var d=0,p=e.count;d<p;d+=3){var m=e.getX(d+0),v=e.getX(d+1),y=e.getX(d+2);a.fromBufferAttribute(t,m),o.fromBufferAttribute(t,v),s.fromBufferAttribute(t,y),h.subVectors(s,o),f.subVectors(a,o),h.cross(f),l.fromBufferAttribute(n,m),u.fromBufferAttribute(n,v),c.fromBufferAttribute(n,y),l.add(h),u.add(h),c.add(h),n.setXYZ(m,l.x,l.y,l.z),n.setXYZ(v,u.x,u.y,u.z),n.setXYZ(y,c.x,c.y,c.z)}else for(var g=0,_=t.count;g<_;g+=3)a.fromBufferAttribute(t,g+0),o.fromBufferAttribute(t,g+1),s.fromBufferAttribute(t,g+2),h.subVectors(s,o),f.subVectors(a,o),h.cross(f),n.setXYZ(g+0,h.x,h.y,h.z),n.setXYZ(g+1,h.x,h.y,h.z),n.setXYZ(g+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==e.attributes[r])for(var i=n[r].array,a=e.attributes[r],o=a.array,s=a.itemSize*t,l=Math.min(o.length,i.length-s),u=0,c=s;u<l;u++,c++)i[c]=o[u];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)bn.fromBufferAttribute(e,t),bn.normalize(),e.setXYZ(t,bn.x,bn.y,bn.z)},toNonIndexed:function(){function e(e,t){for(var n=e.array,r=e.itemSize,i=e.normalized,a=new n.constructor(t.length*r),o=0,s=0,l=0,u=t.length;l<u;l++){o=t[l]*r;for(var c=0;c<r;c++)a[s++]=n[o++]}return new $t(a,r,i)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var t=new xn,n=this.index.array,r=this.attributes;for(var i in r){var a=e(r[i],n);t.setAttribute(i,a)}var o=this.morphAttributes;for(var s in o){for(var l=[],u=o[s],c=0,h=u.length;c<h;c++){var f=e(u[c],n);l.push(f)}t.morphAttributes[s]=l}t.morphTargetsRelative=this.morphTargetsRelative;for(var d=this.groups,p=0,m=d.length;p<m;p++){var v=d[p];t.addGroup(v.start,v.count,v.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var i=this.attributes;for(var a in i){var o=i[a],s=o.toJSON(e.data);""!==o.name&&(s.name=o.name),e.data.attributes[a]=s}var l={},u=!1;for(var c in this.morphAttributes){for(var h=this.morphAttributes[c],f=[],d=0,p=h.length;d<p;d++){var m=h[d],v=m.toJSON(e.data);""!==m.name&&(v.name=m.name),f.push(v)}f.length>0&&(l[c]=f,u=!0)}u&&(e.data.morphAttributes=l,e.data.morphTargetsRelative=this.morphTargetsRelative);var y=this.groups;y.length>0&&(e.data.groups=JSON.parse(JSON.stringify(y)));var g=this.boundingSphere;return null!==g&&(e.data.boundingSphere={center:g.center.toArray(),radius:g.radius}),e},clone:function(){return(new xn).copy(this)},copy:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone(t));var r=e.attributes;for(var i in r){var a=r[i];this.setAttribute(i,a.clone(t))}var o=e.morphAttributes;for(var s in o){for(var l=[],u=o[s],c=0,h=u.length;c<h;c++)l.push(u[c].clone(t));this.morphAttributes[s]=l}this.morphTargetsRelative=e.morphTargetsRelative;for(var f=e.groups,d=0,p=f.length;d<p;d++){var m=f[d];this.addGroup(m.start,m.count,m.materialIndex)}var v=e.boundingBox;null!==v&&(this.boundingBox=v.clone());var y=e.boundingSphere;return null!==y&&(this.boundingSphere=y.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var wn=new $e,En=new Qe,Sn=new Ge,Tn=new Te,kn=new Te,Mn=new Te,Cn=new Te,An=new Te,In=new Te,Pn=new Te,Rn=new Te,Ln=new Te,On=new ve,Dn=new ve,Nn=new ve,zn=new Te,Fn=new Te;function Bn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new xn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yt;St.call(this),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}function Un(e,t,n,r,i,a,o,s,l,u,c,h){Tn.fromBufferAttribute(i,u),kn.fromBufferAttribute(i,c),Mn.fromBufferAttribute(i,h);var f=e.morphTargetInfluences;if(t.morphTargets&&a&&f){Pn.set(0,0,0),Rn.set(0,0,0),Ln.set(0,0,0);for(var d=0,p=a.length;d<p;d++){var m=f[d],v=a[d];0!==m&&(Cn.fromBufferAttribute(v,u),An.fromBufferAttribute(v,c),In.fromBufferAttribute(v,h),o?(Pn.addScaledVector(Cn,m),Rn.addScaledVector(An,m),Ln.addScaledVector(In,m)):(Pn.addScaledVector(Cn.sub(Tn),m),Rn.addScaledVector(An.sub(kn),m),Ln.addScaledVector(In.sub(Mn),m)))}Tn.add(Pn),kn.add(Rn),Mn.add(Ln)}e.isSkinnedMesh&&(e.boneTransform(u,Tn),e.boneTransform(c,kn),e.boneTransform(h,Mn));var y=function(e,t,n,r,i,a,o,s){if(null===(1===t.side?r.intersectTriangle(o,a,i,!0,s):r.intersectTriangle(i,a,o,t.side!==b,s)))return null;Fn.copy(s),Fn.applyMatrix4(e.matrixWorld);var l=n.ray.origin.distanceTo(Fn);return l<n.near||l>n.far?null:{distance:l,point:Fn.clone(),object:e}}(e,t,n,r,Tn,kn,Mn,zn);if(y){s&&(On.fromBufferAttribute(s,u),Dn.fromBufferAttribute(s,c),Nn.fromBufferAttribute(s,h),y.uv=Bt.getUV(zn,Tn,kn,Mn,On,Dn,Nn,new ve)),l&&(On.fromBufferAttribute(l,u),Dn.fromBufferAttribute(l,c),Nn.fromBufferAttribute(l,h),y.uv2=Bt.getUV(zn,Tn,kn,Mn,On,Dn,Nn,new ve));var g=new Xt(u,c,h);Bt.getNormal(Tn,kn,Mn,g.normal),y.face=g}return y}Bn.prototype=Object.assign(Object.create(St.prototype),{constructor:Bn,isMesh:!0,copy:function(e){return St.prototype.copy.call(this,e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,a=r.length;i<a;i++){var o=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=i}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var n,r=this.geometry,i=this.material,a=this.matrixWorld;if(void 0!==i&&(null===r.boundingSphere&&r.computeBoundingSphere(),Sn.copy(r.boundingSphere),Sn.applyMatrix4(a),!1!==e.ray.intersectsSphere(Sn)&&(wn.copy(a).invert(),En.copy(e.ray).applyMatrix4(wn),null===r.boundingBox||!1!==En.intersectsBox(r.boundingBox))))if(r.isBufferGeometry){var o=r.index,s=r.attributes.position,l=r.morphAttributes.position,u=r.morphTargetsRelative,c=r.attributes.uv,h=r.attributes.uv2,f=r.groups,d=r.drawRange;if(null!==o)if(Array.isArray(i))for(var p=0,m=f.length;p<m;p++)for(var v=f[p],y=i[v.materialIndex],g=Math.max(v.start,d.start),_=Math.min(v.start+v.count,d.start+d.count);g<_;g+=3){var b=o.getX(g),x=o.getX(g+1),w=o.getX(g+2);(n=Un(this,y,e,En,s,l,u,c,h,b,x,w))&&(n.faceIndex=Math.floor(g/3),n.face.materialIndex=v.materialIndex,t.push(n))}else for(var E=Math.max(0,d.start),S=Math.min(o.count,d.start+d.count);E<S;E+=3){var T=o.getX(E),k=o.getX(E+1),M=o.getX(E+2);(n=Un(this,i,e,En,s,l,u,c,h,T,k,M))&&(n.faceIndex=Math.floor(E/3),t.push(n))}else if(void 0!==s)if(Array.isArray(i))for(var C=0,A=f.length;C<A;C++)for(var I=f[C],P=i[I.materialIndex],R=Math.max(I.start,d.start),L=Math.min(I.start+I.count,d.start+d.count);R<L;R+=3){(n=Un(this,P,e,En,s,l,u,c,h,R,R+1,R+2))&&(n.faceIndex=Math.floor(R/3),n.face.materialIndex=I.materialIndex,t.push(n))}else for(var O=Math.max(0,d.start),D=Math.min(s.count,d.start+d.count);O<D;O+=3){(n=Un(this,i,e,En,s,l,u,c,h,O,O+1,O+2))&&(n.faceIndex=Math.floor(O/3),t.push(n))}}else r.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}});var jn=function(e){p(n,e);var t=m(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;Object(y.a)(this,n),(e=t.call(this)).type="BoxGeometry",e.parameters={width:r,height:a,depth:o,widthSegments:s,heightSegments:l,depthSegments:u};var c=i(e);s=Math.floor(s),l=Math.floor(l),u=Math.floor(u);var h=[],f=[],d=[],p=[],m=0,v=0;function g(e,t,n,r,i,a,o,s,l,u,y){for(var g=a/l,_=o/u,b=a/2,x=o/2,w=s/2,E=l+1,S=u+1,T=0,k=0,M=new Te,C=0;C<S;C++)for(var A=C*_-x,I=0;I<E;I++){var P=I*g-b;M[e]=P*r,M[t]=A*i,M[n]=w,f.push(M.x,M.y,M.z),M[e]=0,M[t]=0,M[n]=s>0?1:-1,d.push(M.x,M.y,M.z),p.push(I/l),p.push(1-C/u),T+=1}for(var R=0;R<u;R++)for(var L=0;L<l;L++){var O=m+L+E*R,D=m+L+E*(R+1),N=m+(L+1)+E*(R+1),z=m+(L+1)+E*R;h.push(O,D,z),h.push(D,N,z),k+=6}c.addGroup(v,k,y),v+=k,m+=T}return g("z","y","x",-1,-1,o,a,r,u,l,0),g("z","y","x",1,-1,o,a,-r,u,l,1),g("x","z","y",1,1,r,o,a,s,u,2),g("x","z","y",1,-1,r,o,-a,s,u,3),g("x","y","z",1,-1,r,a,o,s,l,4),g("x","y","z",-1,-1,r,a,-o,s,l,5),e.setIndex(h),e.setAttribute("position",new un(f,3)),e.setAttribute("normal",new un(d,3)),e.setAttribute("uv",new un(p,2)),e}return n}(xn);function Vn(e){var t={};for(var n in e)for(var r in t[n]={},e[n]){var i=e[n][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture)?t[n][r]=i.clone():Array.isArray(i)?t[n][r]=i.slice():t[n][r]=i}return t}function Hn(e){for(var t={},n=0;n<e.length;n++){var r=Vn(e[n]);for(var i in r)t[i]=r[i]}return t}var Gn={clone:Vn,merge:Hn};function Wn(e){Kt.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function qn(){St.call(this),this.type="Camera",this.matrixWorldInverse=new $e,this.projectionMatrix=new $e,this.projectionMatrixInverse=new $e}function Xn(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;qn.call(this),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}Wn.prototype=Object.create(Kt.prototype),Wn.prototype.constructor=Wn,Wn.prototype.isShaderMaterial=!0,Wn.prototype.copy=function(e){return Kt.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Vn(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this},Wn.prototype.toJSON=function(e){var t=Kt.prototype.toJSON.call(this,e);for(var n in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var r=this.uniforms[n].value;r&&r.isTexture?t.uniforms[n]={type:"t",value:r.toJSON(e).uuid}:r&&r.isColor?t.uniforms[n]={type:"c",value:r.getHex()}:r&&r.isVector2?t.uniforms[n]={type:"v2",value:r.toArray()}:r&&r.isVector3?t.uniforms[n]={type:"v3",value:r.toArray()}:r&&r.isVector4?t.uniforms[n]={type:"v4",value:r.toArray()}:r&&r.isMatrix3?t.uniforms[n]={type:"m3",value:r.toArray()}:r&&r.isMatrix4?t.uniforms[n]={type:"m4",value:r.toArray()}:t.uniforms[n]={value:r}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var i={};for(var a in this.extensions)!0===this.extensions[a]&&(i[a]=!0);return Object.keys(i).length>0&&(t.extensions=i),t},qn.prototype=Object.assign(Object.create(St.prototype),{constructor:qn,isCamera:!0,copy:function(e,t){return St.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){void 0===e&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Te),this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){St.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()},updateWorldMatrix:function(e,t){St.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()},clone:function(){return(new this.constructor).copy(this)}}),Xn.prototype=Object.assign(Object.create(qn.prototype),{constructor:Xn,isPerspectiveCamera:!0,copy:function(e,t){return qn.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*me.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*me.DEG2RAD*this.fov);return.5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*me.RAD2DEG*Math.atan(Math.tan(.5*me.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,n,r,i,a){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*me.DEG2RAD*this.fov)/this.zoom,n=2*t,r=this.aspect*n,i=-.5*r,a=this.view;if(null!==this.view&&this.view.enabled){var o=a.fullWidth,s=a.fullHeight;i+=a.offsetX*r/o,t-=a.offsetY*n/s,r*=a.width/o,n*=a.height/s}var l=this.filmOffset;0!==l&&(i+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(i,i+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){var t=St.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}});var Zn=90;function Kn(e,t,n){if(St.call(this),this.type="CubeCamera",!0===n.isWebGLCubeRenderTarget){this.renderTarget=n;var r=new Xn(Zn,1,e,t);r.layers=this.layers,r.up.set(0,-1,0),r.lookAt(new Te(1,0,0)),this.add(r);var i=new Xn(Zn,1,e,t);i.layers=this.layers,i.up.set(0,-1,0),i.lookAt(new Te(-1,0,0)),this.add(i);var a=new Xn(Zn,1,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(new Te(0,1,0)),this.add(a);var o=new Xn(Zn,1,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new Te(0,-1,0)),this.add(o);var s=new Xn(Zn,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new Te(0,0,1)),this.add(s);var l=new Xn(Zn,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Te(0,0,-1)),this.add(l),this.update=function(e,t){null===this.parent&&this.updateMatrixWorld();var u=e.xr.enabled,c=e.getRenderTarget();e.xr.enabled=!1;var h=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,r),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,a),e.setRenderTarget(n,3),e.render(t,o),e.setRenderTarget(n,4),e.render(t,s),n.texture.generateMipmaps=h,e.setRenderTarget(n,5),e.render(t,l),e.setRenderTarget(c),e.xr.enabled=u}}else console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.")}function Yn(e,t,n,r,i,a,o,s,l,u){e=void 0!==e?e:[],t=void 0!==t?t:w,o=void 0!==o?o:j,be.call(this,e,t,n,r,i,a,o,s,l,u),this.flipY=!1,this._needsFlipEnvMap=!0}Kn.prototype=Object.create(St.prototype),Kn.prototype.constructor=Kn,Yn.prototype=Object.create(be.prototype),Yn.prototype.constructor=Yn,Yn.prototype.isCubeTexture=!0,Object.defineProperty(Yn.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}});var Jn=function(e){p(n,e);var t=m(n);function n(e,r,a){var o;return Object(y.a)(this,n),Number.isInteger(r)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),r=a),o=t.call(this,e,e,r),Object.defineProperty(i(o),"isWebGLCubeRenderTarget",{value:!0}),r=r||{},o.texture=new Yn(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),o.texture._needsFlipEnvMap=!1,o}return Object(g.a)(n,[{key:"fromEquirectangularTexture",value:function(e,t){this.texture.type=t.type,this.texture.format=V,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",a=new jn(5,5,5),o=new Wn({name:"CubemapFromEquirect",uniforms:Vn(n),vertexShader:r,fragmentShader:i,side:1,blending:0});o.uniforms.tEquirect.value=t;var s=new Bn(a,o),l=t.minFilter;return t.minFilter===O&&(t.minFilter=R),new Kn(1,10,this).update(e,s),t.minFilter=l,s.geometry.dispose(),s.material.dispose(),this}},{key:"clear",value:function(e,t,n,r){for(var i=e.getRenderTarget(),a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,r);e.setRenderTarget(i)}}]),n}(Ee);function Qn(e,t,n,r,i,a,o,s,l,u,c,h){be.call(this,null,a,o,s,l,u,r,i,c,h),this.image={data:e||null,width:t||1,height:n||1},this.magFilter=void 0!==l?l:A,this.minFilter=void 0!==u?u:A,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}Qn.prototype=Object.create(be.prototype),Qn.prototype.constructor=Qn,Qn.prototype.isDataTexture=!0;var $n=new Ge,er=new Te,tr=function(){function e(t,n,r,i,a,o){Object(y.a)(this,e),this.planes=[void 0!==t?t:new Ct,void 0!==n?n:new Ct,void 0!==r?r:new Ct,void 0!==i?i:new Ct,void 0!==a?a:new Ct,void 0!==o?o:new Ct]}return Object(g.a)(e,[{key:"set",value:function(e,t,n,r,i,a){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(a),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this}},{key:"setFromProjectionMatrix",value:function(e){var t=this.planes,n=e.elements,r=n[0],i=n[1],a=n[2],o=n[3],s=n[4],l=n[5],u=n[6],c=n[7],h=n[8],f=n[9],d=n[10],p=n[11],m=n[12],v=n[13],y=n[14],g=n[15];return t[0].setComponents(o-r,c-s,p-h,g-m).normalize(),t[1].setComponents(o+r,c+s,p+h,g+m).normalize(),t[2].setComponents(o+i,c+l,p+f,g+v).normalize(),t[3].setComponents(o-i,c-l,p-f,g-v).normalize(),t[4].setComponents(o-a,c-u,p-d,g-y).normalize(),t[5].setComponents(o+a,c+u,p+d,g+y).normalize(),this}},{key:"intersectsObject",value:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),$n.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere($n)}},{key:"intersectsSprite",value:function(e){return $n.center.set(0,0,0),$n.radius=.7071067811865476,$n.applyMatrix4(e.matrixWorld),this.intersectsSphere($n)}},{key:"intersectsSphere",value:function(e){for(var t=this.planes,n=e.center,r=-e.radius,i=0;i<6;i++){if(t[i].distanceToPoint(n)<r)return!1}return!0}},{key:"intersectsBox",value:function(e){for(var t=this.planes,n=0;n<6;n++){var r=t[n];if(er.x=r.normal.x>0?e.max.x:e.min.x,er.y=r.normal.y>0?e.max.y:e.min.y,er.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(er)<0)return!1}return!0}},{key:"containsPoint",value:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}}]),e}();function nr(){var e=null,t=!1,n=null,r=null;function i(t,a){n(t,a),r=e.requestAnimationFrame(i)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(i),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function rr(e,t){var n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,i){if(t.isGLBufferAttribute){var a=r.get(t);(!a||a.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);var o=r.get(t);void 0===o?r.set(t,function(t,r){var i=t.array,a=t.usage,o=e.createBuffer();e.bindBuffer(r,o),e.bufferData(r,i,a),t.onUploadCallback();var s=5126;return i instanceof Float32Array?s=5126:i instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):i instanceof Uint16Array?t.isFloat16BufferAttribute?n?s=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):s=5123:i instanceof Int16Array?s=5122:i instanceof Uint32Array?s=5125:i instanceof Int32Array?s=5124:i instanceof Int8Array?s=5120:i instanceof Uint8Array&&(s=5121),{buffer:o,type:s,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,i)):o.version<t.version&&(!function(t,r,i){var a=r.array,o=r.updateRange;e.bindBuffer(i,t),-1===o.count?e.bufferSubData(i,0,a):(n?e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a,o.offset,o.count):e.bufferSubData(i,o.offset*a.BYTES_PER_ELEMENT,a.subarray(o.offset,o.offset+o.count)),o.count=-1)}(o.buffer,t,i),o.version=t.version)}}}}var ir=function(e){p(n,e);var t=m(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;Object(y.a)(this,n),(e=t.call(this)).type="PlaneGeometry",e.parameters={width:r,height:i,widthSegments:a,heightSegments:o};for(var s=r/2,l=i/2,u=Math.floor(a),c=Math.floor(o),h=u+1,f=c+1,d=r/u,p=i/c,m=[],v=[],g=[],_=[],b=0;b<f;b++)for(var x=b*p-l,w=0;w<h;w++){var E=w*d-s;v.push(E,-x,0),g.push(0,0,1),_.push(w/u),_.push(1-b/c)}for(var S=0;S<c;S++)for(var T=0;T<u;T++){var k=T+h*S,M=T+h*(S+1),C=T+1+h*(S+1),A=T+1+h*S;m.push(k,M,A),m.push(M,C,A)}return e.setIndex(m),e.setAttribute("position",new un(v,3)),e.setAttribute("normal",new un(g,3)),e.setAttribute("uv",new un(_,2)),e}return n}(xn),ar={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef ALPHATEST\n\tif ( diffuseColor.a < ALPHATEST ) discard;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\treturn vec2( -1.04, 1.04 ) * a004 + r.zw;\n}\nfloat punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\tif( cutoffDistance > 0.0 ) {\n\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t}\n\treturn distanceFalloff;\n#else\n\tif( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t}\n\treturn 1.0;\n#endif\n}\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\n}\nvec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {\n\tfloat fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );\n\tvec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;\n\treturn Fr * fresnel + F0;\n}\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\treturn 1.0 / ( gl * gv );\n}\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( incidentLight.direction + viewDir );\n\tfloat dotNL = saturate( dot( normal, incidentLight.direction ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( G * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nvec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\treturn specularColor * brdf.x + brdf.y;\n}\nvoid BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\tvec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );\n\tvec2 brdf = integrateSpecularBRDF( dotNV, roughness );\n\tvec3 FssEss = F * brdf.x + brdf.y;\n\tfloat Ess = brdf.x + brdf.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, dotLH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\n}\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie(float roughness, float NoH) {\n\tfloat invAlpha = 1.0 / roughness;\n\tfloat cos2h = NoH * NoH;\n\tfloat sin2h = max(1.0 - cos2h, 0.0078125);\treturn (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);\n}\nfloat V_Neubelt(float NoV, float NoL) {\n\treturn saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));\n}\nvec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {\n\tvec3 N = geometry.normal;\n\tvec3 V = geometry.viewDir;\n\tvec3 H = normalize( V + L );\n\tfloat dotNH = saturate( dot( N, H ) );\n\treturn specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 );\n\t\tfDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#ifdef USE_COLOR\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor.xyz *= color.xyz;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement(a) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract(sin(sn) * c);\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\n\treturn - distance * planeNormal + point;\n}\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\n}\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifndef ENVMAP_TYPE_CUBE_UV\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t#else\n\t\t\tvec4 envMapColor = vec4( 0.0 );\n\t\t#endif\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t}\n\tfloat getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\n\t\tfloat sigma = PI * roughness * roughness / ( 1.0 + roughness );\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + log2( sigma );\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\n\t}\n\tvec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( -viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( -viewDir, normal, refractionRatio );\n\t\t#endif\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );\n\t\t#ifdef ENVMAP_TYPE_CUBE\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\n\t\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#else\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\n\t\t\t#endif\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t#endif\n\t\treturn envMapColor.rgb * envMapIntensity;\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tfogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float fogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float fogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\treflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {\n\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treturn irradiance;\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tdirectLight.color = directionalLight.color;\n\t\tdirectLight.direction = directionalLight.direction;\n\t\tdirectLight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tdirectLight.color = pointLight.color;\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tdirectLight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\n\t\tif ( angleCos > spotLight.coneCos ) {\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\t\tdirectLight.color = spotLight.color;\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tdirectLight.visible = true;\n\t\t} else {\n\t\t\tdirectLight.color = vec3( 0.0 );\n\t\t\tdirectLight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tirradiance *= PI;\n\t\t#endif\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;\nmaterial.specularRoughness = min( material.specularRoughness, 1.0 );\n#ifdef REFLECTIVITY\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\n#endif\n#ifdef CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheen;\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat specularRoughness;\n\tvec3 specularColor;\n#ifdef CLEARCOAT\n\tfloat clearcoat;\n\tfloat clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tvec3 sheenColor;\n#endif\n};\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\nfloat clearcoatDHRApprox( const in float roughness, const in float dotNL ) {\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.specularRoughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tirradiance *= PI;\n\t#endif\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = ccDotNL * directLight.color;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tccIrradiance *= PI;\n\t\t#endif\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t\treflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(\n\t\t\tmaterial.specularRoughness,\n\t\t\tdirectLight.direction,\n\t\t\tgeometry,\n\t\t\tmaterial.sheenColor\n\t\t);\n\t#else\n\t\treflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);\n\t#endif\n\treflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef CLEARCOAT\n\t\tfloat ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );\n\t\tfloat ccDotNL = ccDotNV;\n\t\tfloat clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );\n\t#else\n\t\tfloat clearcoatDHR = 0.0;\n\t#endif\n\tfloat clearcoatInv = 1.0 - clearcoatDHR;\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tBRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );\n\t#ifdef CLEARCOAT\n\t\tclearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifndef USE_MORPHNORMALS\n\t\tuniform float morphTargetInfluences[ 8 ];\n\t#else\n\t\tuniform float morphTargetInfluences[ 4 ];\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t#ifndef USE_MORPHNORMALS\n\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t#endif\n#endif",normal_fragment_begin:"#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t\tbitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( -vViewPosition, normal, mapN );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tfloat scale = sign( st1.t * st0.s - st0.t * st1.s );\n\t\tvec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );\n\t\tvec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );\n\t\tvec3 N = normalize( surf_norm );\n\t\tmat3 tsn = mat3( S, T, N );\n\t\tmapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n\t\treturn normalize( tsn * mapN );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate(a) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmissionmap_fragment:"#ifdef USE_TRANSMISSIONMAP\n\ttotalTransmission *= texture2D( transmissionMap, vUv ).r;\n#endif",transmissionmap_pars_fragment:"#ifdef USE_TRANSMISSIONMAP\n\tuniform sampler2D transmissionMap;\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_ENVMAP\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#ifndef FLAT_SHADED\n\t\tvNormal = normalize( transformedNormal );\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define REFLECTIVITY\n\t#define CLEARCOAT\n\t#define TRANSMISSION\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef TRANSMISSION\n\tuniform float transmission;\n#endif\n#ifdef REFLECTIVITY\n\tuniform float reflectivity;\n#endif\n#ifdef CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheen;\n#endif\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <transmissionmap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <lights_physical_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#ifdef TRANSMISSION\n\t\tfloat totalTransmission = transmission;\n\t#endif\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <transmissionmap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#ifdef TRANSMISSION\n\t\tdiffuseColor.a *= mix( saturate( 1. - totalTransmission + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) ), 1.0, metalness );\n\t#endif\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",normal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",normal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}"},or={common:{diffuse:{value:new qt(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new ye},uv2Transform:{value:new ye},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new ve(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new qt(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new qt(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new ye}},sprite:{diffuse:{value:new qt(15658734)},opacity:{value:1},center:{value:new ve(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new ye}}},sr={basic:{uniforms:Hn([or.common,or.specularmap,or.envmap,or.aomap,or.lightmap,or.fog]),vertexShader:ar.meshbasic_vert,fragmentShader:ar.meshbasic_frag},lambert:{uniforms:Hn([or.common,or.specularmap,or.envmap,or.aomap,or.lightmap,or.emissivemap,or.fog,or.lights,{emissive:{value:new qt(0)}}]),vertexShader:ar.meshlambert_vert,fragmentShader:ar.meshlambert_frag},phong:{uniforms:Hn([or.common,or.specularmap,or.envmap,or.aomap,or.lightmap,or.emissivemap,or.bumpmap,or.normalmap,or.displacementmap,or.fog,or.lights,{emissive:{value:new qt(0)},specular:{value:new qt(1118481)},shininess:{value:30}}]),vertexShader:ar.meshphong_vert,fragmentShader:ar.meshphong_frag},standard:{uniforms:Hn([or.common,or.envmap,or.aomap,or.lightmap,or.emissivemap,or.bumpmap,or.normalmap,or.displacementmap,or.roughnessmap,or.metalnessmap,or.fog,or.lights,{emissive:{value:new qt(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:ar.meshphysical_vert,fragmentShader:ar.meshphysical_frag},toon:{uniforms:Hn([or.common,or.aomap,or.lightmap,or.emissivemap,or.bumpmap,or.normalmap,or.displacementmap,or.gradientmap,or.fog,or.lights,{emissive:{value:new qt(0)}}]),vertexShader:ar.meshtoon_vert,fragmentShader:ar.meshtoon_frag},matcap:{uniforms:Hn([or.common,or.bumpmap,or.normalmap,or.displacementmap,or.fog,{matcap:{value:null}}]),vertexShader:ar.meshmatcap_vert,fragmentShader:ar.meshmatcap_frag},points:{uniforms:Hn([or.points,or.fog]),vertexShader:ar.points_vert,fragmentShader:ar.points_frag},dashed:{uniforms:Hn([or.common,or.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ar.linedashed_vert,fragmentShader:ar.linedashed_frag},depth:{uniforms:Hn([or.common,or.displacementmap]),vertexShader:ar.depth_vert,fragmentShader:ar.depth_frag},normal:{uniforms:Hn([or.common,or.bumpmap,or.normalmap,or.displacementmap,{opacity:{value:1}}]),vertexShader:ar.normal_vert,fragmentShader:ar.normal_frag},sprite:{uniforms:Hn([or.sprite,or.fog]),vertexShader:ar.sprite_vert,fragmentShader:ar.sprite_frag},background:{uniforms:{uvTransform:{value:new ye},t2D:{value:null}},vertexShader:ar.background_vert,fragmentShader:ar.background_frag},cube:{uniforms:Hn([or.envmap,{opacity:{value:1}}]),vertexShader:ar.cube_vert,fragmentShader:ar.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ar.equirect_vert,fragmentShader:ar.equirect_frag},distanceRGBA:{uniforms:Hn([or.common,or.displacementmap,{referencePosition:{value:new Te},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ar.distanceRGBA_vert,fragmentShader:ar.distanceRGBA_frag},shadow:{uniforms:Hn([or.lights,or.fog,{color:{value:new qt(0)},opacity:{value:1}}]),vertexShader:ar.shadow_vert,fragmentShader:ar.shadow_frag}};function lr(e,t,n,r,i){var a,o,s=new qt(0),l=0,u=null,c=0,h=null;function f(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,i)}return{getClearColor:function(){return s},setClearColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;s.set(e),f(s,l=t)},getClearAlpha:function(){return l},setClearAlpha:function(e){f(s,l=e)},render:function(n,i,d,p){var m=!0===i.isScene?i.background:null;m&&m.isTexture&&(m=t.get(m));var v=e.xr,y=v.getSession&&v.getSession();y&&"additive"===y.environmentBlendMode&&(m=null),null===m?f(s,l):m&&m.isColor&&(f(m,1),p=!0),(e.autoClear||p)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),m&&(m.isCubeTexture||m.isWebGLCubeRenderTarget||m.mapping===S)?(void 0===o&&((o=new Bn(new jn(1,1,1),new Wn({name:"BackgroundCubeMaterial",uniforms:Vn(sr.cube.uniforms),vertexShader:sr.cube.vertexShader,fragmentShader:sr.cube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),o.geometry.deleteAttribute("uv"),o.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(o.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(o)),m.isWebGLCubeRenderTarget&&(m=m.texture),o.material.uniforms.envMap.value=m,o.material.uniforms.flipEnvMap.value=m.isCubeTexture&&m._needsFlipEnvMap?-1:1,u===m&&c===m.version&&h===e.toneMapping||(o.material.needsUpdate=!0,u=m,c=m.version,h=e.toneMapping),n.unshift(o,o.geometry,o.material,0,0,null)):m&&m.isTexture&&(void 0===a&&((a=new Bn(new ir(2,2),new Wn({name:"BackgroundMaterial",uniforms:Vn(sr.background.uniforms),vertexShader:sr.background.vertexShader,fragmentShader:sr.background.fragmentShader,side:_,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(a.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(a)),a.material.uniforms.t2D.value=m,!0===m.matrixAutoUpdate&&m.updateMatrix(),a.material.uniforms.uvTransform.value.copy(m.matrix),u===m&&c===m.version&&h===e.toneMapping||(a.material.needsUpdate=!0,u=m,c=m.version,h=e.toneMapping),n.unshift(a,a.geometry,a.material,0,0,null))}}}function ur(e,t,n,r){var i=e.getParameter(34921),a=r.isWebGL2?null:t.get("OES_vertex_array_object"),o=r.isWebGL2||null!==a,s={},l=f(null),u=l;function c(t){return r.isWebGL2?e.bindVertexArray(t):a.bindVertexArrayOES(t)}function h(t){return r.isWebGL2?e.deleteVertexArray(t):a.deleteVertexArrayOES(t)}function f(e){for(var t=[],n=[],r=[],a=0;a<i;a++)t[a]=0,n[a]=0,r[a]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function d(){for(var e=u.newAttributes,t=0,n=e.length;t<n;t++)e[t]=0}function p(e){m(e,0)}function m(n,i){var a=u.newAttributes,o=u.enabledAttributes,s=u.attributeDivisors;(a[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),s[n]!==i)&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,i),s[n]=i)}function v(){for(var t=u.newAttributes,n=u.enabledAttributes,r=0,i=n.length;r<i;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function y(t,n,i,a,o,s){!0!==r.isWebGL2||5124!==i&&5125!==i?e.vertexAttribPointer(t,n,i,a,o,s):e.vertexAttribIPointer(t,n,i,o,s)}function g(){_(),u!==l&&c((u=l).object)}function _(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(i,l,h,g,_){var b=!1;if(o){var x=function(t,n,i){var o=!0===i.wireframe,l=s[t.id];void 0===l&&(l={},s[t.id]=l);var u=l[n.id];void 0===u&&(u={},l[n.id]=u);var c=u[o];void 0===c&&(c=f(r.isWebGL2?e.createVertexArray():a.createVertexArrayOES()),u[o]=c);return c}(g,h,l);u!==x&&c((u=x).object),(b=function(e,t){var n=u.attributes,r=e.attributes,i=0;for(var a in r){var o=n[a],s=r[a];if(void 0===o)return!0;if(o.attribute!==s)return!0;if(o.data!==s.data)return!0;i++}return u.attributesNum!==i||u.index!==t}(g,_))&&function(e,t){var n={},r=e.attributes,i=0;for(var a in r){var o=r[a],s={};s.attribute=o,o.data&&(s.data=o.data),n[a]=s,i++}u.attributes=n,u.attributesNum=i,u.index=t}(g,_)}else{var w=!0===l.wireframe;u.geometry===g.id&&u.program===h.id&&u.wireframe===w||(u.geometry=g.id,u.program=h.id,u.wireframe=w,b=!0)}!0===i.isInstancedMesh&&(b=!0),null!==_&&n.update(_,34963),b&&(!function(i,a,o,s){if(!1===r.isWebGL2&&(i.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;d();var l=s.attributes,u=o.getAttributes(),c=a.defaultAttributeValues;for(var h in u){var f=u[h];if(f>=0){var g=l[h];if(void 0!==g){var _=g.normalized,b=g.itemSize,x=n.get(g);if(void 0===x)continue;var w=x.buffer,E=x.type,S=x.bytesPerElement;if(g.isInterleavedBufferAttribute){var T=g.data,k=T.stride,M=g.offset;T&&T.isInstancedInterleavedBuffer?(m(f,T.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=T.meshPerAttribute*T.count)):p(f),e.bindBuffer(34962,w),y(f,b,E,_,k*S,M*S)}else g.isInstancedBufferAttribute?(m(f,g.meshPerAttribute),void 0===s._maxInstanceCount&&(s._maxInstanceCount=g.meshPerAttribute*g.count)):p(f),e.bindBuffer(34962,w),y(f,b,E,_,0,0)}else if("instanceMatrix"===h){var C=n.get(i.instanceMatrix);if(void 0===C)continue;var A=C.buffer,I=C.type;m(f+0,1),m(f+1,1),m(f+2,1),m(f+3,1),e.bindBuffer(34962,A),e.vertexAttribPointer(f+0,4,I,!1,64,0),e.vertexAttribPointer(f+1,4,I,!1,64,16),e.vertexAttribPointer(f+2,4,I,!1,64,32),e.vertexAttribPointer(f+3,4,I,!1,64,48)}else if("instanceColor"===h){var P=n.get(i.instanceColor);if(void 0===P)continue;var R=P.buffer,L=P.type;m(f,1),e.bindBuffer(34962,R),e.vertexAttribPointer(f,3,L,!1,12,0)}else if(void 0!==c){var O=c[h];if(void 0!==O)switch(O.length){case 2:e.vertexAttrib2fv(f,O);break;case 3:e.vertexAttrib3fv(f,O);break;case 4:e.vertexAttrib4fv(f,O);break;default:e.vertexAttrib1fv(f,O)}}}}v()}(i,l,h,g),null!==_&&e.bindBuffer(34963,n.get(_).buffer))},reset:g,resetDefaultState:_,dispose:function(){for(var e in g(),s){var t=s[e];for(var n in t){var r=t[n];for(var i in r)h(r[i].object),delete r[i];delete t[n]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0!==s[e.id]){var t=s[e.id];for(var n in t){var r=t[n];for(var i in r)h(r[i].object),delete r[i];delete t[n]}delete s[e.id]}},releaseStatesOfProgram:function(e){for(var t in s){var n=s[t];if(void 0!==n[e.id]){var r=n[e.id];for(var i in r)h(r[i].object),delete r[i];delete n[e.id]}}},initAttributes:d,enableAttribute:p,disableUnusedAttributes:v}}function cr(e,t,n,r){var i,a=r.isWebGL2;this.setMode=function(e){i=e},this.render=function(t,r){e.drawArrays(i,t,r),n.update(r,i,1)},this.renderInstances=function(r,o,s){if(0!==s){var l,u;if(a)l=e,u="drawArraysInstanced";else if(u="drawArraysInstancedANGLE",null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[u](i,r,o,s),n.update(o,i,s)}}}function hr(e,t,n){var r;function i(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var a="undefined"!==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,o=void 0!==n.precision?n.precision:"highp",s=i(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var l=!0===n.logarithmicDepthBuffer,u=e.getParameter(34930),c=e.getParameter(35660),h=e.getParameter(3379),f=e.getParameter(34076),d=e.getParameter(34921),p=e.getParameter(36347),m=e.getParameter(36348),v=e.getParameter(36349),y=c>0,g=a||!!t.get("OES_texture_float");return{isWebGL2:a,getMaxAnisotropy:function(){if(void 0!==r)return r;var n=t.get("EXT_texture_filter_anisotropic");return r=null!==n?e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:i,precision:o,logarithmicDepthBuffer:l,maxTextures:u,maxVertexTextures:c,maxTextureSize:h,maxCubemapSize:f,maxAttributes:d,maxVertexUniforms:p,maxVaryings:m,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:g,floatVertexTextures:y&&g,maxSamples:a?e.getParameter(36183):0}}function fr(e){var t=this,n=null,r=0,i=!1,a=!1,o=new Ct,s=new ye,l={value:null,needsUpdate:!1};function u(){l.value!==n&&(l.value=n,l.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function c(e,n,r,i){var a=null!==e?e.length:0,u=null;if(0!==a){if(u=l.value,!0!==i||null===u){var c=r+4*a,h=n.matrixWorldInverse;s.getNormalMatrix(h),(null===u||u.length<c)&&(u=new Float32Array(c));for(var f=0,d=r;f!==a;++f,d+=4)o.copy(e[f]).applyMatrix4(h,s),o.normal.toArray(u,d),u[d+3]=o.constant}l.value=u,l.needsUpdate=!0}return t.numPlanes=a,t.numIntersection=0,u}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,a){var o=0!==e.length||t||0!==r||i;return i=t,n=c(e,a,0),r=e.length,o},this.beginShadows=function(){a=!0,c(null)},this.endShadows=function(){a=!1,u()},this.setState=function(t,o,s){var h=t.clippingPlanes,f=t.clipIntersection,d=t.clipShadows,p=e.get(t);if(!i||null===h||0===h.length||a&&!d)a?c(null):u();else{var m=a?0:r,v=4*m,y=p.clippingState||null;l.value=y,y=c(h,o,v,s);for(var g=0;g!==v;++g)y[g]=n[g];p.clippingState=y,this.numIntersection=f?this.numPlanes:0,this.numPlanes+=m}}}function dr(e){var t=new WeakMap;function n(e,t){return 303===t?e.mapping=w:304===t&&(e.mapping=E),e}function r(e){var n=e.target;n.removeEventListener("dispose",r);var i=t.get(n);void 0!==i&&(t.delete(n),i.dispose())}return{get:function(i){if(i&&i.isTexture){var a=i.mapping;if(303===a||304===a){if(t.has(i))return n(t.get(i).texture,i.mapping);var o=i.image;if(o&&o.height>0){var s=e.getRenderList(),l=e.getRenderTarget(),u=new Jn(o.height/2);return u.fromEquirectangularTexture(e,i),t.set(i,u),e.setRenderTarget(l),e.setRenderList(s),i.addEventListener("dispose",r),n(u.texture,i.mapping)}return null}}return i},dispose:function(){t=new WeakMap}}}function pr(e){var t={};function n(n){if(void 0!==t[n])return t[n];var r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float")},get:function(e){var t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function mr(e,t,n,r){var i={},a=new WeakMap;function o(e){var s=e.target;for(var l in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[l]);s.removeEventListener("dispose",o),delete i[s.id];var u=a.get(s);u&&(t.remove(u),a.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){var n=[],r=e.index,i=e.attributes.position,o=0;if(null!==r){var s=r.array;o=r.version;for(var l=0,u=s.length;l<u;l+=3){var c=s[l+0],h=s[l+1],f=s[l+2];n.push(c,h,h,f,f,c)}}else{var d=i.array;o=i.version;for(var p=0,m=d.length/3-1;p<m;p+=3){var v=p+0,y=p+1,g=p+2;n.push(v,y,y,g,g,v)}}var _=new(hn(n)>65535?sn:an)(n,1);_.version=o;var b=a.get(e);b&&t.remove(b),a.set(e,_)}return{get:function(e,t){return!0===i[t.id]||(t.addEventListener("dispose",o),i[t.id]=!0,n.memory.geometries++),t},update:function(e){var n=e.attributes;for(var r in n)t.update(n[r],34962);var i=e.morphAttributes;for(var a in i)for(var o=i[a],s=0,l=o.length;s<l;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var t=a.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return a.get(e)}}}function vr(e,t,n,r){var i,a,o,s=r.isWebGL2;this.setMode=function(e){i=e},this.setIndex=function(e){a=e.type,o=e.bytesPerElement},this.render=function(t,r){e.drawElements(i,r,a,t*o),n.update(r,i,1)},this.renderInstances=function(r,l,u){if(0!==u){var c,h;if(s)c=e,h="drawElementsInstanced";else if(h="drawElementsInstancedANGLE",null===(c=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");c[h](i,l,a,r*o,u),n.update(l,i,u)}}}function yr(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function gr(e,t){return e[0]-t[0]}function _r(e,t){return Math.abs(t[1])-Math.abs(e[1])}function br(e){for(var t={},n=new Float32Array(8),r=[],i=0;i<8;i++)r[i]=[i,0];return{update:function(i,a,o,s){var l=i.morphTargetInfluences,u=void 0===l?0:l.length,c=t[a.id];if(void 0===c){c=[];for(var h=0;h<u;h++)c[h]=[h,0];t[a.id]=c}for(var f=0;f<u;f++){var d=c[f];d[0]=f,d[1]=l[f]}c.sort(_r);for(var p=0;p<8;p++)p<u&&c[p][1]?(r[p][0]=c[p][0],r[p][1]=c[p][1]):(r[p][0]=Number.MAX_SAFE_INTEGER,r[p][1]=0);r.sort(gr);for(var m=o.morphTargets&&a.morphAttributes.position,v=o.morphNormals&&a.morphAttributes.normal,y=0,g=0;g<8;g++){var _=r[g],b=_[0],x=_[1];b!==Number.MAX_SAFE_INTEGER&&x?(m&&a.getAttribute("morphTarget"+g)!==m[b]&&a.setAttribute("morphTarget"+g,m[b]),v&&a.getAttribute("morphNormal"+g)!==v[b]&&a.setAttribute("morphNormal"+g,v[b]),n[g]=x,y+=x):(m&&!0===a.hasAttribute("morphTarget"+g)&&a.deleteAttribute("morphTarget"+g),v&&!0===a.hasAttribute("morphNormal"+g)&&a.deleteAttribute("morphNormal"+g),n[g]=0)}var w=a.morphTargetsRelative?1:1-y;s.getUniforms().setValue(e,"morphTargetBaseInfluence",w),s.getUniforms().setValue(e,"morphTargetInfluences",n)}}}function xr(e,t,n,r){var i=new WeakMap;function a(e){var t=e.target;t.removeEventListener("dispose",a),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){var o=r.render.frame,s=e.geometry,l=t.get(e,s);return i.get(l)!==o&&(t.update(l),i.set(l,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",a)&&e.addEventListener("dispose",a),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),l},dispose:function(){i=new WeakMap}}}function wr(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;be.call(this,null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=A,this.minFilter=A,this.wrapR=M,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function Er(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;be.call(this,null),this.image={data:e,width:t,height:n,depth:r},this.magFilter=A,this.minFilter=A,this.wrapR=M,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}sr.physical={uniforms:Hn([sr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new ve(1,1)},clearcoatNormalMap:{value:null},sheen:{value:new qt(0)},transmission:{value:0},transmissionMap:{value:null}}]),vertexShader:ar.meshphysical_vert,fragmentShader:ar.meshphysical_frag},wr.prototype=Object.create(be.prototype),wr.prototype.constructor=wr,wr.prototype.isDataTexture2DArray=!0,Er.prototype=Object.create(be.prototype),Er.prototype.constructor=Er,Er.prototype.isDataTexture3D=!0;var Sr=new be,Tr=new wr,kr=new Er,Mr=new Yn,Cr=[],Ar=[],Ir=new Float32Array(16),Pr=new Float32Array(9),Rr=new Float32Array(4);function Lr(e,t,n){var r=e[0];if(r<=0||r>0)return e;var i=t*n,a=Cr[i];if(void 0===a&&(a=new Float32Array(i),Cr[i]=a),0!==t){r.toArray(a,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(a,s)}return a}function Or(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function Dr(e,t){for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}function Nr(e,t){var n=Ar[t];void 0===n&&(n=new Int32Array(t),Ar[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function zr(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function Fr(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(Or(n,t))return;e.uniform2fv(this.addr,t),Dr(n,t)}}function Br(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(Or(n,t))return;e.uniform3fv(this.addr,t),Dr(n,t)}}function Ur(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(Or(n,t))return;e.uniform4fv(this.addr,t),Dr(n,t)}}function jr(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Or(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),Dr(n,t)}else{if(Or(n,r))return;Rr.set(r),e.uniformMatrix2fv(this.addr,!1,Rr),Dr(n,r)}}function Vr(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Or(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),Dr(n,t)}else{if(Or(n,r))return;Pr.set(r),e.uniformMatrix3fv(this.addr,!1,Pr),Dr(n,r)}}function Hr(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(Or(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),Dr(n,t)}else{if(Or(n,r))return;Ir.set(r),e.uniformMatrix4fv(this.addr,!1,Ir),Dr(n,r)}}function Gr(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTexture2D(t||Sr,i)}function Wr(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture2DArray(t||Tr,i)}function qr(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.setTexture3D(t||kr,i)}function Xr(e,t,n){var r=this.cache,i=n.allocateTextureUnit();r[0]!==i&&(e.uniform1i(this.addr,i),r[0]=i),n.safeSetTextureCube(t||Mr,i)}function Zr(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function Kr(e,t){var n=this.cache;Or(n,t)||(e.uniform2iv(this.addr,t),Dr(n,t))}function Yr(e,t){var n=this.cache;Or(n,t)||(e.uniform3iv(this.addr,t),Dr(n,t))}function Jr(e,t){var n=this.cache;Or(n,t)||(e.uniform4iv(this.addr,t),Dr(n,t))}function Qr(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function $r(e,t){e.uniform1fv(this.addr,t)}function ei(e,t){e.uniform1iv(this.addr,t)}function ti(e,t){e.uniform2iv(this.addr,t)}function ni(e,t){e.uniform3iv(this.addr,t)}function ri(e,t){e.uniform4iv(this.addr,t)}function ii(e,t){var n=Lr(t,this.size,2);e.uniform2fv(this.addr,n)}function ai(e,t){var n=Lr(t,this.size,3);e.uniform3fv(this.addr,n)}function oi(e,t){var n=Lr(t,this.size,4);e.uniform4fv(this.addr,n)}function si(e,t){var n=Lr(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function li(e,t){var n=Lr(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function ui(e,t){var n=Lr(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function ci(e,t,n){var r=t.length,i=Nr(n,r);e.uniform1iv(this.addr,i);for(var a=0;a!==r;++a)n.safeSetTexture2D(t[a]||Sr,i[a])}function hi(e,t,n){var r=t.length,i=Nr(n,r);e.uniform1iv(this.addr,i);for(var a=0;a!==r;++a)n.safeSetTextureCube(t[a]||Mr,i[a])}function fi(e,t,n){this.id=e,this.addr=n,this.cache=[],this.setValue=function(e){switch(e){case 5126:return zr;case 35664:return Fr;case 35665:return Br;case 35666:return Ur;case 35674:return jr;case 35675:return Vr;case 35676:return Hr;case 5124:case 35670:return Zr;case 35667:case 35671:return Kr;case 35668:case 35672:return Yr;case 35669:case 35673:return Jr;case 5125:return Qr;case 35678:case 36198:case 36298:case 36306:case 35682:return Gr;case 35679:case 36299:case 36307:return qr;case 35680:case 36300:case 36308:case 36293:return Xr;case 36289:case 36303:case 36311:case 36292:return Wr}}(t.type)}function di(e,t,n){this.id=e,this.addr=n,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return $r;case 35664:return ii;case 35665:return ai;case 35666:return oi;case 35674:return si;case 35675:return li;case 35676:return ui;case 5124:case 35670:return ei;case 35667:case 35671:return ti;case 35668:case 35672:return ni;case 35669:case 35673:return ri;case 35678:case 36198:case 36298:case 36306:case 35682:return ci;case 35680:case 36300:case 36308:case 36293:return hi}}(t.type)}function pi(e){this.id=e,this.seq=[],this.map={}}di.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Dr(t,e)},pi.prototype.setValue=function(e,t,n){for(var r=this.seq,i=0,a=r.length;i!==a;++i){var o=r[i];o.setValue(e,t[o.id],n)}};var mi=/(\w+)(\])?(\[|\.)?/g;function vi(e,t){e.seq.push(t),e.map[t.id]=t}function yi(e,t,n){var r=e.name,i=r.length;for(mi.lastIndex=0;;){var a=mi.exec(r),o=mi.lastIndex,s=a[1],l="]"===a[2],u=a[3];if(l&&(s|=0),void 0===u||"["===u&&o+2===i){vi(n,void 0===u?new fi(s,e,t):new di(s,e,t));break}var c=n.map[s];void 0===c&&vi(n,c=new pi(s)),n=c}}function gi(e,t){this.seq=[],this.map={};for(var n=e.getProgramParameter(t,35718),r=0;r<n;++r){var i=e.getActiveUniform(t,r);yi(i,e.getUniformLocation(t,i.name),this)}}function _i(e,t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}gi.prototype.setValue=function(e,t,n,r){var i=this.map[t];void 0!==i&&i.setValue(e,n,r)},gi.prototype.setOptional=function(e,t,n){var r=t[n];void 0!==r&&this.setValue(e,n,r)},gi.upload=function(e,t,n,r){for(var i=0,a=t.length;i!==a;++i){var o=t[i],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,r)}},gi.seqWithValue=function(e,t){for(var n=[],r=0,i=e.length;r!==i;++r){var a=e[r];a.id in t&&n.push(a)}return n};var bi=0;function xi(e){switch(e){case te:return["Linear","( value )"];case ne:return["sRGB","( value )"];case ie:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case re:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case 3003:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function wi(e,t,n){var r=e.getShaderParameter(t,35713),i=e.getShaderInfoLog(t).trim();return r&&""===i?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+n+"\n"+i+function(e){for(var t=e.split("\n"),n=0;n<t.length;n++)t[n]=n+1+": "+t[n];return t.join("\n")}(e.getShaderSource(t))}function Ei(e,t){var n=xi(t);return"vec4 "+e+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"}function Si(e,t){var n=xi(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function Ti(e,t){var n;switch(t){case 1:n="Linear";break;case 2:n="Reinhard";break;case 3:n="OptimizedCineon";break;case 4:n="ACESFilmic";break;case 5:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function ki(e){return""!==e}function Mi(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Ci(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var Ai=/^[ \t]*#include +<([\w\d./]+)>/gm;function Ii(e){return e.replace(Ai,Pi)}function Pi(e,t){var n=ar[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return Ii(n)}var Ri=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,Li=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function Oi(e){return e.replace(Li,Ni).replace(Ri,Di)}function Di(e,t,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),Ni(e,t,n,r)}function Ni(e,t,n,r){for(var i="",a=parseInt(t);a<parseInt(n);a++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+a+" ]").replace(/UNROLLED_LOOP_INDEX/g,a);return i}function zi(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function Fi(e,t,n,r){var i,a,o=e.getContext(),s=n.defines,l=n.vertexShader,u=n.fragmentShader,c=function(e){var t="SHADOWMAP_TYPE_BASIC";return 1===e.shadowMapType?t="SHADOWMAP_TYPE_PCF":2===e.shadowMapType?t="SHADOWMAP_TYPE_PCF_SOFT":3===e.shadowMapType&&(t="SHADOWMAP_TYPE_VSM"),t}(n),h=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case w:case E:t="ENVMAP_TYPE_CUBE";break;case S:case T:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),f=function(e){var t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case E:case T:t="ENVMAP_MODE_REFRACTION"}return t}(n),d=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case 0:t="ENVMAP_BLENDING_MULTIPLY";break;case 1:t="ENVMAP_BLENDING_MIX";break;case 2:t="ENVMAP_BLENDING_ADD"}return t}(n),p=e.gammaFactor>0?e.gammaFactor:1,m=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(ki).join("\n")}(n),v=function(e){var t=[];for(var n in e){var r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(s),y=o.createProgram(),g=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((i=[v].filter(ki).join("\n")).length>0&&(i+="\n"),(a=[m,v].filter(ki).join("\n")).length>0&&(a+="\n")):(i=[zi(n),"#define SHADER_NAME "+n.shaderName,v,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+p,"#define MAX_BONES "+n.maxBones,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(ki).join("\n"),a=[m,zi(n),"#define SHADER_NAME "+n.shaderName,v,n.alphaTest?"#define ALPHATEST "+n.alphaTest+(n.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+p,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+f:"",n.envMap?"#define "+d:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.sheen?"#define USE_SHEEN":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+c:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(n.extensionShaderTextureLOD||n.envMap)&&n.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==n.toneMapping?"#define TONE_MAPPING":"",0!==n.toneMapping?ar.tonemapping_pars_fragment:"",0!==n.toneMapping?Ti("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",ar.encodings_pars_fragment,n.map?Ei("mapTexelToLinear",n.mapEncoding):"",n.matcap?Ei("matcapTexelToLinear",n.matcapEncoding):"",n.envMap?Ei("envMapTexelToLinear",n.envMapEncoding):"",n.emissiveMap?Ei("emissiveMapTexelToLinear",n.emissiveMapEncoding):"",n.lightMap?Ei("lightMapTexelToLinear",n.lightMapEncoding):"",Si("linearToOutputTexel",n.outputEncoding),n.depthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(ki).join("\n")),l=Ci(l=Mi(l=Ii(l),n),n),u=Ci(u=Mi(u=Ii(u),n),n),l=Oi(l),u=Oi(u),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(g="#version 300 es\n",i=["#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+i,a=["#define varying in",n.glslVersion===ue?"":"out highp vec4 pc_fragColor;",n.glslVersion===ue?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+a);var _,b,x=g+a+u,k=_i(o,35633,g+i+l),M=_i(o,35632,x);if(o.attachShader(y,k),o.attachShader(y,M),void 0!==n.index0AttributeName?o.bindAttribLocation(y,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(y,0,"position"),o.linkProgram(y),e.debug.checkShaderErrors){var C=o.getProgramInfoLog(y).trim(),A=o.getShaderInfoLog(k).trim(),I=o.getShaderInfoLog(M).trim(),P=!0,R=!0;if(!1===o.getProgramParameter(y,35714)){P=!1;var L=wi(o,k,"vertex"),O=wi(o,M,"fragment");console.error("THREE.WebGLProgram: shader error: ",o.getError(),"35715",o.getProgramParameter(y,35715),"gl.getProgramInfoLog",C,L,O)}else""!==C?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",C):""!==A&&""!==I||(R=!1);R&&(this.diagnostics={runnable:P,programLog:C,vertexShader:{log:A,prefix:i},fragmentShader:{log:I,prefix:a}})}return o.deleteShader(k),o.deleteShader(M),this.getUniforms=function(){return void 0===_&&(_=new gi(o,y)),_},this.getAttributes=function(){return void 0===b&&(b=function(e,t){for(var n={},r=e.getProgramParameter(t,35721),i=0;i<r;i++){var a=e.getActiveAttrib(t,i).name;n[a]=e.getAttribLocation(t,a)}return n}(o,y)),b},this.destroy=function(){r.releaseStatesOfProgram(this),o.deleteProgram(y),this.program=void 0},this.name=n.shaderName,this.id=bi++,this.cacheKey=t,this.usedTimes=1,this.program=y,this.vertexShader=k,this.fragmentShader=M,this}function Bi(e,t,n,r,i,a){var o=[],s=r.isWebGL2,l=r.logarithmicDepthBuffer,u=r.floatVertexTextures,c=r.maxVertexUniforms,h=r.vertexTextures,f=r.precision,d={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},p=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen","transmissionMap"];function m(e){var t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=te,t}return{getParameters:function(i,o,p,v,y){var g,_,x=v.fog,w=i.isMeshStandardMaterial?v.environment:null,E=t.get(i.envMap||w),k=d[i.type],M=y.isSkinnedMesh?function(e){var t=e.skeleton.bones;if(u)return 1024;var n=c,r=Math.floor((n-20)/4),i=Math.min(r,t.length);return i<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+i+"."),0):i}(y):0;if(null!==i.precision&&(f=r.getMaxPrecision(i.precision))!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",f,"instead."),k){var C=sr[k];g=C.vertexShader,_=C.fragmentShader}else g=i.vertexShader,_=i.fragmentShader;var A=e.getRenderTarget();return{isWebGL2:s,shaderID:k,shaderName:i.type,vertexShader:g,fragmentShader:_,defines:i.defines,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:f,instancing:!0===y.isInstancedMesh,instancingColor:!0===y.isInstancedMesh&&null!==y.instanceColor,supportsVertexTextures:h,outputEncoding:null!==A?m(A.texture):e.outputEncoding,map:!!i.map,mapEncoding:m(i.map),matcap:!!i.matcap,matcapEncoding:m(i.matcap),envMap:!!E,envMapMode:E&&E.mapping,envMapEncoding:m(E),envMapCubeUV:!!E&&(E.mapping===S||E.mapping===T),lightMap:!!i.lightMap,lightMapEncoding:m(i.lightMap),aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,emissiveMapEncoding:m(i.emissiveMap),bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:1===i.normalMapType,tangentSpaceNormalMap:i.normalMapType===ae,clearcoatMap:!!i.clearcoatMap,clearcoatRoughnessMap:!!i.clearcoatRoughnessMap,clearcoatNormalMap:!!i.clearcoatNormalMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,alphaMap:!!i.alphaMap,gradientMap:!!i.gradientMap,sheen:!!i.sheen,transmissionMap:!!i.transmissionMap,combine:i.combine,vertexTangents:i.normalMap&&i.vertexTangents,vertexColors:i.vertexColors,vertexUvs:!!i.map||!!i.bumpMap||!!i.normalMap||!!i.specularMap||!!i.alphaMap||!!i.emissiveMap||!!i.roughnessMap||!!i.metalnessMap||!!i.clearcoatMap||!!i.clearcoatRoughnessMap||!!i.clearcoatNormalMap||!!i.displacementMap||!!i.transmissionMap,uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||i.transmissionMap)&&!!i.displacementMap,fog:!!x,useFog:i.fog,fogExp2:x&&x.isFogExp2,flatShading:i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:l,skinning:i.skinning&&M>0,maxBones:M,useVertexTexture:u,morphTargets:i.morphTargets,morphNormals:i.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:o.directional.length,numPointLights:o.point.length,numSpotLights:o.spot.length,numRectAreaLights:o.rectArea.length,numHemiLights:o.hemi.length,numDirLightShadows:o.directionalShadowMap.length,numPointLightShadows:o.pointShadowMap.length,numSpotLightShadows:o.spotShadowMap.length,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:i.dithering,shadowMapEnabled:e.shadowMap.enabled&&p.length>0,shadowMapType:e.shadowMap.type,toneMapping:i.toneMapped?e.toneMapping:0,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,alphaTest:i.alphaTest,doubleSided:i.side===b,flipSided:1===i.side,depthPacking:void 0!==i.depthPacking&&i.depthPacking,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:s||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:s||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:s||n.has("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.fragmentShader),n.push(t.vertexShader)),void 0!==t.defines)for(var r in t.defines)n.push(r),n.push(t.defines[r]);if(!1===t.isRawShaderMaterial){for(var i=0;i<p.length;i++)n.push(t[p[i]]);n.push(e.outputEncoding),n.push(e.gammaFactor)}return n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){var t,n=d[e.type];if(n){var r=sr[n];t=Gn.clone(r.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,n){for(var r,a=0,s=o.length;a<s;a++){var l=o[a];if(l.cacheKey===n){++(r=l).usedTimes;break}}return void 0===r&&(r=new Fi(e,n,t,i),o.push(r)),r},releaseProgram:function(e){if(0===--e.usedTimes){var t=o.indexOf(e);o[t]=o[o.length-1],o.pop(),e.destroy()}},programs:o}}function Ui(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function ji(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function Vi(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function Hi(e){var t=[],n=0,r=[],i=[],a={id:-1};function o(r,i,o,s,l,u){var c=t[n],h=e.get(o);return void 0===c?(c={id:r.id,object:r,geometry:i,material:o,program:h.program||a,groupOrder:s,renderOrder:r.renderOrder,z:l,group:u},t[n]=c):(c.id=r.id,c.object=r,c.geometry=i,c.material=o,c.program=h.program||a,c.groupOrder=s,c.renderOrder=r.renderOrder,c.z=l,c.group=u),n++,c}return{opaque:r,transparent:i,init:function(){n=0,r.length=0,i.length=0},push:function(e,t,n,a,s,l){var u=o(e,t,n,a,s,l);(!0===n.transparent?i:r).push(u)},unshift:function(e,t,n,a,s,l){var u=o(e,t,n,a,s,l);(!0===n.transparent?i:r).unshift(u)},finish:function(){for(var e=n,r=t.length;e<r;e++){var i=t[e];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(e,t){r.length>1&&r.sort(e||ji),i.length>1&&i.sort(t||Vi)}}}function Gi(e){var t=new WeakMap;return{get:function(n,r){var i,a=t.get(n);return void 0===a?(i=new Hi(e),t.set(n,new WeakMap),t.get(n).set(r,i)):void 0===(i=a.get(r))&&(i=new Hi(e),a.set(r,i)),i},dispose:function(){t=new WeakMap}}}function Wi(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new Te,color:new qt};break;case"SpotLight":n={position:new Te,direction:new Te,color:new qt,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Te,color:new qt,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Te,skyColor:new qt,groundColor:new qt};break;case"RectAreaLight":n={color:new qt,position:new Te,halfWidth:new Te,halfHeight:new Te}}return e[t.id]=n,n}}}var qi=0;function Xi(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Zi(e,t){for(var n=new Wi,r=function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ve};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new ve,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},a=0;a<9;a++)i.probe.push(new Te);var o=new Te,s=new $e,l=new $e;return{setup:function(a){for(var o=0,s=0,l=0,u=0;u<9;u++)i.probe[u].set(0,0,0);var c=0,h=0,f=0,d=0,p=0,m=0,v=0,y=0;a.sort(Xi);for(var g=0,_=a.length;g<_;g++){var b=a[g],x=b.color,w=b.intensity,E=b.distance,S=b.shadow&&b.shadow.map?b.shadow.map.texture:null;if(b.isAmbientLight)o+=x.r*w,s+=x.g*w,l+=x.b*w;else if(b.isLightProbe)for(var T=0;T<9;T++)i.probe[T].addScaledVector(b.sh.coefficients[T],w);else if(b.isDirectionalLight){var k=n.get(b);if(k.color.copy(b.color).multiplyScalar(b.intensity),b.castShadow){var M=b.shadow,C=r.get(b);C.shadowBias=M.bias,C.shadowNormalBias=M.normalBias,C.shadowRadius=M.radius,C.shadowMapSize=M.mapSize,i.directionalShadow[c]=C,i.directionalShadowMap[c]=S,i.directionalShadowMatrix[c]=b.shadow.matrix,m++}i.directional[c]=k,c++}else if(b.isSpotLight){var A=n.get(b);if(A.position.setFromMatrixPosition(b.matrixWorld),A.color.copy(x).multiplyScalar(w),A.distance=E,A.coneCos=Math.cos(b.angle),A.penumbraCos=Math.cos(b.angle*(1-b.penumbra)),A.decay=b.decay,b.castShadow){var I=b.shadow,P=r.get(b);P.shadowBias=I.bias,P.shadowNormalBias=I.normalBias,P.shadowRadius=I.radius,P.shadowMapSize=I.mapSize,i.spotShadow[f]=P,i.spotShadowMap[f]=S,i.spotShadowMatrix[f]=b.shadow.matrix,y++}i.spot[f]=A,f++}else if(b.isRectAreaLight){var R=n.get(b);R.color.copy(x).multiplyScalar(w),R.halfWidth.set(.5*b.width,0,0),R.halfHeight.set(0,.5*b.height,0),i.rectArea[d]=R,d++}else if(b.isPointLight){var L=n.get(b);if(L.color.copy(b.color).multiplyScalar(b.intensity),L.distance=b.distance,L.decay=b.decay,b.castShadow){var O=b.shadow,D=r.get(b);D.shadowBias=O.bias,D.shadowNormalBias=O.normalBias,D.shadowRadius=O.radius,D.shadowMapSize=O.mapSize,D.shadowCameraNear=O.camera.near,D.shadowCameraFar=O.camera.far,i.pointShadow[h]=D,i.pointShadowMap[h]=S,i.pointShadowMatrix[h]=b.shadow.matrix,v++}i.point[h]=L,h++}else if(b.isHemisphereLight){var N=n.get(b);N.skyColor.copy(b.color).multiplyScalar(w),N.groundColor.copy(b.groundColor).multiplyScalar(w),i.hemi[p]=N,p++}}d>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(i.rectAreaLTC1=or.LTC_FLOAT_1,i.rectAreaLTC2=or.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(i.rectAreaLTC1=or.LTC_HALF_1,i.rectAreaLTC2=or.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),i.ambient[0]=o,i.ambient[1]=s,i.ambient[2]=l;var z=i.hash;z.directionalLength===c&&z.pointLength===h&&z.spotLength===f&&z.rectAreaLength===d&&z.hemiLength===p&&z.numDirectionalShadows===m&&z.numPointShadows===v&&z.numSpotShadows===y||(i.directional.length=c,i.spot.length=f,i.rectArea.length=d,i.point.length=h,i.hemi.length=p,i.directionalShadow.length=m,i.directionalShadowMap.length=m,i.pointShadow.length=v,i.pointShadowMap.length=v,i.spotShadow.length=y,i.spotShadowMap.length=y,i.directionalShadowMatrix.length=m,i.pointShadowMatrix.length=v,i.spotShadowMatrix.length=y,z.directionalLength=c,z.pointLength=h,z.spotLength=f,z.rectAreaLength=d,z.hemiLength=p,z.numDirectionalShadows=m,z.numPointShadows=v,z.numSpotShadows=y,i.version=qi++)},setupView:function(e,t){for(var n=0,r=0,a=0,u=0,c=0,h=t.matrixWorldInverse,f=0,d=e.length;f<d;f++){var p=e[f];if(p.isDirectionalLight){var m=i.directional[n];m.direction.setFromMatrixPosition(p.matrixWorld),o.setFromMatrixPosition(p.target.matrixWorld),m.direction.sub(o),m.direction.transformDirection(h),n++}else if(p.isSpotLight){var v=i.spot[a];v.position.setFromMatrixPosition(p.matrixWorld),v.position.applyMatrix4(h),v.direction.setFromMatrixPosition(p.matrixWorld),o.setFromMatrixPosition(p.target.matrixWorld),v.direction.sub(o),v.direction.transformDirection(h),a++}else if(p.isRectAreaLight){var y=i.rectArea[u];y.position.setFromMatrixPosition(p.matrixWorld),y.position.applyMatrix4(h),l.identity(),s.copy(p.matrixWorld),s.premultiply(h),l.extractRotation(s),y.halfWidth.set(.5*p.width,0,0),y.halfHeight.set(0,.5*p.height,0),y.halfWidth.applyMatrix4(l),y.halfHeight.applyMatrix4(l),u++}else if(p.isPointLight){var g=i.point[r];g.position.setFromMatrixPosition(p.matrixWorld),g.position.applyMatrix4(h),r++}else if(p.isHemisphereLight){var _=i.hemi[c];_.direction.setFromMatrixPosition(p.matrixWorld),_.direction.transformDirection(h),_.direction.normalize(),c++}}},state:i}}function Ki(e,t){var n=new Zi(e,t),r=[],i=[];return{init:function(){r.length=0,i.length=0},state:{lightsArray:r,shadowsArray:i,lights:n},setupLights:function(){n.setup(r)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){i.push(e)}}}function Yi(e,t){var n=new WeakMap;return{get:function(r){var i,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!1===n.has(r)?(i=new Ki(e,t),n.set(r,[]),n.get(r).push(i)):a>=n.get(r).length?(i=new Ki(e,t),n.get(r).push(i)):i=n.get(r)[a],i},dispose:function(){n=new WeakMap}}}function Ji(e){Kt.call(this),this.type="MeshDepthMaterial",this.depthPacking=3200,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function Qi(e){Kt.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Te,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}Ji.prototype=Object.create(Kt.prototype),Ji.prototype.constructor=Ji,Ji.prototype.isMeshDepthMaterial=!0,Ji.prototype.copy=function(e){return Kt.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},Qi.prototype=Object.create(Kt.prototype),Qi.prototype.constructor=Qi,Qi.prototype.isMeshDistanceMaterial=!0,Qi.prototype.copy=function(e){return Kt.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};function $i(e,t,n){var r=new tr,i=new ve,a=new ve,o=new we,s=[],l=[],u={},c={0:1,1:_,2:b},h=new Wn({defines:{SAMPLE_RATE:2/8,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new ve},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy ) / resolution ) );\n\tfor ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, i ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean * HALF_SAMPLE_RATE;\n\tsquared_mean = squared_mean * HALF_SAMPLE_RATE;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=h.clone();f.defines.HORIZONTAL_PASS=1;var d=new xn;d.setAttribute("position",new $t(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var p=new Bn(d,h),m=this;function v(n,r){var i=t.update(p);h.uniforms.shadow_pass.value=n.map.texture,h.uniforms.resolution.value=n.mapSize,h.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,h,p,null),f.uniforms.shadow_pass.value=n.mapPass.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,f,p,null)}function y(e,t,n){var r=e<<0|t<<1|n<<2,i=s[r];return void 0===i&&(i=new Ji({depthPacking:3201,morphTargets:e,skinning:t}),s[r]=i),i}function g(e,t,n){var r=e<<0|t<<1|n<<2,i=l[r];return void 0===i&&(i=new Qi({morphTargets:e,skinning:t}),l[r]=i),i}function x(t,n,r,i,a,o,s){var l=null,h=y,f=t.customDepthMaterial;if(!0===i.isPointLight&&(h=g,f=t.customDistanceMaterial),void 0===f){var d=!1;!0===r.morphTargets&&(d=n.morphAttributes&&n.morphAttributes.position&&n.morphAttributes.position.length>0);var p=!1;!0===t.isSkinnedMesh&&(!0===r.skinning?p=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",t)),l=h(d,p,!0===t.isInstancedMesh)}else l=f;if(e.localClippingEnabled&&!0===r.clipShadows&&0!==r.clippingPlanes.length){var m=l.uuid,v=r.uuid,_=u[m];void 0===_&&(_={},u[m]=_);var b=_[v];void 0===b&&(b=l.clone(),_[v]=b),l=b}return l.visible=r.visible,l.wireframe=r.wireframe,l.side=3===s?null!==r.shadowSide?r.shadowSide:r.side:null!==r.shadowSide?r.shadowSide:c[r.side],l.clipShadows=r.clipShadows,l.clippingPlanes=r.clippingPlanes,l.clipIntersection=r.clipIntersection,l.wireframeLinewidth=r.wireframeLinewidth,l.linewidth=r.linewidth,!0===i.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(i.matrixWorld),l.nearDistance=a,l.farDistance=o),l}function w(n,i,a,o,s){if(!1!==n.visible){if(n.layers.test(i.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&3===s)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(a.matrixWorldInverse,n.matrixWorld);var l=t.update(n),u=n.material;if(Array.isArray(u))for(var c=l.groups,h=0,f=c.length;h<f;h++){var d=c[h],p=u[d.materialIndex];if(p&&p.visible){var m=x(n,l,p,o,a.near,a.far,s);e.renderBufferDirect(a,null,l,m,n,d)}}else if(u.visible){var v=x(n,l,u,o,a.near,a.far,s);e.renderBufferDirect(a,null,l,v,n,null)}}for(var y=n.children,g=0,_=y.length;g<_;g++)w(y[g],i,a,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(t,s,l){if(!1!==m.enabled&&(!1!==m.autoUpdate||!1!==m.needsUpdate)&&0!==t.length){var u=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),f=e.state;f.setBlending(0),f.buffers.color.setClear(1,1,1,1),f.buffers.depth.setTest(!0),f.setScissorTest(!1);for(var d=0,p=t.length;d<p;d++){var y=t[d],g=y.shadow;if(void 0!==g){if(!1!==g.autoUpdate||!1!==g.needsUpdate){i.copy(g.mapSize);var _=g.getFrameExtents();if(i.multiply(_),a.copy(g.mapSize),(i.x>n||i.y>n)&&(i.x>n&&(a.x=Math.floor(n/_.x),i.x=a.x*_.x,g.mapSize.x=a.x),i.y>n&&(a.y=Math.floor(n/_.y),i.y=a.y*_.y,g.mapSize.y=a.y)),null===g.map&&!g.isPointLightShadow&&3===this.type){var b={minFilter:R,magFilter:R,format:V};g.map=new Ee(i.x,i.y,b),g.map.texture.name=y.name+".shadowMap",g.mapPass=new Ee(i.x,i.y,b),g.camera.updateProjectionMatrix()}if(null===g.map){var x={minFilter:A,magFilter:A,format:V};g.map=new Ee(i.x,i.y,x),g.map.texture.name=y.name+".shadowMap",g.camera.updateProjectionMatrix()}e.setRenderTarget(g.map),e.clear();for(var E=g.getViewportCount(),S=0;S<E;S++){var T=g.getViewport(S);o.set(a.x*T.x,a.y*T.y,a.x*T.z,a.y*T.w),f.viewport(o),g.updateMatrices(y,S),r=g.getFrustum(),w(s,l,g.camera,y,this.type)}g.isPointLightShadow||3!==this.type||v(g,l),g.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",y,"has no shadow.")}m.needsUpdate=!1,e.setRenderTarget(u,c,h)}}}function ea(e,t,n){var r,i,a=n.isWebGL2;var o=new function(){var t=!1,n=new we,r=null,i=new we(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,a,o,s){!0===s&&(t*=o,r*=o,a*=o),n.set(t,r,a,o),!1===i.equals(n)&&(e.clearColor(t,r,a,o),i.copy(n))},reset:function(){t=!1,r=null,i.set(-1,0,0,0)}}},s=new function(){var t=!1,n=null,r=null,i=null;return{setTest:function(e){e?F(2929):B(2929)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case 0:e.depthFunc(512);break;case 1:e.depthFunc(519);break;case 2:e.depthFunc(513);break;case 3:e.depthFunc(515);break;case 4:e.depthFunc(514);break;case 5:e.depthFunc(518);break;case 6:e.depthFunc(516);break;case 7:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){i!==t&&(e.clearDepth(t),i=t)},reset:function(){t=!1,n=null,r=null,i=null}}},l=new function(){var t=!1,n=null,r=null,i=null,a=null,o=null,s=null,l=null,u=null;return{setTest:function(e){t||(e?F(2960):B(2960))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,o){r===t&&i===n&&a===o||(e.stencilFunc(t,n,o),r=t,i=n,a=o)},setOp:function(t,n,r){o===t&&s===n&&l===r||(e.stencilOp(t,n,r),o=t,s=n,l=r)},setLocked:function(e){t=e},setClear:function(t){u!==t&&(e.clearStencil(t),u=t)},reset:function(){t=!1,n=null,r=null,i=null,a=null,o=null,s=null,l=null,u=null}}},u={},h=null,f=null,d=null,p=null,m=null,v=null,y=null,g=null,_=null,w=!1,E=null,S=null,T=null,k=null,M=null,C=e.getParameter(35661),A=!1,I=0,P=e.getParameter(7938);-1!==P.indexOf("WebGL")?(I=parseFloat(/^WebGL (\d)/.exec(P)[1]),A=I>=1):-1!==P.indexOf("OpenGL ES")&&(I=parseFloat(/^OpenGL ES (\d)/.exec(P)[1]),A=I>=2);var R=null,L={},O=new we,D=new we;function N(t,n,r){var i=new Uint8Array(4),a=e.createTexture();e.bindTexture(t,a),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<r;o++)e.texImage2D(n+o,0,6408,1,1,0,6408,5121,i);return a}var z={};function F(t){!0!==u[t]&&(e.enable(t),u[t]=!0)}function B(t){!1!==u[t]&&(e.disable(t),u[t]=!1)}z[3553]=N(3553,3553,1),z[34067]=N(34067,34069,6),o.setClear(0,0,0,1),s.setClear(1),l.setClear(0),F(2929),s.setFunc(3),G(!1),W(1),F(2884),H(0);var U=(c(r={},x,32774),c(r,101,32778),c(r,102,32779),r);if(a)U[103]=32775,U[104]=32776;else{var j=t.get("EXT_blend_minmax");null!==j&&(U[103]=j.MIN_EXT,U[104]=j.MAX_EXT)}var V=(c(i={},200,0),c(i,201,1),c(i,202,768),c(i,204,770),c(i,210,776),c(i,208,774),c(i,206,772),c(i,203,769),c(i,205,771),c(i,209,775),c(i,207,773),i);function H(t,n,r,i,a,o,s,l){if(0!==t){if(f||(F(3042),f=!0),5===t)a=a||n,o=o||r,s=s||i,n===p&&a===y||(e.blendEquationSeparate(U[n],U[a]),p=n,y=a),r===m&&i===v&&o===g&&s===_||(e.blendFuncSeparate(V[r],V[i],V[o],V[s]),m=r,v=i,g=o,_=s),d=t,w=null;else if(t!==d||l!==w){if(p===x&&y===x||(e.blendEquation(32774),p=x,y=x),l)switch(t){case 1:e.blendFuncSeparate(1,771,1,771);break;case 2:e.blendFunc(1,1);break;case 3:e.blendFuncSeparate(0,0,769,771);break;case 4:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case 1:e.blendFuncSeparate(770,771,1,771);break;case 2:e.blendFunc(770,1);break;case 3:e.blendFunc(0,769);break;case 4:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}m=null,v=null,g=null,_=null,d=t,w=l}}else f&&(B(3042),f=!1)}function G(t){E!==t&&(t?e.frontFace(2304):e.frontFace(2305),E=t)}function W(t){0!==t?(F(2884),t!==S&&(1===t?e.cullFace(1029):2===t?e.cullFace(1028):e.cullFace(1032))):B(2884),S=t}function q(t,n,r){t?(F(32823),k===n&&M===r||(e.polygonOffset(n,r),k=n,M=r)):B(32823)}function X(t){void 0===t&&(t=33984+C-1),R!==t&&(e.activeTexture(t),R=t)}return{buffers:{color:o,depth:s,stencil:l},enable:F,disable:B,useProgram:function(t){return h!==t&&(e.useProgram(t),h=t,!0)},setBlending:H,setMaterial:function(e,t){e.side===b?B(2884):F(2884);var n=1===e.side;t&&(n=!n),G(n),1===e.blending&&!1===e.transparent?H(0):H(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),o.setMask(e.colorWrite);var r=e.stencilWrite;l.setTest(r),r&&(l.setMask(e.stencilWriteMask),l.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),l.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),q(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits)},setFlipSided:G,setCullFace:W,setLineWidth:function(t){t!==T&&(A&&e.lineWidth(t),T=t)},setPolygonOffset:q,setScissorTest:function(e){e?F(3089):B(3089)},activeTexture:X,bindTexture:function(t,n){null===R&&X();var r=L[R];void 0===r&&(r={type:void 0,texture:void 0},L[R]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||z[t]),r.type=t,r.texture=n)},unbindTexture:function(){var t=L[R];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===O.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),O.copy(t))},viewport:function(t){!1===D.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),D.copy(t))},reset:function(){u={},R=null,L={},h=null,f=null,d=null,p=null,m=null,v=null,y=null,g=null,_=null,w=!1,E=null,S=null,T=null,k=null,M=null,o.reset(),s.reset(),l.reset()}}}function ta(e,t,n,r,i,a,o){var s,l,u,h=i.isWebGL2,f=i.maxTextures,d=i.maxCubemapSize,p=i.maxTextureSize,m=i.maxSamples,v=new WeakMap,y=!1;try{y="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(ae){}function g(e,t){return y?new OffscreenCanvas(e,t):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function _(e,t,n,r){var i=1;if((e.width>r||e.height>r)&&(i=r/Math.max(e.width,e.height)),i<1||!0===t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var a=t?me.floorPowerOfTwo:Math.floor,o=a(i*e.width),s=a(i*e.height);void 0===u&&(u=g(o,s));var l=n?g(o,s):u;return l.width=o,l.height=s,l.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),l}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function b(e){return me.isPowerOfTwo(e.width)&&me.isPowerOfTwo(e.height)}function x(e,t){return e.generateMipmaps&&t&&e.minFilter!==A&&e.minFilter!==R}function w(t,n,i,a){e.generateMipmap(t),r.get(n).__maxMipLevel=Math.log(Math.max(i,a))*Math.LOG2E}function E(n,r,i){if(!1===h)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var a=r;return 6403===r&&(5126===i&&(a=33326),5131===i&&(a=33325),5121===i&&(a=33321)),6407===r&&(5126===i&&(a=34837),5131===i&&(a=34843),5121===i&&(a=32849)),6408===r&&(5126===i&&(a=34836),5131===i&&(a=34842),5121===i&&(a=32856)),33325!==a&&33326!==a&&34842!==a&&34836!==a||t.get("EXT_color_buffer_float"),a}function S(e){return e===A||e===I||e===P?9728:9729}function T(t){var n=t.target;n.removeEventListener("dispose",T),function(t){var n=r.get(t);if(void 0===n.__webglInit)return;e.deleteTexture(n.__webglTexture),r.remove(t)}(n),n.isVideoTexture&&v.delete(n),o.memory.textures--}function D(t){var n=t.target;n.removeEventListener("dispose",D),function(t){var n=r.get(t),i=r.get(t.texture);if(!t)return;void 0!==i.__webglTexture&&e.deleteTexture(i.__webglTexture);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(var a=0;a<6;a++)e.deleteFramebuffer(n.__webglFramebuffer[a]),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer[a]);else e.deleteFramebuffer(n.__webglFramebuffer),n.__webglDepthbuffer&&e.deleteRenderbuffer(n.__webglDepthbuffer),n.__webglMultisampledFramebuffer&&e.deleteFramebuffer(n.__webglMultisampledFramebuffer),n.__webglColorRenderbuffer&&e.deleteRenderbuffer(n.__webglColorRenderbuffer),n.__webglDepthRenderbuffer&&e.deleteRenderbuffer(n.__webglDepthRenderbuffer);r.remove(t.texture),r.remove(t)}(n),o.memory.textures--}var W=0;function q(e,t){var i=r.get(e);if(e.isVideoTexture&&function(e){var t=o.render.frame;v.get(e)!==t&&(v.set(e,t),e.update())}(e),e.version>0&&i.__version!==e.version){var a=e.image;if(void 0===a)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==a.complete)return void Q(i,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,i.__webglTexture)}function X(t,i){var o=r.get(t);t.version>0&&o.__version!==t.version?function(t,r,i){if(6!==r.image.length)return;J(t,r),n.activeTexture(33984+i),n.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment);for(var o=r&&(r.isCompressedTexture||r.image[0].isCompressedTexture),s=r.image[0]&&r.image[0].isDataTexture,l=[],u=0;u<6;u++)l[u]=o||s?s?r.image[u].image:r.image[u]:_(r.image[u],!1,!0,d);var c,f=l[0],p=b(f)||h,m=a.convert(r.format),v=a.convert(r.type),y=E(r.internalFormat,m,v);if(Y(34067,r,p),o){for(var g=0;g<6;g++){c=l[g].mipmaps;for(var S=0;S<c.length;S++){var T=c[S];r.format!==V&&r.format!==j?null!==m?n.compressedTexImage2D(34069+g,S,y,T.width,T.height,0,T.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):n.texImage2D(34069+g,S,y,T.width,T.height,0,m,v,T.data)}}t.__maxMipLevel=c.length-1}else{c=r.mipmaps;for(var k=0;k<6;k++)if(s){n.texImage2D(34069+k,0,y,l[k].width,l[k].height,0,m,v,l[k].data);for(var M=0;M<c.length;M++){var C=c[M].image[k].image;n.texImage2D(34069+k,M+1,y,C.width,C.height,0,m,v,C.data)}}else{n.texImage2D(34069+k,0,y,m,v,l[k]);for(var A=0;A<c.length;A++){var I=c[A];n.texImage2D(34069+k,A+1,y,m,v,I.image[k])}}t.__maxMipLevel=c.length}x(r,p)&&w(34067,r,f.width,f.height);t.__version=r.version,r.onUpdate&&r.onUpdate(r)}(o,t,i):(n.activeTexture(33984+i),n.bindTexture(34067,o.__webglTexture))}var Z=(c(s={},k,10497),c(s,M,33071),c(s,C,33648),s),K=(c(l={},A,9728),c(l,I,9984),c(l,P,9986),c(l,R,9729),c(l,L,9985),c(l,O,9987),l);function Y(n,a,o){o?(e.texParameteri(n,10242,Z[a.wrapS]),e.texParameteri(n,10243,Z[a.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,Z[a.wrapR]),e.texParameteri(n,10240,K[a.magFilter]),e.texParameteri(n,10241,K[a.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),a.wrapS===M&&a.wrapT===M||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,S(a.magFilter)),e.texParameteri(n,10241,S(a.minFilter)),a.minFilter!==A&&a.minFilter!==R&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var s=t.get("EXT_texture_filter_anisotropic");if(s){if(a.type===F&&null===t.get("OES_texture_float_linear"))return;if(a.type===B&&null===(h||t.get("OES_texture_half_float_linear")))return;(a.anisotropy>1||r.get(a).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(a.anisotropy,i.getMaxAnisotropy())),r.get(a).__currentAnisotropy=a.anisotropy)}}function J(t,n){void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",T),t.__webglTexture=e.createTexture(),o.memory.textures++)}function Q(t,r,i){var o=3553;r.isDataTexture2DArray&&(o=35866),r.isDataTexture3D&&(o=32879),J(t,r),n.activeTexture(33984+i),n.bindTexture(o,t.__webglTexture),e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment);var s,l=function(e){return!h&&(e.wrapS!==M||e.wrapT!==M||e.minFilter!==A&&e.minFilter!==R)}(r)&&!1===b(r.image),u=_(r.image,l,!1,p),c=b(u)||h,f=a.convert(r.format),d=a.convert(r.type),m=E(r.internalFormat,f,d);Y(o,r,c);var v=r.mipmaps;if(r.isDepthTexture)m=6402,h?m=r.type===F?36012:r.type===z?33190:r.type===U?35056:33189:r.type===F&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===H&&6402===m&&r.type!==N&&r.type!==z&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=N,d=a.convert(r.type)),r.format===G&&6402===m&&(m=34041,r.type!==U&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=U,d=a.convert(r.type))),n.texImage2D(3553,0,m,u.width,u.height,0,f,d,null);else if(r.isDataTexture)if(v.length>0&&c){for(var y=0,g=v.length;y<g;y++)s=v[y],n.texImage2D(3553,y,m,s.width,s.height,0,f,d,s.data);r.generateMipmaps=!1,t.__maxMipLevel=v.length-1}else n.texImage2D(3553,0,m,u.width,u.height,0,f,d,u.data),t.__maxMipLevel=0;else if(r.isCompressedTexture){for(var S=0,T=v.length;S<T;S++)s=v[S],r.format!==V&&r.format!==j?null!==f?n.compressedTexImage2D(3553,S,m,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texImage2D(3553,S,m,s.width,s.height,0,f,d,s.data);t.__maxMipLevel=v.length-1}else if(r.isDataTexture2DArray)n.texImage3D(35866,0,m,u.width,u.height,u.depth,0,f,d,u.data),t.__maxMipLevel=0;else if(r.isDataTexture3D)n.texImage3D(32879,0,m,u.width,u.height,u.depth,0,f,d,u.data),t.__maxMipLevel=0;else if(v.length>0&&c){for(var k=0,C=v.length;k<C;k++)s=v[k],n.texImage2D(3553,k,m,f,d,s);r.generateMipmaps=!1,t.__maxMipLevel=v.length-1}else n.texImage2D(3553,0,m,f,d,u),t.__maxMipLevel=0;x(r,c)&&w(o,r,u.width,u.height),t.__version=r.version,r.onUpdate&&r.onUpdate(r)}function $(t,i,o,s){var l=a.convert(i.texture.format),u=a.convert(i.texture.type),c=E(i.texture.internalFormat,l,u);n.texImage2D(s,0,c,i.width,i.height,0,l,u,null),e.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,o,s,r.get(i.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function ee(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){var i=33189;if(r){var o=n.depthTexture;o&&o.isDepthTexture&&(o.type===F?i=36012:o.type===z&&(i=33190));var s=ne(n);e.renderbufferStorageMultisample(36161,s,i,n.width,n.height)}else e.renderbufferStorage(36161,i,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){if(r){var l=ne(n);e.renderbufferStorageMultisample(36161,l,35056,n.width,n.height)}else e.renderbufferStorage(36161,34041,n.width,n.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{var u=a.convert(n.texture.format),c=a.convert(n.texture.type),h=E(n.texture.internalFormat,u,c);if(r){var f=ne(n);e.renderbufferStorageMultisample(36161,f,h,n.width,n.height)}else e.renderbufferStorage(36161,h,n.width,n.height)}e.bindRenderbuffer(36161,null)}function te(t){var n=r.get(t),i=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,n){if(n&&n.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,t),!n.depthTexture||!n.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(n.depthTexture).__webglTexture&&n.depthTexture.image.width===n.width&&n.depthTexture.image.height===n.height||(n.depthTexture.image.width=n.width,n.depthTexture.image.height=n.height,n.depthTexture.needsUpdate=!0),q(n.depthTexture,0);var i=r.get(n.depthTexture).__webglTexture;if(n.depthTexture.format===H)e.framebufferTexture2D(36160,36096,3553,i,0);else{if(n.depthTexture.format!==G)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,i,0)}}(n.__webglFramebuffer,t)}else if(i){n.__webglDepthbuffer=[];for(var a=0;a<6;a++)e.bindFramebuffer(36160,n.__webglFramebuffer[a]),n.__webglDepthbuffer[a]=e.createRenderbuffer(),ee(n.__webglDepthbuffer[a],t,!1)}else e.bindFramebuffer(36160,n.__webglFramebuffer),n.__webglDepthbuffer=e.createRenderbuffer(),ee(n.__webglDepthbuffer,t,!1);e.bindFramebuffer(36160,null)}function ne(e){return h&&e.isWebGLMultisampleRenderTarget?Math.min(m,e.samples):0}var re=!1,ie=!1;this.allocateTextureUnit=function(){var e=W;return e>=f&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+f),W+=1,e},this.resetTextureUnits=function(){W=0},this.setTexture2D=q,this.setTexture2DArray=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?Q(i,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,i.__webglTexture))},this.setTexture3D=function(e,t){var i=r.get(e);e.version>0&&i.__version!==e.version?Q(i,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,i.__webglTexture))},this.setTextureCube=X,this.setupRenderTarget=function(t){var i=r.get(t),s=r.get(t.texture);t.addEventListener("dispose",D),s.__webglTexture=e.createTexture(),o.memory.textures++;var l=!0===t.isWebGLCubeRenderTarget,u=!0===t.isWebGLMultisampleRenderTarget,c=b(t)||h;if(!h||t.texture.format!==j||t.texture.type!==F&&t.texture.type!==B||(t.texture.format=V,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),l){i.__webglFramebuffer=[];for(var f=0;f<6;f++)i.__webglFramebuffer[f]=e.createFramebuffer()}else if(i.__webglFramebuffer=e.createFramebuffer(),u)if(h){i.__webglMultisampledFramebuffer=e.createFramebuffer(),i.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,i.__webglColorRenderbuffer);var d=a.convert(t.texture.format),p=a.convert(t.texture.type),m=E(t.texture.internalFormat,d,p),v=ne(t);e.renderbufferStorageMultisample(36161,v,m,t.width,t.height),e.bindFramebuffer(36160,i.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,i.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(i.__webglDepthRenderbuffer=e.createRenderbuffer(),ee(i.__webglDepthRenderbuffer,t,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(l){n.bindTexture(34067,s.__webglTexture),Y(34067,t.texture,c);for(var y=0;y<6;y++)$(i.__webglFramebuffer[y],t,36064,34069+y);x(t.texture,c)&&w(34067,t.texture,t.width,t.height),n.bindTexture(34067,null)}else n.bindTexture(3553,s.__webglTexture),Y(3553,t.texture,c),$(i.__webglFramebuffer,t,36064,3553),x(t.texture,c)&&w(3553,t.texture,t.width,t.height),n.bindTexture(3553,null);t.depthBuffer&&te(t)},this.updateRenderTargetMipmap=function(e){var t=e.texture;if(x(t,b(e)||h)){var i=e.isWebGLCubeRenderTarget?34067:3553,a=r.get(t).__webglTexture;n.bindTexture(i,a),w(i,t,e.width,e.height),n.bindTexture(i,null)}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(h){var n=r.get(t);e.bindFramebuffer(36008,n.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,n.__webglFramebuffer);var i=t.width,a=t.height,o=16384;t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024),e.blitFramebuffer(0,0,i,a,0,0,i,a,o,9728),e.bindFramebuffer(36160,n.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===re&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),re=!0),e=e.texture),q(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===ie&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),ie=!0),e=e.texture),X(e,t)}}function na(e,t,n){var r=n.isWebGL2;return{convert:function(e){var n;if(e===D)return 5121;if(1017===e)return 32819;if(1018===e)return 32820;if(1019===e)return 33635;if(1010===e)return 5120;if(1011===e)return 5122;if(e===N)return 5123;if(1013===e)return 5124;if(e===z)return 5125;if(e===F)return 5126;if(e===B)return r?5131:null!==(n=t.get("OES_texture_half_float"))?n.HALF_FLOAT_OES:null;if(1021===e)return 6406;if(e===j)return 6407;if(e===V)return 6408;if(1024===e)return 6409;if(1025===e)return 6410;if(e===H)return 6402;if(e===G)return 34041;if(1028===e)return 6403;if(1029===e)return 36244;if(1030===e)return 33319;if(1031===e)return 33320;if(1032===e)return 36248;if(1033===e)return 36249;if(33776===e||33777===e||33778===e||33779===e){if(null===(n=t.get("WEBGL_compressed_texture_s3tc")))return null;if(33776===e)return n.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===e)return n.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===e)return n.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===e)return n.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===e||35841===e||35842===e||35843===e){if(null===(n=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(35840===e)return n.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===e)return n.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===e)return n.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===e)return n.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===e)return null!==(n=t.get("WEBGL_compressed_texture_etc1"))?n.COMPRESSED_RGB_ETC1_WEBGL:null;if((37492===e||37496===e)&&null!==(n=t.get("WEBGL_compressed_texture_etc"))){if(37492===e)return n.COMPRESSED_RGB8_ETC2;if(37496===e)return n.COMPRESSED_RGBA8_ETC2_EAC}return 37808===e||37809===e||37810===e||37811===e||37812===e||37813===e||37814===e||37815===e||37816===e||37817===e||37818===e||37819===e||37820===e||37821===e||37840===e||37841===e||37842===e||37843===e||37844===e||37845===e||37846===e||37847===e||37848===e||37849===e||37850===e||37851===e||37852===e||37853===e?null!==(n=t.get("WEBGL_compressed_texture_astc"))?e:null:36492===e?null!==(n=t.get("EXT_texture_compression_bptc"))?e:null:e===U?r?34042:null!==(n=t.get("WEBGL_depth_texture"))?n.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function ra(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Xn.call(this),this.cameras=e}function ia(){St.call(this),this.type="Group"}function aa(){this._targetRay=null,this._grip=null,this._hand=null}function oa(e,t){var n=this,r=null,i=1,a=null,o="local-floor",u=null,c=[],h=new Map,f=new Xn;f.layers.enable(1),f.viewport=new we;var d=new Xn;d.layers.enable(2),d.viewport=new we;var p=[f,d],m=new ra;m.layers.enable(1),m.layers.enable(2);var v=null,y=null;function g(e){var t=h.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function _(){h.forEach((function(e,t){e.disconnect(t)})),h.clear(),v=null,y=null,e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),T.stop(),n.isPresenting=!1,n.dispatchEvent({type:"sessionend"})}function b(e){for(var t=r.inputSources,n=0;n<c.length;n++)h.set(t[n],c[n]);for(var i=0;i<e.removed.length;i++){var a=e.removed[i],o=h.get(a);o&&(o.dispatchEvent({type:"disconnected",data:a}),h.delete(a))}for(var s=0;s<e.added.length;s++){var l=e.added[s],u=h.get(l);u&&u.dispatchEvent({type:"connected",data:l})}}this.enabled=!1,this.isPresenting=!1,this.getController=function(e){var t=c[e];return void 0===t&&(t=new aa,c[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){var t=c[e];return void 0===t&&(t=new aa,c[e]=t),t.getGripSpace()},this.getHand=function(e){var t=c[e];return void 0===t&&(t=new aa,c[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){i=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){o=e,!0===n.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return a},this.getSession=function(){return r},this.setSession=function(){var e=Object(l.a)(s.a.mark((function e(l){var u,c,h;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null===(r=l)){e.next=24;break}if(r.addEventListener("select",g),r.addEventListener("selectstart",g),r.addEventListener("selectend",g),r.addEventListener("squeeze",g),r.addEventListener("squeezestart",g),r.addEventListener("squeezeend",g),r.addEventListener("end",_),r.addEventListener("inputsourceschange",b),!0===(u=t.getContextAttributes()).xrCompatible){e.next=14;break}return e.next=14,t.makeXRCompatible();case 14:return c={antialias:u.antialias,alpha:u.alpha,depth:u.depth,stencil:u.stencil,framebufferScaleFactor:i},h=new XRWebGLLayer(r,t,c),r.updateRenderState({baseLayer:h}),e.next=19,r.requestReferenceSpace(o);case 19:a=e.sent,T.setContext(r),T.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"});case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var x=new Te,w=new Te;function E(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.getCamera=function(e){m.near=d.near=f.near=e.near,m.far=d.far=f.far=e.far,v===m.near&&y===m.far||(r.updateRenderState({depthNear:m.near,depthFar:m.far}),v=m.near,y=m.far);var t=e.parent,n=m.cameras;E(m,t);for(var i=0;i<n.length;i++)E(n[i],t);e.matrixWorld.copy(m.matrixWorld),e.matrix.copy(m.matrix),e.matrix.decompose(e.position,e.quaternion,e.scale);for(var a=e.children,o=0,s=a.length;o<s;o++)a[o].updateMatrixWorld(!0);return 2===n.length?function(e,t,n){x.setFromMatrixPosition(t.matrixWorld),w.setFromMatrixPosition(n.matrixWorld);var r=x.distanceTo(w),i=t.projectionMatrix.elements,a=n.projectionMatrix.elements,o=i[14]/(i[10]-1),s=i[14]/(i[10]+1),l=(i[9]+1)/i[5],u=(i[9]-1)/i[5],c=(i[8]-1)/i[0],h=(a[8]+1)/a[0],f=o*c,d=o*h,p=r/(-c+h),m=p*-c;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(m),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();var v=o+p,y=s+p,g=f-m,_=d+(r-m),b=l*s/y*v,E=u*s/y*v;e.projectionMatrix.makePerspective(g,_,b,E,v,y)}(m,f,d):m.projectionMatrix.copy(f.projectionMatrix),m};var S=null;var T=new nr;T.setAnimationLoop((function(t,n){if(null!==(u=n.getViewerPose(a))){var i=u.views,o=r.renderState.baseLayer;e.setFramebuffer(o.framebuffer);var s=!1;i.length!==m.cameras.length&&(m.cameras.length=0,s=!0);for(var l=0;l<i.length;l++){var h=i[l],f=o.getViewport(h),d=p[l];d.matrix.fromArray(h.transform.matrix),d.projectionMatrix.fromArray(h.projectionMatrix),d.viewport.set(f.x,f.y,f.width,f.height),0===l&&m.matrix.copy(d.matrix),!0===s&&m.cameras.push(d)}}for(var v=r.inputSources,y=0;y<c.length;y++){var g=c[y],_=v[y];g.update(_,n,a)}S&&S(t,n)})),this.setAnimationLoop=function(e){S=e},this.dispose=function(){}}function sa(e){function t(t,n){t.opacity.value=n.opacity,n.color&&t.diffuse.value.copy(n.color),n.emissive&&t.emissive.value.copy(n.emissive).multiplyScalar(n.emissiveIntensity),n.map&&(t.map.value=n.map),n.alphaMap&&(t.alphaMap.value=n.alphaMap),n.specularMap&&(t.specularMap.value=n.specularMap);var r,i,a=e.get(n).envMap;if(a){t.envMap.value=a,t.flipEnvMap.value=a.isCubeTexture&&a._needsFlipEnvMap?-1:1,t.reflectivity.value=n.reflectivity,t.refractionRatio.value=n.refractionRatio;var o=e.get(a).__maxMipLevel;void 0!==o&&(t.maxMipLevel.value=o)}n.lightMap&&(t.lightMap.value=n.lightMap,t.lightMapIntensity.value=n.lightMapIntensity),n.aoMap&&(t.aoMap.value=n.aoMap,t.aoMapIntensity.value=n.aoMapIntensity),n.map?r=n.map:n.specularMap?r=n.specularMap:n.displacementMap?r=n.displacementMap:n.normalMap?r=n.normalMap:n.bumpMap?r=n.bumpMap:n.roughnessMap?r=n.roughnessMap:n.metalnessMap?r=n.metalnessMap:n.alphaMap?r=n.alphaMap:n.emissiveMap?r=n.emissiveMap:n.clearcoatMap?r=n.clearcoatMap:n.clearcoatNormalMap?r=n.clearcoatNormalMap:n.clearcoatRoughnessMap&&(r=n.clearcoatRoughnessMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uvTransform.value.copy(r.matrix)),n.aoMap?i=n.aoMap:n.lightMap&&(i=n.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),t.uv2Transform.value.copy(i.matrix))}function n(t,n){t.roughness.value=n.roughness,t.metalness.value=n.metalness,n.roughnessMap&&(t.roughnessMap.value=n.roughnessMap),n.metalnessMap&&(t.metalnessMap.value=n.metalnessMap),n.emissiveMap&&(t.emissiveMap.value=n.emissiveMap),n.bumpMap&&(t.bumpMap.value=n.bumpMap,t.bumpScale.value=n.bumpScale,1===n.side&&(t.bumpScale.value*=-1)),n.normalMap&&(t.normalMap.value=n.normalMap,t.normalScale.value.copy(n.normalScale),1===n.side&&t.normalScale.value.negate()),n.displacementMap&&(t.displacementMap.value=n.displacementMap,t.displacementScale.value=n.displacementScale,t.displacementBias.value=n.displacementBias),e.get(n).envMap&&(t.envMapIntensity.value=n.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,r,i,a){r.isMeshBasicMaterial?t(e,r):r.isMeshLambertMaterial?(t(e,r),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,r)):r.isMeshToonMaterial?(t(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshPhongMaterial?(t(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshStandardMaterial?(t(e,r),r.isMeshPhysicalMaterial?function(e,t){n(e,t),e.reflectivity.value=t.reflectivity,e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.sheen&&e.sheen.value.copy(t.sheen);t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap);t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap);t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,1===t.side&&e.clearcoatNormalScale.value.negate());e.transmission.value=t.transmission,t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap)}(e,r):n(e,r)):r.isMeshMatcapMaterial?(t(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDepthMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isMeshDistanceMaterial?(t(e,r),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,r)):r.isMeshNormalMaterial?(t(e,r),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,1===t.side&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),1===t.side&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,r)):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,n,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,r,i,a):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function la(e){var t=void 0!==(e=e||{}).canvas?e.canvas:function(){var e=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");return e.style.display="block",e}(),n=void 0!==e.context?e.context:null,r=void 0!==e.alpha&&e.alpha,i=void 0===e.depth||e.depth,a=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,u=void 0!==e.powerPreference?e.powerPreference:"default",c=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat,h=null,f=null,d=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=te,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var p=this,m=!1,v=null,y=0,g=0,_=null,b=null,x=-1,w=null,E=new we,S=new we,T=null,k=t.width,M=t.height,C=1,A=null,I=null,P=new we(0,0,k,M),R=new we(0,0,k,M),L=!1,O=new tr,N=!1,z=!1,U=new $e,j=new Te,H={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function G(){return null===_?C:1}var W,q,X,Z,K,Y,J,Q,$,ee,ne,re,ie,ae,oe,se,le,ue,ce,he,fe,de=n;function pe(e,n){for(var r=0;r<e.length;r++){var i=e[r],a=t.getContext(i,n);if(null!==a)return a}return null}try{var ye={alpha:r,depth:i,stencil:a,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:l,powerPreference:u,failIfMajorPerformanceCaveat:c};if(t.addEventListener("webglcontextlost",Ee,!1),t.addEventListener("webglcontextrestored",Se,!1),null===de){var ge=["webgl2","webgl","experimental-webgl"];if(!0===p.isWebGL1Renderer&&ge.shift(),null===(de=pe(ge,ye)))throw pe(ge)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===de.getShaderPrecisionFormat&&(de.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(De){throw console.error("THREE.WebGLRenderer: "+De.message),De}function _e(){W=new pr(de),q=new hr(de,W,e),W.init(q),he=new na(de,W,q),(X=new ea(de,W,q)).scissor(S.copy(R).multiplyScalar(C).floor()),X.viewport(E.copy(P).multiplyScalar(C).floor()),Z=new yr(de),K=new Ui,Y=new ta(de,W,X,K,q,he,Z),J=new dr(p),Q=new rr(de,q),fe=new ur(de,W,Q,q),$=new mr(de,Q,Z,fe),ee=new xr(de,$,Q,Z),le=new br(de),oe=new fr(K),ne=new Bi(p,J,W,q,fe,oe),re=new sa(K),ie=new Gi(K),ae=new Yi(W,q),se=new lr(p,J,X,ee,s),ue=new cr(de,W,Z,q),ce=new vr(de,W,Z,q),Z.programs=ne.programs,p.capabilities=q,p.extensions=W,p.properties=K,p.renderLists=ie,p.state=X,p.info=Z}_e();var be=new oa(p,de);this.xr=be;var xe=new $i(p,ee,q.maxTextureSize);function Ee(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function Se(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1,_e()}function ke(e){var t=e.target;t.removeEventListener("dispose",ke),function(e){Me(e),K.remove(e)}(t)}function Me(e){var t=K.get(e).program;void 0!==t&&ne.releaseProgram(t)}this.shadowMap=xe,this.getContext=function(){return de},this.getContextAttributes=function(){return de.getContextAttributes()},this.forceContextLoss=function(){var e=W.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=W.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return C},this.setPixelRatio=function(e){void 0!==e&&(C=e,this.setSize(k,M,!1))},this.getSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),e=new ve),e.set(k,M)},this.setSize=function(e,n,r){be.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(k=e,M=n,t.width=Math.floor(e*C),t.height=Math.floor(n*C),!1!==r&&(t.style.width=e+"px",t.style.height=n+"px"),this.setViewport(0,0,e,n))},this.getDrawingBufferSize=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),e=new ve),e.set(k*C,M*C).floor()},this.setDrawingBufferSize=function(e,n,r){k=e,M=n,C=r,t.width=Math.floor(e*r),t.height=Math.floor(n*r),this.setViewport(0,0,e,n)},this.getCurrentViewport=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),e=new we),e.copy(E)},this.getViewport=function(e){return e.copy(P)},this.setViewport=function(e,t,n,r){e.isVector4?P.set(e.x,e.y,e.z,e.w):P.set(e,t,n,r),X.viewport(E.copy(P).multiplyScalar(C).floor())},this.getScissor=function(e){return e.copy(R)},this.setScissor=function(e,t,n,r){e.isVector4?R.set(e.x,e.y,e.z,e.w):R.set(e,t,n,r),X.scissor(S.copy(R).multiplyScalar(C).floor())},this.getScissorTest=function(){return L},this.setScissorTest=function(e){X.setScissorTest(L=e)},this.setOpaqueSort=function(e){A=e},this.setTransparentSort=function(e){I=e},this.getClearColor=function(e){return void 0===e&&(console.warn("WebGLRenderer: .getClearColor() now requires a Color as an argument"),e=new qt),e.copy(se.getClearColor())},this.setClearColor=function(){se.setClearColor.apply(se,arguments)},this.getClearAlpha=function(){return se.getClearAlpha()},this.setClearAlpha=function(){se.setClearAlpha.apply(se,arguments)},this.clear=function(e,t,n){var r=0;(void 0===e||e)&&(r|=16384),(void 0===t||t)&&(r|=256),(void 0===n||n)&&(r|=1024),de.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ee,!1),t.removeEventListener("webglcontextrestored",Se,!1),ie.dispose(),ae.dispose(),K.dispose(),J.dispose(),ee.dispose(),fe.dispose(),be.dispose(),Ae.stop()},this.renderBufferImmediate=function(e,t){fe.initAttributes();var n=K.get(e);e.hasPositions&&!n.position&&(n.position=de.createBuffer()),e.hasNormals&&!n.normal&&(n.normal=de.createBuffer()),e.hasUvs&&!n.uv&&(n.uv=de.createBuffer()),e.hasColors&&!n.color&&(n.color=de.createBuffer());var r=t.getAttributes();e.hasPositions&&(de.bindBuffer(34962,n.position),de.bufferData(34962,e.positionArray,35048),fe.enableAttribute(r.position),de.vertexAttribPointer(r.position,3,5126,!1,0,0)),e.hasNormals&&(de.bindBuffer(34962,n.normal),de.bufferData(34962,e.normalArray,35048),fe.enableAttribute(r.normal),de.vertexAttribPointer(r.normal,3,5126,!1,0,0)),e.hasUvs&&(de.bindBuffer(34962,n.uv),de.bufferData(34962,e.uvArray,35048),fe.enableAttribute(r.uv),de.vertexAttribPointer(r.uv,2,5126,!1,0,0)),e.hasColors&&(de.bindBuffer(34962,n.color),de.bufferData(34962,e.colorArray,35048),fe.enableAttribute(r.color),de.vertexAttribPointer(r.color,3,5126,!1,0,0)),fe.disableUnusedAttributes(),de.drawArrays(4,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,n,r,i,a){null===t&&(t=H);var o=i.isMesh&&i.matrixWorld.determinant()<0,s=Oe(e,t,r,i);X.setMaterial(r,o);var l=n.index,u=n.attributes.position;if(null===l){if(void 0===u||0===u.count)return}else if(0===l.count)return;var c,h=1;!0===r.wireframe&&(l=$.getWireframeAttribute(n),h=2),(r.morphTargets||r.morphNormals)&&le.update(i,n,r,s),fe.setup(i,r,s,n,l);var f=ue;null!==l&&(c=Q.get(l),(f=ce).setIndex(c));var d=null!==l?l.count:u.count,p=n.drawRange.start*h,m=n.drawRange.count*h,v=null!==a?a.start*h:0,y=null!==a?a.count*h:1/0,g=Math.max(p,v),_=Math.min(d,p+m,v+y)-1,b=Math.max(0,_-g+1);if(0!==b){if(i.isMesh)!0===r.wireframe?(X.setLineWidth(r.wireframeLinewidth*G()),f.setMode(1)):f.setMode(4);else if(i.isLine){var x=r.linewidth;void 0===x&&(x=1),X.setLineWidth(x*G()),i.isLineSegments?f.setMode(1):i.isLineLoop?f.setMode(2):f.setMode(3)}else i.isPoints?f.setMode(0):i.isSprite&&f.setMode(4);if(i.isInstancedMesh)f.renderInstances(g,b,i.count);else if(n.isInstancedBufferGeometry){var w=Math.min(n.instanceCount,n._maxInstanceCount);f.renderInstances(g,b,w)}else f.render(g,b)}},this.compile=function(e,t){(f=ae.get(e)).init(),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(f.pushLight(e),e.castShadow&&f.pushShadow(e))})),f.setupLights();var n=new WeakMap;e.traverse((function(t){var r=t.material;if(r)if(Array.isArray(r))for(var i=0;i<r.length;i++){var a=r[i];!1===n.has(a)&&(Le(a,e,t),n.set(a))}else!1===n.has(r)&&(Le(r,e,t),n.set(r))}))};var Ce=null;var Ae=new nr;function Ie(e,t,n,r){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)f.pushLight(e),e.castShadow&&f.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||O.intersectsSprite(e)){r&&j.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U);var i=ee.update(e),a=e.material;a.visible&&h.push(e,i,a,n,j.z,null)}}else if(e.isImmediateRenderObject)r&&j.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U),h.push(e,null,e.material,n,j.z,null);else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==Z.render.frame&&(e.skeleton.update(),e.skeleton.frame=Z.render.frame),!e.frustumCulled||O.intersectsObject(e))){r&&j.setFromMatrixPosition(e.matrixWorld).applyMatrix4(U);var o=ee.update(e),s=e.material;if(Array.isArray(s))for(var l=o.groups,u=0,c=l.length;u<c;u++){var d=l[u],p=s[d.materialIndex];p&&p.visible&&h.push(e,o,p,n,j.z,d)}else s.visible&&h.push(e,o,s,n,j.z,null)}for(var m=e.children,v=0,y=m.length;v<y;v++)Ie(m[v],t,n,r)}}function Pe(e,t,n){for(var r=!0===t.isScene?t.overrideMaterial:null,i=0,a=e.length;i<a;i++){var o=e[i],s=o.object,l=o.geometry,u=null===r?o.material:r,c=o.group;if(n.isArrayCamera)for(var h=n.cameras,d=0,p=h.length;d<p;d++){var m=h[d];s.layers.test(m.layers)&&(X.viewport(E.copy(m.viewport)),f.setupLightsView(m),Re(s,t,m,l,u,c))}else Re(s,t,n,l,u,c)}}function Re(e,t,n,r,i,a){if(e.onBeforeRender(p,t,n,r,i,a),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),e.isImmediateRenderObject){var o=Oe(n,t,i,e);X.setMaterial(i),fe.reset(),function(e,t){e.render((function(e){p.renderBufferImmediate(e,t)}))}(e,o)}else p.renderBufferDirect(n,t,r,i,e,a);e.onAfterRender(p,t,n,r,i,a)}function Le(e,t,n){!0!==t.isScene&&(t=H);var r=K.get(e),i=f.state.lights,a=f.state.shadowsArray,o=i.state.version,s=ne.getParameters(e,i.state,a,t,n),l=ne.getProgramCacheKey(s),u=r.program,c=!0;if(r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=J.get(e.envMap||r.environment),void 0===u)e.addEventListener("dispose",ke);else if(u.cacheKey!==l)Me(e);else if(r.lightsStateVersion!==o)c=!1;else{if(void 0!==s.shaderID)return;c=!1}c&&(s.uniforms=ne.getUniforms(e),e.onBeforeCompile(s,p),u=ne.acquireProgram(s,l),r.program=u,r.uniforms=s.uniforms,r.outputEncoding=s.outputEncoding);var h=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(r.numClippingPlanes=oe.numPlanes,r.numIntersection=oe.numIntersection,h.clippingPlanes=oe.uniform),r.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),r.lightsStateVersion=o,r.needsLights&&(h.ambientLightColor.value=i.state.ambient,h.lightProbe.value=i.state.probe,h.directionalLights.value=i.state.directional,h.directionalLightShadows.value=i.state.directionalShadow,h.spotLights.value=i.state.spot,h.spotLightShadows.value=i.state.spotShadow,h.rectAreaLights.value=i.state.rectArea,h.ltc_1.value=i.state.rectAreaLTC1,h.ltc_2.value=i.state.rectAreaLTC2,h.pointLights.value=i.state.point,h.pointLightShadows.value=i.state.pointShadow,h.hemisphereLights.value=i.state.hemi,h.directionalShadowMap.value=i.state.directionalShadowMap,h.directionalShadowMatrix.value=i.state.directionalShadowMatrix,h.spotShadowMap.value=i.state.spotShadowMap,h.spotShadowMatrix.value=i.state.spotShadowMatrix,h.pointShadowMap.value=i.state.pointShadowMap,h.pointShadowMatrix.value=i.state.pointShadowMatrix);var d=r.program.getUniforms(),m=gi.seqWithValue(d.seq,h);r.uniformsList=m}function Oe(e,t,n,r){!0!==t.isScene&&(t=H),Y.resetTextureUnits();var i=t.fog,a=n.isMeshStandardMaterial?t.environment:null,o=null===_?p.outputEncoding:_.texture.encoding,s=J.get(n.envMap||a),l=K.get(n),u=f.state.lights;if(!0===N&&(!0===z||e!==w)){var c=e===w&&n.id===x;oe.setState(n,e,c)}n.version===l.__version?n.fog&&l.fog!==i||l.environment!==a||l.needsLights&&l.lightsStateVersion!==u.state.version?Le(n,t,r):void 0===l.numClippingPlanes||l.numClippingPlanes===oe.numPlanes&&l.numIntersection===oe.numIntersection?(l.outputEncoding!==o||l.envMap!==s)&&Le(n,t,r):Le(n,t,r):(Le(n,t,r),l.__version=n.version);var h,d,m=!1,v=!1,y=!1,g=l.program,b=g.getUniforms(),E=l.uniforms;if(X.useProgram(g.program)&&(m=!0,v=!0,y=!0),n.id!==x&&(x=n.id,v=!0),m||w!==e){if(b.setValue(de,"projectionMatrix",e.projectionMatrix),q.logarithmicDepthBuffer&&b.setValue(de,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),w!==e&&(w=e,v=!0,y=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){var S=b.map.cameraPosition;void 0!==S&&S.setValue(de,j.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&b.setValue(de,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||n.skinning)&&b.setValue(de,"viewMatrix",e.matrixWorldInverse)}if(n.skinning){b.setOptional(de,r,"bindMatrix"),b.setOptional(de,r,"bindMatrixInverse");var T=r.skeleton;if(T){var k=T.bones;if(q.floatVertexTextures){if(null===T.boneTexture){var A=Math.sqrt(4*k.length);A=me.ceilPowerOfTwo(A),A=Math.max(A,4);var I=new Float32Array(A*A*4);I.set(T.boneMatrices);var P=new Qn(I,A,A,V,F);T.boneMatrices=I,T.boneTexture=P,T.boneTextureSize=A}b.setValue(de,"boneTexture",T.boneTexture,Y),b.setValue(de,"boneTextureSize",T.boneTextureSize)}else b.setOptional(de,T,"boneMatrices")}}return(v||l.receiveShadow!==r.receiveShadow)&&(l.receiveShadow=r.receiveShadow,b.setValue(de,"receiveShadow",r.receiveShadow)),v&&(b.setValue(de,"toneMappingExposure",p.toneMappingExposure),l.needsLights&&(d=y,(h=E).ambientLightColor.needsUpdate=d,h.lightProbe.needsUpdate=d,h.directionalLights.needsUpdate=d,h.directionalLightShadows.needsUpdate=d,h.pointLights.needsUpdate=d,h.pointLightShadows.needsUpdate=d,h.spotLights.needsUpdate=d,h.spotLightShadows.needsUpdate=d,h.rectAreaLights.needsUpdate=d,h.hemisphereLights.needsUpdate=d),i&&n.fog&&re.refreshFogUniforms(E,i),re.refreshMaterialUniforms(E,n,C,M),gi.upload(de,l.uniformsList,E,Y)),n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(gi.upload(de,l.uniformsList,E,Y),n.uniformsNeedUpdate=!1),n.isSpriteMaterial&&b.setValue(de,"center",r.center),b.setValue(de,"modelViewMatrix",r.modelViewMatrix),b.setValue(de,"normalMatrix",r.normalMatrix),b.setValue(de,"modelMatrix",r.matrixWorld),g}Ae.setAnimationLoop((function(e){be.isPresenting||Ce&&Ce(e)})),"undefined"!==typeof window&&Ae.setContext(window),this.setAnimationLoop=function(e){Ce=e,be.setAnimationLoop(e),null===e?Ae.stop():Ae.start()},this.render=function(e,t){var n,r;if(void 0!==arguments[2]&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),n=arguments[2]),void 0!==arguments[3]&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),r=arguments[3]),void 0===t||!0===t.isCamera){if(!0!==m){fe.resetDefaultState(),x=-1,w=null,!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===be.enabled&&!0===be.isPresenting&&(t=be.getCamera(t)),!0===e.isScene&&e.onBeforeRender(p,e,t,n||_),(f=ae.get(e,d.length)).init(),d.push(f),U.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),O.setFromProjectionMatrix(U),z=this.localClippingEnabled,N=oe.init(this.clippingPlanes,z,t),(h=ie.get(e,t)).init(),Ie(e,t,0,p.sortObjects),h.finish(),!0===p.sortObjects&&h.sort(A,I),!0===N&&oe.beginShadows();var i=f.state.shadowsArray;xe.render(i,e,t),f.setupLights(),f.setupLightsView(t),!0===N&&oe.endShadows(),!0===this.info.autoReset&&this.info.reset(),void 0!==n&&this.setRenderTarget(n),se.render(h,e,t,r);var a=h.opaque,o=h.transparent;a.length>0&&Pe(a,e,t),o.length>0&&Pe(o,e,t),!0===e.isScene&&e.onAfterRender(p,e,t),null!==_&&(Y.updateRenderTargetMipmap(_),Y.updateMultisampleRenderTarget(_)),X.buffers.depth.setTest(!0),X.buffers.depth.setMask(!0),X.buffers.color.setMask(!0),X.setPolygonOffset(!1),d.pop(),f=d.length>0?d[d.length-1]:null,h=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.setFramebuffer=function(e){v!==e&&null===_&&de.bindFramebuffer(36160,e),v=e},this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return g},this.getRenderList=function(){return h},this.setRenderList=function(e){h=e},this.getRenderTarget=function(){return _},this.setRenderTarget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;_=e,y=t,g=n,e&&void 0===K.get(e).__webglFramebuffer&&Y.setupRenderTarget(e);var r=v,i=!1;if(e){var a=K.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(r=a[t],i=!0):r=e.isWebGLMultisampleRenderTarget?K.get(e).__webglMultisampledFramebuffer:a,E.copy(e.viewport),S.copy(e.scissor),T=e.scissorTest}else E.copy(P).multiplyScalar(C).floor(),S.copy(R).multiplyScalar(C).floor(),T=L;if(b!==r&&(de.bindFramebuffer(36160,r),b=r),X.viewport(E),X.scissor(S),X.setScissorTest(T),i){var o=K.get(e.texture);de.framebufferTexture2D(36160,36064,34069+t,o.__webglTexture,n)}},this.readRenderTargetPixels=function(e,t,n,r,i,a,o){if(e&&e.isWebGLRenderTarget){var s=K.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){var l=!1;s!==b&&(de.bindFramebuffer(36160,s),l=!0);try{var u=e.texture,c=u.format,h=u.type;if(c!==V&&he.convert(c)!==de.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var f=h===B&&(W.has("EXT_color_buffer_half_float")||q.isWebGL2&&W.has("EXT_color_buffer_float"));if(h!==D&&he.convert(h)!==de.getParameter(35738)&&(h!==F||!(q.isWebGL2||W.has("OES_texture_float")||W.has("WEBGL_color_buffer_float")))&&!f)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===de.checkFramebufferStatus(36160)?t>=0&&t<=e.width-r&&n>=0&&n<=e.height-i&&de.readPixels(t,n,r,i,he.convert(c),he.convert(h),a):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{l&&de.bindFramebuffer(36160,b)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Math.pow(2,-n),i=Math.floor(t.image.width*r),a=Math.floor(t.image.height*r),o=he.convert(t.format);Y.setTexture2D(t,0),de.copyTexImage2D(3553,n,o,e.x,e.y,i,a,0),X.unbindTexture()},this.copyTextureToTexture=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=t.image.width,a=t.image.height,o=he.convert(n.format),s=he.convert(n.type);Y.setTexture2D(n,0),de.pixelStorei(37440,n.flipY),de.pixelStorei(37441,n.premultiplyAlpha),de.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?de.texSubImage2D(3553,r,e.x,e.y,i,a,o,s,t.image.data):t.isCompressedTexture?de.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):de.texSubImage2D(3553,r,e.x,e.y,o,s,t.image),0===r&&n.generateMipmaps&&de.generateMipmap(3553),X.unbindTexture()},this.initTexture=function(e){Y.setTexture2D(e,0),X.unbindTexture()},this.resetState=function(){X.reset(),fe.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function ua(e){la.call(this,e)}ra.prototype=Object.assign(Object.create(Xn.prototype),{constructor:ra,isArrayCamera:!0}),ia.prototype=Object.assign(Object.create(St.prototype),{constructor:ia,isGroup:!0}),Object.assign(aa.prototype,{constructor:aa,getHandSpace:function(){return null===this._hand&&(this._hand=new ia,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand},getTargetRaySpace:function(){return null===this._targetRay&&(this._targetRay=new ia,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1),this._targetRay},getGripSpace:function(){return null===this._grip&&(this._grip=new ia,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1),this._grip},dispatchEvent:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this},disconnect:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this},update:function(e,t,n){var r=null,i=null,a=null,o=this._targetRay,s=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(l&&e.hand){a=!0;var c,h=function(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=Object(u.a)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw a}}}}(e.hand.values());try{for(h.s();!(c=h.n()).done;){var f=c.value,d=t.getJointPose(f,n);if(void 0===l.joints[f.jointName]){var p=new ia;p.matrixAutoUpdate=!1,p.visible=!1,l.joints[f.jointName]=p,l.add(p)}var m=l.joints[f.jointName];null!==d&&(m.matrix.fromArray(d.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.jointRadius=d.radius),m.visible=null!==d}}catch(_){h.e(_)}finally{h.f()}var v=l.joints["index-finger-tip"],y=l.joints["thumb-tip"],g=v.position.distanceTo(y.position);l.inputState.pinching&&g>.025?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&g<=.015&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==o&&null!==(r=t.getPose(e.targetRaySpace,n))&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale)),null!==s&&e.gripSpace&&null!==(i=t.getPose(e.gripSpace,n))&&(s.matrix.fromArray(i.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale));return null!==o&&(o.visible=null!==r),null!==s&&(s.visible=null!==i),null!==l&&(l.visible=null!==a),this}}),Object.assign(oa.prototype,ce.prototype),ua.prototype=Object.assign(Object.create(la.prototype),{constructor:ua,isWebGL1Renderer:!0});var ca=function(e){p(n,e);var t=m(n);function n(){var e;return Object(y.a)(this,n),e=t.call(this),Object.defineProperty(i(e),"isScene",{value:!0}),e.type="Scene",e.background=null,e.environment=null,e.fog=null,e.overrideMaterial=null,e.autoUpdate=!0,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:i(e)})),e}return Object(g.a)(n,[{key:"copy",value:function(e,t){return f(h(n.prototype),"copy",this).call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}},{key:"toJSON",value:function(e){var t=f(h(n.prototype),"toJSON",this).call(this,e);return null!==this.background&&(t.object.background=this.background.toJSON(e)),null!==this.environment&&(t.object.environment=this.environment.toJSON(e)),null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}]),n}(St);function ha(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=se,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=me.generateUUID()}Object.defineProperty(ha.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(ha.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,n){e*=this.stride,n*=t.stride;for(var r=0,i=this.stride;r<i;r++)this.array[e+r]=t.array[n+r];return this},set:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this},clone:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=me.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var t=new ha(new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),this.stride);return t.setUsage(this.usage),t},onUpload:function(e){return this.onUploadCallback=e,this},toJSON:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=me.generateUUID()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}});var fa,da=new Te;function pa(e,t,n,r){this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=!0===r}function ma(e){Kt.call(this),this.type="SpriteMaterial",this.color=new qt(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.defineProperties(pa.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}},needsUpdate:{set:function(e){this.data.needsUpdate=e}}}),Object.assign(pa.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var t=0,n=this.data.count;t<n;t++)da.x=this.getX(t),da.y=this.getY(t),da.z=this.getZ(t),da.applyMatrix4(e),this.setXYZ(t,da.x,da.y,da.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this},setXYZ:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this},setXYZW:function(e,t,n,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=i,this},clone:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],n=0;n<this.count;n++)for(var r=n*this.data.stride+this.offset,i=0;i<this.itemSize;i++)t.push(this.data.array[r+i]);return new $t(new this.array.constructor(t),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new pa(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)},toJSON:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");for(var t=[],n=0;n<this.count;n++)for(var r=n*this.data.stride+this.offset,i=0;i<this.itemSize;i++)t.push(this.data.array[r+i]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}),ma.prototype=Object.create(Kt.prototype),ma.prototype.constructor=ma,ma.prototype.isSpriteMaterial=!0,ma.prototype.copy=function(e){return Kt.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var va=new Te,ya=new Te,ga=new Te,_a=new ve,ba=new ve,xa=new $e,wa=new Te,Ea=new Te,Sa=new Te,Ta=new ve,ka=new ve,Ma=new ve;function Ca(e){if(St.call(this),this.type="Sprite",void 0===fa){fa=new xn;var t=new ha(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);fa.setIndex([0,1,2,0,2,3]),fa.setAttribute("position",new pa(t,3,0,!1)),fa.setAttribute("uv",new pa(t,2,3,!1))}this.geometry=fa,this.material=void 0!==e?e:new ma,this.center=new ve(.5,.5)}function Aa(e,t,n,r,i,a){_a.subVectors(e,n).addScalar(.5).multiply(r),void 0!==i?(ba.x=a*_a.x-i*_a.y,ba.y=i*_a.x+a*_a.y):ba.copy(_a),e.copy(t),e.x+=ba.x,e.y+=ba.y,e.applyMatrix4(xa)}Ca.prototype=Object.assign(Object.create(St.prototype),{constructor:Ca,isSprite:!0,raycast:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ya.setFromMatrixScale(this.matrixWorld),xa.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),ga.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&ya.multiplyScalar(-ga.z);var n,r,i=this.material.rotation;0!==i&&(r=Math.cos(i),n=Math.sin(i));var a=this.center;Aa(wa.set(-.5,-.5,0),ga,a,ya,n,r),Aa(Ea.set(.5,-.5,0),ga,a,ya,n,r),Aa(Sa.set(.5,.5,0),ga,a,ya,n,r),Ta.set(0,0),ka.set(1,0),Ma.set(1,1);var o=e.ray.intersectTriangle(wa,Ea,Sa,!1,va);if(null!==o||(Aa(Ea.set(-.5,.5,0),ga,a,ya,n,r),ka.set(0,1),null!==(o=e.ray.intersectTriangle(wa,Sa,Ea,!1,va)))){var s=e.ray.origin.distanceTo(va);s<e.near||s>e.far||t.push({distance:s,point:va.clone(),uv:Bt.getUV(va,wa,Ea,Sa,Ta,ka,Ma,new ve),face:null,object:this})}},copy:function(e){return St.prototype.copy.call(this,e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}});var Ia=new Te,Pa=new Te;function Ra(){St.call(this),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}Ra.prototype=Object.assign(Object.create(St.prototype),{constructor:Ra,isLOD:!0,copy:function(e){St.prototype.copy.call(this,e,!1);for(var t=e.levels,n=0,r=t.length;n<r;n++){var i=t[n];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t=Math.abs(t);var n,r=this.levels;for(n=0;n<r.length&&!(t<r[n].distance);n++);return r.splice(n,0,{distance:t,object:e}),this.add(e),this},getCurrentLevel:function(){return this._currentLevel},getObjectForDistance:function(e){var t=this.levels;if(t.length>0){var n,r;for(n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null},raycast:function(e,t){if(this.levels.length>0){Ia.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(Ia);this.getObjectForDistance(n).raycast(e,t)}},update:function(e){var t=this.levels;if(t.length>1){Ia.setFromMatrixPosition(e.matrixWorld),Pa.setFromMatrixPosition(this.matrixWorld);var n,r,i=Ia.distanceTo(Pa)/e.zoom;for(t[0].object.visible=!0,n=1,r=t.length;n<r&&i>=t[n].distance;n++)t[n-1].object.visible=!1,t[n].object.visible=!0;for(this._currentLevel=n-1;n<r;n++)t[n].object.visible=!1}},toJSON:function(e){var t=St.prototype.toJSON.call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var n=this.levels,r=0,i=n.length;r<i;r++){var a=n[r];t.object.levels.push({object:a.object.uuid,distance:a.distance})}return t}});var La=new Te,Oa=new we,Da=new we,Na=new Te,za=new $e;function Fa(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Bn.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new $e,this.bindMatrixInverse=new $e}function Ba(){St.call(this),this.type="Bone"}Fa.prototype=Object.assign(Object.create(Bn.prototype),{constructor:Fa,isSkinnedMesh:!0,copy:function(e){return Bn.prototype.copy.call(this,e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this},bind:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new we,t=this.geometry.attributes.skinWeight,n=0,r=t.count;n<r;n++){e.x=t.getX(n),e.y=t.getY(n),e.z=t.getZ(n),e.w=t.getW(n);var i=1/e.manhattanLength();i!==1/0?e.multiplyScalar(i):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Bn.prototype.updateMatrixWorld.call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},boneTransform:function(e,t){var n=this.skeleton,r=this.geometry;Oa.fromBufferAttribute(r.attributes.skinIndex,e),Da.fromBufferAttribute(r.attributes.skinWeight,e),La.fromBufferAttribute(r.attributes.position,e).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(var i=0;i<4;i++){var a=Da.getComponent(i);if(0!==a){var o=Oa.getComponent(i);za.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),t.addScaledVector(Na.copy(La).applyMatrix4(za),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}),Ba.prototype=Object.assign(Object.create(St.prototype),{constructor:Ba,isBone:!0});var Ua=new $e,ja=new $e;function Va(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.uuid=me.generateUUID(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}Object.assign(Va.prototype,{init:function(){var e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new $e)}},calculateInverses:function(){this.boneInverses.length=0;for(var e=0,t=this.bones.length;e<t;e++){var n=new $e;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}},pose:function(){for(var e=0,t=this.bones.length;e<t;e++){var n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(var r=0,i=this.bones.length;r<i;r++){var a=this.bones[r];a&&(a.parent&&a.parent.isBone?(a.matrix.copy(a.parent.matrixWorld).invert(),a.matrix.multiply(a.matrixWorld)):a.matrix.copy(a.matrixWorld),a.matrix.decompose(a.position,a.quaternion,a.scale))}},update:function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,i=0,a=e.length;i<a;i++){var o=e[i]?e[i].matrixWorld:ja;Ua.multiplyMatrices(o,t[i]),Ua.toArray(n,16*i)}null!==r&&(r.needsUpdate=!0)},clone:function(){return new Va(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,n=this.bones.length;t<n;t++){var r=this.bones[t];if(r.name===e)return r}},dispose:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)},fromJSON:function(e,t){this.uuid=e.uuid;for(var n=0,r=e.bones.length;n<r;n++){var i=e.bones[n],a=t[i];void 0===a&&(console.warn("THREE.Skeleton: No bone found with UUID:",i),a=new Ba),this.bones.push(a),this.boneInverses.push((new $e).fromArray(e.boneInverses[n]))}return this.init(),this},toJSON:function(){var e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;for(var t=this.bones,n=this.boneInverses,r=0,i=t.length;r<i;r++){var a=t[r];e.bones.push(a.uuid);var o=n[r];e.boneInverses.push(o.toArray())}return e}});var Ha=new $e,Ga=new $e,Wa=[],qa=new Bn;function Xa(e,t,n){Bn.call(this,e,t),this.instanceMatrix=new $t(new Float32Array(16*n),16),this.instanceColor=null,this.count=n,this.frustumCulled=!1}function Za(e){Kt.call(this),this.type="LineBasicMaterial",this.color=new qt(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.morphTargets=!1,this.setValues(e)}Xa.prototype=Object.assign(Object.create(Bn.prototype),{constructor:Xa,isInstancedMesh:!0,copy:function(e){return Bn.prototype.copy.call(this,e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this},getColorAt:function(e,t){t.fromArray(this.instanceColor.array,3*e)},getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var n=this.matrixWorld,r=this.count;if(qa.geometry=this.geometry,qa.material=this.material,void 0!==qa.material)for(var i=0;i<r;i++){this.getMatrixAt(i,Ha),Ga.multiplyMatrices(n,Ha),qa.matrixWorld=Ga,qa.raycast(e,Wa);for(var a=0,o=Wa.length;a<o;a++){var s=Wa[a];s.instanceId=i,s.object=this,t.push(s)}Wa.length=0}},setColorAt:function(e,t){null===this.instanceColor&&(this.instanceColor=new $t(new Float32Array(3*this.count),3)),t.toArray(this.instanceColor.array,3*e)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Za.prototype=Object.create(Kt.prototype),Za.prototype.constructor=Za,Za.prototype.isLineBasicMaterial=!0,Za.prototype.copy=function(e){return Kt.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.morphTargets=e.morphTargets,this};var Ka=new Te,Ya=new Te,Ja=new $e,Qa=new Qe,$a=new Ge;function eo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new xn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Za;St.call(this),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}eo.prototype=Object.assign(Object.create(St.prototype),{constructor:eo,isLine:!0,copy:function(e){return St.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[0],r=1,i=t.count;r<i;r++)Ka.fromBufferAttribute(t,r-1),Ya.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=Ka.distanceTo(Ya);e.setAttribute("lineDistance",new un(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this},raycast:function(e,t){var n=this.geometry,r=this.matrixWorld,i=e.params.Line.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),$a.copy(n.boundingSphere),$a.applyMatrix4(r),$a.radius+=i,!1!==e.ray.intersectsSphere($a)){Ja.copy(r).invert(),Qa.copy(e.ray).applyMatrix4(Ja);var a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a,s=new Te,l=new Te,u=new Te,c=new Te,h=this.isLineSegments?2:1;if(n.isBufferGeometry){var f=n.index,d=n.attributes.position;if(null!==f)for(var p=f.array,m=0,v=p.length-1;m<v;m+=h){var y=p[m],g=p[m+1];if(s.fromBufferAttribute(d,y),l.fromBufferAttribute(d,g),!(Qa.distanceSqToSegment(s,l,c,u)>o)){c.applyMatrix4(this.matrixWorld);var _=e.ray.origin.distanceTo(c);_<e.near||_>e.far||t.push({distance:_,point:u.clone().applyMatrix4(this.matrixWorld),index:m,face:null,faceIndex:null,object:this})}}else for(var b=0,x=d.count-1;b<x;b+=h){if(s.fromBufferAttribute(d,b),l.fromBufferAttribute(d,b+1),!(Qa.distanceSqToSegment(s,l,c,u)>o)){c.applyMatrix4(this.matrixWorld);var w=e.ray.origin.distanceTo(c);w<e.near||w>e.far||t.push({distance:w,point:u.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this})}}}else n.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,a=r.length;i<a;i++){var o=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=i}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}});var to=new Te,no=new Te;function ro(e,t){eo.call(this,e,t),this.type="LineSegments"}function io(e,t){eo.call(this,e,t),this.type="LineLoop"}function ao(e){Kt.call(this),this.type="PointsMaterial",this.color=new qt(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}ro.prototype=Object.assign(Object.create(eo.prototype),{constructor:ro,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(null===e.index){for(var t=e.attributes.position,n=[],r=0,i=t.count;r<i;r+=2)to.fromBufferAttribute(t,r),no.fromBufferAttribute(t,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+to.distanceTo(no);e.setAttribute("lineDistance",new un(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}),io.prototype=Object.assign(Object.create(eo.prototype),{constructor:io,isLineLoop:!0}),ao.prototype=Object.create(Kt.prototype),ao.prototype.constructor=ao,ao.prototype.isPointsMaterial=!0,ao.prototype.copy=function(e){return Kt.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var oo=new $e,so=new Qe,lo=new Ge,uo=new Te;function co(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new xn,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ao;St.call(this),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}function ho(e,t,n,r,i,a,o){var s=so.distanceSqToPoint(e);if(s<n){var l=new Te;so.closestPointToPoint(e,l),l.applyMatrix4(r);var u=i.ray.origin.distanceTo(l);if(u<i.near||u>i.far)return;a.push({distance:u,distanceToRay:Math.sqrt(s),point:l,index:t,face:null,object:o})}}function fo(e,t,n,r,i,a,o,s,l){be.call(this,e,t,n,r,i,a,o,s,l),this.format=void 0!==o?o:j,this.minFilter=void 0!==a?a:R,this.magFilter=void 0!==i?i:R,this.generateMipmaps=!1;var u=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){u.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}function po(e,t,n,r,i,a,o,s,l,u,c,h){be.call(this,null,a,o,s,l,u,r,i,c,h),this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function mo(e,t,n,r,i,a,o,s,l){be.call(this,e,t,n,r,i,a,o,s,l),this.needsUpdate=!0}function vo(e,t,n,r,i,a,o,s,l,u){if((u=void 0!==u?u:H)!==H&&u!==G)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===n&&u===H&&(n=N),void 0===n&&u===G&&(n=U),be.call(this,null,r,i,a,o,s,u,n,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:A,this.minFilter=void 0!==s?s:A,this.flipY=!1,this.generateMipmaps=!1}co.prototype=Object.assign(Object.create(St.prototype),{constructor:co,isPoints:!0,copy:function(e){return St.prototype.copy.call(this,e),this.material=e.material,this.geometry=e.geometry,this},raycast:function(e,t){var n=this.geometry,r=this.matrixWorld,i=e.params.Points.threshold;if(null===n.boundingSphere&&n.computeBoundingSphere(),lo.copy(n.boundingSphere),lo.applyMatrix4(r),lo.radius+=i,!1!==e.ray.intersectsSphere(lo)){oo.copy(r).invert(),so.copy(e.ray).applyMatrix4(oo);var a=i/((this.scale.x+this.scale.y+this.scale.z)/3),o=a*a;if(n.isBufferGeometry){var s=n.index,l=n.attributes.position;if(null!==s)for(var u=s.array,c=0,h=u.length;c<h;c++){var f=u[c];uo.fromBufferAttribute(l,f),ho(uo,f,o,r,e,t,this)}else for(var d=0,p=l.count;d<p;d++)uo.fromBufferAttribute(l,d),ho(uo,d,o,r,e,t,this)}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},updateMorphTargets:function(){var e=this.geometry;if(e.isBufferGeometry){var t=e.morphAttributes,n=Object.keys(t);if(n.length>0){var r=t[n[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var i=0,a=r.length;i<a;i++){var o=r[i].name||String(i);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=i}}}}else{var s=e.morphTargets;void 0!==s&&s.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}),fo.prototype=Object.assign(Object.create(be.prototype),{constructor:fo,clone:function(){return new this.constructor(this.image).copy(this)},isVideoTexture:!0,update:function(){var e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),po.prototype=Object.create(be.prototype),po.prototype.constructor=po,po.prototype.isCompressedTexture=!0,mo.prototype=Object.create(be.prototype),mo.prototype.constructor=mo,mo.prototype.isCanvasTexture=!0,vo.prototype=Object.create(be.prototype),vo.prototype.constructor=vo,vo.prototype.isDepthTexture=!0;new Te,new Te,new Te,new Bt;var yo=function(e,t,n){n=n||2;var r,i,a,o,s,l,u,c=t&&t.length,h=c?t[0]*n:e.length,f=go(e,0,h,n,!0),d=[];if(!f||f.next===f.prev)return d;if(c&&(f=function(e,t,n,r){var i,a,o,s=[];for(i=0,a=t.length;i<a;i++)(o=go(e,t[i]*r,i<a-1?t[i+1]*r:e.length,r,!1))===o.next&&(o.steiner=!0),s.push(Ao(o));for(s.sort(To),i=0;i<s.length;i++)ko(s[i],n),n=_o(n,n.next);return n}(e,t,f,n)),e.length>80*n){r=a=e[0],i=o=e[1];for(var p=n;p<h;p+=n)(s=e[p])<r&&(r=s),(l=e[p+1])<i&&(i=l),s>a&&(a=s),l>o&&(o=l);u=0!==(u=Math.max(a-r,o-i))?1/u:0}return bo(f,d,n,r,i,u),d};function go(e,t,n,r,i){var a,o;if(i===function(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}(e,t,n,r)>0)for(a=t;a<n;a+=r)o=Bo(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=Bo(a,e[a],e[a+1],o);return o&&Lo(o,o.next)&&(Uo(o),o=o.next),o}function _o(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!Lo(r,r.next)&&0!==Ro(r.prev,r,r.next))r=r.next;else{if(Uo(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function bo(e,t,n,r,i,a,o){if(e){!o&&a&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=Co(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,a,o,s,l,u=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<u&&(s++,r=r.nextZ);t++);for(l=u;s>0||l>0&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,u*=2}while(o>1)}(i)}(e,r,i,a);for(var s,l,u=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?wo(e,r,i,a):xo(e))t.push(s.i/n),t.push(e.i/n),t.push(l.i/n),Uo(e),e=l.next,u=l.next;else if((e=l)===u){o?1===o?bo(e=Eo(_o(e),t,n),t,n,r,i,a,2):2===o&&So(e,t,n,r,i,a):bo(_o(e),t,n,r,i,a,1);break}}}function xo(e){var t=e.prev,n=e,r=e.next;if(Ro(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(Io(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Ro(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function wo(e,t,n,r){var i=e.prev,a=e,o=e.next;if(Ro(i,a,o)>=0)return!1;for(var s=i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,l=i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,u=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,c=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,h=Co(s,l,t,n,r),f=Co(u,c,t,n,r),d=e.prevZ,p=e.nextZ;d&&d.z>=h&&p&&p.z<=f;){if(d!==e.prev&&d!==e.next&&Io(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&Ro(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,p!==e.prev&&p!==e.next&&Io(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&Ro(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&Io(i.x,i.y,a.x,a.y,o.x,o.y,d.x,d.y)&&Ro(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=f;){if(p!==e.prev&&p!==e.next&&Io(i.x,i.y,a.x,a.y,o.x,o.y,p.x,p.y)&&Ro(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Eo(e,t,n){var r=e;do{var i=r.prev,a=r.next.next;!Lo(i,a)&&Oo(i,r,r.next,a)&&zo(i,a)&&zo(a,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(a.i/n),Uo(r),Uo(r.next),r=e=a),r=r.next}while(r!==e);return _o(r)}function So(e,t,n,r,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Po(o,s)){var l=Fo(o,s);return o=_o(o,o.next),l=_o(l,l.next),bo(o,t,n,r,i,a),void bo(l,t,n,r,i,a)}s=s.next}o=o.next}while(o!==e)}function To(e,t){return e.x-t.x}function ko(e,t){if(t=function(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===o)return n;var l,u=n,c=n.x,h=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&Io(a<h?i:o,a,c,h,a<h?o:i,a,r.x,r.y)&&(l=Math.abs(a-r.y)/(i-r.x),zo(r,e)&&(l<f||l===f&&(r.x>n.x||r.x===n.x&&Mo(n,r)))&&(n=r,f=l)),r=r.next}while(r!==u);return n}(e,t)){var n=Fo(t,e);_o(t,t.next),_o(n,n.next)}}function Mo(e,t){return Ro(e.prev,e,t.prev)<0&&Ro(t.next,e,e.next)<0}function Co(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Ao(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Io(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function Po(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Oo(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(zo(e,t)&&zo(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!==n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(Ro(e.prev,e,t.prev)||Ro(e,t.prev,t))||Lo(e,t)&&Ro(e.prev,e,e.next)>0&&Ro(t.prev,t,t.next)>0)}function Ro(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Lo(e,t){return e.x===t.x&&e.y===t.y}function Oo(e,t,n,r){var i=No(Ro(e,t,n)),a=No(Ro(e,t,r)),o=No(Ro(n,r,e)),s=No(Ro(n,r,t));return i!==a&&o!==s||(!(0!==i||!Do(e,n,t))||(!(0!==a||!Do(e,r,t))||(!(0!==o||!Do(n,e,r))||!(0!==s||!Do(n,t,r)))))}function Do(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function No(e){return e>0?1:e<0?-1:0}function zo(e,t){return Ro(e.prev,e,e.next)<0?Ro(e,t,e.next)>=0&&Ro(e,e.prev,t)>=0:Ro(e,t,e.prev)<0||Ro(e,e.next,t)<0}function Fo(e,t){var n=new jo(e.i,e.x,e.y),r=new jo(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function Bo(e,t,n,r){var i=new jo(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Uo(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function jo(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var Vo={area:function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n},isClockWise:function(e){return Vo.area(e)<0},triangulateShape:function(e,t){var n=[],r=[],i=[];Ho(e),Go(n,e);var a=e.length;t.forEach(Ho);for(var o=0;o<t.length;o++)r.push(a),a+=t[o].length,Go(n,t[o]);for(var s=yo(n,r),l=0;l<s.length;l+=3)i.push(s.slice(l,l+3));return i}};function Ho(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Go(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}var Wo=function(e){p(n,e);var t=m(n);function n(e,r){var a;Object(y.a)(this,n),(a=t.call(this)).type="ExtrudeGeometry",a.parameters={shapes:e,options:r},e=Array.isArray(e)?e:[e];for(var o=i(a),s=[],l=[],u=0,c=e.length;u<c;u++){h(e[u])}function h(e){var t=[],n=void 0!==r.curveSegments?r.curveSegments:12,i=void 0!==r.steps?r.steps:1,a=void 0!==r.depth?r.depth:100,u=void 0===r.bevelEnabled||r.bevelEnabled,c=void 0!==r.bevelThickness?r.bevelThickness:6,h=void 0!==r.bevelSize?r.bevelSize:c-2,f=void 0!==r.bevelOffset?r.bevelOffset:0,d=void 0!==r.bevelSegments?r.bevelSegments:3,p=r.extrudePath,m=void 0!==r.UVGenerator?r.UVGenerator:qo;void 0!==r.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),a=r.amount);var v,y,g,_,b,x=!1;p&&(v=p.getSpacedPoints(i),x=!0,u=!1,y=p.computeFrenetFrames(i,!1),g=new Te,_=new Te,b=new Te),u||(d=0,c=0,h=0,f=0);var w=e.extractPoints(n),E=w.shape,S=w.holes;if(!Vo.isClockWise(E)){E=E.reverse();for(var T=0,k=S.length;T<k;T++){var M=S[T];Vo.isClockWise(M)&&(S[T]=M.reverse())}}for(var C=Vo.triangulateShape(E,S),A=E,I=0,P=S.length;I<P;I++){var R=S[I];E=E.concat(R)}function L(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var O=E.length,D=C.length;function N(e,t,n){var r,i,a,o=e.x-t.x,s=e.y-t.y,l=n.x-e.x,u=n.y-e.y,c=o*o+s*s,h=o*u-s*l;if(Math.abs(h)>Number.EPSILON){var f=Math.sqrt(c),d=Math.sqrt(l*l+u*u),p=t.x-s/f,m=t.y+o/f,v=((n.x-u/d-p)*u-(n.y+l/d-m)*l)/(o*u-s*l),y=(r=p+o*v-e.x)*r+(i=m+s*v-e.y)*i;if(y<=2)return new ve(r,i);a=Math.sqrt(y/2)}else{var g=!1;o>Number.EPSILON?l>Number.EPSILON&&(g=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(g=!0):Math.sign(s)===Math.sign(u)&&(g=!0),g?(r=-s,i=o,a=Math.sqrt(c)):(r=o,i=s,a=Math.sqrt(c/2))}return new ve(r/a,i/a)}for(var z=[],F=0,B=A.length,U=B-1,j=F+1;F<B;F++,U++,j++)U===B&&(U=0),j===B&&(j=0),z[F]=N(A[F],A[U],A[j]);for(var V,H=[],G=z.concat(),W=0,q=S.length;W<q;W++){var X=S[W];V=[];for(var Z=0,K=X.length,Y=K-1,J=Z+1;Z<K;Z++,Y++,J++)Y===K&&(Y=0),J===K&&(J=0),V[Z]=N(X[Z],X[Y],X[J]);H.push(V),G=G.concat(V)}for(var Q=0;Q<d;Q++){for(var $=Q/d,ee=c*Math.cos($*Math.PI/2),te=h*Math.sin($*Math.PI/2)+f,ne=0,re=A.length;ne<re;ne++){var ie=L(A[ne],z[ne],te);Le(ie.x,ie.y,-ee)}for(var ae=0,oe=S.length;ae<oe;ae++){var se=S[ae];V=H[ae];for(var le=0,ue=se.length;le<ue;le++){var ce=L(se[le],V[le],te);Le(ce.x,ce.y,-ee)}}}for(var he=h+f,fe=0;fe<O;fe++){var de=u?L(E[fe],G[fe],he):E[fe];x?(_.copy(y.normals[0]).multiplyScalar(de.x),g.copy(y.binormals[0]).multiplyScalar(de.y),b.copy(v[0]).add(_).add(g),Le(b.x,b.y,b.z)):Le(de.x,de.y,0)}for(var pe=1;pe<=i;pe++)for(var me=0;me<O;me++){var ye=u?L(E[me],G[me],he):E[me];x?(_.copy(y.normals[pe]).multiplyScalar(ye.x),g.copy(y.binormals[pe]).multiplyScalar(ye.y),b.copy(v[pe]).add(_).add(g),Le(b.x,b.y,b.z)):Le(ye.x,ye.y,a/i*pe)}for(var ge=d-1;ge>=0;ge--){for(var _e=ge/d,be=c*Math.cos(_e*Math.PI/2),xe=h*Math.sin(_e*Math.PI/2)+f,we=0,Ee=A.length;we<Ee;we++){var Se=L(A[we],z[we],xe);Le(Se.x,Se.y,a+be)}for(var ke=0,Me=S.length;ke<Me;ke++){var Ce=S[ke];V=H[ke];for(var Ae=0,Ie=Ce.length;Ae<Ie;Ae++){var Pe=L(Ce[Ae],V[Ae],xe);x?Le(Pe.x,Pe.y+v[i-1].y,v[i-1].x+be):Le(Pe.x,Pe.y,a+be)}}}function Re(e,t){for(var n=e.length;--n>=0;){var r=n,a=n-1;a<0&&(a=e.length-1);for(var o=0,s=i+2*d;o<s;o++){var l=O*o,u=O*(o+1);De(t+r+l,t+a+l,t+a+u,t+r+u)}}}function Le(e,n,r){t.push(e),t.push(n),t.push(r)}function Oe(e,t,n){Ne(e),Ne(t),Ne(n);var r=s.length/3,i=m.generateTopUV(o,s,r-3,r-2,r-1);ze(i[0]),ze(i[1]),ze(i[2])}function De(e,t,n,r){Ne(e),Ne(t),Ne(r),Ne(t),Ne(n),Ne(r);var i=s.length/3,a=m.generateSideWallUV(o,s,i-6,i-3,i-2,i-1);ze(a[0]),ze(a[1]),ze(a[3]),ze(a[1]),ze(a[2]),ze(a[3])}function Ne(e){s.push(t[3*e+0]),s.push(t[3*e+1]),s.push(t[3*e+2])}function ze(e){l.push(e.x),l.push(e.y)}!function(){var e=s.length/3;if(u){for(var t=0,n=O*t,r=0;r<D;r++){var a=C[r];Oe(a[2]+n,a[1]+n,a[0]+n)}n=O*(t=i+2*d);for(var l=0;l<D;l++){var c=C[l];Oe(c[0]+n,c[1]+n,c[2]+n)}}else{for(var h=0;h<D;h++){var f=C[h];Oe(f[2],f[1],f[0])}for(var p=0;p<D;p++){var m=C[p];Oe(m[0]+O*i,m[1]+O*i,m[2]+O*i)}}o.addGroup(e,s.length/3-e,0)}(),function(){var e=s.length/3,t=0;Re(A,t),t+=A.length;for(var n=0,r=S.length;n<r;n++){var i=S[n];Re(i,t),t+=i.length}o.addGroup(e,s.length/3-e,1)}()}return a.setAttribute("position",new un(s,3)),a.setAttribute("uv",new un(l,2)),a.computeVertexNormals(),a}return Object(g.a)(n,[{key:"toJSON",value:function(){var e=xn.prototype.toJSON.call(this);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var a=e[r];n.shapes.push(a.uuid)}else n.shapes.push(e.uuid);void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}}]),n}(xn),qo={generateTopUV:function(e,t,n,r,i){var a=t[3*n],o=t[3*n+1],s=t[3*r],l=t[3*r+1],u=t[3*i],c=t[3*i+1];return[new ve(a,o),new ve(s,l),new ve(u,c)]},generateSideWallUV:function(e,t,n,r,i,a){var o=t[3*n],s=t[3*n+1],l=t[3*n+2],u=t[3*r],c=t[3*r+1],h=t[3*r+2],f=t[3*i],d=t[3*i+1],p=t[3*i+2],m=t[3*a],v=t[3*a+1],y=t[3*a+2];return Math.abs(s-c)<.01?[new ve(o,1-l),new ve(u,1-h),new ve(f,1-p),new ve(m,1-y)]:[new ve(s,1-l),new ve(c,1-h),new ve(d,1-p),new ve(v,1-y)]}};function Xo(e,t,n){xn.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n};var r=[],i=[],a=[],o=[],s=1e-5,l=new Te,u=new Te,c=new Te,h=new Te,f=new Te;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");for(var d=t+1,p=0;p<=n;p++)for(var m=p/n,v=0;v<=t;v++){var y=v/t;e(y,m,u),i.push(u.x,u.y,u.z),y-s>=0?(e(y-s,m,c),h.subVectors(u,c)):(e(y+s,m,c),h.subVectors(c,u)),m-s>=0?(e(y,m-s,c),f.subVectors(u,c)):(e(y,m+s,c),f.subVectors(c,u)),l.crossVectors(h,f).normalize(),a.push(l.x,l.y,l.z),o.push(y,m)}for(var g=0;g<n;g++)for(var _=0;_<t;_++){var b=g*d+_,x=g*d+_+1,w=(g+1)*d+_+1,E=(g+1)*d+_;r.push(b,x,E),r.push(x,w,E)}this.setIndex(r),this.setAttribute("position",new un(i,3)),this.setAttribute("normal",new un(a,3)),this.setAttribute("uv",new un(o,2))}Xo.prototype=Object.create(xn.prototype),Xo.prototype.constructor=Xo;var Zo=function(e){p(n,e);var t=m(n);function n(e){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;Object(y.a)(this,n),(r=t.call(this)).type="ShapeGeometry",r.parameters={shapes:e,curveSegments:i};var a=[],o=[],s=[],l=[],u=0,c=0;if(!1===Array.isArray(e))f(e);else for(var h=0;h<e.length;h++)f(e[h]),r.addGroup(u,c,h),u+=c,c=0;function f(e){var t=o.length/3,n=e.extractPoints(i),r=n.shape,u=n.holes;!1===Vo.isClockWise(r)&&(r=r.reverse());for(var h=0,f=u.length;h<f;h++){var d=u[h];!0===Vo.isClockWise(d)&&(u[h]=d.reverse())}for(var p=Vo.triangulateShape(r,u),m=0,v=u.length;m<v;m++){var y=u[m];r=r.concat(y)}for(var g=0,_=r.length;g<_;g++){var b=r[g];o.push(b.x,b.y,0),s.push(0,0,1),l.push(b.x,b.y)}for(var x=0,w=p.length;x<w;x++){var E=p[x],S=E[0]+t,T=E[1]+t,k=E[2]+t;a.push(S,T,k),c+=3}}return r.setIndex(a),r.setAttribute("position",new un(o,3)),r.setAttribute("normal",new un(s,3)),r.setAttribute("uv",new un(l,2)),r}return Object(g.a)(n,[{key:"toJSON",value:function(){var e=xn.prototype.toJSON.call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++){var i=e[n];t.shapes.push(i.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}]),n}(xn);function Ko(e){Kt.call(this),this.type="ShadowMaterial",this.color=new qt(0),this.transparent=!0,this.setValues(e)}function Yo(e){Wn.call(this,e),this.type="RawShaderMaterial"}function Jo(e){Kt.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new qt(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ae,this.normalScale=new ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.vertexTangents=!1,this.setValues(e)}function Qo(e){Jo.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoat=0,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new ve(1,1),this.clearcoatNormalMap=null,this.reflectivity=.5,Object.defineProperty(this,"ior",{get:function(){return(1+.4*this.reflectivity)/(1-.4*this.reflectivity)},set:function(e){this.reflectivity=me.clamp(2.5*(e-1)/(e+1),0,1)}}),this.sheen=null,this.transmission=0,this.transmissionMap=null,this.setValues(e)}function $o(e){Kt.call(this),this.type="MeshPhongMaterial",this.color=new qt(16777215),this.specular=new qt(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ae,this.normalScale=new ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function es(e){Kt.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new qt(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ae,this.normalScale=new ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ts(e){Kt.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ae,this.normalScale=new ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function ns(e){Kt.call(this),this.type="MeshLambertMaterial",this.color=new qt(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new qt(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function rs(e){Kt.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new qt(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=ae,this.normalScale=new ve(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function is(e){Za.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}Ko.prototype=Object.create(Kt.prototype),Ko.prototype.constructor=Ko,Ko.prototype.isShadowMaterial=!0,Ko.prototype.copy=function(e){return Kt.prototype.copy.call(this,e),this.color.copy(e.color),this},Yo.prototype=Object.create(Wn.prototype),Yo.prototype.constructor=Yo,Yo.prototype.isRawShaderMaterial=!0,Jo.prototype=Object.create(Kt.prototype),Jo.prototype.constructor=Jo,Jo.prototype.isMeshStandardMaterial=!0,Jo.prototype.copy=function(e){return Kt.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.vertexTangents=e.vertexTangents,this},Qo.prototype=Object.create(Jo.prototype),Qo.prototype.constructor=Qo,Qo.prototype.isMeshPhysicalMaterial=!0,Qo.prototype.copy=function(e){return Jo.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.reflectivity=e.reflectivity,e.sheen?this.sheen=(this.sheen||new qt).copy(e.sheen):this.sheen=null,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this},$o.prototype=Object.create(Kt.prototype),$o.prototype.constructor=$o,$o.prototype.isMeshPhongMaterial=!0,$o.prototype.copy=function(e){return Kt.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},es.prototype=Object.create(Kt.prototype),es.prototype.constructor=es,es.prototype.isMeshToonMaterial=!0,es.prototype.copy=function(e){return Kt.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},ts.prototype=Object.create(Kt.prototype),ts.prototype.constructor=ts,ts.prototype.isMeshNormalMaterial=!0,ts.prototype.copy=function(e){return Kt.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},ns.prototype=Object.create(Kt.prototype),ns.prototype.constructor=ns,ns.prototype.isMeshLambertMaterial=!0,ns.prototype.copy=function(e){return Kt.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},rs.prototype=Object.create(Kt.prototype),rs.prototype.constructor=rs,rs.prototype.isMeshMatcapMaterial=!0,rs.prototype.copy=function(e){return Kt.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},is.prototype=Object.create(Za.prototype),is.prototype.constructor=is,is.prototype.isLineDashedMaterial=!0,is.prototype.copy=function(e){return Za.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var as=Object.freeze({__proto__:null,ShadowMaterial:Ko,SpriteMaterial:ma,RawShaderMaterial:Yo,ShaderMaterial:Wn,PointsMaterial:ao,MeshPhysicalMaterial:Qo,MeshStandardMaterial:Jo,MeshPhongMaterial:$o,MeshToonMaterial:es,MeshNormalMaterial:ts,MeshLambertMaterial:ns,MeshDepthMaterial:Ji,MeshDistanceMaterial:Qi,MeshBasicMaterial:Yt,MeshMatcapMaterial:rs,LineDashedMaterial:is,LineBasicMaterial:Za,Material:Kt}),os={arraySlice:function(e,t,n){return os.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),r=0;r!==t;++r)n[r]=r;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){for(var r=e.length,i=new e.constructor(r),a=0,o=0;o!==r;++a)for(var s=n[a]*t,l=0;l!==t;++l)i[o++]=e[s+l];return i},flattenJSON:function(e,t,n,r){for(var i=1,a=e[0];void 0!==a&&void 0===a[r];)a=e[i++];if(void 0!==a){var o=a[r];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=a[r])&&(t.push(a.time),n.push.apply(n,o)),a=e[i++]}while(void 0!==a);else if(void 0!==o.toArray)do{void 0!==(o=a[r])&&(t.push(a.time),o.toArray(n,n.length)),a=e[i++]}while(void 0!==a);else do{void 0!==(o=a[r])&&(t.push(a.time),n.push(o)),a=e[i++]}while(void 0!==a)}},subclip:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,a=e.clone();a.name=t;for(var o=[],s=0;s<a.tracks.length;++s){for(var l=a.tracks[s],u=l.getValueSize(),c=[],h=[],f=0;f<l.times.length;++f){var d=l.times[f]*i;if(!(d<n||d>=r)){c.push(l.times[f]);for(var p=0;p<u;++p)h.push(l.values[f*u+p])}}0!==c.length&&(l.times=os.convertArray(c,l.times.constructor),l.values=os.convertArray(h,l.values.constructor),o.push(l))}a.tracks=o;for(var m=1/0,v=0;v<a.tracks.length;++v)m>a.tracks[v].times[0]&&(m=a.tracks[v].times[0]);for(var y=0;y<a.tracks.length;++y)a.tracks[y].shift(-1*m);return a.resetDuration(),a},makeClipAdditive:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;r<=0&&(r=30);for(var i=n.tracks.length,a=t/r,o=function(t){var r=n.tracks[t],i=r.ValueTypeName;if("bool"===i||"string"===i)return"continue";var o=e.tracks.find((function(e){return e.name===r.name&&e.ValueTypeName===i}));if(void 0===o)return"continue";var s=0,l=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=l/3);var u=0,c=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(u=c/3);var h=r.times.length-1,f=void 0;if(a<=r.times[0]){var d=s,p=l-s;f=os.arraySlice(r.values,d,p)}else if(a>=r.times[h]){var m=h*l+s,v=m+l-s;f=os.arraySlice(r.values,m,v)}else{var y=r.createInterpolant(),g=s,_=l-s;y.evaluate(a),f=os.arraySlice(y.resultBuffer,g,_)}"quaternion"===i&&(new Se).fromArray(f).normalize().conjugate().toArray(f);for(var b=o.times.length,x=0;x<b;++x){var w=x*c+u;if("quaternion"===i)Se.multiplyQuaternionsFlat(o.values,w,f,0,o.values,w);else for(var E=c-2*u,S=0;S<E;++S)o.values[w+S]-=f[S]}},s=0;s<i;++s)o(s);return e.blendMode=Q,e}};function ss(e,t,n,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(n),this.sampleValues=t,this.valueSize=n}function ls(e,t,n,r){ss.call(this,e,t,n,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function us(e,t,n,r){ss.call(this,e,t,n,r)}function cs(e,t,n,r){ss.call(this,e,t,n,r)}function hs(e,t,n,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=os.convertArray(t,this.TimeBufferType),this.values=os.convertArray(n,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}function fs(e,t,n){hs.call(this,e,t,n)}function ds(e,t,n,r){hs.call(this,e,t,n,r)}function ps(e,t,n,r){hs.call(this,e,t,n,r)}function ms(e,t,n,r){ss.call(this,e,t,n,r)}function vs(e,t,n,r){hs.call(this,e,t,n,r)}function ys(e,t,n,r){hs.call(this,e,t,n,r)}function gs(e,t,n,r){hs.call(this,e,t,n,r)}function _s(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:J;this.name=e,this.tracks=n,this.duration=t,this.blendMode=r,this.uuid=me.generateUUID(),this.duration<0&&this.resetDuration()}function bs(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return ps;case"vector":case"vector2":case"vector3":case"vector4":return gs;case"color":return ds;case"quaternion":return vs;case"bool":case"boolean":return fs;case"string":return ys}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],r=[];os.flattenJSON(e.keys,n,r,"value"),e.times=n,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(ss.prototype,{evaluate:function(e){var t=this.parameterPositions,n=this._cachedIndex,r=t[n],i=t[n-1];e:{t:{var a;n:{r:if(!(e<r)){for(var o=n+2;;){if(void 0===r){if(e<i)break r;return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,e,i)}if(n===o)break;if(i=r,e<(r=t[++n]))break t}a=t.length;break n}if(e>=i)break e;var s=t[1];e<s&&(n=2,i=s);for(var l=n-2;;){if(void 0===i)return this._cachedIndex=0,this.beforeStart_(0,e,r);if(n===l)break;if(r=i,e>=(i=t[--n-1]))break t}a=n,n=0}for(;n<a;){var u=n+a>>>1;e<t[u]?a=u:n=u+1}if(r=t[n],void 0===(i=t[n-1]))return this._cachedIndex=0,this.beforeStart_(0,e,r);if(void 0===r)return n=t.length,this._cachedIndex=n,this.afterEnd_(n-1,i,e)}this._cachedIndex=n,this.intervalChanged_(n,i,r)}return this.interpolate_(n,i,e,r)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r,a=0;a!==r;++a)t[a]=n[i+a];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(ss.prototype,{beforeStart_:ss.prototype.copySampleValue_,afterEnd_:ss.prototype.copySampleValue_}),ls.prototype=Object.assign(Object.create(ss.prototype),{constructor:ls,DefaultSettings_:{endingStart:Z,endingEnd:Z},intervalChanged_:function(e,t,n){var r=this.parameterPositions,i=e-2,a=e+1,o=r[i],s=r[a];if(void 0===o)switch(this.getSettings_().endingStart){case K:i=e,o=2*t-n;break;case Y:o=t+r[i=r.length-2]-r[i+1];break;default:i=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case K:a=e,s=2*n-t;break;case Y:a=1,s=n+r[1]-r[0];break;default:a=e-1,s=t}var l=.5*(n-t),u=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(s-n),this._offsetPrev=i*u,this._offsetNext=a*u},interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=this._offsetPrev,c=this._offsetNext,h=this._weightPrev,f=this._weightNext,d=(n-t)/(r-t),p=d*d,m=p*d,v=-h*m+2*h*p-h*d,y=(1+h)*m+(-1.5-2*h)*p+(-.5+h)*d+1,g=(-1-f)*m+(1.5+f)*p+.5*d,_=f*m-f*p,b=0;b!==o;++b)i[b]=v*a[u+b]+y*a[l+b]+g*a[s+b]+_*a[c+b];return i}}),us.prototype=Object.assign(Object.create(ss.prototype),{constructor:us,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=e*o,l=s-o,u=(n-t)/(r-t),c=1-u,h=0;h!==o;++h)i[h]=a[l+h]*c+a[s+h]*u;return i}}),cs.prototype=Object.assign(Object.create(ss.prototype),{constructor:cs,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(hs,{toJSON:function(e){var t,n=e.constructor;if(void 0!==n.toJSON)t=n.toJSON(e);else{t={name:e.name,times:os.convertArray(e.times,Array),values:os.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}),Object.assign(hs.prototype,{constructor:hs,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:q,InterpolantFactoryMethodDiscrete:function(e){return new cs(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new us(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new ls(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case W:t=this.InterpolantFactoryMethodDiscrete;break;case q:t=this.InterpolantFactoryMethodLinear;break;case X:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return W;case this.InterpolantFactoryMethodLinear:return q;case this.InterpolantFactoryMethodSmooth:return X}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(0!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]+=e;return this},scale:function(e){if(1!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]*=e;return this},trim:function(e,t){for(var n=this.times,r=n.length,i=0,a=r-1;i!==r&&n[i]<e;)++i;for(;-1!==a&&n[a]>t;)--a;if(++a,0!==i||a!==r){i>=a&&(i=(a=Math.max(a,1))-1);var o=this.getValueSize();this.times=os.arraySlice(n,i,a),this.values=os.arraySlice(this.values,i*o,a*o)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,r=this.values,i=n.length;0===i&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var a=null,o=0;o!==i;o++){var s=n[o];if("number"===typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==a&&a>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,a),e=!1;break}a=s}if(void 0!==r&&os.isTypedArray(r))for(var l=0,u=r.length;l!==u;++l){var c=r[l];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,l,c),e=!1;break}}return e},optimize:function(){for(var e=os.arraySlice(this.times),t=os.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===X,i=e.length-1,a=1,o=1;o<i;++o){var s=!1,l=e[o];if(l!==e[o+1]&&(1!==o||l!==e[0]))if(r)s=!0;else for(var u=o*n,c=u-n,h=u+n,f=0;f!==n;++f){var d=t[u+f];if(d!==t[c+f]||d!==t[h+f]){s=!0;break}}if(s){if(o!==a){e[a]=e[o];for(var p=o*n,m=a*n,v=0;v!==n;++v)t[m+v]=t[p+v]}++a}}if(i>0){e[a]=e[i];for(var y=i*n,g=a*n,_=0;_!==n;++_)t[g+_]=t[y+_];++a}return a!==e.length?(this.times=os.arraySlice(e,0,a),this.values=os.arraySlice(t,0,a*n)):(this.times=e,this.values=t),this},clone:function(){var e=os.arraySlice(this.times,0),t=os.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}),fs.prototype=Object.assign(Object.create(hs.prototype),{constructor:fs,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:W,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),ds.prototype=Object.assign(Object.create(hs.prototype),{constructor:ds,ValueTypeName:"color"}),ps.prototype=Object.assign(Object.create(hs.prototype),{constructor:ps,ValueTypeName:"number"}),ms.prototype=Object.assign(Object.create(ss.prototype),{constructor:ms,interpolate_:function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=(n-t)/(r-t),l=e*o,u=l+o;l!==u;l+=4)Se.slerpFlat(i,0,a,l-o,a,l,s);return i}}),vs.prototype=Object.assign(Object.create(hs.prototype),{constructor:vs,ValueTypeName:"quaternion",DefaultInterpolation:q,InterpolantFactoryMethodLinear:function(e){return new ms(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),ys.prototype=Object.assign(Object.create(hs.prototype),{constructor:ys,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:W,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),gs.prototype=Object.assign(Object.create(hs.prototype),{constructor:gs,ValueTypeName:"vector"}),Object.assign(_s,{parse:function(e){for(var t=[],n=e.tracks,r=1/(e.fps||1),i=0,a=n.length;i!==a;++i)t.push(bs(n[i]).scale(r));var o=new _s(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o},toJSON:function(e){for(var t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},i=0,a=n.length;i!==a;++i)t.push(hs.toJSON(n[i]));return r},CreateFromMorphTargetSequence:function(e,t,n,r){for(var i=t.length,a=[],o=0;o<i;o++){var s=[],l=[];s.push((o+i-1)%i,o,(o+1)%i),l.push(0,1,0);var u=os.getKeyframeOrder(s);s=os.sortedArray(s,1,u),l=os.sortedArray(l,1,u),r||0!==s[0]||(s.push(i),l.push(l[0])),a.push(new ps(".morphTargetInfluences["+t[o].name+"]",s,l).scale(1/n))}return new _s(e,-1,a)},findByName:function(e,t){var n=e;if(!Array.isArray(e)){var r=e;n=r.geometry&&r.geometry.animations||r.animations}for(var i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,n){for(var r={},i=/^([\w-]*?)([\d]+)$/,a=0,o=e.length;a<o;a++){var s=e[a],l=s.name.match(i);if(l&&l.length>1){var u=l[1],c=r[u];c||(r[u]=c=[]),c.push(s)}}var h=[];for(var f in r)h.push(_s.CreateFromMorphTargetSequence(f,r[f],t,n));return h},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,r,i){if(0!==n.length){var a=[],o=[];os.flattenJSON(n,a,o,r),0!==a.length&&i.push(new e(t,a,o))}},r=[],i=e.name||"default",a=e.fps||30,o=e.blendMode,s=e.length||-1,l=e.hierarchy||[],u=0;u<l.length;u++){var c=l[u].keys;if(c&&0!==c.length)if(c[0].morphTargets){var h={},f=void 0;for(f=0;f<c.length;f++)if(c[f].morphTargets)for(var d=0;d<c[f].morphTargets.length;d++)h[c[f].morphTargets[d]]=-1;for(var p in h){for(var m=[],v=[],y=0;y!==c[f].morphTargets.length;++y){var g=c[f];m.push(g.time),v.push(g.morphTarget===p?1:0)}r.push(new ps(".morphTargetInfluence["+p+"]",m,v))}s=h.length*(a||1)}else{var _=".bones["+t[u].name+"]";n(gs,_+".position",c,"pos",r),n(vs,_+".quaternion",c,"rot",r),n(gs,_+".scale",c,"scl",r)}}return 0===r.length?null:new _s(i,s,r,o)}}),Object.assign(_s.prototype,{resetDuration:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new _s(this.name,this.duration,e,this.blendMode)},toJSON:function(){return _s.toJSON(this)}});var xs={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function ws(e,t,n){var r=this,i=!1,a=0,o=0,s=void 0,l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){o++,!1===i&&void 0!==r.onStart&&r.onStart(e,a,o),i=!0},this.itemEnd=function(e){a++,void 0!==r.onProgress&&r.onProgress(e,a,o),a===o&&(i=!1,void 0!==r.onLoad&&r.onLoad())},this.itemError=function(e){void 0!==r.onError&&r.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){var t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=l.length;t<n;t+=2){var r=l[t],i=l[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return i}return null}}var Es=new ws;function Ss(e){this.manager=void 0!==e?e:Es,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}Object.assign(Ss.prototype,{load:function(){},loadAsync:function(e,t){var n=this;return new Promise((function(r,i){n.load(e,r,t,i)}))},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}});var Ts={};function ks(e){Ss.call(this,e)}function Ms(e){Ss.call(this,e)}function Cs(e){Ss.call(this,e)}function As(e){Ss.call(this,e)}function Is(e){Ss.call(this,e)}function Ps(e){Ss.call(this,e)}function Rs(e){Ss.call(this,e)}function Ls(){this.type="Curve",this.arcLengthDivisions=200}function Os(e,t,n,r,i,a,o,s){Ls.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=n||1,this.yRadius=r||1,this.aStartAngle=i||0,this.aEndAngle=a||2*Math.PI,this.aClockwise=o||!1,this.aRotation=s||0}function Ds(e,t,n,r,i,a){Os.call(this,e,t,n,n,r,i,a),this.type="ArcCurve"}function Ns(){var e=0,t=0,n=0,r=0;function i(i,a,o,s){e=i,t=o,n=-3*i+3*a-2*o-s,r=2*i-2*a+o+s}return{initCatmullRom:function(e,t,n,r,a){i(t,n,a*(n-e),a*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,a,o,s){var l=(t-e)/a-(n-e)/(a+o)+(n-t)/o,u=(n-t)/o-(r-t)/(o+s)+(r-n)/s;i(t,n,l*=o,u*=o)},calc:function(i){var a=i*i;return e+t*i+n*a+r*(a*i)}}}ks.prototype=Object.assign(Object.create(Ss.prototype),{constructor:ks,load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=xs.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;if(void 0===Ts[e]){var o,s=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(s){var l=s[1],u=!!s[2],c=s[3];c=decodeURIComponent(c),u&&(c=atob(c));try{var h,f=(this.responseType||"").toLowerCase();switch(f){case"arraybuffer":case"blob":for(var d=new Uint8Array(c.length),p=0;p<c.length;p++)d[p]=c.charCodeAt(p);h="blob"===f?new Blob([d.buffer],{type:l}):d.buffer;break;case"document":var m=new DOMParser;h=m.parseFromString(c,l);break;case"json":h=JSON.parse(c);break;default:h=c}setTimeout((function(){t&&t(h),i.manager.itemEnd(e)}),0)}catch(y){setTimeout((function(){r&&r(y),i.manager.itemError(e),i.manager.itemEnd(e)}),0)}}else{for(var v in Ts[e]=[],Ts[e].push({onLoad:t,onProgress:n,onError:r}),(o=new XMLHttpRequest).open("GET",e,!0),o.addEventListener("load",(function(t){var n=this.response,r=Ts[e];if(delete Ts[e],200===this.status||0===this.status){0===this.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),xs.add(e,n);for(var a=0,o=r.length;a<o;a++){var s=r[a];s.onLoad&&s.onLoad(n)}i.manager.itemEnd(e)}else{for(var l=0,u=r.length;l<u;l++){var c=r[l];c.onError&&c.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}}),!1),o.addEventListener("progress",(function(t){for(var n=Ts[e],r=0,i=n.length;r<i;r++){var a=n[r];a.onProgress&&a.onProgress(t)}}),!1),o.addEventListener("error",(function(t){var n=Ts[e];delete Ts[e];for(var r=0,a=n.length;r<a;r++){var o=n[r];o.onError&&o.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),o.addEventListener("abort",(function(t){var n=Ts[e];delete Ts[e];for(var r=0,a=n.length;r<a;r++){var o=n[r];o.onError&&o.onError(t)}i.manager.itemError(e),i.manager.itemEnd(e)}),!1),void 0!==this.responseType&&(o.responseType=this.responseType),void 0!==this.withCredentials&&(o.withCredentials=this.withCredentials),o.overrideMimeType&&o.overrideMimeType(void 0!==this.mimeType?this.mimeType:"text/plain"),this.requestHeader)o.setRequestHeader(v,this.requestHeader[v]);o.send(null)}return i.manager.itemStart(e),o}Ts[e].push({onLoad:t,onProgress:n,onError:r})},setResponseType:function(e){return this.responseType=e,this},setMimeType:function(e){return this.mimeType=e,this}}),Ms.prototype=Object.assign(Object.create(Ss.prototype),{constructor:Ms,load:function(e,t,n,r){var i=this,a=new ks(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(a){r?r(a):console.error(a),i.manager.itemError(e)}}),n,r)},parse:function(e){for(var t=[],n=0;n<e.length;n++){var r=_s.parse(e[n]);t.push(r)}return t}}),Cs.prototype=Object.assign(Object.create(Ss.prototype),{constructor:Cs,load:function(e,t,n,r){var i=this,a=[],o=new po,s=new ks(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(i.withCredentials);var l=0;function u(u){s.load(e[u],(function(e){var n=i.parse(e,!0);a[u]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(l+=1)&&(1===n.mipmapCount&&(o.minFilter=R),o.image=a,o.format=n.format,o.needsUpdate=!0,t&&t(o))}),n,r)}if(Array.isArray(e))for(var c=0,h=e.length;c<h;++c)u(c);else s.load(e,(function(e){var n=i.parse(e,!0);if(n.isCubemap){for(var r=n.mipmaps.length/n.mipmapCount,s=0;s<r;s++){a[s]={mipmaps:[]};for(var l=0;l<n.mipmapCount;l++)a[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+l]),a[s].format=n.format,a[s].width=n.width,a[s].height=n.height}o.image=a}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=R),o.format=n.format,o.needsUpdate=!0,t&&t(o)}),n,r);return o}}),As.prototype=Object.assign(Object.create(Ss.prototype),{constructor:As,load:function(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=xs.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;var o=document.createElementNS("http://www.w3.org/1999/xhtml","img");function s(){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),xs.add(e,this),t&&t(this),i.manager.itemEnd(e)}function l(t){o.removeEventListener("load",s,!1),o.removeEventListener("error",l,!1),r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)}return o.addEventListener("load",s,!1),o.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),i.manager.itemStart(e),o.src=e,o}}),Is.prototype=Object.assign(Object.create(Ss.prototype),{constructor:Is,load:function(e,t,n,r){var i=new Yn,a=new As(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);var o=0;function s(n){a.load(e[n],(function(e){i.images[n]=e,6===++o&&(i.needsUpdate=!0,t&&t(i))}),void 0,r)}for(var l=0;l<e.length;++l)s(l);return i}}),Ps.prototype=Object.assign(Object.create(Ss.prototype),{constructor:Ps,load:function(e,t,n,r){var i=this,a=new Qn,o=new ks(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(i.withCredentials),o.load(e,(function(e){var n=i.parse(e);n&&(void 0!==n.image?a.image=n.image:void 0!==n.data&&(a.image.width=n.width,a.image.height=n.height,a.image.data=n.data),a.wrapS=void 0!==n.wrapS?n.wrapS:M,a.wrapT=void 0!==n.wrapT?n.wrapT:M,a.magFilter=void 0!==n.magFilter?n.magFilter:R,a.minFilter=void 0!==n.minFilter?n.minFilter:R,a.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(a.encoding=n.encoding),void 0!==n.flipY&&(a.flipY=n.flipY),void 0!==n.format&&(a.format=n.format),void 0!==n.type&&(a.type=n.type),void 0!==n.mipmaps&&(a.mipmaps=n.mipmaps,a.minFilter=O),1===n.mipmapCount&&(a.minFilter=R),a.needsUpdate=!0,t&&t(a,n))}),n,r),a}}),Rs.prototype=Object.assign(Object.create(Ss.prototype),{constructor:Rs,load:function(e,t,n,r){var i=new be,a=new As(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,(function(n){i.image=n;var r=e.search(/\.jpe?g($|\?)/i)>0||0===e.search(/^data\:image\/jpeg/);i.format=r?j:V,i.needsUpdate=!0,void 0!==t&&t(i)}),n,r),i}}),Object.assign(Ls.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)},getPoints:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t},getSpacedPoints:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(void 0===e&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n=[],r=this.getPoint(0),i=0;n.push(0);for(var a=1;a<=e;a++)i+=(t=this.getPoint(a/e)).distanceTo(r),n.push(i),r=t;return this.cacheArcLengths=n,n},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var n,r=this.getLengths(),i=0,a=r.length;n=t||e*r[a-1];for(var o,s=0,l=a-1;s<=l;)if((o=r[i=Math.floor(s+(l-s)/2)]-n)<0)s=i+1;else{if(!(o>0)){l=i;break}l=i-1}if(r[i=l]===n)return i/(a-1);var u=r[i];return(i+(n-u)/(r[i+1]-u))/(a-1)},getTangent:function(e,t){var n=1e-4,r=e-n,i=e+n;r<0&&(r=0),i>1&&(i=1);var a=this.getPoint(r),o=this.getPoint(i),s=t||(a.isVector2?new ve:new Te);return s.copy(o).sub(a).normalize(),s},getTangentAt:function(e,t){var n=this.getUtoTmapping(e);return this.getTangent(n,t)},computeFrenetFrames:function(e,t){for(var n=new Te,r=[],i=[],a=[],o=new Te,s=new $e,l=0;l<=e;l++){var u=l/e;r[l]=this.getTangentAt(u,new Te),r[l].normalize()}i[0]=new Te,a[0]=new Te;var c=Number.MAX_VALUE,h=Math.abs(r[0].x),f=Math.abs(r[0].y),d=Math.abs(r[0].z);h<=c&&(c=h,n.set(1,0,0)),f<=c&&(c=f,n.set(0,1,0)),d<=c&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),i[0].crossVectors(r[0],o),a[0].crossVectors(r[0],i[0]);for(var p=1;p<=e;p++){if(i[p]=i[p-1].clone(),a[p]=a[p-1].clone(),o.crossVectors(r[p-1],r[p]),o.length()>Number.EPSILON){o.normalize();var m=Math.acos(me.clamp(r[p-1].dot(r[p]),-1,1));i[p].applyMatrix4(s.makeRotationAxis(o,m))}a[p].crossVectors(r[p],i[p])}if(!0===t){var v=Math.acos(me.clamp(i[0].dot(i[e]),-1,1));v/=e,r[0].dot(o.crossVectors(i[0],i[e]))>0&&(v=-v);for(var y=1;y<=e;y++)i[y].applyMatrix4(s.makeRotationAxis(r[y],v*y)),a[y].crossVectors(r[y],i[y])}return{tangents:r,normals:i,binormals:a}},clone:function(){return(new this.constructor).copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),Os.prototype=Object.create(Ls.prototype),Os.prototype.constructor=Os,Os.prototype.isEllipseCurve=!0,Os.prototype.getPoint=function(e,t){for(var n=t||new ve,r=2*Math.PI,i=this.aEndAngle-this.aStartAngle,a=Math.abs(i)<Number.EPSILON;i<0;)i+=r;for(;i>r;)i-=r;i<Number.EPSILON&&(i=a?0:r),!0!==this.aClockwise||a||(i===r?i=-r:i-=r);var o=this.aStartAngle+e*i,s=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var u=Math.cos(this.aRotation),c=Math.sin(this.aRotation),h=s-this.aX,f=l-this.aY;s=h*u-f*c+this.aX,l=h*c+f*u+this.aY}return n.set(s,l)},Os.prototype.copy=function(e){return Ls.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Os.prototype.toJSON=function(){var e=Ls.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Os.prototype.fromJSON=function(e){return Ls.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Ds.prototype=Object.create(Os.prototype),Ds.prototype.constructor=Ds,Ds.prototype.isArcCurve=!0;var zs=new Te,Fs=new Ns,Bs=new Ns,Us=new Ns;function js(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;Ls.call(this),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=r}function Vs(e,t,n,r,i){var a=.5*(r-t),o=.5*(i-n),s=e*e;return(2*n-2*r+a+o)*(e*s)+(-3*n+3*r-2*a-o)*s+a*e+n}function Hs(e,t,n,r){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function Gs(e,t,n,r,i){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,i)}function Ws(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ve,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ve,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ve,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new ve;Ls.call(this),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=r}function qs(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Te,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Te,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Te,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Te;Ls.call(this),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=r}function Xs(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ve,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ve;Ls.call(this),this.type="LineCurve",this.v1=e,this.v2=t}function Zs(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Te,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Te;Ls.call(this),this.type="LineCurve3",this.v1=e,this.v2=t}function Ks(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new ve,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ve,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ve;Ls.call(this),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}function Ys(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Te,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Te,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Te;Ls.call(this),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}function Js(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Ls.call(this),this.type="SplineCurve",this.points=e}js.prototype=Object.create(Ls.prototype),js.prototype.constructor=js,js.prototype.isCatmullRomCurve3=!0,js.prototype.getPoint=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Te,i=r,a=this.points,o=a.length,s=(o-(this.closed?0:1))*e,l=Math.floor(s),u=s-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/o)+1)*o:0===u&&l===o-1&&(l=o-2,u=1),this.closed||l>0?t=a[(l-1)%o]:(zs.subVectors(a[0],a[1]).add(a[0]),t=zs);var c=a[l%o],h=a[(l+1)%o];if(this.closed||l+2<o?n=a[(l+2)%o]:(zs.subVectors(a[o-1],a[o-2]).add(a[o-1]),n=zs),"centripetal"===this.curveType||"chordal"===this.curveType){var f="chordal"===this.curveType?.5:.25,d=Math.pow(t.distanceToSquared(c),f),p=Math.pow(c.distanceToSquared(h),f),m=Math.pow(h.distanceToSquared(n),f);p<1e-4&&(p=1),d<1e-4&&(d=p),m<1e-4&&(m=p),Fs.initNonuniformCatmullRom(t.x,c.x,h.x,n.x,d,p,m),Bs.initNonuniformCatmullRom(t.y,c.y,h.y,n.y,d,p,m),Us.initNonuniformCatmullRom(t.z,c.z,h.z,n.z,d,p,m)}else"catmullrom"===this.curveType&&(Fs.initCatmullRom(t.x,c.x,h.x,n.x,this.tension),Bs.initCatmullRom(t.y,c.y,h.y,n.y,this.tension),Us.initCatmullRom(t.z,c.z,h.z,n.z,this.tension));return i.set(Fs.calc(u),Bs.calc(u),Us.calc(u)),i},js.prototype.copy=function(e){Ls.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},js.prototype.toJSON=function(){var e=Ls.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},js.prototype.fromJSON=function(e){Ls.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new Te).fromArray(r))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Ws.prototype=Object.create(Ls.prototype),Ws.prototype.constructor=Ws,Ws.prototype.isCubicBezierCurve=!0,Ws.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ve,n=t,r=this.v0,i=this.v1,a=this.v2,o=this.v3;return n.set(Gs(e,r.x,i.x,a.x,o.x),Gs(e,r.y,i.y,a.y,o.y)),n},Ws.prototype.copy=function(e){return Ls.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Ws.prototype.toJSON=function(){var e=Ls.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Ws.prototype.fromJSON=function(e){return Ls.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},qs.prototype=Object.create(Ls.prototype),qs.prototype.constructor=qs,qs.prototype.isCubicBezierCurve3=!0,qs.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Te,n=t,r=this.v0,i=this.v1,a=this.v2,o=this.v3;return n.set(Gs(e,r.x,i.x,a.x,o.x),Gs(e,r.y,i.y,a.y,o.y),Gs(e,r.z,i.z,a.z,o.z)),n},qs.prototype.copy=function(e){return Ls.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},qs.prototype.toJSON=function(){var e=Ls.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},qs.prototype.fromJSON=function(e){return Ls.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},Xs.prototype=Object.create(Ls.prototype),Xs.prototype.constructor=Xs,Xs.prototype.isLineCurve=!0,Xs.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ve,n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Xs.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Xs.prototype.getTangent=function(e,t){var n=t||new ve;return n.copy(this.v2).sub(this.v1).normalize(),n},Xs.prototype.copy=function(e){return Ls.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Xs.prototype.toJSON=function(){var e=Ls.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Xs.prototype.fromJSON=function(e){return Ls.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Zs.prototype=Object.create(Ls.prototype),Zs.prototype.constructor=Zs,Zs.prototype.isLineCurve3=!0,Zs.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Te,n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n},Zs.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Zs.prototype.copy=function(e){return Ls.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Zs.prototype.toJSON=function(){var e=Ls.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Zs.prototype.fromJSON=function(e){return Ls.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Ks.prototype=Object.create(Ls.prototype),Ks.prototype.constructor=Ks,Ks.prototype.isQuadraticBezierCurve=!0,Ks.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ve,n=t,r=this.v0,i=this.v1,a=this.v2;return n.set(Hs(e,r.x,i.x,a.x),Hs(e,r.y,i.y,a.y)),n},Ks.prototype.copy=function(e){return Ls.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ks.prototype.toJSON=function(){var e=Ls.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ks.prototype.fromJSON=function(e){return Ls.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Ys.prototype=Object.create(Ls.prototype),Ys.prototype.constructor=Ys,Ys.prototype.isQuadraticBezierCurve3=!0,Ys.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Te,n=t,r=this.v0,i=this.v1,a=this.v2;return n.set(Hs(e,r.x,i.x,a.x),Hs(e,r.y,i.y,a.y),Hs(e,r.z,i.z,a.z)),n},Ys.prototype.copy=function(e){return Ls.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Ys.prototype.toJSON=function(){var e=Ls.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Ys.prototype.fromJSON=function(e){return Ls.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},Js.prototype=Object.create(Ls.prototype),Js.prototype.constructor=Js,Js.prototype.isSplineCurve=!0,Js.prototype.getPoint=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new ve,n=t,r=this.points,i=(r.length-1)*e,a=Math.floor(i),o=i-a,s=r[0===a?a:a-1],l=r[a],u=r[a>r.length-2?r.length-1:a+1],c=r[a>r.length-3?r.length-1:a+2];return n.set(Vs(o,s.x,l.x,u.x,c.x),Vs(o,s.y,l.y,u.y,c.y)),n},Js.prototype.copy=function(e){Ls.prototype.copy.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push(r.clone())}return this},Js.prototype.toJSON=function(){var e=Ls.prototype.toJSON.call(this);e.points=[];for(var t=0,n=this.points.length;t<n;t++){var r=this.points[t];e.points.push(r.toArray())}return e},Js.prototype.fromJSON=function(e){Ls.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,n=e.points.length;t<n;t++){var r=e.points[t];this.points.push((new ve).fromArray(r))}return this};var Qs=Object.freeze({__proto__:null,ArcCurve:Ds,CatmullRomCurve3:js,CubicBezierCurve:Ws,CubicBezierCurve3:qs,EllipseCurve:Os,LineCurve:Xs,LineCurve3:Zs,QuadraticBezierCurve:Ks,QuadraticBezierCurve3:Ys,SplineCurve:Js});function $s(){Ls.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function el(e){$s.call(this),this.type="Path",this.currentPoint=new ve,e&&this.setFromPoints(e)}function tl(e){el.call(this,e),this.uuid=me.generateUUID(),this.type="Shape",this.holes=[]}function nl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;St.call(this),this.type="Light",this.color=new qt(e),this.intensity=t}function rl(e,t,n){nl.call(this,e,n),this.type="HemisphereLight",this.position.copy(St.DefaultUp),this.updateMatrix(),this.groundColor=new qt(t)}function il(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.mapSize=new ve(512,512),this.map=null,this.mapPass=null,this.matrix=new $e,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new tr,this._frameExtents=new ve(1,1),this._viewportCount=1,this._viewports=[new we(0,0,1,1)]}function al(){il.call(this,new Xn(50,1,.5,500)),this.focus=1}function ol(e,t,n,r,i,a){nl.call(this,e,t),this.type="SpotLight",this.position.copy(St.DefaultUp),this.updateMatrix(),this.target=new St,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}}),this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.penumbra=void 0!==i?i:0,this.decay=void 0!==a?a:1,this.shadow=new al}function sl(){il.call(this,new Xn(90,1,.5,500)),this._frameExtents=new ve(4,2),this._viewportCount=6,this._viewports=[new we(2,1,1,1),new we(0,1,1,1),new we(3,1,1,1),new we(1,1,1,1),new we(3,0,1,1),new we(1,0,1,1)],this._cubeDirections=[new Te(1,0,0),new Te(-1,0,0),new Te(0,0,1),new Te(0,0,-1),new Te(0,1,0),new Te(0,-1,0)],this._cubeUps=[new Te(0,1,0),new Te(0,1,0),new Te(0,1,0),new Te(0,1,0),new Te(0,0,1),new Te(0,0,-1)]}function ll(e,t,n,r){nl.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}}),this.distance=void 0!==n?n:0,this.decay=void 0!==r?r:1,this.shadow=new sl}function ul(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;qn.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=i,this.far=a,this.updateProjectionMatrix()}function cl(){il.call(this,new ul(-5,5,5,-5,.5,500))}function hl(e,t){nl.call(this,e,t),this.type="DirectionalLight",this.position.copy(St.DefaultUp),this.updateMatrix(),this.target=new St,this.shadow=new cl}function fl(e,t){nl.call(this,e,t),this.type="AmbientLight"}function dl(e,t,n,r){nl.call(this,e,t),this.type="RectAreaLight",this.width=void 0!==n?n:10,this.height=void 0!==r?r:10}$s.prototype=Object.assign(Object.create(Ls.prototype),{constructor:$s,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Xs(t,e))},getPoint:function(e){for(var t=e*this.getLength(),n=this.getCurveLengths(),r=0;r<n.length;){if(n[r]>=t){var i=n[r]-t,a=this.curves[r],o=a.getLength(),s=0===o?0:1-i/o;return a.getPointAt(s)}r++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e},getSpacedPoints:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[],r=0,i=this.curves;r<i.length;r++)for(var a=i[r],o=a&&a.isEllipseCurve?2*t:a&&(a.isLineCurve||a.isLineCurve3)?1:a&&a.isSplineCurve?t*a.points.length:t,s=a.getPoints(o),l=0;l<s.length;l++){var u=s[l];e&&e.equals(u)||(n.push(u),e=u)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n},copy:function(e){Ls.prototype.copy.call(this,e),this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push(r.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=Ls.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,n=this.curves.length;t<n;t++){var r=this.curves[t];e.curves.push(r.toJSON())}return e},fromJSON:function(e){Ls.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,n=e.curves.length;t<n;t++){var r=e.curves[t];this.curves.push((new Qs[r.type]).fromJSON(r))}return this}}),el.prototype=Object.assign(Object.create($s.prototype),{constructor:el,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var n=new Xs(this.currentPoint.clone(),new ve(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,n,r){var i=new Ks(this.currentPoint.clone(),new ve(e,t),new ve(n,r));return this.curves.push(i),this.currentPoint.set(n,r),this},bezierCurveTo:function(e,t,n,r,i,a){var o=new Ws(this.currentPoint.clone(),new ve(e,t),new ve(n,r),new ve(i,a));return this.curves.push(o),this.currentPoint.set(i,a),this},splineThru:function(e){var t=new Js([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,n,r,i,a){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,r,i,a),this},absarc:function(e,t,n,r,i,a){return this.absellipse(e,t,n,n,r,i,a),this},ellipse:function(e,t,n,r,i,a,o,s){var l=this.currentPoint.x,u=this.currentPoint.y;return this.absellipse(e+l,t+u,n,r,i,a,o,s),this},absellipse:function(e,t,n,r,i,a,o,s){var l=new Os(e,t,n,r,i,a,o,s);if(this.curves.length>0){var u=l.getPoint(0);u.equals(this.currentPoint)||this.lineTo(u.x,u.y)}this.curves.push(l);var c=l.getPoint(1);return this.currentPoint.copy(c),this},copy:function(e){return $s.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=$s.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return $s.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),tl.prototype=Object.assign(Object.create(el.prototype),{constructor:tl,getPointsHoles:function(e){for(var t=[],n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){el.prototype.copy.call(this,e),this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push(r.clone())}return this},toJSON:function(){var e=el.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,n=this.holes.length;t<n;t++){var r=this.holes[t];e.holes.push(r.toJSON())}return e},fromJSON:function(e){el.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,n=e.holes.length;t<n;t++){var r=e.holes[t];this.holes.push((new el).fromJSON(r))}return this}}),nl.prototype=Object.assign(Object.create(St.prototype),{constructor:nl,isLight:!0,copy:function(e){return St.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=St.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}),rl.prototype=Object.assign(Object.create(nl.prototype),{constructor:rl,isHemisphereLight:!0,copy:function(e){return nl.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(il.prototype,{_projScreenMatrix:new $e,_lightPositionWorld:new Te,_lookTarget:new Te,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,n=this.matrix,r=this._projScreenMatrix,i=this._lookTarget,a=this._lightPositionWorld;a.setFromMatrixPosition(e.matrixWorld),t.position.copy(a),i.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(i),t.updateMatrixWorld(),r.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(r),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),al.prototype=Object.assign(Object.create(il.prototype),{constructor:al,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,n=2*me.RAD2DEG*e.angle*this.focus,r=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;n===t.fov&&r===t.aspect&&i===t.far||(t.fov=n,t.aspect=r,t.far=i,t.updateProjectionMatrix()),il.prototype.updateMatrices.call(this,e)}}),ol.prototype=Object.assign(Object.create(nl.prototype),{constructor:ol,isSpotLight:!0,copy:function(e){return nl.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),sl.prototype=Object.assign(Object.create(il.prototype),{constructor:sl,isPointLightShadow:!0,updateMatrices:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,r=this.matrix,i=this._lightPositionWorld,a=this._lookTarget,o=this._projScreenMatrix;i.setFromMatrixPosition(e.matrixWorld),n.position.copy(i),a.copy(n.position),a.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(a),n.updateMatrixWorld(),r.makeTranslation(-i.x,-i.y,-i.z),o.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(o)}}),ll.prototype=Object.assign(Object.create(nl.prototype),{constructor:ll,isPointLight:!0,copy:function(e){return nl.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),ul.prototype=Object.assign(Object.create(qn.prototype),{constructor:ul,isOrthographicCamera:!0,copy:function(e,t){return qn.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this},setViewOffset:function(e,t,n,r,i,a){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=i,this.view.height=a,this.updateProjectionMatrix()},clearViewOffset:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,i=n-e,a=n+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var l=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;a=(i+=l*this.view.offsetX)+l*this.view.width,s=(o-=u*this.view.offsetY)-u*this.view.height}this.projectionMatrix.makeOrthographic(i,a,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()},toJSON:function(e){var t=St.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}),cl.prototype=Object.assign(Object.create(il.prototype),{constructor:cl,isDirectionalLightShadow:!0,updateMatrices:function(e){il.prototype.updateMatrices.call(this,e)}}),hl.prototype=Object.assign(Object.create(nl.prototype),{constructor:hl,isDirectionalLight:!0,copy:function(e){return nl.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),fl.prototype=Object.assign(Object.create(nl.prototype),{constructor:fl,isAmbientLight:!0}),dl.prototype=Object.assign(Object.create(nl.prototype),{constructor:dl,isRectAreaLight:!0,copy:function(e){return nl.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=nl.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}});var pl=function(){function e(){Object(y.a)(this,e),Object.defineProperty(this,"isSphericalHarmonics3",{value:!0}),this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new Te)}return Object(g.a)(e,[{key:"set",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}},{key:"zero",value:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}},{key:"getAt",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*r),t.addScaledVector(a[2],.488603*i),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],n*r*1.092548),t.addScaledVector(a[5],r*i*1.092548),t.addScaledVector(a[6],.315392*(3*i*i-1)),t.addScaledVector(a[7],n*i*1.092548),t.addScaledVector(a[8],.546274*(n*n-r*r)),t}},{key:"getIrradianceAt",value:function(e,t){var n=e.x,r=e.y,i=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],1.023328*r),t.addScaledVector(a[2],1.023328*i),t.addScaledVector(a[3],1.023328*n),t.addScaledVector(a[4],.858086*n*r),t.addScaledVector(a[5],.858086*r*i),t.addScaledVector(a[6],.743125*i*i-.247708),t.addScaledVector(a[7],.858086*n*i),t.addScaledVector(a[8],.429043*(n*n-r*r)),t}},{key:"add",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}},{key:"addScaledSH",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}},{key:"scale",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}},{key:"lerp",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}},{key:"equals",value:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}},{key:"copy",value:function(e){return this.set(e.coefficients)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}},{key:"toArray",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}}],[{key:"getBasisAt",value:function(e,t){var n=e.x,r=e.y,i=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*i,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*i,t[6]=.315392*(3*i*i-1),t[7]=1.092548*n*i,t[8]=.546274*(n*n-r*r)}}]),e}();function ml(e,t){nl.call(this,void 0,t),this.type="LightProbe",this.sh=void 0!==e?e:new pl}function vl(e){Ss.call(this,e),this.textures={}}ml.prototype=Object.assign(Object.create(nl.prototype),{constructor:ml,isLightProbe:!0,copy:function(e){return nl.prototype.copy.call(this,e),this.sh.copy(e.sh),this},fromJSON:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this},toJSON:function(e){var t=nl.prototype.toJSON.call(this,e);return t.object.sh=this.sh.toArray(),t}}),vl.prototype=Object.assign(Object.create(Ss.prototype),{constructor:vl,load:function(e,t,n,r){var i=this,a=new ks(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(a){r?r(a):console.error(a),i.manager.itemError(e)}}),n,r)},parse:function(e){var t=this.textures;function n(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var r=new as[e.type];if(void 0!==e.uuid&&(r.uuid=e.uuid),void 0!==e.name&&(r.name=e.name),void 0!==e.color&&void 0!==r.color&&r.color.setHex(e.color),void 0!==e.roughness&&(r.roughness=e.roughness),void 0!==e.metalness&&(r.metalness=e.metalness),void 0!==e.sheen&&(r.sheen=(new qt).setHex(e.sheen)),void 0!==e.emissive&&void 0!==r.emissive&&r.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==r.specular&&r.specular.setHex(e.specular),void 0!==e.shininess&&(r.shininess=e.shininess),void 0!==e.clearcoat&&(r.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(r.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.fog&&(r.fog=e.fog),void 0!==e.flatShading&&(r.flatShading=e.flatShading),void 0!==e.blending&&(r.blending=e.blending),void 0!==e.combine&&(r.combine=e.combine),void 0!==e.side&&(r.side=e.side),void 0!==e.opacity&&(r.opacity=e.opacity),void 0!==e.transparent&&(r.transparent=e.transparent),void 0!==e.alphaTest&&(r.alphaTest=e.alphaTest),void 0!==e.depthTest&&(r.depthTest=e.depthTest),void 0!==e.depthWrite&&(r.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(r.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(r.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(r.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(r.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(r.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(r.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(r.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(r.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(r.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(r.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(r.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(r.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(r.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(r.rotation=e.rotation),1!==e.linewidth&&(r.linewidth=e.linewidth),void 0!==e.dashSize&&(r.dashSize=e.dashSize),void 0!==e.gapSize&&(r.gapSize=e.gapSize),void 0!==e.scale&&(r.scale=e.scale),void 0!==e.polygonOffset&&(r.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(r.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(r.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.skinning&&(r.skinning=e.skinning),void 0!==e.morphTargets&&(r.morphTargets=e.morphTargets),void 0!==e.morphNormals&&(r.morphNormals=e.morphNormals),void 0!==e.dithering&&(r.dithering=e.dithering),void 0!==e.vertexTangents&&(r.vertexTangents=e.vertexTangents),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.toneMapped&&(r.toneMapped=e.toneMapped),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.vertexColors&&("number"===typeof e.vertexColors?r.vertexColors=e.vertexColors>0:r.vertexColors=e.vertexColors),void 0!==e.uniforms)for(var i in e.uniforms){var a=e.uniforms[i];switch(r.uniforms[i]={},a.type){case"t":r.uniforms[i].value=n(a.value);break;case"c":r.uniforms[i].value=(new qt).setHex(a.value);break;case"v2":r.uniforms[i].value=(new ve).fromArray(a.value);break;case"v3":r.uniforms[i].value=(new Te).fromArray(a.value);break;case"v4":r.uniforms[i].value=(new we).fromArray(a.value);break;case"m3":r.uniforms[i].value=(new ye).fromArray(a.value);break;case"m4":r.uniforms[i].value=(new $e).fromArray(a.value);break;default:r.uniforms[i].value=a.value}}if(void 0!==e.defines&&(r.defines=e.defines),void 0!==e.vertexShader&&(r.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(r.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var o in e.extensions)r.extensions[o]=e.extensions[o];if(void 0!==e.shading&&(r.flatShading=1===e.shading),void 0!==e.size&&(r.size=e.size),void 0!==e.sizeAttenuation&&(r.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(r.map=n(e.map)),void 0!==e.matcap&&(r.matcap=n(e.matcap)),void 0!==e.alphaMap&&(r.alphaMap=n(e.alphaMap)),void 0!==e.bumpMap&&(r.bumpMap=n(e.bumpMap)),void 0!==e.bumpScale&&(r.bumpScale=e.bumpScale),void 0!==e.normalMap&&(r.normalMap=n(e.normalMap)),void 0!==e.normalMapType&&(r.normalMapType=e.normalMapType),void 0!==e.normalScale){var s=e.normalScale;!1===Array.isArray(s)&&(s=[s,s]),r.normalScale=(new ve).fromArray(s)}return void 0!==e.displacementMap&&(r.displacementMap=n(e.displacementMap)),void 0!==e.displacementScale&&(r.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(r.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(r.roughnessMap=n(e.roughnessMap)),void 0!==e.metalnessMap&&(r.metalnessMap=n(e.metalnessMap)),void 0!==e.emissiveMap&&(r.emissiveMap=n(e.emissiveMap)),void 0!==e.emissiveIntensity&&(r.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(r.specularMap=n(e.specularMap)),void 0!==e.envMap&&(r.envMap=n(e.envMap)),void 0!==e.envMapIntensity&&(r.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(r.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(r.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(r.lightMap=n(e.lightMap)),void 0!==e.lightMapIntensity&&(r.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(r.aoMap=n(e.aoMap)),void 0!==e.aoMapIntensity&&(r.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(r.gradientMap=n(e.gradientMap)),void 0!==e.clearcoatMap&&(r.clearcoatMap=n(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(r.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(r.clearcoatNormalMap=n(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(r.clearcoatNormalScale=(new ve).fromArray(e.clearcoatNormalScale)),void 0!==e.transmission&&(r.transmission=e.transmission),void 0!==e.transmissionMap&&(r.transmissionMap=n(e.transmissionMap)),r},setTextures:function(e){return this.textures=e,this}});var yl={decodeText:function(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(i){return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}};function gl(){xn.call(this),this.type="InstancedBufferGeometry",this.instanceCount=1/0}function _l(e,t,n,r){"number"===typeof n&&(r=n,n=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),$t.call(this,e,t,n),this.meshPerAttribute=r||1}function bl(e){Ss.call(this,e)}gl.prototype=Object.assign(Object.create(xn.prototype),{constructor:gl,isInstancedBufferGeometry:!0,copy:function(e){return xn.prototype.copy.call(this,e),this.instanceCount=e.instanceCount,this},clone:function(){return(new this.constructor).copy(this)},toJSON:function(){var e=xn.prototype.toJSON.call(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}),_l.prototype=Object.assign(Object.create($t.prototype),{constructor:_l,isInstancedBufferAttribute:!0,copy:function(e){return $t.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=$t.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),bl.prototype=Object.assign(Object.create(Ss.prototype),{constructor:bl,load:function(e,t,n,r){var i=this,a=new ks(i.manager);a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{t(i.parse(JSON.parse(n)))}catch(a){r?r(a):console.error(a),i.manager.itemError(e)}}),n,r)},parse:function(e){var t={},n={};function r(e,r){if(void 0!==t[r])return t[r];var i=e.interleavedBuffers[r],a=function(e,t){if(void 0!==n[t])return n[t];var r=e.arrayBuffers[t],i=new Uint32Array(r).buffer;return n[t]=i,i}(e,i.buffer),o=new ha(dn(i.type,a),i.stride);return o.uuid=i.uuid,t[r]=o,o}var i=e.isInstancedBufferGeometry?new gl:new xn,a=e.data.index;if(void 0!==a){var o=dn(a.type,a.array);i.setIndex(new $t(o,1))}var s=e.data.attributes;for(var l in s){var u=s[l],c=void 0;if(u.isInterleavedBufferAttribute){c=new pa(r(e.data,u.data),u.itemSize,u.offset,u.normalized)}else{var h=dn(u.type,u.array);c=new(u.isInstancedBufferAttribute?_l:$t)(h,u.itemSize,u.normalized)}void 0!==u.name&&(c.name=u.name),i.setAttribute(l,c)}var f=e.data.morphAttributes;if(f)for(var d in f){for(var p=f[d],m=[],v=0,y=p.length;v<y;v++){var g=p[v],_=void 0;if(g.isInterleavedBufferAttribute)_=new pa(r(e.data,g.data),g.itemSize,g.offset,g.normalized);else _=new $t(dn(g.type,g.array),g.itemSize,g.normalized);void 0!==g.name&&(_.name=g.name),m.push(_)}i.morphAttributes[d]=m}e.data.morphTargetsRelative&&(i.morphTargetsRelative=!0);var b=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==b)for(var x=0,w=b.length;x!==w;++x){var E=b[x];i.addGroup(E.start,E.count,E.materialIndex)}var S=e.data.boundingSphere;if(void 0!==S){var T=new Te;void 0!==S.center&&T.fromArray(S.center),i.boundingSphere=new Ge(T,S.radius)}return e.name&&(i.name=e.name),e.userData&&(i.userData=e.userData),i}});function xl(e){"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),Ss.call(this,e),this.options={premultiplyAlpha:"none"}}function wl(){this.type="ShapePath",this.color=new qt,this.subPaths=[],this.currentPath=null}xl.prototype=Object.assign(Object.create(Ss.prototype),{constructor:xl,isImageBitmapLoader:!0,setOptions:function(e){return this.options=e,this},load:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=this,a=xs.get(e);if(void 0!==a)return i.manager.itemStart(e),setTimeout((function(){t&&t(a),i.manager.itemEnd(e)}),0),a;var o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,i.options)})).then((function(n){xs.add(e,n),t&&t(n),i.manager.itemEnd(e)})).catch((function(t){r&&r(t),i.manager.itemError(e),i.manager.itemEnd(e)})),i.manager.itemStart(e)}}),Object.assign(wl.prototype,{moveTo:function(e,t){return this.currentPath=new el,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this},bezierCurveTo:function(e,t,n,r,i,a){return this.currentPath.bezierCurveTo(e,t,n,r,i,a),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function n(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n],a=new tl;a.curves=i.curves,t.push(a)}return t}function r(e,t){for(var n=t.length,r=!1,i=n-1,a=0;a<n;i=a++){var o=t[i],s=t[a],l=s.x-o.x,u=s.y-o.y;if(Math.abs(u)>Number.EPSILON){if(u<0&&(o=t[a],l=-l,s=t[i],u=-u),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var c=u*(e.x-o.x)-l*(e.y-o.y);if(0===c)return!0;if(c<0)continue;r=!r}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return r}var i,a,o,s=Vo.isClockWise,l=this.subPaths;if(0===l.length)return[];if(!0===t)return n(l);var u=[];if(1===l.length)return a=l[0],(o=new tl).curves=a.curves,u.push(o),u;var c=!s(l[0].getPoints());c=e?!c:c;var h,f,d=[],p=[],m=[],v=0;p[v]=void 0,m[v]=[];for(var y=0,g=l.length;y<g;y++)i=s(h=(a=l[y]).getPoints()),(i=e?!i:i)?(!c&&p[v]&&v++,p[v]={s:new tl,p:h},p[v].s.curves=a.curves,c&&v++,m[v]=[]):m[v].push({h:a,p:h[0]});if(!p[0])return n(l);if(p.length>1){for(var _=!1,b=[],x=0,w=p.length;x<w;x++)d[x]=[];for(var E=0,S=p.length;E<S;E++)for(var T=m[E],k=0;k<T.length;k++){for(var M=T[k],C=!0,A=0;A<p.length;A++)r(M.p,p[A].p)&&(E!==A&&b.push({froms:E,tos:A,hole:k}),C?(C=!1,d[A].push(M)):_=!0);C&&d[E].push(M)}b.length>0&&(_||(m=d))}for(var I=0,P=p.length;I<P;I++){o=p[I].s,u.push(o);for(var R=0,L=(f=m[I]).length;R<L;R++)o.holes.push(f[R].h)}return u}});var El,Sl=function(){function e(t){Object(y.a)(this,e),Object.defineProperty(this,"isFont",{value:!0}),this.type="Font",this.data=t}return Object(g.a)(e,[{key:"generateShapes",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=[],r=Tl(e,t,this.data),i=0,a=r.length;i<a;i++)Array.prototype.push.apply(n,r[i].toShapes());return n}}]),e}();function Tl(e,t,n){for(var r=Array.from?Array.from(e):String(e).split(""),i=t/n.resolution,a=(n.boundingBox.yMax-n.boundingBox.yMin+n.underlineThickness)*i,o=[],s=0,l=0,u=0;u<r.length;u++){var c=r[u];if("\n"===c)s=0,l-=a;else{var h=kl(c,i,s,l,n);s+=h.offsetX,o.push(h.path)}}return o}function kl(e,t,n,r,i){var a=i.glyphs[e]||i.glyphs["?"];if(a){var o,s,l,u,c,h,f,d,p=new wl;if(a.o)for(var m=a._cachedOutline||(a._cachedOutline=a.o.split(" ")),v=0,y=m.length;v<y;){switch(m[v++]){case"m":o=m[v++]*t+n,s=m[v++]*t+r,p.moveTo(o,s);break;case"l":o=m[v++]*t+n,s=m[v++]*t+r,p.lineTo(o,s);break;case"q":l=m[v++]*t+n,u=m[v++]*t+r,c=m[v++]*t+n,h=m[v++]*t+r,p.quadraticCurveTo(c,h,l,u);break;case"b":l=m[v++]*t+n,u=m[v++]*t+r,c=m[v++]*t+n,h=m[v++]*t+r,f=m[v++]*t+n,d=m[v++]*t+r,p.bezierCurveTo(c,h,f,d,l,u)}}return{offsetX:a.ha*t,path:p}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+i.familyName+".")}function Ml(e){Ss.call(this,e)}Ml.prototype=Object.assign(Object.create(Ss.prototype),{constructor:Ml,load:function(e,t,n,r){var i=this,a=new ks(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(e){var n;try{n=JSON.parse(e)}catch(a){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),n=JSON.parse(e.substring(65,e.length-2))}var r=i.parse(n);t&&t(r)}),n,r)},parse:function(e){return new Sl(e)}});var Cl=function(){return void 0===El&&(El=new(window.AudioContext||window.webkitAudioContext)),El};function Al(e){Ss.call(this,e)}function Il(e,t,n){ml.call(this,void 0,n);var r=(new qt).set(e),i=(new qt).set(t),a=new Te(r.r,r.g,r.b),o=new Te(i.r,i.g,i.b),s=Math.sqrt(Math.PI),l=s*Math.sqrt(.75);this.sh.coefficients[0].copy(a).add(o).multiplyScalar(s),this.sh.coefficients[1].copy(a).sub(o).multiplyScalar(l)}function Pl(e,t){ml.call(this,void 0,t);var n=(new qt).set(e);this.sh.coefficients[0].set(n.r,n.g,n.b).multiplyScalar(2*Math.sqrt(Math.PI))}Al.prototype=Object.assign(Object.create(Ss.prototype),{constructor:Al,load:function(e,t,n,r){var i=this,a=new ks(i.manager);a.setResponseType("arraybuffer"),a.setPath(i.path),a.setRequestHeader(i.requestHeader),a.setWithCredentials(i.withCredentials),a.load(e,(function(n){try{var a=n.slice(0);Cl().decodeAudioData(a,(function(e){t(e)}))}catch(o){r?r(o):console.error(o),i.manager.itemError(e)}}),n,r)}}),Il.prototype=Object.assign(Object.create(ml.prototype),{constructor:Il,isHemisphereLightProbe:!0,copy:function(e){return ml.prototype.copy.call(this,e),this},toJSON:function(e){return ml.prototype.toJSON.call(this,e)}}),Pl.prototype=Object.assign(Object.create(ml.prototype),{constructor:Pl,isAmbientLightProbe:!0,copy:function(e){return ml.prototype.copy.call(this,e),this},toJSON:function(e){return ml.prototype.toJSON.call(this,e)}});var Rl=new $e,Ll=new $e;Object.assign(function(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Xn,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Xn,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var n,r,i=e.projectionMatrix.clone(),a=t.eyeSep/2,o=a*t.near/t.focus,s=t.near*Math.tan(me.DEG2RAD*t.fov*.5)/t.zoom;Ll.elements[12]=-a,Rl.elements[12]=a,n=-s*t.aspect+o,r=s*t.aspect+o,i.elements[0]=2*t.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraL.projectionMatrix.copy(i),n=-s*t.aspect-o,r=s*t.aspect-o,i.elements[0]=2*t.near/(r-n),i.elements[8]=(r+n)/(r-n),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Ll),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Rl)}});var Ol=function(){function e(t){Object(y.a)(this,e),this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return Object(g.a)(e,[{key:"start",value:function(){this.startTime=Dl(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=Dl();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}();function Dl(){return("undefined"===typeof performance?Date:performance).now()}var Nl=function(e){p(n,e);var t=m(n);function n(e){var r;return Object(y.a)(this,n),(r=t.call(this)).type="Audio",r.listener=e,r.context=e.context,r.gain=r.context.createGain(),r.gain.connect(e.getInput()),r.autoplay=!1,r.buffer=null,r.detune=0,r.loop=!1,r.loopStart=0,r.loopEnd=0,r.offset=0,r.duration=void 0,r.playbackRate=1,r.isPlaying=!1,r.hasPlaybackControl=!0,r.source=null,r.sourceType="empty",r._startedAt=0,r._progress=0,r._connected=!1,r.filters=[],r}return Object(g.a)(n,[{key:"getOutput",value:function(){return this.gain}},{key:"setNodeSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}},{key:"setMediaElementSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}},{key:"setMediaStreamSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}},{key:"setBuffer",value:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}},{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")}},{key:"pause",value:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"stop",value:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"connect",value:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}},{key:"disconnect",value:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}},{key:"getFilters",value:function(){return this.filters}},{key:"setFilters",value:function(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}},{key:"setDetune",value:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}},{key:"getDetune",value:function(){return this.detune}},{key:"getFilter",value:function(){return this.getFilters()[0]}},{key:"setFilter",value:function(e){return this.setFilters(e?[e]:[])}},{key:"setPlaybackRate",value:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"onEnded",value:function(){this.isPlaying=!1}},{key:"getLoop",value:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}},{key:"setLoop",value:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"setLoopStart",value:function(e){return this.loopStart=e,this}},{key:"setLoopEnd",value:function(e){return this.loopEnd=e,this}},{key:"getVolume",value:function(){return this.gain.gain.value}},{key:"setVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}]),n}(St),zl=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;Object(y.a)(this,e),this.analyser=t.context.createAnalyser(),this.analyser.fftSize=n,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}return Object(g.a)(e,[{key:"getFrequencyData",value:function(){return this.analyser.getByteFrequencyData(this.data),this.data}},{key:"getAverageFrequency",value:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}]),e}();function Fl(e,t,n){var r,i,a;switch(this.binding=e,this.valueSize=n,t){case"quaternion":r=this._slerp,i=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*n),this._workIndex=5;break;case"string":case"bool":r=this._select,i=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(5*n);break;default:r=this._lerp,i=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*n)}this._mixBufferRegion=r,this._mixBufferRegionAdditive=i,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}Object.assign(Fl.prototype,{accumulate:function(e,t){var n=this.buffer,r=this.valueSize,i=e*r+r,a=this.cumulativeWeight;if(0===a){for(var o=0;o!==r;++o)n[i+o]=n[o];a=t}else{var s=t/(a+=t);this._mixBufferRegion(n,i,0,s,r)}this.cumulativeWeight=a},accumulateAdditive:function(e){var t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e},apply:function(e){var t=this.valueSize,n=this.buffer,r=e*t+t,i=this.cumulativeWeight,a=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,i<1){var s=t*this._origIndex;this._mixBufferRegion(n,r,s,1-i,t)}a>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(var l=t,u=t+t;l!==u;++l)if(n[l]!==n[l+t]){o.setValue(n,r);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(var i=n,a=r;i!==a;++i)t[i]=t[r+i%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_setAdditiveIdentityNumeric:function(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,n=e;n<t;n++)this.buffer[n]=0},_setAdditiveIdentityQuaternion:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1},_setAdditiveIdentityOther:function(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]},_select:function(e,t,n,r,i){if(r>=.5)for(var a=0;a!==i;++a)e[t+a]=e[n+a]},_slerp:function(e,t,n,r){Se.slerpFlat(e,t,e,t,e,n,r)},_slerpAdditive:function(e,t,n,r,i){var a=this._workIndex*i;Se.multiplyQuaternionsFlat(e,a,e,t,e,n),Se.slerpFlat(e,t,e,t,e,a,r)},_lerp:function(e,t,n,r,i){for(var a=1-r,o=0;o!==i;++o){var s=t+o;e[s]=e[s]*a+e[n+o]*r}},_lerpAdditive:function(e,t,n,r,i){for(var a=0;a!==i;++a){var o=t+a;e[o]=e[o]+e[n+a]*r}}});var Bl="\\[\\]\\.:\\/",Ul=new RegExp("[\\[\\]\\.:\\/]","g"),jl="[^\\[\\]\\.:\\/]",Vl="[^"+Bl.replace("\\.","")+"]",Hl=/((?:WC+[\/:])*)/.source.replace("WC",jl),Gl=/(WCOD+)?/.source.replace("WCOD",Vl),Wl=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",jl),ql=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",jl),Xl=new RegExp("^"+Hl+Gl+Wl+ql+"$"),Zl=["material","materials","bones"];function Kl(e,t,n){var r=n||Yl.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}function Yl(e,t,n){this.path=t,this.parsedPath=n||Yl.parseTrackName(t),this.node=Yl.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}Object.assign(Kl.prototype,{getValue:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)},setValue:function(e,t){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,i=n.length;r!==i;++r)n[r].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}),Object.assign(Yl,{Composite:Kl,create:function(e,t,n){return e&&e.isAnimationObjectGroup?new Yl.Composite(e,t,n):new Yl(e,t,n)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(Ul,"")},parseTrackName:function(e){var t=Xl.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var i=n.nodeName.substring(r+1);-1!==Zl.indexOf(i)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=i)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n},findNode:function(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var r=function e(n){for(var r=0;r<n.length;r++){var i=n[r];if(i.name===t||i.uuid===t)return i;var a=e(i.children);if(a)return a}return null}(e.children);if(r)return r}return null}}),Object.assign(Yl.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)e[t++]=n[r]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++]},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var n=this.resolvedProperty,r=0,i=n.length;r!==i;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,n=t.objectName,r=t.propertyName,i=t.propertyIndex;if(e||(e=Yl.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(n){var a=t.objectIndex;switch(n){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var o=0;o<e.length;o++)if(e[o].name===a){a=o;break}break;default:if(void 0===e[n])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[n]}if(void 0!==a){if(void 0===e[a])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[a]}}var s=e[r];if(void 0!==s){var l=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);var u=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===r){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[i]&&(i=e.morphTargetDictionary[i])}u=this.BindingType.ArrayElement,this.resolvedProperty=s,this.propertyIndex=i}else void 0!==s.fromArray&&void 0!==s.toArray?(u=this.BindingType.HasFromToArray,this.resolvedProperty=s):Array.isArray(s)?(u=this.BindingType.EntireArray,this.resolvedProperty=s):this.propertyName=r;this.getValue=this.GetterByBindingType[u],this.setValue=this.SetterByBindingTypeAndVersioning[u][l]}else{var c=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+c+"."+r+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Yl.prototype,{_getValue_unbound:Yl.prototype.getValue,_setValue_unbound:Yl.prototype.setValue}),Object.assign(function(){this.uuid=me.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,n=arguments.length;t!==n;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var r=this;this.stats={objects:{get total(){return r._objects.length},get inUse(){return this.total-r.nCachedObjects_}},get bindingsPerObject(){return r._bindings.length}}}.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,i=this._bindings,a=i.length,o=void 0,s=e.length,l=this.nCachedObjects_,u=0,c=arguments.length;u!==c;++u){var h=arguments[u],f=h.uuid,d=t[f];if(void 0===d){d=s++,t[f]=d,e.push(h);for(var p=0,m=a;p!==m;++p)i[p].push(new Yl(h,n[p],r[p]))}else if(d<l){o=e[d];var v=--l,y=e[v];t[y.uuid]=d,e[d]=y,t[f]=v,e[v]=h;for(var g=0,_=a;g!==_;++g){var b=i[g],x=b[v],w=b[d];b[d]=x,void 0===w&&(w=new Yl(h,n[g],r[g])),b[v]=w}}else e[d]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l},remove:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length,i=this.nCachedObjects_,a=0,o=arguments.length;a!==o;++a){var s=arguments[a],l=s.uuid,u=t[l];if(void 0!==u&&u>=i){var c=i++,h=e[c];t[h.uuid]=u,e[u]=h,t[l]=c,e[c]=s;for(var f=0,d=r;f!==d;++f){var p=n[f],m=p[c],v=p[u];p[u]=m,p[c]=v}}}this.nCachedObjects_=i},uncache:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length,i=this.nCachedObjects_,a=e.length,o=0,s=arguments.length;o!==s;++o){var l=arguments[o],u=l.uuid,c=t[u];if(void 0!==c)if(delete t[u],c<i){var h=--i,f=e[h],d=--a,p=e[d];t[f.uuid]=c,e[c]=f,t[p.uuid]=h,e[h]=p,e.pop();for(var m=0,v=r;m!==v;++m){var y=n[m],g=y[h],_=y[d];y[c]=g,y[h]=_,y.pop()}}else{var b=--a,x=e[b];b>0&&(t[x.uuid]=c),e[c]=x,e.pop();for(var w=0,E=r;w!==E;++w){var S=n[w];S[c]=S[b],S.pop()}}}this.nCachedObjects_=i},subscribe_:function(e,t){var n=this._bindingsIndicesByPath,r=n[e],i=this._bindings;if(void 0!==r)return i[r];var a=this._paths,o=this._parsedPaths,s=this._objects,l=s.length,u=this.nCachedObjects_,c=new Array(l);r=i.length,n[e]=r,a.push(e),o.push(t),i.push(c);for(var h=u,f=s.length;h!==f;++h){var d=s[h];c[h]=new Yl(d,e,t)}return c},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var r=this._paths,i=this._parsedPaths,a=this._bindings,o=a.length-1,s=a[o];t[e[o]]=n,a[n]=s,a.pop(),i[n]=i[o],i.pop(),r[n]=r[o],r.pop()}}});var Jl=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.blendMode;Object(y.a)(this,e),this._mixer=t,this._clip=n,this._localRoot=r,this.blendMode=i;for(var a=n.tracks,o=a.length,s=new Array(o),l={endingStart:Z,endingEnd:Z},u=0;u!==o;++u){var c=a[u].createInterpolant(null);s[u]=c,c.settings=l}this._interpolantSettings=l,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}return Object(g.a)(e,[{key:"play",value:function(){return this._mixer._activateAction(this),this}},{key:"stop",value:function(){return this._mixer._deactivateAction(this),this.reset()}},{key:"reset",value:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}},{key:"isRunning",value:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}},{key:"isScheduled",value:function(){return this._mixer._isActiveAction(this)}},{key:"startAt",value:function(e){return this._startTime=e,this}},{key:"setLoop",value:function(e,t){return this.loop=e,this.repetitions=t,this}},{key:"setEffectiveWeight",value:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}},{key:"getEffectiveWeight",value:function(){return this._effectiveWeight}},{key:"fadeIn",value:function(e){return this._scheduleFading(e,0,1)}},{key:"fadeOut",value:function(e){return this._scheduleFading(e,1,0)}},{key:"crossFadeFrom",value:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var r=this._clip.duration,i=e._clip.duration,a=i/r,o=r/i;e.warp(1,a,t),this.warp(o,1,t)}return this}},{key:"crossFadeTo",value:function(e,t,n){return e.crossFadeFrom(this,t,n)}},{key:"stopFading",value:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"setEffectiveTimeScale",value:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}},{key:"getEffectiveTimeScale",value:function(){return this._effectiveTimeScale}},{key:"setDuration",value:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}},{key:"syncWith",value:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}},{key:"halt",value:function(e){return this.warp(this._effectiveTimeScale,0,e)}},{key:"warp",value:function(e,t,n){var r=this._mixer,i=r.time,a=this.timeScale,o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,l=o.sampleValues;return s[0]=i,s[1]=i+n,l[0]=e/a,l[1]=t/a,this}},{key:"stopWarping",value:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"getMixer",value:function(){return this._mixer}},{key:"getClip",value:function(){return this._clip}},{key:"getRoot",value:function(){return this._localRoot||this._mixer._root}},{key:"_update",value:function(e,t,n,r){if(this.enabled){var i=this._startTime;if(null!==i){var a=(e-i)*n;if(a<0||0===n)return;this._startTime=null,t=n*a}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0){var l=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case Q:for(var c=0,h=l.length;c!==h;++c)l[c].evaluate(o),u[c].accumulateAdditive(s);break;case J:default:for(var f=0,d=l.length;f!==d;++f)l[f].evaluate(o),u[f].accumulate(r,s)}}}else this._updateWeight(e)}},{key:"_updateWeight",value:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}},{key:"_updateTimeScale",value:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t}},{key:"_updateTime",value:function(e){var t=this._clip.duration,n=this.loop,r=this.time+e,i=this._loopCount,a=2202===n;if(0===e)return-1===i?r:a&&1===(1&i)?t-r:r;if(2200===n){-1===i&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===i&&(e>=0?(i=0,this._setEndings(!0,0===this.repetitions,a)):this._setEndings(0===this.repetitions,!0,a)),r>=t||r<0){var o=Math.floor(r/t);r-=t*o,i+=Math.abs(o);var s=this.repetitions-i;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var l=e<0;this._setEndings(l,!l,a)}else this._setEndings(!1,!1,a);this._loopCount=i,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=r;if(a&&1===(1&i))return t-r}return r}},{key:"_setEndings",value:function(e,t,n){var r=this._interpolantSettings;n?(r.endingStart=K,r.endingEnd=K):(r.endingStart=e?this.zeroSlopeAtStart?K:Z:Y,r.endingEnd=t?this.zeroSlopeAtEnd?K:Z:Y)}},{key:"_scheduleFading",value:function(e,t,n){var r=this._mixer,i=r.time,a=this._weightInterpolant;null===a&&(a=r._lendControlInterpolant(),this._weightInterpolant=a);var o=a.parameterPositions,s=a.sampleValues;return o[0]=i,s[0]=t,o[1]=i+e,s[1]=n,this}}]),e}();function Ql(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}Ql.prototype=Object.assign(Object.create(ce.prototype),{constructor:Ql,_bindAction:function(e,t){var n=e._localRoot||this._root,r=e._clip.tracks,i=r.length,a=e._propertyBindings,o=e._interpolants,s=n.uuid,l=this._bindingsByRootAndName,u=l[s];void 0===u&&(u={},l[s]=u);for(var c=0;c!==i;++c){var h=r[c],f=h.name,d=u[f];if(void 0!==d)a[c]=d;else{if(void 0!==(d=a[c])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,s,f));continue}var p=t&&t._propertyBindings[c].binding.parsedPath;++(d=new Fl(Yl.create(n,f,p),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(d,s,f),a[c]=d}o[c].resultBuffer=d.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}for(var i=e._propertyBindings,a=0,o=i.length;a!==o;++a){var s=i[a];0===s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0===--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions},_addInactiveAction:function(e,t,n){var r=this._actions,i=this._actionsByClip,a=i[t];if(void 0===a)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,i[t]=a;else{var o=a.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=r.length,r.push(e),a.actionByRoot[n]=e},_removeInactiveAction:function(e){var t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;var i=e._clip.uuid,a=this._actionsByClip,o=a[i],s=o.knownActions,l=s[s.length-1],u=e._byClipCacheIndex;l._byClipCacheIndex=u,s[u]=l,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete a[i],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var i=t[n];0===--i.referenceCount&&this._removeInactiveBinding(i)}},_lendAction:function(e){var t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackAction:function(e){var t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_addInactiveBinding:function(e,t,n){var r=this._bindingsByRootAndName,i=this._bindings,a=r[t];void 0===a&&(a={},r[t]=a),a[n]=e,e._cacheIndex=i.length,i.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,n=e.binding,r=n.rootNode.uuid,i=n.path,a=this._bindingsByRootAndName,o=a[r],s=t[t.length-1],l=e._cacheIndex;s._cacheIndex=l,t[l]=s,t.pop(),delete o[i],0===Object.keys(o).length&&delete a[r]},_lendBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_takeBackBinding:function(e){var t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,i=t[r];e._cacheIndex=r,t[r]=e,i._cacheIndex=n,t[n]=i},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new us(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t,e[t]=n),n},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,i=t[r];e.__cacheIndex=r,t[r]=e,i.__cacheIndex=n,t[n]=i},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t,n){var r=t||this._root,i=r.uuid,a="string"===typeof e?_s.findByName(r,e):e,o=null!==a?a.uuid:e,s=this._actionsByClip[o],l=null;if(void 0===n&&(n=null!==a?a.blendMode:J),void 0!==s){var u=s.actionByRoot[i];if(void 0!==u&&u.blendMode===n)return u;l=s.knownActions[0],null===a&&(a=l._clip)}if(null===a)return null;var c=new Jl(this,a,t,n);return this._bindAction(c,l),this._addInactiveAction(c,o,i),c},existingAction:function(e,t){var n=t||this._root,r=n.uuid,i="string"===typeof e?_s.findByName(n,e):e,a=i?i.uuid:e,o=this._actionsByClip[a];return void 0!==o&&o.actionByRoot[r]||null},stopAllAction:function(){for(var e=this._actions,t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this},update:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,r=this.time+=e,i=Math.sign(e),a=this._accuIndex^=1,o=0;o!==n;++o){t[o]._update(r,e,i,a)}for(var s=this._bindings,l=this._nActiveBindings,u=0;u!==l;++u)s[u].apply(a);return this},setTime:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,n=e.uuid,r=this._actionsByClip,i=r[n];if(void 0!==i){for(var a=i.knownActions,o=0,s=a.length;o!==s;++o){var l=a[o];this._deactivateAction(l);var u=l._cacheIndex,c=t[t.length-1];l._cacheIndex=null,l._byClipCacheIndex=null,c._cacheIndex=u,t[u]=c,t.pop(),this._removeInactiveBindingsForAction(l)}delete r[n]}},uncacheRoot:function(e){var t=e.uuid,n=this._actionsByClip;for(var r in n){var i=n[r].actionByRoot[t];void 0!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}var a=this._bindingsByRootAndName[t];if(void 0!==a)for(var o in a){var s=a[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}},uncacheAction:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}});var $l=function(){function e(t){Object(y.a)(this,e),"string"===typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}return Object(g.a)(e,[{key:"clone",value:function(){return new e(void 0===this.value.clone?this.value:this.value.clone())}}]),e}();function eu(e,t,n){ha.call(this,e,t),this.meshPerAttribute=n||1}function tu(e,t,n,r,i){this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=r,this.count=i,this.version=0}function nu(e,t,n,r){this.ray=new Qe(e,t),this.near=n||0,this.far=r||1/0,this.camera=null,this.layers=new ct,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function ru(e,t){return e.distance-t.distance}function iu(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r)for(var i=e.children,a=0,o=i.length;a<o;a++)iu(i[a],t,n,!0)}eu.prototype=Object.assign(Object.create(ha.prototype),{constructor:eu,isInstancedInterleavedBuffer:!0,copy:function(e){return ha.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},clone:function(e){var t=ha.prototype.clone.call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t},toJSON:function(e){var t=ha.prototype.toJSON.call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}),Object.defineProperty(tu.prototype,"needsUpdate",{set:function(e){!0===e&&this.version++}}),Object.assign(tu.prototype,{isGLBufferAttribute:!0,setBuffer:function(e){return this.buffer=e,this},setType:function(e,t){return this.type=e,this.elementSize=t,this},setItemSize:function(e){return this.itemSize=e,this},setCount:function(e){return this.count=e,this}}),Object.assign(nu.prototype,{set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)},intersectObject:function(e,t,n){var r=n||[];return iu(e,this,r,t),r.sort(ru),r},intersectObjects:function(e,t,n){var r=n||[];if(!1===Array.isArray(e))return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),r;for(var i=0,a=e.length;i<a;i++)iu(e[i],this,r,t);return r.sort(ru),r}});var au=new ve,ou=function(){function e(t,n){Object(y.a)(this,e),Object.defineProperty(this,"isBox2",{value:!0}),this.min=void 0!==t?t:new ve(1/0,1/0),this.max=void 0!==n?n:new ve(-1/0,-1/0)}return Object(g.a)(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=au.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(e){return void 0===e&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new ve),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return void 0===e&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new ve),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}},{key:"getParameter",value:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new ve),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}},{key:"clampPoint",value:function(e,t){return void 0===t&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new ve),t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return au.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),su=new Te,lu=new Te,uu=function(){function e(t,n){Object(y.a)(this,e),this.start=void 0!==t?t:new Te,this.end=void 0!==n?n:new Te}return Object(g.a)(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"getCenter",value:function(e){return void 0===e&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Te),e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(e){return void 0===e&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Te),e.subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){return void 0===t&&(console.warn("THREE.Line3: .at() target is now required"),t=new Te),this.delta(t).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){su.subVectors(e,this.start),lu.subVectors(this.end,this.start);var n=lu.dot(lu),r=lu.dot(su)/n;return t&&(r=me.clamp(r,0,1)),r}},{key:"closestPointToPoint",value:function(e,t,n){var r=this.closestPointToPointParameter(e,t);return void 0===n&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),n=new Te),this.delta(n).multiplyScalar(r).add(this.start)}},{key:"applyMatrix4",value:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}]),e}();function cu(e){St.call(this),this.material=e,this.render=function(){},this.hasPositions=!1,this.hasNormals=!1,this.hasColors=!1,this.hasUvs=!1,this.positionArray=null,this.normalArray=null,this.colorArray=null,this.uvArray=null,this.count=0}cu.prototype=Object.create(St.prototype),cu.prototype.constructor=cu,cu.prototype.isImmediateRenderObject=!0;var hu=new Te,fu=new $e,du=new $e,pu=function(e){p(n,e);var t=m(n);function n(e){var r;Object(y.a)(this,n);for(var i=mu(e),a=new xn,o=[],s=[],l=new qt(0,0,1),u=new qt(0,1,0),c=0;c<i.length;c++){var h=i[c];h.parent&&h.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),s.push(l.r,l.g,l.b),s.push(u.r,u.g,u.b))}a.setAttribute("position",new un(o,3)),a.setAttribute("color",new un(s,3));var f=new Za({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});return(r=t.call(this,a,f)).type="SkeletonHelper",r.isSkeletonHelper=!0,r.root=e,r.bones=i,r.matrix=e.matrixWorld,r.matrixAutoUpdate=!1,r}return Object(g.a)(n,[{key:"updateMatrixWorld",value:function(e){var t=this.bones,r=this.geometry,i=r.getAttribute("position");du.copy(this.root.matrixWorld).invert();for(var a=0,o=0;a<t.length;a++){var s=t[a];s.parent&&s.parent.isBone&&(fu.multiplyMatrices(du,s.matrixWorld),hu.setFromMatrixPosition(fu),i.setXYZ(o,hu.x,hu.y,hu.z),fu.multiplyMatrices(du,s.parent.matrixWorld),hu.setFromMatrixPosition(fu),i.setXYZ(o+1,hu.x,hu.y,hu.z),o+=2)}r.getAttribute("position").needsUpdate=!0,f(h(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(ro);function mu(e){var t=[];e&&e.isBone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,mu(e.children[n]));return t}var vu=function(e){p(n,e);var t=m(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;Object(y.a)(this,n),a=new qt(a),o=new qt(o);for(var s=i/2,l=r/i,u=r/2,c=[],h=[],f=0,d=0,p=-u;f<=i;f++,p+=l){c.push(-u,0,p,u,0,p),c.push(p,0,-u,p,0,u);var m=f===s?a:o;m.toArray(h,d),d+=3,m.toArray(h,d),d+=3,m.toArray(h,d),d+=3,m.toArray(h,d),d+=3}var v=new xn;v.setAttribute("position",new un(c,3)),v.setAttribute("color",new un(h,3));var g=new Za({vertexColors:!0,toneMapped:!1});return(e=t.call(this,v,g)).type="GridHelper",e}return n}(ro);var yu=new Float32Array(1),gu=(new Int32Array(yu.buffer),Math.pow(2,8),[.125,.215,.35,.446,.526,.582]),_u=5+gu.length,bu=(c(v={},te,0),c(v,ne,1),c(v,ie,2),c(v,3004,3),c(v,3005,4),c(v,3006,5),c(v,re,6),new Yt({side:1,depthWrite:!1,depthTest:!1})),xu=(new Bn(new jn,bu),wu());xu._lodPlanes,xu._sizeLods,xu._sigmas,Math.sqrt(5);function wu(){for(var e=[],t=[],n=[],r=8,i=0;i<_u;i++){var a=Math.pow(2,r);t.push(a);var o=1/a;i>4?o=gu[i-8+4-1]:0==i&&(o=0),n.push(o);for(var s=1/(a-1),l=-s/2,u=1+s/2,c=[l,l,u,l,u,u,l,l,u,u,l,u],h=new Float32Array(108),f=new Float32Array(72),d=new Float32Array(36),p=0;p<6;p++){var m=p%3*2/3-1,v=p>2?0:-1,y=[m,v,0,m+2/3,v,0,m+2/3,v+1,0,m,v,0,m+2/3,v+1,0,m,v+1,0];h.set(y,18*p),f.set(c,12*p);var g=[p,p,p,p,p,p];d.set(g,6*p)}var _=new xn;_.setAttribute("position",new $t(h,3)),_.setAttribute("uv",new $t(f,2)),_.setAttribute("faceIndex",new $t(d,1)),e.push(_),r>4&&r--}return{_lodPlanes:e,_sizeLods:t,_sigmas:n}}function Eu(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),js.call(this,e),this.type="catmullrom"}Ls.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Ls.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Object.assign(el.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),Object.create(js.prototype),Object.create(js.prototype),Eu.prototype=Object.create(js.prototype),Object.assign(Eu.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),vu.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},pu.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(Ss.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),yl.extractUrlBase(e)}}),Ss.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(ou.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Ce.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Ge.prototype,{empty:function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()}}),tr.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},uu.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(me,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),me.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),me.ceilPowerOfTwo(e)}}),Object.assign(ye.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},getInverse:function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()}}),Object.assign($e.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Te).setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,n,r,i,a){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,r,n,i,a)},getInverse:function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()}}),Ct.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Object.assign(Se.prototype,{multiplyVector3:function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},inverse:function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()}}),Object.assign(Qe.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(Bt.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(Bt,{barycoordFromPoint:function(e,t,n,r,i){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Bt.getBarycoord(e,t,n,r,i)},normal:function(e,t,n,r){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Bt.getNormal(e,t,n,r)}}),Object.assign(tl.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new Wo(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Zo(this,e)}}),Object.assign(ve.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Te.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,n){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(we.prototype,{fromAttribute:function(e,t,n){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,n)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(St.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(St.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(Bn.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Bn.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Ra.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Va.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),Fa.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(Ls.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),Xn.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(nl.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties($t.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===le},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(le)}}}),Object.assign($t.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?le:se),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(xn.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new $t(arguments[1],arguments[2])))},addDrawCall:function(e,t,n){void 0!==n&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(xn.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(gl.prototype,{maxInstancedCount:{get:function(){return console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount},set:function(e){console.warn("THREE.InstancedBufferGeometry: .maxInstancedCount has been renamed to .instanceCount."),this.instanceCount=e}}}),Object.defineProperties(nu.prototype,{linePrecision:{get:function(){return console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold},set:function(e){console.warn("THREE.Raycaster: .linePrecision has been deprecated. Use .params.Line.threshold instead."),this.params.Line.threshold=e}}}),Object.defineProperties(ha.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===le},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(ha.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?le:se),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Wo.prototype,{getArrays:function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")}}),Object.assign(ca.prototype,{dispose:function(){console.error("THREE.Scene: .dispose() has been removed.")}}),Object.defineProperties($l.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(Kt.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new qt}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=1===e}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties($o.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Qo.prototype,{transparency:{get:function(){return console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission},set:function(e){console.warn("THREE.MeshPhysicalMaterial: .transparency has been renamed to .transmission."),this.transmission=e}}}),Object.defineProperties(Wn.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(la.prototype,{clearTarget:function(e,t,n,r){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,n,r)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(la.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?ne:te}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties($i.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Ee.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties(Nl.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return(new Al).load(e,(function(e){t.setBuffer(e)})),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),zl.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Kn.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},Kn.prototype.clear=function(e,t,n,r){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,n,r)};ge.crossOrigin=void 0,ge.loadTexture=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var i=new Rs;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,n,void 0,r);return t&&(a.mapping=t),a},ge.loadTextureCube=function(e,t,n,r){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var i=new Is;i.setCrossOrigin(this.crossOrigin);var a=i.load(e,n,void 0,r);return t&&(a.mapping=t),a},ge.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},ge.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"125"}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="125")},function(e,t,n){"use strict";function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function i(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return s})),n.d(t,"g",(function(){return l})),n.d(t,"e",(function(){return u})),n.d(t,"f",(function(){return c}));var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function o(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{l(r.next(e))}catch(t){a(t)}}function s(e){try{l(r.throw(e))}catch(t){a(t)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}l((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(s){a=[6,s],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function l(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function u(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function c(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(u(arguments[t]));return e}},function(e,t,n){"use strict";var r,i,a=n(6),o=n(0),s=n(17),l=n(19),u=((r={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",r["bad-app-name"]="Illegal App name: '{$appName}",r["duplicate-app"]="Firebase App named '{$appName}' already exists",r["app-deleted"]="Firebase App named '{$appName}' already deleted",r["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",r["invalid-log-argument"]="First argument to `onLog` must be null or a function.",r),c=new o.b("app","Firebase",u),h="@firebase/app",f="[DEFAULT]",d=((i={})[h]="fire-core",i["@firebase/analytics"]="fire-analytics",i["@firebase/auth"]="fire-auth",i["@firebase/database"]="fire-rtdb",i["@firebase/functions"]="fire-fn",i["@firebase/installations"]="fire-iid",i["@firebase/messaging"]="fire-fcm",i["@firebase/performance"]="fire-perf",i["@firebase/remote-config"]="fire-rc",i["@firebase/storage"]="fire-gcs",i["@firebase/firestore"]="fire-fst",i["fire-js"]="fire-js",i["firebase-wrapper"]="fire-js-all",i),p=new l.b("@firebase/app"),m=function(){function e(e,t,n){var r,i,l=this;this.firebase_=n,this.isDeleted_=!1,this.name_=t.name,this.automaticDataCollectionEnabled_=t.automaticDataCollectionEnabled||!1,this.options_=Object(o.j)(e),this.container=new s.b(t.name),this._addComponent(new s.a("app",(function(){return l}),"PUBLIC"));try{for(var u=Object(a.g)(this.firebase_.INTERNAL.components.values()),c=u.next();!c.done;c=u.next()){var h=c.value;this._addComponent(h)}}catch(f){r={error:f}}finally{try{c&&!c.done&&(i=u.return)&&i.call(u)}finally{if(r)throw r.error}}}return Object.defineProperty(e.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(e){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),e.prototype.delete=function(){var e=this;return new Promise((function(t){e.checkDestroyed_(),t()})).then((function(){return e.firebase_.INTERNAL.removeApp(e.name_),Promise.all(e.container.getProviders().map((function(e){return e.delete()})))})).then((function(){e.isDeleted_=!0}))},e.prototype._getService=function(e,t){return void 0===t&&(t=f),this.checkDestroyed_(),this.container.getProvider(e).getImmediate({identifier:t})},e.prototype._removeServiceInstance=function(e,t){void 0===t&&(t=f),this.container.getProvider(e).clearInstance(t)},e.prototype._addComponent=function(e){try{this.container.addComponent(e)}catch(t){p.debug("Component "+e.name+" failed to register with FirebaseApp "+this.name,t)}},e.prototype._addOrOverwriteComponent=function(e){this.container.addOrOverwriteComponent(e)},e.prototype.toJSON=function(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}},e.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw c.create("app-deleted",{appName:this.name_})},e}();m.prototype.name&&m.prototype.options||m.prototype.delete||console.log("dc");var v=function e(){var t=function(e){var t={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={}),"object"===typeof i&&null!==i||(i={name:i});var a=i;void 0===a.name&&(a.name=f);var s=a.name;if("string"!==typeof s||!s)throw c.create("bad-app-name",{appName:String(s)});if(Object(o.h)(t,s))throw c.create("duplicate-app",{appName:s});var l=new e(n,a,r);return t[s]=l,l},app:i,registerVersion:function(e,t,n){var r,i=null!==(r=d[e])&&void 0!==r?r:e;n&&(i+="-"+n);var a=i.match(/\s|\//),o=t.match(/\s|\//);if(a||o){var l=['Unable to register library "'+i+'" with version "'+t+'":'];return a&&l.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),a&&o&&l.push("and"),o&&l.push('version name "'+t+'" contains illegal characters (whitespace or "/")'),void p.warn(l.join(" "))}u(new s.a(i+"-version",(function(){return{library:i,version:t}}),"VERSION"))},setLogLevel:l.c,onLog:function(e,t){if(null!==e&&"function"!==typeof e)throw c.create("invalid-log-argument",{appName:name});Object(l.d)(e,t)},apps:null,SDK_VERSION:"8.2.5",INTERNAL:{registerComponent:u,removeApp:function(e){delete t[e]},components:n,useAsService:function(e,t){return"serverAuth"===t?null:t}}};function i(e){if(e=e||f,!Object(o.h)(t,e))throw c.create("no-app",{appName:e});return t[e]}function u(s){var l,u,h=s.name;if(n.has(h))return p.debug("There were multiple attempts to register component "+h+"."),"PUBLIC"===s.type?r[h]:null;if(n.set(h,s),"PUBLIC"===s.type){var f=function(e){if(void 0===e&&(e=i()),"function"!==typeof e[h])throw c.create("invalid-app-argument",{appName:h});return e[h]()};void 0!==s.serviceProps&&Object(o.k)(f,s.serviceProps),r[h]=f,e.prototype[h]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this._getService.bind(this,h).apply(this,s.multipleInstances?e:[])}}try{for(var d=Object(a.g)(Object.keys(t)),m=d.next();!m.done;m=d.next()){var v=m.value;t[v]._addComponent(s)}}catch(y){l={error:y}}finally{try{m&&!m.done&&(u=d.return)&&u.call(d)}finally{if(l)throw l.error}}return"PUBLIC"===s.type?r[h]:null}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(t).map((function(e){return t[e]}))}}),i.App=e,r}(m);return t.INTERNAL=Object(a.a)(Object(a.a)({},t.INTERNAL),{createFirebaseNamespace:e,extendNamespace:function(e){Object(o.k)(t,e)},createSubscribe:o.i,ErrorFactory:o.b,deepExtend:o.k}),t}(),y=function(){function e(e){this.container=e}return e.prototype.getPlatformInfoString=function(){return this.container.getProviders().map((function(e){if(function(e){var t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){var t=e.getImmediate();return t.library+"/"+t.version}return null})).filter((function(e){return e})).join(" ")},e}();if(Object(o.n)()&&void 0!==self.firebase){p.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var g=self.firebase.SDK_VERSION;g&&g.indexOf("LITE")>=0&&p.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var _=v.initializeApp;v.initializeApp=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return Object(o.q)()&&p.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the @rollup/plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/@rollup/plugin-node-resolve\n      '),_.apply(void 0,e)};var b=v;!function(e,t){e.INTERNAL.registerComponent(new s.a("platform-logger",(function(e){return new y(e)}),"PRIVATE")),e.registerVersion(h,"0.6.14",t),e.registerVersion("fire-js","")}(b),t.a=b},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(22);function i(e,t){if(null==e)return{};var n,i,a=Object(r.a)(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}},function(e,t,n){"use strict";function r(e){var t,n,i="";if("string"===typeof e||"number"===typeof e)i+=e;else if("object"===typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=r(e[t]))&&(i&&(i+=" "),i+=n);else for(t in e)e[t]&&(i&&(i+=" "),i+=t);return i}t.a=function(){for(var e,t,n=0,i="";n<arguments.length;)(e=arguments[n++])&&(t=r(e))&&(i&&(i+=" "),i+=t);return i}},function(e,t,n){"use strict";e.exports=n(62)},function(e,t,n){"use strict";n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return u})),n.d(t,"a",(function(){return c})),n.d(t,"d",(function(){return h}));var r=n(58);function i(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(Math.max(t,e),n)}function a(e){if(e.type)return e;if("#"===e.charAt(0))return a(function(e){e=e.substr(1);var t=new RegExp(".{1,".concat(e.length>=6?2:1,"}"),"g"),n=e.match(t);return n&&1===n[0].length&&(n=n.map((function(e){return e+e}))),n?"rgb".concat(4===n.length?"a":"","(").concat(n.map((function(e,t){return t<3?parseInt(e,16):Math.round(parseInt(e,16)/255*1e3)/1e3})).join(", "),")"):""}(e));var t=e.indexOf("("),n=e.substring(0,t);if(-1===["rgb","rgba","hsl","hsla"].indexOf(n))throw new Error(Object(r.a)(3,e));var i=e.substring(t+1,e.length-1).split(",");return{type:n,values:i=i.map((function(e){return parseFloat(e)}))}}function o(e){var t=e.type,n=e.values;return-1!==t.indexOf("rgb")?n=n.map((function(e,t){return t<3?parseInt(e,10):e})):-1!==t.indexOf("hsl")&&(n[1]="".concat(n[1],"%"),n[2]="".concat(n[2],"%")),"".concat(t,"(").concat(n.join(", "),")")}function s(e,t){var n=l(e),r=l(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)}function l(e){var t="hsl"===(e=a(e)).type?a(function(e){var t=(e=a(e)).values,n=t[0],r=t[1]/100,i=t[2]/100,s=r*Math.min(i,1-i),l=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e+n/30)%12;return i-s*Math.max(Math.min(t-3,9-t,1),-1)},u="rgb",c=[Math.round(255*l(0)),Math.round(255*l(8)),Math.round(255*l(4))];return"hsla"===e.type&&(u+="a",c.push(t[3])),o({type:u,values:c})}(e)).values:e.values;return t=t.map((function(e){return(e/=255)<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)})),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function u(e,t){return e=a(e),t=i(t),"rgb"!==e.type&&"hsl"!==e.type||(e.type+="a"),e.values[3]=t,o(e)}function c(e,t){if(e=a(e),t=i(t),-1!==e.type.indexOf("hsl"))e.values[2]*=1-t;else if(-1!==e.type.indexOf("rgb"))for(var n=0;n<3;n+=1)e.values[n]*=1-t;return o(e)}function h(e,t){if(e=a(e),t=i(t),-1!==e.type.indexOf("hsl"))e.values[2]+=(100-e.values[2])*t;else if(-1!==e.type.indexOf("rgb"))for(var n=0;n<3;n+=1)e.values[n]+=(255-e.values[n])*t;return o(e)}},,function(e,t,n){"use strict";var r=n(3),i=n(8),a=n(1),o=n.n(a),s=(n(14),n(56)),l=n.n(s),u=n(100);function c(e){var t=e.theme,n=e.name,r=e.props;if(!t||!t.props||!t.props[n])return r;var i,a=t.props[n];for(i in a)void 0===r[i]&&(r[i]=a[i]);return r}var h=n(124),f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(n){var a=t.defaultTheme,s=t.withTheme,f=void 0!==s&&s,d=t.name,p=Object(i.a)(t,["defaultTheme","withTheme","name"]);var m=d,v=Object(u.a)(e,Object(r.a)({defaultTheme:a,Component:n,name:d||n.displayName,classNamePrefix:m},p)),y=o.a.forwardRef((function(e,t){e.classes;var s,l=e.innerRef,u=Object(i.a)(e,["classes","innerRef"]),p=v(Object(r.a)({},n.defaultProps,e)),m=u;return("string"===typeof d||f)&&(s=Object(h.a)()||a,d&&(m=c({theme:s,name:d,props:u})),f&&!m.theme&&(m.theme=s)),o.a.createElement(n,Object(r.a)({ref:l||t,classes:p},m))}));return l()(y,n),y}},d=n(34);t.a=function(e,t){return f(e,Object(r.a)({defaultTheme:d.a},t))}},function(e,t,n){e.exports=n(96)()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(58);function i(e){if("string"!==typeof e)throw new Error(Object(r.a)(7));return e.charAt(0).toUpperCase()+e.slice(1)}},function(e,t,n){var r=n(70),i=n(41),a=n(42),o=n(71),s=n(30),l=n(44),u=n(74),c=n(75),h=n(78),f=n(80),d=n(81),p=n(83),m=n(84),v=n(85),y=n(86);e.exports=function(){"use strict";var e,t,n;function g(r,i){if(e)if(t){var a="var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk);",o={};e(o),n=i(o),"undefined"!==typeof window&&(n.workerUrl=window.URL.createObjectURL(new Blob([a],{type:"text/javascript"})))}else t=i;else e=i}return g(["exports"],(function(e){var t=n;function n(e,t,n,r){this.cx=3*e,this.bx=3*(n-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(r-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=r,this.p2x=n,this.p2y=r}n.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},n.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},n.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},n.prototype.solveCurveX=function(e,t){var n,r,i,a,o;for(void 0===t&&(t=1e-6),i=e,o=0;o<8;o++){if(a=this.sampleCurveX(i)-e,Math.abs(a)<t)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=a/s}if((i=e)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(a=this.sampleCurveX(i),Math.abs(a-e)<t)return i;e>a?n=i:r=i,i=.5*(r-n)+n}return i},n.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var r=g;function g(e,t){this.x=e,this.y=t}g.prototype={clone:function(){return new g(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,n=e.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),n=Math.sin(e),r=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=r,this},_rotateAround:function(e,t){var n=Math.cos(e),r=Math.sin(e),i=t.y+r*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-r*(this.y-t.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},g.convert=function(e){return e instanceof g?e:Array.isArray(e)?new g(e[0],e[1]):e};var _="undefined"!=typeof self?self:{};function b(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(!b(e[n],t[n]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(var r in e)if(!b(e[r],t[r]))return!1;return!0}return e===t}var x=Math.pow(2,53)-1,w=Math.PI/180,E=180/Math.PI;function S(e){return e*w}function T(e){if(e<=0)return 0;if(e>=1)return 1;var t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function k(e,n,r,i){var a=new t(e,n,r,i);return function(e){return a.solve(e)}}var M=k(.25,.1,.25,1);function C(e,t,n){return Math.min(n,Math.max(t,e))}function A(e,t,n){var r=n-t,i=((e-t)%r+r)%r+t;return i===t?n:i}function I(e){var t=[];for(var n in e)t.push(e[n]);return t}function P(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];for(var s in o)e[s]=o[s]}return e}var R=1;function L(){return R++}function O(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function D(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function N(e,t){e.forEach((function(e){t[e]&&(t[e]=t[e].bind(t))}))}function z(e,t){return-1!==e.indexOf(t,e.length-t.length)}function F(e,t,n){var r={};for(var i in e)r[i]=t.call(n||this,e[i],i,e);return r}function B(e,t,n){var r={};for(var i in e)t.call(n||this,e[i],i,e)&&(r[i]=e[i]);return r}function U(e){return Array.isArray(e)?e.map(U):"object"==typeof e&&e?F(e,U):e}var j={};function V(e){j[e]||("undefined"!=typeof console&&console.warn(e),j[e]=!0)}function H(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function G(e){for(var t,n,r=0,i=0,a=e.length,o=a-1;i<a;o=i++)t=e[i],r+=((n=e[o]).x-t.x)*(t.y+n.y);return r}function W(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function q(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(e,n,r,i){var a=r||i;return t[n]=!a||a.toLowerCase(),""})),t["max-age"]){var n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t}var X,Z,K=null;function Y(e){if(null==K){var t=e.navigator?e.navigator.userAgent:null;K=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return K}function J(e){try{var t=_[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}}var Q,$,ee,te,ne=!1,re={now:function(){return void 0!==Q?Q:_.performance.now()},setErrorState:function(){ne=!0},setNow:function(e){Q=e},restoreNow:function(){Q=void 0},frame:function(e){if(ne)return{cancel:function(){}};var t=_.requestAnimationFrame(e);return{cancel:function(){return _.cancelAnimationFrame(t)}}},getImageData:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=_.document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("failed to create canvas 2d context");return n.width=e.width,n.height=e.height,r.drawImage(e,0,0,e.width,e.height),r.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return X||(X=_.document.createElement("a")),X.href=e,X.href},get devicePixelRatio(){return _.devicePixelRatio},get prefersReducedMotion(){return!!_.matchMedia&&(null==Z&&(Z=_.matchMedia("(prefers-reduced-motion: reduce)")),Z.matches)}},ie={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==$){var e=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{$=null!=Object({NODE_ENV:"production",PUBLIC_URL:"/tokyo-survival-pub",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_FIREBASE_API_KEY:"AIzaSyBMgLpqdddgG5plQhhTFN3KmNwMtCquK6s",REACT_APP_FIREBASE_APP_ID:"1:953032005701:web:df56c5e173995c61a3ab2c",REACT_APP_FIREBASE_AUTH_DOMAIN:"tokyo-survival.firebaseapp.com",REACT_APP_FIREBASE_DATABASE_URL:"https://tokyo-survival-default-rtdb.firebaseio.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"953032005701",REACT_APP_FIREBASE_PROJECT_ID:"tokyo-survival",REACT_APP_FIREBASE_STORAGE_BUCKET:"tokyo-survival.appspot.com",REACT_APP_MAPBOX_ACCESS_TOKEN:"pk.eyJ1IjoiaGlzYXlhbiIsImEiOiJja2wwODR2d2gzOGF0MnFxbmJjbGFneWpxIn0.a0Dl2YtxhvWoXDsJK_THSg"}).API_URL_REGEX?new RegExp(Object({NODE_ENV:"production",PUBLIC_URL:"/tokyo-survival-pub",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_FIREBASE_API_KEY:"AIzaSyBMgLpqdddgG5plQhhTFN3KmNwMtCquK6s",REACT_APP_FIREBASE_APP_ID:"1:953032005701:web:df56c5e173995c61a3ab2c",REACT_APP_FIREBASE_AUTH_DOMAIN:"tokyo-survival.firebaseapp.com",REACT_APP_FIREBASE_DATABASE_URL:"https://tokyo-survival-default-rtdb.firebaseio.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"953032005701",REACT_APP_FIREBASE_PROJECT_ID:"tokyo-survival",REACT_APP_FIREBASE_STORAGE_BUCKET:"tokyo-survival.appspot.com",REACT_APP_MAPBOX_ACCESS_TOKEN:"pk.eyJ1IjoiaGlzYXlhbiIsImEiOiJja2wwODR2d2gzOGF0MnFxbmJjbGFneWpxIn0.a0Dl2YtxhvWoXDsJK_THSg"}).API_URL_REGEX):e}catch(t){$=e}}return $},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},ae={supported:!1,testSupport:function(e){!oe&&te&&(se?le(e):ee=e)}},oe=!1,se=!1;function le(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,te),e.isContextLost())return;ae.supported=!0}catch(e){}e.deleteTexture(t),oe=!0}_.document&&((te=_.document.createElement("img")).onload=function(){ee&&le(ee),ee=null,se=!0},te.onerror=function(){oe=!0,ee=null},te.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var ue="01";function ce(e){return 0===e.indexOf("mapbox:")}function he(e){return ie.API_URL_REGEX.test(e)}var fe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function de(e){var t=e.match(fe);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function pe(e){var t=e.params.length?"?".concat(e.params.join("&")):"";return"".concat(e.protocol,"://").concat(e.authority).concat(e.path).concat(t)}function me(e){if(!e)return null;var t=e.split(".");if(!t||3!==t.length)return null;try{return JSON.parse(decodeURIComponent(_.atob(t[1]).split("").map((function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(e){return null}}var ve,ye,ge=function(){function e(t){v(this,e),this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}return y(e,[{key:"getStorageKey",value:function(e){var t=me(ie.ACCESS_TOKEN),n="";return n=t&&t.u?_.btoa(encodeURIComponent(t.u).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode(Number("0x"+t))}))):ie.ACCESS_TOKEN||"",e?"mapbox.eventData.".concat(e,":").concat(n):"mapbox.eventData:".concat(n)}},{key:"fetchEventData",value:function(){var e=J("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{var r=_.localStorage.getItem(t);r&&(this.eventData=JSON.parse(r));var i=_.localStorage.getItem(n);i&&(this.anonId=i)}catch(e){V("Unable to read from LocalStorage")}}},{key:"saveEventData",value:function(){var e=J("localStorage"),t=this.getStorageKey(),n=this.getStorageKey("uuid");if(e)try{_.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&_.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(e){V("Unable to write to LocalStorage")}}},{key:"processRequests",value:function(e){}},{key:"postEvent",value:function(e,t,n,r){var i=this;if(ie.EVENTS_URL){var a=de(ie.EVENTS_URL);a.params.push("access_token=".concat(r||ie.ACCESS_TOKEN||""));var o={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.0.1",skuId:ue,userId:this.anonId},s=t?P(o,t):o,l={url:pe(a),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=ze(l,(function(e){i.pendingRequest=null,n(e),i.saveEventData(),i.processRequests(r)}))}}},{key:"queueRequest",value:function(e,t){this.queue.push(e),this.processRequests(t)}}]),e}(),_e=new(function(e){p(n,e);var t=m(n);function n(e){var r;return v(this,n),(r=t.call(this,"appUserTurnstile"))._customAccessToken=e,r}return y(n,[{key:"postTurnstileEvent",value:function(e,t){ie.EVENTS_URL&&ie.ACCESS_TOKEN&&Array.isArray(e)&&e.some((function(e){return ce(e)||he(e)}))&&this.queueRequest(Date.now(),t)}},{key:"processRequests",value:function(e){var t=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var n=me(ie.ACCESS_TOKEN),r=n?n.u:ie.ACCESS_TOKEN,i=r!==this.eventData.tokenU;D(this.anonId)||(this.anonId=O(),i=!0);var a=this.queue.shift();if(this.eventData.lastSuccess){var o=new Date(this.eventData.lastSuccess),s=new Date(a),l=(a-this.eventData.lastSuccess)/864e5;i=i||l>=1||l<-1||o.getDate()!==s.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(a,{"enabled.telemetry":!1},(function(e){e||(t.eventData.lastSuccess=a,t.eventData.tokenU=r)}),e)}}}]),n}(ge)),be=_e.postTurnstileEvent.bind(_e),xe=new(function(e){p(n,e);var t=m(n);function n(){var e;return v(this,n),(e=t.call(this,"map.load")).success={},e.skuToken="",e}return y(n,[{key:"postMapLoadEvent",value:function(e,t,n,r){this.skuToken=t,this.errorCb=r,ie.EVENTS_URL&&(n||ie.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}},{key:"processRequests",value:function(e){var t=this;if(!this.pendingRequest&&0!==this.queue.length){var n=this.queue.shift(),r=n.id,i=n.timestamp;r&&this.success[r]||(this.anonId||this.fetchEventData(),D(this.anonId)||(this.anonId=O()),this.postEvent(i,{skuToken:this.skuToken},(function(e){e?t.errorCb(e):r&&(t.success[r]=!0)}),e))}}}]),n}(ge)),we=xe.postMapLoadEvent.bind(xe),Ee=new(function(e){p(n,e);var t=m(n);function n(){var e;return v(this,n),(e=t.call(this,"map.auth")).success={},e.skuToken="",e}return y(n,[{key:"getSession",value:function(e,t,n,r){var i=this;if(ie.API_URL&&ie.SESSION_PATH){var a=de(ie.API_URL+ie.SESSION_PATH);a.params.push("sku=".concat(t||"")),a.params.push("access_token=".concat(r||ie.ACCESS_TOKEN||""));var o={url:pe(a),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Fe(o,(function(e){i.pendingRequest=null,n(e),i.saveEventData(),i.processRequests(r)}))}}},{key:"getSessionAPI",value:function(e,t,n,r){this.skuToken=t,this.errorCb=r,ie.SESSION_PATH&&ie.API_URL&&(n||ie.ACCESS_TOKEN?this.queueRequest({id:e,timestamp:Date.now()},n):this.errorCb(new Error("NO_ACCESS_TOKEN")))}},{key:"processRequests",value:function(e){var t=this;if(!this.pendingRequest&&0!==this.queue.length){var n=this.queue.shift(),r=n.id,i=n.timestamp;r&&this.success[r]||this.getSession(i,this.skuToken,(function(e){e?t.errorCb(e):r&&(t.success[r]=!0)}),e)}}}]),n}(ge)),Se=Ee.getSessionAPI.bind(Ee),Te=500,ke=50;function Me(){_.caches&&!ve&&(ve=_.caches.open("mapbox-tiles"))}function Ce(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var Ae,Ie=1/0;function Pe(){return null==Ae&&(Ae=_.OffscreenCanvas&&new _.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof _.createImageBitmap),Ae}var Re={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Re);var Le=function(e){p(n,e);var t=m(n);function n(e,r,i){var a;return v(this,n),401===r&&he(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),(a=t.call(this,e)).status=r,a.url=i,a}return y(n,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),n}(d(Error)),Oe=W()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===_.location.protocol?_.parent:_).location.href},De=function(e,t){if(!(/^file:/.test(n=e.url)||/^file:/.test(Oe())&&!/^\w+:/.test(n))){if(_.fetch&&_.Request&&_.AbortController&&_.Request.prototype.hasOwnProperty("signal"))return function(e,t){var n,r=new _.AbortController,i=new _.Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:Oe(),signal:r.signal}),a=!1,o=!1,s=(n=i.url).indexOf("sku=")>0&&he(n);"json"===e.type&&i.headers.set("Accept","application/json");var l=function(n,r,a){if(!o){if(n&&"SecurityError"!==n.message&&V(n),r&&a)return u(r);var l=Date.now();_.fetch(i).then((function(n){if(n.ok){var r=s?n.clone():null;return u(n,r,l)}return t(new Le(n.statusText,n.status,e.url))})).catch((function(e){20!==e.code&&t(new Error(e.message))}))}},u=function(n,r,s){("arrayBuffer"===e.type?n.arrayBuffer():"json"===e.type?n.json():n.text()).then((function(e){o||(r&&s&&function(e,t,n){if(Me(),ve){var r={status:t.status,statusText:t.statusText,headers:new _.Headers};t.headers.forEach((function(e,t){return r.headers.set(t,e)}));var i=q(t.headers.get("Cache-Control")||"");i["no-store"]||(i["max-age"]&&r.headers.set("Expires",new Date(n+1e3*i["max-age"]).toUTCString()),new Date(r.headers.get("Expires")).getTime()-n<42e4||function(e,t){if(void 0===ye)try{new Response(new ReadableStream),ye=!0}catch(e){ye=!1}ye?t(e.body):e.blob().then(t)}(t,(function(t){var n=new _.Response(t,r);Me(),ve&&ve.then((function(t){return t.put(Ce(e.url),n)})).catch((function(e){return V(e.message)}))})))}}(i,r,s),a=!0,t(null,e,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((function(e){o||t(new Error(e.message))}))};return s?function(e,t){if(Me(),!ve)return t(null);var n=Ce(e.url);ve.then((function(e){e.match(n).then((function(r){var i=function(e){if(!e)return!1;var t=new Date(e.headers.get("Expires")||0),n=q(e.headers.get("Cache-Control")||"");return t>Date.now()&&!n["no-cache"]}(r);e.delete(n),i&&e.put(n,r.clone()),t(null,r,i)})).catch(t)})).catch(t)}(i,l):l(null,null),{cancel:function(){o=!0,a||r.abort()}}}(e,t);if(W()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var n;return function(e,t){var n=new _.XMLHttpRequest;for(var r in n.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(n.responseType="arraybuffer"),e.headers)n.setRequestHeader(r,e.headers[r]);return"json"===e.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===e.credentials,n.onerror=function(){t(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var r=n.response;if("json"===e.type)try{r=JSON.parse(n.response)}catch(e){return t(e)}t(null,r,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else t(new Le(n.statusText,n.status,e.url))},n.send(e.body),{cancel:function(){return n.abort()}}}(e,t)},Ne=function(e,t){return De(P(e,{type:"arrayBuffer"}),t)},ze=function(e,t){return De(P(e,{method:"POST"}),t)},Fe=function(e,t){return De(P(e,{method:"GET"}),t)};function Be(e){var t=_.document.createElement("a");return t.href=e,t.protocol===_.document.location.protocol&&t.host===_.document.location.host}var Ue,je,Ve="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";Ue=[],je=0;var He=function e(t,n){if(ae.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),je>=ie.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:t,callback:n,cancelled:!1,cancel:function(){this.cancelled=!0}};return Ue.push(r),r}je++;var i=!1,a=function(){if(!i)for(i=!0,je--;Ue.length&&je<ie.MAX_PARALLEL_IMAGE_REQUESTS;){var t=Ue.shift(),n=t.requestParameters,r=t.callback;t.cancelled||(t.cancel=e(n,r).cancel)}},o=Ne(t,(function(e,t,r,i){a(),e?n(e):t&&(Pe()?function(e,t){var n=new _.Blob([new Uint8Array(e)],{type:"image/png"});_.createImageBitmap(n).then((function(e){t(null,e)})).catch((function(e){t(new Error("Could not load image because of ".concat(e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))}))}(t,n):function(e,t,n,r){var i=new _.Image,a=_.URL;i.onload=function(){t(null,i),a.revokeObjectURL(i.src),i.onload=null,_.requestAnimationFrame((function(){i.src=Ve}))},i.onerror=function(){return t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var o=new _.Blob([new Uint8Array(e)],{type:"image/png"});i.cacheControl=n,i.expires=r,i.src=e.byteLength?a.createObjectURL(o):Ve}(t,n,r,i))}));return{cancel:function(){o.cancel(),a()}}};function Ge(e,t,n){n[e]&&-1!==n[e].indexOf(t)||(n[e]=n[e]||[],n[e].push(t))}function We(e,t,n){if(n&&n[e]){var r=n[e].indexOf(t);-1!==r&&n[e].splice(r,1)}}var qe=function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};v(this,e),P(this,n),this.type=t},Xe=function(e){p(n,e);var t=m(n);function n(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return v(this,n),t.call(this,"error",P({error:e},r))}return n}(qe),Ze=function(){function e(){v(this,e)}return y(e,[{key:"on",value:function(e,t){return this._listeners=this._listeners||{},Ge(e,t,this._listeners),this}},{key:"off",value:function(e,t){return We(e,t,this._listeners),We(e,t,this._oneTimeListeners),this}},{key:"once",value:function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},Ge(e,t,this._oneTimeListeners),this}},{key:"fire",value:function(e,t){"string"==typeof e&&(e=new qe(e,t||{}));var n=e.type;if(this.listens(n)){e.target=this;var r,i=this._listeners&&this._listeners[n]?this._listeners[n].slice():[],a=f(i);try{for(a.s();!(r=a.n()).done;)r.value.call(this,e)}catch(h){a.e(h)}finally{a.f()}var o,s=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[],l=f(s);try{for(l.s();!(o=l.n()).done;){var u=o.value;We(n,u,this._oneTimeListeners),u.call(this,e)}}catch(h){l.e(h)}finally{l.f()}var c=this._eventedParent;c&&(P(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),c.fire(e))}else e instanceof Xe&&console.error(e.error);return this}},{key:"listens",value:function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}},{key:"setEventedParent",value:function(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}]),e}(),Ke={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Ye=function e(t,n,r,i){v(this,e),this.message=(t?"".concat(t,": "):"")+r,i&&(this.identifier=i),null!=n&&n.__line__&&(this.line=n.__line__)};function Je(e){var t=e.value;return t?[new Ye(e.key,t,"constants have been deprecated as of v8")]:[]}function Qe(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){var o=a[i];for(var s in o)e[s]=o[s]}return e}function $e(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function et(e){if(Array.isArray(e))return e.map(et);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var n in e)t[n]=et(e[n]);return t}return $e(e)}var tt=function(e){p(n,e);var t=m(n);function n(e,r){var i;return v(this,n),(i=t.call(this,r)).message=r,i.key=e,i}return n}(d(Error)),nt=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];v(this,e),this.parent=t,this.bindings={};var r,i=f(n);try{for(i.s();!(r=i.n()).done;){var a=h(r.value,2),o=a[0],s=a[1];this.bindings[o]=s}}catch(l){i.e(l)}finally{i.f()}}return y(e,[{key:"concat",value:function(t){return new e(this,t)}},{key:"get",value:function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error("".concat(e," not found in scope."))}},{key:"has",value:function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}]),e}(),rt={kind:"null"},it={kind:"number"},at={kind:"string"},ot={kind:"boolean"},st={kind:"color"},lt={kind:"object"},ut={kind:"value"},ct={kind:"collator"},ht={kind:"formatted"},ft={kind:"resolvedImage"};function dt(e,t){return{kind:"array",itemType:e,N:t}}function pt(e){if("array"===e.kind){var t=pt(e.itemType);return"number"==typeof e.N?"array<".concat(t,", ").concat(e.N,">"):"value"===e.itemType.kind?"array":"array<".concat(t,">")}return e.kind}var mt=[rt,it,at,ot,st,ht,lt,dt(ut),ft];function vt(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!vt(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind){var n,r=f(mt);try{for(r.s();!(n=r.n()).done;)if(!vt(n.value,t))return null}catch(i){r.e(i)}finally{r.f()}}}return"Expected ".concat(pt(e)," but found ").concat(pt(t)," instead.")}function yt(e,t){return t.some((function(t){return t.kind===e.kind}))}function gt(e,t){return t.some((function(t){return"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e}))}function _t(e,t){return e(t={exports:{}},t.exports),t.exports}var bt=_t((function(e,t){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(e){return(e=Math.round(e))<0?0:e>255?255:e}function i(e){return r("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function a(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function o(e,t,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?e+(t-e)*n*6:2*n<1?t:3*n<2?e+(t-e)*(2/3-n)*6:e}try{t.parseCSSColor=function(e){var t,s=e.replace(/ /g,"").toLowerCase();if(s in n)return n[s].slice();if("#"===s[0])return 4===s.length?(t=parseInt(s.substr(1),16))>=0&&t<=4095?[(3840&t)>>4|(3840&t)>>8,240&t|(240&t)>>4,15&t|(15&t)<<4,1]:null:7===s.length&&(t=parseInt(s.substr(1),16))>=0&&t<=16777215?[(16711680&t)>>16,(65280&t)>>8,255&t,1]:null;var l=s.indexOf("("),u=s.indexOf(")");if(-1!==l&&u+1===s.length){var c=s.substr(0,l),h=s.substr(l+1,u-(l+1)).split(","),f=1;switch(c){case"rgba":if(4!==h.length)return null;f=a(h.pop());case"rgb":return 3!==h.length?null:[i(h[0]),i(h[1]),i(h[2]),f];case"hsla":if(4!==h.length)return null;f=a(h.pop());case"hsl":if(3!==h.length)return null;var d=(parseFloat(h[0])%360+360)%360/360,p=a(h[1]),m=a(h[2]),v=m<=.5?m*(p+1):m+p-m*p,y=2*m-v;return[r(255*o(y,v,d+1/3)),r(255*o(y,v,d)),r(255*o(y,v,d-1/3)),f];default:return null}}return null}}catch(e){}})).parseCSSColor,xt=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;v(this,e),this.r=t,this.g=n,this.b=r,this.a=i}return y(e,[{key:"toString",value:function(){var e=this.toArray(),t=h(e,4),n=t[0],r=t[1],i=t[2],a=t[3];return"rgba(".concat(Math.round(n),",").concat(Math.round(r),",").concat(Math.round(i),",").concat(a,")")}},{key:"toArray",value:function(){var e=this.r,t=this.g,n=this.b,r=this.a;return 0===r?[0,0,0,0]:[255*e/r,255*t/r,255*n/r,r]}}],[{key:"parse",value:function(t){if(t){if(t instanceof e)return t;if("string"==typeof t){var n=bt(t);return n?new e(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}}}}]),e}();xt.black=new xt(0,0,0,1),xt.white=new xt(1,1,1,1),xt.transparent=new xt(0,0,0,0),xt.red=new xt(1,0,0,1),xt.blue=new xt(0,0,1,1);var wt=function(){function e(t,n,r){v(this,e),this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}return y(e,[{key:"compare",value:function(e,t){return this.collator.compare(e,t)}},{key:"resolvedLocale",value:function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}]),e}(),Et=function e(t,n,r,i,a){v(this,e),this.text=t,this.image=n,this.scale=r,this.fontStack=i,this.textColor=a},St=function(){function e(t){v(this,e),this.sections=t}return y(e,[{key:"isEmpty",value:function(){return 0===this.sections.length||!this.sections.some((function(e){return 0!==e.text.length||e.image&&0!==e.image.name.length}))}},{key:"toString",value:function(){return 0===this.sections.length?"":this.sections.map((function(e){return e.text})).join("")}},{key:"serialize",value:function(){var e,t=["format"],n=f(this.sections);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r.image)t.push(["image",r.image.name]);else{t.push(r.text);var i={};r.fontStack&&(i["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(i["font-scale"]=r.scale),r.textColor&&(i["text-color"]=["rgba"].concat(r.textColor.toArray())),t.push(i)}}}catch(a){n.e(a)}finally{n.f()}return t}}],[{key:"fromString",value:function(t){return new e([new Et(t,null,null,null,null)])}},{key:"factory",value:function(t){return t instanceof e?t:e.fromString(t)}}]),e}(),Tt=function(){function e(t){v(this,e),this.name=t.name,this.available=t.available}return y(e,[{key:"toString",value:function(){return this.name}},{key:"serialize",value:function(){return["image",this.name]}}],[{key:"fromString",value:function(t){return t?new e({name:t,available:!1}):null}}]),e}();function kt(e,t,n,r){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:"Invalid rgba value [".concat([e,t,n,r].join(", "),"]: 'a' must be between 0 and 1."):"Invalid rgba value [".concat(("number"==typeof r?[e,t,n,r]:[e,t,n]).join(", "),"]: 'r', 'g', and 'b' must be between 0 and 255.")}function Mt(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof xt)return!0;if(e instanceof wt)return!0;if(e instanceof St)return!0;if(e instanceof Tt)return!0;if(Array.isArray(e)){var t,n=f(e);try{for(n.s();!(t=n.n()).done;)if(!Mt(t.value))return!1}catch(i){n.e(i)}finally{n.f()}return!0}if("object"==typeof e){for(var r in e)if(!Mt(e[r]))return!1;return!0}return!1}function Ct(e){if(null===e)return rt;if("string"==typeof e)return at;if("boolean"==typeof e)return ot;if("number"==typeof e)return it;if(e instanceof xt)return st;if(e instanceof wt)return ct;if(e instanceof St)return ht;if(e instanceof Tt)return ft;if(Array.isArray(e)){var t,n,r=e.length,i=f(e);try{for(i.s();!(n=i.n()).done;){var a=Ct(n.value);if(t){if(t===a)continue;t=ut;break}t=a}}catch(o){i.e(o)}finally{i.f()}return dt(t||ut,r)}return lt}function At(e){var t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof xt||e instanceof St||e instanceof Tt?e.toString():JSON.stringify(e)}var It=function(){function e(t,n){v(this,e),this.type=t,this.value=n}return y(e,[{key:"evaluate",value:function(){return this.value}},{key:"eachChild",value:function(){}},{key:"outputDefined",value:function(){return!0}},{key:"serialize",value:function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof xt?["rgba"].concat(this.value.toArray()):this.value instanceof St?this.value.serialize():this.value}}],[{key:"parse",value:function(t,n){if(2!==t.length)return n.error("'literal' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(!Mt(t[1]))return n.error("invalid value");var r=t[1],i=Ct(r),a=n.expectedType;return"array"!==i.kind||0!==i.N||!a||"array"!==a.kind||"number"==typeof a.N&&0!==a.N||(i=a),new e(i,r)}}]),e}(),Pt=function(){function e(t){v(this,e),this.name="ExpressionEvaluationError",this.message=t}return y(e,[{key:"toJSON",value:function(){return this.message}}]),e}(),Rt={string:at,number:it,boolean:ot,object:lt},Lt=function(){function e(t,n){v(this,e),this.type=t,this.args=n}return y(e,[{key:"evaluate",value:function(e){for(var t=0;t<this.args.length;t++){var n=this.args[t].evaluate(e);if(!vt(this.type,Ct(n)))return n;if(t===this.args.length-1)throw new Pt("Expected value to be of type ".concat(pt(this.type),", but found ").concat(pt(Ct(n))," instead."))}return null}},{key:"eachChild",value:function(e){this.args.forEach(e)}},{key:"outputDefined",value:function(){return this.args.every((function(e){return e.outputDefined()}))}},{key:"serialize",value:function(){var e=this.type,t=[e.kind];if("array"===e.kind){var n=e.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){t.push(n.kind);var r=e.N;("number"==typeof r||this.args.length>1)&&t.push(r)}}return t.concat(this.args.map((function(e){return e.serialize()})))}}],[{key:"parse",value:function(t,n){if(t.length<2)return n.error("Expected at least one argument.");var r,i=1,a=t[0];if("array"===a){var o,s;if(t.length>2){var l=t[1];if("string"!=typeof l||!(l in Rt)||"object"===l)return n.error('The item type argument of "array" must be one of string, number, boolean',1);o=Rt[l],i++}else o=ut;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);s=t[2],i++}r=dt(o,s)}else r=Rt[a];for(var u=[];i<t.length;i++){var c=n.parse(t[i],i,ut);if(!c)return null;u.push(c)}return new e(r,u)}}]),e}(),Ot=function(){function e(t){v(this,e),this.type=ht,this.sections=t}return y(e,[{key:"evaluate",value:function(e){return new St(this.sections.map((function(t){var n=t.content.evaluate(e);return Ct(n)===ft?new Et("",n,null,null,null):new Et(At(n),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)})))}},{key:"eachChild",value:function(e){var t,n=f(this.sections);try{for(n.s();!(t=n.n()).done;){var r=t.value;e(r.content),r.scale&&e(r.scale),r.font&&e(r.font),r.textColor&&e(r.textColor)}}catch(i){n.e(i)}finally{n.f()}}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){var e,t=["format"],n=f(this.sections);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push(r.content.serialize());var i={};r.scale&&(i["font-scale"]=r.scale.serialize()),r.font&&(i["text-font"]=r.font.serialize()),r.textColor&&(i["text-color"]=r.textColor.serialize()),t.push(i)}}catch(a){n.e(a)}finally{n.f()}return t}}],[{key:"parse",value:function(t,n){if(t.length<2)return n.error("Expected at least one argument.");var r=t[1];if(!Array.isArray(r)&&"object"==typeof r)return n.error("First argument must be an image or text section.");for(var i=[],a=!1,o=1;o<=t.length-1;++o){var s=t[o];if(a&&"object"==typeof s&&!Array.isArray(s)){a=!1;var l=null;if(s["font-scale"]&&!(l=n.parse(s["font-scale"],1,it)))return null;var u=null;if(s["text-font"]&&!(u=n.parse(s["text-font"],1,dt(at))))return null;var c=null;if(s["text-color"]&&!(c=n.parse(s["text-color"],1,st)))return null;var h=i[i.length-1];h.scale=l,h.font=u,h.textColor=c}else{var f=n.parse(t[o],1,ut);if(!f)return null;var d=f.type.kind;if("string"!==d&&"value"!==d&&"null"!==d&&"resolvedImage"!==d)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");a=!0,i.push({content:f,scale:null,font:null,textColor:null})}}return new e(i)}}]),e}(),Dt=function(){function e(t){v(this,e),this.type=ft,this.input=t}return y(e,[{key:"evaluate",value:function(e){var t=this.input.evaluate(e),n=Tt.fromString(t);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(t)>-1),n}},{key:"eachChild",value:function(e){e(this.input)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){return["image",this.input.serialize()]}}],[{key:"parse",value:function(t,n){if(2!==t.length)return n.error("Expected two arguments.");var r=n.parse(t[1],1,at);return r?new e(r):n.error("No image name provided.")}}]),e}(),Nt={"to-boolean":ot,"to-color":st,"to-number":it,"to-string":at},zt=function(){function e(t,n){v(this,e),this.type=t,this.args=n}return y(e,[{key:"evaluate",value:function(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){var t,n,r,i=f(this.args);try{for(i.s();!(r=i.n()).done;){if(t=r.value.evaluate(e),n=null,t instanceof xt)return t;if("string"==typeof t){var a=e.parseColor(t);if(a)return a}else if(Array.isArray(t)&&!(n=t.length<3||t.length>4?"Invalid rbga value ".concat(JSON.stringify(t),": expected an array containing either three or four numeric values."):kt(t[0],t[1],t[2],t[3])))return new xt(t[0]/255,t[1]/255,t[2]/255,t[3])}}catch(c){i.e(c)}finally{i.f()}throw new Pt(n||"Could not parse color from value '".concat("string"==typeof t?t:String(JSON.stringify(t)),"'"))}if("number"===this.type.kind){var o,s=null,l=f(this.args);try{for(l.s();!(o=l.n()).done;){if(null===(s=o.value.evaluate(e)))return 0;var u=Number(s);if(!isNaN(u))return u}}catch(c){l.e(c)}finally{l.f()}throw new Pt("Could not convert ".concat(JSON.stringify(s)," to number."))}return"formatted"===this.type.kind?St.fromString(At(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Tt.fromString(At(this.args[0].evaluate(e))):At(this.args[0].evaluate(e))}},{key:"eachChild",value:function(e){this.args.forEach(e)}},{key:"outputDefined",value:function(){return this.args.every((function(e){return e.outputDefined()}))}},{key:"serialize",value:function(){if("formatted"===this.type.kind)return new Ot([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Dt(this.args[0]).serialize();var e=["to-".concat(this.type.kind)];return this.eachChild((function(t){e.push(t.serialize())})),e}}],[{key:"parse",value:function(t,n){if(t.length<2)return n.error("Expected at least one argument.");var r=t[0];if(("to-boolean"===r||"to-string"===r)&&2!==t.length)return n.error("Expected one argument.");for(var i=Nt[r],a=[],o=1;o<t.length;o++){var s=n.parse(t[o],o,ut);if(!s)return null;a.push(s)}return new e(i,a)}}]),e}(),Ft=["Unknown","Point","LineString","Polygon"],Bt=function(){function e(){v(this,e),this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}return y(e,[{key:"id",value:function(){return this.feature&&"id"in this.feature?this.feature.id:null}},{key:"geometryType",value:function(){return this.feature?"number"==typeof this.feature.type?Ft[this.feature.type]:this.feature.type:null}},{key:"geometry",value:function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}},{key:"canonicalID",value:function(){return this.canonical}},{key:"properties",value:function(){return this.feature&&this.feature.properties||{}}},{key:"parseColor",value:function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=xt.parse(e)),t}}]),e}(),Ut=function(){function e(t,n,r,i){v(this,e),this.name=t,this.type=n,this._evaluate=r,this.args=i}return y(e,[{key:"evaluate",value:function(e){return this._evaluate(e,this.args)}},{key:"eachChild",value:function(e){this.args.forEach(e)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){return[this.name].concat(this.args.map((function(e){return e.serialize()})))}}],[{key:"parse",value:function(t,n){var r,i=t[0],a=e.definitions[i];if(!a)return n.error('Unknown expression "'.concat(i,'". If you wanted a literal array, use ["literal", [...]].'),0);var o,s=Array.isArray(a)?a[0]:a.type,l=Array.isArray(a)?[[a[1],a[2]]]:a.overloads,u=l.filter((function(e){var n=h(e,1)[0];return!Array.isArray(n)||n.length===t.length-1})),d=null,p=f(u);try{for(p.s();!(o=p.n()).done;){var m=h(o.value,2),v=m[0],y=m[1];d=new un(n.registry,n.path,null,n.scope);for(var g=[],_=!1,b=1;b<t.length;b++){var x=t[b],w=Array.isArray(v)?v[b-1]:v.type,E=d.parse(x,1+g.length,w);if(!E){_=!0;break}g.push(E)}if(!_)if(Array.isArray(v)&&v.length!==g.length)d.error("Expected ".concat(v.length," arguments, but found ").concat(g.length," instead."));else{for(var S=0;S<g.length;S++){var T=Array.isArray(v)?v[S]:v.type,k=g[S];d.concat(S+1).checkSubtype(T,k.type)}if(0===d.errors.length)return new e(i,s,y,g)}}}catch(P){p.e(P)}finally{p.f()}if(1===u.length)(r=n.errors).push.apply(r,c(d.errors));else{for(var M=(u.length?u:l).map((function(e){var t;return t=h(e,1)[0],Array.isArray(t)?"(".concat(t.map(pt).join(", "),")"):"(".concat(pt(t.type),"...)")})).join(" | "),C=[],A=1;A<t.length;A++){var I=n.parse(t[A],1+C.length);if(!I)return null;C.push(pt(I.type))}n.error("Expected arguments of type ".concat(M,", but found (").concat(C.join(", "),") instead."))}return null}},{key:"register",value:function(t,n){for(var r in e.definitions=n,n)t[r]=e}}]),e}(),jt=function(){function e(t,n,r){v(this,e),this.type=ct,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=n}return y(e,[{key:"evaluate",value:function(e){return new wt(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}},{key:"eachChild",value:function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}],[{key:"parse",value:function(t,n){if(2!==t.length)return n.error("Expected one argument.");var r=t[1];if("object"!=typeof r||Array.isArray(r))return n.error("Collator options argument must be an object.");var i=n.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,ot);if(!i)return null;var a=n.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,ot);if(!a)return null;var o=null;return r.locale&&!(o=n.parse(r.locale,1,at))?null:new e(i,a,o)}}]),e}();function Vt(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function Ht(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function Gt(e,t){var n=(180+e[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,i=Math.pow(2,t.z);return[Math.round(n*i*8192),Math.round(r*i*8192)]}function Wt(e,t,n){var r=e[0]-t[0],i=e[1]-t[1],a=e[0]-n[0],o=e[1]-n[1];return r*o-a*i==0&&r*a<=0&&i*o<=0}function qt(e,t){for(var n,r,i,a=!1,o=0,s=t.length;o<s;o++)for(var l=t[o],u=0,c=l.length;u<c-1;u++){if(Wt(e,l[u],l[u+1]))return!1;(r=l[u])[1]>(n=e)[1]!=(i=l[u+1])[1]>n[1]&&n[0]<(i[0]-r[0])*(n[1]-r[1])/(i[1]-r[1])+r[0]&&(a=!a)}return a}function Xt(e,t){for(var n=0;n<t.length;n++)if(qt(e,t[n]))return!0;return!1}function Zt(e,t,n,r){var i=r[0]-n[0],a=r[1]-n[1],o=(e[0]-n[0])*a-i*(e[1]-n[1]),s=(t[0]-n[0])*a-i*(t[1]-n[1]);return o>0&&s<0||o<0&&s>0}function Kt(e,t,n){var r,i,a,o,s,l,u,c=f(n);try{for(c.s();!(r=c.n()).done;)for(var h=r.value,d=0;d<h.length-1;++d)if(0!=(l=[(s=h[d+1])[0]-(o=h[d])[0],s[1]-o[1]])[0]*(u=[(a=t)[0]-(i=e)[0],a[1]-i[1]])[1]-l[1]*u[0]&&Zt(i,a,o,s)&&Zt(o,s,i,a))return!0}catch(p){c.e(p)}finally{c.f()}return!1}function Yt(e,t){for(var n=0;n<e.length;++n)if(!qt(e[n],t))return!1;for(var r=0;r<e.length-1;++r)if(Kt(e[r],e[r+1],t))return!1;return!0}function Jt(e,t){for(var n=0;n<t.length;n++)if(Yt(e,t[n]))return!0;return!1}function Qt(e,t,n){for(var r=[],i=0;i<e.length;i++){for(var a=[],o=0;o<e[i].length;o++){var s=Gt(e[i][o],n);Vt(t,s),a.push(s)}r.push(a)}return r}function $t(e,t,n){for(var r=[],i=0;i<e.length;i++){var a=Qt(e[i],t,n);r.push(a)}return r}function en(e,t,n,r){if(e[0]<n[0]||e[0]>n[2]){var i=.5*r,a=e[0]-n[0]>i?-r:n[0]-e[0]>i?r:0;0===a&&(a=e[0]-n[2]>i?-r:n[2]-e[0]>i?r:0),e[0]+=a}Vt(t,e)}function tn(e,t,n,r){var i,a=8192*Math.pow(2,r.z),o=[8192*r.x,8192*r.y],s=[],l=f(e);try{for(l.s();!(i=l.n()).done;){var u,c=i.value,h=f(c);try{for(h.s();!(u=h.n()).done;){var d=u.value,p=[d.x+o[0],d.y+o[1]];en(p,t,n,a),s.push(p)}}catch(m){h.e(m)}finally{h.f()}}}catch(m){l.e(m)}finally{l.f()}return s}function nn(e,t,n,r){var i,a,o=8192*Math.pow(2,r.z),s=[8192*r.x,8192*r.y],l=[],u=f(e);try{for(u.s();!(i=u.n()).done;){var c,h=i.value,d=[],p=f(h);try{for(p.s();!(c=p.n()).done;){var m=c.value,v=[m.x+s[0],m.y+s[1]];Vt(t,v),d.push(v)}}catch(w){p.e(w)}finally{p.f()}l.push(d)}}catch(w){u.e(w)}finally{u.f()}if(t[2]-t[0]<=o/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;var y,g=f(l);try{for(g.s();!(y=g.n()).done;){var _,b=y.value,x=f(b);try{for(x.s();!(_=x.n()).done;)en(_.value,t,n,o)}catch(w){x.e(w)}finally{x.f()}}}catch(w){g.e(w)}finally{g.f()}}return l}var rn=function(){function e(t,n){v(this,e),this.type=ot,this.geojson=t,this.geometries=n}return y(e,[{key:"evaluate",value:function(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){var n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if("Polygon"===t.type){var a=Qt(t.coordinates,r,i),o=tn(e.geometry(),n,r,i);if(!Ht(n,r))return!1;var s,l=f(o);try{for(l.s();!(s=l.n()).done;)if(!qt(s.value,a))return!1}catch(p){l.e(p)}finally{l.f()}}if("MultiPolygon"===t.type){var u=$t(t.coordinates,r,i),c=tn(e.geometry(),n,r,i);if(!Ht(n,r))return!1;var h,d=f(c);try{for(d.s();!(h=d.n()).done;)if(!Xt(h.value,u))return!1}catch(p){d.e(p)}finally{d.f()}}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){var n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if("Polygon"===t.type){var a=Qt(t.coordinates,r,i),o=nn(e.geometry(),n,r,i);if(!Ht(n,r))return!1;var s,l=f(o);try{for(l.s();!(s=l.n()).done;)if(!Yt(s.value,a))return!1}catch(p){l.e(p)}finally{l.f()}}if("MultiPolygon"===t.type){var u=$t(t.coordinates,r,i),c=nn(e.geometry(),n,r,i);if(!Ht(n,r))return!1;var h,d=f(c);try{for(d.s();!(h=d.n()).done;)if(!Jt(h.value,u))return!1}catch(p){d.e(p)}finally{d.f()}}return!0}(e,this.geometries)}return!1}},{key:"eachChild",value:function(){}},{key:"outputDefined",value:function(){return!0}},{key:"serialize",value:function(){return["within",this.geojson]}}],[{key:"parse",value:function(t,n){if(2!==t.length)return n.error("'within' expression requires exactly one argument, but found ".concat(t.length-1," instead."));if(Mt(t[1])){var r=t[1];if("FeatureCollection"===r.type)for(var i=0;i<r.features.length;++i){var a=r.features[i].geometry.type;if("Polygon"===a||"MultiPolygon"===a)return new e(r,r.features[i].geometry)}else if("Feature"===r.type){var o=r.geometry.type;if("Polygon"===o||"MultiPolygon"===o)return new e(r,r.geometry)}else if("Polygon"===r.type||"MultiPolygon"===r.type)return new e(r,r)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}}]),e}();function an(e){if(e instanceof Ut){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof rn)return!1;var t=!0;return e.eachChild((function(e){t&&!an(e)&&(t=!1)})),t}function on(e){if(e instanceof Ut&&"feature-state"===e.name)return!1;var t=!0;return e.eachChild((function(e){t&&!on(e)&&(t=!1)})),t}function sn(e,t){if(e instanceof Ut&&t.indexOf(e.name)>=0)return!1;var n=!0;return e.eachChild((function(e){n&&!sn(e,t)&&(n=!1)})),n}var ln=function(){function e(t,n){v(this,e),this.type=n.type,this.name=t,this.boundExpression=n}return y(e,[{key:"evaluate",value:function(e){return this.boundExpression.evaluate(e)}},{key:"eachChild",value:function(){}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){return["var",this.name]}}],[{key:"parse",value:function(t,n){if(2!==t.length||"string"!=typeof t[1])return n.error("'var' expression requires exactly one string literal argument.");var r=t[1];return n.scope.has(r)?new e(r,n.scope.get(r)):n.error('Unknown variable "'.concat(r,'". Make sure "').concat(r,'" has been bound in an enclosing "let" expression before using it.'),1)}}]),e}(),un=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new nt,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];v(this,e),this.registry=t,this.path=n,this.key=n.map((function(e){return"[".concat(e,"]")})).join(""),this.scope=i,this.errors=a,this.expectedType=r}return y(e,[{key:"parse",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t?this.concat(t,n,r)._parse(e,i):this._parse(e,i)}},{key:"_parse",value:function(e,t){function n(e,t,n){return"assert"===n?new Lt(t,[e]):"coerce"===n?new zt(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var r=e[0];if("string"!=typeof r)return this.error("Expression name must be a string, but found ".concat(typeof r,' instead. If you wanted a literal array, use ["literal", [...]].'),0),null;var i=this.registry[r];if(i){var a=i.parse(e,this);if(!a)return null;if(this.expectedType){var o=this.expectedType,s=a.type;if("string"!==o.kind&&"number"!==o.kind&&"boolean"!==o.kind&&"object"!==o.kind&&"array"!==o.kind||"value"!==s.kind)if("color"!==o.kind&&"formatted"!==o.kind&&"resolvedImage"!==o.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(o,s))return null}else a=n(a,o,t.typeAnnotation||"coerce");else a=n(a,o,t.typeAnnotation||"assert")}if(!(a instanceof It)&&"resolvedImage"!==a.type.kind&&function e(t){if(t instanceof ln)return e(t.boundExpression);if(t instanceof Ut&&"error"===t.name)return!1;if(t instanceof jt)return!1;if(t instanceof rn)return!1;var n=t instanceof zt||t instanceof Lt,r=!0;return t.eachChild((function(t){r=n?r&&e(t):r&&t instanceof It})),!!r&&an(t)&&sn(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script"])}(a)){var l=new Bt;try{a=new It(a.type,a.evaluate(l))}catch(e){return this.error(e.message),null}}return a}return this.error('Unknown expression "'.concat(r,'". If you wanted a literal array, use ["literal", [...]].'),0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found ".concat(typeof e," instead."))}},{key:"concat",value:function(t,n,r){var i="number"==typeof t?this.path.concat(t):this.path,a=r?this.scope.concat(r):this.scope;return new e(this.registry,i,n||null,a,this.errors)}},{key:"error",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i="".concat(this.key).concat(n.map((function(e){return"[".concat(e,"]")})).join(""));this.errors.push(new tt(i,e))}},{key:"checkSubtype",value:function(e,t){var n=vt(e,t);return n&&this.error(n),n}}]),e}();function cn(e,t){for(var n,r,i=e.length-1,a=0,o=i,s=0;a<=o;)if(n=e[s=Math.floor((a+o)/2)],r=e[s+1],n<=t){if(s===i||t<r)return s;a=s+1}else{if(!(n>t))throw new Pt("Input is not a number.");o=s-1}return 0}var hn=function(){function e(t,n,r){v(this,e),this.type=t,this.input=n,this.labels=[],this.outputs=[];var i,a=f(r);try{for(a.s();!(i=a.n()).done;){var o=h(i.value,2),s=o[0],l=o[1];this.labels.push(s),this.outputs.push(l)}}catch(u){a.e(u)}finally{a.f()}}return y(e,[{key:"evaluate",value:function(e){var t=this.labels,n=this.outputs;if(1===t.length)return n[0].evaluate(e);var r=this.input.evaluate(e);if(r<=t[0])return n[0].evaluate(e);var i=t.length;return r>=t[i-1]?n[i-1].evaluate(e):n[cn(t,r)].evaluate(e)}},{key:"eachChild",value:function(e){e(this.input);var t,n=f(this.outputs);try{for(n.s();!(t=n.n()).done;)e(t.value)}catch(r){n.e(r)}finally{n.f()}}},{key:"outputDefined",value:function(){return this.outputs.every((function(e){return e.outputDefined()}))}},{key:"serialize",value:function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}],[{key:"parse",value:function(t,n){if(t.length-1<4)return n.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");var r=n.parse(t[1],1,it);if(!r)return null;var i=[],a=null;n.expectedType&&"value"!==n.expectedType.kind&&(a=n.expectedType);for(var o=1;o<t.length;o+=2){var s=1===o?-1/0:t[o],l=t[o+1],u=o,c=o+1;if("number"!=typeof s)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(i.length&&i[i.length-1][0]>=s)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var h=n.parse(l,c,a);if(!h)return null;a=a||h.type,i.push([s,h])}return new e(a,r,i)}}]),e}();function fn(e,t,n){return e*(1-n)+t*n}var dn=Object.freeze({__proto__:null,number:fn,color:function(e,t,n){return new xt(fn(e.r,t.r,n),fn(e.g,t.g,n),fn(e.b,t.b,n),fn(e.a,t.a,n))},array:function(e,t,n){return e.map((function(e,r){return fn(e,t[r],n)}))}}),pn=6/29*3*(6/29),mn=Math.PI/180,vn=180/Math.PI;function yn(e){return e>.008856451679035631?Math.pow(e,1/3):e/pn+4/29}function gn(e){return e>6/29?e*e*e:pn*(e-4/29)}function _n(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function bn(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function xn(e){var t=bn(e.r),n=bn(e.g),r=bn(e.b),i=yn((.4124564*t+.3575761*n+.1804375*r)/.95047),a=yn((.2126729*t+.7151522*n+.072175*r)/1);return{l:116*a-16,a:500*(i-a),b:200*(a-yn((.0193339*t+.119192*n+.9503041*r)/1.08883)),alpha:e.a}}function wn(e){var t=(e.l+16)/116,n=isNaN(e.a)?t:t+e.a/500,r=isNaN(e.b)?t:t-e.b/200;return t=1*gn(t),n=.95047*gn(n),r=1.08883*gn(r),new xt(_n(3.2404542*n-1.5371385*t-.4985314*r),_n(-.969266*n+1.8760108*t+.041556*r),_n(.0556434*n-.2040259*t+1.0572252*r),e.alpha)}function En(e,t,n){var r=t-e;return e+n*(r>180||r<-180?r-360*Math.round(r/360):r)}var Sn={forward:xn,reverse:wn,interpolate:function(e,t,n){return{l:fn(e.l,t.l,n),a:fn(e.a,t.a,n),b:fn(e.b,t.b,n),alpha:fn(e.alpha,t.alpha,n)}}},Tn={forward:function(e){var t=xn(e),n=t.l,r=t.a,i=t.b,a=Math.atan2(i,r)*vn;return{h:a<0?a+360:a,c:Math.sqrt(r*r+i*i),l:n,alpha:e.a}},reverse:function(e){var t=e.h*mn,n=e.c;return wn({l:e.l,a:Math.cos(t)*n,b:Math.sin(t)*n,alpha:e.alpha})},interpolate:function(e,t,n){return{h:En(e.h,t.h,n),c:fn(e.c,t.c,n),l:fn(e.l,t.l,n),alpha:fn(e.alpha,t.alpha,n)}}},kn=Object.freeze({__proto__:null,lab:Sn,hcl:Tn}),Mn=function(){function e(t,n,r,i,a){v(this,e),this.type=t,this.operator=n,this.interpolation=r,this.input=i,this.labels=[],this.outputs=[];var o,s=f(a);try{for(s.s();!(o=s.n()).done;){var l=h(o.value,2),u=l[0],c=l[1];this.labels.push(u),this.outputs.push(c)}}catch(d){s.e(d)}finally{s.f()}}return y(e,[{key:"evaluate",value:function(t){var n=this.labels,r=this.outputs;if(1===n.length)return r[0].evaluate(t);var i=this.input.evaluate(t);if(i<=n[0])return r[0].evaluate(t);var a=n.length;if(i>=n[a-1])return r[a-1].evaluate(t);var o=cn(n,i),s=e.interpolationFactor(this.interpolation,i,n[o],n[o+1]),l=r[o].evaluate(t),u=r[o+1].evaluate(t);return"interpolate"===this.operator?dn[this.type.kind.toLowerCase()](l,u,s):"interpolate-hcl"===this.operator?Tn.reverse(Tn.interpolate(Tn.forward(l),Tn.forward(u),s)):Sn.reverse(Sn.interpolate(Sn.forward(l),Sn.forward(u),s))}},{key:"eachChild",value:function(e){e(this.input);var t,n=f(this.outputs);try{for(n.s();!(t=n.n()).done;)e(t.value)}catch(r){n.e(r)}finally{n.f()}}},{key:"outputDefined",value:function(){return this.outputs.every((function(e){return e.outputDefined()}))}},{key:"serialize",value:function(){var e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],n=0;n<this.labels.length;n++)t.push(this.labels[n],this.outputs[n].serialize());return t}}],[{key:"interpolationFactor",value:function(e,n,r,i){var a=0;if("exponential"===e.name)a=Cn(n,e.base,r,i);else if("linear"===e.name)a=Cn(n,1,r,i);else if("cubic-bezier"===e.name){var o=e.controlPoints;a=new t(o[0],o[1],o[2],o[3]).solve(Cn(n,1,r,i))}return a}},{key:"parse",value:function(t,n){var r=u(t),i=r[0],a=r[1],o=r[2],s=r.slice(3);if(!Array.isArray(a)||0===a.length)return n.error("Expected an interpolation type expression.",1);if("linear"===a[0])a={name:"linear"};else if("exponential"===a[0]){var l=a[1];if("number"!=typeof l)return n.error("Exponential interpolation requires a numeric base.",1,1);a={name:"exponential",base:l}}else{if("cubic-bezier"!==a[0])return n.error("Unknown interpolation type ".concat(String(a[0])),1,0);var c=a.slice(1);if(4!==c.length||c.some((function(e){return"number"!=typeof e||e<0||e>1})))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);a={name:"cubic-bezier",controlPoints:c}}if(t.length-1<4)return n.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(!(o=n.parse(o,2,it)))return null;var h=[],f=null;"interpolate-hcl"===i||"interpolate-lab"===i?f=st:n.expectedType&&"value"!==n.expectedType.kind&&(f=n.expectedType);for(var d=0;d<s.length;d+=2){var p=s[d],m=s[d+1],v=d+3,y=d+4;if("number"!=typeof p)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',v);if(h.length&&h[h.length-1][0]>=p)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',v);var g=n.parse(m,y,f);if(!g)return null;f=f||g.type,h.push([p,g])}return"number"===f.kind||"color"===f.kind||"array"===f.kind&&"number"===f.itemType.kind&&"number"==typeof f.N?new e(f,i,a,o,h):n.error("Type ".concat(pt(f)," is not interpolatable."))}}]),e}();function Cn(e,t,n,r){var i=r-n,a=e-n;return 0===i?0:1===t?a/i:(Math.pow(t,a)-1)/(Math.pow(t,i)-1)}var An=function(){function e(t,n){v(this,e),this.type=t,this.args=n}return y(e,[{key:"evaluate",value:function(e){var t,n,r=null,i=0,a=f(this.args);try{for(a.s();!(n=a.n()).done;){var o=n.value;if(i++,(r=o.evaluate(e))&&r instanceof Tt&&!r.available&&(t||(t=r.name),r=null,i===this.args.length&&(r=t)),null!==r)break}}catch(s){a.e(s)}finally{a.f()}return r}},{key:"eachChild",value:function(e){this.args.forEach(e)}},{key:"outputDefined",value:function(){return this.args.every((function(e){return e.outputDefined()}))}},{key:"serialize",value:function(){var e=["coalesce"];return this.eachChild((function(t){e.push(t.serialize())})),e}}],[{key:"parse",value:function(t,n){if(t.length<2)return n.error("Expectected at least one argument.");var r=null,i=n.expectedType;i&&"value"!==i.kind&&(r=i);var a,o=[],s=f(t.slice(1));try{for(s.s();!(a=s.n()).done;){var l=a.value,u=n.parse(l,1+o.length,r,void 0,{typeAnnotation:"omit"});if(!u)return null;r=r||u.type,o.push(u)}}catch(c){s.e(c)}finally{s.f()}return new e(i&&o.some((function(e){return vt(i,e.type)}))?ut:r,o)}}]),e}(),In=function(){function e(t,n){v(this,e),this.type=n.type,this.bindings=[].concat(t),this.result=n}return y(e,[{key:"evaluate",value:function(e){return this.result.evaluate(e)}},{key:"eachChild",value:function(e){var t,n=f(this.bindings);try{for(n.s();!(t=n.n()).done;)e(t.value[1])}catch(r){n.e(r)}finally{n.f()}e(this.result)}},{key:"outputDefined",value:function(){return this.result.outputDefined()}},{key:"serialize",value:function(){var e,t=["let"],n=f(this.bindings);try{for(n.s();!(e=n.n()).done;){var r=h(e.value,2),i=r[0],a=r[1];t.push(i,a.serialize())}}catch(o){n.e(o)}finally{n.f()}return t.push(this.result.serialize()),t}}],[{key:"parse",value:function(t,n){if(t.length<4)return n.error("Expected at least 3 arguments, but found ".concat(t.length-1," instead."));for(var r=[],i=1;i<t.length-1;i+=2){var a=t[i];if("string"!=typeof a)return n.error("Expected string, but found ".concat(typeof a," instead."),i);if(/[^a-zA-Z0-9_]/.test(a))return n.error("Variable names must contain only alphanumeric characters or '_'.",i);var o=n.parse(t[i+1],i+1);if(!o)return null;r.push([a,o])}var s=n.parse(t[t.length-1],t.length-1,n.expectedType,r);return s?new e(r,s):null}}]),e}(),Pn=function(){function e(t,n,r){v(this,e),this.type=t,this.index=n,this.input=r}return y(e,[{key:"evaluate",value:function(e){var t=this.index.evaluate(e),n=this.input.evaluate(e);if(t<0)throw new Pt("Array index out of bounds: ".concat(t," < 0."));if(t>=n.length)throw new Pt("Array index out of bounds: ".concat(t," > ").concat(n.length-1,"."));if(t!==Math.floor(t))throw new Pt("Array index must be an integer, but found ".concat(t," instead."));return n[t]}},{key:"eachChild",value:function(e){e(this.index),e(this.input)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){return["at",this.index.serialize(),this.input.serialize()]}}],[{key:"parse",value:function(t,n){if(3!==t.length)return n.error("Expected 2 arguments, but found ".concat(t.length-1," instead."));var r=n.parse(t[1],1,it),i=n.parse(t[2],2,dt(n.expectedType||ut));return r&&i?new e(i.type.itemType,r,i):null}}]),e}(),Rn=function(){function e(t,n){v(this,e),this.type=ot,this.needle=t,this.haystack=n}return y(e,[{key:"evaluate",value:function(e){var t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!n)return!1;if(!gt(t,["boolean","string","number","null"]))throw new Pt("Expected first argument to be of type boolean, string, number or null, but found ".concat(pt(Ct(t))," instead."));if(!gt(n,["string","array"]))throw new Pt("Expected second argument to be of type array or string, but found ".concat(pt(Ct(n))," instead."));return n.indexOf(t)>=0}},{key:"eachChild",value:function(e){e(this.needle),e(this.haystack)}},{key:"outputDefined",value:function(){return!0}},{key:"serialize",value:function(){return["in",this.needle.serialize(),this.haystack.serialize()]}}],[{key:"parse",value:function(t,n){if(3!==t.length)return n.error("Expected 2 arguments, but found ".concat(t.length-1," instead."));var r=n.parse(t[1],1,ut),i=n.parse(t[2],2,ut);return r&&i?yt(r.type,[ot,at,it,rt,ut])?new e(r,i):n.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(pt(r.type)," instead")):null}}]),e}(),Ln=function(){function e(t,n,r){v(this,e),this.type=it,this.needle=t,this.haystack=n,this.fromIndex=r}return y(e,[{key:"evaluate",value:function(e){var t=this.needle.evaluate(e),n=this.haystack.evaluate(e);if(!gt(t,["boolean","string","number","null"]))throw new Pt("Expected first argument to be of type boolean, string, number or null, but found ".concat(pt(Ct(t))," instead."));if(!gt(n,["string","array"]))throw new Pt("Expected second argument to be of type array or string, but found ".concat(pt(Ct(n))," instead."));if(this.fromIndex){var r=this.fromIndex.evaluate(e);return n.indexOf(t,r)}return n.indexOf(t)}},{key:"eachChild",value:function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}],[{key:"parse",value:function(t,n){if(t.length<=2||t.length>=5)return n.error("Expected 3 or 4 arguments, but found ".concat(t.length-1," instead."));var r=n.parse(t[1],1,ut),i=n.parse(t[2],2,ut);if(!r||!i)return null;if(!yt(r.type,[ot,at,it,rt,ut]))return n.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(pt(r.type)," instead"));if(4===t.length){var a=n.parse(t[3],3,it);return a?new e(r,i,a):null}return new e(r,i)}}]),e}(),On=function(){function e(t,n,r,i,a,o){v(this,e),this.inputType=t,this.type=n,this.input=r,this.cases=i,this.outputs=a,this.otherwise=o}return y(e,[{key:"evaluate",value:function(e){var t=this.input.evaluate(e);return(Ct(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}},{key:"eachChild",value:function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}},{key:"outputDefined",value:function(){return this.outputs.every((function(e){return e.outputDefined()}))&&this.otherwise.outputDefined()}},{key:"serialize",value:function(){var e,t=this,n=["match",this.input.serialize()],r=Object.keys(this.cases).sort(),i=[],a={},o=f(r);try{for(o.s();!(e=o.n()).done;){var s=e.value,l=a[this.cases[s]];void 0===l?(a[this.cases[s]]=i.length,i.push([this.cases[s],[s]])):i[l][1].push(s)}}catch(y){o.e(y)}finally{o.f()}for(var u=function(e){return"number"===t.inputType.kind?Number(e):e},c=0,d=i;c<d.length;c++){var p=h(d[c],2),m=p[0],v=p[1];n.push(1===v.length?u(v[0]):v.map(u)),n.push(this.outputs[m].serialize())}return n.push(this.otherwise.serialize()),n}}],[{key:"parse",value:function(t,n){if(t.length<5)return n.error("Expected at least 4 arguments, but found only ".concat(t.length-1,"."));if(t.length%2!=1)return n.error("Expected an even number of arguments.");var r,i;n.expectedType&&"value"!==n.expectedType.kind&&(i=n.expectedType);for(var a={},o=[],s=2;s<t.length-1;s+=2){var l=t[s],u=t[s+1];Array.isArray(l)||(l=[l]);var c=n.concat(s);if(0===l.length)return c.error("Expected at least one branch label.");var h,d=f(l);try{for(d.s();!(h=d.n()).done;){var p=h.value;if("number"!=typeof p&&"string"!=typeof p)return c.error("Branch labels must be numbers or strings.");if("number"==typeof p&&Math.abs(p)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER,"."));if("number"==typeof p&&Math.floor(p)!==p)return c.error("Numeric branch labels must be integer values.");if(r){if(c.checkSubtype(r,Ct(p)))return null}else r=Ct(p);if(void 0!==a[String(p)])return c.error("Branch labels must be unique.");a[String(p)]=o.length}}catch(g){d.e(g)}finally{d.f()}var m=n.parse(u,s,i);if(!m)return null;i=i||m.type,o.push(m)}var v=n.parse(t[1],1,ut);if(!v)return null;var y=n.parse(t[t.length-1],t.length-1,i);return y?"value"!==v.type.kind&&n.concat(1).checkSubtype(r,v.type)?null:new e(r,i,v,a,o,y):null}}]),e}(),Dn=function(){function e(t,n,r){v(this,e),this.type=t,this.branches=n,this.otherwise=r}return y(e,[{key:"evaluate",value:function(e){var t,n=f(this.branches);try{for(n.s();!(t=n.n()).done;){var r=h(t.value,2),i=r[0],a=r[1];if(i.evaluate(e))return a.evaluate(e)}}catch(o){n.e(o)}finally{n.f()}return this.otherwise.evaluate(e)}},{key:"eachChild",value:function(e){var t,n=f(this.branches);try{for(n.s();!(t=n.n()).done;){var r=h(t.value,2),i=r[0],a=r[1];e(i),e(a)}}catch(o){n.e(o)}finally{n.f()}e(this.otherwise)}},{key:"outputDefined",value:function(){return this.branches.every((function(e){var t=h(e,2);return t[0],t[1].outputDefined()}))&&this.otherwise.outputDefined()}},{key:"serialize",value:function(){var e=["case"];return this.eachChild((function(t){e.push(t.serialize())})),e}}],[{key:"parse",value:function(t,n){if(t.length<4)return n.error("Expected at least 3 arguments, but found only ".concat(t.length-1,"."));if(t.length%2!=0)return n.error("Expected an odd number of arguments.");var r;n.expectedType&&"value"!==n.expectedType.kind&&(r=n.expectedType);for(var i=[],a=1;a<t.length-1;a+=2){var o=n.parse(t[a],a,ot);if(!o)return null;var s=n.parse(t[a+1],a+1,r);if(!s)return null;i.push([o,s]),r=r||s.type}var l=n.parse(t[t.length-1],t.length-1,r);return l?new e(r,i,l):null}}]),e}(),Nn=function(){function e(t,n,r,i){v(this,e),this.type=t,this.input=n,this.beginIndex=r,this.endIndex=i}return y(e,[{key:"evaluate",value:function(e){var t=this.input.evaluate(e),n=this.beginIndex.evaluate(e);if(!gt(t,["string","array"]))throw new Pt("Expected first argument to be of type array or string, but found ".concat(pt(Ct(t))," instead."));if(this.endIndex){var r=this.endIndex.evaluate(e);return t.slice(n,r)}return t.slice(n)}},{key:"eachChild",value:function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){if(null!=this.endIndex&&void 0!==this.endIndex){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}],[{key:"parse",value:function(t,n){if(t.length<=2||t.length>=5)return n.error("Expected 3 or 4 arguments, but found ".concat(t.length-1," instead."));var r=n.parse(t[1],1,ut),i=n.parse(t[2],2,it);if(!r||!i)return null;if(!yt(r.type,[dt(ut),at,ut]))return n.error("Expected first argument to be of type array or string, but found ".concat(pt(r.type)," instead"));if(4===t.length){var a=n.parse(t[3],3,it);return a?new e(r.type,r,i,a):null}return new e(r.type,r,i)}}]),e}();function zn(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function Fn(e,t,n,r){return 0===r.compare(t,n)}function Bn(e,t,n){var r="=="!==e&&"!="!==e;return function(){function i(e,t,n){v(this,i),this.type=ot,this.lhs=e,this.rhs=t,this.collator=n,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}return y(i,[{key:"evaluate",value:function(i){var a=this.lhs.evaluate(i),o=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){var s=Ct(a),l=Ct(o);if(s.kind!==l.kind||"string"!==s.kind&&"number"!==s.kind)throw new Pt('Expected arguments for "'.concat(e,'" to be (string, string) or (number, number), but found (').concat(s.kind,", ").concat(l.kind,") instead."))}if(this.collator&&!r&&this.hasUntypedArgument){var u=Ct(a),c=Ct(o);if("string"!==u.kind||"string"!==c.kind)return t(i,a,o)}return this.collator?n(i,a,o,this.collator.evaluate(i)):t(i,a,o)}},{key:"eachChild",value:function(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}},{key:"outputDefined",value:function(){return!0}},{key:"serialize",value:function(){var t=[e];return this.eachChild((function(e){t.push(e.serialize())})),t}}],[{key:"parse",value:function(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");var n=e[0],a=t.parse(e[1],1,ut);if(!a)return null;if(!zn(n,a.type))return t.concat(1).error('"'.concat(n,"\" comparisons are not supported for type '").concat(pt(a.type),"'."));var o=t.parse(e[2],2,ut);if(!o)return null;if(!zn(n,o.type))return t.concat(2).error('"'.concat(n,"\" comparisons are not supported for type '").concat(pt(o.type),"'."));if(a.type.kind!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return t.error("Cannot compare types '".concat(pt(a.type),"' and '").concat(pt(o.type),"'."));r&&("value"===a.type.kind&&"value"!==o.type.kind?a=new Lt(o.type,[a]):"value"!==a.type.kind&&"value"===o.type.kind&&(o=new Lt(a.type,[o])));var s=null;if(4===e.length){if("string"!==a.type.kind&&"string"!==o.type.kind&&"value"!==a.type.kind&&"value"!==o.type.kind)return t.error("Cannot use collator to compare non-string types.");if(!(s=t.parse(e[3],3,ct)))return null}return new i(a,o,s)}}]),i}()}var Un=Bn("==",(function(e,t,n){return t===n}),Fn),jn=Bn("!=",(function(e,t,n){return t!==n}),(function(e,t,n,r){return!Fn(0,t,n,r)})),Vn=Bn("<",(function(e,t,n){return t<n}),(function(e,t,n,r){return r.compare(t,n)<0})),Hn=Bn(">",(function(e,t,n){return t>n}),(function(e,t,n,r){return r.compare(t,n)>0})),Gn=Bn("<=",(function(e,t,n){return t<=n}),(function(e,t,n,r){return r.compare(t,n)<=0})),Wn=function(){function e(t,n,r,i,a){v(this,e),this.type=at,this.number=t,this.locale=n,this.currency=r,this.minFractionDigits=i,this.maxFractionDigits=a}return y(e,[{key:"evaluate",value:function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}},{key:"eachChild",value:function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}],[{key:"parse",value:function(t,n){if(3!==t.length)return n.error("Expected two arguments.");var r=n.parse(t[1],1,it);if(!r)return null;var i=t[2];if("object"!=typeof i||Array.isArray(i))return n.error("NumberFormat options argument must be an object.");var a=null;if(i.locale&&!(a=n.parse(i.locale,1,at)))return null;var o=null;if(i.currency&&!(o=n.parse(i.currency,1,at)))return null;var s=null;if(i["min-fraction-digits"]&&!(s=n.parse(i["min-fraction-digits"],1,it)))return null;var l=null;return i["max-fraction-digits"]&&!(l=n.parse(i["max-fraction-digits"],1,it))?null:new e(r,a,o,s,l)}}]),e}(),qn=function(){function e(t){v(this,e),this.type=it,this.input=t}return y(e,[{key:"evaluate",value:function(e){var t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new Pt("Expected value to be of type string or array, but found ".concat(pt(Ct(t))," instead."))}},{key:"eachChild",value:function(e){e(this.input)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){var e=["length"];return this.eachChild((function(t){e.push(t.serialize())})),e}}],[{key:"parse",value:function(t,n){if(2!==t.length)return n.error("Expected 1 argument, but found ".concat(t.length-1," instead."));var r=n.parse(t[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?n.error("Expected argument of type string or array, but found ".concat(pt(r.type)," instead.")):new e(r):null}}]),e}(),Xn={"==":Un,"!=":jn,">":Hn,"<":Vn,">=":Bn(">=",(function(e,t,n){return t>=n}),(function(e,t,n,r){return r.compare(t,n)>=0})),"<=":Gn,array:Lt,at:Pn,boolean:Lt,case:Dn,coalesce:An,collator:jt,format:Ot,image:Dt,in:Rn,"index-of":Ln,interpolate:Mn,"interpolate-hcl":Mn,"interpolate-lab":Mn,length:qn,let:In,literal:It,match:On,number:Lt,"number-format":Wn,object:Lt,slice:Nn,step:hn,string:Lt,"to-boolean":zt,"to-color":zt,"to-number":zt,"to-string":zt,var:ln,within:rn};function Zn(e,t){var n=h(t,4),r=n[0],i=n[1],a=n[2],o=n[3];r=r.evaluate(e),i=i.evaluate(e),a=a.evaluate(e);var s=o?o.evaluate(e):1,l=kt(r,i,a,s);if(l)throw new Pt(l);return new xt(r/255*s,i/255*s,a/255*s,s)}function Kn(e,t){return e in t}function Yn(e,t){var n=t[e];return void 0===n?null:n}function Jn(e){return{type:e}}function Qn(e){return{result:"success",value:e}}function $n(e){return{result:"error",value:e}}function er(e){return"data-driven"===e["property-type"]||"cross-faded-data-driven"===e["property-type"]}function tr(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function nr(e){return!!e.expression&&e.expression.interpolated}function rr(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":null===e?"null":typeof e}function ir(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function ar(e){return e}function or(e,t,n){return void 0!==e?e:void 0!==t?t:void 0!==n?n:void 0}function sr(e,t,n,r,i){return or(typeof n===i?r[n]:void 0,e.default,t.default)}function lr(e,t,n){if("number"!==rr(n))return or(e.default,t.default);var r=e.stops.length;if(1===r)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[r-1][0])return e.stops[r-1][1];var i=cn(e.stops.map((function(e){return e[0]})),n);return e.stops[i][1]}function ur(e,t,n){var r=void 0!==e.base?e.base:1;if("number"!==rr(n))return or(e.default,t.default);var i=e.stops.length;if(1===i)return e.stops[0][1];if(n<=e.stops[0][0])return e.stops[0][1];if(n>=e.stops[i-1][0])return e.stops[i-1][1];var a=cn(e.stops.map((function(e){return e[0]})),n),o=function(e,t,n,r){var i=r-n,a=e-n;return 0===i?0:1===t?a/i:(Math.pow(t,a)-1)/(Math.pow(t,i)-1)}(n,r,e.stops[a][0],e.stops[a+1][0]),s=e.stops[a][1],l=e.stops[a+1][1],u=dn[t.type]||ar;if(e.colorSpace&&"rgb"!==e.colorSpace){var c=kn[e.colorSpace];u=function(e,t){return c.reverse(c.interpolate(c.forward(e),c.forward(t),o))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=s.evaluate.apply(void 0,t),i=l.evaluate.apply(void 0,t);if(void 0!==r&&void 0!==i)return u(r,i,o)}}:u(s,l,o)}function cr(e,t,n){return"color"===t.type?n=xt.parse(n):"formatted"===t.type?n=St.fromString(n.toString()):"resolvedImage"===t.type?n=Tt.fromString(n.toString()):rr(n)===t.type||"enum"===t.type&&t.values[n]||(n=void 0),or(n,e.default,t.default)}Ut.register(Xn,{error:[{kind:"error"},[at],function(e,t){var n=h(t,1)[0];throw new Pt(n.evaluate(e))}],typeof:[at,[ut],function(e,t){return pt(Ct(h(t,1)[0].evaluate(e)))}],"to-rgba":[dt(it,4),[st],function(e,t){return h(t,1)[0].evaluate(e).toArray()}],rgb:[st,[it,it,it],Zn],rgba:[st,[it,it,it,it],Zn],has:{type:ot,overloads:[[[at],function(e,t){return Kn(h(t,1)[0].evaluate(e),e.properties())}],[[at,lt],function(e,t){var n=h(t,2),r=n[0],i=n[1];return Kn(r.evaluate(e),i.evaluate(e))}]]},get:{type:ut,overloads:[[[at],function(e,t){return Yn(h(t,1)[0].evaluate(e),e.properties())}],[[at,lt],function(e,t){var n=h(t,2),r=n[0],i=n[1];return Yn(r.evaluate(e),i.evaluate(e))}]]},"feature-state":[ut,[at],function(e,t){return Yn(h(t,1)[0].evaluate(e),e.featureState||{})}],properties:[lt,[],function(e){return e.properties()}],"geometry-type":[at,[],function(e){return e.geometryType()}],id:[ut,[],function(e){return e.id()}],zoom:[it,[],function(e){return e.globals.zoom}],"heatmap-density":[it,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[it,[],function(e){return e.globals.lineProgress||0}],"sky-radial-progress":[it,[],function(e){return e.globals.skyRadialProgress||0}],accumulated:[ut,[],function(e){return void 0===e.globals.accumulated?null:e.globals.accumulated}],"+":[it,Jn(it),function(e,t){var n,r=0,i=f(t);try{for(i.s();!(n=i.n()).done;)r+=n.value.evaluate(e)}catch(a){i.e(a)}finally{i.f()}return r}],"*":[it,Jn(it),function(e,t){var n,r=1,i=f(t);try{for(i.s();!(n=i.n()).done;)r*=n.value.evaluate(e)}catch(a){i.e(a)}finally{i.f()}return r}],"-":{type:it,overloads:[[[it,it],function(e,t){var n=h(t,2),r=n[0],i=n[1];return r.evaluate(e)-i.evaluate(e)}],[[it],function(e,t){return-h(t,1)[0].evaluate(e)}]]},"/":[it,[it,it],function(e,t){var n=h(t,2),r=n[0],i=n[1];return r.evaluate(e)/i.evaluate(e)}],"%":[it,[it,it],function(e,t){var n=h(t,2),r=n[0],i=n[1];return r.evaluate(e)%i.evaluate(e)}],ln2:[it,[],function(){return Math.LN2}],pi:[it,[],function(){return Math.PI}],e:[it,[],function(){return Math.E}],"^":[it,[it,it],function(e,t){var n=h(t,2),r=n[0],i=n[1];return Math.pow(r.evaluate(e),i.evaluate(e))}],sqrt:[it,[it],function(e,t){var n=h(t,1)[0];return Math.sqrt(n.evaluate(e))}],log10:[it,[it],function(e,t){var n=h(t,1)[0];return Math.log(n.evaluate(e))/Math.LN10}],ln:[it,[it],function(e,t){var n=h(t,1)[0];return Math.log(n.evaluate(e))}],log2:[it,[it],function(e,t){var n=h(t,1)[0];return Math.log(n.evaluate(e))/Math.LN2}],sin:[it,[it],function(e,t){var n=h(t,1)[0];return Math.sin(n.evaluate(e))}],cos:[it,[it],function(e,t){var n=h(t,1)[0];return Math.cos(n.evaluate(e))}],tan:[it,[it],function(e,t){var n=h(t,1)[0];return Math.tan(n.evaluate(e))}],asin:[it,[it],function(e,t){var n=h(t,1)[0];return Math.asin(n.evaluate(e))}],acos:[it,[it],function(e,t){var n=h(t,1)[0];return Math.acos(n.evaluate(e))}],atan:[it,[it],function(e,t){var n=h(t,1)[0];return Math.atan(n.evaluate(e))}],min:[it,Jn(it),function(e,t){return Math.min.apply(Math,c(t.map((function(t){return t.evaluate(e)}))))}],max:[it,Jn(it),function(e,t){return Math.max.apply(Math,c(t.map((function(t){return t.evaluate(e)}))))}],abs:[it,[it],function(e,t){var n=h(t,1)[0];return Math.abs(n.evaluate(e))}],round:[it,[it],function(e,t){var n=h(t,1)[0].evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[it,[it],function(e,t){var n=h(t,1)[0];return Math.floor(n.evaluate(e))}],ceil:[it,[it],function(e,t){var n=h(t,1)[0];return Math.ceil(n.evaluate(e))}],"filter-==":[ot,[at,ut],function(e,t){var n=h(t,2),r=n[0],i=n[1];return e.properties()[r.value]===i.value}],"filter-id-==":[ot,[ut],function(e,t){var n=h(t,1)[0];return e.id()===n.value}],"filter-type-==":[ot,[at],function(e,t){var n=h(t,1)[0];return e.geometryType()===n.value}],"filter-<":[ot,[at,ut],function(e,t){var n=h(t,2),r=n[0],i=n[1],a=e.properties()[r.value],o=i.value;return typeof a==typeof o&&a<o}],"filter-id-<":[ot,[ut],function(e,t){var n=h(t,1)[0],r=e.id(),i=n.value;return typeof r==typeof i&&r<i}],"filter->":[ot,[at,ut],function(e,t){var n=h(t,2),r=n[0],i=n[1],a=e.properties()[r.value],o=i.value;return typeof a==typeof o&&a>o}],"filter-id->":[ot,[ut],function(e,t){var n=h(t,1)[0],r=e.id(),i=n.value;return typeof r==typeof i&&r>i}],"filter-<=":[ot,[at,ut],function(e,t){var n=h(t,2),r=n[0],i=n[1],a=e.properties()[r.value],o=i.value;return typeof a==typeof o&&a<=o}],"filter-id-<=":[ot,[ut],function(e,t){var n=h(t,1)[0],r=e.id(),i=n.value;return typeof r==typeof i&&r<=i}],"filter->=":[ot,[at,ut],function(e,t){var n=h(t,2),r=n[0],i=n[1],a=e.properties()[r.value],o=i.value;return typeof a==typeof o&&a>=o}],"filter-id->=":[ot,[ut],function(e,t){var n=h(t,1)[0],r=e.id(),i=n.value;return typeof r==typeof i&&r>=i}],"filter-has":[ot,[ut],function(e,t){return h(t,1)[0].value in e.properties()}],"filter-has-id":[ot,[],function(e){return null!==e.id()&&void 0!==e.id()}],"filter-type-in":[ot,[dt(at)],function(e,t){return h(t,1)[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[ot,[dt(ut)],function(e,t){return h(t,1)[0].value.indexOf(e.id())>=0}],"filter-in-small":[ot,[at,dt(ut)],function(e,t){var n=h(t,2),r=n[0];return n[1].value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[ot,[at,dt(ut)],function(e,t){var n=h(t,2),r=n[0],i=n[1];return function(e,t,n,r){for(;n<=r;){var i=n+r>>1;if(t[i]===e)return!0;t[i]>e?r=i-1:n=i+1}return!1}(e.properties()[r.value],i.value,0,i.value.length-1)}],all:{type:ot,overloads:[[[ot,ot],function(e,t){var n=h(t,2),r=n[0],i=n[1];return r.evaluate(e)&&i.evaluate(e)}],[Jn(ot),function(e,t){var n,r=f(t);try{for(r.s();!(n=r.n()).done;)if(!n.value.evaluate(e))return!1}catch(i){r.e(i)}finally{r.f()}return!0}]]},any:{type:ot,overloads:[[[ot,ot],function(e,t){var n=h(t,2),r=n[0],i=n[1];return r.evaluate(e)||i.evaluate(e)}],[Jn(ot),function(e,t){var n,r=f(t);try{for(r.s();!(n=r.n()).done;)if(n.value.evaluate(e))return!0}catch(i){r.e(i)}finally{r.f()}return!1}]]},"!":[ot,[ot],function(e,t){return!h(t,1)[0].evaluate(e)}],"is-supported-script":[ot,[at],function(e,t){var n=h(t,1)[0],r=e.globals&&e.globals.isSupportedScript;return!r||r(n.evaluate(e))}],upcase:[at,[at],function(e,t){return h(t,1)[0].evaluate(e).toUpperCase()}],downcase:[at,[at],function(e,t){return h(t,1)[0].evaluate(e).toLowerCase()}],concat:[at,Jn(ut),function(e,t){return t.map((function(t){return At(t.evaluate(e))})).join("")}],"resolved-locale":[at,[ct],function(e,t){return h(t,1)[0].evaluate(e).resolvedLocale()}]});var hr=function(){function e(t,n){v(this,e),this.expression=t,this._warningHistory={},this._evaluator=new Bt,this._defaultValue=n?function(e){return"color"===e.type&&ir(e.default)?new xt(0,0,0,0):"color"===e.type?xt.parse(e.default)||null:void 0===e.default?null:e.default}(n):null,this._enumValues=n&&"enum"===n.type?n.values:null}return y(e,[{key:"evaluateWithoutErrorHandling",value:function(e,t,n,r,i,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=n,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=a,this.expression.evaluate(this._evaluator)}},{key:"evaluate",value:function(e,t,n,r,i,a){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=n||null,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=a||null;try{var o=this.expression.evaluate(this._evaluator);if(null==o||"number"==typeof o&&o!=o)return this._defaultValue;if(this._enumValues&&!(o in this._enumValues))throw new Pt("Expected value to be one of ".concat(Object.keys(this._enumValues).map((function(e){return JSON.stringify(e)})).join(", "),", but found ").concat(JSON.stringify(o)," instead."));return o}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}]),e}();function fr(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in Xn}function dr(e,t){var n=new un(Xn,[],t?function(e){var t={color:st,string:at,number:it,enum:at,boolean:ot,formatted:ht,resolvedImage:ft};return"array"===e.type?dt(t[e.value]||ut,e.length):t[e.type]}(t):void 0),r=n.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return r?Qn(new hr(r,t)):$n(n.errors)}var pr=function(){function e(t,n){v(this,e),this.kind=t,this._styleExpression=n,this.isStateDependent="constant"!==t&&!on(n.expression)}return y(e,[{key:"evaluateWithoutErrorHandling",value:function(e,t,n,r,i,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,r,i,a)}},{key:"evaluate",value:function(e,t,n,r,i,a){return this._styleExpression.evaluate(e,t,n,r,i,a)}}]),e}(),mr=function(){function e(t,n,r,i){v(this,e),this.kind=t,this.zoomStops=r,this._styleExpression=n,this.isStateDependent="camera"!==t&&!on(n.expression),this.interpolationType=i}return y(e,[{key:"evaluateWithoutErrorHandling",value:function(e,t,n,r,i,a){return this._styleExpression.evaluateWithoutErrorHandling(e,t,n,r,i,a)}},{key:"evaluate",value:function(e,t,n,r,i,a){return this._styleExpression.evaluate(e,t,n,r,i,a)}},{key:"interpolationFactor",value:function(e,t,n){return this.interpolationType?Mn.interpolationFactor(this.interpolationType,e,t,n):0}}]),e}();function vr(e,t){if("error"===(e=dr(e,t)).result)return e;var n=e.value.expression,r=an(n);if(!r&&!er(t))return $n([new tt("","data expressions not supported")]);var i=sn(n,["zoom"]);if(!i&&!tr(t))return $n([new tt("","zoom expressions not supported")]);var a=function e(t){var n=null;if(t instanceof In)n=e(t.result);else if(t instanceof An){var r,i=f(t.args);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(n=e(a))break}}catch(o){i.e(o)}finally{i.f()}}else(t instanceof hn||t instanceof Mn)&&t.input instanceof Ut&&"zoom"===t.input.name&&(n=t);return n instanceof tt||t.eachChild((function(t){var r=e(t);r instanceof tt?n=r:!n&&r?n=new tt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&r&&n!==r&&(n=new tt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),n}(n);return a||i?a instanceof tt?$n([a]):a instanceof Mn&&!nr(t)?$n([new tt("",'"interpolate" expressions cannot be used with this property')]):Qn(a?new mr(r?"camera":"composite",e.value,a.labels,a instanceof Mn?a.interpolation:void 0):new pr(r?"constant":"source",e.value)):$n([new tt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}var yr=function(){function e(t,n){v(this,e),this._parameters=t,this._specification=n,Qe(this,function e(t,n){var r,i,a,o="color"===n.type,s=t.stops&&"object"==typeof t.stops[0][0],l=s||!(s||void 0!==t.property),u=t.type||(nr(n)?"exponential":"interval");if(o&&((t=Qe({},t)).stops&&(t.stops=t.stops.map((function(e){return[e[0],xt.parse(e[1])]}))),t.default=xt.parse(t.default?t.default:n.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!kn[t.colorSpace])throw new Error("Unknown color space: ".concat(t.colorSpace));if("exponential"===u)r=ur;else if("interval"===u)r=lr;else if("categorical"===u){r=sr,i=Object.create(null);var c,h=f(t.stops);try{for(h.s();!(c=h.n()).done;){var d=c.value;i[d[0]]=d[1]}}catch(T){h.e(T)}finally{h.f()}a=typeof t.stops[0][0]}else{if("identity"!==u)throw new Error('Unknown function type "'.concat(u,'"'));r=cr}if(s){for(var p={},m=[],v=0;v<t.stops.length;v++){var y=t.stops[v],g=y[0].zoom;void 0===p[g]&&(p[g]={zoom:g,type:t.type,property:t.property,default:t.default,stops:[]},m.push(g)),p[g].stops.push([y[0].value,y[1]])}for(var _=[],b=0,x=m;b<x.length;b++){var w=x[b];_.push([p[w].zoom,e(p[w],n)])}var E={name:"linear"};return{kind:"composite",interpolationType:E,interpolationFactor:Mn.interpolationFactor.bind(void 0,E),zoomStops:_.map((function(e){return e[0]})),evaluate:function(e,r){var i=e.zoom;return ur({stops:_,base:t.base},n,i).evaluate(i,r)}}}if(l){var S="exponential"===u?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:Mn.interpolationFactor.bind(void 0,S),zoomStops:t.stops.map((function(e){return e[0]})),evaluate:function(e){var o=e.zoom;return r(t,n,o,i,a)}}}return{kind:"source",evaluate:function(e,o){var s=o&&o.properties?o.properties[t.property]:void 0;return void 0===s?or(t.default,n.default):r(t,n,s,i,a)}}}(this._parameters,this._specification))}return y(e,null,[{key:"deserialize",value:function(t){return new e(t._parameters,t._specification)}},{key:"serialize",value:function(e){return{_parameters:e._parameters,_specification:e._specification}}}]),e}();function gr(e){var t=e.key,n=e.value,r=e.valueSpec||{},i=e.objectElementValidators||{},a=e.style,o=e.styleSpec,s=[],l=rr(n);if("object"!==l)return[new Ye(t,n,"object expected, ".concat(l," found"))];for(var u in n){var c=u.split(".")[0],h=r[c]||r["*"],f=void 0;if(i[c])f=i[c];else if(r[c])f=Gr;else if(i["*"])f=i["*"];else{if(!r["*"]){s.push(new Ye(t,n[u],'unknown property "'.concat(u,'"')));continue}f=Gr}s=s.concat(f({key:(t?"".concat(t,"."):t)+u,value:n[u],valueSpec:h,style:a,styleSpec:o,object:n,objectKey:u},n))}for(var d in r)i[d]||r[d].required&&void 0===r[d].default&&void 0===n[d]&&s.push(new Ye(t,n,'missing required property "'.concat(d,'"')));return s}function _r(e){var t=e.value,n=e.valueSpec,r=e.style,i=e.styleSpec,a=e.key,o=e.arrayElementValidator||Gr;if("array"!==rr(t))return[new Ye(a,t,"array expected, ".concat(rr(t)," found"))];if(n.length&&t.length!==n.length)return[new Ye(a,t,"array length ".concat(n.length," expected, length ").concat(t.length," found"))];if(n["min-length"]&&t.length<n["min-length"])return[new Ye(a,t,"array length at least ".concat(n["min-length"]," expected, length ").concat(t.length," found"))];var s={type:n.value,values:n.values};i.$version<7&&(s.function=n.function),"object"===rr(n.value)&&(s=n.value);for(var l=[],u=0;u<t.length;u++)l=l.concat(o({array:t,arrayIndex:u,value:t[u],valueSpec:s,style:r,styleSpec:i,key:"".concat(a,"[").concat(u,"]")}));return l}function br(e){var t=e.key,n=e.value,r=e.valueSpec,i=rr(n);return"number"===i&&n!=n&&(i="NaN"),"number"!==i?[new Ye(t,n,"number expected, ".concat(i," found"))]:"minimum"in r&&n<r.minimum?[new Ye(t,n,"".concat(n," is less than the minimum value ").concat(r.minimum))]:"maximum"in r&&n>r.maximum?[new Ye(t,n,"".concat(n," is greater than the maximum value ").concat(r.maximum))]:[]}function xr(e){var t,n,r,i=e.valueSpec,a=$e(e.value.type),o={},s="categorical"!==a&&void 0===e.value.property,l=!s,u="array"===rr(e.value.stops)&&"array"===rr(e.value.stops[0])&&"object"===rr(e.value.stops[0][0]),c=gr({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(e){if("identity"===a)return[new Ye(e.key,e.value,'identity function may not have a "stops" property')];var t=[],n=e.value;return t=t.concat(_r({key:e.key,value:n,valueSpec:e.valueSpec,style:e.style,styleSpec:e.styleSpec,arrayElementValidator:h})),"array"===rr(n)&&0===n.length&&t.push(new Ye(e.key,n,"array must have at least one stop")),t},default:function(e){return Gr({key:e.key,value:e.value,valueSpec:i,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===a&&s&&c.push(new Ye(e.key,e.value,'missing required property "property"')),"identity"===a||e.value.stops||c.push(new Ye(e.key,e.value,'missing required property "stops"')),"exponential"===a&&e.valueSpec.expression&&!nr(e.valueSpec)&&c.push(new Ye(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(l&&!er(e.valueSpec)?c.push(new Ye(e.key,e.value,"property functions not supported")):s&&!tr(e.valueSpec)&&c.push(new Ye(e.key,e.value,"zoom functions not supported"))),"categorical"!==a&&!u||void 0!==e.value.property||c.push(new Ye(e.key,e.value,'"property" property is required')),c;function h(e){var t=[],a=e.value,s=e.key;if("array"!==rr(a))return[new Ye(s,a,"array expected, ".concat(rr(a)," found"))];if(2!==a.length)return[new Ye(s,a,"array length 2 expected, length ".concat(a.length," found"))];if(u){if("object"!==rr(a[0]))return[new Ye(s,a,"object expected, ".concat(rr(a[0])," found"))];if(void 0===a[0].zoom)return[new Ye(s,a,"object stop key must have zoom")];if(void 0===a[0].value)return[new Ye(s,a,"object stop key must have value")];if(r&&r>$e(a[0].zoom))return[new Ye(s,a[0].zoom,"stop zoom values must appear in ascending order")];$e(a[0].zoom)!==r&&(r=$e(a[0].zoom),n=void 0,o={}),t=t.concat(gr({key:"".concat(s,"[0]"),value:a[0],valueSpec:{zoom:{}},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{zoom:br,value:f}}))}else t=t.concat(f({key:"".concat(s,"[0]"),value:a[0],valueSpec:{},style:e.style,styleSpec:e.styleSpec},a));return fr(et(a[1]))?t.concat([new Ye("".concat(s,"[1]"),a[1],"expressions are not allowed in function stops.")]):t.concat(Gr({key:"".concat(s,"[1]"),value:a[1],valueSpec:i,style:e.style,styleSpec:e.styleSpec}))}function f(e,r){var s=rr(e.value),l=$e(e.value),u=null!==e.value?e.value:r;if(t){if(s!==t)return[new Ye(e.key,u,"".concat(s," stop domain type must match previous stop domain type ").concat(t))]}else t=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new Ye(e.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==a){var c="number expected, ".concat(s," found");return er(i)&&void 0===a&&(c+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ye(e.key,u,c)]}return"categorical"!==a||"number"!==s||isFinite(l)&&Math.floor(l)===l?"categorical"!==a&&"number"===s&&void 0!==n&&l<n?[new Ye(e.key,u,"stop domain values must appear in ascending order")]:(n=l,"categorical"===a&&l in o?[new Ye(e.key,u,"stop domain values must be unique")]:(o[l]=!0,[])):[new Ye(e.key,u,"integer expected, found ".concat(l))]}}function wr(e){var t=("property"===e.expressionContext?vr:dr)(et(e.value),e.valueSpec);if("error"===t.result)return t.value.map((function(t){return new Ye("".concat(e.key).concat(t.key),e.value,t.message)}));var n=t.value.expression||t.value._styleExpression.expression;if("property"===e.expressionContext&&"text-font"===e.propertyKey&&!n.outputDefined())return[new Ye(e.key,e.value,'Invalid data expression for "'.concat(e.propertyKey,'". Output values must be contained as literals within the expression.'))];if("property"===e.expressionContext&&"layout"===e.propertyType&&!on(n))return[new Ye(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===e.expressionContext&&!on(n))return[new Ye(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&0===e.expressionContext.indexOf("cluster")){if(!sn(n,["zoom","feature-state"]))return[new Ye(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===e.expressionContext&&!an(n))return[new Ye(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Er(e){var t=e.key,n=e.value,r=e.valueSpec,i=[];return Array.isArray(r.values)?-1===r.values.indexOf($e(n))&&i.push(new Ye(t,n,"expected one of [".concat(r.values.join(", "),"], ").concat(JSON.stringify(n)," found"))):-1===Object.keys(r.values).indexOf($e(n))&&i.push(new Ye(t,n,"expected one of [".concat(Object.keys(r.values).join(", "),"], ").concat(JSON.stringify(n)," found"))),i}function Sr(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":var t,n=f(e.slice(1));try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!Sr(r)&&"boolean"!=typeof r)return!1}}catch(i){n.e(i)}finally{n.f()}return!0;default:return!0}}var Tr={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function kr(e){if(null==e)return{filter:function(){return!0},needGeometry:!1};Sr(e)||(e=Cr(e));var t=dr(e,Tr);if("error"===t.result)throw new Error(t.value.map((function(e){return"".concat(e.key,": ").concat(e.message)})).join(", "));return{filter:function(e,n,r){return t.value.evaluate(e,n,{},r)},needGeometry:function e(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(var n=1;n<t.length;n++)if(e(t[n]))return!0;return!1}(e)}}function Mr(e,t){return e<t?-1:e>t?1:0}function Cr(e){if(!e)return!0;var t,n=e[0];return e.length<=1?"any"!==n:"=="===n?Ar(e[1],e[2],"=="):"!="===n?Rr(Ar(e[1],e[2],"==")):"<"===n||">"===n||"<="===n||">="===n?Ar(e[1],e[2],n):"any"===n?(t=e.slice(1),["any"].concat(t.map(Cr))):"all"===n?["all"].concat(e.slice(1).map(Cr)):"none"===n?["all"].concat(e.slice(1).map(Cr).map(Rr)):"in"===n?Ir(e[1],e.slice(2)):"!in"===n?Rr(Ir(e[1],e.slice(2))):"has"===n?Pr(e[1]):"!has"===n?Rr(Pr(e[1])):"within"!==n||e}function Ar(e,t,n){switch(e){case"$type":return["filter-type-".concat(n),t];case"$id":return["filter-id-".concat(n),t];default:return["filter-".concat(n),e,t]}}function Ir(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((function(e){return typeof e!=typeof t[0]}))?["filter-in-large",e,["literal",t.sort(Mr)]]:["filter-in-small",e,["literal",t]]}}function Pr(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Rr(e){return["!",e]}function Lr(e){return Sr(et(e.value))?wr(Qe({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function e(t){var n=t.value,r=t.key;if("array"!==rr(n))return[new Ye(r,n,"array expected, ".concat(rr(n)," found"))];var i,a=t.styleSpec,o=[];if(n.length<1)return[new Ye(r,n,"filter array must have at least 1 element")];switch(o=o.concat(Er({key:"".concat(r,"[0]"),value:n[0],valueSpec:a.filter_operator,style:t.style,styleSpec:t.styleSpec})),$e(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===$e(n[1])&&o.push(new Ye(r,n,'"$type" cannot be use with operator "'.concat(n[0],'"')));case"==":case"!=":3!==n.length&&o.push(new Ye(r,n,'filter array for operator "'.concat(n[0],'" must have 3 elements')));case"in":case"!in":n.length>=2&&"string"!==(i=rr(n[1]))&&o.push(new Ye("".concat(r,"[1]"),n[1],"string expected, ".concat(i," found")));for(var s=2;s<n.length;s++)i=rr(n[s]),"$type"===$e(n[1])?o=o.concat(Er({key:"".concat(r,"[").concat(s,"]"),value:n[s],valueSpec:a.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&o.push(new Ye("".concat(r,"[").concat(s,"]"),n[s],"string, number, or boolean expected, ".concat(i," found")));break;case"any":case"all":case"none":for(var l=1;l<n.length;l++)o=o.concat(e({key:"".concat(r,"[").concat(l,"]"),value:n[l],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":i=rr(n[1]),2!==n.length?o.push(new Ye(r,n,'filter array for "'.concat(n[0],'" operator must have 2 elements'))):"string"!==i&&o.push(new Ye("".concat(r,"[1]"),n[1],"string expected, ".concat(i," found")));break;case"within":i=rr(n[1]),2!==n.length?o.push(new Ye(r,n,'filter array for "'.concat(n[0],'" operator must have 2 elements'))):"object"!==i&&o.push(new Ye("".concat(r,"[1]"),n[1],"object expected, ".concat(i," found")))}return o}(e)}function Or(e,t){var n=e.key,r=e.style,i=e.styleSpec,a=e.value,o=e.objectKey,s=i["".concat(t,"_").concat(e.layerType)];if(!s)return[];var l=o.match(/^(.*)-transition$/);if("paint"===t&&l&&s[l[1]]&&s[l[1]].transition)return Gr({key:n,value:a,valueSpec:i.transition,style:r,styleSpec:i});var u,c=e.valueSpec||s[o];if(!c)return[new Ye(n,a,'unknown property "'.concat(o,'"'))];if("string"===rr(a)&&er(c)&&!c.tokens&&(u=/^{([^}]+)}$/.exec(a)))return[new Ye(n,a,'"'.concat(o,'" does not support interpolation syntax\n')+'Use an identity property function instead: `{ "type": "identity", "property": '.concat(JSON.stringify(u[1])," }`."))];var h=[];return"symbol"===e.layerType&&("text-field"===o&&r&&!r.glyphs&&h.push(new Ye(n,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===o&&ir(et(a))&&"identity"===$e(a.type)&&h.push(new Ye(n,a,'"text-font" does not support identity functions'))),h.concat(Gr({key:e.key,value:a,valueSpec:c,style:r,styleSpec:i,expressionContext:"property",propertyType:t,propertyKey:o}))}function Dr(e){return Or(e,"paint")}function Nr(e){return Or(e,"layout")}function zr(e){var t=[],n=e.value,r=e.key,i=e.style,a=e.styleSpec;n.type||n.ref||t.push(new Ye(r,n,'either "type" or "ref" is required'));var o,s=$e(n.type),l=$e(n.ref);if(n.id)for(var u=$e(n.id),c=0;c<e.arrayIndex;c++){var h=i.layers[c];$e(h.id)===u&&t.push(new Ye(r,n.id,'duplicate layer id "'.concat(n.id,'", previously used at line ').concat(h.id.__line__)))}if("ref"in n)["type","source","source-layer","filter","layout"].forEach((function(e){e in n&&t.push(new Ye(r,n[e],'"'.concat(e,'" is prohibited for ref layers')))})),i.layers.forEach((function(e){$e(e.id)===l&&(o=e)})),o?o.ref?t.push(new Ye(r,n.ref,"ref cannot reference another ref layer")):s=$e(o.type):t.push(new Ye(r,n.ref,'ref layer "'.concat(l,'" not found')));else if("background"!==s&&"sky"!==s)if(n.source){var f=i.sources&&i.sources[n.source],d=f&&$e(f.type);f?"vector"===d&&"raster"===s?t.push(new Ye(r,n.source,'layer "'.concat(n.id,'" requires a raster source'))):"raster"===d&&"raster"!==s?t.push(new Ye(r,n.source,'layer "'.concat(n.id,'" requires a vector source'))):"vector"!==d||n["source-layer"]?"raster-dem"===d&&"hillshade"!==s?t.push(new Ye(r,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]||"geojson"===d&&f.lineMetrics||t.push(new Ye(r,n,'layer "'.concat(n.id,'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.'))):t.push(new Ye(r,n,'layer "'.concat(n.id,'" must specify a "source-layer"'))):t.push(new Ye(r,n.source,'source "'.concat(n.source,'" not found')))}else t.push(new Ye(r,n,'missing required property "source"'));return t=t.concat(gr({key:r,value:n,valueSpec:a.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Gr({key:"".concat(r,".type"),value:n.type,valueSpec:a.layer.type,style:e.style,styleSpec:e.styleSpec,object:n,objectKey:"type"})},filter:Lr,layout:function(e){return gr({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(e){return Nr(Qe({layerType:s},e))}}})},paint:function(e){return gr({layer:n,key:e.key,value:e.value,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(e){return Dr(Qe({layerType:s},e))}}})}}}))}function Fr(e){var t=e.value,n=e.key,r=rr(t);return"string"!==r?[new Ye(n,t,"string expected, ".concat(r," found"))]:[]}var Br={promoteId:function(e){var t=e.key,n=e.value;if("string"===rr(n))return Fr({key:t,value:n});var r=[];for(var i in n)r.push.apply(r,c(Fr({key:"".concat(t,".").concat(i),value:n[i]})));return r}};function Ur(e){var t=e.value,n=e.key,r=e.styleSpec,i=e.style;if(!t.type)return[new Ye(n,t,'"type" is required')];var a,o=$e(t.type);switch(o){case"vector":case"raster":case"raster-dem":return a=gr({key:n,value:t,valueSpec:r["source_".concat(o.replace("-","_"))],style:e.style,styleSpec:r,objectElementValidators:Br});case"geojson":if(a=gr({key:n,value:t,valueSpec:r.source_geojson,style:i,styleSpec:r,objectElementValidators:Br}),t.cluster)for(var s in t.clusterProperties){var l,u,f=h(t.clusterProperties[s],2),d=f[0],p=f[1],m="string"==typeof d?[d,["accumulated"],["get",s]]:d;(l=a).push.apply(l,c(wr({key:"".concat(n,".").concat(s,".map"),value:p,expressionContext:"cluster-map"}))),(u=a).push.apply(u,c(wr({key:"".concat(n,".").concat(s,".reduce"),value:m,expressionContext:"cluster-reduce"})))}return a;case"video":return gr({key:n,value:t,valueSpec:r.source_video,style:i,styleSpec:r});case"image":return gr({key:n,value:t,valueSpec:r.source_image,style:i,styleSpec:r});case"canvas":return[new Ye(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Er({key:"".concat(n,".type"),value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:r})}}function jr(e){var t=e.value,n=e.styleSpec,r=n.light,i=e.style,a=[],o=rr(t);if(void 0===t)return a;if("object"!==o)return a=a.concat([new Ye("light",t,"object expected, ".concat(o," found"))]);for(var s in t){var l=s.match(/^(.*)-transition$/);a=a.concat(l&&r[l[1]]&&r[l[1]].transition?Gr({key:s,value:t[s],valueSpec:n.transition,style:i,styleSpec:n}):r[s]?Gr({key:s,value:t[s],valueSpec:r[s],style:i,styleSpec:n}):[new Ye(s,t[s],'unknown property "'.concat(s,'"'))])}return a}function Vr(e){var t=e.value,n=e.key,r=e.style,i=e.styleSpec,a=i.terrain,o=[],s=rr(t);if(void 0===t)return o;if("object"!==s)return o=o.concat([new Ye("terrain",t,"object expected, ".concat(s," found"))]);for(var l in t){var u=l.match(/^(.*)-transition$/);o=o.concat(u&&a[u[1]]&&a[u[1]].transition?Gr({key:l,value:t[l],valueSpec:i.transition,style:r,styleSpec:i}):a[l]?Gr({key:l,value:t[l],valueSpec:a[l],style:r,styleSpec:i}):[new Ye(l,t[l],'unknown property "'.concat(l,'"'))])}if(t.source){var c=r.sources&&r.sources[t.source],h=c&&$e(c.type);c?"raster-dem"!==h&&o.push(new Ye(n,t.source,"terrain cannot be used with a source of type ".concat(h,', it only be used with a "raster-dem" source type'))):o.push(new Ye(n,t.source,'source "'.concat(t.source,'" not found')))}else o.push(new Ye(n,t,'terrain is missing required property "source"'));return o}var Hr={"*":function(){return[]},array:_r,boolean:function(e){var t=e.value,n=e.key,r=rr(t);return"boolean"!==r?[new Ye(n,t,"boolean expected, ".concat(r," found"))]:[]},number:br,color:function(e){var t=e.key,n=e.value,r=rr(n);return"string"!==r?[new Ye(t,n,"color expected, ".concat(r," found"))]:null===bt(n)?[new Ye(t,n,'color expected, "'.concat(n,'" found'))]:[]},constants:Je,enum:Er,filter:Lr,function:xr,layer:zr,object:gr,source:Ur,light:jr,terrain:Vr,string:Fr,formatted:function(e){return 0===Fr(e).length?[]:wr(e)},resolvedImage:function(e){return 0===Fr(e).length?[]:wr(e)}};function Gr(e){var t=e.value,n=e.valueSpec,r=e.styleSpec;return n.expression&&ir($e(t))?xr(e):n.expression&&fr(et(t))?wr(e):n.type&&Hr[n.type]?Hr[n.type](e):gr(Qe({},e,{valueSpec:n.type?r[n.type]:n}))}function Wr(e){var t=e.value,n=e.key,r=Fr(e);return r.length||(-1===t.indexOf("{fontstack}")&&r.push(new Ye(n,t,'"glyphs" url must include a "{fontstack}" token')),-1===t.indexOf("{range}")&&r.push(new Ye(n,t,'"glyphs" url must include a "{range}" token'))),r}function qr(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ke,n=[];return n=n.concat(Gr({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Wr,"*":function(){return[]}}})),e.constants&&(n=n.concat(Je({key:"constants",value:e.constants,style:e,styleSpec:t}))),Xr(n)}function Xr(e){return[].concat(e).sort((function(e,t){return e.line-t.line}))}function Zr(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return Xr(e.apply(this,n))}}qr.source=Zr(Ur),qr.light=Zr(jr),qr.terrain=Zr(Vr),qr.layer=Zr(zr),qr.filter=Zr(Lr),qr.paintProperty=Zr(Dr),qr.layoutProperty=Zr(Nr);var Kr=qr,Yr=Kr.light,Jr=Kr.paintProperty,Qr=Kr.layoutProperty;function $r(e,t){var n=!1;if(t&&t.length){var r,i=f(t);try{for(i.s();!(r=i.n()).done;){var a=r.value;e.fire(new Xe(new Error(a.message))),n=!0}}catch(o){i.e(o)}finally{i.f()}}return n}var ei=ti;function ti(e,t,n){var r=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var i=new Int32Array(this.arrayBuffer);e=i[0],this.d=(t=i[1])+2*(n=i[2]);for(var a=0;a<this.d*this.d;a++){var o=i[3+a],s=i[3+a+1];r.push(o===s?null:i.subarray(o,s))}var l=i[3+r.length+1];this.keys=i.subarray(i[3+r.length],l),this.bboxes=i.subarray(l),this.insert=this._insertReadonly}else{this.d=t+2*n;for(var u=0;u<this.d*this.d;u++)r.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=n,this.scale=t/e,this.uid=0;var c=n/t*e;this.min=-c,this.max=e+c}ti.prototype.insert=function(e,t,n,r,i){this._forEachCell(t,n,r,i,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},ti.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ti.prototype._insertCell=function(e,t,n,r,i,a){this.cells[i].push(a)},ti.prototype.query=function(e,t,n,r,i){var a=this.min,o=this.max;if(e<=a&&t<=a&&o<=n&&o<=r&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(e,t,n,r,this._queryCell,s,{},i),s},ti.prototype._queryCell=function(e,t,n,r,i,a,o,s){var l=this.cells[i];if(null!==l)for(var u=this.keys,c=this.bboxes,h=0;h<l.length;h++){var f=l[h];if(void 0===o[f]){var d=4*f;(s?s(c[d+0],c[d+1],c[d+2],c[d+3]):e<=c[d+2]&&t<=c[d+3]&&n>=c[d+0]&&r>=c[d+1])?(o[f]=!0,a.push(u[f])):o[f]=!1}}},ti.prototype._forEachCell=function(e,t,n,r,i,a,o,s){for(var l=this._convertToCellCoord(e),u=this._convertToCellCoord(t),c=this._convertToCellCoord(n),h=this._convertToCellCoord(r),f=l;f<=c;f++)for(var d=u;d<=h;d++){var p=this.d*d+f;if((!s||s(this._convertFromCellCoord(f),this._convertFromCellCoord(d),this._convertFromCellCoord(f+1),this._convertFromCellCoord(d+1)))&&i.call(this,e,t,n,r,p,a,o,s))return}},ti.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},ti.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},ti.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,n=0,r=0;r<this.cells.length;r++)n+=this.cells[r].length;var i=new Int32Array(t+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var a=t,o=0;o<e.length;o++){var s=e[o];i[3+o]=a,i.set(s,a),a+=s.length}return i[3+e.length]=a,i.set(this.keys,a),i[3+e.length+1]=a+=this.keys.length,i.set(this.bboxes,a),a+=this.bboxes.length,i.buffer};var ni=_.ImageData,ri=_.ImageBitmap,ii={};function ai(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),ii[e]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}for(var oi in ai("Object",Object),ei.serialize=function(e,t){var n=e.toArrayBuffer();return t&&t.push(n),{buffer:n}},ei.deserialize=function(e){return new ei(e.buffer)},ai("Grid",ei),ai("Color",xt),ai("Error",Error),ai("ResolvedImage",Tt),ai("StylePropertyFunction",yr),ai("StyleExpression",hr,{omit:["_evaluator"]}),ai("ZoomDependentExpression",mr),ai("ZoomConstantExpression",pr),ai("CompoundExpression",Ut,{omit:["_evaluate"]}),Xn)Xn[oi]._classRegistryKey||ai("Expression_".concat(oi),Xn[oi]);function si(e){return e&&"undefined"!=typeof ArrayBuffer&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function li(e){return ri&&e instanceof ri}function ui(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(si(e)||li(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var n=e;return t&&t.push(n.buffer),n}if(e instanceof ni)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){var r,i=[],a=f(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;i.push(ui(o,t))}}catch(d){a.e(d)}finally{a.f()}return i}if("object"==typeof e){var s=e.constructor,l=s._classRegistryKey;if(!l)throw new Error("can't serialize object of unregistered class");var u=s.serialize?s.serialize(e,t):{};if(!s.serialize){for(var c in e)if(e.hasOwnProperty(c)&&!(ii[l].omit.indexOf(c)>=0)){var h=e[c];u[c]=ii[l].shallow.indexOf(c)>=0?h:ui(h,t)}e instanceof Error&&(u.message=e.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==l&&(u.$name=l),u}throw new Error("can't serialize object of type ".concat(typeof e))}function ci(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||si(e)||li(e)||ArrayBuffer.isView(e)||e instanceof ni)return e;if(Array.isArray(e))return e.map(ci);if("object"==typeof e){var t=e.$name||"Object",n=ii[t].klass;if(!n)throw new Error("can't deserialize unregistered class ".concat(t));if(n.deserialize)return n.deserialize(e);for(var r=Object.create(n.prototype),i=0,a=Object.keys(e);i<a.length;i++){var o=a[i];if("$name"!==o){var s=e[o];r[o]=ii[t].shallow.indexOf(o)>=0?s:ci(s)}}return r}throw new Error("can't deserialize object of type ".concat(typeof e))}var hi=function(){function e(){v(this,e),this.first=!0}return y(e,[{key:"update",value:function(e,t){var n=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=n,!0))}}]),e}(),fi={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function di(e){var t,n=f(e);try{for(n.s();!(t=n.n()).done;)if(vi(t.value.charCodeAt(0)))return!0}catch(r){n.e(r)}finally{n.f()}return!1}function pi(e){var t,n=f(e);try{for(n.s();!(t=n.n()).done;)if(!mi(t.value.charCodeAt(0)))return!1}catch(r){n.e(r)}finally{n.f()}return!0}function mi(e){return!(fi.Arabic(e)||fi["Arabic Supplement"](e)||fi["Arabic Extended-A"](e)||fi["Arabic Presentation Forms-A"](e)||fi["Arabic Presentation Forms-B"](e))}function vi(e){return!(746!==e&&747!==e&&(e<4352||!(fi["Bopomofo Extended"](e)||fi.Bopomofo(e)||fi["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||fi["CJK Compatibility Ideographs"](e)||fi["CJK Compatibility"](e)||fi["CJK Radicals Supplement"](e)||fi["CJK Strokes"](e)||!(!fi["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||fi["CJK Unified Ideographs Extension A"](e)||fi["CJK Unified Ideographs"](e)||fi["Enclosed CJK Letters and Months"](e)||fi["Hangul Compatibility Jamo"](e)||fi["Hangul Jamo Extended-A"](e)||fi["Hangul Jamo Extended-B"](e)||fi["Hangul Jamo"](e)||fi["Hangul Syllables"](e)||fi.Hiragana(e)||fi["Ideographic Description Characters"](e)||fi.Kanbun(e)||fi["Kangxi Radicals"](e)||fi["Katakana Phonetic Extensions"](e)||fi.Katakana(e)&&12540!==e||!(!fi["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!fi["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||fi["Unified Canadian Aboriginal Syllabics"](e)||fi["Unified Canadian Aboriginal Syllabics Extended"](e)||fi["Vertical Forms"](e)||fi["Yijing Hexagram Symbols"](e)||fi["Yi Syllables"](e)||fi["Yi Radicals"](e))))}function yi(e){return!(vi(e)||function(e){return!!(fi["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||fi["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||fi["Letterlike Symbols"](e)||fi["Number Forms"](e)||fi["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||fi["Control Pictures"](e)&&9251!==e||fi["Optical Character Recognition"](e)||fi["Enclosed Alphanumerics"](e)||fi["Geometric Shapes"](e)||fi["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||fi["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||fi["CJK Symbols and Punctuation"](e)||fi.Katakana(e)||fi["Private Use Area"](e)||fi["CJK Compatibility Forms"](e)||fi["Small Form Variants"](e)||fi["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function gi(e){return e>=1424&&e<=2303||fi["Arabic Presentation Forms-A"](e)||fi["Arabic Presentation Forms-B"](e)}function _i(e,t){return!(!t&&gi(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||fi.Khmer(e))}function bi(e){var t,n=f(e);try{for(n.s();!(t=n.n()).done;)if(gi(t.value.charCodeAt(0)))return!0}catch(r){n.e(r)}finally{n.f()}return!1}var xi=null,wi="unavailable",Ei=null,Si=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(wi="error"),xi&&xi(e)};function Ti(){ki.fire(new qe("pluginStateChange",{pluginStatus:wi,pluginURL:Ei}))}var ki=new Ze,Mi=function(){return wi},Ci=function(){if("deferred"!==wi||!Ei)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");wi="loading",Ti(),Ei&&Ne({url:Ei},(function(e){e?Si(e):(wi="loaded",Ti())}))},Ai={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return"loaded"===wi||null!=Ai.applyArabicShaping},isLoading:function(){return"loading"===wi},setState:function(e){wi=e.pluginStatus,Ei=e.pluginURL},isParsed:function(){return null!=Ai.applyArabicShaping&&null!=Ai.processBidirectionalText&&null!=Ai.processStyledBidirectionalText},getPluginURL:function(){return Ei}},Ii=function(){function e(t,n){v(this,e),this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new hi,this.transition={})}return y(e,[{key:"isSupportedScript",value:function(e){return function(e,t){var n,r=f(e);try{for(r.s();!(n=r.n()).done;)if(!_i(n.value.charCodeAt(0),t))return!1}catch(i){r.e(i)}finally{r.f()}return!0}(e,Ai.isLoaded())}},{key:"crossFadingFactor",value:function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}},{key:"getCrossfadeParameters",value:function(){var e=this.zoom,t=e-Math.floor(e),n=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*t}}}]),e}(),Pi=function(){function e(t,n){v(this,e),this.property=t,this.value=n,this.expression=function(e,t){if(ir(e))return new yr(e,t);if(fr(e)){var n=vr(e,t);if("error"===n.result)throw new Error(n.value.map((function(e){return"".concat(e.key,": ").concat(e.message)})).join(", "));return n.value}var r=e;return"string"==typeof e&&"color"===t.type&&(r=xt.parse(e)),{kind:"constant",evaluate:function(){return r}}}(void 0===n?t.specification.default:n,t.specification)}return y(e,[{key:"isDataDriven",value:function(){return"source"===this.expression.kind||"composite"===this.expression.kind}},{key:"possiblyEvaluate",value:function(e,t,n){return this.property.possiblyEvaluate(this,e,t,n)}}]),e}(),Ri=function(){function e(t){v(this,e),this.property=t,this.value=new Pi(t,void 0)}return y(e,[{key:"transitioned",value:function(e,t){return new Oi(this.property,this.value,t,P({},e.transition,this.transition),e.now)}},{key:"untransitioned",value:function(){return new Oi(this.property,this.value,null,{},0)}}]),e}(),Li=function(){function e(t){v(this,e),this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}return y(e,[{key:"getValue",value:function(e){return U(this._values[e].value.value)}},{key:"setValue",value:function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Ri(this._values[e].property)),this._values[e].value=new Pi(this._values[e].property,null===t?void 0:U(t))}},{key:"getTransition",value:function(e){return U(this._values[e].transition)}},{key:"setTransition",value:function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Ri(this._values[e].property)),this._values[e].transition=U(t)||void 0}},{key:"serialize",value:function(){for(var e={},t=0,n=Object.keys(this._values);t<n.length;t++){var r=n[t],i=this.getValue(r);void 0!==i&&(e[r]=i);var a=this.getTransition(r);void 0!==a&&(e["".concat(r,"-transition")]=a)}return e}},{key:"transitioned",value:function(e,t){for(var n=new Di(this._properties),r=0,i=Object.keys(this._values);r<i.length;r++){var a=i[r];n._values[a]=this._values[a].transitioned(e,t._values[a])}return n}},{key:"untransitioned",value:function(){for(var e=new Di(this._properties),t=0,n=Object.keys(this._values);t<n.length;t++){var r=n[t];e._values[r]=this._values[r].untransitioned()}return e}}]),e}(),Oi=function(){function e(t,n,r,i,a){v(this,e),this.property=t,this.value=n,this.begin=a+i.delay||0,this.end=this.begin+i.duration||0,t.specification.transition&&(i.delay||i.duration)&&(this.prior=r)}return y(e,[{key:"possiblyEvaluate",value:function(e,t,n){var r=e.now||0,i=this.value.possiblyEvaluate(e,t,n),a=this.prior;if(a){if(r>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(r<this.begin)return a.possiblyEvaluate(e,t,n);var o=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(a.possiblyEvaluate(e,t,n),i,T(o))}return i}}]),e}(),Di=function(){function e(t){v(this,e),this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}return y(e,[{key:"possiblyEvaluate",value:function(e,t,n){for(var r=new Fi(this._properties),i=0,a=Object.keys(this._values);i<a.length;i++){var o=a[i];r._values[o]=this._values[o].possiblyEvaluate(e,t,n)}return r}},{key:"hasTransition",value:function(){for(var e=0,t=Object.keys(this._values);e<t.length;e++){var n=t[e];if(this._values[n].prior)return!0}return!1}}]),e}(),Ni=function(){function e(t){v(this,e),this._properties=t,this._values=Object.create(t.defaultPropertyValues)}return y(e,[{key:"getValue",value:function(e){return U(this._values[e].value)}},{key:"setValue",value:function(e,t){this._values[e]=new Pi(this._values[e].property,null===t?void 0:U(t))}},{key:"serialize",value:function(){for(var e={},t=0,n=Object.keys(this._values);t<n.length;t++){var r=n[t],i=this.getValue(r);void 0!==i&&(e[r]=i)}return e}},{key:"possiblyEvaluate",value:function(e,t,n){for(var r=new Fi(this._properties),i=0,a=Object.keys(this._values);i<a.length;i++){var o=a[i];r._values[o]=this._values[o].possiblyEvaluate(e,t,n)}return r}}]),e}(),zi=function(){function e(t,n,r){v(this,e),this.property=t,this.value=n,this.parameters=r}return y(e,[{key:"isConstant",value:function(){return"constant"===this.value.kind}},{key:"constantOr",value:function(e){return"constant"===this.value.kind?this.value.value:e}},{key:"evaluate",value:function(e,t,n,r){return this.property.evaluate(this.value,this.parameters,e,t,n,r)}}]),e}(),Fi=function(){function e(t){v(this,e),this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}return y(e,[{key:"get",value:function(e){return this._values[e]}}]),e}(),Bi=function(){function e(t){v(this,e),this.specification=t}return y(e,[{key:"possiblyEvaluate",value:function(e,t){return e.expression.evaluate(t)}},{key:"interpolate",value:function(e,t,n){var r=dn[this.specification.type];return r?r(e,t,n):e}}]),e}(),Ui=function(){function e(t,n){v(this,e),this.specification=t,this.overrides=n}return y(e,[{key:"possiblyEvaluate",value:function(e,t,n,r){return new zi(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(t,null,{},n,r)}:e.expression,t)}},{key:"interpolate",value:function(e,t,n){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new zi(this,{kind:"constant",value:void 0},e.parameters);var r=dn[this.specification.type];return r?new zi(this,{kind:"constant",value:r(e.value.value,t.value.value,n)},e.parameters):e}},{key:"evaluate",value:function(e,t,n,r,i,a){return"constant"===e.kind?e.value:e.evaluate(t,n,r,i,a)}}]),e}(),ji=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"possiblyEvaluate",value:function(e,t,n,r){if(void 0===e.value)return new zi(this,{kind:"constant",value:void 0},t);if("constant"===e.expression.kind){var i=e.expression.evaluate(t,null,{},n,r),a="resolvedImage"===e.property.specification.type&&"string"!=typeof i?i.name:i,o=this._calculate(a,a,a,t);return new zi(this,{kind:"constant",value:o},t)}if("camera"===e.expression.kind){var s=this._calculate(e.expression.evaluate({zoom:t.zoom-1}),e.expression.evaluate({zoom:t.zoom}),e.expression.evaluate({zoom:t.zoom+1}),t);return new zi(this,{kind:"constant",value:s},t)}return new zi(this,e.expression,t)}},{key:"evaluate",value:function(e,t,n,r,i,a){if("source"===e.kind){var o=e.evaluate(t,n,r,i,a);return this._calculate(o,o,o,t)}return"composite"===e.kind?this._calculate(e.evaluate({zoom:Math.floor(t.zoom)-1},n,r),e.evaluate({zoom:Math.floor(t.zoom)},n,r),e.evaluate({zoom:Math.floor(t.zoom)+1},n,r),t):e.value}},{key:"_calculate",value:function(e,t,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}}},{key:"interpolate",value:function(e){return e}}]),n}(Ui),Vi=function(){function e(t){v(this,e),this.specification=t}return y(e,[{key:"possiblyEvaluate",value:function(e,t,n,r){if(void 0!==e.value){if("constant"===e.expression.kind){var i=e.expression.evaluate(t,null,{},n,r);return this._calculate(i,i,i,t)}return this._calculate(e.expression.evaluate(new Ii(Math.floor(t.zoom-1),t)),e.expression.evaluate(new Ii(Math.floor(t.zoom),t)),e.expression.evaluate(new Ii(Math.floor(t.zoom+1),t)),t)}}},{key:"_calculate",value:function(e,t,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:n,to:t}}},{key:"interpolate",value:function(e){return e}}]),e}(),Hi=function(){function e(t){v(this,e),this.specification=t}return y(e,[{key:"possiblyEvaluate",value:function(e,t,n,r){return!!e.expression.evaluate(t,null,{},n,r)}},{key:"interpolate",value:function(){return!1}}]),e}(),Gi=function e(t){for(var n in v(this,e),this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var r=t[n];r.specification.overridable&&this.overridableProperties.push(n);var i=this.defaultPropertyValues[n]=new Pi(r,void 0),a=this.defaultTransitionablePropertyValues[n]=new Ri(r);this.defaultTransitioningPropertyValues[n]=a.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=i.possiblyEvaluate({})}};function Wi(e,t){return 256*(e=C(Math.floor(e),0,255))+C(Math.floor(t),0,255)}ai("DataDrivenProperty",Ui),ai("DataConstantProperty",Bi),ai("CrossFadedDataDrivenProperty",ji),ai("CrossFadedProperty",Vi),ai("ColorRampProperty",Hi);var qi={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Xi=function e(t,n){v(this,e),this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Zi=function(){function e(){v(this,e),this.isTransferred=!1,this.capacity=-1,this.resize(0)}return y(e,[{key:"_trim",value:function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}},{key:"clear",value:function(){this.length=0}},{key:"resize",value:function(e){this.reserve(e),this.length=e}},{key:"reserve",value:function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}},{key:"_refreshViews",value:function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}],[{key:"serialize",value:function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}},{key:"deserialize",value:function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t}}]),e}();function Ki(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=0,r=0;return{members:e.map((function(e){var i=qi[e.type].BYTES_PER_ELEMENT,a=n=Yi(n,Math.max(t,i)),o=e.components||1;return r=Math.max(r,i),n+=i*o,{name:e.name,type:e.type,components:o,offset:a}})),size:Yi(n,Math.max(r,t)),alignment:t}}function Yi(e,t){return Math.ceil(e/t)*t}var Ji=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t){var n=this.length;return this.resize(n+1),this.emplace(n,e,t)}},{key:"emplace",value:function(e,t,n){var r=2*e;return this.int16[r+0]=t,this.int16[r+1]=n,e}}]),n}(Zi);Ji.prototype.bytesPerElement=4,ai("StructArrayLayout2i4",Ji);var Qi=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)}},{key:"emplace",value:function(e,t,n,r,i){var a=4*e;return this.int16[a+0]=t,this.int16[a+1]=n,this.int16[a+2]=r,this.int16[a+3]=i,e}}]),n}(Zi);Qi.prototype.bytesPerElement=8,ai("StructArrayLayout4i8",Qi);var $i=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,r,i,a,o){var s=this.length;return this.resize(s+1),this.emplace(s,e,t,n,r,i,a,o)}},{key:"emplace",value:function(e,t,n,r,i,a,o,s){var l=6*e,u=12*e,c=3*e;return this.int16[l+0]=t,this.int16[l+1]=n,this.uint8[u+4]=r,this.uint8[u+5]=i,this.uint8[u+6]=a,this.uint8[u+7]=o,this.float32[c+2]=s,e}}]),n}(Zi);$i.prototype.bytesPerElement=12,ai("StructArrayLayout2i4ub1f12",$i);var ea=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t){var n=this.length;return this.resize(n+1),this.emplace(n,e,t)}},{key:"emplace",value:function(e,t,n){var r=2*e;return this.float32[r+0]=t,this.float32[r+1]=n,e}}]),n}(Zi);ea.prototype.bytesPerElement=8,ai("StructArrayLayout2f8",ea);var ta=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,r,i,a,o,s,l,u){var c=this.length;return this.resize(c+1),this.emplace(c,e,t,n,r,i,a,o,s,l,u)}},{key:"emplace",value:function(e,t,n,r,i,a,o,s,l,u,c){var h=10*e;return this.uint16[h+0]=t,this.uint16[h+1]=n,this.uint16[h+2]=r,this.uint16[h+3]=i,this.uint16[h+4]=a,this.uint16[h+5]=o,this.uint16[h+6]=s,this.uint16[h+7]=l,this.uint16[h+8]=u,this.uint16[h+9]=c,e}}]),n}(Zi);ta.prototype.bytesPerElement=20,ai("StructArrayLayout10ui20",ta);var na=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,r,i,a,o,s,l,u,c,h){var f=this.length;return this.resize(f+1),this.emplace(f,e,t,n,r,i,a,o,s,l,u,c,h)}},{key:"emplace",value:function(e,t,n,r,i,a,o,s,l,u,c,h,f){var d=12*e;return this.int16[d+0]=t,this.int16[d+1]=n,this.int16[d+2]=r,this.int16[d+3]=i,this.uint16[d+4]=a,this.uint16[d+5]=o,this.uint16[d+6]=s,this.uint16[d+7]=l,this.int16[d+8]=u,this.int16[d+9]=c,this.int16[d+10]=h,this.int16[d+11]=f,e}}]),n}(Zi);na.prototype.bytesPerElement=24,ai("StructArrayLayout4i4ui4i24",na);var ra=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}},{key:"emplace",value:function(e,t,n,r){var i=3*e;return this.float32[i+0]=t,this.float32[i+1]=n,this.float32[i+2]=r,e}}]),n}(Zi);ra.prototype.bytesPerElement=12,ai("StructArrayLayout3f12",ra);var ia=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}},{key:"emplace",value:function(e,t){return this.uint32[1*e+0]=t,e}}]),n}(Zi);ia.prototype.bytesPerElement=4,ai("StructArrayLayout1ul4",ia);var aa=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,r,i,a,o,s,l,u){var c=this.length;return this.resize(c+1),this.emplace(c,e,t,n,r,i,a,o,s,l,u)}},{key:"emplace",value:function(e,t,n,r,i,a,o,s,l,u,c){var h=16*e,f=8*e;return this.int16[h+0]=t,this.int16[h+1]=n,this.float32[f+1]=r,this.float32[f+2]=i,this.float32[f+3]=a,this.float32[f+4]=o,this.int16[h+10]=s,this.uint32[f+6]=l,this.uint16[h+14]=u,this.uint16[h+15]=c,e}}]),n}(Zi);aa.prototype.bytesPerElement=32,ai("StructArrayLayout2i4f1i1ul2ui32",aa);var oa=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,r,i,a){var o=this.length;return this.resize(o+1),this.emplace(o,e,t,n,r,i,a)}},{key:"emplace",value:function(e,t,n,r,i,a,o){var s=6*e;return this.int16[s+0]=t,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=a,this.int16[s+5]=o,e}}]),n}(Zi);oa.prototype.bytesPerElement=12,ai("StructArrayLayout2i2i2i12",oa);var sa=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,r,i){var a=this.length;return this.resize(a+1),this.emplace(a,e,t,n,r,i)}},{key:"emplace",value:function(e,t,n,r,i,a){var o=4*e,s=8*e;return this.float32[o+0]=t,this.float32[o+1]=n,this.float32[o+2]=r,this.int16[s+6]=i,this.int16[s+7]=a,e}}]),n}(Zi);sa.prototype.bytesPerElement=16,ai("StructArrayLayout2f1f2i16",sa);var la=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)}},{key:"emplace",value:function(e,t,n,r,i){var a=12*e,o=3*e;return this.uint8[a+0]=t,this.uint8[a+1]=n,this.float32[o+1]=r,this.float32[o+2]=i,e}}]),n}(Zi);la.prototype.bytesPerElement=12,ai("StructArrayLayout2ub2f12",la);var ua=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}},{key:"emplace",value:function(e,t,n,r){var i=3*e;return this.uint16[i+0]=t,this.uint16[i+1]=n,this.uint16[i+2]=r,e}}]),n}(Zi);ua.prototype.bytesPerElement=6,ai("StructArrayLayout3ui6",ua);var ca=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,r,i,a,o,s,l,u,c,h,f,d,p,m,v){var y=this.length;return this.resize(y+1),this.emplace(y,e,t,n,r,i,a,o,s,l,u,c,h,f,d,p,m,v)}},{key:"emplace",value:function(e,t,n,r,i,a,o,s,l,u,c,h,f,d,p,m,v,y){var g=24*e,_=12*e,b=48*e;return this.int16[g+0]=t,this.int16[g+1]=n,this.uint16[g+2]=r,this.uint16[g+3]=i,this.uint32[_+2]=a,this.uint32[_+3]=o,this.uint32[_+4]=s,this.uint16[g+10]=l,this.uint16[g+11]=u,this.uint16[g+12]=c,this.float32[_+7]=h,this.float32[_+8]=f,this.uint8[b+36]=d,this.uint8[b+37]=p,this.uint8[b+38]=m,this.uint32[_+10]=v,this.int16[g+22]=y,e}}]),n}(Zi);ca.prototype.bytesPerElement=48,ai("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",ca);var ha=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,r,i,a,o,s,l,u,c,h,f,d,p,m,v,y,g,_,b,x,w,E,S,T,k,M){var C=this.length;return this.resize(C+1),this.emplace(C,e,t,n,r,i,a,o,s,l,u,c,h,f,d,p,m,v,y,g,_,b,x,w,E,S,T,k,M)}},{key:"emplace",value:function(e,t,n,r,i,a,o,s,l,u,c,h,f,d,p,m,v,y,g,_,b,x,w,E,S,T,k,M,C){var A=34*e,I=17*e;return this.int16[A+0]=t,this.int16[A+1]=n,this.int16[A+2]=r,this.int16[A+3]=i,this.int16[A+4]=a,this.int16[A+5]=o,this.int16[A+6]=s,this.int16[A+7]=l,this.uint16[A+8]=u,this.uint16[A+9]=c,this.uint16[A+10]=h,this.uint16[A+11]=f,this.uint16[A+12]=d,this.uint16[A+13]=p,this.uint16[A+14]=m,this.uint16[A+15]=v,this.uint16[A+16]=y,this.uint16[A+17]=g,this.uint16[A+18]=_,this.uint16[A+19]=b,this.uint16[A+20]=x,this.uint16[A+21]=w,this.uint16[A+22]=E,this.uint32[I+12]=S,this.float32[I+13]=T,this.float32[I+14]=k,this.float32[I+15]=M,this.float32[I+16]=C,e}}]),n}(Zi);ha.prototype.bytesPerElement=68,ai("StructArrayLayout8i15ui1ul4f68",ha);var fa=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}},{key:"emplace",value:function(e,t){return this.float32[1*e+0]=t,e}}]),n}(Zi);fa.prototype.bytesPerElement=4,ai("StructArrayLayout1f4",fa);var da=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}},{key:"emplace",value:function(e,t,n,r){var i=3*e;return this.int16[i+0]=t,this.int16[i+1]=n,this.int16[i+2]=r,e}}]),n}(Zi);da.prototype.bytesPerElement=6,ai("StructArrayLayout3i6",da);var pa=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n){var r=this.length;return this.resize(r+1),this.emplace(r,e,t,n)}},{key:"emplace",value:function(e,t,n,r){var i=4*e;return this.uint32[2*e+0]=t,this.uint16[i+2]=n,this.uint16[i+3]=r,e}}]),n}(Zi);pa.prototype.bytesPerElement=8,ai("StructArrayLayout1ul2ui8",pa);var ma=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t){var n=this.length;return this.resize(n+1),this.emplace(n,e,t)}},{key:"emplace",value:function(e,t,n){var r=2*e;return this.uint16[r+0]=t,this.uint16[r+1]=n,e}}]),n}(Zi);ma.prototype.bytesPerElement=4,ai("StructArrayLayout2ui4",ma);var va=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e){var t=this.length;return this.resize(t+1),this.emplace(t,e)}},{key:"emplace",value:function(e,t){return this.uint16[1*e+0]=t,e}}]),n}(Zi);va.prototype.bytesPerElement=2,ai("StructArrayLayout1ui2",va);var ya=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_refreshViews",value:function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}},{key:"emplaceBack",value:function(e,t,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,e,t,n,r)}},{key:"emplace",value:function(e,t,n,r,i){var a=4*e;return this.float32[a+0]=t,this.float32[a+1]=n,this.float32[a+2]=r,this.float32[a+3]=i,e}}]),n}(Zi);ya.prototype.bytesPerElement=16,ai("StructArrayLayout4f16",ya);var ga=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"anchorPointX",get:function(){return this._structArray.int16[this._pos2+0]}},{key:"anchorPointY",get:function(){return this._structArray.int16[this._pos2+1]}},{key:"x1",get:function(){return this._structArray.float32[this._pos4+1]}},{key:"y1",get:function(){return this._structArray.float32[this._pos4+2]}},{key:"x2",get:function(){return this._structArray.float32[this._pos4+3]}},{key:"y2",get:function(){return this._structArray.float32[this._pos4+4]}},{key:"padding",get:function(){return this._structArray.int16[this._pos2+10]}},{key:"featureIndex",get:function(){return this._structArray.uint32[this._pos4+6]}},{key:"sourceLayerIndex",get:function(){return this._structArray.uint16[this._pos2+14]}},{key:"bucketIndex",get:function(){return this._structArray.uint16[this._pos2+15]}},{key:"anchorPoint",get:function(){return new r(this.anchorPointX,this.anchorPointY)}}]),n}(Xi);ga.prototype.size=32;var _a=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"get",value:function(e){return new ga(this,e)}}]),n}(aa);ai("CollisionBoxArray",_a);var ba=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"anchorX",get:function(){return this._structArray.int16[this._pos2+0]}},{key:"anchorY",get:function(){return this._structArray.int16[this._pos2+1]}},{key:"glyphStartIndex",get:function(){return this._structArray.uint16[this._pos2+2]}},{key:"numGlyphs",get:function(){return this._structArray.uint16[this._pos2+3]}},{key:"vertexStartIndex",get:function(){return this._structArray.uint32[this._pos4+2]}},{key:"lineStartIndex",get:function(){return this._structArray.uint32[this._pos4+3]}},{key:"lineLength",get:function(){return this._structArray.uint32[this._pos4+4]}},{key:"segment",get:function(){return this._structArray.uint16[this._pos2+10]}},{key:"lowerSize",get:function(){return this._structArray.uint16[this._pos2+11]}},{key:"upperSize",get:function(){return this._structArray.uint16[this._pos2+12]}},{key:"lineOffsetX",get:function(){return this._structArray.float32[this._pos4+7]}},{key:"lineOffsetY",get:function(){return this._structArray.float32[this._pos4+8]}},{key:"writingMode",get:function(){return this._structArray.uint8[this._pos1+36]}},{key:"placedOrientation",get:function(){return this._structArray.uint8[this._pos1+37]},set:function(e){this._structArray.uint8[this._pos1+37]=e}},{key:"hidden",get:function(){return this._structArray.uint8[this._pos1+38]},set:function(e){this._structArray.uint8[this._pos1+38]=e}},{key:"crossTileID",get:function(){return this._structArray.uint32[this._pos4+10]},set:function(e){this._structArray.uint32[this._pos4+10]=e}},{key:"associatedIconIndex",get:function(){return this._structArray.int16[this._pos2+22]}}]),n}(Xi);ba.prototype.size=48;var xa=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"get",value:function(e){return new ba(this,e)}}]),n}(ca);ai("PlacedSymbolArray",xa);var wa=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"anchorX",get:function(){return this._structArray.int16[this._pos2+0]}},{key:"anchorY",get:function(){return this._structArray.int16[this._pos2+1]}},{key:"rightJustifiedTextSymbolIndex",get:function(){return this._structArray.int16[this._pos2+2]}},{key:"centerJustifiedTextSymbolIndex",get:function(){return this._structArray.int16[this._pos2+3]}},{key:"leftJustifiedTextSymbolIndex",get:function(){return this._structArray.int16[this._pos2+4]}},{key:"verticalPlacedTextSymbolIndex",get:function(){return this._structArray.int16[this._pos2+5]}},{key:"placedIconSymbolIndex",get:function(){return this._structArray.int16[this._pos2+6]}},{key:"verticalPlacedIconSymbolIndex",get:function(){return this._structArray.int16[this._pos2+7]}},{key:"key",get:function(){return this._structArray.uint16[this._pos2+8]}},{key:"textBoxStartIndex",get:function(){return this._structArray.uint16[this._pos2+9]}},{key:"textBoxEndIndex",get:function(){return this._structArray.uint16[this._pos2+10]}},{key:"verticalTextBoxStartIndex",get:function(){return this._structArray.uint16[this._pos2+11]}},{key:"verticalTextBoxEndIndex",get:function(){return this._structArray.uint16[this._pos2+12]}},{key:"iconBoxStartIndex",get:function(){return this._structArray.uint16[this._pos2+13]}},{key:"iconBoxEndIndex",get:function(){return this._structArray.uint16[this._pos2+14]}},{key:"verticalIconBoxStartIndex",get:function(){return this._structArray.uint16[this._pos2+15]}},{key:"verticalIconBoxEndIndex",get:function(){return this._structArray.uint16[this._pos2+16]}},{key:"featureIndex",get:function(){return this._structArray.uint16[this._pos2+17]}},{key:"numHorizontalGlyphVertices",get:function(){return this._structArray.uint16[this._pos2+18]}},{key:"numVerticalGlyphVertices",get:function(){return this._structArray.uint16[this._pos2+19]}},{key:"numIconVertices",get:function(){return this._structArray.uint16[this._pos2+20]}},{key:"numVerticalIconVertices",get:function(){return this._structArray.uint16[this._pos2+21]}},{key:"useRuntimeCollisionCircles",get:function(){return this._structArray.uint16[this._pos2+22]}},{key:"crossTileID",get:function(){return this._structArray.uint32[this._pos4+12]},set:function(e){this._structArray.uint32[this._pos4+12]=e}},{key:"textBoxScale",get:function(){return this._structArray.float32[this._pos4+13]}},{key:"textOffset0",get:function(){return this._structArray.float32[this._pos4+14]}},{key:"textOffset1",get:function(){return this._structArray.float32[this._pos4+15]}},{key:"collisionCircleDiameter",get:function(){return this._structArray.float32[this._pos4+16]}}]),n}(Xi);wa.prototype.size=68;var Ea=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"get",value:function(e){return new wa(this,e)}}]),n}(ha);ai("SymbolInstanceArray",Ea);var Sa=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getoffsetX",value:function(e){return this.float32[1*e+0]}}]),n}(fa);ai("GlyphOffsetArray",Sa);var Ta=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getx",value:function(e){return this.int16[3*e+0]}},{key:"gety",value:function(e){return this.int16[3*e+1]}},{key:"gettileUnitDistanceFromAnchor",value:function(e){return this.int16[3*e+2]}}]),n}(da);ai("SymbolLineVertexArray",Ta);var ka=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"featureIndex",get:function(){return this._structArray.uint32[this._pos4+0]}},{key:"sourceLayerIndex",get:function(){return this._structArray.uint16[this._pos2+2]}},{key:"bucketIndex",get:function(){return this._structArray.uint16[this._pos2+3]}}]),n}(Xi);ka.prototype.size=8;var Ma=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"get",value:function(e){return new ka(this,e)}}]),n}(pa);ai("FeatureIndexArray",Ma);var Ca=Ki([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Aa=_t((function(e){e.exports=function(e,t){var n,r,i,a,o,s,l,u;for(r=e.length-(n=3&e.length),i=t,o=3432918353,s=461845907,u=0;u<r;)l=255&e.charCodeAt(u)|(255&e.charCodeAt(++u))<<8|(255&e.charCodeAt(++u))<<16|(255&e.charCodeAt(++u))<<24,++u,i=27492+(65535&(a=5*(65535&(i=(i^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(a>>>16)&65535)<<16);switch(l=0,n){case 3:l^=(255&e.charCodeAt(u+2))<<16;case 2:l^=(255&e.charCodeAt(u+1))<<8;case 1:i^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(u)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}})),Ia=_t((function(e){e.exports=function(e,t){for(var n,r=e.length,i=t^r,a=0;r>=4;)n=1540483477*(65535&(n=255&e.charCodeAt(a)|(255&e.charCodeAt(++a))<<8|(255&e.charCodeAt(++a))<<16|(255&e.charCodeAt(++a))<<24))+((1540483477*(n>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),r-=4,++a;switch(r){case 3:i^=(255&e.charCodeAt(a+2))<<16;case 2:i^=(255&e.charCodeAt(a+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(a)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}})),Pa=Aa,Ra=Ia;Pa.murmur3=Aa,Pa.murmur2=Ra;var La=function(){function e(){v(this,e),this.ids=[],this.positions=[],this.indexed=!1}return y(e,[{key:"add",value:function(e,t,n,r){this.ids.push(Oa(e)),this.positions.push(t,n,r)}},{key:"getPositions",value:function(e){for(var t=Oa(e),n=0,r=this.ids.length-1;n<r;){var i=n+r>>1;this.ids[i]>=t?r=i:n=i+1}for(var a=[];this.ids[n]===t;)a.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return a}}],[{key:"serialize",value:function(e,t){var n=new Float64Array(e.ids),r=new Uint32Array(e.positions);return function e(t,n,r,i){for(;r<i;){for(var a=t[r+i>>1],o=r-1,s=i+1;;){do{o++}while(t[o]<a);do{s--}while(t[s]>a);if(o>=s)break;Da(t,o,s),Da(n,3*o,3*s),Da(n,3*o+1,3*s+1),Da(n,3*o+2,3*s+2)}s-r<i-s?(e(t,n,r,s),r=s+1):(e(t,n,s+1,i),i=s)}}(n,r,0,n.length-1),t&&t.push(n.buffer,r.buffer),{ids:n,positions:r}}},{key:"deserialize",value:function(t){var n=new e;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}]),e}();function Oa(e){var t=+e;return!isNaN(t)&&t<=x?t:Pa(String(e))}function Da(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}ai("FeaturePositionMap",La);var Na=function e(t,n){v(this,e),this.gl=t.gl,this.location=n},za=function(e){p(n,e);var t=m(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e,r)).current=0,i}return y(n,[{key:"set",value:function(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}]),n}(Na),Fa=function(e){p(n,e);var t=m(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e,r)).current=[0,0,0,0],i}return y(n,[{key:"set",value:function(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}]),n}(Na),Ba=function(e){p(n,e);var t=m(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e,r)).current=xt.transparent,i}return y(n,[{key:"set",value:function(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}]),n}(Na),Ua=new Float32Array(16),ja=new Float32Array(9);function Va(e){return[Wi(255*e.r,255*e.g),Wi(255*e.b,255*e.a)]}var Ha=function(){function e(t,n,r){v(this,e),this.value=t,this.uniformNames=n.map((function(e){return"u_".concat(e)})),this.type=r}return y(e,[{key:"setUniform",value:function(e,t,n){e.set(n.constantOr(this.value))}},{key:"getBinding",value:function(e,t,n){return"color"===this.type?new Ba(e,t):new za(e,t)}}]),e}(),Ga=function(){function e(t,n){v(this,e),this.uniformNames=n.map((function(e){return"u_".concat(e)})),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}return y(e,[{key:"setConstantPatternPositions",value:function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr}},{key:"setUniform",value:function(e,t,n,r){var i="u_pattern_to"===r?this.patternTo:"u_pattern_from"===r?this.patternFrom:"u_pixel_ratio_to"===r?this.pixelRatioTo:"u_pixel_ratio_from"===r?this.pixelRatioFrom:null;i&&e.set(i)}},{key:"getBinding",value:function(e,t,n){return"u_pattern"===n.substr(0,9)?new Fa(e,t):new za(e,t)}}]),e}(),Wa=function(){function e(t,n,r,i){v(this,e),this.expression=t,this.type=r,this.maxValue=0,this.paintVertexAttributes=n.map((function(e){return{name:"a_".concat(e),type:"Float32",components:"color"===r?2:1,offset:0}})),this.paintVertexArray=new i}return y(e,[{key:"populatePaintArray",value:function(e,t,n,r,i){var a=this.paintVertexArray.length,o=this.expression.evaluate(new Ii(0),t,{},r,[],i);this.paintVertexArray.resize(e),this._setPaintValue(a,e,o)}},{key:"updatePaintArray",value:function(e,t,n,r){var i=this.expression.evaluate({zoom:0},n,r);this._setPaintValue(e,t,i)}},{key:"_setPaintValue",value:function(e,t,n){if("color"===this.type)for(var r=Va(n),i=e;i<t;i++)this.paintVertexArray.emplace(i,r[0],r[1]);else{for(var a=e;a<t;a++)this.paintVertexArray.emplace(a,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}},{key:"upload",value:function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}},{key:"destroy",value:function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}]),e}(),qa=function(){function e(t,n,r,i,a,o){v(this,e),this.expression=t,this.uniformNames=n.map((function(e){return"u_".concat(e,"_t")})),this.type=r,this.useIntegerZoom=i,this.zoom=a,this.maxValue=0,this.paintVertexAttributes=n.map((function(e){return{name:"a_".concat(e),type:"Float32",components:"color"===r?4:2,offset:0}})),this.paintVertexArray=new o}return y(e,[{key:"populatePaintArray",value:function(e,t,n,r,i){var a=this.expression.evaluate(new Ii(this.zoom),t,{},r,[],i),o=this.expression.evaluate(new Ii(this.zoom+1),t,{},r,[],i),s=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(s,e,a,o)}},{key:"updatePaintArray",value:function(e,t,n,r){var i=this.expression.evaluate({zoom:this.zoom},n,r),a=this.expression.evaluate({zoom:this.zoom+1},n,r);this._setPaintValue(e,t,i,a)}},{key:"_setPaintValue",value:function(e,t,n,r){if("color"===this.type)for(var i=Va(n),a=Va(r),o=e;o<t;o++)this.paintVertexArray.emplace(o,i[0],i[1],a[0],a[1]);else{for(var s=e;s<t;s++)this.paintVertexArray.emplace(s,n,r);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(r))}}},{key:"upload",value:function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}},{key:"destroy",value:function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}},{key:"setUniform",value:function(e,t){var n=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,r=C(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);e.set(r)}},{key:"getBinding",value:function(e,t,n){return new za(e,t)}}]),e}(),Xa=function(){function e(t,n,r,i,a,o){v(this,e),this.expression=t,this.type=n,this.useIntegerZoom=r,this.zoom=i,this.layerId=o,this.zoomInPaintVertexArray=new a,this.zoomOutPaintVertexArray=new a}return y(e,[{key:"populatePaintArray",value:function(e,t,n){var r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(r,e,t.patterns&&t.patterns[this.layerId],n)}},{key:"updatePaintArray",value:function(e,t,n,r,i){this._setPaintValues(e,t,n.patterns&&n.patterns[this.layerId],i)}},{key:"_setPaintValues",value:function(e,t,n,r){if(r&&n){var i=n.min,a=n.mid,o=n.max,s=r[i],l=r[a],u=r[o];if(s&&l&&u)for(var c=e;c<t;c++)this.zoomInPaintVertexArray.emplace(c,l.tl[0],l.tl[1],l.br[0],l.br[1],s.tl[0],s.tl[1],s.br[0],s.br[1],l.pixelRatio,s.pixelRatio),this.zoomOutPaintVertexArray.emplace(c,l.tl[0],l.tl[1],l.br[0],l.br[1],u.tl[0],u.tl[1],u.br[0],u.br[1],l.pixelRatio,u.pixelRatio)}}},{key:"upload",value:function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Ca.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Ca.members,this.expression.isStateDependent))}},{key:"destroy",value:function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}]),e}(),Za=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!0};v(this,e),this.binders={},this._buffers=[];var i=[];for(var a in t.paint._values)if(r(a)){var o=t.paint.get(a);if(o instanceof zi&&er(o.property.specification)){var s=Ya(a,t.type),l=o.value,u=o.property.specification.type,c=o.property.useIntegerZoom,h=o.property.specification["property-type"],f="cross-faded"===h||"cross-faded-data-driven"===h;if("constant"===l.kind)this.binders[a]=f?new Ga(l.value,s):new Ha(l.value,s,u),i.push("/u_".concat(a));else if("source"===l.kind||f){var d=Ja(a,u,"source");this.binders[a]=f?new Xa(l,u,c,n,d,t.id):new Wa(l,s,u,d),i.push("/a_".concat(a))}else{var p=Ja(a,u,"composite");this.binders[a]=new qa(l,s,u,c,n,p),i.push("/z_".concat(a))}}}this.cacheKey=i.sort().join("")}return y(e,[{key:"getMaxValue",value:function(e){var t=this.binders[e];return t instanceof Wa||t instanceof qa?t.maxValue:0}},{key:"populatePaintArrays",value:function(e,t,n,r,i){for(var a in this.binders){var o=this.binders[a];(o instanceof Wa||o instanceof qa||o instanceof Xa)&&o.populatePaintArray(e,t,n,r,i)}}},{key:"setConstantPatternPositions",value:function(e,t){for(var n in this.binders){var r=this.binders[n];r instanceof Ga&&r.setConstantPatternPositions(e,t)}}},{key:"updatePaintArrays",value:function(e,t,n,r,i){var a=!1;for(var o in e){var s,l=t.getPositions(o),u=f(l);try{for(u.s();!(s=u.n()).done;){var c=s.value,h=n.feature(c.index);for(var d in this.binders){var p=this.binders[d];if((p instanceof Wa||p instanceof qa||p instanceof Xa)&&!0===p.expression.isStateDependent){var m=r.paint.get(d);p.expression=m.value,p.updatePaintArray(c.start,c.end,h,e[o],i),a=!0}}}}catch(v){u.e(v)}finally{u.f()}}return a}},{key:"defines",value:function(){var e=[];for(var t in this.binders){var n=this.binders[t];(n instanceof Ha||n instanceof Ga)&&e.push.apply(e,c(n.uniformNames.map((function(e){return"#define HAS_UNIFORM_".concat(e)}))))}return e}},{key:"getBinderAttributes",value:function(){var e=[];for(var t in this.binders){var n=this.binders[t];if(n instanceof Wa||n instanceof qa)for(var r=0;r<n.paintVertexAttributes.length;r++)e.push(n.paintVertexAttributes[r].name);else if(n instanceof Xa)for(var i=0;i<Ca.members.length;i++)e.push(Ca.members[i].name)}return e}},{key:"getBinderUniforms",value:function(){var e=[];for(var t in this.binders){var n=this.binders[t];if(n instanceof Ha||n instanceof Ga||n instanceof qa){var r,i=f(n.uniformNames);try{for(i.s();!(r=i.n()).done;){var a=r.value;e.push(a)}}catch(o){i.e(o)}finally{i.f()}}}return e}},{key:"getPaintVertexBuffers",value:function(){return this._buffers}},{key:"getUniforms",value:function(e,t){var n=[];for(var r in this.binders){var i=this.binders[r];if(i instanceof Ha||i instanceof Ga||i instanceof qa){var a,o=f(i.uniformNames);try{for(o.s();!(a=o.n()).done;){var s=a.value;if(t[s]){var l=i.getBinding(e,t[s],s);n.push({name:s,property:r,binding:l})}}}catch(u){o.e(u)}finally{o.f()}}}return n}},{key:"setUniforms",value:function(e,t,n,r){var i,a=f(t);try{for(a.s();!(i=a.n()).done;){var o=i.value,s=o.name,l=o.property,u=o.binding;this.binders[l].setUniform(u,r,n.get(l),s)}}catch(c){a.e(c)}finally{a.f()}}},{key:"updatePaintBuffers",value:function(e){for(var t in this._buffers=[],this.binders){var n=this.binders[t];if(e&&n instanceof Xa){var r=2===e.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;r&&this._buffers.push(r)}else(n instanceof Wa||n instanceof qa)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}},{key:"upload",value:function(e){for(var t in this.binders){var n=this.binders[t];(n instanceof Wa||n instanceof qa||n instanceof Xa)&&n.upload(e)}this.updatePaintBuffers()}},{key:"destroy",value:function(){for(var e in this.binders){var t=this.binders[e];(t instanceof Wa||t instanceof qa||t instanceof Xa)&&t.destroy()}}}]),e}(),Ka=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){return!0};v(this,e),this.programConfigurations={};var i,a=f(t);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.programConfigurations[o.id]=new Za(o,n,r)}}catch(s){a.e(s)}finally{a.f()}this.needsUpload=!1,this._featureMap=new La,this._bufferOffset=0}return y(e,[{key:"populatePaintArrays",value:function(e,t,n,r,i,a){for(var o in this.programConfigurations)this.programConfigurations[o].populatePaintArrays(e,t,r,i,a);void 0!==t.id&&this._featureMap.add(t.id,n,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}},{key:"updatePaintArrays",value:function(e,t,n,r){var i,a=f(n);try{for(a.s();!(i=a.n()).done;){var o=i.value;this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(e,this._featureMap,t,o,r)||this.needsUpload}}catch(s){a.e(s)}finally{a.f()}}},{key:"get",value:function(e){return this.programConfigurations[e]}},{key:"upload",value:function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}},{key:"destroy",value:function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()}}]),e}();function Ya(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace("".concat(t,"-"),"").replace(/-/g,"_")]}function Ja(e,t,n){var r={color:{source:ea,composite:ya},number:{source:fa,composite:ea}},i=function(e){return{"line-pattern":{source:ta,composite:ta},"fill-pattern":{source:ta,composite:ta},"fill-extrusion-pattern":{source:ta,composite:ta}}[e]}(e);return i&&i[n]||r[t][n]}ai("ConstantBinder",Ha),ai("CrossFadedConstantBinder",Ga),ai("SourceExpressionBinder",Wa),ai("CrossFadedCompositeBinder",Xa),ai("CompositeExpressionBinder",qa),ai("ProgramConfiguration",Za,{omit:["_buffers"]}),ai("ProgramConfigurationSet",Ka);var Qa=function(e){p(n,e);var t=m(n);function n(e,r){var i;if(v(this,n),(i=t.call(this)).id=e.id,i.type=e.type,i._featureFilter={filter:function(){return!0},needGeometry:!1},"custom"!==e.type&&(i.metadata=(e=e).metadata,i.minzoom=e.minzoom,i.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(i.source=e.source,i.sourceLayer=e["source-layer"],i.filter=e.filter),r.layout&&(i._unevaluatedLayout=new Ni(r.layout)),r.paint)){for(var a in i._transitionablePaint=new Li(r.paint),e.paint)i.setPaintProperty(a,e.paint[a],{validate:!1});for(var o in e.layout)i.setLayoutProperty(o,e.layout[o],{validate:!1});i._transitioningPaint=i._transitionablePaint.untransitioned(),i.paint=new Fi(r.paint)}return l(i)}return y(n,[{key:"getCrossfadeParameters",value:function(){return this._crossfadeParameters}},{key:"getLayoutProperty",value:function(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}},{key:"setLayoutProperty",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};null!=t&&this._validate(Qr,"layers.".concat(this.id,".layout.").concat(e),e,t,n)||("visibility"!==e?this._unevaluatedLayout.setValue(e,t):this.visibility=t)}},{key:"getPaintProperty",value:function(e){return z(e,"-transition")?this._transitionablePaint.getTransition(e.slice(0,-"-transition".length)):this._transitionablePaint.getValue(e)}},{key:"setPaintProperty",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!=t&&this._validate(Jr,"layers.".concat(this.id,".paint.").concat(e),e,t,n))return!1;if(z(e,"-transition"))return this._transitionablePaint.setTransition(e.slice(0,-"-transition".length),t||void 0),!1;var r=this._transitionablePaint._values[e],i="cross-faded-data-driven"===r.property.specification["property-type"],a=r.value.isDataDriven(),o=r.value;this._transitionablePaint.setValue(e,t),this._handleSpecialPaintPropertyUpdate(e);var s=this._transitionablePaint._values[e].value;return s.isDataDriven()||a||i||this._handleOverridablePaintPropertyUpdate(e,o,s)}},{key:"_handleSpecialPaintPropertyUpdate",value:function(e){}},{key:"getProgramIds",value:function(){return null}},{key:"getProgramConfiguration",value:function(e){return null}},{key:"_handleOverridablePaintPropertyUpdate",value:function(e,t,n){return!1}},{key:"isHidden",value:function(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}},{key:"updateTransitions",value:function(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}},{key:"hasTransition",value:function(){return this._transitioningPaint.hasTransition()}},{key:"recalculate",value:function(e,t){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}},{key:"serialize",value:function(){var e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),B(e,(function(e,t){return!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length)}))}},{key:"_validate",value:function(e,t,n,r){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return(!i||!1!==i.validate)&&$r(this,e.call(Kr,{key:t,layerType:this.type,objectKey:n,value:r,styleSpec:Ke,style:{glyphs:!0,sprite:!0}}))}},{key:"is3D",value:function(){return!1}},{key:"isSky",value:function(){return!1}},{key:"isTileClipped",value:function(){return!1}},{key:"hasOffscreenPass",value:function(){return!1}},{key:"resize",value:function(){}},{key:"isStateDependent",value:function(){for(var e in this.paint._values){var t=this.paint.get(e);if(t instanceof zi&&er(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}return!1}}]),n}(Ze),$a=Ki([{name:"a_pos",components:2,type:"Int16"}],4).members,eo=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];v(this,e),this.segments=t}return y(e,[{key:"prepareSegment",value:function(t,n,r,i){var a=this.segments[this.segments.length-1];return t>e.MAX_VERTEX_ARRAY_LENGTH&&V("Max vertices per segment is ".concat(e.MAX_VERTEX_ARRAY_LENGTH,": bucket requested ").concat(t)),(!a||a.vertexLength+t>e.MAX_VERTEX_ARRAY_LENGTH||a.sortKey!==i)&&(a={vertexOffset:n.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},void 0!==i&&(a.sortKey=i),this.segments.push(a)),a}},{key:"get",value:function(){return this.segments}},{key:"destroy",value:function(){var e,t=f(this.segments);try{for(t.s();!(e=t.n()).done;){var n=e.value;for(var r in n.vaos)n.vaos[r].destroy()}}catch(i){t.e(i)}finally{t.f()}}}],[{key:"simpleSegment",value:function(t,n,r,i){return new e([{vertexOffset:t,primitiveOffset:n,vertexLength:r,primitiveLength:i,vaos:{},sortKey:0}])}}]),e}();eo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ai("SegmentVector",eo);var to=Math.pow(2,14)-1,no=-to-1;function ro(e){for(var t=8192/e.extent,n=e.loadGeometry(),r=0;r<n.length;r++)for(var i=n[r],a=0;a<i.length;a++){var o=i[a],s=Math.round(o.x*t),l=Math.round(o.y*t);o.x=C(s,no,to),o.y=C(l,no,to),(s<o.x||s>o.x+1||l<o.y||l>o.y+1)&&V("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return n}function io(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?ro(e):[]}}function ao(e,t,n,r,i){e.emplaceBack(2*t+(r+1)/2,2*n+(i+1)/2)}var oo=function(){function e(t){v(this,e),this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ji,this.indexArray=new ua,this.segments=new eo,this.programConfigurations=new Ka(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id}))}return y(e,[{key:"populate",value:function(e,t,n){var r=this.layers[0],i=[],a=null;"circle"===r.type&&(a=r.layout.get("circle-sort-key"));var o,s=f(e);try{for(s.s();!(o=s.n()).done;){var l=o.value,u=l.feature,c=l.id,h=l.index,d=l.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,m=io(u,p);if(this.layers[0]._featureFilter.filter(new Ii(this.zoom),m,n)){var v=a?a.evaluate(m,{},n):void 0,y={id:c,properties:u.properties,type:u.type,sourceLayerIndex:d,index:h,geometry:p?m.geometry:ro(u),patterns:{},sortKey:v};i.push(y)}}}catch(T){s.e(T)}finally{s.f()}a&&i.sort((function(e,t){return e.sortKey-t.sortKey}));for(var g=0,_=i;g<_.length;g++){var b=_[g],x=b.geometry,w=b.index,E=b.sourceLayerIndex,S=e[w].feature;this.addFeature(b,x,w,n),t.featureIndex.insert(S,x,w,E,this.index)}}},{key:"update",value:function(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}},{key:"isEmpty",value:function(){return 0===this.layoutVertexArray.length}},{key:"uploadPending",value:function(){return!this.uploaded||this.programConfigurations.needsUpload}},{key:"upload",value:function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$a),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}},{key:"destroy",value:function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}},{key:"addFeature",value:function(e,t,n,r){var i,a=f(t);try{for(a.s();!(i=a.n()).done;){var o,s=i.value,l=f(s);try{for(l.s();!(o=l.n()).done;){var u=o.value,c=u.x,h=u.y;if(!(c<0||c>=8192||h<0||h>=8192)){var d=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),p=d.vertexLength;ao(this.layoutVertexArray,c,h,-1,-1),ao(this.layoutVertexArray,c,h,1,-1),ao(this.layoutVertexArray,c,h,1,1),ao(this.layoutVertexArray,c,h,-1,1),this.indexArray.emplaceBack(p,p+1,p+2),this.indexArray.emplaceBack(p,p+3,p+2),d.vertexLength+=4,d.primitiveLength+=2}}}catch(m){l.e(m)}finally{l.f()}}}catch(m){a.e(m)}finally{a.f()}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,{},r)}}]),e}();function so(e,t){for(var n=0;n<e.length;n++)if(yo(t,e[n]))return!0;for(var r=0;r<t.length;r++)if(yo(e,t[r]))return!0;return!!ho(e,t)}function lo(e,t,n){return!!yo(e,t)||!!po(t,e,n)}function uo(e,t){if(1===e.length)return vo(t,e[0]);for(var n=0;n<t.length;n++)for(var r=t[n],i=0;i<r.length;i++)if(yo(e,r[i]))return!0;for(var a=0;a<e.length;a++)if(vo(t,e[a]))return!0;for(var o=0;o<t.length;o++)if(ho(e,t[o]))return!0;return!1}function co(e,t,n){if(e.length>1){if(ho(e,t))return!0;for(var r=0;r<t.length;r++)if(po(t[r],e,n))return!0}for(var i=0;i<e.length;i++)if(po(e[i],t,n))return!0;return!1}function ho(e,t){if(0===e.length||0===t.length)return!1;for(var n=0;n<e.length-1;n++)for(var r=e[n],i=e[n+1],a=0;a<t.length-1;a++)if(fo(r,i,t[a],t[a+1]))return!0;return!1}function fo(e,t,n,r){return H(e,n,r)!==H(t,n,r)&&H(e,t,n)!==H(e,t,r)}function po(e,t,n){var r=n*n;if(1===t.length)return e.distSqr(t[0])<r;for(var i=1;i<t.length;i++)if(mo(e,t[i-1],t[i])<r)return!0;return!1}function mo(e,t,n){var r=t.distSqr(n);if(0===r)return e.distSqr(t);var i=((e.x-t.x)*(n.x-t.x)+(e.y-t.y)*(n.y-t.y))/r;return e.distSqr(i<0?t:i>1?n:n.sub(t)._mult(i)._add(t))}function vo(e,t){for(var n,r,i,a=!1,o=0;o<e.length;o++)for(var s=0,l=(n=e[o]).length-1;s<n.length;l=s++)r=n[s],i=n[l],r.y>t.y!=i.y>t.y&&t.x<(i.x-r.x)*(t.y-r.y)/(i.y-r.y)+r.x&&(a=!a);return a}function yo(e,t){for(var n=!1,r=0,i=e.length-1;r<e.length;i=r++){var a=e[r],o=e[i];a.y>t.y!=o.y>t.y&&t.x<(o.x-a.x)*(t.y-a.y)/(o.y-a.y)+a.x&&(n=!n)}return n}function go(e,t,n,i,a){var o,s=f(e);try{for(s.s();!(o=s.n()).done;){var l=o.value;if(t<=l.x&&n<=l.y&&i>=l.x&&a>=l.y)return!0}}catch(p){s.e(p)}finally{s.f()}var u=[new r(t,n),new r(t,a),new r(i,a),new r(i,n)];if(e.length>2){var c,h=f(u);try{for(h.s();!(c=h.n()).done;)if(yo(e,c.value))return!0}catch(p){h.e(p)}finally{h.f()}}for(var d=0;d<e.length-1;d++)if(_o(e[d],e[d+1],u))return!0;return!1}function _o(e,t,n){var r=n[0],i=n[2];if(e.x<r.x&&t.x<r.x||e.x>i.x&&t.x>i.x||e.y<r.y&&t.y<r.y||e.y>i.y&&t.y>i.y)return!1;var a=H(e,t,n[0]);return a!==H(e,t,n[1])||a!==H(e,t,n[2])||a!==H(e,t,n[3])}function bo(e,t,n){var r=t.paint.get(e).value;return"constant"===r.kind?r.value:n.programConfigurations.get(t.id).getMaxValue(e)}function xo(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function wo(e,t,n,i,a){if(!t[0]&&!t[1])return e;var o=r.convert(t)._mult(a);"viewport"===n&&o._rotate(-i);for(var s=[],l=0;l<e.length;l++)s.push(e[l].sub(o));return s}function Eo(e,t,n,i){var a=r.convert(e)._mult(i);return"viewport"===t&&a._rotate(-n),a}ai("CircleBucket",oo,{omit:["layers"]});var So=new Gi({"circle-sort-key":new Ui(Ke.layout_circle["circle-sort-key"])}),To={paint:new Gi({"circle-radius":new Ui(Ke.paint_circle["circle-radius"]),"circle-color":new Ui(Ke.paint_circle["circle-color"]),"circle-blur":new Ui(Ke.paint_circle["circle-blur"]),"circle-opacity":new Ui(Ke.paint_circle["circle-opacity"]),"circle-translate":new Bi(Ke.paint_circle["circle-translate"]),"circle-translate-anchor":new Bi(Ke.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Bi(Ke.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Bi(Ke.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ui(Ke.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ui(Ke.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ui(Ke.paint_circle["circle-stroke-opacity"])}),layout:So},ko="undefined"!=typeof Float32Array?Float32Array:Array;function Mo(){var e=new ko(9);return ko!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Co(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ao(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],f=t[9],d=t[10],p=t[11],m=t[12],v=t[13],y=t[14],g=t[15],_=n[0],b=n[1],x=n[2],w=n[3];return e[0]=_*r+b*s+x*h+w*m,e[1]=_*i+b*l+x*f+w*v,e[2]=_*a+b*u+x*d+w*y,e[3]=_*o+b*c+x*p+w*g,e[4]=(_=n[4])*r+(b=n[5])*s+(x=n[6])*h+(w=n[7])*m,e[5]=_*i+b*l+x*f+w*v,e[6]=_*a+b*u+x*d+w*y,e[7]=_*o+b*c+x*p+w*g,e[8]=(_=n[8])*r+(b=n[9])*s+(x=n[10])*h+(w=n[11])*m,e[9]=_*i+b*l+x*f+w*v,e[10]=_*a+b*u+x*d+w*y,e[11]=_*o+b*c+x*p+w*g,e[12]=(_=n[12])*r+(b=n[13])*s+(x=n[14])*h+(w=n[15])*m,e[13]=_*i+b*l+x*f+w*v,e[14]=_*a+b*u+x*d+w*y,e[15]=_*o+b*c+x*p+w*g,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var Io=Ao;function Po(){var e=new ko(3);return ko!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function Ro(e){var t=new ko(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Lo(e){return Math.hypot(e[0],e[1],e[2])}function Oo(e,t,n){var r=new ko(3);return r[0]=e,r[1]=t,r[2]=n,r}function Do(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function No(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function zo(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function Fo(e,t,n,r){return e[0]=t[0]+n[0]*r,e[1]=t[1]+n[1]*r,e[2]=t[2]+n[2]*r,e}function Bo(e,t){var n=t[0],r=t[1],i=t[2],a=n*n+r*r+i*i;return a>0&&(a=1/Math.sqrt(a)),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a,e}function Uo(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function jo(e,t,n){var r=t[0],i=t[1],a=t[2],o=n[0],s=n[1],l=n[2];return e[0]=i*l-a*s,e[1]=a*o-r*l,e[2]=r*s-i*o,e}function Vo(e,t,n){var r=n[0],i=n[1],a=n[2],o=t[0],s=t[1],l=t[2],u=i*l-a*s,c=a*o-r*l,h=r*s-i*o,f=i*h-a*c,d=a*u-r*h,p=r*c-i*u,m=2*n[3];return c*=m,h*=m,d*=2,p*=2,e[0]=o+(u*=m)+(f*=2),e[1]=s+c+d,e[2]=l+h+p,e}var Ho,Go=No,Wo=Lo;function qo(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3];return e[0]=n[0]*r+n[4]*i+n[8]*a+n[12]*o,e[1]=n[1]*r+n[5]*i+n[9]*a+n[13]*o,e[2]=n[2]*r+n[6]*i+n[10]*a+n[14]*o,e[3]=n[3]*r+n[7]*i+n[11]*a+n[15]*o,e}function Xo(){var e=new ko(4);return ko!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function Zo(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function Ko(e,t,n){n*=.5;var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=r*l+o*s,e[1]=i*l+a*s,e[2]=a*l-i*s,e[3]=o*l-r*s,e}Po(),Ho=new ko(4),ko!=Float32Array&&(Ho[0]=0,Ho[1]=0,Ho[2]=0,Ho[3]=0),Po(),Oo(1,0,0),Oo(0,1,0),Xo(),Xo(),Mo();var Yo=function(){function e(t,n){v(this,e),this.points=t,this.planes=n}return y(e,null,[{key:"fromInvProjectionMatrix",value:function(t,n,r){var i=Math.pow(2,r),a=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((function(e){var r=qo([],e,t),a=1/r[3]/n*i;return function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e[3]=t[3]*n[3],e}(r,r,[a,a,1/r[3],a])})),o=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((function(e){var t=Bo([],jo([],Go([],a[e[0]],a[e[1]]),Go([],a[e[2]],a[e[1]]))),n=-Uo(t,a[e[1]]);return t.concat(n)}));return new e(a,o)}}]),e}(),Jo=function(){function e(t,n){v(this,e),this.min=t,this.max=n,this.center=zo([],Do([],this.min,this.max),.5)}return y(e,[{key:"quadrant",value:function(t){for(var n=[t%2==0,t<2],r=Ro(this.min),i=Ro(this.max),a=0;a<n.length;a++)r[a]=n[a]?this.min[a]:this.center[a],i[a]=n[a]?this.center[a]:this.max[a];return i[2]=this.max[2],new e(r,i)}},{key:"distanceX",value:function(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}},{key:"distanceY",value:function(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}},{key:"distanceZ",value:function(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}},{key:"intersects",value:function(e){for(var t,n,r=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]],i=!0,a=0;a<e.planes.length;a++){for(var o=e.planes[a],s=0,l=0;l<r.length;l++)s+=(t=o)[0]*(n=r[l])[0]+t[1]*n[1]+t[2]*n[2]+t[3]*n[3]>=0;if(0===s)return 0;s!==r.length&&(i=!1)}if(i)return 2;for(var u=0;u<3;u++){for(var c=Number.MAX_VALUE,h=-Number.MAX_VALUE,f=0;f<e.points.length;f++){var d=e.points[f][u]-this.min[u];c=Math.min(c,d),h=Math.max(h,d)}if(h<0||c>this.max[u]-this.min[u])return 0}return 1}}]),e}();function Qo(e,t,n){var i=qo([],[e.x,e.y,t,1],n);return new r(i[0]/i[3],i[1]/i[3])}var $o=Oo(0,0,0),es=Oo(0,0,1);function ts(e,t){var n=Po();return $o[2]=t,e.intersectsPlane($o,es,n),new r(n[0],n[1])}var ns=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return n}(oo);function rs(e,t,n,r){var i=t.width,a=t.height;if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==i*a*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(i*a*n);return e.width=i,e.height=a,e.data=r,e}function is(e,t,n){var r=t.width,i=t.height;if(r!==e.width||i!==e.height){var a=rs({},{width:r,height:i},n);as(e,a,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,r),height:Math.min(e.height,i)},n),e.width=r,e.height=i,e.data=a.data}}function as(e,t,n,r,i,a){if(0===i.width||0===i.height)return t;if(i.width>e.width||i.height>e.height||n.x>e.width-i.width||n.y>e.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>t.width||i.height>t.height||r.x>t.width-i.width||r.y>t.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var o=e.data,s=t.data,l=0;l<i.height;l++)for(var u=((n.y+l)*e.width+n.x)*a,c=((r.y+l)*t.width+r.x)*a,h=0;h<i.width*a;h++)s[c+h]=o[u+h];return t}ai("HeatmapBucket",ns,{omit:["layers"]});var os=function(){function e(t,n){v(this,e),rs(this,t,1,n)}return y(e,[{key:"resize",value:function(e){is(this,e,1)}},{key:"clone",value:function(){return new e({width:this.width,height:this.height},new Uint8Array(this.data))}}],[{key:"copy",value:function(e,t,n,r,i){as(e,t,n,r,i,1)}}]),e}(),ss=function(){function e(t,n){v(this,e),rs(this,t,4,n)}return y(e,[{key:"resize",value:function(e){is(this,e,4)}},{key:"replace",value:function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}},{key:"clone",value:function(){return new e({width:this.width,height:this.height},new Uint8Array(this.data))}}],[{key:"copy",value:function(e,t,n,r,i){as(e,t,n,r,i,4)}}]),e}();ai("AlphaImage",os),ai("RGBAImage",ss);var ls={paint:new Gi({"heatmap-radius":new Ui(Ke.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ui(Ke.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Bi(Ke.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Hi(Ke.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Bi(Ke.paint_heatmap["heatmap-opacity"])})};function us(e){var t={},n=e.resolution||256,r=e.clips?e.clips.length:1,i=e.image||new ss({width:n,height:r}),a=function(n,r,a){t[e.evaluationKey]=a;var o=e.expression.evaluate(t);i.data[n+r+0]=Math.floor(255*o.r/o.a),i.data[n+r+1]=Math.floor(255*o.g/o.a),i.data[n+r+2]=Math.floor(255*o.b/o.a),i.data[n+r+3]=Math.floor(255*o.a)};if(e.clips)for(var o=0,s=0;o<r;++o,s+=4*n)for(var l=0,u=0;l<n;l++,u+=4){var c=l/(n-1),h=e.clips[o];a(s,u,h.start*(1-c)+h.end*c)}else for(var f=0,d=0;f<n;f++,d+=4)a(0,d,f/(n-1));return i}var cs={paint:new Gi({"hillshade-illumination-direction":new Bi(Ke.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Bi(Ke.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Bi(Ke.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Bi(Ke.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Bi(Ke.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Bi(Ke.paint_hillshade["hillshade-accent-color"])})},hs=Ki([{name:"a_pos",components:2,type:"Int16"}],4).members,fs=ps,ds=ps;function ps(e,t,n){n=n||2;var r,i,a,o,s,l,u,c=t&&t.length,h=c?t[0]*n:e.length,f=ms(e,0,h,n,!0),d=[];if(!f||f.next===f.prev)return d;if(c&&(f=function(e,t,n,r){var i,a,o,s=[];for(i=0,a=t.length;i<a;i++)(o=ms(e,t[i]*r,i<a-1?t[i+1]*r:e.length,r,!1))===o.next&&(o.steiner=!0),s.push(ks(o));for(s.sort(ws),i=0;i<s.length;i++)Es(s[i],n),n=vs(n,n.next);return n}(e,t,f,n)),e.length>80*n){r=a=e[0],i=o=e[1];for(var p=n;p<h;p+=n)(s=e[p])<r&&(r=s),(l=e[p+1])<i&&(i=l),s>a&&(a=s),l>o&&(o=l);u=0!==(u=Math.max(a-r,o-i))?1/u:0}return ys(f,d,n,r,i,u),d}function ms(e,t,n,r,i){var a,o;if(i===Bs(e,t,n,r)>0)for(a=t;a<n;a+=r)o=Ns(a,e[a],e[a+1],o);else for(a=n-r;a>=t;a-=r)o=Ns(a,e[a],e[a+1],o);return o&&Is(o,o.next)&&(zs(o),o=o.next),o}function vs(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!Is(r,r.next)&&0!==As(r.prev,r,r.next))r=r.next;else{if(zs(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function ys(e,t,n,r,i,a,o){if(e){!o&&a&&function(e,t,n,r){var i=e;do{null===i.z&&(i.z=Ts(i.x,i.y,t,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var t,n,r,i,a,o,s,l,u=1;do{for(n=e,e=null,a=null,o=0;n;){for(o++,r=n,s=0,t=0;t<u&&(s++,r=r.nextZ);t++);for(l=u;s>0||l>0&&r;)0!==s&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,l--),a?a.nextZ=i:e=i,i.prevZ=a,a=i;n=r}a.nextZ=null,u*=2}while(o>1)}(i)}(e,r,i,a);for(var s,l,u=e;e.prev!==e.next;)if(s=e.prev,l=e.next,a?_s(e,r,i,a):gs(e))t.push(s.i/n),t.push(e.i/n),t.push(l.i/n),zs(e),e=l.next,u=l.next;else if((e=l)===u){o?1===o?ys(e=bs(vs(e),t,n),t,n,r,i,a,2):2===o&&xs(e,t,n,r,i,a):ys(vs(e),t,n,r,i,a,1);break}}}function gs(e){var t=e.prev,n=e,r=e.next;if(As(t,n,r)>=0)return!1;for(var i=e.next.next;i!==e.prev;){if(Ms(t.x,t.y,n.x,n.y,r.x,r.y,i.x,i.y)&&As(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function _s(e,t,n,r){var i=e.prev,a=e,o=e.next;if(As(i,a,o)>=0)return!1;for(var s=i.x>a.x?i.x>o.x?i.x:o.x:a.x>o.x?a.x:o.x,l=i.y>a.y?i.y>o.y?i.y:o.y:a.y>o.y?a.y:o.y,u=Ts(i.x<a.x?i.x<o.x?i.x:o.x:a.x<o.x?a.x:o.x,i.y<a.y?i.y<o.y?i.y:o.y:a.y<o.y?a.y:o.y,t,n,r),c=Ts(s,l,t,n,r),h=e.prevZ,f=e.nextZ;h&&h.z>=u&&f&&f.z<=c;){if(h!==e.prev&&h!==e.next&&Ms(i.x,i.y,a.x,a.y,o.x,o.y,h.x,h.y)&&As(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,f!==e.prev&&f!==e.next&&Ms(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&As(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;h&&h.z>=u;){if(h!==e.prev&&h!==e.next&&Ms(i.x,i.y,a.x,a.y,o.x,o.y,h.x,h.y)&&As(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;f&&f.z<=c;){if(f!==e.prev&&f!==e.next&&Ms(i.x,i.y,a.x,a.y,o.x,o.y,f.x,f.y)&&As(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function bs(e,t,n){var r=e;do{var i=r.prev,a=r.next.next;!Is(i,a)&&Ps(i,r,r.next,a)&&Os(i,a)&&Os(a,i)&&(t.push(i.i/n),t.push(r.i/n),t.push(a.i/n),zs(r),zs(r.next),r=e=a),r=r.next}while(r!==e);return vs(r)}function xs(e,t,n,r,i,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&Cs(o,s)){var l=Ds(o,s);return o=vs(o,o.next),l=vs(l,l.next),ys(o,t,n,r,i,a),void ys(l,t,n,r,i,a)}s=s.next}o=o.next}while(o!==e)}function ws(e,t){return e.x-t.x}function Es(e,t){if(t=function(e,t){var n,r=t,i=e.x,a=e.y,o=-1/0;do{if(a<=r.y&&a>=r.next.y&&r.next.y!==r.y){var s=r.x+(a-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>o){if(o=s,s===i){if(a===r.y)return r;if(a===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(i===o)return n;var l,u=n,c=n.x,h=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=c&&i!==r.x&&Ms(a<h?i:o,a,c,h,a<h?o:i,a,r.x,r.y)&&(l=Math.abs(a-r.y)/(i-r.x),Os(r,e)&&(l<f||l===f&&(r.x>n.x||r.x===n.x&&Ss(n,r)))&&(n=r,f=l)),r=r.next}while(r!==u);return n}(e,t)){var n=Ds(t,e);vs(t,t.next),vs(n,n.next)}}function Ss(e,t){return As(e.prev,e,t.prev)<0&&As(t.next,e,e.next)<0}function Ts(e,t,n,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*i)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*i)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function ks(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function Ms(e,t,n,r,i,a,o,s){return(i-o)*(t-s)-(e-o)*(a-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(a-s)-(i-o)*(r-s)>=0}function Cs(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&Ps(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(Os(e,t)&&Os(t,e)&&function(e,t){var n=e,r=!1,i=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&i<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(As(e.prev,e,t.prev)||As(e,t.prev,t))||Is(e,t)&&As(e.prev,e,e.next)>0&&As(t.prev,t,t.next)>0)}function As(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function Is(e,t){return e.x===t.x&&e.y===t.y}function Ps(e,t,n,r){var i=Ls(As(e,t,n)),a=Ls(As(e,t,r)),o=Ls(As(n,r,e)),s=Ls(As(n,r,t));return i!==a&&o!==s||!(0!==i||!Rs(e,n,t))||!(0!==a||!Rs(e,r,t))||!(0!==o||!Rs(n,e,r))||!(0!==s||!Rs(n,t,r))}function Rs(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function Ls(e){return e>0?1:e<0?-1:0}function Os(e,t){return As(e.prev,e,e.next)<0?As(e,t,e.next)>=0&&As(e,e.prev,t)>=0:As(e,t,e.prev)<0||As(e,e.next,t)<0}function Ds(e,t){var n=new Fs(e.i,e.x,e.y),r=new Fs(t.i,t.x,t.y),i=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=i,i.prev=n,r.next=n,n.prev=r,a.next=r,r.prev=a,r}function Ns(e,t,n,r){var i=new Fs(e,t,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function zs(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Fs(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Bs(e,t,n,r){for(var i=0,a=t,o=n-r;a<n;a+=r)i+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return i}function Us(e,t,n,r,i){!function e(t,n,r,i,a){for(;i>r;){if(i-r>600){var o=i-r+1,s=n-r+1,l=Math.log(o),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(o-u)/o)*(s-o/2<0?-1:1);e(t,n,Math.max(r,Math.floor(n-s*u/o+c)),Math.min(i,Math.floor(n+(o-s)*u/o+c)),a)}var h=t[n],f=r,d=i;for(js(t,r,n),a(t[i],h)>0&&js(t,r,i);f<d;){for(js(t,f,d),f++,d--;a(t[f],h)<0;)f++;for(;a(t[d],h)>0;)d--}0===a(t[r],h)?js(t,r,d):js(t,++d,i),d<=n&&(r=d+1),n<=d&&(i=d-1)}}(e,t,n||0,r||e.length-1,i||Vs)}function js(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function Vs(e,t){return e<t?-1:e>t?1:0}function Hs(e,t){var n=e.length;if(n<=1)return[e];for(var r,i,a=[],o=0;o<n;o++){var s=G(e[o]);0!==s&&(e[o].area=Math.abs(s),void 0===i&&(i=s<0),i===s<0?(r&&a.push(r),r=[e[o]]):r.push(e[o]))}if(r&&a.push(r),t>1)for(var l=0;l<a.length;l++)a[l].length<=t||(Us(a[l],t,1,a[l].length-1,Gs),a[l]=a[l].slice(0,t));return a}function Gs(e,t){return t.area-e.area}function Ws(e,t,n){var r,i=n.patternDependencies,a=!1,o=f(t);try{for(o.s();!(r=o.n()).done;){var s=r.value.paint.get("".concat(e,"-pattern"));s.isConstant()||(a=!0);var l=s.constantOr(null);l&&(a=!0,i[l.to]=!0,i[l.from]=!0)}}catch(u){o.e(u)}finally{o.f()}return a}function qs(e,t,n,r,i){var a,o=i.patternDependencies,s=f(t);try{for(s.s();!(a=s.n()).done;){var l=a.value,u=l.paint.get("".concat(e,"-pattern")).value;if("constant"!==u.kind){var c=u.evaluate({zoom:r-1},n,{},i.availableImages),h=u.evaluate({zoom:r},n,{},i.availableImages),d=u.evaluate({zoom:r+1},n,{},i.availableImages);c=c&&c.name?c.name:c,h=h&&h.name?h.name:h,d=d&&d.name?d.name:d,o[c]=!0,o[h]=!0,o[d]=!0,n.patterns[l.id]={min:c,mid:h,max:d}}}}catch(p){s.e(p)}finally{s.f()}return n}ps.deviation=function(e,t,n,r){var i=t&&t.length,a=Math.abs(Bs(e,0,i?t[0]*n:e.length,n));if(i)for(var o=0,s=t.length;o<s;o++)a-=Math.abs(Bs(e,t[o]*n,o<s-1?t[o+1]*n:e.length,n));var l=0;for(o=0;o<r.length;o+=3){var u=r[o]*n,c=r[o+1]*n,h=r[o+2]*n;l+=Math.abs((e[u]-e[h])*(e[c+1]-e[u+1])-(e[u]-e[c])*(e[h+1]-e[u+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},ps.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},r=0,i=0;i<e.length;i++){for(var a=0;a<e[i].length;a++)for(var o=0;o<t;o++)n.vertices.push(e[i][a][o]);i>0&&n.holes.push(r+=e[i-1].length)}return n},fs.default=ds;var Xs=function(){function e(t){v(this,e),this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ji,this.indexArray=new ua,this.indexArray2=new ma,this.programConfigurations=new Ka(t.layers,t.zoom),this.segments=new eo,this.segments2=new eo,this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id}))}return y(e,[{key:"populate",value:function(e,t,n){this.hasPattern=Ws("fill",this.layers,t);var r,i=this.layers[0].layout.get("fill-sort-key"),a=[],o=f(e);try{for(o.s();!(r=o.n()).done;){var s=r.value,l=s.feature,u=s.id,c=s.index,h=s.sourceLayerIndex,d=this.layers[0]._featureFilter.needGeometry,p=io(l,d);if(this.layers[0]._featureFilter.filter(new Ii(this.zoom),p,n)){var m=i?i.evaluate(p,{},n,t.availableImages):void 0,v={id:u,properties:l.properties,type:l.type,sourceLayerIndex:h,index:c,geometry:d?p.geometry:ro(l),patterns:{},sortKey:m};a.push(v)}}}catch(S){o.e(S)}finally{o.f()}i&&a.sort((function(e,t){return e.sortKey-t.sortKey}));for(var y=0,g=a;y<g.length;y++){var _=g[y],b=_.geometry,x=_.index,w=_.sourceLayerIndex;if(this.hasPattern){var E=qs("fill",this.layers,_,this.zoom,t);this.patternFeatures.push(E)}else this.addFeature(_,b,x,n,{});t.featureIndex.insert(e[x].feature,b,x,w,this.index)}}},{key:"update",value:function(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}},{key:"addFeatures",value:function(e,t,n){var r,i=f(this.patternFeatures);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.addFeature(a,a.geometry,a.index,t,n)}}catch(o){i.e(o)}finally{i.f()}}},{key:"isEmpty",value:function(){return 0===this.layoutVertexArray.length}},{key:"uploadPending",value:function(){return!this.uploaded||this.programConfigurations.needsUpload}},{key:"upload",value:function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hs),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}},{key:"destroy",value:function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}},{key:"addFeature",value:function(e,t,n,r,i){var a,o=f(Hs(t,500));try{for(o.s();!(a=o.n()).done;){var s,l=a.value,u=0,c=f(l);try{for(c.s();!(s=c.n()).done;)u+=s.value.length}catch(S){c.e(S)}finally{c.f()}var h,d=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray),p=d.vertexLength,m=[],v=[],y=f(l);try{for(y.s();!(h=y.n()).done;){var g=h.value;if(0!==g.length){g!==l[0]&&v.push(m.length/2);var _=this.segments2.prepareSegment(g.length,this.layoutVertexArray,this.indexArray2),b=_.vertexLength;this.layoutVertexArray.emplaceBack(g[0].x,g[0].y),this.indexArray2.emplaceBack(b+g.length-1,b),m.push(g[0].x),m.push(g[0].y);for(var x=1;x<g.length;x++)this.layoutVertexArray.emplaceBack(g[x].x,g[x].y),this.indexArray2.emplaceBack(b+x-1,b+x),m.push(g[x].x),m.push(g[x].y);_.vertexLength+=g.length,_.primitiveLength+=g.length}}}catch(S){y.e(S)}finally{y.f()}for(var w=fs(m,v),E=0;E<w.length;E+=3)this.indexArray.emplaceBack(p+w[E],p+w[E+1],p+w[E+2]);d.vertexLength+=u,d.primitiveLength+=w.length/3}}catch(S){o.e(S)}finally{o.f()}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,i,r)}}]),e}();ai("FillBucket",Xs,{omit:["layers","patternFeatures"]});var Zs=new Gi({"fill-sort-key":new Ui(Ke.layout_fill["fill-sort-key"])}),Ks={paint:new Gi({"fill-antialias":new Bi(Ke.paint_fill["fill-antialias"]),"fill-opacity":new Ui(Ke.paint_fill["fill-opacity"]),"fill-color":new Ui(Ke.paint_fill["fill-color"]),"fill-outline-color":new Ui(Ke.paint_fill["fill-outline-color"]),"fill-translate":new Bi(Ke.paint_fill["fill-translate"]),"fill-translate-anchor":new Bi(Ke.paint_fill["fill-translate-anchor"]),"fill-pattern":new ji(Ke.paint_fill["fill-pattern"])}),layout:Zs},Ys=Ki([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Js=Ki([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Qs=Ys.members,$s=el;function el(e,t,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=e,this._geometry=-1,this._keys=r,this._values=i,e.readFields(tl,this,t)}function tl(e,t,n){1==e?t.id=n.readVarint():2==e?function(e,t){for(var n=e.readVarint()+e.pos;e.pos<n;){var r=t._keys[e.readVarint()],i=t._values[e.readVarint()];t.properties[r]=i}}(n,t):3==e?t.type=n.readVarint():4==e&&(t._geometry=n.pos)}function nl(e){for(var t,n,r=0,i=0,a=e.length,o=a-1;i<a;o=i++)r+=((n=e[o]).x-(t=e[i]).x)*(t.y+n.y);return r}el.types=["Unknown","Point","LineString","Polygon"],el.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,n=e.readVarint()+e.pos,i=1,a=0,o=0,s=0,l=[];e.pos<n;){if(a<=0){var u=e.readVarint();i=7&u,a=u>>3}if(a--,1===i||2===i)o+=e.readSVarint(),s+=e.readSVarint(),1===i&&(t&&l.push(t),t=[]),t.push(new r(o,s));else{if(7!==i)throw new Error("unknown command "+i);t&&t.push(t[0].clone())}}return t&&l.push(t),l},el.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,n=1,r=0,i=0,a=0,o=1/0,s=-1/0,l=1/0,u=-1/0;e.pos<t;){if(r<=0){var c=e.readVarint();n=7&c,r=c>>3}if(r--,1===n||2===n)(i+=e.readSVarint())<o&&(o=i),i>s&&(s=i),(a+=e.readSVarint())<l&&(l=a),a>u&&(u=a);else if(7!==n)throw new Error("unknown command "+n)}return[o,l,s,u]},el.prototype.toGeoJSON=function(e,t,n){var r,i,a=this.extent*Math.pow(2,n),o=this.extent*e,s=this.extent*t,l=this.loadGeometry(),u=el.types[this.type];function c(e){for(var t=0;t<e.length;t++){var n=e[t];e[t]=[360*(n.x+o)/a-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+s)/a)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<l.length;r++)h[r]=l[r][0];c(l=h);break;case 2:for(r=0;r<l.length;r++)c(l[r]);break;case 3:for(l=function(e){var t=e.length;if(t<=1)return[e];for(var n,r,i=[],a=0;a<t;a++){var o=nl(e[a]);0!==o&&(void 0===r&&(r=o<0),r===o<0?(n&&i.push(n),n=[e[a]]):n.push(e[a]))}return n&&i.push(n),i}(l),r=0;r<l.length;r++)for(i=0;i<l[r].length;i++)c(l[r][i])}1===l.length?l=l[0]:u="Multi"+u;var f={type:"Feature",geometry:{type:u,coordinates:l},properties:this.properties};return"id"in this&&(f.id=this.id),f};var rl=il;function il(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(al,this,t),this.length=this._features.length}function al(e,t,n){15===e?t.version=n.readVarint():1===e?t.name=n.readString():5===e?t.extent=n.readVarint():2===e?t._features.push(n.pos):3===e?t._keys.push(n.readString()):4===e&&t._values.push(function(e){for(var t=null,n=e.readVarint()+e.pos;e.pos<n;){var r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}return t}(n))}function ol(e,t,n){if(3===e){var r=new rl(n,n.readVarint()+n.pos);r.length&&(t[r.name]=r)}}il.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new $s(this._pbf,t,this.extent,this._keys,this._values)};var sl={VectorTile:function(e,t){this.layers=e.readFields(ol,{},t)},VectorTileFeature:$s,VectorTileLayer:rl},ll=sl.VectorTileFeature.types,ul=Math.pow(2,13);function cl(e,t,n,r,i,a,o,s){e.emplaceBack((t<<1)+o,(n<<1)+a,(Math.floor(r*ul)<<1)+i,Math.round(s))}var hl=function(){function e(){v(this,e),this.acc=new r(0,0),this.polyCount=[]}return y(e,[{key:"startRing",value:function(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new r(e.x,e.y),this.max=new r(e.x,e.y))}},{key:"append",value:function(e,t){this.currentPolyCount.edges++,this.acc._add(e);var n=!!this.borders,r=this.min,i=this.max;e.x<r.x?(r.x=e.x,n=!0):e.x>i.x&&(i.x=e.x,n=!0),e.y<r.y?(r.y=e.y,n=!0):e.y>i.y&&(i.y=e.y,n=!0),((0===e.x||8192===e.x)&&e.x===t.x)!=((0===e.y||8192===e.y)&&e.y===t.y)&&this.processBorderOverlap(e,t),n&&this.checkBorderIntersection(e,t)}},{key:"checkBorderIntersection",value:function(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,fn(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>8192!=e.x>8192&&this.addBorderIntersection(1,fn(t.y,e.y,(8192-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,fn(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>8192!=e.y>8192&&this.addBorderIntersection(3,fn(t.x,e.x,(8192-t.y)/(e.y-t.y)))}},{key:"addBorderIntersection",value:function(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);var n=this.borders[e];t<n[0]&&(n[0]=t),t>n[1]&&(n[1]=t)}},{key:"processBorderOverlap",value:function(e,t){if(e.x===t.x){if(e.y===t.y)return;var n=0===e.x?0:1;this.addBorderIntersection(n,t.y),this.addBorderIntersection(n,e.y)}else{var r=0===e.y?2:3;this.addBorderIntersection(r,t.x),this.addBorderIntersection(r,e.x)}}},{key:"centroid",value:function(){var e=this.polyCount.reduce((function(e,t){return e+t.edges}),0);return 0!==e?this.acc.div(e)._round():new r(0,0)}},{key:"span",value:function(){return new r(this.max.x-this.min.x,this.max.y-this.min.y)}},{key:"intersectsCount",value:function(){return this.borders.reduce((function(e,t){return e+ +(t[0]!==Number.MAX_VALUE)}),0)}}]),e}(),fl=function(){function e(t){v(this,e),this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Qi,this.centroidVertexArray=new ma,this.indexArray=new ua,this.programConfigurations=new Ka(t.layers,t.zoom),this.segments=new eo,this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id})),this.enableTerrain=t.enableTerrain}return y(e,[{key:"populate",value:function(e,t,n){this.features=[],this.hasPattern=Ws("fill-extrusion",this.layers,t),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDone=[!1,!1,!1,!1],this.tileToMeter=function(e){var t=Math.exp(Math.PI*(1-e.y/(1<<e.z)*2));return 80150034*t/(t*t+1)/8192/(1<<e.z)}(n);var r,i=f(e);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=a.feature,s=a.id,l=a.index,u=a.sourceLayerIndex,c=this.layers[0]._featureFilter.needGeometry,h=io(o,c);if(this.layers[0]._featureFilter.filter(new Ii(this.zoom),h,n)){var d={id:s,sourceLayerIndex:u,index:l,geometry:c?h.geometry:ro(o),properties:o.properties,type:o.type,patterns:{}};this.hasPattern?this.features.push(qs("fill-extrusion",this.layers,d,this.zoom,t)):this.addFeature(d,d.geometry,l,n,{}),t.featureIndex.insert(o,d.geometry,l,u,this.index)}}}catch(p){i.e(p)}finally{i.f()}this.sortBorders()}},{key:"addFeatures",value:function(e,t,n){var r,i=f(this.features);try{for(i.s();!(r=i.n()).done;){var a=r.value,o=a.geometry;this.addFeature(a,o,a.index,t,n)}}catch(s){i.e(s)}finally{i.f()}this.sortBorders()}},{key:"update",value:function(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}},{key:"isEmpty",value:function(){return 0===this.layoutVertexArray.length}},{key:"uploadPending",value:function(){return!this.uploaded||this.programConfigurations.needsUpload}},{key:"upload",value:function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Qs),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}},{key:"uploadCentroid",value:function(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Js.members,!0),this.needsCentroidUpdate=!1)}},{key:"destroy",value:function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}},{key:"addFeature",value:function(e,t,n,r,i){var a,o,s=this.enableTerrain&&e.properties&&e.properties.hasOwnProperty("type")&&e.properties.hasOwnProperty("height")&&"Polygon"===ll[e.type]?new hl:null,l=f(Hs(t,500));try{for(l.s();!(a=l.n()).done;){var u=a.value,c=0,h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);if(!(0===u.length||(o=u[0]).every((function(e){return e.x<=0}))||o.every((function(e){return e.x>=8192}))||o.every((function(e){return e.y<=0}))||o.every((function(e){return e.y>=8192})))){for(var d=0;d<u.length;d++){var p=u[d];if(0!==p.length){c+=p.length;var m=0;s&&s.startRing(p[0]);for(var v=0;v<p.length;v++){var y=p[v];if(v>=1){var g=p[v-1];if(!dl(y,g)){s&&s.append(y,g),h.vertexLength+4>eo.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var _=y.sub(g)._perp(),b=_.x/(Math.abs(_.x)+Math.abs(_.y)),x=_.y>0?1:0,w=g.dist(y);m+w>32768&&(m=0),cl(this.layoutVertexArray,y.x,y.y,b,x,0,0,m),cl(this.layoutVertexArray,y.x,y.y,b,x,0,1,m),m+=w,cl(this.layoutVertexArray,g.x,g.y,b,x,0,0,m),cl(this.layoutVertexArray,g.x,g.y,b,x,0,1,m);var E=h.vertexLength;this.indexArray.emplaceBack(E,E+2,E+1),this.indexArray.emplaceBack(E+1,E+2,E+3),h.vertexLength+=4,h.primitiveLength+=2}}}}}if(h.vertexLength+c>eo.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(c,this.layoutVertexArray,this.indexArray)),"Polygon"===ll[e.type]){for(var S=[],T=[],k=h.vertexLength,M=0;M<u.length;M++){var C=u[M];if(0!==C.length){C!==u[0]&&T.push(S.length/2);for(var A=0;A<C.length;A++){var I=C[A];cl(this.layoutVertexArray,I.x,I.y,0,0,1,1,0),S.push(I.x),S.push(I.y),s&&s.currentPolyCount.top++}}}for(var P=fs(S,T),R=0;R<P.length;R+=3)this.indexArray.emplaceBack(k+P[R],k+P[R+2],k+P[R+1]);h.primitiveLength+=P.length/3,h.vertexLength+=c}}}}catch(N){l.e(N)}finally{l.f()}if(s&&s.polyCount.length>0){if(s.borders){s.vertexArrayOffset=this.centroidVertexArray.length;for(var L=s.borders,O=this.featuresOnBorder.push(s)-1,D=0;D<4;D++)L[D][0]!==Number.MAX_VALUE&&this.borders[D].push(O)}this.encodeCentroid(s.borders?void 0:s.centroid(),s)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,i,r)}},{key:"sortBorders",value:function(){for(var e=this,t=function(t){e.borders[t].sort((function(n,r){return e.featuresOnBorder[n].borders[t][0]-e.featuresOnBorder[r].borders[t][0]}))},n=0;n<4;n++)t(n)}},{key:"encodeCentroid",value:function(e,t){var n,r,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(e)if(0!==e.y){var a=t.span()._mult(this.tileToMeter);n=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(a.x/10)),r=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(a.y/10))}else n=Math.ceil(7.3*e.x),r=0;else n=0,r=+i;var o,s=i?this.centroidVertexArray.length:t.vertexArrayOffset,l=f(t.polyCount);try{for(l.s();!(o=l.n()).done;){var u=o.value;i&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*u.edges+u.top);for(var c=0;c<2*u.edges;c++)this.centroidVertexArray.emplace(s++,0,r),this.centroidVertexArray.emplace(s++,n,r);for(var h=0;h<u.top;h++)this.centroidVertexArray.emplace(s++,n,r)}}catch(d){l.e(d)}finally{l.f()}}}]),e}();function dl(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}ai("FillExtrusionBucket",fl,{omit:["layers","features"]}),ai("PartMetadata",hl);var pl={paint:new Gi({"fill-extrusion-opacity":new Bi(Ke["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ui(Ke["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Bi(Ke["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Bi(Ke["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ji(Ke["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Ui(Ke["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ui(Ke["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Bi(Ke["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function ml(e,t){return e.x*t.x+e.y*t.y}function vl(e,t){if(1===e.length){for(var n,r=0,i=t[r++];!n||i.equals(n);)if(!(n=t[r++]))return 1/0;for(;r<t.length;r++){var a=t[r],o=e[0],s=n.sub(i),l=a.sub(i),u=o.sub(i),c=ml(s,s),h=ml(s,l),d=ml(l,l),p=ml(u,s),m=ml(u,l),v=c*d-h*h,y=(d*p-h*m)/v,g=(c*m-h*p)/v,_=i.z*(1-y-g)+n.z*y+a.z*g;if(isFinite(_))return _}return 1/0}var b,x=1/0,w=f(t);try{for(w.s();!(b=w.n()).done;){var E=b.value;x=Math.min(x,E.z)}}catch(S){w.e(S)}finally{w.f()}return x}var yl=Ki([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4).members,gl=Ki([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,_l=sl.VectorTileFeature.types,bl=Math.cos(Math.PI/180*37.5),xl=function(){function e(t){var n=this;v(this,e),this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((function(e){n.gradients[e.id]={}})),this.layoutVertexArray=new $i,this.layoutVertexArray2=new ea,this.indexArray=new ua,this.programConfigurations=new Ka(t.layers,t.zoom),this.segments=new eo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id}))}return y(e,[{key:"populate",value:function(e,t,n){this.hasPattern=Ws("line",this.layers,t);var r,i=this.layers[0].layout.get("line-sort-key"),a=[],o=f(e);try{for(o.s();!(r=o.n()).done;){var s=r.value,l=s.feature,u=s.id,c=s.index,h=s.sourceLayerIndex,d=this.layers[0]._featureFilter.needGeometry,p=io(l,d);if(this.layers[0]._featureFilter.filter(new Ii(this.zoom),p,n)){var m=i?i.evaluate(p,{},n):void 0,v={id:u,properties:l.properties,type:l.type,sourceLayerIndex:h,index:c,geometry:d?p.geometry:ro(l),patterns:{},sortKey:m};a.push(v)}}}catch(S){o.e(S)}finally{o.f()}i&&a.sort((function(e,t){return e.sortKey-t.sortKey}));for(var y=0,g=a;y<g.length;y++){var _=g[y],b=_.geometry,x=_.index,w=_.sourceLayerIndex;if(this.hasPattern){var E=qs("line",this.layers,_,this.zoom,t);this.patternFeatures.push(E)}else this.addFeature(_,b,x,n,{});t.featureIndex.insert(e[x].feature,b,x,w,this.index)}}},{key:"update",value:function(e,t,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,n)}},{key:"addFeatures",value:function(e,t,n){var r,i=f(this.patternFeatures);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.addFeature(a,a.geometry,a.index,t,n)}}catch(o){i.e(o)}finally{i.f()}}},{key:"isEmpty",value:function(){return 0===this.layoutVertexArray.length}},{key:"uploadPending",value:function(){return!this.uploaded||this.programConfigurations.needsUpload}},{key:"upload",value:function(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,gl)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,yl),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}},{key:"destroy",value:function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}},{key:"lineFeatureClips",value:function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}},{key:"addFeature",value:function(e,t,n,r,i){var a=this.layers[0].layout,o=a.get("line-join").evaluate(e,{}),s=a.get("line-cap"),l=a.get("line-miter-limit"),u=a.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);var c,h=f(t);try{for(h.s();!(c=h.n()).done;){var d=c.value;this.addLine(d,e,o,s,l,u)}}catch(p){h.e(p)}finally{h.f()}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,n,i,r)}},{key:"addLine",value:function(e,t,n,r,i,a){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var o=0;o<e.length-1;o++)this.totalDistance+=e[o].dist(e[o+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var s="Polygon"===_l[t.type],l=e.length;l>=2&&e[l-1].equals(e[l-2]);)l--;for(var u=0;u<l-1&&e[u].equals(e[u+1]);)u++;if(!(l<(s?3:2))){"bevel"===n&&(i=1.05);var c,h=this.overscaling<=16?122880/(512*this.overscaling):0,f=this.segments.prepareSegment(10*l,this.layoutVertexArray,this.indexArray),d=void 0,p=void 0,m=void 0,v=void 0;this.e1=this.e2=-1,s&&(c=e[l-2],v=e[u].sub(c)._unit()._perp());for(var y=u;y<l;y++)if(!(p=y===l-1?s?e[u+1]:void 0:e[y+1])||!e[y].equals(p)){v&&(m=v),c&&(d=c),c=e[y],v=p?p.sub(c)._unit()._perp():m;var g=(m=m||v).add(v);0===g.x&&0===g.y||g._unit();var _=m.x*v.x+m.y*v.y,b=g.x*v.x+g.y*v.y,x=0!==b?1/b:1/0,w=2*Math.sqrt(2-2*b),E=b<bl&&d&&p,S=m.x*v.y-m.y*v.x>0;if(E&&y>u){var T=c.dist(d);if(T>2*h){var k=c.sub(c.sub(d)._mult(h/T)._round());this.updateDistance(d,k),this.addCurrentVertex(k,m,0,0,f),d=k}}var M=d&&p,C=M?n:s?"butt":r;if(M&&"round"===C&&(x<a?C="miter":x<=2&&(C="fakeround")),"miter"===C&&x>i&&(C="bevel"),"bevel"===C&&(x>2&&(C="flipbevel"),x<i&&(C="miter")),d&&this.updateDistance(d,c),"miter"===C)g._mult(x),this.addCurrentVertex(c,g,0,0,f);else if("flipbevel"===C){if(x>100)g=v.mult(-1);else{var A=x*m.add(v).mag()/m.sub(v).mag();g._perp()._mult(A*(S?-1:1))}this.addCurrentVertex(c,g,0,0,f),this.addCurrentVertex(c,g.mult(-1),0,0,f)}else if("bevel"===C||"fakeround"===C){var I=-Math.sqrt(x*x-1),P=S?I:0,R=S?0:I;if(d&&this.addCurrentVertex(c,m,P,R,f),"fakeround"===C)for(var L=Math.round(180*w/Math.PI/20),O=1;O<L;O++){var D=O/L;if(.5!==D){var N=D-.5;D+=D*N*(D-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*N*N+(.848013+_*(.215638*_-1.06021)))}var z=v.sub(m)._mult(D)._add(m)._unit()._mult(S?-1:1);this.addHalfVertex(c,z.x,z.y,!1,S,0,f)}p&&this.addCurrentVertex(c,v,-P,-R,f)}else if("butt"===C)this.addCurrentVertex(c,g,0,0,f);else if("square"===C){var F=d?1:-1;this.addCurrentVertex(c,g,F,F,f)}else"round"===C&&(d&&(this.addCurrentVertex(c,m,0,0,f),this.addCurrentVertex(c,m,1,1,f,!0)),p&&(this.addCurrentVertex(c,v,-1,-1,f,!0),this.addCurrentVertex(c,v,0,0,f)));if(E&&y<l-1){var B=c.dist(p);if(B>2*h){var U=c.add(p.sub(c)._mult(h/B)._round());this.updateDistance(c,U),this.addCurrentVertex(U,v,0,0,f),c=U}}}}}},{key:"addCurrentVertex",value:function(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=t.y*r-t.x,s=-t.y-t.x*r;this.addHalfVertex(e,t.x+t.y*n,t.y-t.x*n,a,!1,n,i),this.addHalfVertex(e,o,s,a,!0,-r,i)}},{key:"addHalfVertex",value:function(e,t,n,r,i,a,o){var s=e.x,l=e.y;this.layoutVertexArray.emplaceBack((s<<1)+(r?1:0),(l<<1)+(i?1:0),Math.round(63*t)+128,Math.round(63*n)+128,1+(0===a?0:a<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length);var u=o.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),o.primitiveLength++),i?this.e2=u:this.e1=u}},{key:"updateScaledDistance",value:function(){if(this.lineClips){var e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}},{key:"updateDistance",value:function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()}}]),e}();ai("LineBucket",xl,{omit:["layers","patternFeatures"]});var wl=new Gi({"line-cap":new Bi(Ke.layout_line["line-cap"]),"line-join":new Ui(Ke.layout_line["line-join"]),"line-miter-limit":new Bi(Ke.layout_line["line-miter-limit"]),"line-round-limit":new Bi(Ke.layout_line["line-round-limit"]),"line-sort-key":new Ui(Ke.layout_line["line-sort-key"])}),El={paint:new Gi({"line-opacity":new Ui(Ke.paint_line["line-opacity"]),"line-color":new Ui(Ke.paint_line["line-color"]),"line-translate":new Bi(Ke.paint_line["line-translate"]),"line-translate-anchor":new Bi(Ke.paint_line["line-translate-anchor"]),"line-width":new Ui(Ke.paint_line["line-width"]),"line-gap-width":new Ui(Ke.paint_line["line-gap-width"]),"line-offset":new Ui(Ke.paint_line["line-offset"]),"line-blur":new Ui(Ke.paint_line["line-blur"]),"line-dasharray":new Vi(Ke.paint_line["line-dasharray"]),"line-pattern":new ji(Ke.paint_line["line-pattern"]),"line-gradient":new Hi(Ke.paint_line["line-gradient"])}),layout:wl},Sl=new(function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"possiblyEvaluate",value:function(e,t){return t=new Ii(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,zoomHistory:t.zoomHistory,transition:t.transition}),o(s(n.prototype),"possiblyEvaluate",this).call(this,e,t)}},{key:"evaluate",value:function(e,t,r,i){return t=P({},t,{zoom:Math.floor(t.zoom)}),o(s(n.prototype),"evaluate",this).call(this,e,t,r,i)}}]),n}(Ui))(El.paint.properties["line-width"].specification);function Tl(e,t){return t>0?t+2*e:e}Sl.useIntegerZoom=!0;var kl=Ki([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ml=Ki([{name:"a_projected_pos",components:3,type:"Float32"}],4),Cl=(Ki([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ki([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Al=Ki([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]),Il=(Ki([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ki([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Pl=Ki([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Rl(e,t){var n=t.expression;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new Ii(e+1))};if("source"===n.kind)return{kind:"source"};for(var r=n.zoomStops,i=n.interpolationType,a=0;a<r.length&&r[a]<=e;)a++;for(var o=a=Math.max(0,a-1);o<r.length&&r[o]<e+1;)o++;o=Math.min(r.length-1,o);var s=r[a],l=r[o];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:l,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:l,minSize:n.evaluate(new Ii(s)),maxSize:n.evaluate(new Ii(l)),interpolationType:i}}function Ll(e,t,n){var r=t.uSize,i=t.uSizeT,a=n.lowerSize,o=n.upperSize;return"source"===e.kind?a/128:"composite"===e.kind?fn(a/128,o/128,i):r}function Ol(e,t){var n=0,r=0;if("constant"===e.kind)r=e.layoutSize;else if("source"!==e.kind){var i=e.interpolationType,a=e.minZoom,o=e.maxZoom,s=i?C(Mn.interpolationFactor(i,t,a,o),0,1):0;"camera"===e.kind?r=fn(e.minSize,e.maxSize,s):n=s}return{uSizeT:n,uSize:r}}Ki([{name:"triangle",components:3,type:"Uint16"}]),Ki([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ki([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ki([{type:"Float32",name:"offsetX"}]),Ki([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Dl=Object.freeze({__proto__:null,getSizeData:Rl,evaluateSizeForFeature:Ll,evaluateSizeForZoom:Ol,SIZE_PACK_FACTOR:128});function Nl(e,t,n){return e.sections.forEach((function(e){e.text=function(e,t,n){var r=t.layout.get("text-transform").evaluate(n,{});return"uppercase"===r?e=e.toLocaleUpperCase():"lowercase"===r&&(e=e.toLocaleLowerCase()),Ai.applyArabicShaping&&(e=Ai.applyArabicShaping(e)),e}(e.text,t,n)})),e}var zl={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"},Fl=function(e,t,n,r,i){var a,o,s=8*i-r-1,l=(1<<s)-1,u=l>>1,c=-7,h=n?i-1:0,f=n?-1:1,d=e[t+h];for(h+=f,a=d&(1<<-c)-1,d>>=-c,c+=s;c>0;a=256*a+e[t+h],h+=f,c-=8);for(o=a&(1<<-c)-1,a>>=-c,c+=r;c>0;o=256*o+e[t+h],h+=f,c-=8);if(0===a)a=1-u;else{if(a===l)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,r),a-=u}return(d?-1:1)*o*Math.pow(2,a-r)},Bl=function(e,t,n,r,i,a){var o,s,l,u=8*a-i-1,c=(1<<u)-1,h=c>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:a-1,p=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=c):(o=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-o))<1&&(o--,l*=2),(t+=o+h>=1?f/l:f*Math.pow(2,1-h))*l>=2&&(o++,l/=2),o+h>=c?(s=0,o=c):o+h>=1?(s=(t*l-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+d]=255&s,d+=p,s/=256,i-=8);for(o=o<<i|s,u+=i;u>0;e[n+d]=255&o,d+=p,o/=256,u-=8);e[n+d-p]|=128*m},Ul=jl;function jl(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}jl.Varint=0,jl.Fixed64=1,jl.Bytes=2,jl.Fixed32=5;var Vl="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Hl(e){return e.type===jl.Bytes?e.readVarint()+e.pos:e.pos+1}function Gl(e,t,n){return n?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Wl(e,t,n){var r=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=e;i--)n.buf[i+r]=n.buf[i]}function ql(e,t){for(var n=0;n<e.length;n++)t.writeVarint(e[n])}function Xl(e,t){for(var n=0;n<e.length;n++)t.writeSVarint(e[n])}function Zl(e,t){for(var n=0;n<e.length;n++)t.writeFloat(e[n])}function Kl(e,t){for(var n=0;n<e.length;n++)t.writeDouble(e[n])}function Yl(e,t){for(var n=0;n<e.length;n++)t.writeBoolean(e[n])}function Jl(e,t){for(var n=0;n<e.length;n++)t.writeFixed32(e[n])}function Ql(e,t){for(var n=0;n<e.length;n++)t.writeSFixed32(e[n])}function $l(e,t){for(var n=0;n<e.length;n++)t.writeFixed64(e[n])}function eu(e,t){for(var n=0;n<e.length;n++)t.writeSFixed64(e[n])}function tu(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function nu(e,t,n){e[n]=t,e[n+1]=t>>>8,e[n+2]=t>>>16,e[n+3]=t>>>24}function ru(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function iu(e,t,n){1===e&&n.readMessage(au,t)}function au(e,t,n){if(3===e){var r=n.readMessage(ou,{}),i=r.id,a=r.bitmap,o=r.width,s=r.height,l=r.left,u=r.top,c=r.advance;t.push({id:i,bitmap:new os({width:o+6,height:s+6},a),metrics:{width:o,height:s,left:l,top:u,advance:c}})}}function ou(e,t,n){1===e?t.id=n.readVarint():2===e?t.bitmap=n.readBytes():3===e?t.width=n.readVarint():4===e?t.height=n.readVarint():5===e?t.left=n.readSVarint():6===e?t.top=n.readSVarint():7===e&&(t.advance=n.readVarint())}function su(e){var t,n=0,r=0,i=f(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;n+=a.w*a.h,r=Math.max(r,a.w)}}catch(v){i.e(v)}finally{i.f()}e.sort((function(e,t){return t.h-e.h}));var o,s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(n/.95)),r),h:1/0}],l=0,u=0,c=f(e);try{for(c.s();!(o=c.n()).done;)for(var h=o.value,d=s.length-1;d>=0;d--){var p=s[d];if(!(h.w>p.w||h.h>p.h)){if(h.x=p.x,h.y=p.y,u=Math.max(u,h.y+h.h),l=Math.max(l,h.x+h.w),h.w===p.w&&h.h===p.h){var m=s.pop();d<s.length&&(s[d]=m)}else h.h===p.h?(p.x+=h.w,p.w-=h.w):h.w===p.w?(p.y+=h.h,p.h-=h.h):(s.push({x:p.x+h.w,y:p.y,w:p.w-h.w,h:h.h}),p.y+=h.h,p.h-=h.h);break}}}catch(v){c.e(v)}finally{c.f()}return{w:l,h:u,fill:n/(l*u)||0}}jl.prototype={destroy:function(){this.buf=null},readFields:function(e,t,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,a=this.pos;this.type=7&r,e(i,t,this),this.pos===a&&this.skip(r)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=tu(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=ru(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=tu(this.buf,this.pos)+4294967296*tu(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=tu(this.buf,this.pos)+4294967296*ru(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=Fl(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=Fl(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,n,r=this.buf;return t=127&(n=r[this.pos++]),n<128?t:(t|=(127&(n=r[this.pos++]))<<7,n<128?t:(t|=(127&(n=r[this.pos++]))<<14,n<128?t:(t|=(127&(n=r[this.pos++]))<<21,n<128?t:function(e,t,n){var r,i,a=n.buf;if(r=(112&(i=a[n.pos++]))>>4,i<128)return Gl(e,r,t);if(r|=(127&(i=a[n.pos++]))<<3,i<128)return Gl(e,r,t);if(r|=(127&(i=a[n.pos++]))<<10,i<128)return Gl(e,r,t);if(r|=(127&(i=a[n.pos++]))<<17,i<128)return Gl(e,r,t);if(r|=(127&(i=a[n.pos++]))<<24,i<128)return Gl(e,r,t);if(r|=(1&(i=a[n.pos++]))<<31,i<128)return Gl(e,r,t);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=r[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Vl?function(e,t,n){return Vl.decode(e.subarray(t,n))}(this.buf,t,e):function(e,t,n){for(var r="",i=t;i<n;){var a,o,s,l=e[i],u=null,c=l>239?4:l>223?3:l>191?2:1;if(i+c>n)break;1===c?l<128&&(u=l):2===c?128==(192&(a=e[i+1]))&&(u=(31&l)<<6|63&a)<=127&&(u=null):3===c?(o=e[i+2],128==(192&(a=e[i+1]))&&128==(192&o)&&((u=(15&l)<<12|(63&a)<<6|63&o)<=2047||u>=55296&&u<=57343)&&(u=null)):4===c&&(o=e[i+2],s=e[i+3],128==(192&(a=e[i+1]))&&128==(192&o)&&128==(192&s)&&((u=(15&l)<<18|(63&a)<<12|(63&o)<<6|63&s)<=65535||u>=1114112)&&(u=null)),null===u?(u=65533,c=1):u>65535&&(u-=65536,r+=String.fromCharCode(u>>>10&1023|55296),u=56320|1023&u),r+=String.fromCharCode(u),i+=c}return r}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==jl.Bytes)return e.push(this.readVarint(t));var n=Hl(this);for(e=e||[];this.pos<n;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==jl.Bytes)return e.push(this.readSVarint());var t=Hl(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==jl.Bytes)return e.push(this.readBoolean());var t=Hl(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==jl.Bytes)return e.push(this.readFloat());var t=Hl(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==jl.Bytes)return e.push(this.readDouble());var t=Hl(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==jl.Bytes)return e.push(this.readFixed32());var t=Hl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==jl.Bytes)return e.push(this.readSFixed32());var t=Hl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==jl.Bytes)return e.push(this.readFixed64());var t=Hl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==jl.Bytes)return e.push(this.readSFixed64());var t=Hl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===jl.Varint)for(;this.buf[this.pos++]>127;);else if(t===jl.Bytes)this.pos=this.readVarint()+this.pos;else if(t===jl.Fixed32)this.pos+=4;else{if(t!==jl.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),nu(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),nu(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),nu(this.buf,-1&e,this.pos),nu(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),nu(this.buf,-1&e,this.pos),nu(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(e,t){var n,r;if(e>=0?(n=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(n=~(-e%4294967296))?n=n+1|0:(n=0,r=r+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,n){n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,e>>>=7,n.buf[n.pos++]=127&e|128,n.buf[n.pos]=127&(e>>>=7)}(n,0,t),function(e,t){var n=(7&e)<<4;t.buf[t.pos++]|=n|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(r,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(e,t,n){for(var r,i,a=0;a<t.length;a++){if((r=t.charCodeAt(a))>55295&&r<57344){if(!i){r>56319||a+1===t.length?(e[n++]=239,e[n++]=191,e[n++]=189):i=r;continue}if(r<56320){e[n++]=239,e[n++]=191,e[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(e[n++]=239,e[n++]=191,e[n++]=189,i=null);r<128?e[n++]=r:(r<2048?e[n++]=r>>6|192:(r<65536?e[n++]=r>>12|224:(e[n++]=r>>18|240,e[n++]=r>>12&63|128),e[n++]=r>>6&63|128),e[n++]=63&r|128)}return n}(this.buf,e,this.pos);var n=this.pos-t;n>=128&&Wl(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(e){this.realloc(4),Bl(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Bl(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=e[n]},writeRawMessage:function(e,t){this.pos++;var n=this.pos;e(t,this);var r=this.pos-n;r>=128&&Wl(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(e,t,n){this.writeTag(e,jl.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,ql,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Xl,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Yl,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,Zl,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,Kl,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,Jl,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Ql,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,$l,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,eu,t)},writeBytesField:function(e,t){this.writeTag(e,jl.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,jl.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,jl.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,jl.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,jl.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,jl.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,jl.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,jl.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,jl.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,jl.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var lu=function(){function e(t,n){var r=n.pixelRatio,i=n.version,a=n.stretchX,o=n.stretchY,s=n.content;v(this,e),this.paddedRect=t,this.pixelRatio=r,this.stretchX=a,this.stretchY=o,this.content=s,this.version=i}return y(e,[{key:"tl",get:function(){return[this.paddedRect.x+1,this.paddedRect.y+1]}},{key:"br",get:function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}},{key:"tlbr",get:function(){return this.tl.concat(this.br)}},{key:"displaySize",get:function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}]),e}(),uu=function(){function e(t,n){v(this,e);var r={},i={};this.haveRenderCallbacks=[];var a=[];this.addImages(t,r,a),this.addImages(n,i,a);var o=su(a),s=o.w,l=o.h,u=new ss({width:s||1,height:l||1});for(var c in t){var h=t[c],f=r[c].paddedRect;ss.copy(h.data,u,{x:0,y:0},{x:f.x+1,y:f.y+1},h.data)}for(var d in n){var p=n[d],m=i[d].paddedRect,y=m.x+1,g=m.y+1,_=p.data.width,b=p.data.height;ss.copy(p.data,u,{x:0,y:0},{x:y,y:g},p.data),ss.copy(p.data,u,{x:0,y:b-1},{x:y,y:g-1},{width:_,height:1}),ss.copy(p.data,u,{x:0,y:0},{x:y,y:g+b},{width:_,height:1}),ss.copy(p.data,u,{x:_-1,y:0},{x:y-1,y:g},{width:1,height:b}),ss.copy(p.data,u,{x:0,y:0},{x:y+_,y:g},{width:1,height:b})}this.image=u,this.iconPositions=r,this.patternPositions=i}return y(e,[{key:"addImages",value:function(e,t,n){for(var r in e){var i=e[r],a={x:0,y:0,w:i.data.width+2,h:i.data.height+2};n.push(a),t[r]=new lu(a,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}},{key:"patchUpdatedImages",value:function(e,t){for(var n in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[n],e.getImage(n),t),this.patchUpdatedImage(this.patternPositions[n],e.getImage(n),t)}},{key:"patchUpdatedImage",value:function(e,t,n){if(e&&t&&e.version!==t.version){e.version=t.version;var r=h(e.tl,2),i=r[0],a=r[1];n.update(t.data,void 0,{x:i,y:a})}}}]),e}();ai("ImagePosition",lu),ai("ImageAtlas",uu);var cu={horizontal:1,vertical:2,horizontalOnly:3},hu=function(){function e(){v(this,e),this.scale=1,this.fontStack="",this.imageName=null}return y(e,null,[{key:"forText",value:function(t,n){var r=new e;return r.scale=t||1,r.fontStack=n,r}},{key:"forImage",value:function(t){var n=new e;return n.imageName=t,n}}]),e}(),fu=function(){function e(){v(this,e),this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}return y(e,[{key:"length",value:function(){return this.text.length}},{key:"getSection",value:function(e){return this.sections[this.sectionIndex[e]]}},{key:"getSectionIndex",value:function(e){return this.sectionIndex[e]}},{key:"getCharCode",value:function(e){return this.text.charCodeAt(e)}},{key:"verticalizePunctuation",value:function(){this.text=function(e){for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n+1)||null,i=e.charCodeAt(n-1)||null;t+=r&&yi(r)&&!zl[e[n+1]]||i&&yi(i)&&!zl[e[n-1]]||!zl[e[n]]?e[n]:zl[e[n]]}return t}(this.text)}},{key:"trim",value:function(){for(var e=0,t=0;t<this.text.length&&pu[this.text.charCodeAt(t)];t++)e++;for(var n=this.text.length,r=this.text.length-1;r>=0&&r>=e&&pu[this.text.charCodeAt(r)];r--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}},{key:"substring",value:function(t,n){var r=new e;return r.text=this.text.substring(t,n),r.sectionIndex=this.sectionIndex.slice(t,n),r.sections=this.sections,r}},{key:"toString",value:function(){return this.text}},{key:"getMaxScale",value:function(){var e=this;return this.sectionIndex.reduce((function(t,n){return Math.max(t,e.sections[n].scale)}),0)}},{key:"addTextSection",value:function(e,t){this.text+=e.text,this.sections.push(hu.forText(e.scale,e.fontStack||t));for(var n=this.sections.length-1,r=0;r<e.text.length;++r)this.sectionIndex.push(n)}},{key:"addImageSection",value:function(e){var t=e.image?e.image.name:"";if(0!==t.length){var n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(hu.forImage(t)),this.sectionIndex.push(this.sections.length-1)):V("Reached maximum number of images 6401")}else V("Can't add FormattedSection with an empty image.")}},{key:"getNextImageSectionCharCode",value:function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}],[{key:"fromFeature",value:function(t,n){for(var r=new e,i=0;i<t.sections.length;i++){var a=t.sections[i];a.image?r.addImageSection(a):r.addTextSection(a,n)}return r}}]),e}();function du(e,t,n,r,i,a,o,s,l,u,c,h,d,p,m,v){var y,g=fu.fromFeature(e,i);h===cu.vertical&&g.verticalizePunctuation();var _=Ai.processBidirectionalText,b=Ai.processStyledBidirectionalText;if(_&&1===g.sections.length){y=[];var x,w=_(g.toString(),bu(g,u,a,t,r,p,m)),E=f(w);try{for(E.s();!(x=E.n()).done;){var S=x.value,T=new fu;T.text=S,T.sections=g.sections;for(var k=0;k<S.length;k++)T.sectionIndex.push(0);y.push(T)}}catch(O){E.e(O)}finally{E.f()}}else if(b){y=[];var M,C=b(g.text,g.sectionIndex,bu(g,u,a,t,r,p,m)),A=f(C);try{for(A.s();!(M=A.n()).done;){var I=M.value,P=new fu;P.text=I[0],P.sectionIndex=I[1],P.sections=g.sections,y.push(P)}}catch(O){A.e(O)}finally{A.f()}}else y=function(e,t){var n,r=[],i=e.text,a=0,o=f(t);try{for(o.s();!(n=o.n()).done;){var s=n.value;r.push(e.substring(a,s)),a=s}}catch(O){o.e(O)}finally{o.f()}return a<i.length&&r.push(e.substring(a,i.length)),r}(g,bu(g,u,a,t,r,p,m));var R=[],L={positionedLines:R,text:g.toString(),top:c[1],bottom:c[1],left:c[0],right:c[0],writingMode:h,iconsInText:!1,verticalizable:!1};return function(e,t,n,r,i,a,o,s,l,u,c,h){var d,p,m=0,v=-17,y=0,g=0,_="right"===s?1:"left"===s?0:.5,b=0,x=f(i);try{for(x.s();!(d=x.n()).done;){var w=d.value;w.trim();var E=w.getMaxScale(),S=24*(E-1),T={positionedGlyphs:[],lineOffset:0};e.positionedLines[b]=T;var k=T.positionedGlyphs,M=0;if(w.length()){for(var C=0;C<w.length();C++){var A=w.getSection(C),I=w.getSectionIndex(C),P=w.getCharCode(C),R=0,L=null,D=null,N=null,z=24,F=!(l===cu.horizontal||!c&&!vi(P)||c&&(pu[P]||(p=P,fi.Arabic(p)||fi["Arabic Supplement"](p)||fi["Arabic Extended-A"](p)||fi["Arabic Presentation Forms-A"](p)||fi["Arabic Presentation Forms-B"](p))));if(A.imageName){var B=r[A.imageName];if(!B)continue;N=A.imageName,e.iconsInText=e.iconsInText||!0,D=B.paddedRect;var U=B.displaySize;A.scale=24*A.scale/h,L={width:U[0],height:U[1],left:1,top:-3,advance:F?U[1]:U[0]},R=S+(24-U[1]*A.scale),z=L.advance;var j=F?U[0]*A.scale-24*E:U[1]*A.scale-24*E;j>0&&j>M&&(M=j)}else{var V=n[A.fontStack],H=V&&V[P];if(H&&H.rect)D=H.rect,L=H.metrics;else{var G=t[A.fontStack],W=G&&G[P];if(!W)continue;L=W.metrics}R=24*(E-A.scale)}F?(e.verticalizable=!0,k.push({glyph:P,imageName:N,x:m,y:v+R,vertical:F,scale:A.scale,fontStack:A.fontStack,sectionIndex:I,metrics:L,rect:D}),m+=z*A.scale+u):(k.push({glyph:P,imageName:N,x:m,y:v+R,vertical:F,scale:A.scale,fontStack:A.fontStack,sectionIndex:I,metrics:L,rect:D}),m+=L.advance*A.scale+u)}0!==k.length&&(y=Math.max(m-u,y),wu(k,0,k.length-1,_,M)),m=0;var q=a*E+M;T.lineOffset=Math.max(M,S),v+=q,g=Math.max(q,g),++b}else v+=a,++b}}catch(O){x.e(O)}finally{x.f()}var X=v- -17,Z=xu(o),K=Z.horizontalAlign,Y=Z.verticalAlign;(function(e,t,n,r,i,a,o,s,l){var u=(t-n)*i,c=0;c=a!==o?-s*r- -17:(-r*l+.5)*o;var h,d=f(e);try{for(d.s();!(h=d.n()).done;){var p,m=h.value,v=f(m.positionedGlyphs);try{for(v.s();!(p=v.n()).done;){var y=p.value;y.x+=u,y.y+=c}}catch(O){v.e(O)}finally{v.f()}}}catch(O){d.e(O)}finally{d.f()}})(e.positionedLines,_,K,Y,y,g,a,X,i.length),e.top+=-Y*X,e.bottom=e.top+X,e.left+=-K*y,e.right=e.left+y}(L,t,n,r,y,o,s,l,h,u,d,v),!function(e){var t,n=f(e);try{for(n.s();!(t=n.n()).done;)if(0!==t.value.positionedGlyphs.length)return!1}catch(O){n.e(O)}finally{n.f()}return!0}(R)&&L}var pu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},mu={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function vu(e,t,n,r,i,a){if(t.imageName){var o=r[t.imageName];return o?o.displaySize[0]*t.scale*24/a+i:0}var s=n[t.fontStack],l=s&&s[e];return l?l.metrics.advance*t.scale+i:0}function yu(e,t,n,r){var i=Math.pow(e-t,2);return r?e<t?i/2:2*i:i+Math.abs(n)*n}function gu(e,t,n){var r=0;return 10===e&&(r-=1e4),n&&(r+=150),40!==e&&65288!==e||(r+=50),41!==t&&65289!==t||(r+=50),r}function _u(e,t,n,r,i,a){var o,s=null,l=yu(t,n,i,a),u=f(r);try{for(u.s();!(o=u.n()).done;){var c=o.value,h=yu(t-c.x,n,i,a)+c.badness;h<=l&&(s=c,l=h)}}catch(d){u.e(d)}finally{u.f()}return{index:e,x:t,priorBreak:s,badness:l}}function bu(e,t,n,r,i,a,o){if("point"!==a)return[];if(!e)return[];for(var s,l=[],u=function(e,t,n,r,i,a){for(var o=0,s=0;s<e.length();s++){var l=e.getSection(s);o+=vu(e.getCharCode(s),l,r,i,t,a)}return o/Math.max(1,Math.ceil(o/n))}(e,t,n,r,i,o),c=e.text.indexOf("\u200b")>=0,h=0,f=0;f<e.length();f++){var d=e.getSection(f),p=e.getCharCode(f);if(pu[p]||(h+=vu(p,d,r,i,t,o)),f<e.length()-1){var m=!((s=p)<11904||!(fi["Bopomofo Extended"](s)||fi.Bopomofo(s)||fi["CJK Compatibility Forms"](s)||fi["CJK Compatibility Ideographs"](s)||fi["CJK Compatibility"](s)||fi["CJK Radicals Supplement"](s)||fi["CJK Strokes"](s)||fi["CJK Symbols and Punctuation"](s)||fi["CJK Unified Ideographs Extension A"](s)||fi["CJK Unified Ideographs"](s)||fi["Enclosed CJK Letters and Months"](s)||fi["Halfwidth and Fullwidth Forms"](s)||fi.Hiragana(s)||fi["Ideographic Description Characters"](s)||fi["Kangxi Radicals"](s)||fi["Katakana Phonetic Extensions"](s)||fi.Katakana(s)||fi["Vertical Forms"](s)||fi["Yi Radicals"](s)||fi["Yi Syllables"](s)));(mu[p]||m||d.imageName)&&l.push(_u(f+1,h,u,l,gu(p,e.getCharCode(f+1),m&&c),!1))}}return function e(t){return t?e(t.priorBreak).concat(t.index):[]}(_u(e.length(),h,u,l,0,!0))}function xu(e){var t=.5,n=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function wu(e,t,n,r,i){if(r||i)for(var a=e[n],o=(e[n].x+a.metrics.advance*a.scale)*r,s=t;s<=n;s++)e[s].x-=o,e[s].y+=i}function Eu(e,t,n){var r=xu(n),i=r.horizontalAlign,a=r.verticalAlign,o=t[0]-e.displaySize[0]*i,s=t[1]-e.displaySize[1]*a;return{image:e,top:s,bottom:s+e.displaySize[1],left:o,right:o+e.displaySize[0]}}function Su(e,t,n,r,i,a){var o,s=e.image;if(s.content){var l=s.content,u=s.pixelRatio||1;o=[l[0]/u,l[1]/u,s.displaySize[0]-l[2]/u,s.displaySize[1]-l[3]/u]}var c,h,f,d,p=t.left*a,m=t.right*a;"width"===n||"both"===n?(d=i[0]+p-r[3],h=i[0]+m+r[1]):h=(d=i[0]+(p+m-s.displaySize[0])/2)+s.displaySize[0];var v=t.top*a,y=t.bottom*a;return"height"===n||"both"===n?(c=i[1]+v-r[0],f=i[1]+y+r[2]):f=(c=i[1]+(v+y-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:c,right:h,bottom:f,left:d,collisionPadding:o}}var Tu=function(e){p(n,e);var t=m(n);function n(e,r,i,a){var o;return v(this,n),(o=t.call(this,e,r)).angle=i,void 0!==a&&(o.segment=a),o}return y(n,[{key:"clone",value:function(){return new n(this.x,this.y,this.angle,this.segment)}}]),n}(r);function ku(e,t,n,r,i){if(void 0===t.segment)return!0;for(var a=t,o=t.segment+1,s=0;s>-n/2;){if(--o<0)return!1;s-=e[o].dist(a),a=e[o]}s+=e[o].dist(e[o+1]),o++;for(var l=[],u=0;s<n/2;){var c=e[o],h=e[o+1];if(!h)return!1;var f=e[o-1].angleTo(c)-c.angleTo(h);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:f}),u+=f;s-l[0].distance>r;)u-=l.shift().angleDelta;if(u>i)return!1;o++,s+=c.dist(h)}return!0}function Mu(e){for(var t=0,n=0;n<e.length-1;n++)t+=e[n].dist(e[n+1]);return t}function Cu(e,t,n){return e?.6*t*n:0}function Au(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function Iu(e,t,n,r,i,a){for(var o=Cu(n,i,a),s=Au(n,r)*a,l=0,u=Mu(e)/2,c=0;c<e.length-1;c++){var h=e[c],f=e[c+1],d=h.dist(f);if(l+d>u){var p=(u-l)/d,m=fn(h.x,f.x,p),v=fn(h.y,f.y,p),y=new Tu(m,v,f.angleTo(h),c);return y._round(),!o||ku(e,y,s,o,t)?y:void 0}l+=d}}function Pu(e,t,n,r,i,a,o,s,l){var u=Cu(r,a,o),c=Au(r,i),h=c*o,f=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-h<t/4&&(t=h+t/4),function e(t,n,r,i,a,o,s,l,u){for(var c=o/2,h=Mu(t),f=0,d=n-r,p=[],m=0;m<t.length-1;m++){for(var v=t[m],y=t[m+1],g=v.dist(y),_=y.angleTo(v);d+r<f+g;){var b=((d+=r)-f)/g,x=fn(v.x,y.x,b),w=fn(v.y,y.y,b);if(x>=0&&x<u&&w>=0&&w<u&&d-c>=0&&d+c<=h){var E=new Tu(x,w,_,m);E._round(),i&&!ku(t,E,o,i,a)||p.push(E)}}f+=g}return l||p.length||s||(p=e(t,f/2,r,i,a,o,s,!0,u)),p}(e,f?t/2*s%t:(c/2+2*a)*o*s%t,t,u,n,h,f,!1,l)}function Ru(e,t,n,i,a){for(var o=[],s=0;s<e.length;s++)for(var l=e[s],u=void 0,c=0;c<l.length-1;c++){var h=l[c],f=l[c+1];h.x<t&&f.x<t||(h.x<t?h=new r(t,h.y+(t-h.x)/(f.x-h.x)*(f.y-h.y))._round():f.x<t&&(f=new r(t,h.y+(t-h.x)/(f.x-h.x)*(f.y-h.y))._round()),h.y<n&&f.y<n||(h.y<n?h=new r(h.x+(n-h.y)/(f.y-h.y)*(f.x-h.x),n)._round():f.y<n&&(f=new r(h.x+(n-h.y)/(f.y-h.y)*(f.x-h.x),n)._round()),h.x>=i&&f.x>=i||(h.x>=i?h=new r(i,h.y+(i-h.x)/(f.x-h.x)*(f.y-h.y))._round():f.x>=i&&(f=new r(i,h.y+(i-h.x)/(f.x-h.x)*(f.y-h.y))._round()),h.y>=a&&f.y>=a||(h.y>=a?h=new r(h.x+(a-h.y)/(f.y-h.y)*(f.x-h.x),a)._round():f.y>=a&&(f=new r(h.x+(a-h.y)/(f.y-h.y)*(f.x-h.x),a)._round()),u&&h.equals(u[u.length-1])||(u=[h],o.push(u)),u.push(f)))))}return o}function Lu(e,t,n,i){var a=[],o=e.image,s=o.pixelRatio,l=o.paddedRect.w-2,u=o.paddedRect.h-2,c=e.right-e.left,h=e.bottom-e.top,f=o.stretchX||[[0,l]],d=o.stretchY||[[0,u]],p=function(e,t){return e+t[1]-t[0]},m=f.reduce(p,0),v=d.reduce(p,0),y=l-m,g=u-v,_=0,b=m,x=0,w=v,E=0,S=y,T=0,k=g;if(o.content&&i){var M=o.content;_=Ou(f,0,M[0]),x=Ou(d,0,M[1]),b=Ou(f,M[0],M[2]),w=Ou(d,M[1],M[3]),E=M[0]-_,T=M[1]-x,S=M[2]-M[0]-b,k=M[3]-M[1]-w}var C=function(i,a,l,u){var f=Nu(i.stretch-_,b,c,e.left),d=zu(i.fixed-E,S,i.stretch,m),p=Nu(a.stretch-x,w,h,e.top),y=zu(a.fixed-T,k,a.stretch,v),g=Nu(l.stretch-_,b,c,e.left),M=zu(l.fixed-E,S,l.stretch,m),C=Nu(u.stretch-x,w,h,e.top),A=zu(u.fixed-T,k,u.stretch,v),I=new r(f,p),P=new r(g,p),R=new r(g,C),L=new r(f,C),O=new r(d/s,y/s),D=new r(M/s,A/s),N=t*Math.PI/180;if(N){var z=Math.sin(N),F=Math.cos(N),B=[F,-z,z,F];I._matMult(B),P._matMult(B),L._matMult(B),R._matMult(B)}var U=i.stretch+i.fixed,j=a.stretch+a.fixed;return{tl:I,tr:P,bl:L,br:R,tex:{x:o.paddedRect.x+1+U,y:o.paddedRect.y+1+j,w:l.stretch+l.fixed-U,h:u.stretch+u.fixed-j},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:O,pixelOffsetBR:D,minFontScaleX:S/s/c,minFontScaleY:k/s/h,isSDF:n}};if(i&&(o.stretchX||o.stretchY))for(var A=Du(f,y,m),I=Du(d,g,v),P=0;P<A.length-1;P++)for(var R=A[P],L=A[P+1],O=0;O<I.length-1;O++)a.push(C(R,I[O],L,I[O+1]));else a.push(C({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:u+1}));return a}function Ou(e,t,n){var r,i=0,a=f(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;i+=Math.max(t,Math.min(n,o[1]))-Math.max(t,Math.min(n,o[0]))}}catch(s){a.e(s)}finally{a.f()}return i}function Du(e,t,n){var r,i=[{fixed:-1,stretch:0}],a=f(e);try{for(a.s();!(r=a.n()).done;){var o=h(r.value,2),s=o[0],l=o[1],u=i[i.length-1];i.push({fixed:s-u.stretch,stretch:u.stretch}),i.push({fixed:s-u.stretch,stretch:u.stretch+(l-s)})}}catch(c){a.e(c)}finally{a.f()}return i.push({fixed:t+1,stretch:n}),i}function Nu(e,t,n,r){return e/t*n+r}function zu(e,t,n,r){return e-t*n/r}ai("Anchor",Tu);var Fu=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Bu;if(v(this,e),this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)}return y(e,[{key:"push",value:function(e){this.data.push(e),this.length++,this._up(this.length-1)}},{key:"pop",value:function(){if(0!==this.length){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}}},{key:"peek",value:function(){return this.data[0]}},{key:"_up",value:function(e){for(var t=this.data,n=this.compare,r=t[e];e>0;){var i=e-1>>1,a=t[i];if(n(r,a)>=0)break;t[e]=a,e=i}t[e]=r}},{key:"_down",value:function(e){for(var t=this.data,n=this.compare,r=this.length>>1,i=t[e];e<r;){var a=1+(e<<1),o=t[a],s=a+1;if(s<this.length&&n(t[s],o)<0&&(a=s,o=t[s]),n(o,i)>=0)break;t[e]=o,e=a}t[e]=i}}]),e}();function Bu(e,t){return e<t?-1:e>t?1:0}function Uu(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=1/0,a=1/0,o=-1/0,s=-1/0,l=e[0],u=0;u<l.length;u++){var c=l[u];(!u||c.x<i)&&(i=c.x),(!u||c.y<a)&&(a=c.y),(!u||c.x>o)&&(o=c.x),(!u||c.y>s)&&(s=c.y)}var h=Math.min(o-i,s-a),f=h/2,d=new Fu([],ju);if(0===h)return new r(i,a);for(var p=i;p<o;p+=h)for(var m=a;m<s;m+=h)d.push(new Vu(p+f,m+f,f,e));for(var v=function(e){for(var t=0,n=0,r=0,i=e[0],a=0,o=i.length,s=o-1;a<o;s=a++){var l=i[a],u=i[s],c=l.x*u.y-u.x*l.y;n+=(l.x+u.x)*c,r+=(l.y+u.y)*c,t+=3*c}return new Vu(n/t,r/t,0,e)}(e),y=d.length;d.length;){var g=d.pop();(g.d>v.d||!v.d)&&(v=g,n&&console.log("found best %d after %d probes",Math.round(1e4*g.d)/1e4,y)),g.max-v.d<=t||(f=g.h/2,d.push(new Vu(g.p.x-f,g.p.y-f,f,e)),d.push(new Vu(g.p.x+f,g.p.y-f,f,e)),d.push(new Vu(g.p.x-f,g.p.y+f,f,e)),d.push(new Vu(g.p.x+f,g.p.y+f,f,e)),y+=4)}return n&&(console.log("num probes: ".concat(y)),console.log("best distance: ".concat(v.d))),v.p}function ju(e,t){return t.max-e.max}function Vu(e,t,n,i){this.p=new r(e,t),this.h=n,this.d=function(e,t){for(var n=!1,r=1/0,i=0;i<t.length;i++)for(var a=t[i],o=0,s=a.length,l=s-1;o<s;l=o++){var u=a[o],c=a[l];u.y>e.y!=c.y>e.y&&e.x<(c.x-u.x)*(e.y-u.y)/(c.y-u.y)+u.x&&(n=!n),r=Math.min(r,mo(e,u,c))}return(n?1:-1)*Math.sqrt(r)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}var Hu=Number.POSITIVE_INFINITY;function Gu(e,t){return t[1]!==Hu?function(e,t,n){var r=0,i=0;switch(t=Math.abs(t),n=Math.abs(n),e){case"top-right":case"top-left":case"top":i=n-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-n}switch(e){case"top-right":case"bottom-right":case"right":r=-t;break;case"top-left":case"bottom-left":case"left":r=t}return[r,i]}(e,t[0],t[1]):function(e,t){var n=0,r=0;t<0&&(t=0);var i=t/Math.sqrt(2);switch(e){case"top-right":case"top-left":r=i-7;break;case"bottom-right":case"bottom-left":r=7-i;break;case"bottom":r=7-t;break;case"top":r=t-7}switch(e){case"top-right":case"bottom-right":n=-i;break;case"top-left":case"bottom-left":n=i;break;case"left":n=t;break;case"right":n=-t}return[n,r]}(e,t[0])}function Wu(e,t,n,r,i,a,o,s){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var l=e.layers[0].layout,u=e.layers[0]._unevaluatedLayout._values,c={};if("composite"===e.textSizeData.kind){var h=e.textSizeData,d=h.minZoom,p=h.maxZoom;c.compositeTextSizes=[u["text-size"].possiblyEvaluate(new Ii(d),o),u["text-size"].possiblyEvaluate(new Ii(p),o)]}if("composite"===e.iconSizeData.kind){var m=e.iconSizeData,v=m.minZoom,y=m.maxZoom;c.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new Ii(v),o),u["icon-size"].possiblyEvaluate(new Ii(y),o)]}c.layoutTextSize=u["text-size"].possiblyEvaluate(new Ii(s+1),o),c.layoutIconSize=u["icon-size"].possiblyEvaluate(new Ii(s+1),o),c.textMaxSize=u["text-size"].possiblyEvaluate(new Ii(18),o);var g,_=24*l.get("text-line-height"),b="map"===l.get("text-rotation-alignment")&&"point"!==l.get("symbol-placement"),x=l.get("text-keep-upright"),w=l.get("text-size"),E=f(e.features);try{var S=function(){var a=g.value,s=l.get("text-font").evaluate(a,{},o).join(","),u=w.evaluate(a,{},o),h=c.layoutTextSize.evaluate(a,{},o),f=(c.layoutIconSize.evaluate(a,{},o),{horizontal:{},vertical:void 0}),d=a.text,p=void 0,m=[0,0];if(d){var v=d.toString(),y=24*l.get("text-letter-spacing").evaluate(a,{},o),E=pi(v)?y:0,S=l.get("text-anchor").evaluate(a,{},o),T=l.get("text-variable-anchor");if(!T){var k=l.get("text-radial-offset").evaluate(a,{},o);m=k?Gu(S,[24*k,Hu]):l.get("text-offset").evaluate(a,{},o).map((function(e){return 24*e}))}var M=b?"center":l.get("text-justify").evaluate(a,{},o),C=l.get("symbol-placement"),A="point"===C?24*l.get("text-max-width").evaluate(a,{},o):0,I=function(){e.allowVerticalPlacement&&di(v)&&(f.vertical=du(d,t,n,i,s,A,_,S,"left",E,m,cu.vertical,!0,C,h,u))};if(!b&&T){for(var P="auto"===M?T.map((function(e){return qu(e)})):[M],R=!1,L=0;L<P.length;L++){var O=P[L];if(!f.horizontal[O])if(R)f.horizontal[O]=f.horizontal[0];else{var D=du(d,t,n,i,s,A,_,"center",O,E,m,cu.horizontal,!1,C,h,u);D&&(f.horizontal[O]=D,R=1===D.positionedLines.length)}}I()}else{"auto"===M&&(M=qu(S));var N=du(d,t,n,i,s,A,_,S,M,E,m,cu.horizontal,!1,C,h,u);N&&(f.horizontal[M]=N),I(),di(v)&&b&&x&&(f.vertical=du(d,t,n,i,s,A,_,S,M,E,m,cu.vertical,!1,C,h,u))}}var z=!1;if(a.icon&&a.icon.name){var F=r[a.icon.name];F&&(p=Eu(i[a.icon.name],l.get("icon-offset").evaluate(a,{},o),l.get("icon-anchor").evaluate(a,{},o)),z=F.sdf,void 0===e.sdfIcons?e.sdfIcons=F.sdf:e.sdfIcons!==F.sdf&&V("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(F.pixelRatio!==e.pixelRatio||0!==l.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0))}var B=Ku(f.horizontal)||f.vertical;e.iconsInText=!!B&&B.iconsInText,(B||p)&&Xu(e,a,f,p,r,c,h,0,m,z,o)};for(E.s();!(g=E.n()).done;)S()}catch(T){E.e(T)}finally{E.f()}a&&e.generateCollisionDebugBuffers(s,e.collisionBoxArray)}function qu(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Xu(e,t,n,r,i,a,o,s,l,u,c){var d=a.textMaxSize.evaluate(t,{},c);void 0===d&&(d=o);var p,m=e.layers[0].layout,v=m.get("icon-offset").evaluate(t,{},c),y=Ku(n.horizontal),g=o/24,_=e.tilePixelRatio*g,b=e.tilePixelRatio*d/24,x=e.tilePixelRatio*m.get("symbol-spacing"),w=m.get("text-padding")*e.tilePixelRatio,E=m.get("icon-padding")*e.tilePixelRatio,T=S(m.get("text-max-angle")),k="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement"),M="map"===m.get("icon-rotation-alignment")&&"point"!==m.get("symbol-placement"),C=m.get("symbol-placement"),A=x/2,I=m.get("icon-text-fit");r&&"none"!==I&&(e.allowVerticalPlacement&&n.vertical&&(p=Su(r,n.vertical,I,m.get("icon-text-fit-padding"),v,g)),y&&(r=Su(r,y,I,m.get("icon-text-fit-padding"),v,g)));var P=function(s,f){f.x<0||f.x>=8192||f.y<0||f.y>=8192||function(e,t,n,r,i,a,o,s,l,u,c,f,d,p,m,v,y,g,_,b,x,w,E,S,T){var k,M,C,A,I,P,R,L,O,D=e.addToLineVertexArray(t,n),N=0,z=0,F=0,B=0,U=-1,j=-1,H={},G=Pa(""),W=0,q=0;if(void 0===s._unevaluatedLayout.getValue("text-radial-offset")?(k=s.layout.get("text-offset").evaluate(x,{},S).map((function(e){return 24*e})),W=(M=h(k,2))[0],q=M[1]):(W=24*s.layout.get("text-radial-offset").evaluate(x,{},S),q=Hu),e.allowVerticalPlacement&&r.vertical){var X=r.vertical;if(m)L=Ju(X),o&&(O=Ju(o));else{var Z=s.layout.get("text-rotate").evaluate(x,{},S)+90;I=Yu(l,t,u,c,f,X,0,p,Z),o&&(P=Yu(l,t,u,c,f,o,0,g,Z))}}if(i){var K=s.layout.get("icon-rotate").evaluate(x,{},S),Y="none"!==s.layout.get("icon-text-fit"),J=Lu(i,K,E,Y),Q=o?Lu(o,K,E,Y):void 0;A=Yu(l,t,u,c,f,i,0,g,K),N=4*J.length;var $=e.iconSizeData,ee=null;"source"===$.kind?(ee=[128*s.layout.get("icon-size").evaluate(x,{},S)])[0]>32640&&V("".concat(e.layerIds[0],': Value for "icon-size" is >= 255. Reduce your "icon-size".')):"composite"===$.kind&&((ee=[128*w.compositeIconSizes[0].evaluate(x,{},S),128*w.compositeIconSizes[1].evaluate(x,{},S)])[0]>32640||ee[1]>32640)&&V("".concat(e.layerIds[0],': Value for "icon-size" is >= 255. Reduce your "icon-size".')),e.addSymbols(e.icon,J,ee,b,_,x,!1,t,D.lineStartIndex,D.lineLength,-1,S),U=e.icon.placedSymbolArray.length-1,Q&&(z=4*Q.length,e.addSymbols(e.icon,Q,ee,b,_,x,cu.vertical,t,D.lineStartIndex,D.lineLength,-1,S),j=e.icon.placedSymbolArray.length-1)}for(var te in r.horizontal){var ne=r.horizontal[te];C||(G=Pa(ne.text),m?R=Ju(ne):C=Yu(l,t,u,c,f,ne,0,p,s.layout.get("text-rotate").evaluate(x,{},S)));var re=1===ne.positionedLines.length;if(F+=Zu(e,t,ne,a,s,m,x,v,D,r.vertical?cu.horizontal:cu.horizontalOnly,re?Object.keys(r.horizontal):[te],H,U,w,S),re)break}r.vertical&&(B+=Zu(e,t,r.vertical,a,s,m,x,v,D,cu.vertical,["vertical"],H,j,w,S));var ie=-1,ae=function(e,t){return e?Math.max(e,t):t};ie=ae(R,ie),ie=ae(L,ie);var oe=(ie=ae(O,ie))>-1?1:0;oe&&(ie*=T/24),e.glyphOffsetArray.length>=oc.MAX_GLYPHS&&V("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,H.right>=0?H.right:-1,H.center>=0?H.center:-1,H.left>=0?H.left:-1,H.vertical||-1,U,j,G,void 0!==C?C:e.collisionBoxArray.length,void 0!==C?C+1:e.collisionBoxArray.length,void 0!==I?I:e.collisionBoxArray.length,void 0!==I?I+1:e.collisionBoxArray.length,void 0!==A?A:e.collisionBoxArray.length,void 0!==A?A+1:e.collisionBoxArray.length,P||e.collisionBoxArray.length,P?P+1:e.collisionBoxArray.length,u,F,B,N,z,oe,0,d,W,q,ie)}(e,f,s,n,r,i,p,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,_,w,k,l,0,E,M,v,t,a,u,c,o)};if("line"===C){var R,L=f(Ru(t.geometry,0,0,8192,8192));try{for(L.s();!(R=L.n()).done;){var O,D=R.value,N=Pu(D,x,T,n.vertical||y,r,24,b,e.overscaling,8192),z=f(N);try{for(z.s();!(O=z.n()).done;){var F=O.value;y&&Qu(e,y.text,A,F)||P(D,F)}}catch(re){z.e(re)}finally{z.f()}}}catch(re){L.e(re)}finally{L.f()}}else if("line-center"===C){var B,U=f(t.geometry);try{for(U.s();!(B=U.n()).done;){var j=B.value;if(j.length>1){var H=Iu(j,T,n.vertical||y,r,24,b);H&&P(j,H)}}}catch(re){U.e(re)}finally{U.f()}}else if("Polygon"===t.type){var G,W=f(Hs(t.geometry,0));try{for(W.s();!(G=W.n()).done;){var q=G.value,X=Uu(q,16);P(q[0],new Tu(X.x,X.y,0))}}catch(re){W.e(re)}finally{W.f()}}else if("LineString"===t.type){var Z,K=f(t.geometry);try{for(K.s();!(Z=K.n()).done;){var Y=Z.value;P(Y,new Tu(Y[0].x,Y[0].y,0))}}catch(re){K.e(re)}finally{K.f()}}else if("Point"===t.type){var J,Q=f(t.geometry);try{for(Q.s();!(J=Q.n()).done;){var $,ee=J.value,te=f(ee);try{for(te.s();!($=te.n()).done;){var ne=$.value;P([ne],new Tu(ne.x,ne.y,0))}}catch(re){te.e(re)}finally{te.f()}}}catch(re){Q.e(re)}finally{Q.f()}}}function Zu(e,t,n,i,o,s,l,u,h,d,p,m,v,y,g){var _=function(e,t,n,i,o,s,l,u){var h,d=i.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,p=[],m=f(t.positionedLines);try{for(m.s();!(h=m.n()).done;){var v,y=h.value,g=f(y.positionedGlyphs);try{for(g.s();!(v=g.n()).done;){var _=v.value;if(_.rect){var b=_.rect||{},x=4,w=!0,E=1,S=0,T=(o||u)&&_.vertical,k=_.metrics.advance*_.scale/2;if(u&&t.verticalizable){var M=24*(_.scale-1),C=(24-_.metrics.width*_.scale)/2;S=y.lineOffset/2-(_.imageName?-C:M)}if(_.imageName){var A=l[_.imageName];w=A.sdf,x=1/(E=A.pixelRatio)}var I=o?[_.x+k,_.y]:[0,0],P=o?[0,0]:[_.x+k+n[0],_.y+n[1]-S],R=[0,0];T&&(R=P,P=[0,0]);var L=(_.metrics.left-x)*_.scale-k+P[0],O=(-_.metrics.top-x)*_.scale+P[1],D=L+b.w*_.scale/E,N=O+b.h*_.scale/E,z=new r(L,O),F=new r(D,O),B=new r(L,N),U=new r(D,N);if(T){var j=new r(-k,k- -17),V=-Math.PI/2,H=12-k,G=new r(22-H,-(_.imageName?H:0)),W=a(r,c(R));z._rotateAround(V,j)._add(G)._add(W),F._rotateAround(V,j)._add(G)._add(W),B._rotateAround(V,j)._add(G)._add(W),U._rotateAround(V,j)._add(G)._add(W)}if(d){var q=Math.sin(d),X=Math.cos(d),Z=[X,-q,q,X];z._matMult(Z),F._matMult(Z),B._matMult(Z),U._matMult(Z)}var K=new r(0,0),Y=new r(0,0);p.push({tl:z,tr:F,bl:B,br:U,tex:b,writingMode:t.writingMode,glyphOffset:I,sectionIndex:_.sectionIndex,isSDF:w,pixelOffsetTL:K,pixelOffsetBR:Y,minFontScaleX:0,minFontScaleY:0})}}}catch(J){g.e(J)}finally{g.f()}}}catch(J){m.e(J)}finally{m.f()}return p}(0,n,u,o,s,l,i,e.allowVerticalPlacement),b=e.textSizeData,x=null;"source"===b.kind?(x=[128*o.layout.get("text-size").evaluate(l,{},g)])[0]>32640&&V("".concat(e.layerIds[0],': Value for "text-size" is >= 255. Reduce your "text-size".')):"composite"===b.kind&&((x=[128*y.compositeTextSizes[0].evaluate(l,{},g),128*y.compositeTextSizes[1].evaluate(l,{},g)])[0]>32640||x[1]>32640)&&V("".concat(e.layerIds[0],': Value for "text-size" is >= 255. Reduce your "text-size".')),e.addSymbols(e.text,_,x,u,s,l,d,t,h.lineStartIndex,h.lineLength,v,g);var w,E=f(p);try{for(E.s();!(w=E.n()).done;)m[w.value]=e.text.placedSymbolArray.length-1}catch(S){E.e(S)}finally{E.f()}return 4*_.length}function Ku(e){for(var t in e)return e[t];return null}function Yu(e,t,n,i,a,o,s,l,u){var c=o.top,h=o.bottom,f=o.left,d=o.right,p=o.collisionPadding;if(p&&(f-=p[0],c-=p[1],d+=p[2],h+=p[3]),u){var m=new r(f,c),v=new r(d,c),y=new r(f,h),g=new r(d,h),_=S(u);m._rotate(_),v._rotate(_),y._rotate(_),g._rotate(_),f=Math.min(m.x,v.x,y.x,g.x),d=Math.max(m.x,v.x,y.x,g.x),c=Math.min(m.y,v.y,y.y,g.y),h=Math.max(m.y,v.y,y.y,g.y)}return e.emplaceBack(t.x,t.y,f,c,d,h,l,n,i,a),e.length-1}function Ju(e){e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);var t=e.bottom-e.top;return t>0?Math.max(10,t):null}function Qu(e,t,n,r){var i=e.compareText;if(t in i){for(var a=i[t],o=a.length-1;o>=0;o--)if(r.dist(a[o])<n)return!0}else i[t]=[];return i[t].push(r),!1}var $u=sl.VectorTileFeature.types,ec=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function tc(e,t,n,r,i,a,o,s,l,u,c,h,f){var d=s?Math.min(32640,Math.round(s[0])):0,p=s?Math.min(32640,Math.round(s[1])):0;e.emplaceBack(t,n,Math.round(32*r),Math.round(32*i),a,o,(d<<1)+(l?1:0),p,16*u,16*c,256*h,256*f)}function nc(e,t,n){e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n),e.emplaceBack(t.x,t.y,n)}function rc(e){var t,n=f(e.sections);try{for(n.s();!(t=n.n()).done;)if(bi(t.value.text))return!0}catch(r){n.e(r)}finally{n.f()}return!1}var ic=function(){function e(t){v(this,e),this.layoutVertexArray=new na,this.indexArray=new ua,this.programConfigurations=t,this.segments=new eo,this.dynamicLayoutVertexArray=new ra,this.opacityVertexArray=new ia,this.placedSymbolArray=new xa}return y(e,[{key:"isEmpty",value:function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}},{key:"upload",value:function(e,t,n,r){this.isEmpty()||(n&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kl.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Ml.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,ec,!0),this.opacityVertexBuffer.itemSize=1),(n||r)&&this.programConfigurations.upload(e))}},{key:"destroy",value:function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}]),e}();ai("SymbolBuffers",ic);var ac=function(){function e(t,n,r){v(this,e),this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new r,this.segments=new eo,this.collisionVertexArray=new la,this.collisionVertexArrayExt=new ra}return y(e,[{key:"upload",value:function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Cl.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Al.members,!0)}},{key:"destroy",value:function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}]),e}();ai("CollisionBuffers",ac);var oc=function(){function e(t){v(this,e),this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(e){return e.id})),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Co([]),this.placementViewportMatrix=Co([]);var n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Rl(this.zoom,n["text-size"]),this.iconSizeData=Rl(this.zoom,n["icon-size"]);var r=this.layers[0].layout,i=r.get("symbol-sort-key"),a=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==a&&void 0!==i.constantOr(1),this.sortFeaturesByY=("viewport-y"===a||"auto"===a&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===r.get("symbol-placement")&&(this.writingModes=r.get("text-writing-mode").map((function(e){return cu[e]}))),this.stateDependentLayerIds=this.layers.filter((function(e){return e.isStateDependent()})).map((function(e){return e.id})),this.sourceID=t.sourceID}return y(e,[{key:"createArrays",value:function(){this.text=new ic(new Ka(this.layers,this.zoom,(function(e){return/^text/.test(e)}))),this.icon=new ic(new Ka(this.layers,this.zoom,(function(e){return/^icon/.test(e)}))),this.glyphOffsetArray=new Sa,this.lineVertexArray=new Ta,this.symbolInstances=new Ea}},{key:"calculateGlyphDependencies",value:function(e,t,n,r,i){for(var a=0;a<e.length;a++)if(t[e.charCodeAt(a)]=!0,(n||r)&&i){var o=zl[e.charAt(a)];o&&(t[o.charCodeAt(0)]=!0)}}},{key:"populate",value:function(e,t,n){var r=this.layers[0],i=r.layout,a=i.get("text-font"),o=i.get("text-field"),s=i.get("icon-image"),l=("constant"!==o.value.kind||o.value.value instanceof St&&!o.value.value.isEmpty()||o.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),u="constant"!==s.value.kind||!!s.value.value||Object.keys(s.parameters).length>0,c=i.get("symbol-sort-key");if(this.features=[],l||u){var h,d=t.iconDependencies,p=t.glyphDependencies,m=t.availableImages,v=new Ii(this.zoom),y=f(e);try{for(y.s();!(h=y.n()).done;){var g=h.value,_=g.feature,b=g.id,x=g.index,w=g.sourceLayerIndex,E=r._featureFilter.needGeometry,S=io(_,E);if(r._featureFilter.filter(v,S,n)){var T=void 0,k=void 0;if(E||(S.geometry=ro(_)),l){var M=r.getValueAndResolveTokens("text-field",S,n,m),C=St.factory(M);rc(C)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Mi()||this.hasRTLText&&Ai.isParsed())&&(T=Nl(C,r,S))}if(u){var A=r.getValueAndResolveTokens("icon-image",S,n,m);k=A instanceof Tt?A:Tt.fromString(A)}if(T||k){var I=this.sortFeaturesByKey?c.evaluate(S,{},n):void 0;if(this.features.push({id:b,text:T,icon:k,index:x,sourceLayerIndex:w,geometry:S.geometry,properties:_.properties,type:$u[_.type],sortKey:I}),k&&(d[k.name]=!0),T){var P=a.evaluate(S,{},n).join(","),R="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(cu.vertical)>=0;var L,O=f(T.sections);try{for(O.s();!(L=O.n()).done;){var D=L.value;if(D.image)d[D.image.name]=!0;else{var N=di(T.toString()),z=D.fontStack||P,F=p[z]=p[z]||{};this.calculateGlyphDependencies(D.text,F,R,this.allowVerticalPlacement,N)}}}catch(B){O.e(B)}finally{O.f()}}}}}}catch(B){y.e(B)}finally{y.f()}"line"===i.get("symbol-placement")&&(this.features=function(e){var t={},n={},r=[],i=0;function a(t){r.push(e[t]),i++}function o(e,t,i){var a=n[e];return delete n[e],n[t]=a,r[a].geometry[0].pop(),r[a].geometry[0]=r[a].geometry[0].concat(i[0]),a}function s(e,n,i){var a=t[n];return delete t[n],t[e]=a,r[a].geometry[0].shift(),r[a].geometry[0]=i[0].concat(r[a].geometry[0]),a}function l(e,t,n){var r=n?t[0][t[0].length-1]:t[0][0];return"".concat(e,":").concat(r.x,":").concat(r.y)}for(var u=0;u<e.length;u++){var c=e[u],h=c.geometry,f=c.text?c.text.toString():null;if(f){var d=l(f,h),p=l(f,h,!0);if(d in n&&p in t&&n[d]!==t[p]){var m=s(d,p,h),v=o(d,p,r[m].geometry);delete t[d],delete n[p],n[l(f,r[v].geometry,!0)]=v,r[m].geometry=null}else d in n?o(d,p,h):p in t?s(d,p,h):(a(u),t[d]=i-1,n[p]=i-1)}else a(u)}return r.filter((function(e){return e.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(e,t){return e.sortKey-t.sortKey}))}}},{key:"update",value:function(e,t,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,n),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,n))}},{key:"isEmpty",value:function(){return 0===this.symbolInstances.length&&!this.hasRTLText}},{key:"uploadPending",value:function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}},{key:"upload",value:function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}},{key:"destroyDebugData",value:function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}},{key:"destroy",value:function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}},{key:"addToLineVertexArray",value:function(e,t){var n=this.lineVertexArray.length;if(void 0!==e.segment){for(var r=e.dist(t[e.segment+1]),i=e.dist(t[e.segment]),a={},o=e.segment+1;o<t.length;o++)a[o]={x:t[o].x,y:t[o].y,tileUnitDistanceFromAnchor:r},o<t.length-1&&(r+=t[o+1].dist(t[o]));for(var s=e.segment||0;s>=0;s--)a[s]={x:t[s].x,y:t[s].y,tileUnitDistanceFromAnchor:i},s>0&&(i+=t[s-1].dist(t[s]));for(var l=0;l<t.length;l++){var u=a[l];this.lineVertexArray.emplaceBack(u.x,u.y,u.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}},{key:"addSymbols",value:function(e,t,n,r,i,a,o,s,l,u,c,h){for(var f=e.indexArray,d=e.layoutVertexArray,p=e.segments.prepareSegment(4*t.length,d,f,this.canOverlap?a.sortKey:void 0),m=this.glyphOffsetArray.length,v=p.vertexLength,y=this.allowVerticalPlacement&&o===cu.vertical?Math.PI/2:0,g=a.text&&a.text.sections,_=0;_<t.length;_++){var b=t[_],x=b.tl,w=b.tr,E=b.bl,S=b.br,T=b.tex,k=b.pixelOffsetTL,M=b.pixelOffsetBR,C=b.minFontScaleX,A=b.minFontScaleY,I=b.glyphOffset,P=b.isSDF,R=b.sectionIndex,L=p.vertexLength,O=I[1];tc(d,s.x,s.y,x.x,O+x.y,T.x,T.y,n,P,k.x,k.y,C,A),tc(d,s.x,s.y,w.x,O+w.y,T.x+T.w,T.y,n,P,M.x,k.y,C,A),tc(d,s.x,s.y,E.x,O+E.y,T.x,T.y+T.h,n,P,k.x,M.y,C,A),tc(d,s.x,s.y,S.x,O+S.y,T.x+T.w,T.y+T.h,n,P,M.x,M.y,C,A),nc(e.dynamicLayoutVertexArray,s,y),f.emplaceBack(L,L+1,L+2),f.emplaceBack(L+1,L+2,L+3),p.vertexLength+=4,p.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(I[0]),_!==t.length-1&&R===t[_+1].sectionIndex||e.programConfigurations.populatePaintArrays(d.length,a,a.index,{},h,g&&g[R])}e.placedSymbolArray.emplaceBack(s.x,s.y,m,this.glyphOffsetArray.length-m,v,l,u,s.segment,n?n[0]:0,n?n[1]:0,r[0],r[1],o,0,!1,0,c)}},{key:"_commitLayoutVertex",value:function(e,t,n,r,i){e.emplaceBack(t.x,t.y,n,r,Math.round(i.x),Math.round(i.y))}},{key:"_addCollisionDebugVertices",value:function(e,t,n,i,a){for(var o=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),s=o.vertexLength,l=a.anchorX,u=a.anchorY,c=0;c<4;c++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(t,-e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,-e.padding),n.collisionVertexArrayExt.emplaceBack(t,e.padding,e.padding),n.collisionVertexArrayExt.emplaceBack(t,-e.padding,e.padding),this._commitLayoutVertex(n.layoutVertexArray,i,l,u,new r(e.x1,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,l,u,new r(e.x2,e.y1)),this._commitLayoutVertex(n.layoutVertexArray,i,l,u,new r(e.x2,e.y2)),this._commitLayoutVertex(n.layoutVertexArray,i,l,u,new r(e.x1,e.y2)),o.vertexLength+=4;var h=n.indexArray;h.emplaceBack(s,s+1),h.emplaceBack(s+1,s+2),h.emplaceBack(s+2,s+3),h.emplaceBack(s+3,s),o.primitiveLength+=4}},{key:"_addTextDebugCollisionBoxes",value:function(e,t,n,r,i,a){for(var o=r;o<i;o++){var s=n.get(o),l=this.getSymbolInstanceTextSize(e,a,t,o);this._addCollisionDebugVertices(s,l,this.textCollisionBox,s.anchorPoint,a)}}},{key:"_addIconDebugCollisionBoxes",value:function(e,t,n,r,i,a){for(var o=r;o<i;o++){var s=n.get(o),l=this.getSymbolInstanceIconSize(e,t,o);this._addCollisionDebugVertices(s,l,this.iconCollisionBox,s.anchorPoint,a)}}},{key:"generateCollisionDebugBuffers",value:function(e,t){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ac(oa,Il.members,ma),this.iconCollisionBox=new ac(oa,Il.members,ma);for(var n=Ol(this.iconSizeData,e),r=Ol(this.textSizeData,e),i=0;i<this.symbolInstances.length;i++){var a=this.symbolInstances.get(i);this._addTextDebugCollisionBoxes(r,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._addTextDebugCollisionBoxes(r,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._addIconDebugCollisionBoxes(n,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a),this._addIconDebugCollisionBoxes(n,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a)}}},{key:"getSymbolInstanceTextSize",value:function(e,t,n,r){var i=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:r),a=Ll(this.textSizeData,e,i)/24;return this.tilePixelRatio*a}},{key:"getSymbolInstanceIconSize",value:function(e,t,n){var r=this.icon.placedSymbolArray.get(n),i=Ll(this.iconSizeData,e,r);return this.tilePixelRatio*i}},{key:"_commitDebugCollisionVertexUpdate",value:function(e,t,n){e.emplaceBack(t,-n,-n),e.emplaceBack(t,n,-n),e.emplaceBack(t,n,n),e.emplaceBack(t,-n,n)}},{key:"_updateTextDebugCollisionBoxes",value:function(e,t,n,r,i,a){for(var o=r;o<i;o++){var s=n.get(o),l=this.getSymbolInstanceTextSize(e,a,t,o);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,l,s.padding)}}},{key:"_updateIconDebugCollisionBoxes",value:function(e,t,n,r,i){for(var a=r;a<i;a++){var o=n.get(a),s=this.getSymbolInstanceIconSize(e,t,a);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,s,o.padding)}}},{key:"updateCollisionDebugBuffers",value:function(e,t){if(this.hasDebugData()){this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();for(var n=Ol(this.iconSizeData,e),r=Ol(this.textSizeData,e),i=0;i<this.symbolInstances.length;i++){var a=this.symbolInstances.get(i);this._updateTextDebugCollisionBoxes(r,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a),this._updateTextDebugCollisionBoxes(r,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a),this._updateIconDebugCollisionBoxes(n,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(n,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}}},{key:"_deserializeCollisionBoxesForSymbol",value:function(e,t,n,r,i,a,o,s,l){for(var u={},c=t;c<n;c++){var h=e.get(c);u.textBox={x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,padding:h.padding,anchorPointX:h.anchorPointX,anchorPointY:h.anchorPointY},u.textFeatureIndex=h.featureIndex;break}for(var f=r;f<i;f++){var d=e.get(f);u.verticalTextBox={x1:d.x1,y1:d.y1,x2:d.x2,y2:d.y2,padding:d.padding,anchorPointX:d.anchorPointX,anchorPointY:d.anchorPointY},u.verticalTextFeatureIndex=d.featureIndex;break}for(var p=a;p<o;p++){var m=e.get(p);u.iconBox={x1:m.x1,y1:m.y1,x2:m.x2,y2:m.y2,padding:m.padding,anchorPointX:m.anchorPointX,anchorPointY:m.anchorPointY},u.iconFeatureIndex=m.featureIndex;break}for(var v=s;v<l;v++){var y=e.get(v);u.verticalIconBox={x1:y.x1,y1:y.y1,x2:y.x2,y2:y.y2,padding:y.padding,anchorPointX:y.anchorPointX,anchorPointY:y.anchorPointY},u.verticalIconFeatureIndex=y.featureIndex;break}return u}},{key:"deserializeCollisionBoxes",value:function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var n=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}},{key:"hasTextData",value:function(){return this.text.segments.get().length>0}},{key:"hasIconData",value:function(){return this.icon.segments.get().length>0}},{key:"hasDebugData",value:function(){return this.textCollisionBox&&this.iconCollisionBox}},{key:"hasTextCollisionBoxData",value:function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}},{key:"hasIconCollisionBoxData",value:function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}},{key:"addIndicesForPlacedSymbol",value:function(e,t){for(var n=e.placedSymbolArray.get(t),r=n.vertexStartIndex+4*n.numGlyphs,i=n.vertexStartIndex;i<r;i+=4)e.indexArray.emplaceBack(i,i+1,i+2),e.indexArray.emplaceBack(i+1,i+2,i+3)}},{key:"getSortedSymbolIndexes",value:function(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var t=Math.sin(e),n=Math.cos(e),r=[],i=[],a=[],o=0;o<this.symbolInstances.length;++o){a.push(o);var s=this.symbolInstances.get(o);r.push(0|Math.round(t*s.anchorX+n*s.anchorY)),i.push(s.featureIndex)}return a.sort((function(e,t){return r[e]-r[t]||i[t]-i[e]})),a}},{key:"addToSortKeyRanges",value:function(e,t){var n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===t?n.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}},{key:"sortFeatures",value:function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];var n,r=f(this.symbolInstanceIndexes);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((function(e,n,r){e>=0&&r.indexOf(e)===n&&t.addIndicesForPlacedSymbol(t.text,e)})),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}}catch(o){r.e(o)}finally{r.f()}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}]),e}();ai("SymbolBucket",oc,{omit:["layers","collisionBoxArray","features","compareText"]}),oc.MAX_GLYPHS=65535,oc.addDynamicAttributes=nc;var sc=new Gi({"symbol-placement":new Bi(Ke.layout_symbol["symbol-placement"]),"symbol-spacing":new Bi(Ke.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Bi(Ke.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ui(Ke.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Bi(Ke.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Bi(Ke.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Bi(Ke.layout_symbol["icon-ignore-placement"]),"icon-optional":new Bi(Ke.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Bi(Ke.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ui(Ke.layout_symbol["icon-size"]),"icon-text-fit":new Bi(Ke.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Bi(Ke.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ui(Ke.layout_symbol["icon-image"]),"icon-rotate":new Ui(Ke.layout_symbol["icon-rotate"]),"icon-padding":new Bi(Ke.layout_symbol["icon-padding"]),"icon-keep-upright":new Bi(Ke.layout_symbol["icon-keep-upright"]),"icon-offset":new Ui(Ke.layout_symbol["icon-offset"]),"icon-anchor":new Ui(Ke.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Bi(Ke.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Bi(Ke.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Bi(Ke.layout_symbol["text-rotation-alignment"]),"text-field":new Ui(Ke.layout_symbol["text-field"]),"text-font":new Ui(Ke.layout_symbol["text-font"]),"text-size":new Ui(Ke.layout_symbol["text-size"]),"text-max-width":new Ui(Ke.layout_symbol["text-max-width"]),"text-line-height":new Bi(Ke.layout_symbol["text-line-height"]),"text-letter-spacing":new Ui(Ke.layout_symbol["text-letter-spacing"]),"text-justify":new Ui(Ke.layout_symbol["text-justify"]),"text-radial-offset":new Ui(Ke.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Bi(Ke.layout_symbol["text-variable-anchor"]),"text-anchor":new Ui(Ke.layout_symbol["text-anchor"]),"text-max-angle":new Bi(Ke.layout_symbol["text-max-angle"]),"text-writing-mode":new Bi(Ke.layout_symbol["text-writing-mode"]),"text-rotate":new Ui(Ke.layout_symbol["text-rotate"]),"text-padding":new Bi(Ke.layout_symbol["text-padding"]),"text-keep-upright":new Bi(Ke.layout_symbol["text-keep-upright"]),"text-transform":new Ui(Ke.layout_symbol["text-transform"]),"text-offset":new Ui(Ke.layout_symbol["text-offset"]),"text-allow-overlap":new Bi(Ke.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Bi(Ke.layout_symbol["text-ignore-placement"]),"text-optional":new Bi(Ke.layout_symbol["text-optional"])}),lc={paint:new Gi({"icon-opacity":new Ui(Ke.paint_symbol["icon-opacity"]),"icon-color":new Ui(Ke.paint_symbol["icon-color"]),"icon-halo-color":new Ui(Ke.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ui(Ke.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ui(Ke.paint_symbol["icon-halo-blur"]),"icon-translate":new Bi(Ke.paint_symbol["icon-translate"]),"icon-translate-anchor":new Bi(Ke.paint_symbol["icon-translate-anchor"]),"text-opacity":new Ui(Ke.paint_symbol["text-opacity"]),"text-color":new Ui(Ke.paint_symbol["text-color"],{runtimeType:st,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new Ui(Ke.paint_symbol["text-halo-color"]),"text-halo-width":new Ui(Ke.paint_symbol["text-halo-width"]),"text-halo-blur":new Ui(Ke.paint_symbol["text-halo-blur"]),"text-translate":new Bi(Ke.paint_symbol["text-translate"]),"text-translate-anchor":new Bi(Ke.paint_symbol["text-translate-anchor"])}),layout:sc},uc=function(){function e(t){v(this,e),this.type=t.property.overrides?t.property.overrides.runtimeType:rt,this.defaultValue=t}return y(e,[{key:"evaluate",value:function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}},{key:"eachChild",value:function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}},{key:"outputDefined",value:function(){return!1}},{key:"serialize",value:function(){return null}}]),e}();ai("FormatSectionOverride",uc,{omit:["defaultValue"]});var cc=function(e){p(n,e);var t=m(n);function n(e){return v(this,n),t.call(this,e,lc)}return y(n,[{key:"recalculate",value:function(e,t){if(o(s(n.prototype),"recalculate",this).call(this,e,t),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var r=this.layout.get("text-writing-mode");if(r){var i,a=[],l=f(r);try{for(l.s();!(i=l.n()).done;){var u=i.value;a.indexOf(u)<0&&a.push(u)}}catch(c){l.e(c)}finally{l.f()}this.layout._values["text-writing-mode"]=a}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}},{key:"getValueAndResolveTokens",value:function(e,t,n,r){var i=this.layout.get(e).evaluate(t,{},n,r),a=this._unevaluatedLayout._values[e];return a.isDataDriven()||fr(a.value)||!i?i:function(e,t){return t.replace(/{([^{}]+)}/g,(function(t,n){return n in e?String(e[n]):""}))}(t.properties,i)}},{key:"createBucket",value:function(e){return new oc(e)}},{key:"queryRadius",value:function(){return 0}},{key:"queryIntersectsFeature",value:function(){return!1}},{key:"_setPaintOverrides",value:function(){var e,t=f(lc.paint.overridableProperties);try{for(t.s();!(e=t.n()).done;){var r=e.value;if(n.hasPaintOverride(this.layout,r)){var i=this.paint.get(r),a=new uc(i),o=new hr(a,i.property.specification),s=null;s="constant"===i.value.kind||"source"===i.value.kind?new pr("source",o):new mr("composite",o,i.value.zoomStops,i.value._interpolationType),this.paint._values[r]=new zi(i.property,s,i.parameters)}}}catch(l){t.e(l)}finally{t.f()}}},{key:"_handleOverridablePaintPropertyUpdate",value:function(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven())&&n.hasPaintOverride(this.layout,e)}},{key:"getProgramConfiguration",value:function(e){return new Za(this,e)}}],[{key:"hasPaintOverride",value:function(e,t){var n=e.get("text-field"),r=lc.paint.properties[t],i=!1,a=function(e){var t,n=f(e);try{for(n.s();!(t=n.n()).done;){var a=t.value;if(r.overrides&&r.overrides.hasOverride(a))return void(i=!0)}}catch(o){n.e(o)}finally{n.f()}};if("constant"===n.value.kind&&n.value.value instanceof St)a(n.value.value.sections);else if("source"===n.value.kind){var o=function e(t){i||(t instanceof It&&Ct(t.value)===ht?a(t.value.sections):t instanceof Ot?a(t.sections):t.eachChild(e))},s=n.value;s._styleExpression&&o(s._styleExpression.expression)}return i}}]),n}(Qa),hc={paint:new Gi({"background-color":new Bi(Ke.paint_background["background-color"]),"background-pattern":new Vi(Ke.paint_background["background-pattern"]),"background-opacity":new Bi(Ke.paint_background["background-opacity"])})},fc={paint:new Gi({"raster-opacity":new Bi(Ke.paint_raster["raster-opacity"]),"raster-hue-rotate":new Bi(Ke.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Bi(Ke.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Bi(Ke.paint_raster["raster-brightness-max"]),"raster-saturation":new Bi(Ke.paint_raster["raster-saturation"]),"raster-contrast":new Bi(Ke.paint_raster["raster-contrast"]),"raster-resampling":new Bi(Ke.paint_raster["raster-resampling"]),"raster-fade-duration":new Bi(Ke.paint_raster["raster-fade-duration"])})},dc=function(e){p(n,e);var t=m(n);function n(e){var r;return v(this,n),(r=t.call(this,e,{})).implementation=e,r}return y(n,[{key:"is3D",value:function(){return"3d"===this.implementation.renderingMode}},{key:"hasOffscreenPass",value:function(){return void 0!==this.implementation.prerender}},{key:"recalculate",value:function(){}},{key:"updateTransitions",value:function(){}},{key:"hasTransition",value:function(){}},{key:"serialize",value:function(){}},{key:"onAdd",value:function(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}},{key:"onRemove",value:function(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}]),n}(Qa),pc={paint:new Gi({"sky-type":new Bi(Ke.paint_sky["sky-type"]),"sky-atmosphere-sun":new Bi(Ke.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Bi(Ke.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Bi(Ke.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Bi(Ke.paint_sky["sky-gradient-radius"]),"sky-gradient":new Hi(Ke.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Bi(Ke.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Bi(Ke.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Bi(Ke.paint_sky["sky-opacity"])})};function mc(e,t,n){var r=Oo(0,0,1),i=Zo(Xo());return function(e,t,n){n*=.5;var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),l=Math.cos(n);e[0]=r*l-a*s,e[1]=i*l+o*s,e[2]=a*l+r*s,e[3]=o*l-i*s}(i,i,n?-S(e)+Math.PI:S(e)),Ko(i,i,-S(t)),Vo(r,r,i),Bo(r,r)}var vc={circle:function(e){p(n,e);var t=m(n);function n(e){return v(this,n),t.call(this,e,To)}return y(n,[{key:"createBucket",value:function(e){return new oo(e)}},{key:"queryRadius",value:function(e){var t=e;return bo("circle-radius",this,t)+bo("circle-stroke-width",this,t)+xo(this.paint.get("circle-translate"))}},{key:"queryIntersectsFeature",value:function(e,t,n,r,i,a,o,s){var l=this,u="map"===this.paint.get("circle-pitch-alignment");if(u&&e.queryGeometry.isAboveHorizon)return!1;var c,h=Eo(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),d=this.paint.get("circle-radius").evaluate(t,n)+this.paint.get("circle-stroke-width").evaluate(t,n),p=u?d*e.pixelToTileUnitsFactor:d,m=f(r);try{for(m.s();!(c=m.n()).done;){var v,y=c.value,g=f(y);try{var _=function(){var t=v.value,n=t.add(h),r=s&&a.elevation?a.elevation.exaggeration()*s.getElevationAt(n.x,n.y,!0):0,i=u?n:Qo(n,r,o),c=u?e.tilespaceRays.map((function(e){return ts(e,r)})):e.queryGeometry.screenGeometry,f=p,d=qo([],[t.x,t.y,r,1],o);if("viewport"===l.paint.get("circle-pitch-scale")&&"map"===l.paint.get("circle-pitch-alignment")?f*=d[3]/a.cameraToCenterDistance:"map"===l.paint.get("circle-pitch-scale")&&"viewport"===l.paint.get("circle-pitch-alignment")&&(f*=a.cameraToCenterDistance/d[3]),lo(c,i,f))return{v:!0}};for(g.s();!(v=g.n()).done;){var b=_();if("object"===typeof b)return b.v}}catch(x){g.e(x)}finally{g.f()}}}catch(x){m.e(x)}finally{m.f()}return!1}},{key:"getProgramIds",value:function(){return["circle"]}},{key:"getProgramConfiguration",value:function(e){return new Za(this,e)}}]),n}(Qa),heatmap:function(e){p(n,e);var t=m(n);function n(e){var r;return v(this,n),(r=t.call(this,e,ls))._updateColorRamp(),r}return y(n,[{key:"createBucket",value:function(e){return new ns(e)}}]),y(n,[{key:"_handleSpecialPaintPropertyUpdate",value:function(e){"heatmap-color"===e&&this._updateColorRamp()}},{key:"_updateColorRamp",value:function(){this.colorRamp=us({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}},{key:"resize",value:function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}},{key:"queryRadius",value:function(){return 0}},{key:"queryIntersectsFeature",value:function(){return!1}},{key:"hasOffscreenPass",value:function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}},{key:"getProgramIds",value:function(){return["heatmap","heatmapTexture"]}},{key:"getProgramConfiguration",value:function(e){return new Za(this,e)}}]),n}(Qa),hillshade:function(e){p(n,e);var t=m(n);function n(e){return v(this,n),t.call(this,e,cs)}return y(n,[{key:"hasOffscreenPass",value:function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}},{key:"getProgramIds",value:function(){return["hillshade","hillshadePrepare"]}},{key:"getProgramConfiguration",value:function(e){return new Za(this,e)}}]),n}(Qa),fill:function(e){p(n,e);var t=m(n);function n(e){return v(this,n),t.call(this,e,Ks)}return y(n,[{key:"getProgramIds",value:function(){var e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),n=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}},{key:"getProgramConfiguration",value:function(e){return new Za(this,e)}},{key:"recalculate",value:function(e,t){o(s(n.prototype),"recalculate",this).call(this,e,t);var r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}},{key:"createBucket",value:function(e){return new Xs(e)}},{key:"queryRadius",value:function(){return xo(this.paint.get("fill-translate"))}},{key:"queryIntersectsFeature",value:function(e,t,n,r,i,a){return!e.queryGeometry.isAboveHorizon&&uo(wo(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),a.angle,e.pixelToTileUnitsFactor),r)}},{key:"isTileClipped",value:function(){return!0}}]),n}(Qa),"fill-extrusion":function(e){p(n,e);var t=m(n);function n(e){return v(this,n),t.call(this,e,pl)}return y(n,[{key:"createBucket",value:function(e){return new fl(e)}},{key:"queryRadius",value:function(){return xo(this.paint.get("fill-extrusion-translate"))}},{key:"is3D",value:function(){return!0}},{key:"getProgramIds",value:function(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}},{key:"getProgramConfiguration",value:function(e){return new Za(this,e)}},{key:"queryIntersectsFeature",value:function(e,t,n,i,a,o,s){var l=Eo(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),u=this.paint.get("fill-extrusion-height").evaluate(t,n),c=this.paint.get("fill-extrusion-base").evaluate(t,n),h=e.queryGeometry.screenGeometry,d=function(e,t,n,i,a){var o,s=[],l=[],u=a[8]*t,c=a[9]*t,h=a[10]*t,d=a[11]*t,p=a[8]*n,m=a[9]*n,v=a[10]*n,y=a[11]*n,g=f(e);try{for(g.s();!(o=g.n()).done;){var _,b=o.value,x=[],w=[],E=f(b);try{for(E.s();!(_=E.n()).done;){var S=_.value,T=S.x+i.x,k=S.y+i.y,M=a[0]*T+a[4]*k+a[12],C=a[1]*T+a[5]*k+a[13],A=a[2]*T+a[6]*k+a[14],I=a[3]*T+a[7]*k+a[15],P=A+h,R=I+d,L=M+p,O=C+m,D=A+v,N=I+y,z=new r((M+u)/R,(C+c)/R);z.z=P/R,x.push(z);var F=new r(L/N,O/N);F.z=D/N,w.push(F)}}catch(B){E.e(B)}finally{E.f()}s.push(x),l.push(w)}}catch(B){g.e(B)}finally{g.f()}return[s,l]}(i,c,u,l,s);return function(e,t,n){var r=1/0;uo(n,t)&&(r=vl(n,t[0]));for(var i=0;i<t.length;i++)for(var a=t[i],o=e[i],s=0;s<a.length-1;s++){var l=a[s],u=[l,a[s+1],o[s+1],o[s],l];so(n,u)&&(r=Math.min(r,vl(n,u)))}return r!==1/0&&r}(d[0],d[1],h)}}]),n}(Qa),line:function(e){p(n,e);var t=m(n);function n(e){var r;return v(this,n),(r=t.call(this,e,El)).gradientVersion=0,r}return y(n,[{key:"_handleSpecialPaintPropertyUpdate",value:function(e){"line-gradient"===e&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof hn,this.gradientVersion=(this.gradientVersion+1)%x)}},{key:"gradientExpression",value:function(){return this._transitionablePaint._values["line-gradient"].value.expression}},{key:"recalculate",value:function(e,t){o(s(n.prototype),"recalculate",this).call(this,e,t),this.paint._values["line-floorwidth"]=Sl.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}},{key:"createBucket",value:function(e){return new xl(e)}},{key:"getProgramIds",value:function(){var e=this.paint.get("line-dasharray"),t=this.paint.get("line-pattern").constantOr(1),n=this.paint.get("line-gradient");return[t?"linePattern":e?"lineSDF":n?"lineGradient":"line"]}},{key:"getProgramConfiguration",value:function(e){return new Za(this,e)}},{key:"queryRadius",value:function(e){var t=e,n=Tl(bo("line-width",this,t),bo("line-gap-width",this,t)),r=bo("line-offset",this,t);return n/2+Math.abs(r)+xo(this.paint.get("line-translate"))}},{key:"queryIntersectsFeature",value:function(e,t,n,i,a,o){if(e.queryGeometry.isAboveHorizon)return!1;var s=wo(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),l=e.pixelToTileUnitsFactor/2*Tl(this.paint.get("line-width").evaluate(t,n),this.paint.get("line-gap-width").evaluate(t,n)),u=this.paint.get("line-offset").evaluate(t,n);return u&&(i=function(e,t){for(var n=[],i=new r(0,0),a=0;a<e.length;a++){for(var o=e[a],s=[],l=0;l<o.length;l++){var u=o[l-1],c=o[l],h=o[l+1],f=0===l?i:c.sub(u)._unit()._perp(),d=l===o.length-1?i:h.sub(c)._unit()._perp(),p=f._add(d)._unit();p._mult(1/(p.x*d.x+p.y*d.y)),s.push(p._mult(t)._add(c))}n.push(s)}return n}(i,u*e.pixelToTileUnitsFactor)),function(e,t,n){for(var r=0;r<t.length;r++){var i=t[r];if(e.length>=3)for(var a=0;a<i.length;a++)if(yo(e,i[a]))return!0;if(co(e,i,n))return!0}return!1}(s,i,l)}},{key:"isTileClipped",value:function(){return!0}}]),n}(Qa),symbol:cc,background:function(e){p(n,e);var t=m(n);function n(e){return v(this,n),t.call(this,e,hc)}return y(n,[{key:"getProgramIds",value:function(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}}]),n}(Qa),raster:function(e){p(n,e);var t=m(n);function n(e){return v(this,n),t.call(this,e,fc)}return y(n,[{key:"getProgramIds",value:function(){return["raster"]}}]),n}(Qa),sky:function(e){p(n,e);var t=m(n);function n(e){var r;return v(this,n),(r=t.call(this,e,pc))._updateColorRamp(),r}return y(n,[{key:"_handleSpecialPaintPropertyUpdate",value:function(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}},{key:"_updateColorRamp",value:function(){this.colorRamp=us({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}},{key:"needsSkyboxCapture",value:function(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){var t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}}},{key:"getCenter",value:function(e,t){var n=this.paint.get("sky-type");if("atmosphere"===n){var r=this.paint.get("sky-atmosphere-sun"),i=!r,a=e.style.light,o=a.properties.get("position");return i&&"viewport"===a.properties.get("anchor")&&V("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),i?mc(o.azimuthal,90-o.polar,t):mc(r[0],90-r[1],t)}if("gradient"===n){var s=this.paint.get("sky-gradient-center");return mc(s[0],90-s[1],t)}}},{key:"is3D",value:function(){return!1}},{key:"isSky",value:function(){return!0}},{key:"markSkyboxValid",value:function(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}},{key:"hasOffscreenPass",value:function(){return!0}},{key:"getProgramIds",value:function(){var e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}}]),n}(Qa)},yc=_.HTMLImageElement,gc=_.HTMLCanvasElement,_c=_.HTMLVideoElement,bc=_.ImageData,xc=_.ImageBitmap,wc=function(){function e(t,n,r,i){v(this,e),this.context=t,this.format=r,this.texture=t.gl.createTexture(),this.update(n,i)}return y(e,[{key:"update",value:function(e,t,n){var r=e.width,i=e.height,a=!(this.size&&this.size[0]===r&&this.size[1]===i||n),o=this.context,s=o.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!t||!1!==t.premultiply)),a)this.size=[r,i],e instanceof yc||e instanceof gc||e instanceof _c||e instanceof bc||xc&&e instanceof xc?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,e):s.texImage2D(s.TEXTURE_2D,0,this.format,r,i,0,this.format,s.UNSIGNED_BYTE,e.data);else{var l=n||{x:0,y:0},u=l.x,c=l.y;e instanceof yc||e instanceof gc||e instanceof _c||e instanceof bc||xc&&e instanceof xc?s.texSubImage2D(s.TEXTURE_2D,0,u,c,s.RGBA,s.UNSIGNED_BYTE,e):s.texSubImage2D(s.TEXTURE_2D,0,u,c,r,i,s.RGBA,s.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)}},{key:"bind",value:function(e,t,n){var r=this.context.gl;r.bindTexture(r.TEXTURE_2D,this.texture),n!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=r.LINEAR),e!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n||e),this.filter=e),t!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,t),this.wrap=t)}},{key:"isSizePowerOfTwo",value:function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}},{key:"destroy",value:function(){this.context.gl.deleteTexture(this.texture),this.texture=null}}]),e}(),Ec=function(){function e(t){var n=this;v(this,e),this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){n._triggered=!1,n._callback()})}return y(e,[{key:"trigger",value:function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){e._triggered=!1,e._callback()}),0))}},{key:"remove",value:function(){delete this._channel,this._callback=function(){}}}]),e}(),Sc=_.performance,Tc=function(){function e(t){v(this,e),this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},Sc.mark(this._marks.start)}return y(e,[{key:"finish",value:function(){Sc.mark(this._marks.end);var e=Sc.getEntriesByName(this._marks.measure);return 0===e.length&&(Sc.measure(this._marks.measure,this._marks.start,this._marks.end),e=Sc.getEntriesByName(this._marks.measure),Sc.clearMarks(this._marks.start),Sc.clearMarks(this._marks.end),Sc.clearMeasures(this._marks.measure)),e}}]),e}(),kc=function(){function e(){v(this,e),this.tasks={},this.taskQueue=[],N(["process"],this),this.invoker=new Ec(this.process),this.nextId=0}return y(e,[{key:"add",value:function(e,t){var n=this,r=this.nextId++;return this.tasks[r]={fn:e,metadata:t,priority:Mc(t),id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:function(){delete n.tasks[r]}}}},{key:"process",value:function(){var e=this;W();try{if(this.taskQueue=this.taskQueue.filter((function(t){return!!e.tasks[t]})),!this.taskQueue.length)return;var t=this.pick();if(null===t)return;var n=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}},{key:"pick",value:function(){for(var e=null,t=1/0,n=0;n<this.taskQueue.length;n++){var r=this.tasks[this.taskQueue[n]];r.priority<t&&(t=r.priority,e=n)}if(null===e)return null;var i=this.taskQueue[e];return this.taskQueue.splice(e,1),i}},{key:"remove",value:function(){this.invoker.remove()}}]),e}();function Mc(e){var t=e.type,n=e.isSymbolTile,r=e.zoom;return r=r||0,"message"===t?0:"maybePrepare"!==t||n?"parseTile"!==t||n?"parseTile"===t&&n?300-r:"maybePrepare"===t&&n?400-r:500:200-r:100-r}var Cc=function(){function e(t,n){v(this,e),t&&(n?this.setSouthWest(t).setNorthEast(n):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}return y(e,[{key:"setNorthEast",value:function(e){return this._ne=e instanceof Ac?new Ac(e.lng,e.lat):Ac.convert(e),this}},{key:"setSouthWest",value:function(e){return this._sw=e instanceof Ac?new Ac(e.lng,e.lat):Ac.convert(e),this}},{key:"extend",value:function(t){var n,r,i=this._sw,a=this._ne;if(t instanceof Ac)n=t,r=t;else{if(!(t instanceof e))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(e.convert(t)):this.extend(Ac.convert(t)):this;if(n=t._sw,r=t._ne,!n||!r)return this}return i||a?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),a.lng=Math.max(r.lng,a.lng),a.lat=Math.max(r.lat,a.lat)):(this._sw=new Ac(n.lng,n.lat),this._ne=new Ac(r.lng,r.lat)),this}},{key:"getCenter",value:function(){return new Ac((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}},{key:"getSouthWest",value:function(){return this._sw}},{key:"getNorthEast",value:function(){return this._ne}},{key:"getNorthWest",value:function(){return new Ac(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new Ac(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this._sw.lng}},{key:"getSouth",value:function(){return this._sw.lat}},{key:"getEast",value:function(){return this._ne.lng}},{key:"getNorth",value:function(){return this._ne.lat}},{key:"toArray",value:function(){return[this._sw.toArray(),this._ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this._sw.toString(),", ").concat(this._ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this._sw&&this._ne)}},{key:"contains",value:function(e){var t=Ac.convert(e),n=t.lng,r=t.lat,i=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&i}}],[{key:"convert",value:function(t){return!t||t instanceof e?t:new e(t)}}]),e}(),Ac=function(){function e(t,n){if(v(this,e),isNaN(t)||isNaN(n))throw new Error("Invalid LngLat object: (".concat(t,", ").concat(n,")"));if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return y(e,[{key:"wrap",value:function(){return new e(A(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(e){var t=Math.PI/180,n=this.lat*t,r=e.lat*t,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((e.lng-this.lng)*t);return 6371008.8*Math.acos(Math.min(i,1))}},{key:"toBounds",value:function(){var t=360*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/40075017,n=t/Math.cos(Math.PI/180*this.lat);return new Cc(new e(this.lng-n,this.lat-t),new e(this.lng+n,this.lat+t))}}],[{key:"convert",value:function(t){if(t instanceof e)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new e(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new e(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),e}(),Ic=2*Math.PI*6371008.8;function Pc(e){return Ic*Math.cos(e*Math.PI/180)}function Rc(e){return(180+e)/360}function Lc(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function Oc(e,t){return e/Pc(t)}function Dc(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function Nc(e,t){return e*Pc(Dc(t))}var zc=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;v(this,e),this.x=+t,this.y=+n,this.z=+r}return y(e,[{key:"toLngLat",value:function(){return new Ac(360*this.x-180,Dc(this.y))}},{key:"toAltitude",value:function(){return Nc(this.z,this.y)}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/Ic*(e=Dc(this.y),1/Math.cos(e*Math.PI/180));var e}}],[{key:"fromLngLat",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=Ac.convert(t);return new e(Rc(r.lng),Lc(r.lat),Oc(n,r.lat))}}]),e}();function Fc(e,t,n){var r=2*Math.PI*6378137/256/Math.pow(2,n);return[e*r-2*Math.PI*6378137/2,t*r-2*Math.PI*6378137/2]}var Bc=function(){function e(t,n,r){v(this,e),this.z=t,this.x=n,this.y=r,this.key=Vc(0,t,t,n,r)}return y(e,[{key:"equals",value:function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}},{key:"url",value:function(e,t){var n,r,i,a,o,s=(r=this.y,i=this.z,a=Fc(256*(n=this.x),256*(r=Math.pow(2,i)-r-1),i),o=Fc(256*(n+1),256*(r+1),i),a[0]+","+a[1]+","+o[0]+","+o[1]),l=function(e,t,n){for(var r,i="",a=e;a>0;a--)i+=(t&(r=1<<a-1)?1:0)+(n&r?2:0);return i}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",l).replace("{bbox-epsg-3857}",s)}},{key:"getTilePoint",value:function(e){var t=Math.pow(2,this.z);return new r(8192*(e.x*t-this.x),8192*(e.y*t-this.y))}},{key:"getTileVec3",value:function(e){var t=Math.pow(2,this.z);return Oo(8192*(e.x*t-this.x),8192*(e.y*t-this.y),Nc(e.z,e.y))}},{key:"toString",value:function(){return"".concat(this.z,"/").concat(this.x,"/").concat(this.y)}}]),e}(),Uc=function e(t,n){v(this,e),this.wrap=t,this.canonical=n,this.key=Vc(t,n.z,n.z,n.x,n.y)},jc=function(){function e(t,n,r,i,a){v(this,e),this.overscaledZ=t,this.wrap=n,this.canonical=new Bc(r,+i,+a),this.key=0===n&&t===r?this.canonical.key:Vc(n,t,r,i,a)}return y(e,[{key:"equals",value:function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}},{key:"scaledTo",value:function(t){var n=this.canonical.z-t;return t>this.canonical.z?new e(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new e(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}},{key:"calculateScaledKey",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Vc(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);var n=this.canonical.z-e;return Vc(this.wrap*+t,e,e,this.canonical.x>>n,this.canonical.y>>n)}},{key:"isChildOf",value:function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}},{key:"children",value:function(t){if(this.overscaledZ>=t)return[new e(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var n=this.canonical.z+1,r=2*this.canonical.x,i=2*this.canonical.y;return[new e(n,this.wrap,n,r,i),new e(n,this.wrap,n,r+1,i),new e(n,this.wrap,n,r,i+1),new e(n,this.wrap,n,r+1,i+1)]}},{key:"isLessThan",value:function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}},{key:"wrapped",value:function(){return new e(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}},{key:"unwrapTo",value:function(t){return new e(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}},{key:"overscaleFactor",value:function(){return Math.pow(2,this.overscaledZ-this.canonical.z)}},{key:"toUnwrapped",value:function(){return new Uc(this.wrap,this.canonical)}},{key:"toString",value:function(){return"".concat(this.overscaledZ,"/").concat(this.canonical.x,"/").concat(this.canonical.y)}},{key:"getTilePoint",value:function(e){return this.canonical.getTilePoint(new zc(e.x-this.wrap,e.y))}},{key:"getTileVec3",value:function(e){return this.canonical.getTileVec3(new zc(e.x-this.wrap,e.y,e.z))}}]),e}();function Vc(e,t,n,r,i){var a=1<<Math.min(n,22),o=a*(i%a)+r%a;return e&&n<22&&(o+=a*a*((e<0?-2*e-1:2*e)%(1<<2*(22-n)))),16*(32*o+n)+(t-n)}ai("CanonicalTileID",Bc),ai("OverscaledTileID",jc,{omit:["posMatrix"]});var Hc=function(){function e(t){v(this,e),this._stringToNumber={},this._numberToString=[];for(var n=0;n<t.length;n++){var r=t[n];this._stringToNumber[r]=n,this._numberToString[n]=r}}return y(e,[{key:"encode",value:function(e){return this._stringToNumber[e]}},{key:"decode",value:function(e){return this._numberToString[e]}}]),e}(),Gc=function(){function e(t,n,r,i,a){v(this,e),this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=r,t._y=i,this.properties=t.properties,this.id=a}return y(e,[{key:"toJSON",value:function(){var e={geometry:this.geometry};for(var t in this)"_geometry"!==t&&"_vectorTileFeature"!==t&&(e[t]=this[t]);return e}},{key:"geometry",get:function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},set:function(e){this._geometry=e}}]),e}(),Wc=Ki([{name:"a_pos",type:"Int16",components:2}]),qc=function(){function e(t,n,r){v(this,e),this.tileID=t,this.uid=L(),this.uses=0,this.tileSize=n,this.tileZoom=r,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"}return y(e,[{key:"registerFadeDuration",value:function(e){var t=e+this.timeAdded;t<re.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)}},{key:"wasRequested",value:function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}},{key:"loadVectorData",value:function(e,t,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var r in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(e,t){var n={};if(!t)return n;var r,i=f(e);try{var a=function(){var e=r.value,i=e.layerIds.map((function(e){return t.getLayer(e)})).filter(Boolean);if(0!==i.length){e.layers=i,e.stateDependentLayerIds&&(e.stateDependentLayers=e.stateDependentLayerIds.map((function(e){return i.filter((function(t){return t.id===e}))[0]})));var a,o=f(i);try{for(o.s();!(a=o.n()).done;){var s=a.value;n[s.id]=e}}catch(l){o.e(l)}finally{o.f()}}};for(i.s();!(r=i.n()).done;)a()}catch(o){i.e(o)}finally{i.f()}return n}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var i=this.buckets[r];if(i instanceof oc){if(this.hasSymbolBuckets=!0,!n)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var a in this.buckets){var o=this.buckets[a];if(o instanceof oc&&o.hasRTLText){this.hasRTLText=!0,Ai.isLoading()||Ai.isLoaded()||"deferred"!==Mi()||Ci();break}}for(var s in this.queryPadding=0,this.buckets){var l=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(s).queryRadius(l))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new _a}},{key:"unloadVectorData",value:function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}},{key:"getBucket",value:function(e){return this.buckets[e.id]}},{key:"upload",value:function(e){for(var t in this.buckets){var n=this.buckets[t];n.uploadPending()&&n.upload(e)}var r=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new wc(e,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new wc(e,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)}},{key:"prepare",value:function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}},{key:"queryRenderedFeatures",value:function(e,t,n,r,i,a,o,s){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:r,pixelPosMatrix:o,transform:a,params:i},e,t,n):{}}},{key:"querySourceFeatures",value:function(e,t){var n=this.latestFeatureIndex;if(n&&n.rawTileData){var r=n.loadVTLayers(),i=t?t.sourceLayer:"",a=r._geojsonTileLayer||r[i];if(a)for(var o=kr(t&&t.filter),s=this.tileID.canonical,l=s.z,u=s.x,c=s.y,h={z:l,x:u,y:c},f=0;f<a.length;f++){var d=a.feature(f);if(o.needGeometry){var p=io(d,!0);if(!o.filter(new Ii(this.tileID.overscaledZ),p,this.tileID.canonical))continue}else if(!o.filter(new Ii(this.tileID.overscaledZ),d))continue;var m=n.getId(d,i),v=new Gc(d,l,u,c,m);v.tile=h,e.push(v)}}}},{key:"hasData",value:function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}},{key:"patternsLoaded",value:function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}},{key:"setExpiryData",value:function(e){var t=this.expirationTime;if(e.cacheControl){var n=q(e.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var r=Date.now(),i=!1;if(this.expirationTime>r)i=!1;else if(t)if(this.expirationTime<t)i=!0;else{var a=this.expirationTime-t;a?this.expirationTime=r+Math.max(a,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}},{key:"getExpiryTimeout",value:function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}},{key:"setFeatureState",value:function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(e).length){var n=this.latestFeatureIndex.loadVTLayers();for(var r in this.buckets)if(t.style.hasLayer(r)){var i=this.buckets[r],a=i.layers[0].sourceLayer||"_geojsonTileLayer",o=n[a],s=e[a];if(o&&s&&0!==Object.keys(s).length){i.update(s,o,this.imageAtlas&&this.imageAtlas.patternPositions||{});var l=t&&t.style&&t.style.getLayer(r);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(i)))}}}}},{key:"holdingForFade",value:function(){return void 0!==this.symbolFadeHoldUntil}},{key:"symbolFadeFinished",value:function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<re.now()}},{key:"clearFadeHold",value:function(){this.symbolFadeHoldUntil=void 0}},{key:"setHoldDuration",value:function(e){this.symbolFadeHoldUntil=re.now()+e}},{key:"setDependencies",value:function(e,t){var n,r={},i=f(t);try{for(i.s();!(n=i.n()).done;)r[n.value]=!0}catch(a){i.e(a)}finally{i.f()}this.dependencies[e]=r}},{key:"hasDependency",value:function(e,t){var n,r=f(e);try{for(r.s();!(n=r.n()).done;){var i=n.value,a=this.dependencies[i];if(a){var o,s=f(t);try{for(s.s();!(o=s.n()).done;)if(a[o.value])return!0}catch(l){s.e(l)}finally{s.f()}}}}catch(l){r.e(l)}finally{r.f()}return!1}},{key:"clearQueryDebugViz",value:function(){}}]),e}(),Xc=function(){function e(){v(this,e),this.state={},this.stateChanges={},this.deletedStates={}}return y(e,[{key:"updateState",value:function(e,t,n){var r=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][r]=this.stateChanges[e][r]||{},P(this.stateChanges[e][r],n),null===this.deletedStates[e])for(var i in this.deletedStates[e]={},this.state[e])i!==r&&(this.deletedStates[e][i]=null);else if(this.deletedStates[e]&&null===this.deletedStates[e][r])for(var a in this.deletedStates[e][r]={},this.state[e][r])n[a]||(this.deletedStates[e][r][a]=null);else for(var o in n)this.deletedStates[e]&&this.deletedStates[e][r]&&null===this.deletedStates[e][r][o]&&delete this.deletedStates[e][r][o]}},{key:"removeFeatureState",value:function(e,t,n){if(null!==this.deletedStates[e]){var r=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},n&&void 0!==t)null!==this.deletedStates[e][r]&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][n]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][r])for(n in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][n]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null}}},{key:"getState",value:function(e,t){var n=String(t),r=P({},(this.state[e]||{})[n],(this.stateChanges[e]||{})[n]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){var i=this.deletedStates[e][t];if(null===i)return{};for(var a in i)delete r[a]}return r}},{key:"initializeTileState",value:function(e,t){e.setFeatureState(this.state,t)}},{key:"coalesceChanges",value:function(e,t){var n={};for(var r in this.stateChanges){this.state[r]=this.state[r]||{};var i={};for(var a in this.stateChanges[r])this.state[r][a]||(this.state[r][a]={}),P(this.state[r][a],this.stateChanges[r][a]),i[a]=this.state[r][a];n[r]=i}for(var o in this.deletedStates){this.state[o]=this.state[o]||{};var s={};if(null===this.deletedStates[o])for(var l in this.state[o])s[l]={},this.state[o][l]={};else for(var u in this.deletedStates[o]){if(null===this.deletedStates[o][u])this.state[o][u]={};else for(var c=0,h=Object.keys(this.deletedStates[o][u]);c<h.length;c++){var f=h[c];delete this.state[o][u][f]}s[u]=this.state[o][u]}n[o]=n[o]||{},P(n[o],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(var d in e)e[d].setFeatureState(n,t)}}]),e}(),Zc=function(){function e(t){v(this,e),this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}return y(e,[{key:"getElevation",value:function(e,t){var n=this.toIdx(e,t);return{min:this.minimums[n],max:this.maximums[n]}}},{key:"isLeaf",value:function(e,t){return this.leaves[this.toIdx(e,t)]}},{key:"toIdx",value:function(e,t){return t*this.size+e}}]),e}();function Kc(e,t,n,r){for(var i=0,a=Number.MAX_VALUE,o=0;o<3;o++)if(Math.abs(r[o])<1e-15){if(n[o]<e[o]||n[o]>t[o])return null}else{var s=1/r[o],l=(e[o]-n[o])*s,u=(t[o]-n[o])*s;if(l>u){var c=l;l=u,u=c}if(l>i&&(i=l),u<a&&(a=u),i>a)return null}return i}function Yc(e,t,n,r,i,a,o,s,l,u,c){var h=r-e,f=i-t,d=a-n,p=o-e,m=s-t,v=l-n,y=c[1]*v-c[2]*m,g=c[2]*p-c[0]*v,_=c[0]*m-c[1]*p,b=h*y+f*g+d*_;if(Math.abs(b)<1e-15)return null;var x=1/b,w=u[0]-e,E=u[1]-t,S=u[2]-n,T=(w*y+E*g+S*_)*x;if(T<0||T>1)return null;var k=E*d-S*f,M=S*h-w*d,C=w*f-E*h,A=(c[0]*k+c[1]*M+c[2]*C)*x;return A<0||T+A>1?null:(p*k+m*M+v*C)*x}function Jc(e,t,n){return(e-t)/(n-t)}function Qc(e,t,n,r,i,a,o,s,l){var u=1<<n,c=a-r,h=o-i,f=(e+1)/u*c+r,d=(t+0)/u*h+i,p=(t+1)/u*h+i;s[0]=(e+0)/u*c+r,s[1]=d,l[0]=f,l[1]=p}var $c=function(){function e(t){if(v(this,e),this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],this.dem){var n=function(e){for(var t=Math.ceil(Math.log2(e.dim/8)),n=[],r=Math.ceil(Math.pow(2,t)),i=1/r,a=function(e,t,n,r,i){var a=r?1:0,o=(e+1)*n-a,s=t*n,l=(t+1)*n-a;i[0]=e*n,i[1]=s,i[2]=o,i[3]=l},o=new Zc(r),s=[],l=0;l<r*r;l++){a(l%r,Math.floor(l/r),i,!1,s);var u=th(s[0],s[1],e),c=th(s[2],s[1],e),h=th(s[2],s[3],e),f=th(s[0],s[3],e);o.minimums.push(Math.min(u,c,h,f)),o.maximums.push(Math.max(u,c,h,f)),o.leaves.push(1)}for(n.push(o),r/=2;r>=1;r/=2){var d=n[n.length-1];o=new Zc(r);for(var p=0;p<r*r;p++){a(p%r,Math.floor(p/r),2,!0,s);var m=d.getElevation(s[0],s[1]),v=d.getElevation(s[2],s[1]),y=d.getElevation(s[2],s[3]),g=d.getElevation(s[0],s[3]),_=d.isLeaf(s[0],s[1]),b=d.isLeaf(s[2],s[1]),x=d.isLeaf(s[2],s[3]),w=d.isLeaf(s[0],s[3]),E=Math.min(m.min,v.min,y.min,g.min),S=Math.max(m.max,v.max,y.max,g.max),T=_&&b&&x&&w;o.maximums.push(S),o.minimums.push(E),o.leaves.push(S-E<=5&&T?1:0)}n.push(o)}return n}(this.dem),r=n.length-1,i=n[r];this._addNode(i.minimums[0],i.maximums[0],i.leaves[0]),this._construct(n,0,0,r,0)}}return y(e,[{key:"raycastRoot",value:function(e,t,n,r,i,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Kc([e,t,-100],[n,r,this.maximums[0]*o],i,a)}},{key:"raycast",value:function(e,t,n,r,i,a){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(!this.nodeCount)return null;var s=this.raycastRoot(e,t,n,r,i,a,o);if(null==s)return null;for(var l=[],u=[],c=[],h=[],f=[{idx:0,t:s,nodex:0,nodey:0,depth:0}];f.length>0;){var d=f.pop(),p=d.idx,m=d.t,v=d.nodex,y=d.nodey,g=d.depth;if(this.leaves[p]){Qc(v,y,g,e,t,n,r,c,h);var _=1<<g,b=(v+0)/_,x=(v+1)/_,w=(y+0)/_,E=(y+1)/_,S=th(b,w,this.dem)*o,T=th(x,w,this.dem)*o,k=th(x,E,this.dem)*o,M=th(b,E,this.dem)*o,C=Yc(c[0],c[1],S,h[0],c[1],T,h[0],h[1],k,i,a),A=Yc(h[0],h[1],k,c[0],h[1],M,c[0],c[1],S,i,a),I=Math.min(null!==C?C:Number.MAX_VALUE,null!==A?A:Number.MAX_VALUE);if(I!==Number.MAX_VALUE)return I;var P=Fo([],i,a,m);if(eh(S,T,M,k,Jc(P[0],c[0],h[0]),Jc(P[1],c[1],h[1]))>=P[2])return m}else{for(var R=0,L=0;L<this._siblingOffset.length;L++){Qc((v<<1)+this._siblingOffset[L][0],(y<<1)+this._siblingOffset[L][1],g+1,e,t,n,r,c,h),c[2]=-100,h[2]=this.maximums[this.childOffsets[p]+L]*o;var O=Kc(c,h,i,a);if(null!=O){var D=O;l[L]=D;for(var N=!1,z=0;z<R&&!N;z++)D>=l[u[z]]&&(u.splice(z,0,L),N=!0);N||(u[R]=L),R++}}for(var F=0;F<R;F++){var B=u[F];f.push({idx:this.childOffsets[p]+B,t:l[B],nodex:(v<<1)+this._siblingOffset[B][0],nodey:(y<<1)+this._siblingOffset[B][1],depth:g+1})}}}return null}},{key:"_addNode",value:function(e,t,n){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}},{key:"_construct",value:function(e,t,n,r,i){if(1!==e[r].isLeaf(t,n)){this.childOffsets[i]||(this.childOffsets[i]=this.nodeCount);for(var a,o=r-1,s=e[o],l=0,u=0;u<this._siblingOffset.length;u++){var c=2*t+this._siblingOffset[u][0],h=2*n+this._siblingOffset[u][1],f=s.getElevation(c,h),d=s.isLeaf(c,h),p=this._addNode(f.min,f.max,d);d&&(l|=1<<u),a||(a=p)}for(var m=0;m<this._siblingOffset.length;m++)l&1<<m||this._construct(e,2*t+this._siblingOffset[m][0],2*n+this._siblingOffset[m][1],o,a+m)}}}]),e}();function eh(e,t,n,r,i,a){return fn(fn(e,n,a),fn(t,r,a),i)}function th(e,t,n){var r=n.dim,i=C(e*r-.5,0,r-1),a=C(t*r-.5,0,r-1),o=Math.floor(i),s=Math.floor(a),l=Math.min(o+1,r-1),u=Math.min(s+1,r-1);return eh(n.get(o,s),n.get(l,s),n.get(o,u),n.get(l,u),i-o,a-s)}var nh={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]},rh=function(){function e(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(v(this,e),this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return V('"'.concat(r,'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".'));this.stride=n.height;var o=this.dim=n.height-2;if(this.data=new Uint32Array(n.data.buffer),this.encoding=r||"mapbox",this.borderReady=i,!i){for(var s=0;s<o;s++)this.data[this._idx(-1,s)]=this.data[this._idx(0,s)],this.data[this._idx(o,s)]=this.data[this._idx(o-1,s)],this.data[this._idx(s,-1)]=this.data[this._idx(s,0)],this.data[this._idx(s,o)]=this.data[this._idx(s,o-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(o,-1)]=this.data[this._idx(o-1,0)],this.data[this._idx(-1,o)]=this.data[this._idx(0,o-1)],this.data[this._idx(o,o)]=this.data[this._idx(o-1,o-1)],a&&this._buildQuadTree()}}return y(e,[{key:"tree",get:function(){return this._tree||this._buildQuadTree(),this._tree}}]),y(e,[{key:"_buildQuadTree",value:function(){this._tree=new $c(this)}},{key:"get",value:function(e,t){var n=new Uint8Array(this.data.buffer),r=4*this._idx(e,t);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(n[r],n[r+1],n[r+2])}},{key:"_idx",value:function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}},{key:"_unpackMapbox",value:function(e,t,n){return(256*e*256+256*t+n)/10-1e4}},{key:"_unpackTerrarium",value:function(e,t,n){return 256*e+t+n/256-32768}},{key:"getPixels",value:function(){return new ss({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}},{key:"backfillBorder",value:function(e,t,n){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var r=t*this.dim,i=t*this.dim+this.dim,a=n*this.dim,o=n*this.dim+this.dim;switch(t){case-1:r=i-1;break;case 1:i=r+1}switch(n){case-1:a=o-1;break;case 1:o=a+1}for(var s=-t*this.dim,l=-n*this.dim,u=a;u<o;u++)for(var c=r;c<i;c++)this.data[this._idx(c,u)]=e.data[this._idx(c+s,u+l)]}},{key:"onDeserialize",value:function(){this._tree&&(this._tree.dem=this)}},{key:"unpackVector",get:function(){return nh[this.encoding]}}],[{key:"getUnpackVector",value:function(e){return nh[e]}},{key:"pack",value:function(t,n){var r=[0,0,0,0],i=e.getUnpackVector(n),a=Math.floor((t+i[3])/i[2]);return r[2]=a%256,a=Math.floor(a/256),r[1]=a%256,a=Math.floor(a/256),r[0]=a,r}}]),e}();ai("DEMData",rh),ai("DemMinMaxQuadTree",$c,{omit:["dem"]});var ih=function(){function e(t,n){v(this,e),this.max=t,this.onRemove=n,this.reset()}return y(e,[{key:"reset",value:function(){for(var e in this.data){var t,n=f(this.data[e]);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value)}}catch(i){n.e(i)}finally{n.f()}}return this.data={},this.order=[],this}},{key:"add",value:function(e,t,n){var r=this,i=e.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);var a={value:t,timeout:void 0};if(void 0!==n&&(a.timeout=setTimeout((function(){r.remove(e,a)}),n)),this.data[i].push(a),this.order.push(i),this.order.length>this.max){var o=this._getAndRemoveByKey(this.order[0]);o&&this.onRemove(o)}return this}},{key:"has",value:function(e){return e.wrapped().key in this.data}},{key:"getAndRemove",value:function(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}},{key:"_getAndRemoveByKey",value:function(e){var t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}},{key:"getByKey",value:function(e){var t=this.data[e];return t?t[0].value:null}},{key:"get",value:function(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}},{key:"remove",value:function(e,t){if(!this.has(e))return this;var n=e.wrapped().key,r=void 0===t?0:this.data[n].indexOf(t),i=this.data[n][r];return this.data[n].splice(r,1),i.timeout&&clearTimeout(i.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(i.value),this.order.splice(this.order.indexOf(n),1),this}},{key:"setMaxSize",value:function(e){for(this.max=e;this.order.length>this.max;){var t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}},{key:"filter",value:function(e){var t=[];for(var n in this.data){var r,i=f(this.data[n]);try{for(i.s();!(r=i.n()).done;){var a=r.value;e(a.value)||t.push(a)}}catch(u){i.e(u)}finally{i.f()}}for(var o=0,s=t;o<s.length;o++){var l=s[o];this.remove(l.value.tileID,l)}}}]),e}(),ah=function(){function e(t,n,r){v(this,e),this.context=t;var i=t.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(r),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}return y(e,[{key:"bind",value:function(){this.context.bindElementBuffer.set(this.buffer)}},{key:"updateData",value:function(e){var t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}},{key:"destroy",value:function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}]),e}(),oh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},sh=function(){function e(t,n,r,i){v(this,e),this.length=n.length,this.attributes=r,this.itemSize=n.bytesPerElement,this.dynamicDraw=i,this.context=t;var a=t.gl;this.buffer=a.createBuffer(),t.bindVertexBuffer.set(this.buffer),a.bufferData(a.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?a.DYNAMIC_DRAW:a.STATIC_DRAW),this.dynamicDraw||delete n.arrayBuffer}return y(e,[{key:"bind",value:function(){this.context.bindVertexBuffer.set(this.buffer)}},{key:"updateData",value:function(e){var t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}},{key:"enableAttributes",value:function(e,t){for(var n=0;n<this.attributes.length;n++){var r=t.attributes[this.attributes[n].name];void 0!==r&&e.enableVertexAttribArray(r)}}},{key:"setVertexAttribPointers",value:function(e,t,n){for(var r=0;r<this.attributes.length;r++){var i=this.attributes[r],a=t.attributes[i.name];void 0!==a&&e.vertexAttribPointer(a,i.components,e[oh[i.type]],!1,this.itemSize,i.offset+this.itemSize*(n||0))}}},{key:"destroy",value:function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}]),e}(),lh=function(){function e(t){v(this,e),this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}return y(e,[{key:"get",value:function(){return this.current}},{key:"set",value:function(e){}},{key:"getDefault",value:function(){return this.default}},{key:"setDefault",value:function(){this.set(this.default)}}]),e}(),uh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return xt.transparent}},{key:"set",value:function(e){var t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}]),n}(lh),ch=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return 1}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}]),n}(lh),hh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return 0}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}]),n}(lh),fh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return[!0,!0,!0,!0]}},{key:"set",value:function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}]),n}(lh),dh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return!0}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}]),n}(lh),ph=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return 255}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}]),n}(lh),mh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return{func:this.gl.ALWAYS,ref:0,mask:255}}},{key:"set",value:function(e){var t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}]),n}(lh),vh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){var e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}},{key:"set",value:function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}]),n}(lh),yh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return!1}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}}]),n}(lh),gh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return[0,1]}},{key:"set",value:function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}]),n}(lh),_h=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return!1}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}}]),n}(lh),bh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return this.gl.LESS}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}]),n}(lh),xh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return!1}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}}]),n}(lh),wh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){var e=this.gl;return[e.ONE,e.ZERO]}},{key:"set",value:function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}]),n}(lh),Eh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return xt.transparent}},{key:"set",value:function(e){var t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}]),n}(lh),Sh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return this.gl.FUNC_ADD}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}]),n}(lh),Th=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return!1}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}}]),n}(lh),kh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return this.gl.BACK}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}]),n}(lh),Mh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return this.gl.CCW}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}]),n}(lh),Ch=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return null}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}]),n}(lh),Ah=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return this.gl.TEXTURE0}},{key:"set",value:function(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}]),n}(lh),Ih=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){var e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}},{key:"set",value:function(e){var t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}]),n}(lh),Ph=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return null}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}}]),n}(lh),Rh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return null}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}}]),n}(lh),Lh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return null}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}}]),n}(lh),Oh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return null}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}}]),n}(lh),Dh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return null}},{key:"set",value:function(e){var t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}]),n}(lh),Nh=function(e){p(n,e);var t=m(n);function n(e){var r;return v(this,n),(r=t.call(this,e)).vao=e.extVertexArrayObject,r}return y(n,[{key:"getDefault",value:function(){return null}},{key:"set",value:function(e){this.vao&&(e!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(e),this.current=e,this.dirty=!1)}}]),n}(lh),zh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return 4}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}}]),n}(lh),Fh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return!1}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}}]),n}(lh),Bh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"getDefault",value:function(){return!1}},{key:"set",value:function(e){if(e!==this.current||this.dirty){var t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}}]),n}(lh),Uh=function(e){p(n,e);var t=m(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e)).context=e,i.parent=r,i}return y(n,[{key:"getDefault",value:function(){return null}}]),n}(lh),jh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"setDirty",value:function(){this.dirty=!0}},{key:"set",value:function(e){if(e!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}}]),n}(Uh),Vh=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"attachment",value:function(){return this.gl.DEPTH_ATTACHMENT}},{key:"set",value:function(e){if(e!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}}]),n}(Uh),Hh=function(){function e(t,n,r,i){v(this,e),this.context=t,this.width=n,this.height=r;var a=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new jh(t,a),i&&(this.depthAttachment=new Vh(t,a))}return y(e,[{key:"destroy",value:function(){var e=this.context.gl,t=this.colorAttachment.get();if(t&&e.deleteTexture(t),this.depthAttachment){var n=this.depthAttachment.get();n&&e.deleteRenderbuffer(n)}e.deleteFramebuffer(this.framebuffer)}}]),e}(),Gh=function e(t,n,r){v(this,e),this.func=t,this.mask=n,this.range=r};Gh.ReadOnly=!1,Gh.ReadWrite=!0,Gh.disabled=new Gh(519,Gh.ReadOnly,[0,1]);var Wh=function e(t,n,r,i,a,o){v(this,e),this.test=t,this.ref=n,this.mask=r,this.fail=i,this.depthFail=a,this.pass=o};Wh.disabled=new Wh({func:519,mask:0},0,0,7680,7680,7680);var qh=function e(t,n,r){v(this,e),this.blendFunction=t,this.blendColor=n,this.mask=r};qh.Replace=[1,0],qh.disabled=new qh(qh.Replace,xt.transparent,[!1,!1,!1,!1]),qh.unblended=new qh(qh.Replace,xt.transparent,[!0,!0,!0,!0]),qh.alphaBlended=new qh([1,771],xt.transparent,[!0,!0,!0,!0]);var Xh=function e(t,n,r){v(this,e),this.enable=t,this.mode=n,this.frontFace=r};Xh.disabled=new Xh(!1,1029,2305),Xh.backCCW=new Xh(!0,1029,2305),Xh.backCW=new Xh(!0,1029,2304),Xh.frontCW=new Xh(!0,1028,2304),Xh.frontCCW=new Xh(!0,1028,2305);var Zh=function(e){p(n,e);var t=m(n);function n(e,r,a){var o;return v(this,n),(o=t.call(this)).id=e,o._onlySymbols=a,r.on("data",(function(e){"source"===e.dataType&&"metadata"===e.sourceDataType&&(o._sourceLoaded=!0),o._sourceLoaded&&!o._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(o.reload(),o.transform&&o.update(o.transform))})),r.on("error",(function(){o._sourceErrored=!0})),o._source=r,o._tiles={},o._cache=new ih(0,o._unloadTile.bind(i(o))),o._timers={},o._cacheTimers={},o._maxTileCacheSize=null,o._loadedParentTiles={},o._coveredTiles={},o._state=new Xc,o}return y(n,[{key:"onAdd",value:function(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null}},{key:"loaded",value:function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(var e in this._tiles){var t=this._tiles[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}return!0}},{key:"getSource",value:function(){return this._source}},{key:"pause",value:function(){this._paused=!0}},{key:"resume",value:function(){if(this._paused){var e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}}},{key:"_loadTile",value:function(e,t){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,t)}},{key:"_unloadTile",value:function(e){if(this._source.unloadTile)return this._source.unloadTile(e,(function(){}))}},{key:"_abortTile",value:function(e){if(this._source.abortTile)return this._source.abortTile(e,(function(){}))}},{key:"serialize",value:function(){return this._source.serialize()}},{key:"prepare",value:function(e){for(var t in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var n=this._tiles[t];n.upload(e),n.prepare(this.map.style.imageManager)}}},{key:"getIds",value:function(){return I(this._tiles).map((function(e){return e.tileID})).sort(Kh).map((function(e){return e.key}))}},{key:"getRenderableIds",value:function(e){var t=this,n=[];for(var i in this._tiles)this._isIdRenderable(+i,e)&&n.push(this._tiles[i]);return e?n.sort((function(e,n){var i=e.tileID,a=n.tileID,o=new r(i.canonical.x,i.canonical.y)._rotate(t.transform.angle),s=new r(a.canonical.x,a.canonical.y)._rotate(t.transform.angle);return i.overscaledZ-a.overscaledZ||s.y-o.y||s.x-o.x})).map((function(e){return e.tileID.key})):n.map((function(e){return e.tileID})).sort(Kh).map((function(e){return e.key}))}},{key:"hasRenderableParent",value:function(e){var t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}},{key:"_isIdRenderable",value:function(e,t){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())}},{key:"reload",value:function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var e in this._cache.reset(),this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}},{key:"_reloadTile",value:function(e,t){var n=this._tiles[e];n&&("loading"!==n.state&&(n.state=t),this._loadTile(n,this._tileLoaded.bind(this,n,e,t)))}},{key:"_tileLoaded",value:function(e,t,n,r){if(r)return e.state="errored",void(404!==r.status?this._source.fire(new Xe(r,{tile:e})):this.update(this.transform));e.timeAdded=re.now(),"expired"===n&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(t,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new qe("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}},{key:"_backfillDEM",value:function(e){for(var t=this.getRenderableIds(),n=0;n<t.length;n++){var r=t[n];if(e.neighboringTiles&&e.neighboringTiles[r]){var i=this.getTileByID(r);a(e,i),a(i,e)}}function a(e,t){if(e.dem&&!e.dem.borderReady){e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;var n=t.tileID.canonical.x-e.tileID.canonical.x,r=t.tileID.canonical.y-e.tileID.canonical.y,i=Math.pow(2,e.tileID.canonical.z),a=t.tileID.key;0===n&&0===r||Math.abs(r)>1||(Math.abs(n)>1&&(1===Math.abs(n+i)?n+=i:1===Math.abs(n-i)&&(n-=i)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,n,r),e.neighboringTiles&&e.neighboringTiles[a]&&(e.neighboringTiles[a].backfilled=!0)))}}}},{key:"getTile",value:function(e){return this.getTileByID(e.key)}},{key:"getTileByID",value:function(e){return this._tiles[e]}},{key:"_retainLoadedChildren",value:function(e,t,n,r){for(var i in this._tiles){var a=this._tiles[i];if(!(r[i]||!a.hasData()||a.tileID.overscaledZ<=t||a.tileID.overscaledZ>n)){for(var o=a.tileID;a&&a.tileID.overscaledZ>t+1;){var s=a.tileID.scaledTo(a.tileID.overscaledZ-1);(a=this._tiles[s.key])&&a.hasData()&&(o=s)}for(var l=o;l.overscaledZ>t;)if(e[(l=l.scaledTo(l.overscaledZ-1)).key]){r[o.key]=o;break}}}}},{key:"findLoadedParent",value:function(e,t){if(e.key in this._loadedParentTiles){var n=this._loadedParentTiles[e.key];return n&&n.tileID.overscaledZ>=t?n:null}for(var r=e.overscaledZ-1;r>=t;r--){var i=e.scaledTo(r),a=this._getLoadedTile(i);if(a)return a}}},{key:"_getLoadedTile",value:function(e){var t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}},{key:"updateCacheSize",value:function(e,t){t=t||this._source.tileSize;var n=Math.ceil(e.width/t)+1,r=Math.ceil(e.height/t)+1,i=Math.floor(n*r*5),a="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,i):i;this._cache.setMaxSize(a)}},{key:"handleWrapJump",value:function(e){var t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){var n={};for(var r in this._tiles){var i=this._tiles[r];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),n[i.tileID.key]=i}for(var a in this._tiles=n,this._timers)clearTimeout(this._timers[a]),delete this._timers[a];for(var o in this._tiles)this._setTileReloadTimer(+o,this._tiles[o])}}},{key:"update",value:function(e,t,r){var i=this;if(this.transform=e,this._sourceLoaded&&!this._paused&&!this.transform.freezeTileCoverage&&(!this.usedForTerrain||r)){var a;this.updateCacheSize(e,t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?a=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(e){return new jc(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)})):(a=e.coveringTiles({tileSize:t||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!r,reparseOverscaled:this._source.reparseOverscaled,useElevationData:!!this.transform.elevation&&!this.usedForTerrain}),this._source.hasTile&&(a=a.filter((function(e){return i._source.hasTile(e)})))):a=[];var o=this._updateRetainedTiles(a);if(Yh(this._source.type)&&0!==a.length){for(var s={},l={},u=0,c=Object.keys(o);u<c.length;u++){var h=c[u],d=o[h],p=this._tiles[h];if(p&&!(p.fadeEndTime&&p.fadeEndTime<=re.now())){var m=this.findLoadedParent(d,Math.max(d.overscaledZ-n.maxOverzooming,this._source.minzoom));m&&(this._addTile(m.tileID),s[m.tileID.key]=m.tileID),l[h]=d}}var v=a[a.length-1].overscaledZ;for(var y in this._tiles){var g=this._tiles[y];if(!o[y]&&g.hasData())for(var _=g.tileID;_.overscaledZ>v;){_=_.scaledTo(_.overscaledZ-1);var b=this._tiles[_.key];if(b&&b.hasData()&&l[_.key]){o[y]=g.tileID;break}}}for(var x in s)o[x]||(this._coveredTiles[x]=!0,o[x]=s[x])}for(var w in o)this._tiles[w].clearFadeHold();var E,S=function(e,t){var n=[];for(var r in e)r in t||n.push(r);return n}(this._tiles,o),T=f(S);try{for(T.s();!(E=T.n()).done;){var k=E.value,M=this._tiles[k];M.hasSymbolBuckets&&!M.holdingForFade()?M.setHoldDuration(this.map._fadeDuration):M.hasSymbolBuckets&&!M.symbolFadeFinished()||this._removeTile(+k)}}catch(C){T.e(C)}finally{T.f()}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}}},{key:"releaseSymbolFadeTiles",value:function(){for(var e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}},{key:"_updateRetainedTiles",value:function(e){var t={};if(0===e.length)return t;var r,i={},a=e[e.length-1].overscaledZ,o=e[0].overscaledZ,s=Math.max(o-n.maxOverzooming,this._source.minzoom),l=Math.max(o+n.maxUnderzooming,this._source.minzoom),u={},c=f(e);try{for(c.s();!(r=c.n()).done;){var h=r.value,d=this._addTile(h);t[h.key]=h,d.hasData()||a<this._source.maxzoom&&(u[h.key]=h)}}catch(S){c.e(S)}finally{c.f()}this._retainLoadedChildren(u,a,l,t);var p,m=f(e);try{for(m.s();!(p=m.n()).done;){var v=p.value,y=this._tiles[v.key];if(!y.hasData()){if(v.canonical.z>=this._source.maxzoom){var g=v.children(this._source.maxzoom)[0],_=this.getTile(g);if(_&&_.hasData()){t[g.key]=g;continue}}else{var b=v.children(this._source.maxzoom);if(t[b[0].key]&&t[b[1].key]&&t[b[2].key]&&t[b[3].key])continue}for(var x=y.wasRequested(),w=v.overscaledZ-1;w>=s;--w){var E=v.scaledTo(w);if(i[E.key])break;if(i[E.key]=!0,!(y=this.getTile(E))&&x&&(y=this._addTile(E)),y&&(t[E.key]=E,x=y.wasRequested(),y.hasData()))break}}}}catch(S){m.e(S)}finally{m.f()}return t}},{key:"_updateLoadedParentTileCache",value:function(){for(var e in this._loadedParentTiles={},this._tiles){for(var t=[],n=void 0,r=this._tiles[e].tileID;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){n=this._loadedParentTiles[r.key];break}t.push(r.key);var i=r.scaledTo(r.overscaledZ-1);if(n=this._getLoadedTile(i))break;r=i}for(var a=0,o=t;a<o.length;a++){var s=o[a];this._loadedParentTiles[s]=n}}}},{key:"_addTile",value:function(e){var t=this._tiles[e.key];if(t)return t;(t=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,t),t.tileID=e,this._state.initializeTileState(t,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,t)));var n=Boolean(t);return n||(t=new qc(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom),this._loadTile(t,this._tileLoaded.bind(this,t,e.key,t.state))),t?(t.uses++,this._tiles[e.key]=t,n||this._source.fire(new qe("dataloading",{tile:t,coord:t.tileID,dataType:"source"})),t):null}},{key:"_setTileReloadTimer",value:function(e,t){var n=this;e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);var r=t.getExpiryTimeout();r&&(this._timers[e]=setTimeout((function(){n._reloadTile(e,"expired"),delete n._timers[e]}),r))}},{key:"_removeTile",value:function(e){var t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}},{key:"clearTiles",value:function(){for(var e in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(+e);this._cache.reset()}},{key:"tilesIn",value:function(e,t,n){var r=[],i=this.transform;if(!i)return r;for(var a in this._tiles){var o=this._tiles[a];if(n&&o.clearQueryDebugViz(),!o.holdingForFade()){var s=e.containsTile(o,i,t);s&&r.push(s)}}return r}},{key:"getVisibleCoordinates",value:function(e){var t,n=this,r=this.getRenderableIds(e).map((function(e){return n._tiles[e].tileID})),i=f(r);try{for(i.s();!(t=i.n()).done;){var a=t.value;a.posMatrix=this.transform.calculatePosMatrix(a.toUnwrapped())}}catch(o){i.e(o)}finally{i.f()}return r}},{key:"hasTransition",value:function(){if(this._source.hasTransition())return!0;if(Yh(this._source.type))for(var e in this._tiles){var t=this._tiles[e];if(void 0!==t.fadeEndTime&&t.fadeEndTime>=re.now())return!0}return!1}},{key:"setFeatureState",value:function(e,t,n){this._state.updateState(e=e||"_geojsonTileLayer",t,n)}},{key:"removeFeatureState",value:function(e,t,n){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,n)}},{key:"getFeatureState",value:function(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}},{key:"setDependencies",value:function(e,t,n){var r=this._tiles[e];r&&r.setDependencies(t,n)}},{key:"reloadTilesForDependencies",value:function(e,t){for(var n in this._tiles)this._tiles[n].hasDependency(e,t)&&this._reloadTile(+n,"reloading");this._cache.filter((function(n){return!n.hasDependency(e,t)}))}}]),n}(Ze);function Kh(e,t){var n=Math.abs(2*e.wrap)-+(e.wrap<0),r=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||r-n||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Yh(e){return"raster"===e||"image"===e||"video"===e}Zh.maxOverzooming=10,Zh.maxUnderzooming=3;var Jh=function(){function e(t,n,r){v(this,e),this._dem=t,this._scale=n,this._offset=r}return y(e,[{key:"getElevationAt",value:function(e,t,n){var r=e*this._scale+this._offset[0],i=t*this._scale+this._offset[1],a=Math.floor(r),o=Math.floor(i),s=this._dem;return n?fn(fn(s.get(a,o),s.get(a,o+1),i-o),fn(s.get(a+1,o),s.get(a+1,o+1),i-o),r-a):s.get(a,o)}}],[{key:"create",value:function(t,n,r){var i=r||t.findDEMTileFor(n);if(i&&i.dem){var a=i.dem,o=i.tileID,s=1<<n.canonical.z-o.canonical.z;return new e(a,i.tileSize/8192/s,[(n.canonical.x/s-o.canonical.x)*a.dim,(n.canonical.y/s-o.canonical.y)*a.dim])}}}]),e}(),Qh=function(){function e(t,n){v(this,e),this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ei(8192,16,0),this.featureIndexArray=new Ma,this.promoteId=n}return y(e,[{key:"insert",value:function(e,t,n,r,i){var a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,r,i);for(var o=this.grid,s=0;s<t.length;s++){for(var l=t[s],u=[1/0,1/0,-1/0,-1/0],c=0;c<l.length;c++){var h=l[c];u[0]=Math.min(u[0],h.x),u[1]=Math.min(u[1],h.y),u[2]=Math.max(u[2],h.x),u[3]=Math.max(u[3],h.y)}u[0]<8192&&u[1]<8192&&u[2]>=0&&u[3]>=0&&o.insert(a,u[0],u[1],u[2],u[3])}}},{key:"loadVTLayers",value:function(){return this.vtLayers||(this.vtLayers=new sl.VectorTile(new Ul(this.rawTileData)).layers,this.sourceLayerCoder=new Hc(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}},{key:"query",value:function(e,t,n,r){var i=this;this.loadVTLayers();var a=e.params||{},o=kr(a.filter),s=e.tileResult,l=e.transform,u=s.bufferedTilespaceBounds,c=this.grid.query(u.min.x,u.min.y,u.max.x,u.max.y,(function(e,t,n,r){return go(s.bufferedTilespaceGeometry,e,t,n,r)}));c.sort(ef);var h=null;l.elevation&&c.length>0&&(h=Jh.create(l.elevation,this.tileID));for(var f,d={},p=function(l){var u=c[l];if(u===f)return"continue";f=u;var p=i.featureIndexArray.get(u),m=null;i.loadMatchingFeature(d,p.bucketIndex,p.sourceLayerIndex,p.featureIndex,o,a.layers,a.availableImages,t,n,r,(function(t,n,r){return m||(m=ro(t)),n.queryIntersectsFeature(s,t,r,m,i.z,e.transform,e.pixelPosMatrix,h)}))},m=0;m<c.length;m++)p(m);return d}},{key:"loadMatchingFeature",value:function(e,t,n,r,i,a,o,s,l,u,c){var h=this.bucketLayerIDs[t];if(!a||function(e,t){for(var n=0;n<e.length;n++)if(t.indexOf(e[n])>=0)return!0;return!1}(a,h)){var f=this.sourceLayerCoder.decode(n),d=this.vtLayers[f].feature(r);if(i.needGeometry){var p=io(d,!0);if(!i.filter(new Ii(this.tileID.overscaledZ),p,this.tileID.canonical))return}else if(!i.filter(new Ii(this.tileID.overscaledZ),d))return;for(var m=this.getId(d,f),v=0;v<h.length;v++){var y=h[v];if(!(a&&a.indexOf(y)<0)){var g=s[y];if(g){var _={};void 0!==m&&u&&(_=u.getState(g.sourceLayer||"_geojsonTileLayer",m));var b=P({},l[y]);b.paint=$h(b.paint,g.paint,d,_,o),b.layout=$h(b.layout,g.layout,d,_,o);var x=!c||c(d,g,_);if(x){var w=new Gc(d,this.z,this.x,this.y,m);w.layer=b;var E=e[y];void 0===E&&(E=e[y]=[]),E.push({featureIndex:r,feature:w,intersectionZ:x})}}}}}}},{key:"lookupSymbolFeatures",value:function(e,t,n,r,i,a,o,s){var l={};this.loadVTLayers();var u,c=kr(i),h=f(e);try{for(h.s();!(u=h.n()).done;){var d=u.value;this.loadMatchingFeature(l,n,r,d,c,a,o,s,t)}}catch(p){h.e(p)}finally{h.f()}return l}},{key:"hasLayer",value:function(e){var t,n=f(this.bucketLayerIDs);try{for(n.s();!(t=n.n()).done;){var r,i=t.value,a=f(i);try{for(a.s();!(r=a.n()).done;)if(e===r.value)return!0}catch(o){a.e(o)}finally{a.f()}}}catch(o){n.e(o)}finally{n.f()}return!1}},{key:"getId",value:function(e,t){var n=e.id;return this.promoteId&&"boolean"==typeof(n=e.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[t]])&&(n=Number(n)),n}}]),e}();function $h(e,t,n,r,i){return F(e,(function(e,a){var o=t instanceof Fi?t.get(a):null;return o&&o.evaluate?o.evaluate(n,r,i):o}))}function ef(e,t){return t-e}ai("FeatureIndex",Qh,{omit:["rawTileData","sourceLayerCoder"]});var tf=function e(t){v(this,e);var n={},r=[];for(var i in t){var a=t[i],o=n[i]={};for(var s in a){var l=a[+s];if(l&&0!==l.bitmap.width&&0!==l.bitmap.height){var u={x:0,y:0,w:l.bitmap.width+2,h:l.bitmap.height+2};r.push(u),o[s]={rect:u,metrics:l.metrics}}}}var c=su(r),h=c.w,f=c.h,d=new os({width:h||1,height:f||1});for(var p in t){var m=t[p];for(var y in m){var g=m[+y];if(g&&0!==g.bitmap.width&&0!==g.bitmap.height){var _=n[p][y].rect;os.copy(g.bitmap,d,{x:0,y:0},{x:_.x+1,y:_.y+1},g.bitmap)}}}this.image=d,this.positions=n};ai("GlyphAtlas",tf);var nf=function(){function e(t){v(this,e),this.tileID=new jc(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile}return y(e,[{key:"parse",value:function(e,t,n,r,i){var a=this;this.status="parsing",this.data=e,this.collisionBoxArray=new _a;var o=new Hc(Object.keys(e.layers).sort()),s=new Qh(this.tileID,this.promoteId);s.bucketLayerIDs=[];var l,u,c,h,d={},p={featureIndex:s,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:n},m=t.familiesBySource[this.source];for(var v in m){var y=e.layers[v];if(y){var g,_=!1,b=!1,x=f(m[v]);try{for(x.s();!(g=x.n()).done;)"symbol"===g.value[0].type?_=!0:b=!0}catch(z){x.e(z)}finally{x.f()}if((!0!==this.isSymbolTile||_)&&(!1!==this.isSymbolTile||b)){1===y.version&&V('Vector tile source "'.concat(this.source,'" layer "').concat(v,'" ')+"does not use vector tile spec v2 and therefore may have some rendering errors.");for(var w=o.encode(v),E=[],S=0;S<y.length;S++){var T=y.feature(S),k=s.getId(T,v);E.push({feature:T,id:k,index:S,sourceLayerIndex:w})}var M,C=f(m[v]);try{for(C.s();!(M=C.n()).done;){var A=M.value,P=A[0];void 0!==this.isSymbolTile&&"symbol"===P.type!==this.isSymbolTile||P.minzoom&&this.zoom<Math.floor(P.minzoom)||P.maxzoom&&this.zoom>=P.maxzoom||"none"!==P.visibility&&(rf(A,this.zoom,n),(d[P.id]=P.createBucket({index:s.bucketLayerIDs.length,layers:A,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:w,sourceID:this.source,enableTerrain:this.enableTerrain})).populate(E,p,this.tileID.canonical),s.bucketLayerIDs.push(A.map((function(e){return e.id}))))}}catch(z){C.e(z)}finally{C.f()}}}}var R={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},L=F(p.glyphDependencies,(function(e){return Object.keys(e).map(Number)}));Object.keys(L).length?r.send("getGlyphs",{uid:this.uid,stacks:L},(function(e,t){l||(l=e,u=t,N.call(a))}),void 0,void 0,R):u={};var O=Object.keys(p.iconDependencies);O.length?r.send("getImages",{icons:O,source:this.source,tileID:this.tileID,type:"icons"},(function(e,t){l||(l=e,c=t,N.call(a))}),void 0,void 0,R):c={};var D=Object.keys(p.patternDependencies);function N(){if(l)return i(l);if(u&&c&&h){var e=new tf(u),t=new uu(c,h);for(var r in d){var a=d[r];a instanceof oc?(rf(a.layers,this.zoom,n),Wu(a,u,e.positions,c,t.iconPositions,this.showCollisionBoxes,this.tileID.canonical,this.tileZoom)):a.hasPattern&&(a instanceof xl||a instanceof Xs||a instanceof fl)&&(rf(a.layers,this.zoom,n),a.addFeatures(p,this.tileID.canonical,t.patternPositions))}this.status="done",i(null,{buckets:I(d).filter((function(e){return!e.isEmpty()})),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:t,glyphMap:this.returnDependencies?u:null,iconMap:this.returnDependencies?c:null,glyphPositions:this.returnDependencies?e.positions:null})}}D.length?r.send("getImages",{icons:D,source:this.source,tileID:this.tileID,type:"patterns"},(function(e,t){l||(l=e,h=t,N.call(a))}),void 0,void 0,R):h={},N.call(this)}}]),e}();function rf(e,t,n){var r,i=new Ii(t),a=f(e);try{for(a.s();!(r=a.n()).done;)r.value.recalculate(i,n)}catch(o){a.e(o)}finally{a.f()}}var af=function(){function e(t){v(this,e),this.entries={},this.scheduler=t}return y(e,[{key:"request",value:function(e,t,n,r){var i=this,a=this.entries[e]=this.entries[e]||{callbacks:[]};if(a.result){var o=h(a.result,2),s=o[0],l=o[1];return this.scheduler?this.scheduler.add((function(){r(s,l)}),t):r(s,l),function(){}}return a.callbacks.push(r),a.cancel||(a.cancel=n((function(n,r){a.result=[n,r];var o,s=f(a.callbacks);try{var l=function(){var e=o.value;i.scheduler?i.scheduler.add((function(){e(n,r)}),t):e(n,r)};for(s.s();!(o=s.n()).done;)l()}catch(u){s.e(u)}finally{s.f()}setTimeout((function(){return delete i.entries[e]}),3e3)}))),function(){a.result||(a.callbacks=a.callbacks.filter((function(e){return e!==r})),a.callbacks.length||(a.cancel(),delete i.entries[e]))}}}]),e}();function of(e,t,n){var r=JSON.stringify(e.request);return e.data&&(this.deduped.entries[r]={result:[null,e.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},(function(t){var r=Ne(e.request,(function(e,r,i,a){e?t(e):r&&t(null,{vectorTile:n?void 0:new sl.VectorTile(new Ul(r)),rawData:r,cacheControl:i,expires:a})}));return function(){r.cancel(),t()}}),t)}e.AUTH_ERR_MSG="NO_ACCESS_TOKEN",e.Aabb=Jo,e.Actor=function(){function e(t,n,r){v(this,e),this.target=t,this.parent=n,this.mapId=r,this.callbacks={},this.cancelCallbacks={},N(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=W()?t:_,this.scheduler=new kc}return y(e,[{key:"send",value:function(e,t,n,r){var i=this,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=o,this.callbacks[s]=n);var l=Y(this.globalScope)?void 0:[];return this.target.postMessage({id:s,type:e,hasCallback:!!n,targetMapId:r,mustQueue:a,sourceMapId:this.mapId,data:ui(t,l)},l),{cancel:function(){n&&delete i.callbacks[s],i.target.postMessage({id:s,type:"<cancel>",targetMapId:r,sourceMapId:i.mapId})}}}},{key:"receive",value:function(e){var t=this,n=e.data,r=n.id;if(r&&(!n.targetMapId||this.mapId===n.targetMapId))if("<cancel>"===n.type){var i=this.cancelCallbacks[r];delete this.cancelCallbacks[r],i&&i.cancel()}else if(W()||n.mustQueue){var a=this.callbacks[r];this.cancelCallbacks[r]=this.scheduler.add((function(){return t.processTask(r,n)}),a&&a.metadata||{type:"message"})}else this.processTask(r,n)}},{key:"processTask",value:function(e,t){var n=this;if("<response>"===t.type){var r=this.callbacks[e];delete this.callbacks[e],r&&(t.error?r(ci(t.error)):r(null,ci(t.data)))}else{var i=Y(this.globalScope)?void 0:[],a=t.hasCallback?function(t,r){delete n.cancelCallbacks[e],n.target.postMessage({id:e,type:"<response>",sourceMapId:n.mapId,error:t?ui(t):null,data:ui(r,i)},i)}:function(e){},o=ci(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,o,a);else if(this.parent.getWorkerSource){var s=t.type.split(".");this.parent.getWorkerSource(t.sourceMapId,s[0],o.source)[s[1]](o,a)}else a(new Error("Could not find function ".concat(t.type)))}}},{key:"remove",value:function(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}]),e}(),e.AlphaImage=os,e.CanonicalTileID=Bc,e.Color=xt,e.ColorMode=qh,e.Context=function(){function e(t){v(this,e),this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new uh(this),this.clearDepth=new ch(this),this.clearStencil=new hh(this),this.colorMask=new fh(this),this.depthMask=new dh(this),this.stencilMask=new ph(this),this.stencilFunc=new mh(this),this.stencilOp=new vh(this),this.stencilTest=new yh(this),this.depthRange=new gh(this),this.depthTest=new _h(this),this.depthFunc=new bh(this),this.blend=new xh(this),this.blendFunc=new wh(this),this.blendColor=new Eh(this),this.blendEquation=new Sh(this),this.cullFace=new Th(this),this.cullFaceSide=new kh(this),this.frontFace=new Mh(this),this.program=new Ch(this),this.activeTexture=new Ah(this),this.viewport=new Ih(this),this.bindFramebuffer=new Ph(this),this.bindRenderbuffer=new Rh(this),this.bindTexture=new Lh(this),this.bindVertexBuffer=new Oh(this),this.bindElementBuffer=new Dh(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Nh(this),this.pixelStoreUnpack=new zh(this),this.pixelStoreUnpackPremultiplyAlpha=new Fh(this),this.pixelStoreUnpackFlipY=new Bh(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}return y(e,[{key:"setDefault",value:function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}},{key:"setDirty",value:function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}},{key:"createIndexBuffer",value:function(e,t){return new ah(this,e,t)}},{key:"createVertexBuffer",value:function(e,t,n){return new sh(this,e,t,n)}},{key:"createRenderbuffer",value:function(e,t,n){var r=this.gl,i=r.createRenderbuffer();return this.bindRenderbuffer.set(i),r.renderbufferStorage(r.RENDERBUFFER,e,t,n),this.bindRenderbuffer.set(null),i}},{key:"createFramebuffer",value:function(e,t,n){return new Hh(this,e,t,n)}},{key:"clear",value:function(e){var t=e.color,n=e.depth,r=e.stencil,i=this.gl,a=0;t&&(a|=i.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==n&&(a|=i.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),void 0!==r&&(a|=i.STENCIL_BUFFER_BIT,this.clearStencil.set(r),this.stencilMask.set(255)),i.clear(a)}},{key:"setCullFace",value:function(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}},{key:"setDepthMode",value:function(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}},{key:"setStencilMode",value:function(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}},{key:"setColorMode",value:function(e){b(e.blendFunction,qh.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}},{key:"unbindVAO",value:function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}]),e}(),e.CullFaceMode=Xh,e.DEMData=rh,e.DataConstantProperty=Bi,e.DedupedRequest=af,e.DepthMode=Gh,e.DepthStencilAttachment=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"attachment",value:function(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}]),n}(Vh),e.EXTENT=8192,e.Elevation=function(){function e(){v(this,e)}return y(e,[{key:"getAtPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this._source();if(!n)return t;if(e.y<0||e.y>1)return t;var r=n.getSource().maxzoom,i=1<<r,a=Math.floor(e.x),o=e.x-a,s=new jc(r,a,r,Math.floor(o*i),Math.floor(e.y*i)),l=this.findDEMTileFor(s);if(!l||!l.dem)return t;var u=l.dem,c=1<<l.tileID.canonical.z,h=(o*c-l.tileID.canonical.x)*u.dim,f=(e.y*c-l.tileID.canonical.y)*u.dim,d=Math.floor(h),p=Math.floor(f);return this.exaggeration()*fn(fn(u.get(d,p),u.get(d,p+1),f-p),fn(u.get(d+1,p),u.get(d+1,p+1),f-p),h-d)}},{key:"getAtTileOffset",value:function(e,t,n){var r=1<<e.canonical.z;return this.getAtPoint(new zc(e.wrap+(e.canonical.x+t/8192)/r,(e.canonical.y+n/8192)/r))}},{key:"getForTilePoints",value:function(e,t,n,r){var i=this,a=Jh.create(this,e,r);return!!a&&(t.forEach((function(e){e[2]=i.exaggeration()*a.getElevationAt(e[0],e[1],n)})),!0)}},{key:"getMinMaxForTile",value:function(e){var t=this.findDEMTileFor(e);if(!t||!t.dem)return null;for(var n=t.dem.tree,r=t.tileID,i=1<<e.canonical.z-r.canonical.z,a=e.canonical.x/i-r.canonical.x,o=e.canonical.y/i-r.canonical.y,s=0,l=0;l<e.canonical.z-r.canonical.z&&!n.leaves[s];l++){a*=2,o*=2;var u=2*Math.floor(o)+Math.floor(a);s=n.childOffsets[s]+u,a%=1,o%=1}return{min:this.exaggeration()*n.minimums[s],max:this.exaggeration()*n.maximums[s]}}},{key:"raycast",value:function(e,t,n){throw new Error("Pure virtual method called.")}},{key:"pointCoordinate",value:function(e){throw new Error("Pure virtual method called.")}},{key:"_source",value:function(){throw new Error("Pure virtual method called.")}},{key:"exaggeration",value:function(){throw new Error("Pure virtual method called.")}},{key:"findDEMTileFor",value:function(e){throw new Error("Pure virtual method called.")}},{key:"visibleDemTiles",get:function(){throw new Error("Getter must be implemented in subclass.")}}]),e}(),e.ErrorEvent=Xe,e.EvaluationParameters=Ii,e.Event=qe,e.Evented=Ze,e.Frustum=Yo,e.ImagePosition=lu,e.LngLat=Ac,e.LngLatBounds=Cc,e.MAX_SAFE_INTEGER=x,e.MercatorCoordinate=zc,e.ONE_EM=24,e.OverscaledTileID=jc,e.Point=r,e.Point$1=r,e.Properties=Gi,e.RGBAImage=ss,e.Ray=function(){function e(t,n){v(this,e),this.pos=t,this.dir=n}return y(e,[{key:"intersectsPlane",value:function(e,t,n){var r=Uo(t,this.dir);if(Math.abs(r)<1e-6)return!1;var i=Uo(Go(Po(),e,this.pos),t)/r;return function(e,t){e[0]=t[0],e[1]=t[1],e[2]=t[2]}(n,Fo(Po(),this.pos,this.dir,i)),!0}}]),e}(),e.RequestManager=function(){function e(t,n){v(this,e),this._transformRequestFn=t,this._customAccessToken=n,this._createSkuToken()}return y(e,[{key:"_createSkuToken",value:function(){var e=function(){for(var e="",t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",ue,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}},{key:"_isSkuTokenExpired",value:function(){return Date.now()>this._skuTokenExpiresAt}},{key:"transformRequest",value:function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}},{key:"normalizeStyleURL",value:function(e,t){if(!ce(e))return e;var n=de(e);return n.path="/styles/v1".concat(n.path),this._makeAPIURL(n,this._customAccessToken||t)}},{key:"normalizeGlyphsURL",value:function(e,t){if(!ce(e))return e;var n=de(e);return n.path="/fonts/v1".concat(n.path),this._makeAPIURL(n,this._customAccessToken||t)}},{key:"normalizeSourceURL",value:function(e,t){if(!ce(e))return e;var n=de(e);return n.path="/v4/".concat(n.authority,".json"),n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||t)}},{key:"normalizeSpriteURL",value:function(e,t,n,r){var i=de(e);return ce(e)?(i.path="/styles/v1".concat(i.path,"/sprite").concat(t).concat(n),this._makeAPIURL(i,this._customAccessToken||r)):(i.path+="".concat(t).concat(n),pe(i))}},{key:"normalizeTileURL",value:function(e,t,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!ce(e))return e;var r=de(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,"".concat(t||n&&"raster"!==r.authority&&512===n?"@2x":"").concat(ae.supported?".webp":"$1")),"raster"===r.authority?r.path="/".concat(ie.RASTER_URL_PREFIX).concat(r.path):(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/".concat(ie.TILE_URL_VERSION).concat(r.path));var i=this._customAccessToken||function(e){var t,n=f(e);try{for(n.s();!(t=n.n()).done;){var r=t.value.match(/^access_token=(.*)$/);if(r)return r[1]}}catch(i){n.e(i)}finally{n.f()}return null}(r.params)||ie.ACCESS_TOKEN;return ie.REQUIRE_ACCESS_TOKEN&&i&&this._skuToken&&r.params.push("sku=".concat(this._skuToken)),this._makeAPIURL(r,i)}},{key:"canonicalizeTileURL",value:function(e,t){var n=de(e);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return e;var r="mapbox://";n.path.match(/^\/raster\/v1\//)?r+="raster/".concat(n.path.replace("/".concat(ie.RASTER_URL_PREFIX,"/"),"")):r+="tiles/".concat(n.path.replace("/".concat(ie.TILE_URL_VERSION,"/"),""));var i=n.params;return t&&(i=i.filter((function(e){return!e.match(/^access_token=/)}))),i.length&&(r+="?".concat(i.join("&"))),r}},{key:"canonicalizeTileset",value:function(e,t){var n,r=!!t&&ce(t),i=[],a=f(e.tiles||[]);try{for(a.s();!(n=a.n()).done;){var o=n.value;he(o)?i.push(this.canonicalizeTileURL(o,r)):i.push(o)}}catch(s){a.e(s)}finally{a.f()}return i}},{key:"_makeAPIURL",value:function(e,t){var n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",r=de(ie.API_URL);if(e.protocol=r.protocol,e.authority=r.authority,"http"===e.protocol){var i=e.params.indexOf("secure");i>=0&&e.params.splice(i,1)}if("/"!==r.path&&(e.path="".concat(r.path).concat(e.path)),!ie.REQUIRE_ACCESS_TOKEN)return pe(e);if(!(t=t||ie.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. ".concat(n));if("s"===t[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ".concat(n));return e.params=e.params.filter((function(e){return-1===e.indexOf("access_token")})),e.params.push("access_token=".concat(t)),pe(e)}}]),e}(),e.RequestPerformance=Tc,e.ResourceType=Re,e.SegmentVector=eo,e.SourceCache=Zh,e.StencilMode=Wh,e.StructArrayLayout1ui2=va,e.StructArrayLayout2f1f2i16=sa,e.StructArrayLayout2i4=Ji,e.StructArrayLayout3f12=ra,e.StructArrayLayout3ui6=ua,e.StructArrayLayout4i8=Qi,e.Texture=wc,e.Tile=qc,e.Transitionable=Li,e.Uniform1f=za,e.Uniform1i=function(e){p(n,e);var t=m(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e,r)).current=0,i}return y(n,[{key:"set",value:function(e){this.current!==e&&(this.current=e,this.gl.uniform1i(this.location,e))}}]),n}(Na),e.Uniform2f=function(e){p(n,e);var t=m(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e,r)).current=[0,0],i}return y(n,[{key:"set",value:function(e){e[0]===this.current[0]&&e[1]===this.current[1]||(this.current=e,this.gl.uniform2f(this.location,e[0],e[1]))}}]),n}(Na),e.Uniform3f=function(e){p(n,e);var t=m(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e,r)).current=[0,0,0],i}return y(n,[{key:"set",value:function(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]||(this.current=e,this.gl.uniform3f(this.location,e[0],e[1],e[2]))}}]),n}(Na),e.Uniform4f=Fa,e.UniformColor=Ba,e.UniformMatrix3f=function(e){p(n,e);var t=m(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e,r)).current=ja,i}return y(n,[{key:"set",value:function(e){for(var t=0;t<9;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix3fv(this.location,!1,e);break}}}]),n}(Na),e.UniformMatrix4f=function(e){p(n,e);var t=m(n);function n(e,r){var i;return v(this,n),(i=t.call(this,e,r)).current=Ua,i}return y(n,[{key:"set",value:function(e){if(e[12]!==this.current[12]||e[0]!==this.current[0])return this.current=e,void this.gl.uniformMatrix4fv(this.location,!1,e);for(var t=1;t<16;t++)if(e[t]!==this.current[t]){this.current=e,this.gl.uniformMatrix4fv(this.location,!1,e);break}}}]),n}(Na),e.UnwrappedTileID=Uc,e.ValidationError=Ye,e.VectorTileWorkerSource=function(){function e(t,n,r,i){v(this,e),this.actor=t,this.layerIndex=n,this.availableImages=r,this.loadVectorData=i||of,this.loading={},this.loaded={},this.deduped=new af(t.scheduler)}return y(e,[{key:"loadTile",value:function(e,t){var n=this,r=e.uid,i=!!(e&&e.request&&e.request.collectResourceTiming)&&new Tc(e.request),a=this.loading[r]=new nf(e);a.abort=this.loadVectorData(e,(function(e,o){var s=!n.loading[r];if(delete n.loading[r],s||e||!o)return a.status="done",s||(n.loaded[r]=a),t(e);var l=o.rawData,u={};o.expires&&(u.expires=o.expires),o.cacheControl&&(u.cacheControl=o.cacheControl);var c={};if(i){var h=i.finish();h&&(c.resourceTiming=JSON.parse(JSON.stringify(h)))}a.vectorTile=o.vectorTile||new sl.VectorTile(new Ul(l)),a.parse(a.vectorTile,n.layerIndex,n.availableImages,n.actor,(function(e,n){if(e||!n)return t(e);t(null,P({rawTileData:l.slice(0)},n,u,c))})),n.loaded=n.loaded||{},n.loaded[r]=a}))}},{key:"reloadTile",value:function(e,t){var n=this,r=this.loaded,i=e.uid,a=this;if(r&&r[i]){var o=r[i];o.showCollisionBoxes=e.showCollisionBoxes,o.enableTerrain=!!e.enableTerrain;var s=function(e,r){var i=o.reloadCallback;i&&(delete o.reloadCallback,o.parse(o.vectorTile,a.layerIndex,n.availableImages,a.actor,i)),t(e,r)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}}},{key:"abortTile",value:function(e,t){var n=e.uid,r=this.loading[n];r&&(r.abort&&r.abort(),delete this.loading[n]),t()}},{key:"removeTile",value:function(e,t){var n=this.loaded,r=e.uid;n&&n[r]&&delete n[r],t()}}]),e}(),e.WritingMode=cu,e.ZoomHistory=hi,e.add=Do,e.addDynamicAttributes=nc,e.altitudeFromMercatorZ=Nc,e.asyncAll=function(e,t,n){if(!e.length)return n(null,[]);var r=e.length,i=new Array(e.length),a=null;e.forEach((function(e,o){t(e,(function(e,t){e&&(a=e),i[o]=t,0==--r&&n(a,i)}))}))},e.bezier=k,e.bindAll=N,e.browser=re,e.bufferConvexPolygon=function(e,t){for(var n=[],r=0;r<e.length;r++){var i=A(r-1,-1,e.length-1),a=A(r+1,-1,e.length-1),o=e[r],s=e[a],l=e[i].sub(o).unit(),u=s.sub(o).unit(),c=u.angleWithSep(l.x,l.y),h=l.add(u).unit().mult(-1*t/Math.sin(c/2));n.push(o.add(h))}return n},e.cacheEntryPossiblyAdded=function(e){++Ie>ke&&(e.getActor().send("enforceCacheSizeLimit",Te),Ie=0)},e.clamp=C,e.clearTileCache=function(e){var t=_.caches.delete("mapbox-tiles");e&&t.catch(e).then((function(){return e()}))},e.clipLine=Ru,e.clone=function(e){var t=new ko(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},e.clone$1=U,e.collisionCircleLayout=Pl,e.config=ie,e.conjugate=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.create=function(){var e=new ko(16);return ko!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},e.create$1=Mo,e.create$2=function(){var e=new ko(4);return ko!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},e.createExpression=dr,e.createLayout=Ki,e.createStyleLayer=function(e){return"custom"===e.type?new dc(e):new vc[e.type](e)},e.cross=jo,e.deepEqual=b,e.degToRad=S,e.div=function(e,t,n){return e[0]=t[0]/n[0],e[1]=t[1]/n[1],e[2]=t[2]/n[2],e},e.dot=Uo,e.ease=M,e.easeCubicInOut=T,e.emitValidationErrors=$r,e.endsWith=z,e.enforceCacheSizeLimit=function(e){Me(),ve&&ve.then((function(t){t.keys().then((function(n){for(var r=0;r<n.length-e;r++)t.delete(n[r])}))}))},e.evaluateSizeForFeature=Ll,e.evaluateSizeForZoom=Ol,e.evaluateVariableOffset=Gu,e.evented=ki,e.exactEquals=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.exactEquals$1=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]},e.extend=P,e.featureFilter=kr,e.filterObject=B,e.fromMat4=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},e.fromQuat=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n+n,s=r+r,l=i+i,u=n*o,c=r*o,h=r*s,f=i*o,d=i*s,p=i*l,m=a*o,v=a*s,y=a*l;return e[0]=1-h-p,e[1]=c+y,e[2]=f-v,e[3]=0,e[4]=c-y,e[5]=1-u-p,e[6]=d+m,e[7]=0,e[8]=f+v,e[9]=d-m,e[10]=1-u-h,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},e.fromRotation=function(e,t){var n=Math.sin(t),r=Math.cos(t);return e[0]=r,e[1]=n,e[2]=0,e[3]=-n,e[4]=r,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.getAnchorAlignment=xu,e.getAnchorJustification=qu,e.getArrayBuffer=Ne,e.getBounds=function(e){var t,n=1/0,i=1/0,a=-1/0,o=-1/0,s=f(e);try{for(s.s();!(t=s.n()).done;){var l=t.value;n=Math.min(n,l.x),i=Math.min(i,l.y),a=Math.max(a,l.x),o=Math.max(o,l.y)}}catch(u){s.e(u)}finally{s.f()}return{min:new r(n,i),max:new r(a,o)}},e.getImage=He,e.getJSON=function(e,t){return De(P(e,{type:"json"}),t)},e.getMapSessionAPI=Se,e.getRTLTextPluginStatus=Mi,e.getReferrer=Oe,e.getVideo=function(e,t){var n=_.document.createElement("video");n.muted=!0,n.onloadstart=function(){t(null,n)};for(var r=0;r<e.length;r++){var i=_.document.createElement("source");Be(e[r])||(n.crossOrigin="Anonymous"),i.src=e[r],n.appendChild(i)}return{cancel:function(){}}},e.identity=Co,e.identity$1=Zo,e.invert=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=t[4],s=t[5],l=t[6],u=t[7],c=t[8],h=t[9],f=t[10],d=t[11],p=t[12],m=t[13],v=t[14],y=t[15],g=n*s-r*o,_=n*l-i*o,b=n*u-a*o,x=r*l-i*s,w=r*u-a*s,E=i*u-a*l,S=c*m-h*p,T=c*v-f*p,k=c*y-d*p,M=h*v-f*m,C=h*y-d*m,A=f*y-d*v,I=g*A-_*C+b*M+x*k-w*T+E*S;return I?(e[0]=(s*A-l*C+u*M)*(I=1/I),e[1]=(i*C-r*A-a*M)*I,e[2]=(m*E-v*w+y*x)*I,e[3]=(f*w-h*E-d*x)*I,e[4]=(l*k-o*A-u*T)*I,e[5]=(n*A-i*k+a*T)*I,e[6]=(v*b-p*E-y*_)*I,e[7]=(c*E-f*b+d*_)*I,e[8]=(o*C-s*k+u*S)*I,e[9]=(r*k-n*C-a*S)*I,e[10]=(p*w-m*b+y*g)*I,e[11]=(h*b-c*w-d*g)*I,e[12]=(s*T-o*M-l*S)*I,e[13]=(n*M-r*T+i*S)*I,e[14]=(m*_-p*x-v*g)*I,e[15]=(c*x-h*_+f*g)*I,e):null},e.isChar=fi,e.isMapboxURL=ce,e.latFromMercatorY=Dc,e.len=Wo,e.length=Lo,e.length$1=function(e){return Math.hypot(e[0],e[1],e[2],e[3])},e.loadVectorTile=of,e.makeRequest=De,e.mercatorXfromLng=Rc,e.mercatorYfromLat=Lc,e.mercatorZfromAltitude=Oc,e.mul=Io,e.mul$1=function(e,t,n){return e[0]=t[0]*n[0],e[1]=t[1]*n[1],e[2]=t[2]*n[2],e},e.multiply=Ao,e.mvt=sl,e.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},e.normalize=Bo,e.normalize$1=function(e,t){var n=t[0],r=t[1],i=t[2],a=t[3],o=n*n+r*r+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=n*o,e[1]=r*o,e[2]=i*o,e[3]=a*o,e},e.number=fn,e.offscreenCanvasSupported=Pe,e.ortho=function(e,t,n,r,i,a,o){var s=1/(t-n),l=1/(r-i),u=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*u,e[11]=0,e[12]=(t+n)*s,e[13]=(i+r)*l,e[14]=(o+a)*u,e[15]=1,e},e.parseGlyphPBF=function(e){return new Ul(e).readFields(iu,[])},e.pbf=Ul,e.perspective=function(e,t,n,r,i){var a,o=1/Math.tan(t/2);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0?(e[10]=(i+r)*(a=1/(r-i)),e[14]=2*i*r*a):(e[10]=-1,e[14]=-2*r),e},e.pick=function(e,t){for(var n={},r=0;r<t.length;r++){var i=t[r];i in e&&(n[i]=e[i])}return n},e.plugin=Ai,e.polygonIntersectsBox=go,e.polygonIntersectsPolygon=so,e.polygonizeBounds=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=new r(n,n),a=e.sub(i),o=t.add(i);return[a,new r(o.x,a.y),o,new r(a.x,o.y),a]},e.posAttributes=Wc,e.postMapLoadEvent=we,e.postTurnstileEvent=be,e.potpack=su,e.prevPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},e.radToDeg=function(e){return e*E},e.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.registerForPluginStateChange=function(e){return e({pluginStatus:wi,pluginURL:Ei}),ki.on("pluginStateChange",e),e},e.renderColorRamp=us,e.rotate=function(e,t,n){var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=r*l+a*s,e[1]=i*l+o*s,e[2]=r*-s+a*l,e[3]=i*-s+o*l,e},e.rotateX=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[4],o=t[5],s=t[6],l=t[7],u=t[8],c=t[9],h=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=a*i+u*r,e[5]=o*i+c*r,e[6]=s*i+h*r,e[7]=l*i+f*r,e[8]=u*i-a*r,e[9]=c*i-o*r,e[10]=h*i-s*r,e[11]=f*i-l*r,e},e.rotateX$1=Ko,e.rotateY=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],l=t[3],u=t[8],c=t[9],h=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i-u*r,e[1]=o*i-c*r,e[2]=s*i-h*r,e[3]=l*i-f*r,e[8]=a*r+u*i,e[9]=o*r+c*i,e[10]=s*r+h*i,e[11]=l*r+f*i,e},e.rotateZ=function(e,t,n){var r=Math.sin(n),i=Math.cos(n),a=t[0],o=t[1],s=t[2],l=t[3],u=t[4],c=t[5],h=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=a*i+u*r,e[1]=o*i+c*r,e[2]=s*i+h*r,e[3]=l*i+f*r,e[4]=u*i-a*r,e[5]=c*i-o*r,e[6]=h*i-s*r,e[7]=f*i-l*r,e},e.rotateZ$1=function(e,t,n){n*=.5;var r=t[0],i=t[1],a=t[2],o=t[3],s=Math.sin(n),l=Math.cos(n);return e[0]=r*l+i*s,e[1]=i*l-r*s,e[2]=a*l+o*s,e[3]=o*l-a*s,e},e.scale=function(e,t,n){var r=n[0],i=n[1],a=n[2];return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*a,e[9]=t[9]*a,e[10]=t[10]*a,e[11]=t[11]*a,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},e.scale$1=function(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e},e.scale$2=zo,e.scaleAndAdd=Fo,e.setCacheLimits=function(e,t){Te=e,ke=t},e.setRTLTextPlugin=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("deferred"===wi||"loading"===wi||"loaded"===wi)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ei=re.resolveURL(e),wi="deferred",xi=t,Ti(),n||Ci()},e.styleSpec=Ke,e.sub=Go,e.subtract=No,e.symbolSize=Dl,e.transformMat3=function(e,t,n){var r=t[0],i=t[1],a=t[2];return e[0]=r*n[0]+i*n[3]+a*n[6],e[1]=r*n[1]+i*n[4]+a*n[7],e[2]=r*n[2]+i*n[5]+a*n[8],e},e.transformMat4=qo,e.transformQuat=Vo,e.translate=function(e,t,n){var r,i,a,o,s,l,u,c,h,f,d,p,m=n[0],v=n[1],y=n[2];return t===e?(e[12]=t[0]*m+t[4]*v+t[8]*y+t[12],e[13]=t[1]*m+t[5]*v+t[9]*y+t[13],e[14]=t[2]*m+t[6]*v+t[10]*y+t[14],e[15]=t[3]*m+t[7]*v+t[11]*y+t[15]):(i=t[1],a=t[2],o=t[3],s=t[4],l=t[5],u=t[6],c=t[7],h=t[8],f=t[9],d=t[10],p=t[11],e[0]=r=t[0],e[1]=i,e[2]=a,e[3]=o,e[4]=s,e[5]=l,e[6]=u,e[7]=c,e[8]=h,e[9]=f,e[10]=d,e[11]=p,e[12]=r*m+s*v+h*y+t[12],e[13]=i*m+l*v+f*y+t[13],e[14]=a*m+u*v+d*y+t[14],e[15]=o*m+c*v+p*y+t[15]),e},e.triggerPluginCompletionEvent=Si,e.uniqueId=L,e.validateCustomStyleLayer=function(e){var t=[],n=e.id;return void 0===n&&t.push({message:"layers.".concat(n,': missing required property "id"')}),void 0===e.render&&t.push({message:"layers.".concat(n,': missing required method "render"')}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:"layers.".concat(n,': property "renderingMode" must be either "2d" or "3d"')}),t},e.validateLight=Yr,e.validateStyle=Kr,e.values=I,e.vectorTile=sl,e.version="2.0.1",e.warnOnce=V,e.webpSupported=ae,e.window=_,e.wrap=A})),g(["./shared"],(function(e){function t(e){var n=typeof e;if("number"===n||"boolean"===n||"string"===n||null==e)return JSON.stringify(e);if(Array.isArray(e)){var r,i="[",a=f(e);try{for(a.s();!(r=a.n()).done;){var o=r.value;i+="".concat(t(o),",")}}catch(c){a.e(c)}finally{a.f()}return"".concat(i,"]")}for(var s=Object.keys(e).sort(),l="{",u=0;u<s.length;u++)l+="".concat(JSON.stringify(s[u]),":").concat(t(e[s[u]]),",");return"".concat(l,"}")}function n(n){var r,i="",a=f(e.refProperties);try{for(a.s();!(r=a.n()).done;){var o=r.value;i+="/".concat(t(n[o]))}}catch(s){a.e(s)}finally{a.f()}return i}var r=function(){function t(e){v(this,t),this.keyCache={},e&&this.replace(e)}return y(t,[{key:"replace",value:function(e){this._layerConfigs={},this._layers={},this.update(e,[])}},{key:"update",value:function(t,r){var i,a=this,o=f(t);try{for(o.s();!(i=o.n()).done;){var s=i.value;this._layerConfigs[s.id]=s;var l=this._layers[s.id]=e.createStyleLayer(s);l._featureFilter=e.featureFilter(l.filter),this.keyCache[s.id]&&delete this.keyCache[s.id]}}catch(w){o.e(w)}finally{o.f()}var u,c=f(r);try{for(c.s();!(u=c.n()).done;){var h=u.value;delete this.keyCache[h],delete this._layerConfigs[h],delete this._layers[h]}}catch(w){c.e(w)}finally{c.f()}this.familiesBySource={};var d,p=function(e,t){for(var r={},i=0;i<e.length;i++){var a=t&&t[e[i].id]||n(e[i]);t&&(t[e[i].id]=a);var o=r[a];o||(o=r[a]=[]),o.push(e[i])}var s=[];for(var l in r)s.push(r[l]);return s}(e.values(this._layerConfigs),this.keyCache),m=f(p);try{for(m.s();!(d=m.n()).done;){var v=d.value.map((function(e){return a._layers[e.id]})),y=v[0];if("none"!==y.visibility){var g=y.source||"",_=this.familiesBySource[g];_||(_=this.familiesBySource[g]={});var b=y.sourceLayer||"_geojsonTileLayer",x=_[b];x||(x=_[b]=[]),x.push(v)}}}catch(w){m.e(w)}finally{m.f()}}}]),t}(),i=e.window.ImageBitmap,a=function(){function t(){v(this,t)}return y(t,[{key:"loadTile",value:function(t,n){var r=t.uid,a=t.encoding,o=t.rawImageData,s=t.padding,l=t.buildQuadTree,u=i&&o instanceof i?this.getImageData(o,s):o;n(null,new e.DEMData(r,u,a,s<1,l))}},{key:"getImageData",value:function(t,n){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);var r=this.offscreenCanvasContext.getImageData(-n,-n,t.width+2*n,t.height+2*n);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new e.RGBAImage({width:r.width,height:r.height},r.data)}}]),t}();function l(e,t){if(0!==e.length){u(e[0],t);for(var n=1;n<e.length;n++)u(e[n],!t)}}function u(e,t){for(var n=0,r=0,i=e.length,a=i-1;r<i;a=r++)n+=(e[r][0]-e[a][0])*(e[a][1]+e[r][1]);n>=0!=!!t&&e.reverse()}var c=e.vectorTile.VectorTileFeature.prototype.toGeoJSON,d=function(){function t(n){v(this,t),this._feature=n,this.extent=e.EXTENT,this.type=n.type,this.properties=n.tags,"id"in n&&!isNaN(n.id)&&(this.id=parseInt(n.id,10))}return y(t,[{key:"loadGeometry",value:function(){if(1===this._feature.type){var t,n=[],r=f(this._feature.geometry);try{for(r.s();!(t=r.n()).done;){var i=t.value;n.push([new e.Point$1(i[0],i[1])])}}catch(p){r.e(p)}finally{r.f()}return n}var a,o=[],s=f(this._feature.geometry);try{for(s.s();!(a=s.n()).done;){var l,u=a.value,c=[],h=f(u);try{for(h.s();!(l=h.n()).done;){var d=l.value;c.push(new e.Point$1(d[0],d[1]))}}catch(p){h.e(p)}finally{h.f()}o.push(c)}}catch(p){s.e(p)}finally{s.f()}return o}},{key:"toGeoJSON",value:function(e,t,n){return c.call(this,e,t,n)}}]),t}(),g=function(){function t(n){v(this,t),this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=e.EXTENT,this.length=n.length,this._features=n}return y(t,[{key:"feature",value:function(e){return new d(this._features[e])}}]),t}(),_=e.vectorTile.VectorTileFeature,b=x;function x(e,t){this.options=t||{},this.features=e,this.length=e.length}function w(e,t){this.id="number"==typeof e.id?e.id:void 0,this.type=e.type,this.rawGeometry=1===e.type?[e.geometry]:e.geometry,this.properties=e.tags,this.extent=t||4096}x.prototype.feature=function(e){return new w(this.features[e],this.options.extent)},w.prototype.loadGeometry=function(){var t=this.rawGeometry;this.geometry=[];for(var n=0;n<t.length;n++){for(var r=t[n],i=[],a=0;a<r.length;a++)i.push(new e.Point$1(r[a][0],r[a][1]));this.geometry.push(i)}return this.geometry},w.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var e=this.geometry,t=1/0,n=-1/0,r=1/0,i=-1/0,a=0;a<e.length;a++)for(var o=e[a],s=0;s<o.length;s++){var l=o[s];t=Math.min(t,l.x),n=Math.max(n,l.x),r=Math.min(r,l.y),i=Math.max(i,l.y)}return[t,r,n,i]},w.prototype.toGeoJSON=_.prototype.toGeoJSON;var E=T,S=b;function T(t){var n=new e.pbf;return function(e,t){for(var n in e.layers)t.writeMessage(3,k,e.layers[n])}(t,n),n.finish()}function k(e,t){var n;t.writeVarintField(15,e.version||1),t.writeStringField(1,e.name||""),t.writeVarintField(5,e.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<e.length;n++)r.feature=e.feature(n),t.writeMessage(2,M,r);var i=r.keys;for(n=0;n<i.length;n++)t.writeStringField(3,i[n]);var a=r.values;for(n=0;n<a.length;n++)t.writeMessage(4,R,a[n])}function M(e,t){var n=e.feature;void 0!==n.id&&t.writeVarintField(1,n.id),t.writeMessage(2,C,e),t.writeVarintField(3,n.type),t.writeMessage(4,P,n)}function C(e,t){var n=e.feature,r=e.keys,i=e.values,a=e.keycache,o=e.valuecache;for(var s in n.properties){var l=a[s];void 0===l&&(r.push(s),a[s]=l=r.length-1),t.writeVarint(l);var u=n.properties[s],c=typeof u;"string"!==c&&"boolean"!==c&&"number"!==c&&(u=JSON.stringify(u));var h=c+":"+u,f=o[h];void 0===f&&(i.push(u),o[h]=f=i.length-1),t.writeVarint(f)}}function A(e,t){return(t<<3)+(7&e)}function I(e){return e<<1^e>>31}function P(e,t){for(var n=e.loadGeometry(),r=e.type,i=0,a=0,o=n.length,s=0;s<o;s++){var l=n[s],u=1;1===r&&(u=l.length),t.writeVarint(A(1,u));for(var c=3===r?l.length-1:l.length,h=0;h<c;h++){1===h&&1!==r&&t.writeVarint(A(2,c-1));var f=l[h].x-i,d=l[h].y-a;t.writeVarint(I(f)),t.writeVarint(I(d)),i+=f,a+=d}3===r&&t.writeVarint(A(7,1))}}function R(e,t){var n=typeof e;"string"===n?t.writeStringField(1,e):"boolean"===n?t.writeBooleanField(7,e):"number"===n&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}function L(e,t,n,r){O(e,n,r),O(t,2*n,2*r),O(t,2*n+1,2*r+1)}function O(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function D(e,t,n,r){var i=e-n,a=t-r;return i*i+a*a}E.fromVectorTileJs=T,E.fromGeojsonVt=function(e,t){t=t||{};var n={};for(var r in e)n[r]=new b(e[r].features,t),n[r].name=r,n[r].version=t.version,n[r].extent=t.extent;return T({layers:n})},E.GeoJSONWrapper=S;var N=function(e){return e[0]},z=function(e){return e[1]},F=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Float64Array;v(this,e),this.nodeSize=i,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,s=this.ids=new o(t.length),l=this.coords=new a(2*t.length),u=0;u<t.length;u++)s[u]=u,l[2*u]=n(t[u]),l[2*u+1]=r(t[u]);!function e(t,n,r,i,a,o){if(!(a-i<=r)){var s=i+a>>1;!function e(t,n,r,i,a,o){for(;a>i;){if(a-i>600){var s=a-i+1,l=r-i+1,u=Math.log(s),c=.5*Math.exp(2*u/3),h=.5*Math.sqrt(u*c*(s-c)/s)*(l-s/2<0?-1:1);e(t,n,r,Math.max(i,Math.floor(r-l*c/s+h)),Math.min(a,Math.floor(r+(s-l)*c/s+h)),o)}var f=n[2*r+o],d=i,p=a;for(L(t,n,i,r),n[2*a+o]>f&&L(t,n,i,a);d<p;){for(L(t,n,d,p),d++,p--;n[2*d+o]<f;)d++;for(;n[2*p+o]>f;)p--}n[2*i+o]===f?L(t,n,i,p):L(t,n,++p,a),p<=r&&(i=p+1),r<=p&&(a=p-1)}}(t,n,s,i,a,o%2),e(t,n,r,i,s-1,o+1),e(t,n,r,s+1,a,o+1)}}(s,l,i,0,s.length-1,0)}return y(e,[{key:"range",value:function(e,t,n,r){return function(e,t,n,r,i,a,o){for(var s,l,u=[0,e.length-1,0],c=[];u.length;){var h=u.pop(),f=u.pop(),d=u.pop();if(f-d<=o)for(var p=d;p<=f;p++)s=t[2*p],l=t[2*p+1],s>=n&&s<=i&&l>=r&&l<=a&&c.push(e[p]);else{var m=Math.floor((d+f)/2);s=t[2*m],l=t[2*m+1],s>=n&&s<=i&&l>=r&&l<=a&&c.push(e[m]);var v=(h+1)%2;(0===h?n<=s:r<=l)&&(u.push(d),u.push(m-1),u.push(v)),(0===h?i>=s:a>=l)&&(u.push(m+1),u.push(f),u.push(v))}}return c}(this.ids,this.coords,e,t,n,r,this.nodeSize)}},{key:"within",value:function(e,t,n){return function(e,t,n,r,i,a){for(var o=[0,e.length-1,0],s=[],l=i*i;o.length;){var u=o.pop(),c=o.pop(),h=o.pop();if(c-h<=a)for(var f=h;f<=c;f++)D(t[2*f],t[2*f+1],n,r)<=l&&s.push(e[f]);else{var d=Math.floor((h+c)/2),p=t[2*d],m=t[2*d+1];D(p,m,n,r)<=l&&s.push(e[d]);var v=(u+1)%2;(0===u?n-i<=p:r-i<=m)&&(o.push(h),o.push(d-1),o.push(v)),(0===u?n+i>=p:r+i>=m)&&(o.push(d+1),o.push(c),o.push(v))}}return s}(this.ids,this.coords,e,t,n,this.nodeSize)}}]),e}(),B={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(e){return e}},U=function(){function e(t){v(this,e),this.options=Z(Object.create(B),t),this.trees=new Array(this.options.maxZoom+1)}return y(e,[{key:"load",value:function(e){var t=this.options,n=t.log,r=t.minZoom,i=t.maxZoom,a=t.nodeSize;n&&console.time("total time");var o="prepare ".concat(e.length," points");n&&console.time(o),this.points=e;for(var s=[],l=0;l<e.length;l++)e[l].geometry&&s.push(V(e[l],l));this.trees[i+1]=new F(s,K,Y,a,Float32Array),n&&console.timeEnd(o);for(var u=i;u>=r;u--){var c=+Date.now();s=this._cluster(s,u),this.trees[u]=new F(s,K,Y,a,Float32Array),n&&console.log("z%d: %d clusters in %dms",u,s.length,+Date.now()-c)}return n&&console.timeEnd("total time"),this}},{key:"getClusters",value:function(e,t){var n=((e[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,e[1])),i=180===e[2]?180:((e[2]+180)%360+360)%360-180,a=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)n=-180,i=180;else if(n>i){var o=this.getClusters([n,r,180,a],t),s=this.getClusters([-180,r,i,a],t);return o.concat(s)}var l,u=this.trees[this._limitZoom(t)],c=u.range(W(n),q(a),W(i),q(r)),h=[],d=f(c);try{for(d.s();!(l=d.n()).done;){var p=l.value,m=u.points[p];h.push(m.numPoints?H(m):this.points[m.index])}}catch(v){d.e(v)}finally{d.f()}return h}},{key:"getChildren",value:function(e){var t=this._getOriginId(e),n=this._getOriginZoom(e),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var a=i.points[t];if(!a)throw new Error(r);var o,s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),l=i.within(a.x,a.y,s),u=[],c=f(l);try{for(c.s();!(o=c.n()).done;){var h=o.value,d=i.points[h];d.parentId===e&&u.push(d.numPoints?H(d):this.points[d.index])}}catch(p){c.e(p)}finally{c.f()}if(0===u.length)throw new Error(r);return u}},{key:"getLeaves",value:function(e,t,n){var r=[];return this._appendLeaves(r,e,t=t||10,n=n||0,0),r}},{key:"getTile",value:function(e,t,n){var r=this.trees[this._limitZoom(e)],i=Math.pow(2,e),a=this.options,o=a.extent,s=a.radius/o,l=(n-s)/i,u=(n+1+s)/i,c={features:[]};return this._addTileFeatures(r.range((t-s)/i,l,(t+1+s)/i,u),r.points,t,n,i,c),0===t&&this._addTileFeatures(r.range(1-s/i,l,1,u),r.points,i,n,i,c),t===i-1&&this._addTileFeatures(r.range(0,l,s/i,u),r.points,-1,n,i,c),c.features.length?c:null}},{key:"getClusterExpansionZoom",value:function(e){for(var t=this._getOriginZoom(e)-1;t<=this.options.maxZoom;){var n=this.getChildren(e);if(t++,1!==n.length)break;e=n[0].properties.cluster_id}return t}},{key:"_appendLeaves",value:function(e,t,n,r,i){var a,o=this.getChildren(t),s=f(o);try{for(s.s();!(a=s.n()).done;){var l=a.value,u=l.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(e,u.cluster_id,n,r,i):i<r?i++:e.push(l),e.length===n)break}}catch(c){s.e(c)}finally{s.f()}return i}},{key:"_addTileFeatures",value:function(e,t,n,r,i,a){var o,s=f(e);try{for(s.s();!(o=s.n()).done;){var l=t[o.value],u=l.numPoints,c={type:1,geometry:[[Math.round(this.options.extent*(l.x*i-n)),Math.round(this.options.extent*(l.y*i-r))]],tags:u?G(l):this.points[l.index].properties},h=void 0;u?h=l.id:this.options.generateId?h=l.index:this.points[l.index].id&&(h=this.points[l.index].id),void 0!==h&&(c.id=h),a.features.push(c)}}catch(d){s.e(d)}finally{s.f()}}},{key:"_limitZoom",value:function(e){return Math.max(this.options.minZoom,Math.min(+e,this.options.maxZoom+1))}},{key:"_cluster",value:function(e,t){for(var n=[],r=this.options,i=r.radius,a=r.extent,o=r.reduce,s=r.minPoints,l=i/(a*Math.pow(2,t)),u=0;u<e.length;u++){var c=e[u];if(!(c.zoom<=t)){c.zoom=t;var h,d=this.trees[t+1],p=d.within(c.x,c.y,l),m=c.numPoints||1,v=m,y=f(p);try{for(y.s();!(h=y.n()).done;){var g=h.value,_=d.points[g];_.zoom>t&&(v+=_.numPoints||1)}}catch(L){y.e(L)}finally{y.f()}if(v>=s){var b,x=c.x*m,w=c.y*m,E=o&&m>1?this._map(c,!0):null,S=(u<<5)+(t+1)+this.points.length,T=f(p);try{for(T.s();!(b=T.n()).done;){var k=b.value,M=d.points[k];if(!(M.zoom<=t)){M.zoom=t;var C=M.numPoints||1;x+=M.x*C,w+=M.y*C,M.parentId=S,o&&(E||(E=this._map(c,!0)),o(E,this._map(M)))}}}catch(L){T.e(L)}finally{T.f()}c.parentId=S,n.push(j(x/v,w/v,S,v,E))}else if(n.push(c),v>1){var A,I=f(p);try{for(I.s();!(A=I.n()).done;){var P=A.value,R=d.points[P];R.zoom<=t||(R.zoom=t,n.push(R))}}catch(L){I.e(L)}finally{I.f()}}}}return n}},{key:"_getOriginId",value:function(e){return e-this.points.length>>5}},{key:"_getOriginZoom",value:function(e){return(e-this.points.length)%32}},{key:"_map",value:function(e,t){if(e.numPoints)return t?Z({},e.properties):e.properties;var n=this.points[e.index].properties,r=this.options.map(n);return t&&r===n?Z({},r):r}}]),e}();function j(e,t,n,r,i){return{x:e,y:t,zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function V(e,t){var n=h(e.geometry.coordinates,2),r=n[0],i=n[1];return{x:W(r),y:q(i),zoom:1/0,index:t,parentId:-1}}function H(e){return{type:"Feature",id:e.id,properties:G(e),geometry:{type:"Point",coordinates:[(t=e.x,360*(t-.5)),X(e.y)]}};var t}function G(e){var t=e.numPoints,n=t>=1e4?"".concat(Math.round(t/1e3),"k"):t>=1e3?"".concat(Math.round(t/100)/10,"k"):t;return Z(Z({},e.properties),{cluster:!0,cluster_id:e.id,point_count:t,point_count_abbreviated:n})}function W(e){return e/360+.5}function q(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function X(e){var t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function Z(e,t){for(var n in t)e[n]=t[n];return e}function K(e){return e.x}function Y(e){return e.y}function J(e,t,n,r,i,a){var o=i-n,s=a-r;if(0!==o||0!==s){var l=((e-n)*o+(t-r)*s)/(o*o+s*s);l>1?(n=i,r=a):l>0&&(n+=o*l,r+=s*l)}return(o=e-n)*o+(s=t-r)*s}function Q(e,t,n,r){var i={id:void 0===e?null:e,type:t,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(e){var t=e.geometry,n=e.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)$(e,t);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<t.length;r++)$(e,t[r]);else if("MultiPolygon"===n)for(r=0;r<t.length;r++)for(var i=0;i<t[r].length;i++)$(e,t[r][i])}(i),i}function $(e,t){for(var n=0;n<t.length;n+=3)e.minX=Math.min(e.minX,t[n]),e.minY=Math.min(e.minY,t[n+1]),e.maxX=Math.max(e.maxX,t[n]),e.maxY=Math.max(e.maxY,t[n+1])}function ee(e,t,n,r){if(t.geometry){var i=t.geometry.coordinates,a=t.geometry.type,o=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],l=t.id;if(n.promoteId?l=t.properties[n.promoteId]:n.generateId&&(l=r||0),"Point"===a)te(i,s);else if("MultiPoint"===a)for(var u=0;u<i.length;u++)te(i[u],s);else if("LineString"===a)ne(i,s,o,!1);else if("MultiLineString"===a){if(n.lineMetrics){for(u=0;u<i.length;u++)ne(i[u],s=[],o,!1),e.push(Q(l,"LineString",s,t.properties));return}re(i,s,o,!1)}else if("Polygon"===a)re(i,s,o,!0);else{if("MultiPolygon"!==a){if("GeometryCollection"===a){for(u=0;u<t.geometry.geometries.length;u++)ee(e,{id:l,geometry:t.geometry.geometries[u],properties:t.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(u=0;u<i.length;u++){var c=[];re(i[u],c,o,!0),s.push(c)}}e.push(Q(l,a,s,t.properties))}}function te(e,t){t.push(ie(e[0])),t.push(ae(e[1])),t.push(0)}function ne(e,t,n,r){for(var i,a,o=0,s=0;s<e.length;s++){var l=ie(e[s][0]),u=ae(e[s][1]);t.push(l),t.push(u),t.push(0),s>0&&(o+=r?(i*u-l*a)/2:Math.sqrt(Math.pow(l-i,2)+Math.pow(u-a,2))),i=l,a=u}var c=t.length-3;t[2]=1,function e(t,n,r,i){for(var a,o=i,s=r-n>>1,l=r-n,u=t[n],c=t[n+1],h=t[r],f=t[r+1],d=n+3;d<r;d+=3){var p=J(t[d],t[d+1],u,c,h,f);if(p>o)a=d,o=p;else if(p===o){var m=Math.abs(d-s);m<l&&(a=d,l=m)}}o>i&&(a-n>3&&e(t,n,a,i),t[a+2]=o,r-a>3&&e(t,a,r,i))}(t,0,c,n),t[c+2]=1,t.size=Math.abs(o),t.start=0,t.end=t.size}function re(e,t,n,r){for(var i=0;i<e.length;i++){var a=[];ne(e[i],a,n,r),t.push(a)}}function ie(e){return e/360+.5}function ae(e){var t=Math.sin(e*Math.PI/180),n=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return n<0?0:n>1?1:n}function oe(e,t,n,r,i,a,o,s){if(r/=t,a>=(n/=t)&&o<r)return e;if(o<n||a>=r)return null;for(var l=[],u=0;u<e.length;u++){var c=e[u],h=c.geometry,f=c.type,d=0===i?c.minX:c.minY,p=0===i?c.maxX:c.maxY;if(d>=n&&p<r)l.push(c);else if(!(p<n||d>=r)){var m=[];if("Point"===f||"MultiPoint"===f)se(h,m,n,r,i);else if("LineString"===f)le(h,m,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===f)ce(h,m,n,r,i,!1);else if("Polygon"===f)ce(h,m,n,r,i,!0);else if("MultiPolygon"===f)for(var v=0;v<h.length;v++){var y=[];ce(h[v],y,n,r,i,!0),y.length&&m.push(y)}if(m.length){if(s.lineMetrics&&"LineString"===f){for(v=0;v<m.length;v++)l.push(Q(c.id,f,m[v],c.tags));continue}"LineString"!==f&&"MultiLineString"!==f||(1===m.length?(f="LineString",m=m[0]):f="MultiLineString"),"Point"!==f&&"MultiPoint"!==f||(f=3===m.length?"Point":"MultiPoint"),l.push(Q(c.id,f,m,c.tags))}}}return l.length?l:null}function se(e,t,n,r,i){for(var a=0;a<e.length;a+=3){var o=e[a+i];o>=n&&o<=r&&(t.push(e[a]),t.push(e[a+1]),t.push(e[a+2]))}}function le(e,t,n,r,i,a,o){for(var s,l,u=ue(e),c=0===i?fe:de,h=e.start,f=0;f<e.length-3;f+=3){var d=e[f],p=e[f+1],m=e[f+2],v=e[f+3],y=e[f+4],g=0===i?d:p,_=0===i?v:y,b=!1;o&&(s=Math.sqrt(Math.pow(d-v,2)+Math.pow(p-y,2))),g<n?_>n&&(l=c(u,d,p,v,y,n),o&&(u.start=h+s*l)):g>r?_<r&&(l=c(u,d,p,v,y,r),o&&(u.start=h+s*l)):he(u,d,p,m),_<n&&g>=n&&(l=c(u,d,p,v,y,n),b=!0),_>r&&g<=r&&(l=c(u,d,p,v,y,r),b=!0),!a&&b&&(o&&(u.end=h+s*l),t.push(u),u=ue(e)),o&&(h+=s)}var x=e.length-3;d=e[x],p=e[x+1],m=e[x+2],(g=0===i?d:p)>=n&&g<=r&&he(u,d,p,m),x=u.length-3,a&&x>=3&&(u[x]!==u[0]||u[x+1]!==u[1])&&he(u,u[0],u[1],u[2]),u.length&&t.push(u)}function ue(e){var t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function ce(e,t,n,r,i,a){for(var o=0;o<e.length;o++)le(e[o],t,n,r,i,a,!1)}function he(e,t,n,r){e.push(t),e.push(n),e.push(r)}function fe(e,t,n,r,i,a){var o=(a-t)/(r-t);return e.push(a),e.push(n+(i-n)*o),e.push(1),o}function de(e,t,n,r,i,a){var o=(a-n)/(i-n);return e.push(t+(r-t)*o),e.push(a),e.push(1),o}function pe(e,t){for(var n=[],r=0;r<e.length;r++){var i,a=e[r],o=a.type;if("Point"===o||"MultiPoint"===o||"LineString"===o)i=me(a.geometry,t);else if("MultiLineString"===o||"Polygon"===o){i=[];for(var s=0;s<a.geometry.length;s++)i.push(me(a.geometry[s],t))}else if("MultiPolygon"===o)for(i=[],s=0;s<a.geometry.length;s++){for(var l=[],u=0;u<a.geometry[s].length;u++)l.push(me(a.geometry[s][u],t));i.push(l)}n.push(Q(a.id,o,i,a.tags))}return n}function me(e,t){var n=[];n.size=e.size,void 0!==e.start&&(n.start=e.start,n.end=e.end);for(var r=0;r<e.length;r+=3)n.push(e[r]+t,e[r+1],e[r+2]);return n}function ve(e,t){if(e.transformed)return e;var n,r,i,a=1<<e.z,o=e.x,s=e.y;for(n=0;n<e.features.length;n++){var l=e.features[n],u=l.geometry,c=l.type;if(l.geometry=[],1===c)for(r=0;r<u.length;r+=2)l.geometry.push(ye(u[r],u[r+1],t,a,o,s));else for(r=0;r<u.length;r++){var h=[];for(i=0;i<u[r].length;i+=2)h.push(ye(u[r][i],u[r][i+1],t,a,o,s));l.geometry.push(h)}}return e.transformed=!0,e}function ye(e,t,n,r,i,a){return[Math.round(n*(e*r-i)),Math.round(n*(t*r-a))]}function ge(e,t,n,r,i){for(var a=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<e.length;s++){o.numFeatures++,_e(o,e[s],a,i);var l=e[s].minX,u=e[s].minY,c=e[s].maxX,h=e[s].maxY;l<o.minX&&(o.minX=l),u<o.minY&&(o.minY=u),c>o.maxX&&(o.maxX=c),h>o.maxY&&(o.maxY=h)}return o}function _e(e,t,n,r){var i=t.geometry,a=t.type,o=[];if("Point"===a||"MultiPoint"===a)for(var s=0;s<i.length;s+=3)o.push(i[s]),o.push(i[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===a)be(o,i,e,n,!1,!1);else if("MultiLineString"===a||"Polygon"===a)for(s=0;s<i.length;s++)be(o,i[s],e,n,"Polygon"===a,0===s);else if("MultiPolygon"===a)for(var l=0;l<i.length;l++){var u=i[l];for(s=0;s<u.length;s++)be(o,u[s],e,n,!0,0===s)}if(o.length){var c=t.tags||null;if("LineString"===a&&r.lineMetrics){for(var h in c={},t.tags)c[h]=t.tags[h];c.mapbox_clip_start=i.start/i.size,c.mapbox_clip_end=i.end/i.size}var f={geometry:o,type:"Polygon"===a||"MultiPolygon"===a?3:"LineString"===a||"MultiLineString"===a?2:1,tags:c};null!==t.id&&(f.id=t.id),e.features.push(f)}}function be(e,t,n,r,i,a){var o=r*r;if(r>0&&t.size<(i?o:r))n.numPoints+=t.length/3;else{for(var s=[],l=0;l<t.length;l+=3)(0===r||t[l+2]>o)&&(n.numSimplified++,s.push(t[l]),s.push(t[l+1])),n.numPoints++;i&&function(e,t){for(var n=0,r=0,i=e.length,a=i-2;r<i;a=r,r+=2)n+=(e[r]-e[a])*(e[r+1]+e[a+1]);if(n>0===t)for(r=0,i=e.length;r<i/2;r+=2){var o=e[r],s=e[r+1];e[r]=e[i-2-r],e[r+1]=e[i-1-r],e[i-2-r]=o,e[i-1-r]=s}}(s,a),e.push(s)}}function xe(e,t){var n=(t=this.options=function(e,t){for(var n in t)e[n]=t[n];return e}(Object.create(this.options),t)).debug;if(n&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(e,t){var n=[];if("FeatureCollection"===e.type)for(var r=0;r<e.features.length;r++)ee(n,e.features[r],t,r);else ee(n,"Feature"===e.type?e:{geometry:e},t);return n}(e,t);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(e,t){var n=t.buffer/t.extent,r=e,i=oe(e,1,-1-n,n,0,-1,2,t),a=oe(e,1,1-n,2+n,0,-1,2,t);return(i||a)&&(r=oe(e,1,-n,1+n,0,-1,2,t)||[],i&&(r=pe(i,1).concat(r)),a&&(r=r.concat(pe(a,-1)))),r}(r,t)).length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function we(e,t,n){return 32*((1<<e)*n+t)+e}function Ee(e,t){var n=e.tileID.canonical;if(!this._geoJSONIndex)return t(null,null);var r=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!r)return t(null,null);var i=new g(r.features),a=E(i);0===a.byteOffset&&a.byteLength===a.buffer.byteLength||(a=new Uint8Array(a)),t(null,{vectorTile:i,rawData:a.buffer})}xe.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},xe.prototype.splitTile=function(e,t,n,r,i,a,o){for(var s=[e,t,n,r],l=this.options,u=l.debug;s.length;){r=s.pop(),n=s.pop(),t=s.pop(),e=s.pop();var c=1<<t,h=we(t,n,r),f=this.tiles[h];if(!f&&(u>1&&console.time("creation"),f=this.tiles[h]=ge(e,t,n,r,l),this.tileCoords.push({z:t,x:n,y:r}),u)){u>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,n,r,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));var d="z"+t;this.stats[d]=(this.stats[d]||0)+1,this.total++}if(f.source=e,i){if(t===l.maxZoom||t===i)continue;var p=1<<i-t;if(n!==Math.floor(a/p)||r!==Math.floor(o/p))continue}else if(t===l.indexMaxZoom||f.numPoints<=l.indexMaxPoints)continue;if(f.source=null,0!==e.length){u>1&&console.time("clipping");var m,v,y,g,_,b,x=.5*l.buffer/l.extent,w=.5-x,E=.5+x,S=1+x;m=v=y=g=null,_=oe(e,c,n-x,n+E,0,f.minX,f.maxX,l),b=oe(e,c,n+w,n+S,0,f.minX,f.maxX,l),e=null,_&&(m=oe(_,c,r-x,r+E,1,f.minY,f.maxY,l),v=oe(_,c,r+w,r+S,1,f.minY,f.maxY,l),_=null),b&&(y=oe(b,c,r-x,r+E,1,f.minY,f.maxY,l),g=oe(b,c,r+w,r+S,1,f.minY,f.maxY,l),b=null),u>1&&console.timeEnd("clipping"),s.push(m||[],t+1,2*n,2*r),s.push(v||[],t+1,2*n,2*r+1),s.push(y||[],t+1,2*n+1,2*r),s.push(g||[],t+1,2*n+1,2*r+1)}}},xe.prototype.getTile=function(e,t,n){var r=this.options,i=r.extent,a=r.debug;if(e<0||e>24)return null;var o=1<<e,s=we(e,t=(t%o+o)%o,n);if(this.tiles[s])return ve(this.tiles[s],i);a>1&&console.log("drilling down to z%d-%d-%d",e,t,n);for(var l,u=e,c=t,h=n;!l&&u>0;)u--,c=Math.floor(c/2),h=Math.floor(h/2),l=this.tiles[we(u,c,h)];return l&&l.source?(a>1&&console.log("found parent tile z%d-%d-%d",u,c,h),a>1&&console.time("drilling down"),this.splitTile(l.source,u,c,h,e,t,n),a>1&&console.timeEnd("drilling down"),this.tiles[s]?ve(this.tiles[s],i):null):null};var Se=function(t){p(r,t);var n=m(r);function r(e,t,i,a){var o;return v(this,r),o=n.call(this,e,t,i,Ee),a&&(o.loadGeoJSON=a),o}return y(r,[{key:"loadData",value:function(e,t){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=t,this._pendingLoadDataParams=e,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())}},{key:"_loadData",value:function(){var t=this;if(this._pendingCallback&&this._pendingLoadDataParams){var n=this._pendingCallback,r=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var i=!!(r&&r.request&&r.request.collectResourceTiming)&&new e.RequestPerformance(r.request);this.loadGeoJSON(r,(function(a,o){if(a||!o)return n(a);if("object"!=typeof o)return n(new Error("Input data given to '".concat(r.source,"' is not a valid GeoJSON object.")));!function e(t,n){var r,i=t&&t.type;if("FeatureCollection"===i)for(r=0;r<t.features.length;r++)e(t.features[r],n);else if("GeometryCollection"===i)for(r=0;r<t.geometries.length;r++)e(t.geometries[r],n);else if("Feature"===i)e(t.geometry,n);else if("Polygon"===i)l(t.coordinates,n);else if("MultiPolygon"===i)for(r=0;r<t.coordinates.length;r++)l(t.coordinates[r],n);return t}(o,!0);try{if(r.filter){var s=e.createExpression(r.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===s.result)throw new Error(s.value.map((function(e){return"".concat(e.key,": ").concat(e.message)})).join(", "));var u=o.features.filter((function(e){return s.value.evaluate({zoom:0},e)}));o={type:"FeatureCollection",features:u}}t._geoJSONIndex=r.cluster?new U(function(t){var n=t.superclusterOptions,r=t.clusterProperties;if(!r||!n)return n;for(var i={},a={},o={accumulated:null,zoom:0},s={properties:null},l=Object.keys(r),u=0,c=l;u<c.length;u++){var d=c[u],p=h(r[d],2),m=p[0],v=p[1],y=e.createExpression(v),g=e.createExpression("string"==typeof m?[m,["accumulated"],["get",d]]:m);i[d]=y.value,a[d]=g.value}return n.map=function(e){s.properties=e;var t,n={},r=f(l);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a]=i[a].evaluate(o,s)}}catch(u){r.e(u)}finally{r.f()}return n},n.reduce=function(e,t){s.properties=t;var n,r=f(l);try{for(r.s();!(n=r.n()).done;){var i=n.value;o.accumulated=e[i],e[i]=a[i].evaluate(o,s)}}catch(u){r.e(u)}finally{r.f()}},n}(r)).load(o.features):function(e,t){return new xe(e,t)}(o,r.geojsonVtOptions)}catch(a){return n(a)}t.loaded={};var c={};if(i){var d=i.finish();d&&(c.resourceTiming={},c.resourceTiming[r.source]=JSON.parse(JSON.stringify(d)))}n(null,c)}))}}},{key:"coalesce",value:function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())}},{key:"reloadTile",value:function(e,t){var n=this.loaded;return n&&n[e.uid]?o(s(r.prototype),"reloadTile",this).call(this,e,t):this.loadTile(e,t)}},{key:"loadGeoJSON",value:function(t,n){if(t.request)e.getJSON(t.request,n);else{if("string"!=typeof t.data)return n(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")));try{return n(null,JSON.parse(t.data))}catch(e){return n(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")))}}}},{key:"removeSource",value:function(e,t){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),t()}},{key:"getClusterExpansionZoom",value:function(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}},{key:"getClusterChildren",value:function(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}},{key:"getClusterLeaves",value:function(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}]),r}(e.VectorTileWorkerSource),Te=function(){function t(n){var r=this;v(this,t),this.self=n,this.actor=new e.Actor(n,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:e.VectorTileWorkerSource,geojson:Se},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(e,t){if(r.workerSourceTypes[e])throw new Error('Worker source with name "'.concat(e,'" already registered.'));r.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=function(t){if(e.plugin.isParsed())throw new Error("RTL text plugin already registered.");e.plugin.applyArabicShaping=t.applyArabicShaping,e.plugin.processBidirectionalText=t.processBidirectionalText,e.plugin.processStyledBidirectionalText=t.processStyledBidirectionalText}}return y(t,[{key:"checkIfReady",value:function(e,t,n){n()}},{key:"setReferrer",value:function(e,t){this.referrer=t}},{key:"setImages",value:function(e,t,n){for(var r in this.availableImages[e]=t,this.workerSources[e]){var i=this.workerSources[e][r];for(var a in i)i[a].availableImages=t}n()}},{key:"enableTerrain",value:function(e,t,n){this.terrain=t,n()}},{key:"setLayers",value:function(e,t,n){this.getLayerIndex(e).replace(t),n()}},{key:"updateLayers",value:function(e,t,n){this.getLayerIndex(e).update(t.layers,t.removedIds),n()}},{key:"loadTile",value:function(t,n,r){var i=this.enableTerrain?e.extend({enableTerrain:this.terrain},n):n;this.getWorkerSource(t,n.type,n.source).loadTile(i,r)}},{key:"loadDEMTile",value:function(t,n,r){var i=this.enableTerrain?e.extend({buildQuadTree:this.terrain},n):n;this.getDEMWorkerSource(t,n.source).loadTile(i,r)}},{key:"reloadTile",value:function(t,n,r){var i=this.enableTerrain?e.extend({enableTerrain:this.terrain},n):n;this.getWorkerSource(t,n.type,n.source).reloadTile(i,r)}},{key:"abortTile",value:function(e,t,n){this.getWorkerSource(e,t.type,t.source).abortTile(t,n)}},{key:"removeTile",value:function(e,t,n){this.getWorkerSource(e,t.type,t.source).removeTile(t,n)}},{key:"removeSource",value:function(e,t,n){if(this.workerSources[e]&&this.workerSources[e][t.type]&&this.workerSources[e][t.type][t.source]){var r=this.workerSources[e][t.type][t.source];delete this.workerSources[e][t.type][t.source],void 0!==r.removeSource?r.removeSource(t,n):n()}}},{key:"loadWorkerSource",value:function(e,t,n){try{this.self.importScripts(t.url),n()}catch(e){n(e.toString())}}},{key:"syncRTLPluginState",value:function(t,n,r){try{e.plugin.setState(n);var i=e.plugin.getPluginURL();if(e.plugin.isLoaded()&&!e.plugin.isParsed()&&null!=i){this.self.importScripts(i);var a=e.plugin.isParsed();r(a?void 0:new Error("RTL Text Plugin failed to import scripts from ".concat(i)),a)}}catch(e){r(e.toString())}}},{key:"getAvailableImages",value:function(e){var t=this.availableImages[e];return t||(t=[]),t}},{key:"getLayerIndex",value:function(e){var t=this.layerIndexes[e];return t||(t=this.layerIndexes[e]=new r),t}},{key:"getWorkerSource",value:function(e,t,n){var r=this;return this.workerSources[e]||(this.workerSources[e]={}),this.workerSources[e][t]||(this.workerSources[e][t]={}),this.workerSources[e][t][n]||(this.workerSources[e][t][n]=new this.workerSourceTypes[t]({send:function(t,n,i,a,o,s){r.actor.send(t,n,i,e,a,s)},scheduler:this.actor.scheduler},this.getLayerIndex(e),this.getAvailableImages(e))),this.workerSources[e][t][n]}},{key:"getDEMWorkerSource",value:function(e,t){return this.demWorkerSources[e]||(this.demWorkerSources[e]={}),this.demWorkerSources[e][t]||(this.demWorkerSources[e][t]=new a),this.demWorkerSources[e][t]}},{key:"enforceCacheSizeLimit",value:function(t,n){e.enforceCacheSizeLimit(n)}},{key:"getWorkerPerformanceMetrics",value:function(e,t,n){n(void 0,void 0)}}]),t}();return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new Te(self)),Te})),g(["./shared"],(function(e){var t=n;function n(e){return!function(e){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,n=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(n);try{t=new Worker(r),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(r),e}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var n=t.getImageData(0,0,1,1);return n&&n.width===e.width}()?(void 0===a[t=e&&e.failIfMajorPerformanceCaveat]&&(a[t]=function(e){var t,r=function(e){var t=document.createElement("canvas"),r=Object.create(n.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=e,t.getContext("webgl",r)||t.getContext("experimental-webgl",r)}(e);if(!r)return!1;try{t=r.createShader(r.VERTEX_SHADER)}catch(e){return!1}return!(!t||r.isContextLost())&&(r.shaderSource(t,"void main() {}"),r.compileShader(t),!0===r.getShaderParameter(t,r.COMPILE_STATUS))}(t)),a[t]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var t}(e)}var a={};n.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};var u,d={create:function(t,n,r){var i=e.window.document.createElement(t);return void 0!==n&&(i.className=n),r&&r.appendChild(i),i},createNS:function(t,n){return e.window.document.createElementNS(t,n)}},g=e.window.document&&e.window.document.documentElement.style,_=g&&void 0!==g.userSelect?"userSelect":"WebkitUserSelect";d.disableDrag=function(){g&&_&&(u=g[_],g[_]="none")},d.enableDrag=function(){g&&_&&(g[_]=u)},d.setTransform=function(e,t){e.style.transform=t};var b=!1;try{var x=Object.defineProperty({},"passive",{get:function(){b=!0}});e.window.addEventListener("test",x,x),e.window.removeEventListener("test",x,x)}catch(e){b=!1}d.addEventListener=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.addEventListener(t,n,"passive"in r&&b?r:r.capture)},d.removeEventListener=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.removeEventListener(t,n,"passive"in r&&b?r:r.capture)};var w=function t(n){n.preventDefault(),n.stopPropagation(),e.window.removeEventListener("click",t,!0)};function E(e){var t=e.userImage;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}d.suppressClick=function(){e.window.addEventListener("click",w,!0),e.window.setTimeout((function(){e.window.removeEventListener("click",w,!0)}),0)},d.mousePos=function(t,n){var r=t.getBoundingClientRect();return new e.Point(n.clientX-r.left-t.clientLeft,n.clientY-r.top-t.clientTop)},d.touchPos=function(t,n){for(var r=t.getBoundingClientRect(),i=[],a=0;a<n.length;a++)i.push(new e.Point(n[a].clientX-r.left-t.clientLeft,n[a].clientY-r.top-t.clientTop));return i},d.mouseButton=function(t){return void 0!==e.window.InstallTrigger&&2===t.button&&t.ctrlKey&&e.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button},d.remove=function(e){e.parentNode&&e.parentNode.removeChild(e)};var S=function(t){p(r,t);var n=m(r);function r(){var t;return v(this,r),(t=n.call(this)).images={},t.updatedImages={},t.callbackDispatchedThisFrame={},t.loaded=!1,t.requestors=[],t.patterns={},t.atlasImage=new e.RGBAImage({width:1,height:1}),t.dirty=!0,t}return y(r,[{key:"isLoaded",value:function(){return this.loaded}},{key:"setLoaded",value:function(e){if(this.loaded!==e&&(this.loaded=e,e)){var t,n=f(this.requestors);try{for(n.s();!(t=n.n()).done;){var r=t.value,i=r.ids,a=r.callback;this._notify(i,a)}}catch(o){n.e(o)}finally{n.f()}this.requestors=[]}}},{key:"getImage",value:function(e){return this.images[e]}},{key:"addImage",value:function(e,t){this._validate(e,t)&&(this.images[e]=t)}},{key:"_validate",value:function(t,n){var r=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new e.ErrorEvent(new Error('Image "'.concat(t,'" has invalid "stretchX" value')))),r=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new e.ErrorEvent(new Error('Image "'.concat(t,'" has invalid "stretchY" value')))),r=!1),this._validateContent(n.content,n)||(this.fire(new e.ErrorEvent(new Error('Image "'.concat(t,'" has invalid "content" value')))),r=!1),r}},{key:"_validateStretch",value:function(e,t){if(!e)return!0;var n,r=0,i=f(e);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a[0]<r||a[1]<a[0]||t<a[1])return!1;r=a[1]}}catch(o){i.e(o)}finally{i.f()}return!0}},{key:"_validateContent",value:function(e,t){return!(e&&(4!==e.length||e[0]<0||t.data.width<e[0]||e[1]<0||t.data.height<e[1]||e[2]<0||t.data.width<e[2]||e[3]<0||t.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}},{key:"updateImage",value:function(e,t){t.version=this.images[e].version+1,this.images[e]=t,this.updatedImages[e]=!0}},{key:"removeImage",value:function(e){var t=this.images[e];delete this.images[e],delete this.patterns[e],t.userImage&&t.userImage.onRemove&&t.userImage.onRemove()}},{key:"listImages",value:function(){return Object.keys(this.images)}},{key:"getImages",value:function(e,t){var n=!0;if(!this.isLoaded()){var r,i=f(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.images[a]||(n=!1)}}catch(o){i.e(o)}finally{i.f()}}this.isLoaded()||n?this._notify(e,t):this.requestors.push({ids:e,callback:t})}},{key:"_notify",value:function(t,n){var r,i={},a=f(t);try{for(a.s();!(r=a.n()).done;){var o=r.value;this.images[o]||this.fire(new e.Event("styleimagemissing",{id:o}));var s=this.images[o];s?i[o]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:e.warnOnce('Image "'.concat(o,'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.'))}}catch(l){a.e(l)}finally{a.f()}n(null,i)}},{key:"getPixelSize",value:function(){var e=this.atlasImage;return{width:e.width,height:e.height}}},{key:"getPattern",value:function(t){var n=this.patterns[t],r=this.getImage(t);if(!r)return null;if(n&&n.position.version===r.version)return n.position;if(n)n.position.version=r.version;else{var i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},a=new e.ImagePosition(i,r);this.patterns[t]={bin:i,position:a}}return this._updatePatternAtlas(),this.patterns[t].position}},{key:"bind",value:function(t){var n=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new e.Texture(t,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}},{key:"_updatePatternAtlas",value:function(){var t=[];for(var n in this.patterns)t.push(this.patterns[n].bin);var r=e.potpack(t),i=r.w,a=r.h,o=this.atlasImage;for(var s in o.resize({width:i||1,height:a||1}),this.patterns){var l=this.patterns[s].bin,u=l.x+1,c=l.y+1,h=this.images[s].data,f=h.width,d=h.height;e.RGBAImage.copy(h,o,{x:0,y:0},{x:u,y:c},{width:f,height:d}),e.RGBAImage.copy(h,o,{x:0,y:d-1},{x:u,y:c-1},{width:f,height:1}),e.RGBAImage.copy(h,o,{x:0,y:0},{x:u,y:c+d},{width:f,height:1}),e.RGBAImage.copy(h,o,{x:f-1,y:0},{x:u-1,y:c},{width:1,height:d}),e.RGBAImage.copy(h,o,{x:0,y:0},{x:u+f,y:c},{width:1,height:d})}this.dirty=!0}},{key:"beginFrame",value:function(){this.callbackDispatchedThisFrame={}}},{key:"dispatchRenderCallbacks",value:function(e){var t,n=f(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(!this.callbackDispatchedThisFrame[r]){this.callbackDispatchedThisFrame[r]=!0;var i=this.images[r];E(i)&&this.updateImage(r,i)}}}catch(a){n.e(a)}finally{n.f()}}}]),r}(e.Evented),T=C,k=C,M=1e20;function C(e,t,n,r,i,a){this.fontSize=e||24,this.buffer=void 0===t?3:t,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=a||"normal",this.radius=n||8;var o=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(o*o),this.gridInner=new Float64Array(o*o),this.f=new Float64Array(o),this.d=new Float64Array(o),this.z=new Float64Array(o+1),this.v=new Int16Array(o),this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function A(e,t,n,r,i,a,o){for(var s=0;s<t;s++){for(var l=0;l<n;l++)r[l]=e[l*t+s];for(I(r,i,a,o,n),l=0;l<n;l++)e[l*t+s]=i[l]}for(l=0;l<n;l++){for(s=0;s<t;s++)r[s]=e[l*t+s];for(I(r,i,a,o,t),s=0;s<t;s++)e[l*t+s]=Math.sqrt(i[s])}}function I(e,t,n,r,i){n[0]=0,r[0]=-M,r[1]=+M;for(var a=1,o=0;a<i;a++){for(var s=(e[a]+a*a-(e[n[o]]+n[o]*n[o]))/(2*a-2*n[o]);s<=r[o];)o--,s=(e[a]+a*a-(e[n[o]]+n[o]*n[o]))/(2*a-2*n[o]);n[++o]=a,r[o]=s,r[o+1]=+M}for(a=0,o=0;a<i;a++){for(;r[o+1]<a;)o++;t[a]=(a-n[o])*(a-n[o])+e[n[o]]}}C.prototype.draw=function(e){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(e,this.buffer,this.middle);for(var t=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var i=t.data[4*r+3]/255;this.gridOuter[r]=1===i?0:0===i?M:Math.pow(Math.max(0,.5-i),2),this.gridInner[r]=1===i?M:0===i?0:Math.pow(Math.max(0,i-.5),2)}for(A(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),A(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++)n[r]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[r]-this.gridInner[r])/this.radius+this.cutoff))));return n},T.default=k;var P=function(){function t(e,n){v(this,t),this.requestManager=e,this.localIdeographFontFamily=n,this.entries={}}return y(t,[{key:"setURL",value:function(e){this.url=e}},{key:"getGlyphs",value:function(n,r){var i=this,a=[];for(var o in n){var s,l=f(n[o]);try{for(l.s();!(s=l.n()).done;){var u=s.value;a.push({stack:o,id:u})}}catch(c){l.e(c)}finally{l.f()}}e.asyncAll(a,(function(e,n){var r=e.stack,a=e.id,o=i.entries[r];o||(o=i.entries[r]={glyphs:{},requests:{},ranges:{}});var s=o.glyphs[a];if(void 0===s){if(s=i._tinySDF(o,r,a))return o.glyphs[a]=s,void n(null,{stack:r,id:a,glyph:s});var l=Math.floor(a/256);if(256*l>65535)n(new Error("glyphs > 65535 not supported"));else if(o.ranges[l])n(null,{stack:r,id:a,glyph:s});else{var u=o.requests[l];u||(u=o.requests[l]=[],t.loadGlyphRange(r,l,i.url,i.requestManager,(function(e,t){if(t){for(var n in t)i._doesCharSupportLocalGlyph(+n)||(o.glyphs[+n]=t[+n]);o.ranges[l]=!0}var r,a=f(u);try{for(a.s();!(r=a.n()).done;)(0,r.value)(e,t)}catch(c){a.e(c)}finally{a.f()}delete o.requests[l]}))),u.push((function(e,t){e?n(e):t&&n(null,{stack:r,id:a,glyph:t[a]||null})}))}}else n(null,{stack:r,id:a,glyph:s})}),(function(e,t){if(e)r(e);else if(t){var n,i={},a=f(t);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=o.stack,l=o.id,u=o.glyph;(i[s]||(i[s]={}))[l]=u&&{id:u.id,bitmap:u.bitmap.clone(),metrics:u.metrics}}}catch(c){a.e(c)}finally{a.f()}r(null,i)}}))}},{key:"_doesCharSupportLocalGlyph",value:function(t){return!!this.localIdeographFontFamily&&(e.isChar["CJK Unified Ideographs"](t)||e.isChar["Hangul Syllables"](t)||e.isChar.Hiragana(t)||e.isChar.Katakana(t))}},{key:"_tinySDF",value:function(n,r,i){var a=this.localIdeographFontFamily;if(a&&this._doesCharSupportLocalGlyph(i)){var o=n.tinySDF;if(!o){var s="400";/bold/i.test(r)?s="900":/medium/i.test(r)?s="500":/light/i.test(r)&&(s="200"),o=n.tinySDF=new t.TinySDF(24,3,8,.25,a,s)}return{id:i,bitmap:new e.AlphaImage({width:30,height:30},o.draw(String.fromCharCode(i))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}}}]),t}();P.loadGlyphRange=function(t,n,r,i,a){var o=256*n,s=o+255,l=i.transformRequest(i.normalizeGlyphsURL(r).replace("{fontstack}",t).replace("{range}","".concat(o,"-").concat(s)),e.ResourceType.Glyphs);e.getArrayBuffer(l,(function(t,n){if(t)a(t);else if(n){var r,i={},o=f(e.parseGlyphPBF(n));try{for(o.s();!(r=o.n()).done;){var s=r.value;i[s.id]=s}}catch(l){o.e(l)}finally{o.f()}a(null,i)}}))},P.TinySDF=T;var R=new e.Properties({anchor:new e.DataConstantProperty(e.styleSpec.light.anchor),position:new(function(){function t(){v(this,t),this.specification=e.styleSpec.light.position}return y(t,[{key:"possiblyEvaluate",value:function(t,n){return function(t){var n=h(t,3),r=n[0],i=n[1],a=n[2],o=e.degToRad(i+90),s=e.degToRad(a);return{x:r*Math.cos(o)*Math.sin(s),y:r*Math.sin(o)*Math.sin(s),z:r*Math.cos(s),azimuthal:i,polar:a}}(t.expression.evaluate(n))}},{key:"interpolate",value:function(t,n,r){return{x:e.number(t.x,n.x,r),y:e.number(t.y,n.y,r),z:e.number(t.z,n.z,r),azimuthal:e.number(t.azimuthal,n.azimuthal,r),polar:e.number(t.polar,n.polar,r)}}}]),t}()),color:new e.DataConstantProperty(e.styleSpec.light.color),intensity:new e.DataConstantProperty(e.styleSpec.light.intensity)}),L=function(t){p(r,t);var n=m(r);function r(t){var i;return v(this,r),(i=n.call(this))._transitionable=new e.Transitionable(R),i.setLight(t),i._transitioning=i._transitionable.untransitioned(),i}return y(r,[{key:"getLight",value:function(){return this._transitionable.serialize()}},{key:"setLight",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this._validate(e.validateLight,t,n))for(var r in t){var i=t[r];e.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-"-transition".length),i):this._transitionable.setValue(r,i)}}},{key:"updateTransitions",value:function(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}},{key:"hasTransition",value:function(){return this._transitioning.hasTransition()}},{key:"recalculate",value:function(e){this.properties=this._transitioning.possiblyEvaluate(e)}},{key:"_validate",value:function(t,n,r){return(!r||!1!==r.validate)&&e.emitValidationErrors(this,t.call(e.validateStyle,e.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:e.styleSpec})))}}]),r}(e.Evented),O=new e.Properties({source:new e.DataConstantProperty(e.styleSpec.terrain.source),exaggeration:new e.DataConstantProperty(e.styleSpec.terrain.exaggeration)}),D=function(t){p(r,t);var n=m(r);function r(t){var i;return v(this,r),(i=n.call(this))._transitionable=new e.Transitionable(O),i.set(t),i._transitioning=i._transitionable.untransitioned(),i}return y(r,[{key:"get",value:function(){return this._transitionable.serialize()}},{key:"set",value:function(t){for(var n in t){var r=t[n];e.endsWith(n,"-transition")?this._transitionable.setTransition(n.slice(0,-"-transition".length),r):this._transitionable.setValue(n,r)}}},{key:"updateTransitions",value:function(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}},{key:"hasTransition",value:function(){return this._transitioning.hasTransition()}},{key:"recalculate",value:function(e){this.properties=this._transitioning.possiblyEvaluate(e)}}]),r}(e.Evented),N=function(){function t(e,n){v(this,t),this.width=e,this.height=n,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}return y(t,[{key:"getDash",value:function(e,t){var n=e.join(",")+String(t);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(e,t)),this.dashEntry[n]}},{key:"getDashRanges",value:function(e,t,n){var r=[],i=e.length%2==1?-e[e.length-1]*n:0,a=e[0]*n,o=!0;r.push({left:i,right:a,isDash:o,zeroLength:0===e[0]});for(var s=e[0],l=1;l<e.length;l++){o=!o;var u=e[l];i=s*n,a=(s+=u)*n,r.push({left:i,right:a,isDash:o,zeroLength:0===u})}return r}},{key:"addRoundDash",value:function(e,t,n){for(var r=t/2,i=-n;i<=n;i++)for(var a=this.width*(this.nextRow+n+i),o=0,s=e[o],l=0;l<this.width;l++){l/s.right>1&&(s=e[++o]);var u=Math.abs(l-s.left),c=Math.abs(l-s.right),h=Math.min(u,c),f=void 0,d=i/n*(r+1);if(s.isDash){var p=r-Math.abs(d);f=Math.sqrt(h*h+p*p)}else f=r-Math.sqrt(h*h+d*d);this.data[a+l]=Math.max(0,Math.min(255,f+128))}}},{key:"addRegularDash",value:function(e){for(var t=e.length-1;t>=0;--t){var n=e[t],r=e[t+1];n.zeroLength?e.splice(t,1):r&&r.isDash===n.isDash&&(r.left=n.left,e.splice(t,1))}var i=e[0],a=e[e.length-1];i.isDash===a.isDash&&(i.left=a.left-this.width,a.right=i.right+this.width);for(var o=this.width*this.nextRow,s=0,l=e[s],u=0;u<this.width;u++){u/l.right>1&&(l=e[++s]);var c=Math.abs(u-l.left),h=Math.abs(u-l.right),f=Math.min(c,h);this.data[o+u]=Math.max(0,Math.min(255,(l.isDash?f:-f)+128))}}},{key:"addDash",value:function(t,n){var r=n?7:0,i=2*r+1;if(this.nextRow+i>this.height)return e.warnOnce("LineAtlas out of space"),null;0===t.length&&t.push(1);for(var a=0,o=0;o<t.length;o++)t[o]<0&&(e.warnOnce("Negative value is found in line dasharray, replacing values with 0"),t[o]=0),a+=t[o];if(0!==a){var s=this.width/a,l=this.getDashRanges(t,this.width,s);n?this.addRoundDash(l,s,r):this.addRegularDash(l)}var u={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:a};return this.nextRow+=i,this.dirty=!0,u}},{key:"bind",value:function(e){var t=e.gl;this.texture?(t.bindTexture(t.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.ALPHA,t.UNSIGNED_BYTE,this.data))):(this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.REPEAT),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texImage2D(t.TEXTURE_2D,0,t.ALPHA,this.width,this.height,0,t.ALPHA,t.UNSIGNED_BYTE,this.data))}}]),t}(),z=function(){function t(n,r){var i=this;v(this,t),this.workerPool=n,this.actors=[],this.currentActor=0,this.id=e.uniqueId();for(var a=this.workerPool.acquire(this.id),o=0;o<a.length;o++){var s=new t.Actor(a[o],r,this.id);s.name="Worker ".concat(o),this.actors.push(s)}this.ready=!1,this.broadcast("checkIfReady",null,(function(){i.ready=!0}))}return y(t,[{key:"broadcast",value:function(t,n,r){e.asyncAll(this.actors,(function(e,r){e.send(t,n,r)}),r=r||function(){})}},{key:"getActor",value:function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}},{key:"remove",value:function(){this.actors.forEach((function(e){e.remove()})),this.actors=[],this.workerPool.release(this.id)}}]),t}();function F(t,n,r){return n*(e.EXTENT/(t.tileSize*Math.pow(2,r-t.tileID.overscaledZ)))}z.Actor=e.Actor;var B=function(){function t(e,n,r,i){v(this,t),this.screenBounds=e,this.cameraPoint=n,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=r,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map((function(e){return i.pointCoordinate3D(e)})),this.cameraGeometry=this.bufferedCameraGeometry(0)}return y(t,[{key:"bufferedScreenGeometry",value:function(t){return e.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}},{key:"bufferedCameraGeometry",value:function(t){var n=[this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0].add(new e.Point(1,0)):this.screenBounds[1],this.cameraPoint];return e.bufferConvexPolygon(n,t)}},{key:"containsTile",value:function(t,n,r){var i,a=t.queryPadding+1,o=r?this._bufferedCameraMercator(a,n).map((function(e){return t.tileID.getTilePoint(e)})):this._bufferedScreenMercator(a,n).map((function(e){return t.tileID.getTilePoint(e)})),s=this.screenGeometryMercator.map((function(e){return t.tileID.getTileVec3(e)})),l=s.map((function(t){return new e.Point(t[0],t[1])})),u=n.getFreeCameraOptions().position||new e.MercatorCoordinate(0,0,0),c=t.tileID.getTileVec3(u),h=s.map((function(t){var n=e.sub(t,t,c);return e.normalize(n,n),new e.Ray(c,n)})),f=F(t,1,n.zoom);if(e.polygonIntersectsBox(o,0,0,e.EXTENT,e.EXTENT))return{queryGeometry:this,tilespaceGeometry:l,tilespaceRays:h,bufferedTilespaceGeometry:o,bufferedTilespaceBounds:(i=e.getBounds(o),i.min.x=e.clamp(i.min.x,0,e.EXTENT),i.min.y=e.clamp(i.min.y,0,e.EXTENT),i.max.x=e.clamp(i.max.x,0,e.EXTENT),i.max.y=e.clamp(i.max.y,0,e.EXTENT),i),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:f}}},{key:"_bufferedScreenMercator",value:function(e,t){var n=U(e);if(this._screenRaycastCache[n])return this._screenRaycastCache[n];var r=this.bufferedScreenGeometry(e).map((function(e){return t.pointCoordinate3D(e)}));return this._screenRaycastCache[n]=r,r}},{key:"_bufferedCameraMercator",value:function(e,t){var n=U(e);if(this._cameraRaycastCache[n])return this._cameraRaycastCache[n];var r=this.bufferedCameraGeometry(e).map((function(e){return t.pointCoordinate3D(e)}));return this._cameraRaycastCache[n]=r,r}}],[{key:"createFromScreenPoints",value:function(n,r){var i,a;if(n instanceof e.Point||"number"==typeof n[0]){var o=e.Point.convert(n);i=[e.Point.convert(n)],a=r.isPointAboveHorizon(o)}else{var s=e.Point.convert(n[0]),l=e.Point.convert(n[1]);i=[s,l],a=e.polygonizeBounds(s,l).every((function(e){return r.isPointAboveHorizon(e)}))}return new t(i,r.getCameraPoint(),a,r)}}]),t}();function U(e){return 100*e|0}function j(t,n,r){var i=function(i,a){if(i)return r(i);if(a){var o=e.pick(e.extend(a,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);a.vector_layers&&(o.vectorLayers=a.vector_layers,o.vectorLayerIds=o.vectorLayers.map((function(e){return e.id}))),o.tiles=n.canonicalizeTileset(o,t.url),r(null,o)}};return t.url?e.getJSON(n.transformRequest(n.normalizeSourceURL(t.url),e.ResourceType.Source),i):e.browser.frame((function(){return i(null,t)}))}var V=function(){function t(n,r,i){v(this,t),this.bounds=e.LngLatBounds.convert(this.validateBounds(n)),this.minzoom=r||0,this.maxzoom=i||24}return y(t,[{key:"validateBounds",value:function(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}},{key:"contains",value:function(t){var n=Math.pow(2,t.z),r=Math.floor(e.mercatorXfromLng(this.bounds.getWest())*n),i=Math.floor(e.mercatorYfromLat(this.bounds.getNorth())*n),a=Math.ceil(e.mercatorXfromLng(this.bounds.getEast())*n),o=Math.ceil(e.mercatorYfromLat(this.bounds.getSouth())*n);return t.x>=r&&t.x<a&&t.y>=i&&t.y<o}}]),t}(),H=function(t){p(r,t);var n=m(r);function r(t,a,o,s){var l;return v(this,r),(l=n.call(this)).id=t,l.dispatcher=o,l.setEventedParent(s),l.type="raster",l.minzoom=0,l.maxzoom=22,l.roundZoom=!0,l.scheme="xyz",l.tileSize=512,l._loaded=!1,l._options=e.extend({type:"raster"},a),e.extend(i(l),e.pick(a,["url","scheme","tileSize"])),l}return y(r,[{key:"load",value:function(){var t=this;this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=j(this._options,this.map._requestManager,(function(n,r){t._tileJSONRequest=null,t._loaded=!0,n?t.fire(new e.ErrorEvent(n)):r&&(e.extend(t,r),r.bounds&&(t.tileBounds=new V(r.bounds,t.minzoom,t.maxzoom)),e.postTurnstileEvent(r.tiles),t.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),t.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})))}))}},{key:"loaded",value:function(){return this._loaded}},{key:"onAdd",value:function(e){this.map=e,this.load()}},{key:"onRemove",value:function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},{key:"serialize",value:function(){return e.extend({},this._options)}},{key:"hasTile",value:function(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}},{key:"loadTile",value:function(t,n){var r=this,i=e.browser.devicePixelRatio>=2,a=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),i,this.tileSize);t.request=e.getImage(this.map._requestManager.transformRequest(a,e.ResourceType.Tile),(function(i,a){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(i)t.state="errored",n(i);else if(a){r.map._refreshExpiredTiles&&t.setExpiryData(a),delete a.cacheControl,delete a.expires;var o=r.map.painter.context,s=o.gl;t.texture=r.map.painter.getTileTexture(a.width),t.texture?t.texture.update(a,{useMipmap:!0}):(t.texture=new e.Texture(o,a,s.RGBA,{useMipmap:!0}),t.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),o.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,o.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,o.extTextureFilterAnisotropicMax)),t.state="loaded",e.cacheEntryPossiblyAdded(r.dispatcher),n(null)}}))}},{key:"abortTile",value:function(e,t){e.request&&(e.request.cancel(),delete e.request),t()}},{key:"unloadTile",value:function(e,t){e.texture&&this.map.painter.saveTileTexture(e.texture),t()}},{key:"hasTransition",value:function(){return!1}}]),r}(e.Evented),G=e.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),W=function(t){p(r,t);var n=m(r);function r(e,t,i,a){var o;return v(this,r),(o=n.call(this)).id=e,o.dispatcher=i,o.coordinates=t.coordinates,o.type="image",o.minzoom=0,o.maxzoom=22,o.tileSize=512,o.tiles={},o._loaded=!1,o.setEventedParent(a),o.options=t,o}return y(r,[{key:"load",value:function(t,n){var r=this;this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this.url=this.options.url,e.getImage(this.map._requestManager.transformRequest(this.url,e.ResourceType.Image),(function(i,a){r._loaded=!0,i?r.fire(new e.ErrorEvent(i)):a&&(r.image=a,t&&(r.coordinates=t),n&&n(),r._finishLoading())}))}},{key:"loaded",value:function(){return this._loaded}},{key:"updateImage",value:function(e){var t=this;return this.image&&e.url?(this.options.url=e.url,this.load(e.coordinates,(function(){t.texture=null})),this):this}},{key:"_finishLoading",value:function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})))}},{key:"onAdd",value:function(e){this.map=e,this.load()}},{key:"setCoordinates",value:function(t){var n=this;this.coordinates=t;var r=t.map(e.MercatorCoordinate.fromLngLat);this.tileID=function(t){var n,r=1/0,i=1/0,a=-1/0,o=-1/0,s=f(t);try{for(s.s();!(n=s.n()).done;){var l=n.value;r=Math.min(r,l.x),i=Math.min(i,l.y),a=Math.max(a,l.x),o=Math.max(o,l.y)}}catch(d){s.e(d)}finally{s.f()}var u=Math.max(a-r,o-i),c=Math.max(0,Math.floor(-Math.log(u)/Math.LN2)),h=Math.pow(2,c);return new e.CanonicalTileID(c,Math.floor((r+a)/2*h),Math.floor((i+o)/2*h))}(r),this.minzoom=this.maxzoom=this.tileID.z;var i=r.map((function(e){return n.tileID.getTilePoint(e)._round()}));return this._boundsArray=new e.StructArrayLayout4i8,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,e.EXTENT,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,e.EXTENT),this._boundsArray.emplaceBack(i[2].x,i[2].y,e.EXTENT,e.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})),this}},{key:"prepare",value:function(){if(0!==Object.keys(this.tiles).length&&this.image){var t=this.map.painter.context,n=t.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,G.members)),this.boundsSegments||(this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new e.Texture(t,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[r];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}}},{key:"loadTile",value:function(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}},{key:"serialize",value:function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}},{key:"hasTransition",value:function(){return!1}}]),r}(e.Evented),q={vector:function(t){p(r,t);var n=m(r);function r(t,a,o,s){var u;if(v(this,r),(u=n.call(this)).id=t,u.dispatcher=o,u.type="vector",u.minzoom=0,u.maxzoom=22,u.scheme="xyz",u.tileSize=512,u.reparseOverscaled=!0,u.isTileClipped=!0,u._loaded=!1,e.extend(i(u),e.pick(a,["url","scheme","tileSize","promoteId"])),u._options=e.extend({type:"vector"},a),u._collectResourceTiming=a.collectResourceTiming,512!==u.tileSize)throw new Error("vector tile sources must have a tileSize of 512");return u.setEventedParent(s),u._tileWorkers={},u._deduped=new e.DedupedRequest,l(u)}return y(r,[{key:"load",value:function(){var t=this;this._loaded=!1,this.fire(new e.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=j(this._options,this.map._requestManager,(function(n,r){t._tileJSONRequest=null,t._loaded=!0,n?t.fire(new e.ErrorEvent(n)):r&&(e.extend(t,r),r.bounds&&(t.tileBounds=new V(r.bounds,t.minzoom,t.maxzoom)),e.postTurnstileEvent(r.tiles,t.map._requestManager._customAccessToken),t.fire(new e.Event("data",{dataType:"source",sourceDataType:"metadata"})),t.fire(new e.Event("data",{dataType:"source",sourceDataType:"content"})))}))}},{key:"loaded",value:function(){return this._loaded}},{key:"hasTile",value:function(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}},{key:"onAdd",value:function(e){this.map=e,this.load()}},{key:"setSourceProperty",value:function(e){this._tileJSONRequest&&this._tileJSONRequest.cancel(),e();var t,n=this.map.style._getSourceCaches(this.id),r=f(n);try{for(r.s();!(t=r.n()).done;)t.value.clearTiles()}catch(i){r.e(i)}finally{r.f()}this.load()}},{key:"setTiles",value:function(e){var t=this;return this.setSourceProperty((function(){t._options.tiles=e})),this}},{key:"setUrl",value:function(e){var t=this;return this.setSourceProperty((function(){t.url=e,t._options.url=e})),this}},{key:"onRemove",value:function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}},{key:"serialize",value:function(){return e.extend({},this._options)}},{key:"loadTile",value:function(t,n){var r=this,i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),a={request:this.map._requestManager.transformRequest(i,e.ResourceType.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:e.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile};if(a.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=n:t.request=t.actor.send("reloadTile",a,s.bind(this));else if(t.actor=this._tileWorkers[i]=this._tileWorkers[i]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",a,s.bind(this));else{var o=e.loadVectorTile.call({deduped:this._deduped},a,(function(e,n){e||!n?s.call(r,e):(a.data={cacheControl:n.cacheControl,expires:n.expires,rawData:n.rawData.slice(0)},t.actor&&t.actor.send("loadTile",a,s.bind(r)))}),!0);t.request={cancel:o}}function s(r,i){return delete t.request,t.aborted?n(null):r&&404!==r.status?n(r):(i&&i.resourceTiming&&(t.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&t.setExpiryData(i),t.loadVectorData(i,this.map.painter),e.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}},{key:"abortTile",value:function(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id},void 0)}},{key:"unloadTile",value:function(e){e.unloadVectorData(),e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id},void 0)}},{key:"hasTransition",value:function(){return!1}},{key:"afterUpdate",value:function(){this._tileWorkers={}}}]),r}(e.Evented),raster:H,"raster-dem":function(t){p(r,t);var n=m(r);function r(t,i,a,o){var s;return v(this,r),(s=n.call(this,t,i,a,o)).type="raster-dem",s.maxzoom=22,s._options=e.extend({type:"raster-dem"},i),s.encoding=i.encoding||"mapbox",s}return y(r,[{key:"serialize",value:function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}},{key:"loadTile",value:function(t,n){var r=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function i(e,r){e&&(t.state="errored",n(e)),r&&(t.dem=r,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",n(null))}t.request=e.getImage(this.map._requestManager.transformRequest(r,e.ResourceType.Tile),function(r,a){if(delete t.request,t.aborted)t.state="unloaded",n(null);else if(r)t.state="errored",n(r);else if(a){this.map._refreshExpiredTiles&&t.setExpiryData(a),delete a.cacheControl,delete a.expires;var o=e.window.ImageBitmap&&a instanceof e.window.ImageBitmap&&e.offscreenCanvasSupported(),s=1-(a.width-e.prevPowerOfTwo(a.width))/2;s<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));var l=o?a:e.browser.getImageData(a,s),u={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:l,encoding:this.encoding,padding:s};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",u,i.bind(this)))}}.bind(this))}},{key:"_getNeighboringTiles",value:function(t){var n=t.canonical,r=Math.pow(2,n.z),i=(n.x-1+r)%r,a=0===n.x?t.wrap-1:t.wrap,o=(n.x+1+r)%r,s=n.x+1===r?t.wrap+1:t.wrap,l={};return l[new e.OverscaledTileID(t.overscaledZ,a,n.z,i,n.y).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,n.z,o,n.y).key]={backfilled:!1},n.y>0&&(l[new e.OverscaledTileID(t.overscaledZ,a,n.z,i,n.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,n.z,o,n.y-1).key]={backfilled:!1}),n.y+1<r&&(l[new e.OverscaledTileID(t.overscaledZ,a,n.z,i,n.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,t.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},l[new e.OverscaledTileID(t.overscaledZ,s,n.z,o,n.y+1).key]={backfilled:!1}),l}},{key:"unloadTile",value:function(e){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded"}}]),r}(H),geojson:function(t){p(r,t);var n=m(r);function r(t,i,a,o){var s;v(this,r),(s=n.call(this)).id=t,s.type="geojson",s.minzoom=0,s.maxzoom=18,s.tileSize=512,s.isTileClipped=!0,s.reparseOverscaled=!0,s._removed=!1,s._loaded=!1,s.actor=a.getActor(),s.setEventedParent(o),s._data=i.data,s._options=e.extend({},i),s._collectResourceTiming=i.collectResourceTiming,s._resourceTiming=[],void 0!==i.maxzoom&&(s.maxzoom=i.maxzoom),i.type&&(s.type=i.type),i.attribution&&(s.attribution=i.attribution),s.promoteId=i.promoteId;var l=e.EXTENT/s.tileSize;return s.workerOptions=e.extend({source:s.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*l,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*l,extent:e.EXTENT,maxZoom:s.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?Math.min(i.clusterMaxZoom,s.maxzoom-1):s.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:e.EXTENT,radius:(i.clusterRadius||50)*l,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions),s}return y(r,[{key:"load",value:function(){var t=this;this.fire(new e.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(n){if(n)t.fire(new e.ErrorEvent(n));else{var r={dataType:"source",sourceDataType:"metadata"};t._collectResourceTiming&&t._resourceTiming&&t._resourceTiming.length>0&&(r.resourceTiming=t._resourceTiming,t._resourceTiming=[]),t.fire(new e.Event("data",r))}}))}},{key:"onAdd",value:function(e){this.map=e,this.load()}},{key:"setData",value:function(t){var n=this;return this._data=t,this.fire(new e.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(t){if(t)n.fire(new e.ErrorEvent(t));else{var r={dataType:"source",sourceDataType:"content"};n._collectResourceTiming&&n._resourceTiming&&n._resourceTiming.length>0&&(r.resourceTiming=n._resourceTiming,n._resourceTiming=[]),n.fire(new e.Event("data",r))}})),this}},{key:"getClusterExpansionZoom",value:function(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id},t),this}},{key:"getClusterChildren",value:function(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id},t),this}},{key:"getClusterLeaves",value:function(e,t,n,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:e,limit:t,offset:n},r),this}},{key:"_updateWorkerData",value:function(t){var n=this;this._loaded=!1;var r=e.extend({},this.workerOptions),i=this._data;"string"==typeof i?(r.request=this.map._requestManager.transformRequest(e.browser.resolveURL(i),e.ResourceType.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(i),this.actor.send("".concat(this.type,".loadData"),r,(function(e,i){n._removed||i&&i.abandoned||(n._loaded=!0,i&&i.resourceTiming&&i.resourceTiming[n.id]&&(n._resourceTiming=i.resourceTiming[n.id].slice(0)),n.actor.send("".concat(n.type,".coalesce"),{source:r.source},null),t(e))}))}},{key:"loaded",value:function(){return this._loaded}},{key:"loadTile",value:function(t,n){var r=this,i=t.actor?"reloadTile":"loadTile";t.actor=this.actor,t.request=this.actor.send(i,{type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:e.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(function(e,a){return delete t.request,t.unloadVectorData(),t.aborted?n(null):e?n(e):(t.loadVectorData(a,r.map.painter,"reloadTile"===i),n(null))}))}},{key:"abortTile",value:function(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}},{key:"unloadTile",value:function(e){e.unloadVectorData(),this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id})}},{key:"onRemove",value:function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}},{key:"serialize",value:function(){return e.extend({},this._options,{type:this.type,data:this._data})}},{key:"hasTransition",value:function(){return!1}}]),r}(e.Evented),video:function(t){p(r,t);var n=m(r);function r(e,t,i,a){var o;return v(this,r),(o=n.call(this,e,t,i,a)).roundZoom=!0,o.type="video",o.options=t,o}return y(r,[{key:"load",value:function(){var t=this;this._loaded=!1;var n=this.options;this.urls=[];var r,i=f(n.urls);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.urls.push(this.map._requestManager.transformRequest(a,e.ResourceType.Source).url)}}catch(o){i.e(o)}finally{i.f()}e.getVideo(this.urls,(function(n,r){t._loaded=!0,n?t.fire(new e.ErrorEvent(n)):r&&(t.video=r,t.video.loop=!0,t.video.addEventListener("playing",(function(){t.map.triggerRepaint()})),t.map&&t.video.play(),t._finishLoading())}))}},{key:"pause",value:function(){this.video&&this.video.pause()}},{key:"play",value:function(){this.video&&this.video.play()}},{key:"seek",value:function(t){if(this.video){var n=this.video.seekable;t<n.start(0)||t>n.end(0)?this.fire(new e.ErrorEvent(new e.ValidationError("sources.".concat(this.id),null,"Playback for this video can be set only between the ".concat(n.start(0)," and ").concat(n.end(0),"-second mark.")))):this.video.currentTime=t}}},{key:"getVideo",value:function(){return this.video}},{key:"onAdd",value:function(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}},{key:"prepare",value:function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var t=this.map.painter.context,n=t.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,G.members)),this.boundsSegments||(this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new e.Texture(t,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[r];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}}},{key:"serialize",value:function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}},{key:"hasTransition",value:function(){return this.video&&!this.video.paused}}]),r}(W),image:W,canvas:function(t){p(r,t);var n=m(r);function r(t,i,a,o){var s;return v(this,r),s=n.call(this,t,i,a,o),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some((function(e){return!Array.isArray(e)||2!==e.length||e.some((function(e){return"number"!=typeof e}))}))||s.fire(new e.ErrorEvent(new e.ValidationError("sources.".concat(t),null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):s.fire(new e.ErrorEvent(new e.ValidationError("sources.".concat(t),null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&s.fire(new e.ErrorEvent(new e.ValidationError("sources.".concat(t),null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof e.window.HTMLCanvasElement||s.fire(new e.ErrorEvent(new e.ValidationError("sources.".concat(t),null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):s.fire(new e.ErrorEvent(new e.ValidationError("sources.".concat(t),null,'missing required property "canvas"'))),s.options=i,s.animate=void 0===i.animate||i.animate,s}return y(r,[{key:"load",value:function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof e.window.HTMLCanvasElement?this.options.canvas:e.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}},{key:"getCanvas",value:function(){return this.canvas}},{key:"onAdd",value:function(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}},{key:"onRemove",value:function(){this.pause()}},{key:"prepare",value:function(){var t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var n=this.map.painter.context,r=n.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,G.members)),this.boundsSegments||(this.boundsSegments=e.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.Texture(n,this.canvas,r.RGBA,{premultiply:!0}),this.tiles){var a=this.tiles[i];"loaded"!==a.state&&(a.state="loaded",a.texture=this.texture)}}}},{key:"serialize",value:function(){return{type:"canvas",coordinates:this.coordinates}}},{key:"hasTransition",value:function(){return this._playing}},{key:"_hasInvalidDimensions",value:function(){for(var e=0,t=[this.canvas.width,this.canvas.height];e<t.length;e++){var n=t[e];if(isNaN(n)||n<=0)return!0}return!1}}]),r}(W)},X=function(t,n,r,i){var a=new q[n.type](t,n,r,i);if(a.id!==t)throw new Error("Expected Source id to be ".concat(t," instead of ").concat(a.id));return e.bindAll(["load","abort","unload","serialize","prepare"],a),a};function Z(t,n){var r=e.identity([]);return e.scale(r,r,[.5*t.width,.5*-t.height,1]),e.translate(r,r,[1,-1,0]),e.multiply(r,r,t.calculatePosMatrix(n.toUnwrapped()))}function K(e,t,n,r,i,a,o){var s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],l=e.tilesIn(r,o,s);l.sort(J);var u,c=[],h=f(l);try{for(h.s();!(u=h.n()).done;){var d=u.value;c.push({wrappedTileID:d.tile.tileID.wrapped().key,queryResults:d.tile.queryRenderedFeatures(t,n,e._state,d,i,a,Z(e.transform,d.tile.tileID),s)})}}catch(v){h.e(v)}finally{h.f()}var p=function(e){var t,n={},r={},i=f(e);try{for(i.s();!(t=i.n()).done;){var a=t.value,o=a.queryResults,s=a.wrappedTileID,l=r[s]=r[s]||{};for(var u in o){var c,h=o[u],d=l[u]=l[u]||{},p=n[u]=n[u]||[],m=f(h);try{for(m.s();!(c=m.n()).done;){var y=c.value;d[y.featureIndex]||(d[y.featureIndex]=!0,p.push(y))}}catch(v){m.e(v)}finally{m.f()}}}}catch(v){i.e(v)}finally{i.f()}return n}(c);for(var m in p)p[m].forEach((function(t){var n=t.feature,r=e.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=r}));return p}function Y(e,t){for(var n=e.getRenderableIds().map((function(t){return e.getTileByID(t)})),r=[],i={},a=0;a<n.length;a++){var o=n[a],s=o.tileID.canonical.key;i[s]||(i[s]=!0,o.querySourceFeatures(r,t))}return r}function J(e,t){var n=e.tileID,r=t.tileID;return n.overscaledZ-r.overscaledZ||n.canonical.y-r.canonical.y||n.wrap-r.wrap||n.canonical.x-r.canonical.x}function Q(){return null!=Ni.workerClass?new Ni.workerClass:new e.window.Worker(Ni.workerUrl)}var $,ee="mapboxgl_preloaded_worker_pool",te=function(){function e(){v(this,e),this.active={}}return y(e,[{key:"acquire",value:function(t){if(!this.workers)for(this.workers=[];this.workers.length<e.workerCount;)this.workers.push(new Q);return this.active[t]=!0,this.workers.slice()}},{key:"release",value:function(e){delete this.active[e],0===this.numActive()&&(this.workers.forEach((function(e){e.terminate()})),this.workers=null)}},{key:"isPreloaded",value:function(){return!!this.active[ee]}},{key:"numActive",value:function(){return Object.keys(this.active).length}}]),e}();function ne(){return $||($=new te),$}function re(t,n){var r={};for(var i in t)"ref"!==i&&(r[i]=t[i]);return e.refProperties.forEach((function(e){e in n&&(r[e]=n[e])})),r}function ie(e){e=e.slice();for(var t=Object.create(null),n=0;n<e.length;n++)t[e[n].id]=e[n];for(var r=0;r<e.length;r++)"ref"in e[r]&&(e[r]=re(e[r],t[e[r].ref]));return e}te.workerCount=2;var ae={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain"};function oe(e,t,n){n.push({command:ae.addSource,args:[e,t[e]]})}function se(e,t,n){t.push({command:ae.removeSource,args:[e]}),n[e]=!0}function le(e,t,n,r){se(e,n,r),oe(e,t,n)}function ue(t,n,r){var i;for(i in t[r])if(t[r].hasOwnProperty(i)&&"data"!==i&&!e.deepEqual(t[r][i],n[r][i]))return!1;for(i in n[r])if(n[r].hasOwnProperty(i)&&"data"!==i&&!e.deepEqual(t[r][i],n[r][i]))return!1;return!0}function ce(t,n,r,i,a,o){var s;for(s in n=n||{},t=t||{})t.hasOwnProperty(s)&&(e.deepEqual(t[s],n[s])||r.push({command:o,args:[i,s,n[s],a]}));for(s in n)n.hasOwnProperty(s)&&!t.hasOwnProperty(s)&&(e.deepEqual(t[s],n[s])||r.push({command:o,args:[i,s,n[s],a]}))}function he(e){return e.id}function fe(e,t){return e[t.id]=t,e}var de=function(){function t(e,n){v(this,t),this.reset(e,n)}return y(t,[{key:"reset",value:function(e,t){this.points=e||[],this._distances=[0];for(var n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}},{key:"lerp",value:function(t){if(1===this.points.length)return this.points[0];t=e.clamp(t,0,1);for(var n=1,r=this._distances[n],i=t*this.paddedLength+this.padding;r<i&&n<this._distances.length;)r=this._distances[++n];var a=n-1,o=this._distances[a],s=r-o,l=s>0?(i-o)/s:0;return this.points[a].mult(1-l).add(this.points[n].mult(l))}}]),t}(),pe=function(){function e(t,n,r){v(this,e);var i=this.boxCells=[],a=this.circleCells=[];this.xCellCount=Math.ceil(t/r),this.yCellCount=Math.ceil(n/r);for(var o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]),a.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=n,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}return y(e,[{key:"keysLength",value:function(){return this.boxKeys.length+this.circleKeys.length}},{key:"insert",value:function(e,t,n,r,i){this._forEachCell(t,n,r,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}},{key:"insertCircle",value:function(e,t,n,r){this._forEachCell(t-r,n-r,t+r,n+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(n),this.circles.push(r)}},{key:"_insertBoxCell",value:function(e,t,n,r,i,a){this.boxCells[i].push(a)}},{key:"_insertCircleCell",value:function(e,t,n,r,i,a){this.circleCells[i].push(a)}},{key:"_query",value:function(e,t,n,r,i,a){if(n<0||e>this.width||r<0||t>this.height)return!i&&[];var o=[];if(e<=0&&t<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)o.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var l=0;l<this.circleKeys.length;l++){var u=this.circles[3*l],c=this.circles[3*l+1],h=this.circles[3*l+2];o.push({key:this.circleKeys[l],x1:u-h,y1:c-h,x2:u+h,y2:c+h})}return a?o.filter(a):o}return this._forEachCell(e,t,n,r,this._queryCell,o,{hitTest:i,seenUids:{box:{},circle:{}}},a),i?o.length>0:o}},{key:"_queryCircle",value:function(e,t,n,r,i){var a=e-n,o=e+n,s=t-n,l=t+n;if(o<0||a>this.width||l<0||s>this.height)return!r&&[];var u=[];return this._forEachCell(a,s,o,l,this._queryCellCircle,u,{hitTest:r,circle:{x:e,y:t,radius:n},seenUids:{box:{},circle:{}}},i),r?u.length>0:u}},{key:"query",value:function(e,t,n,r,i){return this._query(e,t,n,r,!1,i)}},{key:"hitTest",value:function(e,t,n,r,i){return this._query(e,t,n,r,!0,i)}},{key:"hitTestCircle",value:function(e,t,n,r){return this._queryCircle(e,t,n,!0,r)}},{key:"_queryCell",value:function(e,t,n,r,i,a,o,s){var l=o.seenUids,u=this.boxCells[i];if(null!==u){var c,h=this.bboxes,d=f(u);try{for(d.s();!(c=d.n()).done;){var p=c.value;if(!l.box[p]){l.box[p]=!0;var m=4*p;if(e<=h[m+2]&&t<=h[m+3]&&n>=h[m+0]&&r>=h[m+1]&&(!s||s(this.boxKeys[p]))){if(o.hitTest)return a.push(!0),!0;a.push({key:this.boxKeys[p],x1:h[m],y1:h[m+1],x2:h[m+2],y2:h[m+3]})}}}}catch(T){d.e(T)}finally{d.f()}}var v=this.circleCells[i];if(null!==v){var y,g=this.circles,_=f(v);try{for(_.s();!(y=_.n()).done;){var b=y.value;if(!l.circle[b]){l.circle[b]=!0;var x=3*b;if(this._circleAndRectCollide(g[x],g[x+1],g[x+2],e,t,n,r)&&(!s||s(this.circleKeys[b]))){if(o.hitTest)return a.push(!0),!0;var w=g[x],E=g[x+1],S=g[x+2];a.push({key:this.circleKeys[b],x1:w-S,y1:E-S,x2:w+S,y2:E+S})}}}}catch(T){_.e(T)}finally{_.f()}}}},{key:"_queryCellCircle",value:function(e,t,n,r,i,a,o,s){var l=o.circle,u=o.seenUids,c=this.boxCells[i];if(null!==c){var h,d=this.bboxes,p=f(c);try{for(p.s();!(h=p.n()).done;){var m=h.value;if(!u.box[m]){u.box[m]=!0;var v=4*m;if(this._circleAndRectCollide(l.x,l.y,l.radius,d[v+0],d[v+1],d[v+2],d[v+3])&&(!s||s(this.boxKeys[m])))return a.push(!0),!0}}}catch(E){p.e(E)}finally{p.f()}}var y=this.circleCells[i];if(null!==y){var g,_=this.circles,b=f(y);try{for(b.s();!(g=b.n()).done;){var x=g.value;if(!u.circle[x]){u.circle[x]=!0;var w=3*x;if(this._circlesCollide(_[w],_[w+1],_[w+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[x])))return a.push(!0),!0}}}catch(E){b.e(E)}finally{b.f()}}}},{key:"_forEachCell",value:function(e,t,n,r,i,a,o,s){for(var l=this._convertToXCellCoord(e),u=this._convertToYCellCoord(t),c=this._convertToXCellCoord(n),h=this._convertToYCellCoord(r),f=l;f<=c;f++)for(var d=u;d<=h;d++)if(i.call(this,e,t,n,r,this.xCellCount*d+f,a,o,s))return}},{key:"_convertToXCellCoord",value:function(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}},{key:"_convertToYCellCoord",value:function(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}},{key:"_circlesCollide",value:function(e,t,n,r,i,a){var o=r-e,s=i-t,l=n+a;return l*l>o*o+s*s}},{key:"_circleAndRectCollide",value:function(e,t,n,r,i,a,o){var s=(a-r)/2,l=Math.abs(e-(r+s));if(l>s+n)return!1;var u=(o-i)/2,c=Math.abs(t-(i+u));if(c>u+n)return!1;if(l<=s||c<=u)return!0;var h=l-s,f=c-u;return h*h+f*f<=n*n}}]),e}();function me(t,n,r,i,a){var o=e.create();return n?(e.scale(o,o,[1/a,1/a,1]),r||e.rotateZ(o,o,i.angle)):e.multiply(o,i.labelPlaneMatrix,t),o}function ve(t,n,r,i,a){if(n){var o=e.clone(t);return e.scale(o,o,[a,a,1]),r||e.rotateZ(o,o,-i.angle),o}return i.glCoordMatrix}function ye(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=[t.x,t.y,r,1];r?e.transformMat4(i,i,n):Ce(i,i,n);var a=i[3];return{point:new e.Point(i[0]/a,i[1]/a),signedDistanceFromCamera:a}}function ge(e,t){return Math.min(.5+e/t*.5,1.5)}function _e(e,t){var n=e[0]/e[3],r=e[1]/e[3];return n>=-t[0]&&n<=t[0]&&r>=-t[1]&&r<=t[1]}function be(t,n,r,i,a,o,s,l,u){var c=i?t.textSizeData:t.iconSizeData,h=e.evaluateSizeForZoom(c,r.transform.zoom),f=[256/r.width*2+1,256/r.height*2+1],d=i?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;d.clear();for(var p=t.lineVertexArray,m=i?t.text.placedSymbolArray:t.icon.placedSymbolArray,v=r.transform.width/r.transform.height,y=!1,g=0;g<m.length;g++){var _=m.get(g);if(_.hidden||_.writingMode===e.WritingMode.vertical&&!y)Me(_.numGlyphs,d);else{y=!1;var b=u?u({x:_.anchorX,y:_.anchorY}):0,x=[_.anchorX,_.anchorY,b,1];if(e.transformMat4(x,x,n),_e(x,f)){var w=ge(r.transform.cameraToCenterDistance,x[3]),E=e.evaluateSizeForFeature(c,h,_),S=s?E/w:E*w,T=new e.Point(_.anchorX,_.anchorY),k=ye(T,a,b);if(k.signedDistanceFromCamera<=0)Me(_.numGlyphs,d);else{var M=k.point,C={},A=s?null:u,I=Ee(_,S,!1,l,n,a,o,t.glyphOffsetArray,p,d,M,T,C,v,A);y=I.useVertical,A&&I.needsFlipping&&(C={}),(I.notEnoughRoom||y||I.needsFlipping&&Ee(_,S,!0,l,n,a,o,t.glyphOffsetArray,p,d,M,T,C,v,A).notEnoughRoom)&&Me(_.numGlyphs,d)}}else Me(_.numGlyphs,d)}}i?t.text.dynamicLayoutVertexBuffer.updateData(d):t.icon.dynamicLayoutVertexBuffer.updateData(d)}function xe(e,t,n,r,i,a,o,s,l,u,c,h,f){var d=s.glyphStartIndex+s.numGlyphs,p=s.lineStartIndex,m=s.lineStartIndex+s.lineLength,v=t.getoffsetX(s.glyphStartIndex),y=t.getoffsetX(d-1),g=Te(e*v,n,r,i,a,o,s.segment,p,m,l,u,c,h,f,!0);if(!g)return null;var _=Te(e*y,n,r,i,a,o,s.segment,p,m,l,u,c,h,f,!0);return _?{first:g,last:_}:null}function we(t,n,r,i){return t===e.WritingMode.horizontal&&Math.abs(r.y-n.y)>Math.abs(r.x-n.x)*i?{useVertical:!0}:(t===e.WritingMode.vertical?n.y<r.y:n.x>r.x)?{needsFlipping:!0}:null}function Ee(t,n,r,i,a,o,s,l,u,c,h,d,p,m,v){var y,g=n/24,_=t.lineOffsetX*g,b=t.lineOffsetY*g;if(t.numGlyphs>1){var x=t.glyphStartIndex+t.numGlyphs,w=t.lineStartIndex,E=t.lineStartIndex+t.lineLength,S=xe(g,l,_,b,r,h,d,t,u,o,p,v);if(!S)return{notEnoughRoom:!0};var T=ye(S.first.point,s).point,k=ye(S.last.point,s).point;if(i&&!r){var M=we(t.writingMode,T,k,m);if(M)return M}y=[S.first];for(var C=t.glyphStartIndex+1;C<x-1;C++)y.push(Te(g*l.getoffsetX(C),_,b,r,h,d,t.segment,w,E,u,o,p,v));y.push(S.last)}else{if(i&&!r){var A=ye(d,a).point,I=t.lineStartIndex+t.segment+1,P=new e.Point(u.getx(I),u.gety(I)),R=ye(P,a),L=R.signedDistanceFromCamera>0?R.point:Se(d,P,A,1,a),O=we(t.writingMode,A,L,m);if(O)return O}var D=Te(g*l.getoffsetX(t.glyphStartIndex),_,b,r,h,d,t.segment,t.lineStartIndex,t.lineStartIndex+t.lineLength,u,o,p,v);if(!D)return{notEnoughRoom:!0};y=[D]}var N,z=f(y);try{for(z.s();!(N=z.n()).done;){var F=N.value;e.addDynamicAttributes(c,F.point,F.angle)}}catch(B){z.e(B)}finally{z.f()}return{}}function Se(e,t,n,r,i,a){var o=e.add(e.sub(t)._unit()),s=ye(o,i,a?a(o):0).point,l=n.sub(s);return n.add(l._mult(r/l.mag()))}function Te(t,n,r,i,a,o,s,l,u,c,h,f,d,p,m){var v=i?t-n:t+n,y=v>0?1:-1,g=0;i&&(y*=-1,g=Math.PI),y<0&&(g+=Math.PI);for(var _=y>0?l+s:l+s+1,b=a,x=a,w=0,E=0,S=Math.abs(v),T=[],k=[],M=o,C=function(){var t=_-y;return 0===w?o:new e.Point(c.getx(t),c.gety(t))},A=function(){return Se(C(),M,x,S-w+1,h,d)};w+E<=S;){if((_+=y)<l||_>=u)return null;if(x=b,T.push(b),p&&k.push(M||C()),void 0===(b=f[_])){var I=ye(M=new e.Point(c.getx(_),c.gety(_)),h,d?d(M):0);b=I.signedDistanceFromCamera>0?f[_]=I.point:A()}else M=null;w+=E,E=x.dist(b)}m&&d&&(M=M||new e.Point(c.getx(_),c.gety(_)),f[_]=b=void 0===f[_]?b:A(),E=x.dist(b));var P=(S-w)/E,R=b.sub(x),L=R.mult(P)._add(x);r&&L._add(R._unit()._perp()._mult(r*y));var O=g+Math.atan2(b.y-x.y,b.x-x.x);return T.push(L),p&&(M=M||new e.Point(c.getx(_),c.gety(_)),k.push(function(t,n,r){var i=1-r;return new e.Point(t.x*i+n.x*r,t.y*i+n.y*r)}(k.length>0?k[k.length-1]:M,M,P))),{point:L,angle:O,path:T,tilePath:k}}var ke=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Me(e,t){for(var n=0;n<e;n++){var r=t.length;t.resize(r+4),t.float32.set(ke,3*r)}}function Ce(e,t,n){var r=t[0],i=t[1];return e[0]=n[0]*r+n[4]*i+n[12],e[1]=n[1]*r+n[5]*i+n[13],e[3]=n[3]*r+n[7]*i+n[15],e}var Ae=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new pe(e.width+200,e.height+200,25),r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new pe(e.width+200,e.height+200,25);v(this,t),this.transform=e,this.grid=n,this.ignoredGrid=r,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+100,this.screenBottomBoundary=e.height+100,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200}return y(t,[{key:"placeCollisionBox",value:function(e,t,n,r,i,a,o){var s=this.projectAndGetPerspectiveRatio(a,t.anchorPointX,t.anchorPointY,t.elevation),l=i*s.perspectiveRatio,u=(t.x1*e+n.x-t.padding)*l+s.point.x,c=(t.y1*e+n.y-t.padding)*l+s.point.y,h=(t.x2*e+n.x+t.padding)*l+s.point.x,f=(t.y2*e+n.y+t.padding)*l+s.point.y,d=s.perspectiveRatio<=.55;return!this.isInsideGrid(u,c,h,f)||!r&&this.grid.hitTest(u,c,h,f,o)||d?{box:[],offscreen:!1}:{box:[u,c,h,f],offscreen:this.isOffscreen(u,c,h,f)}}},{key:"placeCollisionCircles",value:function(t,n,r,i,a,o,s,l,u,c,h,d,p,m){var v=[],y=this.transform.elevation,g=y?function(e){return y.getAtTileOffset(m,e.x,e.y)}:function(e){return 0},_=new e.Point(n.anchorX,n.anchorY),b=g(_),x=ye(_,o,b),w=ge(this.transform.cameraToCenterDistance,x.signedDistanceFromCamera),E=(c?a/w:a*w)/e.ONE_EM,S=ye(_,s,b).point,T=x.signedDistanceFromCamera>0?xe(E,i,n.lineOffsetX*E,n.lineOffsetY*E,!1,S,_,n,r,s,{},y&&!c?g:null,c&&!!y):null,k=!1,M=!1,C=!0;if(T){for(var A=.5*d*w+p,I=new e.Point(-100,-100),P=new e.Point(this.screenRightBoundary,this.screenBottomBoundary),R=new de,L=T.first,O=T.last,D=[],N=L.path.length-1;N>=1;N--)D.push(L.path[N]);for(var z=1;z<O.path.length;z++)D.push(O.path[z]);var F=2.5*A;if(l){var B=D.map(y?function(e,t){var n=g(t<L.path.length-1?L.tilePath[L.path.length-1-t]:O.tilePath[t-L.path.length+2]);return ye(e,l,n)}:function(e){return ye(e,l)});D=B.some((function(e){return e.signedDistanceFromCamera<=0}))?[]:B.map((function(e){return e.point}))}var U=[];if(D.length>0){for(var j=D[0].clone(),V=D[0].clone(),H=1;H<D.length;H++)j.x=Math.min(j.x,D[H].x),j.y=Math.min(j.y,D[H].y),V.x=Math.max(V.x,D[H].x),V.y=Math.max(V.y,D[H].y);U=j.x>=I.x&&V.x<=P.x&&j.y>=I.y&&V.y<=P.y?[D]:V.x<I.x||j.x>P.x||V.y<I.y||j.y>P.y?[]:e.clipLine([D],I.x,I.y,P.x,P.y)}var G,W=f(U);try{for(W.s();!(G=W.n()).done;){var q=G.value;R.reset(q,.25*A);var X=0;X=R.length<=.5*A?1:Math.ceil(R.paddedLength/F)+1;for(var Z=0;Z<X;Z++){var K=Z/Math.max(X-1,1),Y=R.lerp(K),J=Y.x+100,Q=Y.y+100;v.push(J,Q,A,0);var $=J-A,ee=Q-A,te=J+A,ne=Q+A;if(C=C&&this.isOffscreen($,ee,te,ne),M=M||this.isInsideGrid($,ee,te,ne),!t&&this.grid.hitTestCircle(J,Q,A,h)&&(k=!0,!u))return{circles:[],offscreen:!1,collisionDetected:k}}}}catch(re){W.e(re)}finally{W.f()}}return{circles:!u&&k||!M?[]:v,offscreen:C,collisionDetected:k}}},{key:"queryRenderedSymbols",value:function(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};var n,r=[],i=1/0,a=1/0,o=-1/0,s=-1/0,l=f(t);try{for(l.s();!(n=l.n()).done;){var u=n.value,c=new e.Point(u.x+100,u.y+100);i=Math.min(i,c.x),a=Math.min(a,c.y),o=Math.max(o,c.x),s=Math.max(s,c.y),r.push(c)}}catch(b){l.e(b)}finally{l.f()}var h,d=this.grid.query(i,a,o,s).concat(this.ignoredGrid.query(i,a,o,s)),p={},m={},v=f(d);try{for(v.s();!(h=v.n()).done;){var y=h.value,g=y.key;if(void 0===p[g.bucketInstanceId]&&(p[g.bucketInstanceId]={}),!p[g.bucketInstanceId][g.featureIndex]){var _=[new e.Point(y.x1,y.y1),new e.Point(y.x2,y.y1),new e.Point(y.x2,y.y2),new e.Point(y.x1,y.y2)];e.polygonIntersectsPolygon(r,_)&&(p[g.bucketInstanceId][g.featureIndex]=!0,void 0===m[g.bucketInstanceId]&&(m[g.bucketInstanceId]=[]),m[g.bucketInstanceId].push(g.featureIndex))}}}catch(b){v.e(b)}finally{v.f()}return m}},{key:"insertCollisionBox",value:function(e,t,n,r,i){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:r,collisionGroupID:i},e[0],e[1],e[2],e[3])}},{key:"insertCollisionCircles",value:function(e,t,n,r,i){for(var a=t?this.ignoredGrid:this.grid,o={bucketInstanceId:n,featureIndex:r,collisionGroupID:i},s=0;s<e.length;s+=4)a.insertCircle(o,e[s],e[s+1],e[s+2])}},{key:"projectAndGetPerspectiveRatio",value:function(t,n,r,i){var a=[n,r,0,1];return i?(a[2]=i,e.transformMat4(a,a,t)):Ce(a,a,t),{point:new e.Point((a[0]/a[3]+1)/2*this.transform.width+100,(-a[1]/a[3]+1)/2*this.transform.height+100),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/a[3]*.5,1.5)}}},{key:"isOffscreen",value:function(e,t,n,r){return n<100||e>=this.screenRightBoundary||r<100||t>this.screenBottomBoundary}},{key:"isInsideGrid",value:function(e,t,n,r){return n>=0&&e<this.gridRightBoundary&&r>=0&&t<this.gridBottomBoundary}},{key:"getViewportMatrix",value:function(){var t=e.identity([]);return e.translate(t,t,[-100,-100,0]),t}}]),t}(),Ie=function(){function e(t,n,r,i){v(this,e),this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?n:-n))):i&&r?1:0,this.placed=r}return y(e,[{key:"isHidden",value:function(){return 0===this.opacity&&!this.placed}}]),e}(),Pe=function(){function e(t,n,r,i,a){v(this,e),this.text=new Ie(t?t.text:null,n,r,a),this.icon=new Ie(t?t.icon:null,n,i,a)}return y(e,[{key:"isHidden",value:function(){return this.text.isHidden()&&this.icon.isHidden()}}]),e}(),Re=function e(t,n,r){v(this,e),this.text=t,this.icon=n,this.skipFade=r},Le=function t(){v(this,t),this.invProjMatrix=e.create(),this.viewportMatrix=e.create(),this.circles=[]},Oe=function e(t,n,r,i,a){v(this,e),this.bucketInstanceId=t,this.featureIndex=n,this.sourceLayerIndex=r,this.bucketIndex=i,this.tileID=a},De=function(){function e(t){v(this,e),this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}return y(e,[{key:"get",value:function(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){var t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:function(e){return e.collisionGroupID===t}}}return this.collisionGroups[e]}}]),e}();function Ne(t,n,r,i,a){var o=e.getAnchorAlignment(t),s=-(o.horizontalAlign-.5)*n,l=-(o.verticalAlign-.5)*r,u=e.evaluateVariableOffset(t,i);return new e.Point(s+u[0]*a,l+u[1]*a)}function ze(t,n,r,i,a){var o=new e.Point(t,n);return r&&o._rotate(i?a:-a),o}var Fe=function(){function t(e,n,r,i){v(this,t),this.transform=e.clone(),this.collisionIndex=new Ae(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new De(r),this.collisionCircleArrays={},this.prevPlacement=i,i&&(i.prevPlacement=void 0),this.placedOrientations={}}return y(t,[{key:"getBucketParts",value:function(t,n,r,i){var a=r.getBucket(n),o=r.latestFeatureIndex;if(a&&o&&n.id===a.layerIds[0]){var s=r.collisionBoxArray,l=a.layers[0].layout,u=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),c=r.tileSize/e.EXTENT,h=this.transform.calculatePosMatrix(r.tileID.toUnwrapped()),d="map"===l.get("text-pitch-alignment"),p="map"===l.get("text-rotation-alignment"),m=F(r,1,this.transform.zoom),v=me(h,d,p,this.transform,m),y=null;if(d){var g=ve(h,d,p,this.transform,m);y=e.multiply([],this.transform.labelPlaneMatrix,g)}this.retainedQueryData[a.bucketInstanceId]=new Oe(a.bucketInstanceId,o,a.sourceLayerIndex,a.index,r.tileID);var _={bucket:a,layout:l,posMatrix:h,textLabelPlaneMatrix:v,labelToScreenMatrix:y,scale:u,textPixelRatio:c,holdingForFade:r.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:e.evaluateSizeForZoom(a.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:e.evaluateSizeForZoom(a.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(a.sourceID)};if(i){var b,x=f(a.sortKeyRanges);try{for(x.s();!(b=x.n()).done;){var w=b.value,E=w.sortKey,S=w.symbolInstanceStart,T=w.symbolInstanceEnd;t.push({sortKey:E,symbolInstanceStart:S,symbolInstanceEnd:T,parameters:_})}}catch(k){x.e(k)}finally{x.f()}}else t.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:_})}}},{key:"attemptAnchorPlacement",value:function(e,t,n,r,i,a,o,s,l,u,c,h,f,d,p,m,v,y){var g,_=[h.textOffset0,h.textOffset1],b=d.getSymbolInstanceTextSize(v,h,this.transform.zoom,f),x=Ne(e,n,r,_,i),w=this.collisionIndex.placeCollisionBox(b,t,ze(x.x,x.y,a,o,this.transform.angle),c,s,l,u.predicate);if((!m||0!==this.collisionIndex.placeCollisionBox(d.getSymbolInstanceIconSize(y,this.transform.zoom,f),m,ze(x.x,x.y,a,o,this.transform.angle),c,s,l,u.predicate).box.length)&&w.box.length>0)return this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(g=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:_,width:n,height:r,anchor:e,textBoxScale:i,prevAnchor:g},this.markUsedJustification(d,e,h,p),d.allowVerticalPlacement&&(this.markUsedOrientation(d,p,h),this.placedOrientations[h.crossTileID]=p),{shift:x,placedGlyphBoxes:w}}},{key:"placeLayerBucketPart",value:function(t,n,r){var i=this,a=t.parameters,o=a.bucket,s=a.layout,l=a.posMatrix,u=a.textLabelPlaneMatrix,c=a.labelToScreenMatrix,h=a.textPixelRatio,d=a.holdingForFade,p=a.collisionBoxArray,m=a.partiallyEvaluatedTextSize,v=a.partiallyEvaluatedIconSize,y=a.collisionGroup,g=s.get("text-optional"),_=s.get("icon-optional"),b=s.get("text-allow-overlap"),x=s.get("icon-allow-overlap"),w="map"===s.get("text-rotation-alignment"),E="map"===s.get("text-pitch-alignment"),S="none"!==s.get("icon-text-fit"),T="viewport-y"===s.get("symbol-z-order"),k=b&&(x||!o.hasIconData()||_),M=x&&(b||!o.hasTextData()||g);!o.collisionArrays&&p&&o.deserializeCollisionBoxes(p),r&&o.updateCollisionDebugBuffers(this.transform.zoom,p);var C=function(t,a,p){if(!n[t.crossTileID])if(d)i.placements[t.crossTileID]=new Re(!1,!1,!1);else{var T=!1,C=!1,A=!0,I=null,P={box:null,offscreen:null},R={box:null,offscreen:null},L=null,O=null,D=null,N=0,z=0,F=0;p.textFeatureIndex?N=p.textFeatureIndex:t.useRuntimeCollisionCircles&&(N=t.featureIndex),p.verticalTextFeatureIndex&&(z=p.verticalTextFeatureIndex);var B=function(e){(i.transform.elevation||e.elevation)&&(e.elevation=i.transform.elevation?i.transform.elevation.getAtTileOffset(i.retainedQueryData[o.bucketInstanceId].tileID,e.anchorPointX,e.anchorPointY):0)},U=p.textBox;if(U){B(U);var j=function(n){var r=e.WritingMode.horizontal;if(o.allowVerticalPlacement&&!n&&i.prevPlacement){var a=i.prevPlacement.placedOrientations[t.crossTileID];a&&(i.placedOrientations[t.crossTileID]=a,r=a,i.markUsedOrientation(o,r,t))}return r},V=function(n,r){if(o.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&p.verticalTextBox){var i,a=f(o.writingModes);try{for(a.s();!(i=a.n()).done&&(i.value===e.WritingMode.vertical?(P=r(),R=P):P=n(),!(P&&P.box&&P.box.length)););}catch(s){a.e(s)}finally{a.f()}}else P=n()};if(s.get("text-variable-anchor")){var H=s.get("text-variable-anchor");if(i.prevPlacement&&i.prevPlacement.variableOffsets[t.crossTileID]){var G=i.prevPlacement.variableOffsets[t.crossTileID];H.indexOf(G.anchor)>0&&(H=H.filter((function(e){return e!==G.anchor}))).unshift(G.anchor)}var W=function(e,n,r){var s=t.textBoxScale,u=(e.x2-e.x1)*s+2*e.padding,c=(e.y2-e.y1)*s+2*e.padding,f=S&&!x?n:null;f&&B(f);for(var d={box:[],offscreen:!1},p=b?2*H.length:H.length,g=0;g<p;++g){var _=i.attemptAnchorPlacement(H[g%H.length],e,u,c,s,w,E,h,l,y,g>=H.length,t,a,o,r,f,m,v);if(_&&(d=_.placedGlyphBoxes)&&d.box&&d.box.length){T=!0,I=_.shift;break}}return d};V((function(){return W(U,p.iconBox,e.WritingMode.horizontal)}),(function(){var n=p.verticalTextBox;return n&&B(n),o.allowVerticalPlacement&&!(P&&P.box&&P.box.length)&&t.numVerticalGlyphVertices>0&&n?W(n,p.verticalIconBox,e.WritingMode.vertical):{box:null,offscreen:null}})),P&&(T=P.box,A=P.offscreen);var q=j(P&&P.box);if(!T&&i.prevPlacement){var X=i.prevPlacement.variableOffsets[t.crossTileID];X&&(i.variableOffsets[t.crossTileID]=X,i.markUsedJustification(o,X.anchor,t,q))}}else{var Z=function(n,r){var s=o.getSymbolInstanceTextSize(m,t,i.transform.zoom,a),u=i.collisionIndex.placeCollisionBox(s,n,new e.Point(0,0),b,h,l,y.predicate);return u&&u.box&&u.box.length&&(i.markUsedOrientation(o,r,t),i.placedOrientations[t.crossTileID]=r),u};V((function(){return Z(U,e.WritingMode.horizontal)}),(function(){var n=p.verticalTextBox;return o.allowVerticalPlacement&&t.numVerticalGlyphVertices>0&&n?(B(n),Z(n,e.WritingMode.vertical)):{box:null,offscreen:null}})),j(P&&P.box&&P.box.length)}}if(T=(L=P)&&L.box&&L.box.length>0,A=L&&L.offscreen,t.useRuntimeCollisionCircles){var K=o.text.placedSymbolArray.get(t.centerJustifiedTextSymbolIndex),Y=e.evaluateSizeForFeature(o.textSizeData,m,K),J=s.get("text-padding");O=i.collisionIndex.placeCollisionCircles(b,K,o.lineVertexArray,o.glyphOffsetArray,Y,l,u,c,r,E,y.predicate,t.collisionCircleDiameter,J,i.retainedQueryData[o.bucketInstanceId].tileID),T=b||O.circles.length>0&&!O.collisionDetected,A=A&&O.offscreen}if(p.iconFeatureIndex&&(F=p.iconFeatureIndex),p.iconBox){var Q=function(t){B(t);var n=S&&I?ze(I.x,I.y,w,E,i.transform.angle):new e.Point(0,0),r=o.getSymbolInstanceIconSize(v,i.transform.zoom,a);return i.collisionIndex.placeCollisionBox(r,t,n,x,h,l,y.predicate)};C=R&&R.box&&R.box.length&&p.verticalIconBox?(D=Q(p.verticalIconBox)).box.length>0:(D=Q(p.iconBox)).box.length>0,A=A&&D.offscreen}var $=g||0===t.numHorizontalGlyphVertices&&0===t.numVerticalGlyphVertices,ee=_||0===t.numIconVertices;if($||ee?ee?$||(C=C&&T):T=C&&T:C=T=C&&T,T&&L&&L.box&&i.collisionIndex.insertCollisionBox(L.box,s.get("text-ignore-placement"),o.bucketInstanceId,R&&R.box&&z?z:N,y.ID),C&&D&&i.collisionIndex.insertCollisionBox(D.box,s.get("icon-ignore-placement"),o.bucketInstanceId,F,y.ID),O&&(T&&i.collisionIndex.insertCollisionCircles(O.circles,s.get("text-ignore-placement"),o.bucketInstanceId,N,y.ID),r)){var te=o.bucketInstanceId,ne=i.collisionCircleArrays[te];void 0===ne&&(ne=i.collisionCircleArrays[te]=new Le);for(var re=0;re<O.circles.length;re+=4)ne.circles.push(O.circles[re+0]),ne.circles.push(O.circles[re+1]),ne.circles.push(O.circles[re+2]),ne.circles.push(O.collisionDetected?1:0)}i.placements[t.crossTileID]=new Re(T||k,C||M,A||o.justReloaded),n[t.crossTileID]=!0}};if(T)for(var A=o.getSortedSymbolIndexes(this.transform.angle),I=A.length-1;I>=0;--I){var P=A[I];C(o.symbolInstances.get(P),P,o.collisionArrays[P])}else for(var R=t.symbolInstanceStart;R<t.symbolInstanceEnd;R++)C(o.symbolInstances.get(R),R,o.collisionArrays[R]);if(r&&o.bucketInstanceId in this.collisionCircleArrays){var L=this.collisionCircleArrays[o.bucketInstanceId];e.invert(L.invProjMatrix,l),L.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}},{key:"markUsedJustification",value:function(t,n,r,i){var a;a=i===e.WritingMode.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[e.getAnchorJustification(n)];for(var o=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];o<s.length;o++){var l=s[o];l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=a>=0&&l!==a?0:r.crossTileID)}}},{key:"markUsedOrientation",value:function(t,n,r){for(var i=n===e.WritingMode.horizontal||n===e.WritingMode.horizontalOnly?n:0,a=n===e.WritingMode.vertical?n:0,o=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];o<s.length;o++){var l=s[o];t.text.placedSymbolArray.get(l).placedOrientation=i}r.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=a)}},{key:"commit",value:function(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;var t=this.prevPlacement,n=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;var r=t?t.symbolFadeChange(e):1,i=t?t.opacities:{},a=t?t.variableOffsets:{},o=t?t.placedOrientations:{};for(var s in this.placements){var l=this.placements[s],u=i[s];u?(this.opacities[s]=new Pe(u,r,l.text,l.icon),n=n||l.text!==u.text.placed||l.icon!==u.icon.placed):(this.opacities[s]=new Pe(null,r,l.text,l.icon,l.skipFade),n=n||l.text||l.icon)}for(var c in i){var h=i[c];if(!this.opacities[c]){var f=new Pe(h,r,!1,!1);f.isHidden()||(this.opacities[c]=f,n=n||h.text.placed||h.icon.placed)}}for(var d in a)this.variableOffsets[d]||!this.opacities[d]||this.opacities[d].isHidden()||(this.variableOffsets[d]=a[d]);for(var p in o)this.placedOrientations[p]||!this.opacities[p]||this.opacities[p].isHidden()||(this.placedOrientations[p]=o[p]);n?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}},{key:"updateLayerOpacities",value:function(e,t){var n,r={},i=f(t);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=a.getBucket(e);o&&a.latestFeatureIndex&&e.id===o.layerIds[0]&&this.updateBucketOpacities(o,r,a.collisionBoxArray)}}catch(s){i.e(s)}finally{i.f()}}},{key:"updateBucketOpacities",value:function(t,n,r){var i=this;t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();var a=t.layers[0].layout,o=new Pe(null,0,!1,!1,!0),s=a.get("text-allow-overlap"),l=a.get("icon-allow-overlap"),u=a.get("text-variable-anchor"),c="map"===a.get("text-rotation-alignment"),h="map"===a.get("text-pitch-alignment"),f="none"!==a.get("icon-text-fit"),d=new Pe(null,0,s&&(l||!t.hasIconData()||a.get("icon-optional")),l&&(s||!t.hasTextData()||a.get("text-optional")),!0);!t.collisionArrays&&r&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(r);for(var p=function(e,t,n){for(var r=0;r<t/4;r++)e.opacityVertexArray.emplaceBack(n)},m=function(r){var a=t.symbolInstances.get(r),s=a.numHorizontalGlyphVertices,l=a.numVerticalGlyphVertices,m=a.crossTileID,v=i.opacities[m];n[m]?v=o:v||(v=d,i.opacities[m]=v),n[m]=!0;var y=a.numIconVertices>0,g=i.placedOrientations[a.crossTileID],_=g===e.WritingMode.vertical,b=g===e.WritingMode.horizontal||g===e.WritingMode.horizontalOnly;if(s>0||l>0){var x=Xe(v.text);p(t.text,s,_?Ze:x),p(t.text,l,b?Ze:x);var w=v.text.isHidden();[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((function(e){e>=0&&(t.text.placedSymbolArray.get(e).hidden=w||_?1:0)})),a.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(a.verticalPlacedTextSymbolIndex).hidden=w||b?1:0);var E=i.variableOffsets[a.crossTileID];E&&i.markUsedJustification(t,E.anchor,a,g);var S=i.placedOrientations[a.crossTileID];S&&(i.markUsedJustification(t,"left",a,S),i.markUsedOrientation(t,S,a))}if(y){var T=Xe(v.icon),k=!(f&&a.verticalPlacedIconSymbolIndex&&_);a.placedIconSymbolIndex>=0&&(p(t.icon,a.numIconVertices,k?T:Ze),t.icon.placedSymbolArray.get(a.placedIconSymbolIndex).hidden=v.icon.isHidden()),a.verticalPlacedIconSymbolIndex>=0&&(p(t.icon,a.numVerticalIconVertices,k?Ze:T),t.icon.placedSymbolArray.get(a.verticalPlacedIconSymbolIndex).hidden=v.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){var M=t.collisionArrays[r];if(M){var C=new e.Point(0,0);if(M.textBox||M.verticalTextBox){var A=!0;if(u){var I=i.variableOffsets[m];I?(C=Ne(I.anchor,I.width,I.height,I.textOffset,I.textBoxScale),c&&C._rotate(h?i.transform.angle:-i.transform.angle)):A=!1}M.textBox&&Be(t.textCollisionBox.collisionVertexArray,v.text.placed,!A||_,C.x,C.y),M.verticalTextBox&&Be(t.textCollisionBox.collisionVertexArray,v.text.placed,!A||b,C.x,C.y)}var P=Boolean(!b&&M.verticalIconBox);M.iconBox&&Be(t.iconCollisionBox.collisionVertexArray,v.icon.placed,P,f?C.x:0,f?C.y:0),M.verticalIconBox&&Be(t.iconCollisionBox.collisionVertexArray,v.icon.placed,!P,f?C.x:0,f?C.y:0)}}},v=0;v<t.symbolInstances.length;v++)m(v);if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){var y=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=y.invProjMatrix,t.placementViewportMatrix=y.viewportMatrix,t.collisionCircleArray=y.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}},{key:"symbolFadeChange",value:function(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}},{key:"zoomAdjustment",value:function(e){return Math.max(0,(this.transform.zoom-e)/1.5)}},{key:"hasTransitions",value:function(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}},{key:"stillRecent",value:function(e,t){var n=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*n>e}},{key:"setStale",value:function(){this.stale=!0}}]),t}();function Be(e,t,n,r,i){e.emplaceBack(t?1:0,n?1:0,r||0,i||0),e.emplaceBack(t?1:0,n?1:0,r||0,i||0),e.emplaceBack(t?1:0,n?1:0,r||0,i||0),e.emplaceBack(t?1:0,n?1:0,r||0,i||0)}var Ue=Math.pow(2,25),je=Math.pow(2,24),Ve=Math.pow(2,17),He=Math.pow(2,16),Ge=Math.pow(2,9),We=Math.pow(2,8),qe=Math.pow(2,1);function Xe(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;var t=e.placed?1:0,n=Math.floor(127*e.opacity);return n*Ue+t*je+n*Ve+t*He+n*Ge+t*We+n*qe+t}var Ze=0,Ke=function(){function e(t){v(this,e),this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}return y(e,[{key:"continuePlacement",value:function(e,t,n,r,i){for(var a=this._bucketParts;this._currentTileIndex<e.length;)if(t.getBucketParts(a,r,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((function(e,t){return e.sortKey-t.sortKey})));this._currentPartIndex<a.length;)if(t.placeLayerBucketPart(a[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,i())return!0;return!1}}]),e}(),Ye=function(){function t(e,n,r,i,a,o,s){v(this,t),this.placement=new Fe(e,a,o,s),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=i,this._done=!1}return y(t,[{key:"isDone",value:function(){return this._done}},{key:"continuePlacement",value:function(t,n,r){for(var i=this,a=e.browser.now(),o=function(){var t=e.browser.now()-a;return!i._forceFullPlacement&&t>2};this._currentPlacementIndex>=0;){var s=n[t[this._currentPlacementIndex]],l=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=l)&&(!s.maxzoom||s.maxzoom>l)){if(this._inProgressLayer||(this._inProgressLayer=new Ke(s)),this._inProgressLayer.continuePlacement(r[s.source],this.placement,this._showCollisionBoxes,s,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}},{key:"commit",value:function(e){return this.placement.commit(e),this.placement}}]),t}(),Je=512/e.EXTENT/2,Qe=function(){function t(e,n,r){v(this,t),this.tileID=e,this.indexedSymbolInstances={},this.bucketInstanceId=r;for(var i=0;i<n.length;i++){var a=n.get(i),o=a.key;this.indexedSymbolInstances[o]||(this.indexedSymbolInstances[o]=[]),this.indexedSymbolInstances[o].push({crossTileID:a.crossTileID,coord:this.getScaledCoordinates(a,e)})}}return y(t,[{key:"getScaledCoordinates",value:function(t,n){var r=Je/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*e.EXTENT+t.anchorX)*r),y:Math.floor((n.canonical.y*e.EXTENT+t.anchorY)*r)}}},{key:"findMatches",value:function(e,t,n){for(var r=this.tileID.canonical.z<t.canonical.z?1:Math.pow(2,this.tileID.canonical.z-t.canonical.z),i=0;i<e.length;i++){var a=e.get(i);if(!a.crossTileID){var o=this.indexedSymbolInstances[a.key];if(o){var s,l=this.getScaledCoordinates(a,t),u=f(o);try{for(u.s();!(s=u.n()).done;){var c=s.value;if(Math.abs(c.coord.x-l.x)<=r&&Math.abs(c.coord.y-l.y)<=r&&!n[c.crossTileID]){n[c.crossTileID]=!0,a.crossTileID=c.crossTileID;break}}}catch(h){u.e(h)}finally{u.f()}}}}}}]),t}(),$e=function(){function e(){v(this,e),this.maxCrossTileID=0}return y(e,[{key:"generate",value:function(){return++this.maxCrossTileID}}]),e}(),et=function(){function e(){v(this,e),this.indexes={},this.usedCrossTileIDs={},this.lng=0}return y(e,[{key:"handleWrapJump",value:function(e){var t=Math.round((e-this.lng)/360);if(0!==t)for(var n in this.indexes){var r=this.indexes[n],i={};for(var a in r){var o=r[a];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+t),i[o.tileID.key]=o}this.indexes[n]=i}this.lng=e}},{key:"addBucket",value:function(e,t,n){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(var r=0;r<t.symbolInstances.length;r++)t.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});var i=this.usedCrossTileIDs[e.overscaledZ];for(var a in this.indexes){var o=this.indexes[a];if(Number(a)>e.overscaledZ)for(var s in o){var l=o[s];l.tileID.isChildOf(e)&&l.findMatches(t.symbolInstances,e,i)}else{var u=o[e.scaledTo(Number(a)).key];u&&u.findMatches(t.symbolInstances,e,i)}}for(var c=0;c<t.symbolInstances.length;c++){var h=t.symbolInstances.get(c);h.crossTileID||(h.crossTileID=n.generate(),i[h.crossTileID]=!0)}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Qe(e,t.symbolInstances,t.bucketInstanceId),!0}},{key:"removeBucketCrossTileIDs",value:function(e,t){for(var n in t.indexedSymbolInstances){var r,i=f(t.indexedSymbolInstances[n]);try{for(i.s();!(r=i.n()).done;){var a=r.value;delete this.usedCrossTileIDs[e][a.crossTileID]}}catch(o){i.e(o)}finally{i.f()}}}},{key:"removeStaleBuckets",value:function(e){var t=!1;for(var n in this.indexes){var r=this.indexes[n];for(var i in r)e[r[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,r[i]),delete r[i],t=!0)}return t}}]),e}(),tt=function(){function e(){v(this,e),this.layerIndexes={},this.crossTileIDs=new $e,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}return y(e,[{key:"addLayer",value:function(e,t,n){var r=this.layerIndexes[e.id];void 0===r&&(r=this.layerIndexes[e.id]=new et);var i=!1,a={};r.handleWrapJump(n);var o,s=f(t);try{for(s.s();!(o=s.n()).done;){var l=o.value,u=l.getBucket(e);u&&e.id===u.layerIds[0]&&(u.bucketInstanceId||(u.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(l.tileID,u,this.crossTileIDs)&&(i=!0),a[u.bucketInstanceId]=!0)}}catch(c){s.e(c)}finally{s.f()}return r.removeStaleBuckets(a)&&(i=!0),i}},{key:"pruneUnusedLayers",value:function(e){var t={};for(var n in e.forEach((function(e){t[e]=!0})),this.layerIndexes)t[n]||delete this.layerIndexes[n]}}]),e}(),nt=function(t,n){return e.emitValidationErrors(t,n&&n.filter((function(e){return"source.canvas"!==e.identifier})))},rt=e.pick(ae,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain"]),it=e.pick(ae,["setCenter","setZoom","setBearing","setPitch"]),at=function(){var t={},n=e.styleSpec.$version;for(var r in e.styleSpec.$root){var i=e.styleSpec.$root[r];if(i.required){var a=null;null!=(a="version"===r?n:"array"===i.type?[]:{})&&(t[r]=a)}}return t}(),ot=function(t){p(r,t);var n=m(r);function r(t){var a,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};v(this,r),(a=n.call(this)).map=t,a.dispatcher=new z(ne(),i(a)),a.imageManager=new S,a.imageManager.setEventedParent(i(a)),a.glyphManager=new P(t._requestManager,o.localIdeographFontFamily),a.lineAtlas=new N(256,512),a.crossTileSymbolIndex=new tt,a._layers={},a._num3DLayers=0,a._serializedLayers={},a._order=[],a._sourceCaches={},a._otherSourceCaches={},a._symbolSourceCaches={},a.zoomHistory=new e.ZoomHistory,a._loaded=!1,a._availableImages=[],a._resetUpdates(),a.dispatcher.broadcast("setReferrer",e.getReferrer());var s=i(a);return a._rtlTextPluginCallback=r.registerForPluginStateChange((function(t){s.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},(function(t,n){if(e.triggerPluginCompletionEvent(t),n&&n.every((function(e){return e})))for(var r in s._sourceCaches){var i=s._sourceCaches[r],a=i.getSource().type;"vector"!==a&&"geojson"!==a||i.reload()}}))})),a.on("data",(function(e){if("source"===e.dataType&&"metadata"===e.sourceDataType){var t=a.getSource(e.sourceId);if(t&&t.vectorLayerIds)for(var n in a._layers){var r=a._layers[n];r.source===t.id&&a._validateLayer(r)}}})),a}return y(r,[{key:"loadURL",value:function(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.Event("dataloading",{dataType:"style"}));var i="boolean"==typeof r.validate?r.validate:!e.isMapboxURL(t);t=this.map._requestManager.normalizeStyleURL(t,r.accessToken);var a=this.map._requestManager.transformRequest(t,e.ResourceType.Style);this._request=e.getJSON(a,(function(t,r){n._request=null,t?n.fire(new e.ErrorEvent(t)):r&&n._load(r,i)}))}},{key:"loadJSON",value:function(t){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.Event("dataloading",{dataType:"style"})),this._request=e.browser.frame((function(){n._request=null,n._load(t,!1!==r.validate)}))}},{key:"loadEmpty",value:function(){this.fire(new e.Event("dataloading",{dataType:"style"})),this._load(at,!1)}},{key:"_load",value:function(t,n){if(!n||!nt(this,e.validateStyle(t))){for(var r in this._loaded=!0,this.stylesheet=t,t.sources)this.addSource(r,t.sources[r],{validate:!1});this._changed=!1,t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);var i=ie(this.stylesheet.layers);this._order=i.map((function(e){return e.id})),this._layers={},this._serializedLayers={};var a,o=f(i);try{for(o.s();!(a=o.n()).done;){var s=a.value;(s=e.createStyleLayer(s)).setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=s,this._serializedLayers[s.id]=s.serialize(),s.is3D()&&this._num3DLayers++}}catch(l){o.e(l)}finally{o.f()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new L(this.stylesheet.light),this.stylesheet.terrain&&this._createTerrain(this.stylesheet.terrain),this.fire(new e.Event("data",{dataType:"style"})),this.fire(new e.Event("style.load"))}}},{key:"_loadSprite",value:function(t){var n=this;this._spriteRequest=function(t,n,r){var i,a,o,s=e.browser.devicePixelRatio>1?"@2x":"",l=e.getJSON(n.transformRequest(n.normalizeSpriteURL(t,s,".json"),e.ResourceType.SpriteJSON),(function(e,t){l=null,o||(o=e,i=t,c())})),u=e.getImage(n.transformRequest(n.normalizeSpriteURL(t,s,".png"),e.ResourceType.SpriteImage),(function(e,t){u=null,o||(o=e,a=t,c())}));function c(){if(o)r(o);else if(i&&a){var t=e.browser.getImageData(a),n={};for(var s in i){var l=i[s],u=l.width,c=l.height,h=l.x,f=l.y,d=l.sdf,p=l.pixelRatio,m=l.stretchX,v=l.stretchY,y=l.content,g=new e.RGBAImage({width:u,height:c});e.RGBAImage.copy(t,g,{x:h,y:f},{x:0,y:0},{width:u,height:c}),n[s]={data:g,pixelRatio:p,sdf:d,stretchX:m,stretchY:v,content:y}}r(null,n)}}return{cancel:function(){l&&(l.cancel(),l=null),u&&(u.cancel(),u=null)}}}(t,this.map._requestManager,(function(t,r){if(n._spriteRequest=null,t)n.fire(new e.ErrorEvent(t));else if(r)for(var i in r)n.imageManager.addImage(i,r[i]);n.imageManager.setLoaded(!0),n._availableImages=n.imageManager.listImages(),n.dispatcher.broadcast("setImages",n._availableImages),n.fire(new e.Event("data",{dataType:"style"}))}))}},{key:"_validateLayer",value:function(t){var n=this.getSource(t.source);if(n){var r=t.sourceLayer;r&&("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(r))&&this.fire(new e.ErrorEvent(new Error('Source layer "'.concat(r,'" ')+'does not exist on source "'.concat(n.id,'" ')+'as specified by style layer "'.concat(t.id,'"'))))}}},{key:"loaded",value:function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}},{key:"_serializeLayers",value:function(e){var t,n=[],r=f(e);try{for(r.s();!(t=r.n()).done;){var i=t.value,a=this._layers[i];"custom"!==a.type&&n.push(a.serialize())}}catch(o){r.e(o)}finally{r.f()}return n}},{key:"hasTransitions",value:function(){if(this.light&&this.light.hasTransition())return!0;for(var e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(var t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}},{key:"_checkLoaded",value:function(){if(!this._loaded)throw new Error("Style is not done loading")}},{key:"update",value:function(t){if(this._loaded){var n=this._changed;if(this._changed){var r=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);for(var a in(r.length||i.length)&&this._updateWorkerLayers(r,i),this._updatedSources){var o=this._updatedSources[a];"reload"===o?this._reloadSource(a):"clear"===o&&this._clearSource(a)}for(var s in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[s].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}var l={};for(var u in this._sourceCaches){var c=this._sourceCaches[u];l[u]=c.used,c.used=!1}var h,d=f(this._order);try{for(d.s();!(h=d.n()).done;){var p=h.value,m=this._layers[p];if(m.recalculate(t,this._availableImages),!m.isHidden(t.zoom)){var v=this._getLayerSourceCache(m);v&&(v.used=!0)}var y=this.map.painter;if(y){var g=m.getProgramIds();if(!g)continue;var _,b=m.getProgramConfiguration(t.zoom),x=f(g);try{for(x.s();!(_=x.n()).done;){var w=_.value;y.useProgram(w,b)}}catch(T){x.e(T)}finally{x.f()}}}}catch(T){d.e(T)}finally{d.f()}for(var E in l){var S=this._sourceCaches[E];l[E]!==S.used&&S.getSource().fire(new e.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:S.getSource().id}))}this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.z=t.zoom,n&&this.fire(new e.Event("data",{dataType:"style"}))}}},{key:"_updateTilesForChangedImages",value:function(){var e=Object.keys(this._changedImages);if(e.length){for(var t in this._sourceCaches)this._sourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}},{key:"_updateWorkerLayers",value:function(e,t){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(e),removedIds:t})}},{key:"_resetUpdates",value:function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}},{key:"setState",value:function(t){var n=this;if(this._checkLoaded(),nt(this,e.validateStyle(t)))return!1;(t=e.clone$1(t)).layers=ie(t.layers);var r=function(t,n){if(!t)return[{command:ae.setStyle,args:[n]}];var r=[];try{if(!e.deepEqual(t.version,n.version))return[{command:ae.setStyle,args:[n]}];e.deepEqual(t.center,n.center)||r.push({command:ae.setCenter,args:[n.center]}),e.deepEqual(t.zoom,n.zoom)||r.push({command:ae.setZoom,args:[n.zoom]}),e.deepEqual(t.bearing,n.bearing)||r.push({command:ae.setBearing,args:[n.bearing]}),e.deepEqual(t.pitch,n.pitch)||r.push({command:ae.setPitch,args:[n.pitch]}),e.deepEqual(t.sprite,n.sprite)||r.push({command:ae.setSprite,args:[n.sprite]}),e.deepEqual(t.glyphs,n.glyphs)||r.push({command:ae.setGlyphs,args:[n.glyphs]}),e.deepEqual(t.transition,n.transition)||r.push({command:ae.setTransition,args:[n.transition]}),e.deepEqual(t.light,n.light)||r.push({command:ae.setLight,args:[n.light]});var i={},a=[];!function(t,n,r,i){var a;for(a in n=n||{},t=t||{})t.hasOwnProperty(a)&&(n.hasOwnProperty(a)||se(a,r,i));for(a in n)n.hasOwnProperty(a)&&(t.hasOwnProperty(a)?e.deepEqual(t[a],n[a])||("geojson"===t[a].type&&"geojson"===n[a].type&&ue(t,n,a)?r.push({command:ae.setGeoJSONSourceData,args:[a,n[a].data]}):le(a,n,r,i)):oe(a,n,r))}(t.sources,n.sources,a,i);var o=[];t.layers&&t.layers.forEach((function(e){i[e.source]?r.push({command:ae.removeLayer,args:[e.id]}):o.push(e)}));var s=t.terrain;s&&i[s.source]&&(r.push({command:ae.setTerrain,args:[void 0]}),s=void 0),r=r.concat(a),e.deepEqual(s,n.terrain)||r.push({command:ae.setTerrain,args:[n.terrain]}),function(t,n,r){n=n||[];var i,a,o,s,l,u,c,h=(t=t||[]).map(he),f=n.map(he),d=t.reduce(fe,{}),p=n.reduce(fe,{}),m=h.slice(),v=Object.create(null);for(i=0,a=0;i<h.length;i++)o=h[i],p.hasOwnProperty(o)?a++:(r.push({command:ae.removeLayer,args:[o]}),m.splice(m.indexOf(o,a),1));for(i=0,a=0;i<f.length;i++)o=f[f.length-1-i],m[m.length-1-i]!==o&&(d.hasOwnProperty(o)?(r.push({command:ae.removeLayer,args:[o]}),m.splice(m.lastIndexOf(o,m.length-a),1)):a++,u=m[m.length-i],r.push({command:ae.addLayer,args:[p[o],u]}),m.splice(m.length-i,0,o),v[o]=!0);for(i=0;i<f.length;i++)if(s=d[o=f[i]],l=p[o],!v[o]&&!e.deepEqual(s,l))if(e.deepEqual(s.source,l.source)&&e.deepEqual(s["source-layer"],l["source-layer"])&&e.deepEqual(s.type,l.type)){for(c in ce(s.layout,l.layout,r,o,null,ae.setLayoutProperty),ce(s.paint,l.paint,r,o,null,ae.setPaintProperty),e.deepEqual(s.filter,l.filter)||r.push({command:ae.setFilter,args:[o,l.filter]}),e.deepEqual(s.minzoom,l.minzoom)&&e.deepEqual(s.maxzoom,l.maxzoom)||r.push({command:ae.setLayerZoomRange,args:[o,l.minzoom,l.maxzoom]}),s)s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?ce(s[c],l[c],r,o,c.slice(6),ae.setPaintProperty):e.deepEqual(s[c],l[c])||r.push({command:ae.setLayerProperty,args:[o,c,l[c]]}));for(c in l)l.hasOwnProperty(c)&&!s.hasOwnProperty(c)&&"layout"!==c&&"paint"!==c&&"filter"!==c&&"metadata"!==c&&"minzoom"!==c&&"maxzoom"!==c&&(0===c.indexOf("paint.")?ce(s[c],l[c],r,o,c.slice(6),ae.setPaintProperty):e.deepEqual(s[c],l[c])||r.push({command:ae.setLayerProperty,args:[o,c,l[c]]}))}else r.push({command:ae.removeLayer,args:[o]}),u=m[m.lastIndexOf(o)+1],r.push({command:ae.addLayer,args:[l,u]})}(o,n.layers,r)}catch(e){console.warn("Unable to compute style diff:",e),r=[{command:ae.setStyle,args:[n]}]}return r}(this.serialize(),t).filter((function(e){return!(e.command in it)}));if(0===r.length)return!1;var i=r.filter((function(e){return!(e.command in rt)}));if(i.length>0)throw new Error("Unimplemented: ".concat(i.map((function(e){return e.command})).join(", "),"."));return r.forEach((function(e){"setTransition"!==e.command&&n[e.command].apply(n,e.args)})),this.stylesheet=t,!0}},{key:"addImage",value:function(t,n){if(this.getImage(t))return this.fire(new e.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(t,n),this._afterImageUpdated(t)}},{key:"updateImage",value:function(e,t){this.imageManager.updateImage(e,t)}},{key:"getImage",value:function(e){return this.imageManager.getImage(e)}},{key:"removeImage",value:function(t){if(!this.getImage(t))return this.fire(new e.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(t),this._afterImageUpdated(t)}},{key:"_afterImageUpdated",value:function(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new e.Event("data",{dataType:"style"}))}},{key:"listImages",value:function(){return this._checkLoaded(),this.imageManager.listImages()}},{key:"addSource",value:function(t,n){var r=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._checkLoaded(),void 0!==this.getSource(t))throw new Error("There is already a source with this ID");if(!n.type)throw new Error("The type property must be defined, but only the following properties were given: ".concat(Object.keys(n).join(", "),"."));if(!(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(e.validateStyle.source,"sources.".concat(t),n,null,i))){this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);var a=X(t,n,this.dispatcher,this);a.setEventedParent(this,(function(){return{isSourceLoaded:r.loaded(),source:a.serialize(),sourceId:t}}));var o=function(n){var i=(n?"symbol:":"other:")+t,o=r._sourceCaches[i]=new e.SourceCache(i,a,n);(n?r._symbolSourceCaches:r._otherSourceCaches)[t]=o,o.style=r,o.onAdd(r.map)};o(!1),"vector"!==n.type&&"geojson"!==n.type||o(!0),a.onAdd&&a.onAdd(this.map),this._changed=!0}}},{key:"removeSource",value:function(t){this._checkLoaded();var n=this.getSource(t);if(void 0===n)throw new Error("There is no source with this ID");for(var r in this._layers)if(this._layers[r].source===t)return this.fire(new e.ErrorEvent(new Error('Source "'.concat(t,'" cannot be removed while layer "').concat(r,'" is using it.'))));if(this.terrain&&this.terrain.get().source===t)return this.fire(new e.ErrorEvent(new Error('Source "'.concat(t,'" cannot be removed while terrain is using it.'))));var i,a=this._getSourceCaches(t),o=f(a);try{for(o.s();!(i=o.n()).done;){var s=i.value;delete this._sourceCaches[s.id],delete this._updatedSources[s.id],s.fire(new e.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:s.getSource().id})),s.setEventedParent(null),s.clearTiles()}}catch(l){o.e(l)}finally{o.f()}delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changed=!0}},{key:"setGeoJSONSourceData",value:function(e,t){this._checkLoaded(),this.getSource(e).setData(t),this._changed=!0}},{key:"getSource",value:function(e){var t=this._getSourceCache(e);return t&&t.getSource()}},{key:"addLayer",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();var i=t.id;if(this.getLayer(i))this.fire(new e.ErrorEvent(new Error('Layer with id "'.concat(i,'" already exists on this map'))));else{var a;if("custom"===t.type){if(nt(this,e.validateCustomStyleLayer(t)))return;a=e.createStyleLayer(t)}else{if("object"==typeof t.source&&(this.addSource(i,t.source),t=e.clone$1(t),t=e.extend(t,{source:i})),this._validate(e.validateStyle.layer,"layers.".concat(i),t,{arrayIndex:-1},r))return;a=e.createStyleLayer(t),this._validateLayer(a),a.setEventedParent(this,{layer:{id:i}}),this._serializedLayers[a.id]=a.serialize(),a.is3D()&&this._num3DLayers++}var o=n?this._order.indexOf(n):this._order.length;if(n&&-1===o)this.fire(new e.ErrorEvent(new Error('Layer with id "'.concat(n,'" does not exist on this map.'))));else{this._order.splice(o,0,i),this._layerOrderChanged=!0,this._layers[i]=a;var s=this._getLayerSourceCache(a);if(this._removedLayers[i]&&a.source&&s&&"custom"!==a.type){var l=this._removedLayers[i];delete this._removedLayers[i],l.type!==a.type?this._updatedSources[a.source]="clear":(this._updatedSources[a.source]="reload",s.pause())}this._updateLayer(a),a.onAdd&&a.onAdd(this.map)}}}},{key:"moveLayer",value:function(t,n){if(this._checkLoaded(),this._changed=!0,this._layers[t]){if(t!==n){var r=this._order.indexOf(t);this._order.splice(r,1);var i=n?this._order.indexOf(n):this._order.length;n&&-1===i?this.fire(new e.ErrorEvent(new Error('Layer with id "'.concat(n,'" does not exist on this map.')))):(this._order.splice(i,0,t),this._layerOrderChanged=!0)}}else this.fire(new e.ErrorEvent(new Error("The layer '".concat(t,"' does not exist in the map's style and cannot be moved."))))}},{key:"removeLayer",value:function(t){this._checkLoaded();var n=this._layers[t];if(n){n.setEventedParent(null),n.is3D()&&this._num3DLayers--;var r=this._order.indexOf(t);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=n,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],n.onRemove&&n.onRemove(this.map)}else this.fire(new e.ErrorEvent(new Error("The layer '".concat(t,"' does not exist in the map's style and cannot be removed."))))}},{key:"getLayer",value:function(e){return this._layers[e]}},{key:"hasLayer",value:function(e){return e in this._layers}},{key:"setLayerZoomRange",value:function(t,n,r){this._checkLoaded();var i=this.getLayer(t);i?i.minzoom===n&&i.maxzoom===r||(null!=n&&(i.minzoom=n),null!=r&&(i.maxzoom=r),this._updateLayer(i)):this.fire(new e.ErrorEvent(new Error("The layer '".concat(t,"' does not exist in the map's style and cannot have zoom extent."))))}},{key:"setFilter",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();var i=this.getLayer(t);if(i){if(!e.deepEqual(i.filter,n))return null==n?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(e.validateStyle.filter,"layers.".concat(i.id,".filter"),n,null,r)||(i.filter=e.clone$1(n),this._updateLayer(i)))}else this.fire(new e.ErrorEvent(new Error("The layer '".concat(t,"' does not exist in the map's style and cannot be filtered."))))}},{key:"getFilter",value:function(t){return e.clone$1(this.getLayer(t).filter)}},{key:"setLayoutProperty",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();var a=this.getLayer(t);a?e.deepEqual(a.getLayoutProperty(n),r)||(a.setLayoutProperty(n,r,i),this._updateLayer(a)):this.fire(new e.ErrorEvent(new Error("The layer '".concat(t,"' does not exist in the map's style and cannot be styled."))))}},{key:"getLayoutProperty",value:function(t,n){var r=this.getLayer(t);if(r)return r.getLayoutProperty(n);this.fire(new e.ErrorEvent(new Error("The layer '".concat(t,"' does not exist in the map's style."))))}},{key:"setPaintProperty",value:function(t,n,r){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();var a=this.getLayer(t);a?e.deepEqual(a.getPaintProperty(n),r)||(a.setPaintProperty(n,r,i)&&this._updateLayer(a),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new e.ErrorEvent(new Error("The layer '".concat(t,"' does not exist in the map's style and cannot be styled."))))}},{key:"getPaintProperty",value:function(e,t){return this.getLayer(e).getPaintProperty(t)}},{key:"setFeatureState",value:function(t,n){this._checkLoaded();var r=t.source,i=t.sourceLayer,a=this.getSource(r);if(void 0!==a){var o=a.type;if("geojson"===o&&i)this.fire(new e.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));else if("vector"!==o||i){void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided.")));var s,l=this._getSourceCaches(r),u=f(l);try{for(u.s();!(s=u.n()).done;)s.value.setFeatureState(i,t.id,n)}catch(c){u.e(c)}finally{u.f()}}else this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error("The source '".concat(r,"' does not exist in the map's style."))))}},{key:"removeFeatureState",value:function(t,n){this._checkLoaded();var r=t.source,i=this.getSource(r);if(void 0!==i){var a=i.type,o="vector"===a?t.sourceLayer:void 0;if("vector"!==a||o)if(n&&"string"!=typeof t.id&&"number"!=typeof t.id)this.fire(new e.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));else{var s,l=this._getSourceCaches(r),u=f(l);try{for(u.s();!(s=u.n()).done;)s.value.removeFeatureState(o,t.id,n)}catch(c){u.e(c)}finally{u.f()}}else this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error("The source '".concat(r,"' does not exist in the map's style."))))}},{key:"getFeatureState",value:function(t){this._checkLoaded();var n=t.source,r=t.sourceLayer,i=this.getSource(n);if(void 0!==i){if("vector"!==i.type||r)return void 0===t.id&&this.fire(new e.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(n)[0].getFeatureState(r,t.id);this.fire(new e.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new e.ErrorEvent(new Error("The source '".concat(n,"' does not exist in the map's style."))))}},{key:"getTransition",value:function(){return e.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}},{key:"serialize",value:function(){var t={};for(var n in this._sourceCaches){var r=this._sourceCaches[n].getSource();t[r.id]||(t[r.id]=r.serialize())}return e.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t,layers:this._serializeLayers(this._order)},(function(e){return void 0!==e}))}},{key:"_updateLayer",value:function(e){this._updatedLayers[e.id]=!0;var t=this._getLayerSourceCache(e);e.source&&!this._updatedSources[e.source]&&t&&"raster"!==t.getSource().type&&(this._updatedSources[e.source]="reload",t.pause()),this._changed=!0}},{key:"_flattenAndSortRenderedFeatures",value:function(e){for(var t=this,n=function(e){return"fill-extrusion"===t._layers[e].type},r={},i=[],a=this._order.length-1;a>=0;a--){var o=this._order[a];if(n(o)){r[o]=a;var s,l=f(e);try{for(l.s();!(s=l.n()).done;){var u=s.value[o];if(u){var c,h=f(u);try{for(h.s();!(c=h.n()).done;){var d=c.value;i.push(d)}}catch(T){h.e(T)}finally{h.f()}}}}catch(T){l.e(T)}finally{l.f()}}}i.sort((function(e,t){return t.intersectionZ-e.intersectionZ}));for(var p=[],m=this._order.length-1;m>=0;m--){var v=this._order[m];if(n(v))for(var y=i.length-1;y>=0;y--){var g=i[y].feature;if(r[g.layer.id]<m)break;p.push(g),i.pop()}else{var _,b=f(e);try{for(b.s();!(_=b.n()).done;){var x=_.value[v];if(x){var w,E=f(x);try{for(E.s();!(w=E.n()).done;){var S=w.value;p.push(S.feature)}}catch(T){E.e(T)}finally{E.f()}}}}catch(T){b.e(T)}finally{b.f()}}}return p}},{key:"queryRenderedFeatures",value:function(t,n,r){var i=this;n&&n.filter&&this._validate(e.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);var a={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new e.ErrorEvent(new Error("parameters.layers must be an Array."))),[];var o,s=f(n.layers);try{for(s.s();!(o=s.n()).done;){var l=o.value,u=this._layers[l];if(!u)return this.fire(new e.ErrorEvent(new Error("The layer '".concat(l,"' does not exist in the map's style and cannot be queried for features.")))),[];a[u.source]=!0}}catch(v){s.e(v)}finally{s.f()}}var c=[];n.availableImages=this._availableImages;var h=n&&n.layers?n.layers.some((function(e){var t=i.getLayer(e);return t&&t.is3D()})):this.has3DLayers(),d=B.createFromScreenPoints(t,r);for(var p in this._sourceCaches){var m=this._sourceCaches[p].getSource().id;n.layers&&!a[m]||c.push(K(this._sourceCaches[p],this._layers,this._serializedLayers,d,n,r,h,!!this.map._showQueryGeometry))}return this.placement&&c.push(function(e,t,n,r,i,a,o){var s,l={},u=a.queryRenderedSymbols(r),c=[],h=f(Object.keys(u).map(Number));try{for(h.s();!(s=h.n()).done;){var d=s.value;c.push(o[d])}}catch(v){h.e(v)}finally{h.f()}c.sort(J);for(var p=function(){var n=y[m],r=n.featureIndex.lookupSymbolFeatures(u[n.bucketInstanceId],t,n.bucketIndex,n.sourceLayerIndex,i.filter,i.layers,i.availableImages,e);for(var a in r){var o=l[a]=l[a]||[],s=r[a];s.sort((function(e,t){var r=n.featureSortOrder;if(r){var i=r.indexOf(e.featureIndex);return r.indexOf(t.featureIndex)-i}return t.featureIndex-e.featureIndex}));var c,h=f(s);try{for(h.s();!(c=h.n()).done;){var d=c.value;o.push(d)}}catch(v){h.e(v)}finally{h.f()}}},m=0,y=c;m<y.length;m++)p();var g=function(t){l[t].forEach((function(r){var i=r.feature,a=n(e[t]).getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=a}))};for(var _ in l)g(_);return l}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),d.screenGeometry,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(c)}},{key:"querySourceFeatures",value:function(t,n){n&&n.filter&&this._validate(e.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);var r,i=this._getSourceCaches(t),a=[],o=f(i);try{for(o.s();!(r=o.n()).done;){var s=r.value;a=a.concat(Y(s,n))}}catch(l){o.e(l)}finally{o.f()}return a}},{key:"addSourceType",value:function(e,t,n){return r.getSourceType(e)?n(new Error('A source type called "'.concat(e,'" already exists.'))):(r.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},n):n(null,null))}},{key:"getLight",value:function(){return this.light.getLight()}},{key:"setLight",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this._checkLoaded();var r=this.light.getLight(),i=!1;for(var a in t)if(!e.deepEqual(t[a],r[a])){i=!0;break}if(i){var o={now:e.browser.now(),transition:e.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,n),this.light.updateTransitions(o)}}},{key:"setTerrain",value:function(t){if(this._checkLoaded(),!t)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),void this._force3DLayerUpdate();if("object"==typeof t.source){var n="terrain-dem-src";this.addSource(n,t.source),t=e.clone$1(t),t=e.extend(t,{source:n})}if(!this._validate(e.validateStyle.terrain,"terrain",t))if(this.terrain){var r=this.terrain,i=r.get();for(var a in t)if(!e.deepEqual(t[a],i[a])){r.set(t),this.stylesheet.terrain=t;var o={now:e.browser.now(),transition:e.extend({duration:0},this.stylesheet.transition)};r.updateTransitions(o);break}}else this._createTerrain(t)}},{key:"_createTerrain",value:function(t){var n=this.terrain=new D(t);this.stylesheet.terrain=t,this.dispatcher.broadcast("enableTerrain",!0),this._force3DLayerUpdate();var r={now:e.browser.now(),transition:e.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(r)}},{key:"_force3DLayerUpdate",value:function(){for(var e in this._layers){var t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}},{key:"_validate",value:function(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return(!a||!1!==a.validate)&&nt(this,t.call(e.validateStyle,e.extend({key:n,style:this.serialize(),value:r,styleSpec:e.styleSpec},i)))}},{key:"_remove",value:function(){for(var t in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[t].setEventedParent(null);for(var n in this._sourceCaches)this._sourceCaches[n].clearTiles(),this._sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}},{key:"_clearSource",value:function(e){var t,n=this._getSourceCaches(e),r=f(n);try{for(r.s();!(t=r.n()).done;)t.value.clearTiles()}catch(i){r.e(i)}finally{r.f()}}},{key:"_reloadSource",value:function(e){var t,n=this._getSourceCaches(e),r=f(n);try{for(r.s();!(t=r.n()).done;){var i=t.value;i.resume(),i.reload()}}catch(a){r.e(a)}finally{r.f()}}},{key:"_updateSources",value:function(e){for(var t in this._sourceCaches)this._sourceCaches[t].update(e)}},{key:"_generateCollisionBoxes",value:function(){for(var e in this._sourceCaches){var t=this._sourceCaches[e];t.resume(),t.reload()}}},{key:"_updatePlacement",value:function(t,n,r,i){var a,o=this,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=!1,u=!1,c={},h=f(this._order);try{for(h.s();!(a=h.n()).done;){var d=a.value,p=this._layers[d];if("symbol"===p.type){if(!c[p.source]&&"continue"===function(){var e=o._getLayerSourceCache(p);if(!e)return"continue";c[p.source]=e.getRenderableIds(!0).map((function(t){return e.getTileByID(t)})).sort((function(e,t){return t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1)}))}())continue;var m=this.crossTileSymbolIndex.addLayer(p,c[p.source],t.center.lng);l=l||m}}}catch(b){h.e(b)}finally{h.f()}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((s=s||this._layerOrderChanged||0===r)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.browser.now(),t.zoom))&&(this.pauseablePlacement=new Ye(t,this._order,s,n,r,i,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,c),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.browser.now()),u=!0),l&&this.pauseablePlacement.placement.setStale()),u||l){var v,y=f(this._order);try{for(y.s();!(v=y.n()).done;){var g=v.value,_=this._layers[g];"symbol"===_.type&&this.placement.updateLayerOpacities(_,c[_.source])}}catch(b){y.e(b)}finally{y.f()}}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.browser.now())}},{key:"_releaseSymbolFadeTiles",value:function(){for(var e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}},{key:"getImages",value:function(e,t,n){this.imageManager.getImages(t.icons,n),this._updateTilesForChangedImages();var r=function(e){e&&e.setDependencies(t.tileID.key,t.type,t.icons)};r(this._otherSourceCaches[t.source]),r(this._symbolSourceCaches[t.source])}},{key:"getGlyphs",value:function(e,t,n){this.glyphManager.getGlyphs(t.stacks,n)}},{key:"getResource",value:function(t,n,r){return e.makeRequest(n,r)}},{key:"_getSourceCache",value:function(e){return this._otherSourceCaches[e]}},{key:"_getLayerSourceCache",value:function(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}},{key:"_getSourceCaches",value:function(e){var t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}},{key:"has3DLayers",value:function(){return this._num3DLayers>0}}]),r}(e.Evented);ot.getSourceType=function(e){return q[e]},ot.setSourceType=function(e,t){q[e]=t},ot.registerForPluginStateChange=e.registerForPluginStateChange;var st="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",lt={};lt=Ut("","#ifdef TERRAIN\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;uniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));float tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}float prevElevation(vec2 apos) {float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {vec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*word/7.3;}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0);var ut=Ut("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nconst float PI=3.141592653589793;","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const float PI=3.141592653589793;const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ct=Ut("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),ht=Ut("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),ft=Ut("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);vec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),dt=Ut("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),pt=Ut("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}"),mt=Ut("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),vt=Ut("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=u_matrix*vec4(a_pos,elevation(a_pos),1.0);gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),yt=Ut("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),gt=Ut("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);}"),_t=Ut("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),bt=Ut("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),xt=Ut("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),wt=Ut("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),Et=Ut("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;\n#ifdef TERRAIN\nvec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);gl_Position=mix(u_matrix*vec4(pos_nx.xy,h,1),AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(pos_nx.xy,t > 0.0 ? height : base,1);\n#endif\nfloat colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),St=Ut("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;\n#ifdef TERRAIN\nvec2 centroid_pos=a_centroid_pos;bool flat_roof=centroid_pos.x !=0.0;float ele=elevation(pos_nx.xy);float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);gl_Position=mix(u_matrix*vec4(pos_nx.xy,h,1),AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(pos_nx.xy,z,1);\n#endif\nvec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),Tt=Ut("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),kt=Ut("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Mt=Ut("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_width2=vec2(outset,inset);}"),Ct=Ut("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_width2=vec2(outset,inset);}"),At=Ut("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),It=Ut("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),Pt=Ut("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Rt=Ut("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));}"),Lt=Ut("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),Ot=Ut("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float h=elevation(a_pos);vec4 projectedPoint=u_matrix*vec4(a_pos,h,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),h,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h,1.0);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projectedPoint);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projectedPoint.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}"),Dt=Ut("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;const float skirtOffset=24575.0;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;vec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);}"),Nt=Ut("#ifdef GL_ES\nprecision highp float;\n#endif\nvec4 pack_depth(float ndc_z) {float depth=ndc_z*0.5+0.5;const vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}varying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),zt=Ut("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(vec3(p.xyx)*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract(vec3((p3.x+p3.y)*p3.z,(p3.x+p3.z)*p3.y,(p3.y+p3.z)*p3.x));}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;color.rgb+=rnd/255.0;return color;}float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",st),Ft=Ut("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform lowp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(vec3(p.xyx)*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract(vec3((p3.x+p3.y)*p3.z,(p3.x+p3.z)*p3.y,(p3.y+p3.z)*p3.x));}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;color.rgb+=rnd/255.0;return color;}void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5))*u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",st),Bt=Ut("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}");function Ut(e,t,n){var r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,i=t.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),a=e.match(/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=t.match(/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g),s=o?o.concat(a):a;n||(s=lt.staticUniforms.concat(s));var l={};return{fragmentSource:e=e.replace(r,(function(e,t,n,r,i){return l[i]=!0,"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(i,"\nvarying ").concat(n," ").concat(r," ").concat(i,";\n#else\nuniform ").concat(n," ").concat(r," u_").concat(i,";\n#endif\n"):"\n#ifdef HAS_UNIFORM_u_".concat(i,"\n    ").concat(n," ").concat(r," ").concat(i," = u_").concat(i,";\n#endif\n")})),vertexSource:t=t.replace(r,(function(e,t,n,r,i){var a="float"===r?"vec2":"vec4",o=i.match(/color/)?"color":a;return l[i]?"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(i,"\nuniform lowp float u_").concat(i,"_t;\nattribute ").concat(n," ").concat(a," a_").concat(i,";\nvarying ").concat(n," ").concat(r," ").concat(i,";\n#else\nuniform ").concat(n," ").concat(r," u_").concat(i,";\n#endif\n"):"vec4"===o?"\n#ifndef HAS_UNIFORM_u_".concat(i,"\n    ").concat(i," = a_").concat(i,";\n#else\n    ").concat(n," ").concat(r," ").concat(i," = u_").concat(i,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(i,"\n    ").concat(i," = unpack_mix_").concat(o,"(a_").concat(i,", u_").concat(i,"_t);\n#else\n    ").concat(n," ").concat(r," ").concat(i," = u_").concat(i,";\n#endif\n"):"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(i,"\nuniform lowp float u_").concat(i,"_t;\nattribute ").concat(n," ").concat(a," a_").concat(i,";\n#else\nuniform ").concat(n," ").concat(r," u_").concat(i,";\n#endif\n"):"vec4"===o?"\n#ifndef HAS_UNIFORM_u_".concat(i,"\n    ").concat(n," ").concat(r," ").concat(i," = a_").concat(i,";\n#else\n    ").concat(n," ").concat(r," ").concat(i," = u_").concat(i,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(i,"\n    ").concat(n," ").concat(r," ").concat(i," = unpack_mix_").concat(o,"(a_").concat(i,", u_").concat(i,"_t);\n#else\n    ").concat(n," ").concat(r," ").concat(i," = u_").concat(i,";\n#endif\n")})),staticAttributes:i,staticUniforms:s}}var jt=Object.freeze({__proto__:null,get preludeTerrain(){return lt},prelude:ut,background:ct,backgroundPattern:ht,circle:ft,clippingMask:dt,heatmap:pt,heatmapTexture:mt,collisionBox:vt,collisionCircle:yt,debug:gt,fill:_t,fillOutline:bt,fillOutlinePattern:xt,fillPattern:wt,fillExtrusion:Et,fillExtrusionPattern:St,hillshadePrepare:Tt,hillshade:kt,line:Mt,lineGradient:Ct,linePattern:At,lineSDF:It,raster:Pt,symbolIcon:Rt,symbolSDF:Lt,symbolTextAndIcon:Ot,terrainRaster:Dt,terrainDepth:Nt,skybox:zt,skyboxGradient:Ft,skyboxCapture:Bt}),Vt=function(){function e(){v(this,e),this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}return y(e,[{key:"bind",value:function(e,t,n,r,i,a,o,s){this.context=e;for(var l=this.boundPaintVertexBuffers.length!==r.length,u=0;!l&&u<r.length;u++)this.boundPaintVertexBuffers[u]!==r[u]&&(l=!0);e.extVertexArrayObject&&this.vao&&this.boundProgram===t&&this.boundLayoutVertexBuffer===n&&!l&&this.boundIndexBuffer===i&&this.boundVertexOffset===a&&this.boundDynamicVertexBuffer===o&&this.boundDynamicVertexBuffer2===s?(e.bindVertexArrayOES.set(this.vao),o&&o.bind(),i&&i.dynamicDraw&&i.bind(),s&&s.bind()):this.freshBind(t,n,r,i,a,o,s)}},{key:"freshBind",value:function(e,t,n,r,i,a,o){var s,l=e.numAttributes,u=this.context,c=u.gl;if(u.extVertexArrayObject)this.vao&&this.destroy(),this.vao=u.extVertexArrayObject.createVertexArrayOES(),u.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=r,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=a,this.boundDynamicVertexBuffer2=o;else{s=u.currentNumAttributes||0;for(var h=l;h<s;h++)c.disableVertexAttribArray(h)}t.enableAttributes(c,e);var d,p=f(n);try{for(p.s();!(d=p.n()).done;)d.value.enableAttributes(c,e)}catch(g){p.e(g)}finally{p.f()}a&&a.enableAttributes(c,e),o&&o.enableAttributes(c,e),t.bind(),t.setVertexAttribPointers(c,e,i);var m,v=f(n);try{for(v.s();!(m=v.n()).done;){var y=m.value;y.bind(),y.setVertexAttribPointers(c,e,i)}}catch(g){v.e(g)}finally{v.f()}a&&(a.bind(),a.setVertexAttribPointers(c,e,i)),r&&r.bind(),o&&(o.bind(),o.setVertexAttribPointers(c,e,i)),u.currentNumAttributes=l}},{key:"destroy",value:function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}]),e}();function Ht(t,n){var r=Math.pow(2,n.canonical.z),i=n.canonical.y;return[new e.MercatorCoordinate(0,i/r).toLngLat().lat,new e.MercatorCoordinate(0,(i+1)/r).toLngLat().lat]}function Gt(t,n,r,i,a,o,s){var l=t.context,u=l.gl,c=r.fbo;if(c){t.prepareDrawTile(n);var h=t.useProgram("hillshade");l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,c.colorAttachment.get());var f=function(e,t,n,r){var i=n.paint.get("hillshade-shadow-color"),a=n.paint.get("hillshade-highlight-color"),o=n.paint.get("hillshade-accent-color"),s=n.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===n.paint.get("hillshade-illumination-anchor")&&(s-=e.transform.angle);var l=!e.options.moving;return{u_matrix:r||e.transform.calculatePosMatrix(t.tileID.toUnwrapped(),l),u_image:0,u_latrange:Ht(0,t.tileID),u_light:[n.paint.get("hillshade-exaggeration"),s],u_shadow:i,u_highlight:a,u_accent:o}}(t,r,i,t.terrain?n.posMatrix:null);h.draw(l,u.TRIANGLES,a,o,s,e.CullFaceMode.disabled,f,i.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}}function Wt(t,n,r){if(n.needsDEMTextureUpload){var i=t.context,a=i.gl;i.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||t.getTileTexture(r.stride);var o=r.getPixels();n.demTexture?n.demTexture.update(o,{premultiply:!1}):n.demTexture=new e.Texture(i,o,a.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}}function qt(t,n,r,i,a,o){var s=t.context,l=s.gl;if(n.dem){var u=n.dem;if(s.activeTexture.set(l.TEXTURE1),Wt(t,n,u),n.demTexture){n.demTexture.bind(l.NEAREST,l.CLAMP_TO_EDGE);var c=u.dim;s.activeTexture.set(l.TEXTURE0);var h=n.fbo;if(!h){var f=new e.Texture(s,{width:c,height:c,data:null},l.RGBA);f.bind(l.LINEAR,l.CLAMP_TO_EDGE),(h=n.fbo=s.createFramebuffer(c,c,!0)).colorAttachment.set(f.texture)}s.bindFramebuffer.set(h.framebuffer),s.viewport.set([0,0,c,c]),t.useProgram("hillshadePrepare").draw(s,l.TRIANGLES,i,a,o,e.CullFaceMode.disabled,function(t,n){var r=n.stride,i=e.create();return e.ortho(i,0,e.EXTENT,-e.EXTENT,0,0,1),e.translate(i,i,[0,-e.EXTENT,0]),{u_matrix:i,u_image:1,u_dimension:[r,r],u_zoom:t.overscaledZ,u_unpack:n.unpackVector}}(n.tileID,u),r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments),n.needsHillshadePrepare=!1}}}var Xt=function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_image0:new e.Uniform1i(t,n.u_image0),u_skirt_height:new e.Uniform1f(t,n.u_skirt_height)}},Zt=function(e,t){return{u_matrix:e,u_image0:0,u_skirt_height:t}},Kt=new(function(){function e(){v(this,e),this.operations={}}return y(e,[{key:"newMorphing",value:function(e,t,n,r,i){if(e in this.operations){var a=this.operations[e];a.to.tileID.key!==n.tileID.key&&(a.queued=n)}else this.operations[e]={startTime:r,phase:0,duration:i,from:t,to:n,queued:null}}},{key:"getMorphValuesForProxy",value:function(e){if(!(e in this.operations))return null;var t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}},{key:"update",value:function(e){for(var t in this.operations){var n=this.operations[t];for(n.phase=(e-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,e)){delete this.operations[t];break}}}},{key:"_nextOp",value:function(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}},{key:"_validOp",value:function(e){return e.from.hasData()&&e.to.hasData()}}]),e}()),Yt={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Jt(t,n,r,i,a){var o=t.context,s=o.gl,l=t.useProgram("terrainRaster"),u=0,c=t.colorModeForRenderPass(),h=new e.DepthMode(s.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);Kt.update(a);var d,p,m,v,y=t.transform,g=6*Math.pow(1.5,22-y.zoom)*n.exaggeration(),_=f(i);try{for(_.s();!(v=_.n()).done;){var b=v.value,x=r.getTile(b),w=e.StencilMode.disabled,E=n.prevTerrainTileForTile[b.key],S=n.terrainTileForTile[b.key];m=S,null!=(p=E)&&null!=m&&p.hasData()&&m.hasData()&&null!=p.demTexture&&null!=m.demTexture&&p.tileID.key!==m.tileID.key&&Kt.newMorphing(b.key,E,S,a,250),o.activeTexture.set(s.TEXTURE0),x.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST);var T=Kt.getMorphValuesForProxy(b.key),k=T?1:0,M=void 0;T&&(M={morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:e.easeCubicInOut(T.phase)}});var C=Zt(b.posMatrix,Qt(b.canonical,y.renderWorldCopies)?g/10:g);u!==(d=k)&&(l=t.useProgram("terrainRaster",null,Yt[d]),u=d),n.setupElevationDraw(x,l,M),l.draw(o,s.TRIANGLES,h,w,c,e.CullFaceMode.backCCW,C,"terrain_raster",n.gridBuffer,n.gridIndexBuffer,n.gridSegments)}}catch(A){_.e(A)}finally{_.f()}}function Qt(e,t){var n=1<<e.z;return!t&&(0===e.x||e.x===n-1)||0===e.y||e.y===n-1}var $t=function(e){return{u_matrix:e}};function en(t,n,r,i,a){if(a>0){var o=e.browser.now(),s=(o-t.timeAdded)/a,l=n?(o-n.timeAdded)/a:-1,u=r.getSource(),c=i.coveringZoomLevel({tileSize:u.tileSize,roundZoom:u.roundZoom}),h=!n||Math.abs(n.tileID.overscaledZ-c)>Math.abs(t.tileID.overscaledZ-c),f=h&&t.refreshedUponExpiration?1:e.clamp(h?s:1-l,0,1);return t.refreshedUponExpiration&&s>=1&&(t.refreshedUponExpiration=!1),n?{opacity:1,mix:1-f}:{opacity:f,mix:0}}return{opacity:1,mix:0}}var tn={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0},nn=function(t){p(r,t);var n=m(r);function r(e){var t;v(this,r);var a=X("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new z(ne(),null),e.style);return t=n.call(this,"proxy",a,!1),a.setEventedParent(i(t)),t.map=t.getSource().map=e,t.used=t._sourceLoaded=!0,t.renderCache=[],t.renderCachePool=[],t.proxyCachedFBO={},t}return y(r,[{key:"update",value:function(t,n,r){var i=this;if(!t.freezeTileCoverage){this.transform=t;var a=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,useElevationData:!0}).reduce((function(n,r){if(n[r.key]="",!i._tiles[r.key]){var a=new e.Tile(r,i._source.tileSize*r.overscaleFactor(),t.tileZoom);a.state="loaded",i._tiles[r.key]=a}return n}),{});for(var o in this._tiles)o in a||(this.freeFBO(o),this._tiles[o].state="unloaded",delete this._tiles[o])}}},{key:"freeFBO",value:function(e){var t=this.proxyCachedFBO[e];void 0!==t&&(this.renderCachePool.push(t),delete this.proxyCachedFBO[e])}},{key:"deallocRenderCache",value:function(){this.renderCache.forEach((function(e){return e.fb.destroy()})),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}]),r}(e.SourceCache),rn=function(e){p(n,e);var t=m(n);function n(e,r,i){var a;return v(this,n),(a=t.call(this,e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)).proxyTileKey=r,a.posMatrix=i,a}return n}(e.OverscaledTileID),an=function(t){p(r,t);var n=m(r);function r(t,a){var o;v(this,r),(o=n.call(this)).painter=t,o.terrainTileForTile={},o.prevTerrainTileForTile={};var s=function(t){var n=new e.StructArrayLayout4i8,r=new e.StructArrayLayout3ui6;n.reserve(17161),r.reserve(33800);for(var i=e.EXTENT/128,a=e.EXTENT+i/2,o=a+i,s=-i;s<o;s+=i)for(var l=-i;l<o;l+=i){var u=l<0||l>a||s<0||s>a?24575:0,c=e.clamp(Math.round(l),0,e.EXTENT),h=e.clamp(Math.round(s),0,e.EXTENT);n.emplaceBack(c+u,h,c,h)}for(var f=function(e,t){var n=131*t+e;r.emplaceBack(n+1,n,n+131),r.emplaceBack(n+131,n+131+1,n+1)},d=1;d<129;d++)for(var p=1;p<129;p++)f(p,d);return[0,129].forEach((function(e){for(var t=0;t<130;t++)f(t,e),f(e,t)})),[n,r,32768]}(),l=h(s,3),u=l[0],c=l[1],f=l[2],d=t.context;o.gridBuffer=d.createVertexBuffer(u,G.members),o.gridIndexBuffer=d.createIndexBuffer(c),o.gridSegments=e.SegmentVector.simpleSegment(0,0,u.length,c.length),o.gridNoSkirtSegments=e.SegmentVector.simpleSegment(0,0,u.length,f),o.proxyCoords=[],o.proxiedCoords={},o._visibleDemTiles=[],o._sourceTilesOverlap={},o.proxySourceCache=new nn(a.map),o.orthoMatrix=e.create(),e.ortho(o.orthoMatrix,0,e.EXTENT,0,e.EXTENT,0,1);var p=d.gl;return o._overlapStencilMode=new e.StencilMode({func:p.GEQUAL,mask:255},0,255,p.KEEP,p.KEEP,p.REPLACE),o._previousZoom=t.transform.zoom,o.pool=[],o._findCoveringTileCache={},o._tilesDirty={},o.style=a,a.on("data",o._onStyleDataEvent.bind(i(o))),o}return y(r,[{key:"update",value:function(t,n,r){var i=this;if(t&&t.terrain){this.style!==t&&(t.on("data",this._onStyleDataEvent.bind(this)),this.style=t),this.enabled=!0;var a=t.terrain.properties;this.sourceCache=t._getSourceCache(a.get("source")),this._exaggeration=a.get("exaggeration");var o=function(){i.sourceCache.used&&e.warnOnce("Raster DEM source '".concat(i.sourceCache.id,"' is used both for terrain and as layer source.\n")+"This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.");var t=i.sourceCache.getSource().tileSize/128,r=i.proxySourceCache.getSource().tileSize;i.sourceCache.update(n,t*r,!0),i._findCoveringTileCache[i.sourceCache.id]={}};this.sourceCache.usedForTerrain||(this._findCoveringTileCache[this.sourceCache.id]={},this.sourceCache.usedForTerrain=!0,o(),this._initializing=!0),o(),n.updateElevation(!r),this._findCoveringTileCache[this.proxySourceCache.id]={},this.proxySourceCache.update(n),this._depthDone=!1,this._emptyDEMTextureDirty=!0}else this._disable()}},{key:"_onStyleDataEvent",value:function(e){e.coord&&"source"===e.dataType?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this._invalidateRenderCache=!0)}},{key:"_disable",value:function(){if(this.enabled&&(this.enabled=!1,this.proxySourceCache.deallocRenderCache(),this.painter.style))for(var e in this.painter.style._sourceCaches)this.painter.style._sourceCaches[e].usedForTerrain=!1}},{key:"destroy",value:function(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((function(e){return e.fb.destroy()})),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture)}},{key:"_source",value:function(){return this.enabled?this.sourceCache:null}},{key:"exaggeration",value:function(){return this._exaggeration}},{key:"updateTileBinding",value:function(t){var n=this;if(this.enabled){this.prevTerrainTileForTile=this.terrainTileForTile;var r=this.proxySourceCache,i=this.painter.transform;this._initializing&&(this._initializing=0===i._centerAltitude&&-1===this.getAtPoint(e.MercatorCoordinate.fromLngLat(i.center),-1),this._emptyDEMTextureDirty=!this._initializing);var a=this.painter.options;this.drapeFirst=(a.zooming||a.moving||a.rotating||!!this.forceDrapeFirst)&&!this._invalidateRenderCache,this._invalidateRenderCache=!1;var o=this.proxyCoords=r.getIds().map((function(e){var t=r.getTileByID(e).tileID;return t.posMatrix=i.calculatePosMatrix(t.toUnwrapped()),t}));!function(t,n){var r=n.transform.pointCoordinate(n.transform.getCameraPoint()),i=new e.Point(r.x,r.y);t.sort((function(t,n){if(n.overscaledZ-t.overscaledZ)return n.overscaledZ-t.overscaledZ;var r=new e.Point(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),a=new e.Point(n.canonical.x+(1<<n.canonical.z)*n.wrap,n.canonical.y),o=i.mult(1<<t.canonical.z);return o.x-=.5,o.y-=.5,o.distSqr(r)-o.distSqr(a)}))}(o,this.painter),this._previousZoom=i.zoom;var s=this.proxyToSource||{};this.proxyToSource={},o.forEach((function(e){n.proxyToSource[e.key]={}})),this.terrainTileForTile={};var l=this.painter.style._sourceCaches;for(var u in l){var c=l[u];if(c.used&&(c!==this.sourceCache&&(this._findCoveringTileCache[c.id]={}),this._setupProxiedCoordsForOrtho(c,t[u],s),!c.usedForTerrain)){var h=t[u];c.getSource().reparseOverscaled&&this._assignTerrainTiles(h)}}this.proxiedCoords[r.id]=o.map((function(e){return new rn(e,e.key,n.orthoMatrix)})),this._assignTerrainTiles(o),this._prepareDEMTextures(),this._setupRenderCache(s),this.drapeFirstPending=this.drapeFirst,this.renderingToTexture=!1,this._initFBOPool(),this._updateTimestamp=e.browser.now();var d={};this._visibleDemTiles=[];var p,m=f(this.proxyCoords);try{for(m.s();!(p=m.n()).done;){var v=p.value,y=this.terrainTileForTile[v.key];if(y){var g=y.tileID.key;g in d||(this._visibleDemTiles.push(y),d[g]=g)}}}catch(_){m.e(_)}finally{m.f()}}}},{key:"_assignTerrainTiles",value:function(e){var t=this;this._initializing||e.forEach((function(e){if(!t.terrainTileForTile[e.key]){var n=t._findTileCoveringTileID(e,t.sourceCache);n&&(t.terrainTileForTile[e.key]=n)}}))}},{key:"_prepareDEMTextures",value:function(){var e=this.painter.context,t=e.gl;for(var n in this.terrainTileForTile){var r=this.terrainTileForTile[n],i=r.dem;!i||r.demTexture&&!r.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),Wt(this.painter,r,i))}}},{key:"_prepareDemTileUniforms",value:function(e,t,n,r){if(!t||null==t.demTexture)return!1;var i=e.tileID.canonical,a=Math.pow(2,t.tileID.canonical.z-i.z),o=r||"";return n["u_dem_tl".concat(o)]=[i.x*a%1,i.y*a%1],n["u_dem_scale".concat(o)]=a,!0}},{key:"_getLoadedAreaMinimum",value:function(){var e=0,t=this._visibleDemTiles.reduce((function(t,n){if(!n.dem)return t;var r=n.dem.tree.minimums[0];return r>0&&e++,t+r}),0);return e?t/e:0}},{key:"_updateEmptyDEMTexture",value:function(){var t=this.painter.context,n=t.gl;t.activeTexture.set(n.TEXTURE2);var r=this._getLoadedAreaMinimum(),i={width:1,height:1,data:new Uint8Array(e.DEMData.pack(r,this.sourceCache.getSource().encoding))};this._emptyDEMTextureDirty=!1;var a=this._emptyDEMTexture;return a?a.update(i,{premultiply:!1}):a=this._emptyDEMTexture=new e.Texture(t,i,n.RGBA,{premultiply:!1}),a}},{key:"setupElevationDraw",value:function(t,n,r){var i,a=this.painter.context,o=a.gl,s=(i=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:e.DEMData.getUnpackVector(i),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});s.u_dem_size=this.sourceCache.getSource().tileSize,s.u_exaggeration=this.exaggeration();var l=null,u=null,c=1;if(r&&r.morphing){var h=r.morphing.srcDemTile,f=r.morphing.dstDemTile;c=r.morphing.phase,h&&f&&(this._prepareDemTileUniforms(t,h,s,"_prev")&&(u=h),this._prepareDemTileUniforms(t,f,s)&&(l=f))}if(u&&l?(a.activeTexture.set(o.TEXTURE2),l.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),a.activeTexture.set(o.TEXTURE4),u.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),s.u_dem_lerp=c):(l=this.terrainTileForTile[t.tileID.key],a.activeTexture.set(o.TEXTURE2),(this._prepareDemTileUniforms(t,l,s)?l.demTexture:this.emptyDEMTexture).bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST)),r&&r.useDepthForOcclusion&&(a.activeTexture.set(o.TEXTURE3),this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),s.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height]),r&&r.useMeterToDem&&l){var d=(1<<l.tileID.canonical.z)*e.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=d}r&&r.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=r.labelPlaneMatrixInv),n.setTerrainUniformValues(a,s)}},{key:"renderLayer",value:function(e,t){return"translucent"!==this.painter.renderPass?(this._depthDone||"symbol"!==e.type&&"circle"!==e.type||this.drawDepth(),!0):this.drapeFirst&&this.drapeFirstPending?(this.render(),this.drapeFirstPending=!1,!0):!!this._isLayerDrapedOverTerrain(e)&&(this.drapeFirst&&!this.renderingToTexture||this.render(),!0)}},{key:"render",value:function(){var t=this;this.renderingToTexture=!0;for(var n=this.painter,r=this.painter.context,i=this.proxySourceCache,a=this.proxiedCoords[i.id],o=function(){r.bindFramebuffer.set(null),r.viewport.set([0,0,n.width,n.height]),t.renderingToTexture=!1},s=n.currentLayer,l=s,u=[],c=n.style._order,h=0,f=0;f<a.length;f++){var d=a[f],p=i.getTileByID(d.proxyTileKey),m=i.proxyCachedFBO[d.key],v=this.currentFBO=void 0!==m?i.renderCache[m]:this.pool[h++];if(p.texture=v.tex,void 0===m||v.dirty){var y=void 0;for(r.bindFramebuffer.set(v.fb.framebuffer),this.renderedToTile=!1,v.dirty&&(r.clear({color:e.Color.transparent}),v.dirty=!1),n.currentLayer=s;n.currentLayer<c.length;n.currentLayer++){var g=n.style._layers[c[n.currentLayer]],_=g.isHidden(n.transform.zoom),b=this._isLayerDrapedOverTerrain(g);if(!this.drapeFirst||b){if(n.currentLayer>l){if(!_&&!b)break;l++}if(!_){var x=this.painter.style._getLayerSourceCache(g),w=x?this.proxyToSource[d.key][x.id]:[d];if(w){var E=w;r.viewport.set([0,0,v.fb.width,v.fb.height]),y!==(x?x.id:null)&&(this._setupStencil(w,g,x),y=x?x.id:null),n.renderLayer(n,x,g,E)}}}}v.dirty=this.renderedToTile,this.renderedToTile&&u.push(p.tileID),5===h&&(h=0,u.length>0&&(o(),Jt(n,this,i,u,this._updateTimestamp),this.renderingToTexture=!0,u=[]))}else u.push(p.tileID)}o(),u.length>0&&Jt(n,this,i,u,this._updateTimestamp),n.currentLayer=this.drapeFirst?-1:l}},{key:"raycast",value:function(e,t,n){if(!this._visibleDemTiles)return null;var r=this._visibleDemTiles.filter((function(e){return e.dem})).map((function(r){var i=r.tileID,a=Math.pow(2,i.overscaledZ),o=i.canonical,s=o.x,l=o.y,u=s/a,c=(s+1)/a,h=l/a,f=(l+1)/a;return{minx:u,miny:h,maxx:c,maxy:f,t:r.dem.tree.raycastRoot(u,h,c,f,e,t,n),tile:r}}));r.sort((function(e,t){return(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE)}));var i,a=f(r);try{for(a.s();!(i=a.n()).done;){var o=i.value;if(null==o.t)return null;var s=o.tile.dem.tree.raycast(o.minx,o.miny,o.maxx,o.maxy,e,t,n);if(null!=s)return s}}catch(l){a.e(l)}finally{a.f()}return null}},{key:"_createFBO",value:function(){var t=this.painter.context,n=t.gl,r=this.drapeBufferSize;t.activeTexture.set(n.TEXTURE0);var i=new e.Texture(t,{width:r[0],height:r[1],data:null},n.RGBA);i.bind(n.LINEAR,n.CLAMP_TO_EDGE);var a=t.createFramebuffer(r[0],r[1],!1);return a.colorAttachment.set(i.texture),t.extTextureFilterAnisotropic&&!t.extTextureFilterAnisotropicForceOff&&n.texParameterf(n.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:a,tex:i,dirty:!1,ref:1}}},{key:"_initFBOPool",value:function(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}},{key:"_shouldDisableRenderCache",value:function(){var e=this;return!this.drapeFirst||this.painter.style._order.some((function(t){var n=e.painter.style._layers[t],r=!n.isHidden(e.painter.transform.zoom),i=n.getCrossfadeParameters();return"custom"!==n.type&&!r&&!!i&&1!==i.t}))}},{key:"_clearRasterFadeFromRenderCache",value:function(){for(var e in this.painter.style._sourceCaches)if(!(this.painter.style._sourceCaches[e]._source instanceof H))return;for(var t=0;t<this.painter.style._order.length;++t){var n=this.painter.style._layers[this.painter.style._order[t]],r=n.isHidden(this.painter.transform.zoom),i=this.painter.style._getLayerSourceCache(n);if("raster"===n.type&&!r&&i){var a,o=n.paint.get("raster-fade-duration"),s=f(this.proxyCoords);try{for(s.s();!(a=s.n()).done;){var l=a.value,u=this.proxyToSource[l.key][i.id];if(u){var c,h=f(u);try{for(h.s();!(c=h.n()).done;){var d=c.value,p=en(i.getTile(d),i.findLoadedParent(d,0),i,this.painter.transform,o);(1!==p.opacity||0!==p.mix)&&this._clearRenderCacheForTile(i.id,d)}}catch(m){h.e(m)}finally{h.f()}}}}catch(m){s.e(m)}finally{s.f()}}}}},{key:"_setupRenderCache",value:function(e){var t=this.proxySourceCache;if(this._shouldDisableRenderCache()){if(t.renderCache.length>t.renderCachePool.length){var n=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={},t.renderCachePool=t.renderCachePool.concat(n)}}else{this._clearRasterFadeFromRenderCache();for(var r=this.proxyCoords,i=this._tilesDirty,a=r.length-1;a>=0;a--){var o=r[a];if(t.getTileByID(o.key),void 0!==t.proxyCachedFBO[o.key]){var s=e[o.key],l=this.proxyToSource[o.key],u=0,c=function(e){var t=l[e],n=s[e];if(!n||n.length!==t.length||t.some((function(t,r){return t!==n[r]||i[e]&&i[e].hasOwnProperty(t.key)})))return u=-1,"break";++u};for(var h in l)if("break"===c(h))break;t.renderCache[t.proxyCachedFBO[o.key]].dirty=u<0||u!==Object.values(s).length}else{var f=t.renderCachePool.pop();void 0===f&&t.renderCache.length<50&&(f=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==f&&(t.proxyCachedFBO[o.key]=f,t.renderCache[f].dirty=!0)}}this._tilesDirty={}}}},{key:"_setupStencil",value:function(t,n,r){if(r&&this._sourceTilesOverlap[r.id]){var i=this.painter.context,a=i.gl;if(t.length<=1)this._overlapStencilType=!1;else{var o,s=this.currentFBO,l=s.fb;if(n.isTileClipped())o=t.length,this._overlapStencilMode.test={func:a.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);o=1,this._overlapStencilMode.test={func:a.GREATER,mask:255},this._overlapStencilType="Mask"}if(!l.depthAttachment){var u=i.createRenderbuffer(i.gl.DEPTH_STENCIL,l.width,l.height);l.depthAttachment=new e.DepthStencilAttachment(i,l.framebuffer),l.depthAttachment.set(u),i.clear({stencil:0})}s.ref+o>255&&(i.clear({stencil:0}),s.ref=0),s.ref+=o,this._overlapStencilMode.ref=s.ref,n.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}}else this._overlapStencilType&&(this._overlapStencilType=!1)}},{key:"stencilModeForRTTOverlap",value:function(t){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):e.StencilMode.disabled}},{key:"_renderTileClippingMasks",value:function(t,n){var r=this.painter,i=this.painter.context,a=i.gl;r._tileClippingMaskIDs={},i.setColorMode(e.ColorMode.disabled),i.setDepthMode(e.DepthMode.disabled);var o,s=r.useProgram("clippingMask"),l=f(t);try{for(l.s();!(o=l.n()).done;){var u=o.value,c=r._tileClippingMaskIDs[u.key]=--n;s.draw(i,a.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:a.ALWAYS,mask:0},c,255,a.KEEP,a.KEEP,a.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,$t(u.posMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}catch(h){l.e(h)}finally{l.f()}}},{key:"pointCoordinate",value:function(t){var n=this.painter.transform;if(t.x<0||t.x>n.width||t.y<0||t.y>n.height)return null;var r=[t.x,t.y,1,1];e.transformMat4(r,r,n.pixelMatrixInverse),e.scale$1(r,r,1/r[3]),r[0]/=n.worldSize,r[1]/=n.worldSize;var i=n._camera.position,a=e.mercatorZfromAltitude(1,n.center.lat),o=[i[0],i[1],i[2]/a,0],s=e.subtract([],r.slice(0,3),o);e.normalize(s,s);var l=this.raycast(o,s,this._exaggeration);return null!==l&&l?(e.scaleAndAdd(o,o,s,l),o[3]=o[2],o[2]*=a,o):null}},{key:"drawDepth",value:function(){var t=this.painter,n=t.context,r=this.proxySourceCache,i=Math.ceil(t.width),a=Math.ceil(t.height);if(!this._depthFBO||this._depthFBO.width===i&&this._depthFBO.height===a||(this._depthFBO.destroy(),delete this._depthFBO,delete this._depthTexture),!this._depthFBO){var o=n.gl,s=n.createFramebuffer(i,a,!0);n.activeTexture.set(o.TEXTURE0);var l=new e.Texture(n,{width:i,height:a,data:null},o.RGBA);l.bind(o.NEAREST,o.CLAMP_TO_EDGE),s.colorAttachment.set(l.texture);var u=n.createRenderbuffer(n.gl.DEPTH_COMPONENT16,i,a);s.depthAttachment.set(u),this._depthFBO=s,this._depthTexture=l}n.bindFramebuffer.set(this._depthFBO.framebuffer),n.viewport.set([0,0,i,a]),function(t,n,r,i){var a=t.context,o=a.gl;a.clear({depth:1});var s,l=t.useProgram("terrainDepth"),u=new e.DepthMode(o.LESS,e.DepthMode.ReadWrite,t.depthRangeFor3D),c=f(i);try{for(c.s();!(s=c.n()).done;){var h=s.value,d=r.getTile(h),p=Zt(h.posMatrix,0);n.setupElevationDraw(d,l),l.draw(a,o.TRIANGLES,u,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.backCCW,p,"terrain_depth",n.gridBuffer,n.gridIndexBuffer,n.gridNoSkirtSegments)}}catch(m){c.e(m)}finally{c.f()}}(t,this,r,this.proxyCoords),n.bindFramebuffer.set(null),n.viewport.set([0,0,t.width,t.height]),this._depthDone=!0}},{key:"_isLayerDrapedOverTerrain",value:function(e){return!!this.enabled&&tn.hasOwnProperty(e.type)}},{key:"_setupProxiedCoordsForOrtho",value:function(e,t,n){if(e.getSource()instanceof W)return this._setupProxiedCoordsForImageSource(e,t,n);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};for(var r=this.proxiedCoords[e.id]=[],i=this.proxyCoords,a=0;a<i.length;a++){var o=i[a],s=this._findTileCoveringTileID(o,e);if(s){var l=this._createProxiedId(o,s,n[o.key]&&n[o.key][e.id]);r.push(l),this.proxyToSource[o.key][e.id]=[l]}}for(var u=!1,c=0;c<t.length;c++){var h=e.getTile(t[c]);if(h&&h.hasData()){var f=this._findTileCoveringTileID(h.tileID,this.proxySourceCache);if(f&&f.tileID.canonical.z!==h.tileID.canonical.z){var d=this.proxyToSource[f.tileID.key][e.id],p=this._createProxiedId(f.tileID,h,n[f.tileID.key]&&n[f.tileID.key][e.id]);d?d.splice(d.length-1,0,p):this.proxyToSource[f.tileID.key][e.id]=[p],r.push(p),u=!0}}}this._sourceTilesOverlap[e.id]=u}},{key:"_setupProxiedCoordsForImageSource",value:function(t,n,r){if(t.getSource().loaded())for(var i=this.proxiedCoords[t.id]=[],a=this.proxyCoords,o=t.getSource(),s=new e.Point(o.tileID.x,o.tileID.y)._div(1<<o.tileID.z),l=o.coordinates.map(e.MercatorCoordinate.fromLngLat).reduce((function(e,t){return e.min.x=Math.min(e.min.x,t.x-s.x),e.min.y=Math.min(e.min.y,t.y-s.y),e.max.x=Math.max(e.max.x,t.x-s.x),e.max.y=Math.max(e.max.y,t.y-s.y),e}),{min:new e.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),u=function(t,n){var r=t.wrap+t.canonical.x/(1<<t.canonical.z),i=t.canonical.y/(1<<t.canonical.z),a=e.EXTENT/(1<<t.canonical.z),o=n.wrap+n.canonical.x/(1<<n.canonical.z),s=n.canonical.y/(1<<n.canonical.z);return r+a<o+l.min.x||r>o+l.max.x||i+a<s+l.min.y||i>s+l.max.y},c=0;c<a.length;c++)for(var h=a[c],f=0;f<n.length;f++){var d=t.getTile(n[f]);if(d&&d.hasData()&&!u(h,d.tileID)){var p=this._createProxiedId(h,d,r[h.key]&&r[h.key][t.id]),m=this.proxyToSource[h.key][t.id];m?m.push(p):this.proxyToSource[h.key][t.id]=[p],i.push(p)}}}},{key:"_createProxiedId",value:function(t,n,r){var i=this.orthoMatrix;if(r){var a=r.find((function(e){return e.key===n.tileID.key}));if(a)return a}if(n.tileID.key!==t.key){var o,s,l,u=t.canonical.z-n.tileID.canonical.z;i=e.create();var c=n.tileID.wrap-t.wrap<<t.overscaledZ;u>0?(s=(o=e.EXTENT>>u)*((n.tileID.canonical.x<<u)-t.canonical.x+c),l=o*((n.tileID.canonical.y<<u)-t.canonical.y)):(o=e.EXTENT<<-u,s=e.EXTENT*(n.tileID.canonical.x-(t.canonical.x+c<<-u)),l=e.EXTENT*(n.tileID.canonical.y-(t.canonical.y<<-u))),e.ortho(i,0,o,0,o,0,1),e.translate(i,i,[s,l,0])}return new rn(n.tileID,t.key,i)}},{key:"_findTileCoveringTileID",value:function(t,n){var r=n.getTile(t);if(r&&r.hasData())return r;var i=this._findCoveringTileCache[n.id],a=i[t.key];if((r=a?n.getTileByID(a):null)&&r.hasData()||null===a)return r;var o=r?r.tileID:t,s=o.overscaledZ,l=n.getSource().minzoom,u=[];if(!a){var c=n.getSource().maxzoom;if(t.canonical.z>=c){var h=t.canonical.z-c;n.getSource().reparseOverscaled?(s=Math.max(t.canonical.z+2,n.transform.tileZoom),o=new e.OverscaledTileID(s,t.wrap,c,t.canonical.x>>h,t.canonical.y>>h)):0!==h&&(s=c,o=new e.OverscaledTileID(s,t.wrap,c,t.canonical.x>>h,t.canonical.y>>h))}o.key!==t.key&&(u.push(o.key),r=n.getTile(o))}var f=function(e){u.forEach((function(t){i[t]=e})),u.length=0};for(s-=1;s>=l&&(!r||!r.hasData());s--){r&&f(r.tileID.key);var d=o.calculateScaledKey(s);if((r=n.getTileByID(d))&&r.hasData())break;var p=i[d];if(null===p)break;void 0===p?u.push(d):r=n.getTileByID(p)}return f(r?r.tileID.key:null),r&&r.hasData()?r:null}},{key:"findDEMTileFor",value:function(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}},{key:"prepareDrawTile",value:function(e){this.renderedToTile||(this.renderedToTile=!0)}},{key:"_clearRenderCacheForTile",value:function(e,t){var n=this._tilesDirty[e];n||(n=this._tilesDirty[e]={}),n[t.key]=!0}},{key:"visibleDemTiles",get:function(){return this._visibleDemTiles}},{key:"drapeBufferSize",get:function(){var e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}},{key:"emptyDEMTexture",get:function(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}}]),r}(e.Elevation);function on(e){for(var t=[],n=0;n<e.length;n++)if(null!==e[n]){var r=e[n].split(" ");t.push(r.pop())}return t}var sn=function(){function t(n,r,i,a,o,s){v(this,t);var l=n.gl;this.program=l.createProgram();var u,c=on(i.staticAttributes),h=a?a.getBinderAttributes():[],d=c.concat(h),p=i.staticUniforms?on(i.staticUniforms):[],m=a?a.getBinderUniforms():[],y=p.concat(m),g=[],_=f(y);try{for(_.s();!(u=_.n()).done;){var b=u.value;g.indexOf(b)<0&&g.push(b)}}catch(P){_.e(P)}finally{_.f()}var x=a?a.defines():[],w=(x=x.concat(s.map((function(e){return"#define ".concat(e)})))).concat(ut.fragmentSource,i.fragmentSource).join("\n"),E=x.concat(ut.vertexSource,lt.vertexSource,i.vertexSource).join("\n"),S=l.createShader(l.FRAGMENT_SHADER);if(l.isContextLost())this.failedToCreate=!0;else{l.shaderSource(S,w),l.compileShader(S),l.attachShader(this.program,S);var T=l.createShader(l.VERTEX_SHADER);if(l.isContextLost())this.failedToCreate=!0;else{l.shaderSource(T,E),l.compileShader(T),l.attachShader(this.program,T),this.attributes={};var k={};this.numAttributes=d.length;for(var M=0;M<this.numAttributes;M++)d[M]&&(l.bindAttribLocation(this.program,M,d[M]),this.attributes[d[M]]=M);l.linkProgram(this.program),l.deleteShader(T),l.deleteShader(S);for(var C=0;C<g.length;C++){var A=g[C];if(A&&!k[A]){var I=l.getUniformLocation(this.program,A);I&&(k[A]=I)}}this.fixedUniforms=o(n,k),this.binderUniforms=a?a.getUniforms(n,k):[],-1!==s.indexOf("TERRAIN")&&(this.terrainUniforms=function(t,n){return{u_dem:new e.Uniform1i(t,n.u_dem),u_dem_prev:new e.Uniform1i(t,n.u_dem_prev),u_dem_unpack:new e.Uniform4f(t,n.u_dem_unpack),u_dem_tl:new e.Uniform2f(t,n.u_dem_tl),u_dem_scale:new e.Uniform1f(t,n.u_dem_scale),u_dem_tl_prev:new e.Uniform2f(t,n.u_dem_tl_prev),u_dem_scale_prev:new e.Uniform1f(t,n.u_dem_scale_prev),u_dem_size:new e.Uniform1f(t,n.u_dem_size),u_dem_lerp:new e.Uniform1f(t,n.u_dem_lerp),u_exaggeration:new e.Uniform1f(t,n.u_exaggeration),u_depth:new e.Uniform1i(t,n.u_depth),u_depth_size_inv:new e.Uniform2f(t,n.u_depth_size_inv),u_meter_to_dem:new e.Uniform1f(t,n.u_meter_to_dem),u_label_plane_matrix_inv:new e.UniformMatrix4f(t,n.u_label_plane_matrix_inv)}}(n,k))}}}return y(t,null,[{key:"cacheKey",value:function(e,t,n){var r,i="".concat(e).concat(n?n.cacheKey:""),a=f(t);try{for(a.s();!(r=a.n()).done;){var o=r.value;i+="/".concat(o)}}catch(s){a.e(s)}finally{a.f()}return i}}]),y(t,[{key:"setTerrainUniformValues",value:function(e,t){if(this.terrainUniforms){var n=this.terrainUniforms;if(!this.failedToCreate)for(var r in e.program.set(this.program),t)n[r].set(t[r])}}},{key:"draw",value:function(e,t,n,i,a,o,s,l,u,c,h,d,p,m,v,y){var g,_=e.gl;if(!this.failedToCreate){for(var b in e.program.set(this.program),e.setDepthMode(n),e.setStencilMode(i),e.setColorMode(a),e.setCullFace(o),this.fixedUniforms)this.fixedUniforms[b].set(s[b]);m&&m.setUniforms(e,this.binderUniforms,d,{zoom:p});var x,w=(g={},r(g,_.LINES,2),r(g,_.TRIANGLES,3),r(g,_.LINE_STRIP,1),g)[t],E=f(h.get());try{for(E.s();!(x=E.n()).done;){var S=x.value,T=S.vaos||(S.vaos={});(T[l]||(T[l]=new Vt)).bind(e,this,u,m?m.getPaintVertexBuffers():[],c,S.vertexOffset,v,y),_.drawElements(t,S.primitiveLength*w,_.UNSIGNED_SHORT,S.primitiveOffset*w*2)}}catch(k){E.e(k)}finally{E.f()}}}}]),t}();function ln(e,t,n){var r=1/F(n,1,t.transform.tileZoom),i=Math.pow(2,n.tileID.overscaledZ),a=n.tileSize*Math.pow(2,t.transform.tileZoom)/i,o=a*(n.tileID.canonical.x+n.tileID.wrap*i),s=a*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[r,e.fromScale,e.toScale],u_fade:e.t,u_pixel_coord_upper:[o>>16,s>>16],u_pixel_coord_lower:[65535&o,65535&s]}}var un=function(t,n,r,i){var a=n.style.light,o=a.properties.get("position"),s=[o.x,o.y,o.z],l=e.create$1();"viewport"===a.properties.get("anchor")&&(e.fromRotation(l,-n.transform.angle),e.transformMat3(s,s,l));var u=a.properties.get("color");return{u_matrix:t,u_lightpos:s,u_lightintensity:a.properties.get("intensity"),u_lightcolor:[u.r,u.g,u.b],u_vertical_gradient:+r,u_opacity:i}},cn=function(t,n,r,i,a,o,s){return e.extend(un(t,n,r,i),ln(o,n,s),{u_height_factor:-Math.pow(2,a.overscaledZ)/s.tileSize/8})},hn=function(e){return{u_matrix:e}},fn=function(t,n,r,i){return e.extend(hn(t),ln(r,n,i))},dn=function(e,t){return{u_matrix:e,u_world:t}},pn=function(t,n,r,i,a){return e.extend(fn(t,n,r,i),{u_world:a})},mn=function(t,n,r,i){var a,o=t.transform;if("map"===i.paint.get("circle-pitch-alignment")){var s=F(r,1,o.zoom);a=[s,s]}else a=o.pixelsToGLUnits;return{u_camera_to_center_distance:o.cameraToCenterDistance,u_matrix:t.translatePosMatrix(n.posMatrix,r,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor")),u_device_pixel_ratio:e.browser.devicePixelRatio,u_extrude_scale:a}},vn=function(e){var t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t},yn=function(t,n,r){var i=e.EXTENT/r.tileSize;return{u_matrix:t,u_camera_to_center_distance:n.cameraToCenterDistance,u_extrude_scale:[n.pixelsToGLUnits[0]/i,n.pixelsToGLUnits[1]/i]}},gn=function(e,t){return{u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1}},_n=function(e,t,n,r){return{u_matrix:e,u_extrude_scale:F(t,1,n),u_intensity:r}},bn=function(t,n,r,i){var a=t.transform;return{u_matrix:Tn(t,n,r,i),u_ratio:1/F(n,1,a.zoom),u_device_pixel_ratio:e.browser.devicePixelRatio,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]]}},xn=function(t,n,r,i,a){return e.extend(bn(t,n,r,i),{u_image:0,u_image_height:a})},wn=function(t,n,r,i,a){var o=t.transform,s=Sn(n,o);return{u_matrix:Tn(t,n,r,a),u_texsize:n.imageAtlasTexture.size,u_ratio:1/F(n,1,o.zoom),u_device_pixel_ratio:e.browser.devicePixelRatio,u_image:0,u_scale:[s,i.fromScale,i.toScale],u_fade:i.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},En=function(t,n,r,i,a,o){var s=t.lineAtlas,l=Sn(n,t.transform),u="round"===r.layout.get("line-cap"),c=s.getDash(i.from,u),h=s.getDash(i.to,u),f=c.width*a.fromScale,d=h.width*a.toScale;return e.extend(bn(t,n,r,o),{u_patternscale_a:[l/f,-c.height/2],u_patternscale_b:[l/d,-h.height/2],u_sdfgamma:s.width/(256*Math.min(f,d)*e.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:c.y,u_tex_y_b:h.y,u_mix:a.t})};function Sn(e,t){return 1/F(e,1,t.tileZoom)}function Tn(e,t,n,r){return e.translatePosMatrix(r||t.tileID.posMatrix,t,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}var kn=function(e,t,n,r,i){return{u_matrix:e,u_tl_parent:t,u_scale_parent:n,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:(o=i.paint.get("raster-saturation"),o>0?1-1/(1.001-o):-o),u_contrast_factor:(a=i.paint.get("raster-contrast"),a>0?1/(1-a):1+a),u_spin_weights:Mn(i.paint.get("raster-hue-rotate"))};var a,o};function Mn(e){e*=Math.PI/180;var t=Math.sin(e),n=Math.cos(e);return[(2*n+1)/3,(-Math.sqrt(3)*t-n+1)/3,(Math.sqrt(3)*t-n+1)/3]}var Cn,An=function(e,t,n,r,i,a,o,s,l,u){var c=i.transform;return{u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:c.cameraToCenterDistance,u_pitch:c.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:c.width/c.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:o,u_coord_matrix:s,u_is_text:+l,u_pitch_with_map:+r,u_texsize:u,u_texture:0}},In=function(t,n,r,i,a,o,s,l,u,c,h){var f=a.transform;return e.extend(An(t,n,r,i,a,o,s,l,u,c),{u_gamma_scale:i?Math.cos(f._pitch)*f.cameraToCenterDistance:1,u_device_pixel_ratio:e.browser.devicePixelRatio,u_is_halo:+h})},Pn=function(t,n,r,i,a,o,s,l,u,c){return e.extend(In(t,n,r,i,a,o,s,l,!0,u,!0),{u_texsize_icon:c,u_texture_icon:1})},Rn=function(e,t,n){return{u_matrix:e,u_opacity:t,u_color:n}},Ln=function(t,n,r,i,a,o){return e.extend(function(e,t,n,r){var i=n.imageManager.getPattern(e.from.toString()),a=n.imageManager.getPattern(e.to.toString()),o=n.imageManager.getPixelSize(),s=o.width,l=o.height,u=Math.pow(2,r.tileID.overscaledZ),c=r.tileSize*Math.pow(2,n.transform.tileZoom)/u,h=c*(r.tileID.canonical.x+r.tileID.wrap*u),f=c*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:i.tl,u_pattern_br_a:i.br,u_pattern_tl_b:a.tl,u_pattern_br_b:a.br,u_texsize:[s,l],u_mix:t.t,u_pattern_size_a:i.displaySize,u_pattern_size_b:a.displaySize,u_scale_a:t.fromScale,u_scale_b:t.toScale,u_tile_units_to_pixels:1/F(r,1,n.transform.tileZoom),u_pixel_coord_upper:[h>>16,f>>16],u_pixel_coord_lower:[65535&h,65535&f]}}(i,o,r,a),{u_matrix:t,u_opacity:n})},On={fillExtrusion:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_lightpos:new e.Uniform3f(t,n.u_lightpos),u_lightintensity:new e.Uniform1f(t,n.u_lightintensity),u_lightcolor:new e.Uniform3f(t,n.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,n.u_vertical_gradient),u_opacity:new e.Uniform1f(t,n.u_opacity)}},fillExtrusionPattern:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_lightpos:new e.Uniform3f(t,n.u_lightpos),u_lightintensity:new e.Uniform1f(t,n.u_lightintensity),u_lightcolor:new e.Uniform3f(t,n.u_lightcolor),u_vertical_gradient:new e.Uniform1f(t,n.u_vertical_gradient),u_height_factor:new e.Uniform1f(t,n.u_height_factor),u_image:new e.Uniform1i(t,n.u_image),u_texsize:new e.Uniform2f(t,n.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade),u_opacity:new e.Uniform1f(t,n.u_opacity)}},fill:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}},fillPattern:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_image:new e.Uniform1i(t,n.u_image),u_texsize:new e.Uniform2f(t,n.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade)}},fillOutline:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_world:new e.Uniform2f(t,n.u_world)}},fillOutlinePattern:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_world:new e.Uniform2f(t,n.u_world),u_image:new e.Uniform1i(t,n.u_image),u_texsize:new e.Uniform2f(t,n.u_texsize),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade)}},circle:function(t,n){return{u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_extrude_scale:new e.Uniform2f(t,n.u_extrude_scale),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}},collisionBox:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_extrude_scale:new e.Uniform2f(t,n.u_extrude_scale)}},collisionCircle:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_inv_matrix:new e.UniformMatrix4f(t,n.u_inv_matrix),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_viewport_size:new e.Uniform2f(t,n.u_viewport_size)}},debug:function(t,n){return{u_color:new e.UniformColor(t,n.u_color),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_overlay:new e.Uniform1i(t,n.u_overlay),u_overlay_scale:new e.Uniform1f(t,n.u_overlay_scale)}},clippingMask:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}},heatmap:function(t,n){return{u_extrude_scale:new e.Uniform1f(t,n.u_extrude_scale),u_intensity:new e.Uniform1f(t,n.u_intensity),u_matrix:new e.UniformMatrix4f(t,n.u_matrix)}},heatmapTexture:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_world:new e.Uniform2f(t,n.u_world),u_image:new e.Uniform1i(t,n.u_image),u_color_ramp:new e.Uniform1i(t,n.u_color_ramp),u_opacity:new e.Uniform1f(t,n.u_opacity)}},hillshade:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_image:new e.Uniform1i(t,n.u_image),u_latrange:new e.Uniform2f(t,n.u_latrange),u_light:new e.Uniform2f(t,n.u_light),u_shadow:new e.UniformColor(t,n.u_shadow),u_highlight:new e.UniformColor(t,n.u_highlight),u_accent:new e.UniformColor(t,n.u_accent)}},hillshadePrepare:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_image:new e.Uniform1i(t,n.u_image),u_dimension:new e.Uniform2f(t,n.u_dimension),u_zoom:new e.Uniform1f(t,n.u_zoom),u_unpack:new e.Uniform4f(t,n.u_unpack)}},line:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_ratio:new e.Uniform1f(t,n.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,n.u_units_to_pixels)}},lineGradient:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_ratio:new e.Uniform1f(t,n.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,n.u_units_to_pixels),u_image:new e.Uniform1i(t,n.u_image),u_image_height:new e.Uniform1f(t,n.u_image_height)}},linePattern:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_texsize:new e.Uniform2f(t,n.u_texsize),u_ratio:new e.Uniform1f(t,n.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_image:new e.Uniform1i(t,n.u_image),u_units_to_pixels:new e.Uniform2f(t,n.u_units_to_pixels),u_scale:new e.Uniform3f(t,n.u_scale),u_fade:new e.Uniform1f(t,n.u_fade)}},lineSDF:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_ratio:new e.Uniform1f(t,n.u_ratio),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_units_to_pixels:new e.Uniform2f(t,n.u_units_to_pixels),u_patternscale_a:new e.Uniform2f(t,n.u_patternscale_a),u_patternscale_b:new e.Uniform2f(t,n.u_patternscale_b),u_sdfgamma:new e.Uniform1f(t,n.u_sdfgamma),u_image:new e.Uniform1i(t,n.u_image),u_tex_y_a:new e.Uniform1f(t,n.u_tex_y_a),u_tex_y_b:new e.Uniform1f(t,n.u_tex_y_b),u_mix:new e.Uniform1f(t,n.u_mix)}},raster:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_tl_parent:new e.Uniform2f(t,n.u_tl_parent),u_scale_parent:new e.Uniform1f(t,n.u_scale_parent),u_buffer_scale:new e.Uniform1f(t,n.u_buffer_scale),u_fade_t:new e.Uniform1f(t,n.u_fade_t),u_opacity:new e.Uniform1f(t,n.u_opacity),u_image0:new e.Uniform1i(t,n.u_image0),u_image1:new e.Uniform1i(t,n.u_image1),u_brightness_low:new e.Uniform1f(t,n.u_brightness_low),u_brightness_high:new e.Uniform1f(t,n.u_brightness_high),u_saturation_factor:new e.Uniform1f(t,n.u_saturation_factor),u_contrast_factor:new e.Uniform1f(t,n.u_contrast_factor),u_spin_weights:new e.Uniform3f(t,n.u_spin_weights)}},symbolIcon:function(t,n){return{u_is_size_zoom_constant:new e.Uniform1i(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,n.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,n.u_size_t),u_size:new e.Uniform1f(t,n.u_size),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,n.u_pitch),u_rotate_symbol:new e.Uniform1i(t,n.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,n.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,n.u_fade_change),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,n.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,n.u_coord_matrix),u_is_text:new e.Uniform1i(t,n.u_is_text),u_pitch_with_map:new e.Uniform1i(t,n.u_pitch_with_map),u_texsize:new e.Uniform2f(t,n.u_texsize),u_texture:new e.Uniform1i(t,n.u_texture)}},symbolSDF:function(t,n){return{u_is_size_zoom_constant:new e.Uniform1i(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,n.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,n.u_size_t),u_size:new e.Uniform1f(t,n.u_size),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,n.u_pitch),u_rotate_symbol:new e.Uniform1i(t,n.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,n.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,n.u_fade_change),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,n.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,n.u_coord_matrix),u_is_text:new e.Uniform1i(t,n.u_is_text),u_pitch_with_map:new e.Uniform1i(t,n.u_pitch_with_map),u_texsize:new e.Uniform2f(t,n.u_texsize),u_texture:new e.Uniform1i(t,n.u_texture),u_gamma_scale:new e.Uniform1f(t,n.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_is_halo:new e.Uniform1i(t,n.u_is_halo)}},symbolTextAndIcon:function(t,n){return{u_is_size_zoom_constant:new e.Uniform1i(t,n.u_is_size_zoom_constant),u_is_size_feature_constant:new e.Uniform1i(t,n.u_is_size_feature_constant),u_size_t:new e.Uniform1f(t,n.u_size_t),u_size:new e.Uniform1f(t,n.u_size),u_camera_to_center_distance:new e.Uniform1f(t,n.u_camera_to_center_distance),u_pitch:new e.Uniform1f(t,n.u_pitch),u_rotate_symbol:new e.Uniform1i(t,n.u_rotate_symbol),u_aspect_ratio:new e.Uniform1f(t,n.u_aspect_ratio),u_fade_change:new e.Uniform1f(t,n.u_fade_change),u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_label_plane_matrix:new e.UniformMatrix4f(t,n.u_label_plane_matrix),u_coord_matrix:new e.UniformMatrix4f(t,n.u_coord_matrix),u_is_text:new e.Uniform1i(t,n.u_is_text),u_pitch_with_map:new e.Uniform1i(t,n.u_pitch_with_map),u_texsize:new e.Uniform2f(t,n.u_texsize),u_texsize_icon:new e.Uniform2f(t,n.u_texsize_icon),u_texture:new e.Uniform1i(t,n.u_texture),u_texture_icon:new e.Uniform1i(t,n.u_texture_icon),u_gamma_scale:new e.Uniform1f(t,n.u_gamma_scale),u_device_pixel_ratio:new e.Uniform1f(t,n.u_device_pixel_ratio),u_is_halo:new e.Uniform1i(t,n.u_is_halo)}},background:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_opacity:new e.Uniform1f(t,n.u_opacity),u_color:new e.UniformColor(t,n.u_color)}},backgroundPattern:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_opacity:new e.Uniform1f(t,n.u_opacity),u_image:new e.Uniform1i(t,n.u_image),u_pattern_tl_a:new e.Uniform2f(t,n.u_pattern_tl_a),u_pattern_br_a:new e.Uniform2f(t,n.u_pattern_br_a),u_pattern_tl_b:new e.Uniform2f(t,n.u_pattern_tl_b),u_pattern_br_b:new e.Uniform2f(t,n.u_pattern_br_b),u_texsize:new e.Uniform2f(t,n.u_texsize),u_mix:new e.Uniform1f(t,n.u_mix),u_pattern_size_a:new e.Uniform2f(t,n.u_pattern_size_a),u_pattern_size_b:new e.Uniform2f(t,n.u_pattern_size_b),u_scale_a:new e.Uniform1f(t,n.u_scale_a),u_scale_b:new e.Uniform1f(t,n.u_scale_b),u_pixel_coord_upper:new e.Uniform2f(t,n.u_pixel_coord_upper),u_pixel_coord_lower:new e.Uniform2f(t,n.u_pixel_coord_lower),u_tile_units_to_pixels:new e.Uniform1f(t,n.u_tile_units_to_pixels)}},terrainRaster:Xt,terrainDepth:Xt,skybox:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_sun_direction:new e.Uniform3f(t,n.u_sun_direction),u_cubemap:new e.Uniform1i(t,n.u_cubemap),u_opacity:new e.Uniform1f(t,n.u_opacity),u_temporal_offset:new e.Uniform1f(t,n.u_temporal_offset)}},skyboxGradient:function(t,n){return{u_matrix:new e.UniformMatrix4f(t,n.u_matrix),u_color_ramp:new e.Uniform1i(t,n.u_color_ramp),u_center_direction:new e.Uniform3f(t,n.u_center_direction),u_radius:new e.Uniform1f(t,n.u_radius),u_opacity:new e.Uniform1f(t,n.u_opacity),u_temporal_offset:new e.Uniform1f(t,n.u_temporal_offset)}},skyboxCapture:function(t,n){return{u_matrix_3f:new e.UniformMatrix3f(t,n.u_matrix_3f),u_sun_direction:new e.Uniform3f(t,n.u_sun_direction),u_sun_intensity:new e.Uniform1f(t,n.u_sun_intensity),u_color_tint_r:new e.Uniform4f(t,n.u_color_tint_r),u_color_tint_m:new e.Uniform4f(t,n.u_color_tint_m),u_luminance:new e.Uniform1f(t,n.u_luminance)}}};function Dn(t,n,r,i,a,o,s){for(var l=t.context,u=l.gl,c=t.useProgram("collisionBox"),h=[],f=0,d=0,p=0;p<i.length;p++){var m=i[p],v=n.getTile(m),y=v.getBucket(r);if(y){var g=m.posMatrix;0===a[0]&&0===a[1]||(g=t.translatePosMatrix(m.posMatrix,v,a,o));var _=s?y.textCollisionBox:y.iconCollisionBox,b=y.collisionCircleArray;if(b.length>0){var x=e.create(),w=g;e.mul(x,y.placementInvProjMatrix,t.transform.glCoordMatrix),e.mul(x,x,y.placementViewportMatrix),h.push({circleArray:b,circleOffset:d,transform:w,invTransform:x}),d=f+=b.length/4}_&&(t.terrain&&t.terrain.setupElevationDraw(v,c),c.draw(l,u.LINES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,yn(g,t.transform,v),r.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,null,t.transform.zoom,null,_.collisionVertexBuffer,_.collisionVertexBufferExt))}}if(s&&h.length){var E=t.useProgram("collisionCircle"),S=new e.StructArrayLayout2f1f2i16;S.resize(4*f),S._trim();for(var T=0,k=0,M=h;k<M.length;k++)for(var C=M[k],A=0;A<C.circleArray.length/4;A++){var I=4*A,P=C.circleArray[I+0],R=C.circleArray[I+1],L=C.circleArray[I+2],O=C.circleArray[I+3];S.emplace(T++,P,R,L,O,0),S.emplace(T++,P,R,L,O,1),S.emplace(T++,P,R,L,O,2),S.emplace(T++,P,R,L,O,3)}(!Cn||Cn.length<2*f)&&(Cn=function(t){var n=2*t,r=new e.StructArrayLayout3ui6;r.resize(n),r._trim();for(var i=0;i<n;i++){var a=6*i;r.uint16[a+0]=4*i+0,r.uint16[a+1]=4*i+1,r.uint16[a+2]=4*i+2,r.uint16[a+3]=4*i+2,r.uint16[a+4]=4*i+3,r.uint16[a+5]=4*i+0}return r}(f));for(var D,N=l.createIndexBuffer(Cn,!0),z=l.createVertexBuffer(S,e.collisionCircleLayout.members,!0),F=0,B=h;F<B.length;F++){var U=B[F],j={u_matrix:U.transform,u_inv_matrix:U.invTransform,u_camera_to_center_distance:(D=t.transform).cameraToCenterDistance,u_viewport_size:[D.width,D.height]};E.draw(l,u.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,j,r.id,z,N,e.SegmentVector.simpleSegment(0,2*U.circleOffset,U.circleArray.length,U.circleArray.length/2),null,t.transform.zoom,null,null,null)}z.destroy(),N.destroy()}}var Nn=e.identity(new Float32Array(16));function zn(t,n,r,i,a,o){var s=e.getAnchorAlignment(t),l=-(s.horizontalAlign-.5)*n,u=-(s.verticalAlign-.5)*r,c=e.evaluateVariableOffset(t,i);return new e.Point((l/a+c[0])*o,(u/a+c[1])*o)}function Fn(t,n,r,i,a,o,s,l,u,c,h,f){var d=t.text.placedSymbolArray,p=t.text.dynamicLayoutVertexArray,m=t.icon.dynamicLayoutVertexArray,v={};p.clear();for(var y=0;y<d.length;y++){var g=d.get(y),_=t.allowVerticalPlacement&&!g.placedOrientation,b=g.hidden||!g.crossTileID||_?null:i[g.crossTileID];if(b){var x=new e.Point(g.anchorX,g.anchorY),w=f(x),E=ye(x,r?l:s,w),S=ge(o.cameraToCenterDistance,E.signedDistanceFromCamera),T=a.evaluateSizeForFeature(t.textSizeData,c,g)*S/e.ONE_EM;r&&(T*=t.tilePixelRatio/u);for(var k=b.width,M=b.height,C=zn(b.anchor,k,M,b.textOffset,b.textBoxScale,T),A=r?ye(x.add(C),s,w).point:E.point.add(n?C.rotate(-o.angle):C),I=t.allowVerticalPlacement&&g.placedOrientation===e.WritingMode.vertical?Math.PI/2:0,P=0;P<g.numGlyphs;P++)e.addDynamicAttributes(p,A,I);h&&g.associatedIconIndex>=0&&(v[g.associatedIconIndex]={shiftedAnchor:A,angle:I})}else Me(g.numGlyphs,p)}if(h){m.clear();for(var R=t.icon.placedSymbolArray,L=0;L<R.length;L++){var O=R.get(L);if(O.hidden)Me(O.numGlyphs,m);else{var D=v[L];if(D)for(var N=0;N<O.numGlyphs;N++)e.addDynamicAttributes(m,D.shiftedAnchor,D.angle);else Me(O.numGlyphs,m)}}t.icon.dynamicLayoutVertexBuffer.updateData(m)}t.text.dynamicLayoutVertexBuffer.updateData(p)}function Bn(e,t,n){return n.iconsInText&&t?"symbolTextAndIcon":e?"symbolSDF":"symbolIcon"}function Un(t,n,r,i,a,o,s,l,u,c,h,d){var p,m=t.context,v=m.gl,y=t.transform,g="map"===l,_="map"===u,b=g&&"point"!==r.layout.get("symbol-placement"),x=g&&!_&&!b,w=void 0!==r.layout.get("symbol-sort-key").constantOr(1),E=!1,S=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),T=r.layout.get("text-variable-anchor"),k=[],M=t.terrain&&_?["PITCH_WITH_MAP_TERRAIN"]:null,C=f(i);try{var A=function(){var i=p.value,l=n.getTile(i),u=l.getBucket(r);if(!u)return"continue";var h=a?u.text:u.icon;if(!h||!h.segments.get().length)return"continue";var d=h.programConfigurations.get(r.id),m=a||u.sdfIcons,S=a?u.textSizeData:u.iconSizeData,C=_||0!==y.pitch,A=t.useProgram(Bn(m,a,u),d,M),I=e.evaluateSizeForZoom(S,y.zoom),P=void 0,R=void 0,L=void 0,O=void 0,D=[0,0],N=null;if(a){if(R=l.glyphAtlasTexture,L=v.LINEAR,P=l.glyphAtlasTexture.size,u.iconsInText){D=l.imageAtlasTexture.size,N=l.imageAtlasTexture;var z="composite"===S.kind||"camera"===S.kind;O=C||t.options.rotating||t.options.zooming||z?v.LINEAR:v.NEAREST}}else{var B=1!==r.layout.get("icon-size").constantOr(0)||u.iconsNeedLinear;R=l.imageAtlasTexture,L=m||t.options.rotating||t.options.zooming||B||C?v.LINEAR:v.NEAREST,P=l.imageAtlasTexture.size}var U=F(l,1,t.transform.zoom),j=me(i.posMatrix,_,g,t.transform,U),V=t.terrain&&_&&b?e.invert(new Float32Array(16),j):Nn,H=ve(i.posMatrix,_,g,t.transform,U),G=T&&u.hasTextData(),W="none"!==r.layout.get("icon-text-fit")&&G&&u.hasIconData();if(b){var q=y.elevation;be(u,i.posMatrix,t,a,j,H,_,c,q?function(e){return q.getAtTileOffset(i,e.x,e.y)}:null)}var X=t.translatePosMatrix(i.posMatrix,l,o,s),Z=b||a&&T||W?Nn:j,K=t.translatePosMatrix(H,l,o,s,!0),Y=m&&0!==r.paint.get(a?"text-halo-width":"icon-halo-width").constantOr(1),J={program:A,buffers:h,uniformValues:m?u.iconsInText?Pn(S.kind,I,x,_,t,X,Z,K,P,D):In(S.kind,I,x,_,t,X,Z,K,a,P,!0):An(S.kind,I,x,_,t,X,Z,K,a,P),atlasTexture:R,atlasTextureIcon:N,atlasInterpolation:L,atlasInterpolationIcon:O,isSDF:m,hasHalo:Y,tile:l,labelPlaneMatrixInv:V};if(w&&u.canOverlap){E=!0;var Q,$=h.segments.get(),ee=f($);try{for(ee.s();!(Q=ee.n()).done;){var te=Q.value;k.push({segments:new e.SegmentVector([te]),sortKey:te.sortKey,state:J})}}catch(ne){ee.e(ne)}finally{ee.f()}}else k.push({segments:h.segments,sortKey:0,state:J})};for(C.s();!(p=C.n()).done;)A()}catch(D){C.e(D)}finally{C.f()}E&&k.sort((function(e,t){return e.sortKey-t.sortKey}));for(var I=0,P=k;I<P.length;I++){var R=P[I],L=R.state;if(t.terrain&&t.terrain.setupElevationDraw(L.tile,L.program,{useDepthForOcclusion:!0,labelPlaneMatrixInv:L.labelPlaneMatrixInv}),m.activeTexture.set(v.TEXTURE0),L.atlasTexture.bind(L.atlasInterpolation,v.CLAMP_TO_EDGE),L.atlasTextureIcon&&(m.activeTexture.set(v.TEXTURE1),L.atlasTextureIcon&&L.atlasTextureIcon.bind(L.atlasInterpolationIcon,v.CLAMP_TO_EDGE)),L.isSDF){var O=L.uniformValues;L.hasHalo&&(O.u_is_halo=1,jn(L.buffers,R.segments,r,t,L.program,S,h,d,O)),O.u_is_halo=0}jn(L.buffers,R.segments,r,t,L.program,S,h,d,L.uniformValues)}}function jn(t,n,r,i,a,o,s,l,u){var c=i.context;a.draw(c,c.gl.TRIANGLES,o,s,l,e.CullFaceMode.disabled,u,r.id,t.layoutVertexBuffer,t.indexBuffer,n,r.paint,i.transform.zoom,t.programConfigurations.get(r.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function Vn(t,n,r,i,a,o,s){var l,u,c,h,d,p=t.context.gl,m=r.paint.get("fill-pattern"),v=m&&m.constantOr(1),y=r.getCrossfadeParameters();s?(u=v&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",l=p.LINES):(u=v?"fillPattern":"fill",l=p.TRIANGLES);var g,_=f(i);try{for(_.s();!(g=_.n()).done;){var b=g.value,x=n.getTile(b);if(!v||x.patternsLoaded()){var w=x.getBucket(r);if(w){t.prepareDrawTile(b);var E=w.programConfigurations.get(r.id),S=t.useProgram(u,E);v&&(t.context.activeTexture.set(p.TEXTURE0),x.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),E.updatePaintBuffers(y));var T=m.constantOr(null);if(T&&x.imageAtlas){var k=x.imageAtlas,M=k.patternPositions[T.to.toString()],C=k.patternPositions[T.from.toString()];M&&C&&E.setConstantPatternPositions(M,C)}var A=t.translatePosMatrix(b.posMatrix,x,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(s){h=w.indexBuffer2,d=w.segments2;var I=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[p.drawingBufferWidth,p.drawingBufferHeight];c="fillOutlinePattern"===u&&v?pn(A,t,y,x,I):dn(A,I)}else h=w.indexBuffer,d=w.segments,c=v?fn(A,t,y,x):hn(A);S.draw(t.context,l,a,t.stencilModeForClipping(b),o,e.CullFaceMode.disabled,c,r.id,w.layoutVertexBuffer,h,d,r.paint,t.transform.zoom,E)}}}}catch(P){_.e(P)}finally{_.f()}}function Hn(t,n,r,i,a,o,s){var l,u=t.context,c=u.gl,h=r.paint.get("fill-extrusion-pattern"),d=h.constantOr(1),p=r.getCrossfadeParameters(),m=r.paint.get("fill-extrusion-opacity"),v=f(i);try{for(v.s();!(l=v.n()).done;){var y=l.value,g=n.getTile(y),_=g.getBucket(r);if(_){var b=_.programConfigurations.get(r.id),x=t.useProgram(d?"fillExtrusionPattern":"fillExtrusion",b);if(t.terrain){var w=t.terrain;if(!_.enableTerrain)continue;if(w.setupElevationDraw(g,x,{useMeterToDem:!0}),Gn(u,n,y,_,r,w),!_.centroidVertexBuffer){var E=x.attributes.a_centroid_pos;void 0!==E&&c.vertexAttrib2f(E,0,0)}}d&&(t.context.activeTexture.set(c.TEXTURE0),g.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),b.updatePaintBuffers(p));var S=h.constantOr(null);if(S&&g.imageAtlas){var T=g.imageAtlas,k=T.patternPositions[S.to.toString()],M=T.patternPositions[S.from.toString()];k&&M&&b.setConstantPatternPositions(k,M)}var C=t.translatePosMatrix(y.posMatrix,g,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),A=r.paint.get("fill-extrusion-vertical-gradient"),I=d?cn(C,t,A,m,y,p,g):un(C,t,A,m);x.draw(u,u.gl.TRIANGLES,a,o,s,e.CullFaceMode.backCCW,I,r.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,r.paint,t.transform.zoom,b,t.terrain?_.centroidVertexBuffer:null)}}}catch(P){v.e(P)}finally{v.f()}}function Gn(t,n,r,i,a,o){for(var s,l,u,c=[function(t){var n=t.canonical.x-1,r=t.wrap;return n<0&&(n=(1<<t.canonical.z)-1,r--),new e.OverscaledTileID(t.overscaledZ,r,t.canonical.z,n,t.canonical.y)},function(t){var n=t.canonical.x+1,r=t.wrap;return n===1<<t.canonical.z&&(n=0,r++),new e.OverscaledTileID(t.overscaledZ,r,t.canonical.z,n,t.canonical.y)},function(t){return new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(0===t.canonical.y?1<<t.canonical.z:t.canonical.y)-1)},function(t){return new e.OverscaledTileID(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)}],h=function(e){for(var t=n.getSource().maxzoom,r=0,i=[0,-1,1];r<i.length;r++){var o=i[r];if(!(e.overscaledZ+o<t)&&!(o>0&&e.overscaledZ<t)){var s=n.getTileByID(e.calculateScaledKey(e.overscaledZ+o));if(s&&s.hasData()){var l=s.getBucket(a);if(l)return l}}}},f=[0,0,0],d=function(t,n){return f[0]=Math.min(t.min.y,n.min.y),f[1]=Math.max(t.max.y,n.max.y),f[2]=e.EXTENT-n.min.x>t.max.x?n.min.x-e.EXTENT:t.max.x,f},p=function(t,n){return f[0]=Math.min(t.min.x,n.min.x),f[1]=Math.max(t.max.x,n.max.x),f[2]=e.EXTENT-n.min.y>t.max.y?n.min.y-e.EXTENT:t.max.y,f},m=[function(e,t){return d(e,t)},function(e,t){return d(t,e)},function(e,t){return p(e,t)},function(e,t){return p(t,e)}],v=new e.Point(0,0),y=function(t,n,i,a,c){var h=[[a?i:t,a?t:i,0],[a?i:n,a?n:i,0]],f=c<0?e.EXTENT+c:c,d=[a?f:(t+n)/2,a?(t+n)/2:f,0];return 0===i&&c<0||0!==i&&c>0?o.getForTilePoints(u,[d],!0,l):h.push(d),o.getForTilePoints(r,h,!0,s),Math.max(h[0][2],h[1][2],d[2])/o.exaggeration()},g=0;g<4;g++){var _=i.borders[g];if(0===_.length&&(i.borderDone[g]=!0),!i.borderDone[g]){var b=u=c[g](r),x=h(b);if(x&&x.enableTerrain&&(l=o.findDEMTileFor(b))&&l.dem){if(!s){var w=o.findDEMTileFor(r);if(!w||!w.dem)return;s=w}for(var E=(g<2?1:5)-g,S=x.borders[E],T=0,k=0;k<_.length;k++){for(var M=i.featuresOnBorder[_[k]],C=M.borders[g],A=void 0;T<S.length&&!((A=x.featuresOnBorder[S[T]]).borders[E][1]>C[0]+3);)x.borderDone[E]||x.encodeCentroid(void 0,A,!1),T++;if(A&&T<S.length){for(var I=T,P=0;!(A.borders[E][0]>C[1]-3)&&(P++,++T!==S.length);)A=x.featuresOnBorder[S[T]];if(A=x.featuresOnBorder[S[I]],M.intersectsCount()>1||A.intersectsCount()>1||1!==P){1!==P&&(T=I),i.encodeCentroid(void 0,M,!1),x.borderDone[E]||x.encodeCentroid(void 0,A,!1);continue}var R=m[g](M,A),L=g%2?e.EXTENT-1:0;v.x=y(R[0],Math.min(e.EXTENT-1,R[1]),L,g<2,R[2]),v.y=0,i.encodeCentroid(v,M,!1),x.borderDone[E]||x.encodeCentroid(v,A,!1)}else i.encodeCentroid(void 0,M,!1)}i.borderDone[g]=i.needsCentroidUpdate=!0,x.borderDone[E]||(x.borderDone[E]=x.needsCentroidUpdate=!0)}}}(i.needsCentroidUpdate||!i.centroidVertexBuffer&&0!==i.centroidVertexArray.length)&&i.uploadCentroid(t)}var Wn=new e.Color(1,0,0,1),qn=new e.Color(0,1,0,1),Xn=new e.Color(0,0,1,1),Zn=new e.Color(1,0,1,1),Kn=new e.Color(0,1,1,1);function Yn(e,t,n,r){Qn(e,0,t+n/2,e.transform.width,n,r)}function Jn(e,t,n,r){Qn(e,t-n/2,0,n,e.transform.height,r)}function Qn(t,n,r,i,a,o){var s=t.context,l=s.gl;l.enable(l.SCISSOR_TEST),l.scissor(n*e.browser.devicePixelRatio,r*e.browser.devicePixelRatio,i*e.browser.devicePixelRatio,a*e.browser.devicePixelRatio),s.clear({color:o}),l.disable(l.SCISSOR_TEST)}function $n(t,n,r){var i=t.context,a=i.gl,o=r.posMatrix,s=t.useProgram("debug"),l=n.getTileByID(r.key);t.terrain&&t.terrain.setupElevationDraw(l,s);var u=e.DepthMode.disabled,c=e.StencilMode.disabled,h=t.colorModeForRenderPass();i.activeTexture.set(a.TEXTURE0),t.emptyTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),s.draw(i,a.LINE_STRIP,u,c,h,e.CullFaceMode.disabled,gn(o,e.Color.red),"$debug",t.debugBuffer,t.tileBorderIndexBuffer,t.debugSegments);var f=l.latestRawTileData,d=Math.floor((f&&f.byteLength||0)/1024),p=n.getTile(r).tileSize,m=512/Math.min(p,512)*(r.overscaledZ/t.transform.zoom)*.5,v=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(v+=" => ".concat(r.overscaledZ)),function(e,t){e.initDebugOverlayCanvas();var n=e.debugOverlayCanvas,r=e.context.gl,i=e.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,n.width,n.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(t,5,5),i.strokeText(t,5,5),e.debugOverlayTexture.update(n),e.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(t,"".concat(v," ").concat(d,"kb")),s.draw(i,a.TRIANGLES,u,c,e.ColorMode.alphaBlended,e.CullFaceMode.disabled,gn(o,e.Color.transparent,m),"$debug",t.debugBuffer,t.quadTriangleIndexBuffer,t.debugSegments)}var er=e.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]).members;function tr(e,t,n,r){e.emplaceBack(t,n,r)}var nr=function t(n){v(this,t),this.vertexArray=new e.StructArrayLayout3f12,this.indices=new e.StructArrayLayout3ui6,tr(this.vertexArray,-1,-1,1),tr(this.vertexArray,1,-1,1),tr(this.vertexArray,-1,1,1),tr(this.vertexArray,1,1,1),tr(this.vertexArray,-1,-1,-1),tr(this.vertexArray,1,-1,-1),tr(this.vertexArray,-1,1,-1),tr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=n.createVertexBuffer(this.vertexArray,er),this.indexBuffer=n.createIndexBuffer(this.indices),this.segment=e.SegmentVector.simpleSegment(0,0,36,12)};function rr(t,n,r,i,a,o){var s=t.gl,l=n.paint.get("sky-atmosphere-color"),u=n.paint.get("sky-atmosphere-halo-color"),c=n.paint.get("sky-atmosphere-sun-intensity"),h=function(e,t,n,r,i){return{u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:n,u_color_tint_r:[r.r,r.g,r.b,r.a],u_color_tint_m:[i.r,i.g,i.b,i.a],u_luminance:5e-5}}(e.fromMat4([],i),a,c,l,u);s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+o,n.skyboxTexture,0),r.draw(t,s.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,e.ColorMode.unblended,e.CullFaceMode.frontCW,h,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}var ir={symbol:function(t,n,r,i,a){if("translucent"===t.renderPass){var o=e.StencilMode.disabled,s=t.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(t,n,r,i,a,o,s){var l,u=n.transform,c="map"===a,h="map"===o,d=f(t);try{var p=function(){var t=l.value,a=i.getTile(t),o=a.getBucket(r);if(!o||!o.text||!o.text.segments.get().length)return"continue";var f=e.evaluateSizeForZoom(o.textSizeData,u.zoom),d=F(a,1,n.transform.zoom),p=me(t.posMatrix,h,c,n.transform,d),m="none"!==r.layout.get("icon-text-fit")&&o.hasIconData();if(f){var v=Math.pow(2,u.zoom-a.tileID.overscaledZ),y=u.elevation;Fn(o,c,h,s,e.symbolSize,u,p,t.posMatrix,v,f,m,y?function(e){return y.getAtTileOffset(t,e.x,e.y)}:function(e){return 0})}};for(d.s();!(l=d.n()).done;)p()}catch(m){d.e(m)}finally{d.f()}}(i,t,r,n,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),a),0!==r.paint.get("icon-opacity").constantOr(1)&&Un(t,n,r,i,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),o,s),0!==r.paint.get("text-opacity").constantOr(1)&&Un(t,n,r,i,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),o,s),n.map.showCollisionBoxes&&(Dn(t,n,r,i,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),Dn(t,n,r,i,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))}},circle:function(t,n,r,i){if("translucent"===t.renderPass){var a=r.paint.get("circle-opacity"),o=r.paint.get("circle-stroke-width"),s=r.paint.get("circle-stroke-opacity"),l=void 0!==r.layout.get("circle-sort-key").constantOr(1);if(0!==a.constantOr(1)||0!==o.constantOr(1)&&0!==s.constantOr(1)){for(var u=t.context,c=u.gl,h=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),d=e.StencilMode.disabled,p=t.colorModeForRenderPass(),m=[],v=0;v<i.length;v++){var y=i[v],g=n.getTile(y),_=g.getBucket(r);if(_){var b=_.programConfigurations.get(r.id),x=vn(r),w={programConfiguration:b,program:t.useProgram("circle",b,x),layoutVertexBuffer:_.layoutVertexBuffer,indexBuffer:_.indexBuffer,uniformValues:mn(t,y,g,r),tile:g};if(l){var E,S=_.segments.get(),T=f(S);try{for(T.s();!(E=T.n()).done;){var k=E.value;m.push({segments:new e.SegmentVector([k]),sortKey:k.sortKey,state:w})}}catch(F){T.e(F)}finally{T.f()}}else m.push({segments:_.segments,sortKey:0,state:w})}}l&&m.sort((function(e,t){return e.sortKey-t.sortKey}));for(var M=0,C=m;M<C.length;M++){var A=C[M],I=A.state,P=I.programConfiguration,R=I.program,L=I.layoutVertexBuffer,O=I.indexBuffer,D=I.uniformValues,N=I.tile,z=A.segments;t.terrain&&t.terrain.setupElevationDraw(N,R,{useDepthForOcclusion:!0}),R.draw(u,c.TRIANGLES,h,d,p,e.CullFaceMode.disabled,D,r.id,L,O,z,r.paint,t.transform.zoom,P)}}}},heatmap:function(t,n,r,i){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){var a=t.context,o=a.gl,s=e.StencilMode.disabled,l=new e.ColorMode([o.ONE,o.ONE],e.Color.transparent,[!0,!0,!0,!0]);!function(e,t,n){var r=e.gl;e.activeTexture.set(r.TEXTURE1),e.viewport.set([0,0,t.width/4,t.height/4]);var i=n.heatmapFbo;if(i)r.bindTexture(r.TEXTURE_2D,i.colorAttachment.get()),e.bindFramebuffer.set(i.framebuffer);else{var a=r.createTexture();r.bindTexture(r.TEXTURE_2D,a),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),i=n.heatmapFbo=e.createFramebuffer(t.width/4,t.height/4,!1),function(e,t,n,r){var i=e.gl;i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t.width/4,t.height/4,0,i.RGBA,e.extRenderToTextureHalfFloat?e.extTextureHalfFloat.HALF_FLOAT_OES:i.UNSIGNED_BYTE,null),r.colorAttachment.set(n)}(e,t,a,i)}}(a,t,r),a.clear({color:e.Color.transparent});for(var u=0;u<i.length;u++){var c=i[u];if(!n.hasRenderableParent(c)){var h=n.getTile(c),f=h.getBucket(r);if(f){var d=f.programConfigurations.get(r.id),p=t.useProgram("heatmap",d),m=t.transform.zoom;t.terrain&&t.terrain.setupElevationDraw(h,p),p.draw(a,o.TRIANGLES,e.DepthMode.disabled,s,l,e.CullFaceMode.disabled,_n(c.posMatrix,h,m,r.paint.get("heatmap-intensity")),r.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,r.paint,t.transform.zoom,d)}}}a.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,n){var r=t.context,i=r.gl,a=n.heatmapFbo;if(a){r.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,a.colorAttachment.get()),r.activeTexture.set(i.TEXTURE1);var o=n.colorRampTexture;o||(o=n.colorRampTexture=new e.Texture(r,n.colorRamp,i.RGBA)),o.bind(i.LINEAR,i.CLAMP_TO_EDGE),t.useProgram("heatmapTexture").draw(r,i.TRIANGLES,e.DepthMode.disabled,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.disabled,function(t,n,r,i){var a=e.create();e.ortho(a,0,t.width,t.height,0,0,1);var o=t.context.gl;return{u_matrix:a,u_world:[o.drawingBufferWidth,o.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:n.paint.get("heatmap-opacity")}}(t,n),n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,n.paint,t.transform.zoom)}}(t,r))},line:function(t,n,r,i){if("translucent"===t.renderPass){var a=r.paint.get("line-opacity"),o=r.paint.get("line-width");if(0!==a.constantOr(1)&&0!==o.constantOr(1)){var s,l=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),u=t.colorModeForRenderPass(),c=r.paint.get("line-dasharray"),h=r.paint.get("line-pattern"),d=h.constantOr(1),p=r.paint.get("line-gradient"),m=r.getCrossfadeParameters(),v=d?"linePattern":c?"lineSDF":p?"lineGradient":"line",y=t.context,g=y.gl,_=!0,b=f(i);try{for(b.s();!(s=b.n()).done;){var x=s.value,w=n.getTile(x);if(!d||w.patternsLoaded()){var E=w.getBucket(r);if(E){t.prepareDrawTile(x);var S=E.programConfigurations.get(r.id),T=t.context.program.get(),k=t.useProgram(v,S),M=_||k.program!==T,C=h.constantOr(null);if(C&&w.imageAtlas){var A=w.imageAtlas,I=A.patternPositions[C.to.toString()],P=A.patternPositions[C.from.toString()];I&&P&&S.setConstantPatternPositions(I,P)}var R=t.terrain?x.posMatrix:null,L=d?wn(t,w,r,m,R):c?En(t,w,r,c,m,R):p?xn(t,w,r,R,E.lineClipsArray.length):bn(t,w,r,R);if(d)y.activeTexture.set(g.TEXTURE0),w.imageAtlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE),S.updatePaintBuffers(m);else if(c&&(M||t.lineAtlas.dirty))y.activeTexture.set(g.TEXTURE0),t.lineAtlas.bind(y);else if(p){var O=E.gradients[r.id],D=O.texture;if(r.gradientVersion!==O.version){var N=256;if(r.stepInterpolant){var z=n.getSource().maxzoom,F=x.canonical.z===z?Math.ceil(1<<t.transform.maxZoom-x.canonical.z):1;N=e.clamp(e.nextPowerOfTwo(E.maxLineLength/e.EXTENT*1024*F),256,y.maxTextureSize)}O.gradient=e.renderColorRamp({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:N,image:O.gradient||void 0,clips:E.lineClipsArray}),O.texture?O.texture.update(O.gradient):O.texture=new e.Texture(y,O.gradient,g.RGBA),O.version=r.gradientVersion,D=O.texture}y.activeTexture.set(g.TEXTURE0),D.bind(r.stepInterpolant?g.NEAREST:g.LINEAR,g.CLAMP_TO_EDGE)}k.draw(y,g.TRIANGLES,l,t.stencilModeForClipping(x),u,e.CullFaceMode.disabled,L,r.id,E.layoutVertexBuffer,E.indexBuffer,E.segments,r.paint,t.transform.zoom,S,E.layoutVertexBuffer2),_=!1}}}}catch(B){b.e(B)}finally{b.f()}}}},fill:function(t,n,r,i){var a=r.paint.get("fill-color"),o=r.paint.get("fill-opacity");if(0!==o.constantOr(1)){var s=t.colorModeForRenderPass(),l=r.paint.get("fill-pattern"),u=t.opaquePassEnabledForLayer()&&!l.constantOr(1)&&1===a.constantOr(e.Color.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";if(t.renderPass===u){var c=t.depthModeForSublayer(1,"opaque"===t.renderPass?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly);Vn(t,n,r,i,c,s,!1)}if("translucent"===t.renderPass&&r.paint.get("fill-antialias")){var h=t.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,e.DepthMode.ReadOnly);Vn(t,n,r,i,h,s,!0)}}},"fill-extrusion":function(t,n,r,i){var a=r.paint.get("fill-extrusion-opacity");if(0!==a&&"translucent"===t.renderPass){var o=new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D);if(1!==a||r.paint.get("fill-extrusion-pattern").constantOr(1))Hn(t,n,r,i,o,e.StencilMode.disabled,e.ColorMode.disabled),Hn(t,n,r,i,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var s=t.colorModeForRenderPass();Hn(t,n,r,i,o,e.StencilMode.disabled,s)}}},hillshade:function(t,n,r,i){if("offscreen"===t.renderPass||"translucent"===t.renderPass){var a,o=t.context,s=t.depthModeForSublayer(0,e.DepthMode.ReadOnly),l=t.colorModeForRenderPass(),u=t.terrain&&t.terrain.renderingToTexture,c="translucent"!==t.renderPass||u?[{},i]:t.stencilConfigForOverlap(i),d=h(c,2),p=d[0],m=d[1],v=f(m);try{for(v.s();!(a=v.n()).done;){var y=a.value,g=n.getTile(y);if(g.needsHillshadePrepare&&"offscreen"===t.renderPass)qt(t,g,r,s,e.StencilMode.disabled,l);else if("translucent"===t.renderPass){var _=u&&t.terrain?t.terrain.stencilModeForRTTOverlap(y):p[y.overscaledZ];Gt(t,y,g,r,s,_,l)}}}catch(b){v.e(b)}finally{v.f()}o.viewport.set([0,0,t.width,t.height])}},raster:function(t,n,r,i,a,o){if("translucent"===t.renderPass&&0!==r.paint.get("raster-opacity")&&i.length){var s,l=t.context,u=l.gl,c=n.getSource(),d=t.useProgram("raster"),p=t.colorModeForRenderPass(),m=t.terrain&&t.terrain.renderingToTexture,v=c instanceof W||m?[{},i]:t.stencilConfigForOverlap(i),y=h(v,2),g=y[0],_=y[1],b=_[_.length-1].overscaledZ,x=!t.options.moving,w=f(_);try{for(w.s();!(s=w.n()).done;){var E=s.value,S=m?e.DepthMode.disabled:t.depthModeForSublayer(E.overscaledZ-b,1===r.paint.get("raster-opacity")?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly,u.LESS),T=n.getTile(E);if(!m||T&&T.hasData()){var k=m?E.posMatrix:t.transform.calculatePosMatrix(E.toUnwrapped(),x),M=t.terrain&&m?t.terrain.stencilModeForRTTOverlap(E):g[E.overscaledZ],C=o?0:r.paint.get("raster-fade-duration");T.registerFadeDuration(C);var A=n.findLoadedParent(E,0),I=en(T,A,n,t.transform,C),P=void 0,R=void 0;t.terrain&&t.terrain.prepareDrawTile(E);var L="nearest"===r.paint.get("raster-resampling")?u.NEAREST:u.LINEAR;l.activeTexture.set(u.TEXTURE0),T.texture.bind(L,u.CLAMP_TO_EDGE,u.LINEAR_MIPMAP_NEAREST),l.activeTexture.set(u.TEXTURE1),A?(A.texture.bind(L,u.CLAMP_TO_EDGE,u.LINEAR_MIPMAP_NEAREST),P=Math.pow(2,A.tileID.overscaledZ-T.tileID.overscaledZ),R=[T.tileID.canonical.x*P%1,T.tileID.canonical.y*P%1]):T.texture.bind(L,u.CLAMP_TO_EDGE,u.LINEAR_MIPMAP_NEAREST);var O=kn(k,R||[0,0],P||1,I,r);c instanceof W?d.draw(l,u.TRIANGLES,S,e.StencilMode.disabled,p,e.CullFaceMode.disabled,O,r.id,c.boundsBuffer,t.quadTriangleIndexBuffer,c.boundsSegments):d.draw(l,u.TRIANGLES,S,M,p,e.CullFaceMode.disabled,O,r.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}}}catch(D){w.e(D)}finally{w.f()}}},background:function(t,n,r,i){var a=r.paint.get("background-color"),o=r.paint.get("background-opacity");if(0!==o){var s=t.context,l=s.gl,u=t.transform,c=u.tileSize,h=r.paint.get("background-pattern");if(!t.isPatternMissing(h)){var d=!h&&1===a.a&&1===o&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass===d){var p=e.StencilMode.disabled,m=t.depthModeForSublayer(0,"opaque"===d?e.DepthMode.ReadWrite:e.DepthMode.ReadOnly),v=t.colorModeForRenderPass(),y=t.useProgram(h?"backgroundPattern":"background"),g=i||u.coveringTiles({tileSize:c});h&&(s.activeTexture.set(l.TEXTURE0),t.imageManager.bind(t.context));var _,b=r.getCrossfadeParameters(),x=f(g);try{for(x.s();!(_=x.n()).done;){var w=_.value,E=i?w.posMatrix:t.transform.calculatePosMatrix(w.toUnwrapped());t.prepareDrawTile(w);var S=h?Ln(E,o,t,h,{tileID:w,tileSize:c},b):Rn(E,o,a);y.draw(s,l.TRIANGLES,m,p,v,e.CullFaceMode.disabled,S,r.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}catch(T){x.e(T)}finally{x.f()}}}}},sky:function(t,n,r){var i=r.paint.get("sky-opacity");if(0!==i){var a=t.context,o=r.paint.get("sky-type"),s=new e.DepthMode(a.gl.LEQUAL,e.DepthMode.ReadOnly,[0,1]),l=t.frameCounter/1e3%1;"atmosphere"===o?"offscreen"===t.renderPass?r.needsSkyboxCapture(t)&&(function(t,n,r,i){var a=t.context,o=a.gl,s=n.skyboxFbo;if(!s){s=n.skyboxFbo=a.createFramebuffer(32,32,!1),n.skyboxGeometry=new nr(a),n.skyboxTexture=a.gl.createTexture(),o.bindTexture(o.TEXTURE_CUBE_MAP,n.skyboxTexture),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_S,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_WRAP_T,o.CLAMP_TO_EDGE),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MIN_FILTER,o.LINEAR),o.texParameteri(o.TEXTURE_CUBE_MAP,o.TEXTURE_MAG_FILTER,o.LINEAR);for(var l=0;l<6;++l)o.texImage2D(o.TEXTURE_CUBE_MAP_POSITIVE_X+l,0,o.RGBA,32,32,0,o.RGBA,o.UNSIGNED_BYTE,null)}a.bindFramebuffer.set(s.framebuffer),a.viewport.set([0,0,32,32]);var u=n.getCenter(t,!0),c=t.useProgram("skyboxCapture"),h=new Float64Array(16);e.identity(h),e.rotateY(h,h,.5*-Math.PI),rr(a,n,c,h,u,0),e.identity(h),e.rotateY(h,h,.5*Math.PI),rr(a,n,c,h,u,1),e.identity(h),e.rotateX(h,h,.5*-Math.PI),rr(a,n,c,h,u,2),e.identity(h),e.rotateX(h,h,.5*Math.PI),rr(a,n,c,h,u,3),e.identity(h),rr(a,n,c,h,u,4),e.identity(h),e.rotateY(h,h,Math.PI),rr(a,n,c,h,u,5),a.viewport.set([0,0,t.width,t.height])}(t,r),r.markSkyboxValid(t)):"sky"===t.renderPass&&function(t,n,r,i,a){var o=t.context,s=o.gl,l=t.transform,u=t.useProgram("skybox");o.activeTexture.set(s.TEXTURE0),s.bindTexture(s.TEXTURE_CUBE_MAP,n.skyboxTexture);var c=function(e,t,n,r,i){return{u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:r,u_temporal_offset:i}}(l.skyboxMatrix,n.getCenter(t,!1),0,i,a);u.draw(o,s.TRIANGLES,r,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,c,"skybox",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(t,r,s,i,l):"gradient"===o&&"sky"===t.renderPass&&function(t,n,r,i,a){var o=t.context,s=o.gl,l=t.transform,u=t.useProgram("skyboxGradient");n.skyboxGeometry||(n.skyboxGeometry=new nr(o)),o.activeTexture.set(s.TEXTURE0);var c=n.colorRampTexture;c||(c=n.colorRampTexture=new e.Texture(o,n.colorRamp,s.RGBA)),c.bind(s.LINEAR,s.CLAMP_TO_EDGE);var h=function(t,n,r,i,a){return{u_matrix:t,u_color_ramp:0,u_center_direction:n,u_radius:e.degToRad(r),u_opacity:i,u_temporal_offset:a}}(l.skyboxMatrix,n.getCenter(t,!1),n.paint.get("sky-gradient-radius"),i,a);u.draw(o,s.TRIANGLES,r,e.StencilMode.disabled,t.colorModeForRenderPass(),e.CullFaceMode.backCW,h,"skyboxGradient",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(t,r,s,i,l)}},debug:function(e,t,n){for(var r=0;r<n.length;r++)$n(e,t,n[r])},custom:function(t,n,r){var i=t.context,a=r.implementation;if("offscreen"===t.renderPass){var o=a.prerender;o&&(t.setCustomLayerDefaults(),i.setColorMode(t.colorModeForRenderPass()),o.call(a,i.gl,t.transform.customLayerMatrix()),i.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),i.setColorMode(t.colorModeForRenderPass()),i.setStencilMode(e.StencilMode.disabled);var s="3d"===a.renderingMode?new e.DepthMode(t.context.gl.LEQUAL,e.DepthMode.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,e.DepthMode.ReadOnly);i.setDepthMode(s),a.render(i.gl,t.transform.customLayerMatrix()),i.setDirty(),t.setBaseState(),i.bindFramebuffer.set(null)}}},ar=function(){function t(n,r){v(this,t),this.context=new e.Context(n),this.transform=r,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=e.SourceCache.maxUnderzooming+e.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new tt,this.gpuTimers={},this.frameCounter=0}return y(t,[{key:"updateTerrain",value:function(e,t){var n=!!e&&!!e.terrain;if(n||this._terrain&&this._terrain.enabled){this._terrain||(this._terrain=new an(this,e));var r=this._terrain;this.transform.elevation=n?r:null,r.update(e,this.transform,t)}}},{key:"resize",value:function(t,n){if(this.width=t*e.browser.devicePixelRatio,this.height=n*e.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style){var r,i=f(this.style._order);try{for(i.s();!(r=i.n()).done;){var a=r.value;this.style._layers[a].resize()}}catch(o){i.e(o)}finally{i.f()}}}},{key:"setup",value:function(){var t=this.context,n=new e.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(e.EXTENT,0),n.emplaceBack(0,e.EXTENT),n.emplaceBack(e.EXTENT,e.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(n,e.posAttributes.members),this.tileExtentSegments=e.SegmentVector.simpleSegment(0,0,4,2);var r=new e.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(e.EXTENT,0),r.emplaceBack(0,e.EXTENT),r.emplaceBack(e.EXTENT,e.EXTENT),this.debugBuffer=t.createVertexBuffer(r,e.posAttributes.members),this.debugSegments=e.SegmentVector.simpleSegment(0,0,4,5);var i=new e.StructArrayLayout4i8;i.emplaceBack(0,0,0,0),i.emplaceBack(e.EXTENT,0,e.EXTENT,0),i.emplaceBack(0,e.EXTENT,0,e.EXTENT),i.emplaceBack(e.EXTENT,e.EXTENT,e.EXTENT,e.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(i,G.members),this.rasterBoundsSegments=e.SegmentVector.simpleSegment(0,0,4,2);var a=new e.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(1,0),a.emplaceBack(0,1),a.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(a,e.posAttributes.members),this.viewportSegments=e.SegmentVector.simpleSegment(0,0,4,2);var o=new e.StructArrayLayout1ui2;o.emplaceBack(0),o.emplaceBack(1),o.emplaceBack(3),o.emplaceBack(2),o.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(o);var s=new e.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(s),this.emptyTexture=new e.Texture(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);var l=this.context.gl;this.stencilClearMode=new e.StencilMode({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(e.window.performance.now())}},{key:"clearStencil",value:function(){var t=this.context,n=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var r=e.create();e.ortho(r,0,this.width,this.height,0,0,1),e.scale(r,r,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,n.TRIANGLES,e.DepthMode.disabled,this.stencilClearMode,e.ColorMode.disabled,e.CullFaceMode.disabled,$t(r),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}},{key:"_renderTileClippingMasks",value:function(t,n,r){if(n&&this.currentStencilSource!==n.id&&t.isTileClipped()&&r&&r.length){this.currentStencilSource=n.id;var i=this.context,a=i.gl;this.nextStencilID+r.length>256&&this.clearStencil(),i.setColorMode(e.ColorMode.disabled),i.setDepthMode(e.DepthMode.disabled);var o=this.useProgram("clippingMask");this._tileClippingMaskIDs={};var s,l=f(r);try{for(l.s();!(s=l.n()).done;){var u=s.value,c=this._tileClippingMaskIDs[u.key]=this.nextStencilID++;o.draw(i,a.TRIANGLES,e.DepthMode.disabled,new e.StencilMode({func:a.ALWAYS,mask:0},c,255,a.KEEP,a.KEEP,a.REPLACE),e.ColorMode.disabled,e.CullFaceMode.disabled,$t(u.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}catch(h){l.e(h)}finally{l.f()}}}},{key:"stencilModeFor3D",value:function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,n=this.context.gl;return new e.StencilMode({func:n.NOTEQUAL,mask:255},t,255,n.KEEP,n.KEEP,n.REPLACE)}},{key:"stencilModeForClipping",value:function(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);var n=this.context.gl;return new e.StencilMode({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,n.KEEP,n.KEEP,n.REPLACE)}},{key:"stencilConfigForOverlap",value:function(t){var n=this.context.gl,i=t.sort((function(e,t){return t.overscaledZ-e.overscaledZ})),a=i[i.length-1].overscaledZ,o=i[0].overscaledZ-a+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();for(var s={},l=0;l<o;l++)s[l+a]=new e.StencilMode({func:n.GEQUAL,mask:255},l+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=o,[s,i]}return[r({},a,e.StencilMode.disabled),i]}},{key:"colorModeForRenderPass",value:function(){var t=this.context.gl;if(this._showOverdrawInspector){var n=1/8;return new e.ColorMode([t.CONSTANT_COLOR,t.ONE],new e.Color(n,n,n,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?e.ColorMode.unblended:e.ColorMode.alphaBlended}},{key:"depthModeForSublayer",value:function(t,n,r){if(!this.opaquePassEnabledForLayer())return e.DepthMode.disabled;var i=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new e.DepthMode(r||this.context.gl.LEQUAL,n,[i,i])}},{key:"opaquePassEnabledForLayer",value:function(){return this.currentLayer<this.opaquePassCutoff}},{key:"render",value:function(t,n){var r=this;this.style=t,this.options=n,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.browser.now()),this.imageManager.beginFrame();var i=this.style._order,a=this.style._sourceCaches;for(var o in a){var s=a[o];s.used&&s.prepare(this.context)}var l={},u={},c={};for(var h in a){var d=a[h];l[h]=d.getVisibleCoordinates(),u[h]=l[h].slice().reverse(),c[h]=d.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var p=0;p<i.length;p++)if(this.style._layers[i[p]].is3D()){this.opaquePassCutoff=p;break}this.terrain&&(this.terrain.updateTileBinding(c),this.opaquePassCutoff=0),this.renderPass="offscreen";var m,v=f(i);try{for(v.s();!(m=v.n()).done;){var y=m.value,g=this.style._layers[y],_=t._getLayerSourceCache(g);if(g.hasOffscreenPass()&&!g.isHidden(this.transform.zoom)){var b=_?u[_.id]:void 0;("custom"===g.type||g.isSky()||b&&b.length)&&this.renderLayer(this,_,g,b)}}}catch(I){v.e(I)}finally{v.f()}for(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?e.Color.black:e.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){var x=this.style._layers[i[this.currentLayer]],w=t._getLayerSourceCache(x);if(!(this.terrain&&this.terrain.renderLayer(x,w)||x.isSky())){var E=w?u[w.id]:void 0;this._renderTileClippingMasks(x,w,E),this.renderLayer(this,w,x,E)}}if(this.renderPass="sky",this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){var S=this.style._layers[i[this.currentLayer]],T=t._getLayerSourceCache(S);S.isSky()&&this.renderLayer(this,T,S,T?u[T.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){var k=this.style._layers[i[this.currentLayer]],M=t._getLayerSourceCache(k);if(!(this.terrain&&this.terrain.renderLayer(k,M)||k.isSky())){var C=M?("symbol"===k.type?c:u)[M.id]:void 0;this._renderTileClippingMasks(k,M,M?l[M.id]:void 0),this.renderLayer(this,M,k,C)}}if(this.options.showTileBoundaries||this.options.showQueryGeometry){var A=null;e.values(this.style._layers).forEach((function(e){var n=t._getLayerSourceCache(e);n&&!e.isHidden(r.transform.zoom)&&(!A||A.getSource().maxzoom<n.getSource().maxzoom)&&(A=n)})),A&&this.options.showTileBoundaries&&ir.debug(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(e){var t=e.transform.padding;Yn(e,e.transform.height-(t.top||0),3,Wn),Yn(e,t.bottom||0,3,qn),Jn(e,t.left||0,3,Xn),Jn(e,e.transform.width-(t.right||0),3,Zn);var n=e.transform.centerPoint;!function(e,t,n,r){Qn(e,t-1,n-10,2,20,r),Qn(e,t-10,n-1,20,2,r)}(e,n.x,e.transform.height-n.y,Kn)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%e.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(e.window.performance.now()),this.saveCanvasCopy())}},{key:"renderLayer",value:function(e,t,n,r){n.isHidden(this.transform.zoom)||("background"===n.type||"sky"===n.type||"custom"===n.type||r&&r.length)&&(this.id=n.id,this.gpuTimingStart(n),ir[n.type](e,t,n,r,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}},{key:"gpuTimingStart",value:function(e){if(this.options.gpuTiming){var t=this.context.extTimerQuery,n=this.gpuTimers[e.id];n||(n=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:t.createQueryEXT()}),n.calls++,t.beginQueryEXT(t.TIME_ELAPSED_EXT,n.query)}}},{key:"gpuTimingEnd",value:function(){if(this.options.gpuTiming){var e=this.context.extTimerQuery;e.endQueryEXT(e.TIME_ELAPSED_EXT)}}},{key:"collectGpuTimers",value:function(){var e=this.gpuTimers;return this.gpuTimers={},e}},{key:"queryGpuTimers",value:function(e){var t={};for(var n in e){var r=e[n],i=this.context.extTimerQuery,a=i.getQueryObjectEXT(r.query,i.QUERY_RESULT_EXT)/1e6;i.deleteQueryEXT(r.query),t[n]=a}return t}},{key:"translatePosMatrix",value:function(t,n,r,i,a){if(!r[0]&&!r[1])return t;var o=a?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(o){var s=Math.sin(o),l=Math.cos(o);r=[r[0]*l-r[1]*s,r[0]*s+r[1]*l]}var u=[a?r[0]:F(n,r[0],this.transform.zoom),a?r[1]:F(n,r[1],this.transform.zoom),0],c=new Float32Array(16);return e.translate(c,t,u),c}},{key:"saveTileTexture",value:function(e){var t=this._tileTextures[e.size[0]];t?t.push(e):this._tileTextures[e.size[0]]=[e]}},{key:"getTileTexture",value:function(e){var t=this._tileTextures[e];return t&&t.length>0?t.pop():null}},{key:"isPatternMissing",value:function(e){if(!e)return!1;if(!e.from||!e.to)return!0;var t=this.imageManager.getPattern(e.from.toString()),n=this.imageManager.getPattern(e.to.toString());return!t||!n}},{key:"currentGlobalDefines",value:function(){var e=this.terrain&&this.terrain.renderingToTexture,t=[];return this.terrain&&!this.terrain.renderingToTexture&&t.push("TERRAIN"),e&&t.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&t.push("OVERDRAW_INSPECTOR"),t}},{key:"useProgram",value:function(e,t,n){this.cache=this.cache||{};var r=n||[],i=this.currentGlobalDefines().concat(r),a=sn.cacheKey(e,i,t);return this.cache[a]||(this.cache[a]=new sn(this.context,e,jt[e],t,On[e],i)),this.cache[a]}},{key:"setCustomLayerDefaults",value:function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}},{key:"setBaseState",value:function(){var e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}},{key:"initDebugOverlayCanvas",value:function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=e.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}},{key:"destroy",value:function(){this._terrain&&this._terrain.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}},{key:"prepareDrawTile",value:function(e){this.terrain&&this.terrain.prepareDrawTile(e)}},{key:"setTileLoadedFlag",value:function(e){this.tileLoaded=e}},{key:"saveCanvasCopy",value:function(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}},{key:"canvasCopy",value:function(){var e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}},{key:"getCanvasCopiesAndTimestamps",value:function(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}},{key:"terrain",get:function(){return this._terrain&&this._terrain.enabled?this._terrain:null}}]),t}(),or=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(v(this,t),isNaN(e)||e<0||isNaN(n)||n<0||isNaN(r)||r<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=r,this.right=i}return y(t,[{key:"interpolate",value:function(t,n,r){return null!=n.top&&null!=t.top&&(this.top=e.number(t.top,n.top,r)),null!=n.bottom&&null!=t.bottom&&(this.bottom=e.number(t.bottom,n.bottom,r)),null!=n.left&&null!=t.left&&(this.left=e.number(t.left,n.left,r)),null!=n.right&&null!=t.right&&(this.right=e.number(t.right,n.right,r)),this}},{key:"getCenter",value:function(t,n){var r=e.clamp((this.left+t-this.right)/2,0,t),i=e.clamp((this.top+n-this.bottom)/2,0,n);return new e.Point(r,i)}},{key:"equals",value:function(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}},{key:"clone",value:function(){return new t(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),t}();function sr(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function lr(e,t,n){e[4*t+0]=n[0],e[4*t+1]=n[1],e[4*t+2]=n[2],e[4*t+3]=n[3]}function ur(t,n){var r=sr(t,3);e.fromQuat(t,n),lr(t,3,r)}function cr(e,t){lr(e,3,[t[0],t[1],t[2],1])}function hr(t,n){var r=e.identity$1([]);return e.rotateZ$1(r,r,-n),e.rotateX$1(r,r,-t),r}function fr(t,n){var r=[t[0],t[1],0],i=[n[0],n[1],0];if(e.length(r)>=1e-15){var a=e.normalize([],r);e.scale$2(i,a,e.dot(i,a)),n[0]=i[0],n[1]=i[1]}var o=e.cross([],n,t);if(e.len(o)<1e-15)return null;var s=Math.atan2(-o[1],o[0]);return hr(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),s)}var dr=function(){function t(e,n){v(this,t),this.position=e,this.orientation=n}return y(t,[{key:"lookAtPoint",value:function(t,n){if(this.orientation=null,this.position){var r=this._elevation?this._elevation.getAtPoint(e.MercatorCoordinate.fromLngLat(t)):0,i=this.position,a=e.MercatorCoordinate.fromLngLat(t,r),o=[a.x-i.x,a.y-i.y,a.z-i.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=fr(o,n)}}},{key:"setPitchBearing",value:function(t,n){this.orientation=hr(e.degToRad(t),e.degToRad(-n))}},{key:"position",get:function(){return this._position},set:function(t){this._position=this._renderWorldCopies?function(t){if(t){var n=Array.isArray(t)?new e.MercatorCoordinate(t[0],t[1],t[2]):t;return n.x=e.wrap(n.x,0,1),n}}(t):t}}]),t}(),pr=function(){function t(n,r){v(this,t),this._transform=e.identity([]),this._orientation=e.identity$1([]),r&&(this._orientation=r,ur(this._transform,this._orientation)),n&&cr(this._transform,n)}return y(t,[{key:"getPitchBearing",value:function(){var e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}},{key:"setPitchBearing",value:function(e,t){this._orientation=hr(e,t),ur(this._transform,this._orientation)}},{key:"forward",value:function(){var e=sr(this._transform,2);return[-e[0],-e[1],-e[2]]}},{key:"up",value:function(){var e=sr(this._transform,1);return[-e[0],-e[1],-e[2]]}},{key:"right",value:function(){var e=sr(this._transform,0);return[e[0],e[1],e[2]]}},{key:"getCameraToWorld",value:function(t,n){var r=new Float64Array(16);return e.invert(r,this.getWorldToCamera(t,n)),r}},{key:"getWorldToCamera",value:function(t,n){var r=new Float64Array(16),i=new Float64Array(4),a=this.position;return e.conjugate(i,this._orientation),e.scale$2(a,a,-t),e.fromQuat(r,i),e.translate(r,r,a),r[1]*=-1,r[5]*=-1,r[9]*=-1,r[13]*=-1,r[8]*=n,r[9]*=n,r[10]*=n,r[11]*=n,r}},{key:"getCameraToClipPerspective",value:function(t,n,r,i){var a=new Float64Array(16);return e.perspective(a,t,n,r,i),a}},{key:"clone",value:function(){return new t(c(this.position),c(this.orientation))}},{key:"mercatorPosition",get:function(){var t=this.position;return new e.MercatorCoordinate(t[0],t[1],t[2])}},{key:"position",get:function(){var e=sr(this._transform,3);return[e[0],e[1],e[2]]},set:function(e){cr(this._transform,e)}},{key:"orientation",get:function(){return this._orientation},set:function(e){this._orientation=e,ur(this._transform,this._orientation)}}]),t}(),mr=function(){function t(n,r,i,a,o){v(this,t),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=n||0,this._maxZoom=r||22,this._minPitch=null==i?0:i,this._maxPitch=null==a?60:a,this.setMaxBounds(),this.width=0,this.height=0,this._center=new e.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new or,this._posMatrixCache={},this._alignedPosMatrixCache={},this._camera=new pr,this._centerAltitude=0,this.cameraElevationReference="ground"}return y(t,[{key:"clone",value:function(){var e=new t(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e.tileSize=this.tileSize,e.latRange=this.latRange,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._cameraZoom=this._cameraZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e}},{key:"updateElevation",value:function(e){this._terrainEnabled()&&null==this._cameraZoom&&this._updateCenterElevation()&&this._updateCameraOnTerrain(),e&&this._constrainCameraAltitude(),this._calcMatrices()}},{key:"_setZoom",value:function(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}},{key:"_updateCenterElevation",value:function(){if(!this._elevation)return!1;var t=this._elevation.getAtPoint(e.MercatorCoordinate.fromLngLat(this.center),-1);return-1===t?(this._cameraZoom=null,!1):(this._centerAltitude=t,!0)}},{key:"_updateCameraOnTerrain",value:function(){var t=this.cameraToCenterDistance/this.worldSize,n=e.mercatorZfromAltitude(this._centerAltitude,this.center.lat);this._cameraZoom=this._zoomFromMercatorZ(n+t)}},{key:"_updateZoomFromElevation",value:function(){if(null!=this._cameraZoom&&this._elevation){var t=this._cameraZoom,n=this._elevation.getAtPoint(e.MercatorCoordinate.fromLngLat(this.center)),r=e.mercatorZfromAltitude(n,this.center.lat),i=this._mercatorZfromZoom(t),a=this._mercatorZfromZoom(this._maxZoom),o=Math.max(i-r,a);this._setZoom(this._zoomFromMercatorZ(o))}}},{key:"computeZoomRelativeTo",value:function(t){var n,r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));n=t.z<this._camera.position[2]?[r.x,r.y,r.z]:[t.x,t.y,t.z];var i=e.length(e.sub([],this._camera.position,n));return e.clamp(this._zoomFromMercatorZ(i),this._minZoom,this._maxZoom)}},{key:"setFreeCameraOptions",value:function(t){if(this.height&&(t.position||t.orientation)){this._updateCameraState();var n=!1;if(t.orientation&&!e.exactEquals(t.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(t.orientation)),t.position){var r=[t.position.x,t.position.y,t.position.z];e.exactEquals$1(r,this._camera.position)||(this._setCameraPosition(r),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}}},{key:"getFreeCameraOptions",value:function(){this._updateCameraState();var t=this._camera.position,n=new dr;return n.position=new e.MercatorCoordinate(t[0],t[1],t[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this._renderWorldCopies,n}},{key:"_setCameraOrientation",value:function(t){if(!e.length$1(t))return!1;e.normalize$1(t,t);var n=e.transformQuat([],[0,0,-1],t),r=e.transformQuat([],[0,-1,0],t);if(r[2]<0)return!1;var i=fr(n,r);return!!i&&(this._camera.orientation=i,!0)}},{key:"_setCameraPosition",value:function(t){var n=this.zoomScale(this.minZoom)*this.tileSize,r=this.zoomScale(this.maxZoom)*this.tileSize,i=this.cameraToCenterDistance;t[2]=e.clamp(t[2],i/r,i/n),this._camera.position=t}},{key:"isPaddingEqual",value:function(e){return this._edgeInsets.equals(e)}},{key:"interpolatePadding",value:function(e,t,n){this._unmodified=!1,this._edgeInsets.interpolate(e,t,n),this._constrain(),this._calcMatrices()}},{key:"coveringZoomLevel",value:function(e){var t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}},{key:"getVisibleUnwrappedCoordinates",value:function(t){var n=[new e.UnwrappedTileID(0,t)];if(this._renderWorldCopies)for(var r=this.pointCoordinate(new e.Point(0,0)),i=this.pointCoordinate(new e.Point(this.width,0)),a=this.pointCoordinate(new e.Point(this.width,this.height)),o=this.pointCoordinate(new e.Point(0,this.height)),s=Math.floor(Math.min(r.x,i.x,a.x,o.x)),l=Math.floor(Math.max(r.x,i.x,a.x,o.x)),u=1,c=s-u;c<=l+u;c++)0!==c&&n.push(new e.UnwrappedTileID(c,t));return n}},{key:"coveringTiles",value:function(t){var n=this,r=this.coveringZoomLevel(t),i=r,a=!!t.useElevationData;if(void 0!==t.minzoom&&r<t.minzoom)return[];void 0!==t.maxzoom&&r>t.maxzoom&&(r=t.maxzoom);var o=e.MercatorCoordinate.fromLngLat(this.center),s=1<<r,l=[s*o.x,s*o.y,0],u=e.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r),c=this.pointCoordinate(this.getCameraPoint()),h=s*e.mercatorZfromAltitude(1,this.center.lat),f=this._camera.position[2]/e.mercatorZfromAltitude(1,this.center.lat),d=[s*c.x,s*c.y,f],p=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),m=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation?r:0,v=this.elevation?1e4*this.elevation.exaggeration():0,y=function(t){return{aabb:new e.Aabb([t*s,0,-v],[(t+1)*s,s,v]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}},g=[],_=[],b=r,x=t.reparseOverscaled?i:r,w=function(e,t){if(n._elevation){var r=n._elevation.getMinMaxForTile(t);r&&(e.min[2]=r.min,e.max[2]=r.max,e.center[2]=(e.min[2]+e.max[2])/2)}},E=function(e){return e*e},S=E((f-this._centerAltitude)*h),T=function(e,t){if(t*E(.707)<e)return 1;var n=Math.sqrt(t/e);return n/(1/.707+(Math.pow(1.1,n-1/.707+1)-1)/(1.1-1)-1)};if(this._renderWorldCopies)for(var k=1;k<=3;k++)g.push(y(-k)),g.push(y(k));for(g.push(y(0));g.length>0;){var M=g.pop(),C=M.x,A=M.y,I=M.fullyVisible;if(!I){var P=M.aabb.intersects(u);if(0===P)continue;I=2===P}var R=!0;if(m<=M.zoom&&M.zoom<b){var L=M.aabb.distanceX(d),O=M.aabb.distanceY(d),D=S;a&&(D=E(M.aabb.distanceZ(d)*h));var N=L*L+O*O+D;R=N<E((1<<b-M.zoom)*p*T(Math.max(D,S),N))}if(M.zoom!==b&&R)for(var z=0;z<4;z++){var F=(C<<1)+z%2,B=(A<<1)+(z>>1),U=M.aabb.quadrant(z),j=null;a&&M.zoom>b-6&&w(U,j=new e.OverscaledTileID(M.zoom+1===b?x:M.zoom+1,M.wrap,M.zoom+1,F,B)),g.push({aabb:U,zoom:M.zoom+1,x:F,y:B,wrap:M.wrap,fullyVisible:I,tileID:j})}else{var V=M.zoom===b?x:M.zoom;if(t.minzoom&&t.minzoom>V)continue;var H=l[0]-(.5+C+(M.wrap<<M.zoom))*(1<<r-M.zoom),G=l[1]-.5-A,W=M.tileID?M.tileID:new e.OverscaledTileID(V,M.wrap,M.zoom,C,A);_.push({tileID:W,distanceSq:H*H+G*G})}}return _.sort((function(e,t){return e.distanceSq-t.distanceSq})).map((function(e){return e.tileID}))}},{key:"resize",value:function(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}},{key:"zoomScale",value:function(e){return Math.pow(2,e)}},{key:"scaleZoom",value:function(e){return Math.log(e)/Math.LN2}},{key:"project",value:function(t){var n=e.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new e.Point(e.mercatorXfromLng(t.lng)*this.worldSize,e.mercatorYfromLat(n)*this.worldSize)}},{key:"unproject",value:function(t){return new e.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(t,n){var r=this.pointCoordinate(n),i=this.pointCoordinate(this.centerPoint),a=this.locationCoordinate(t),o=new e.MercatorCoordinate(a.x-(r.x-i.x),a.y-(r.y-i.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"setLocation",value:function(e){this.center=this.coordinateLocation(e),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"locationPoint",value:function(e){return this._coordinatePoint(this.locationCoordinate(e),!1)}},{key:"locationPoint3D",value:function(e){return this._coordinatePoint(this.locationCoordinate(e),!0)}},{key:"pointLocation",value:function(e){return this.coordinateLocation(this.pointCoordinate(e))}},{key:"pointLocation3D",value:function(e){return this.coordinateLocation(this.pointCoordinate3D(e))}},{key:"locationCoordinate",value:function(t){return e.MercatorCoordinate.fromLngLat(t)}},{key:"coordinateLocation",value:function(e){return e.toLngLat()}},{key:"pointRayIntersection",value:function(t,n){var r=null!=n?n:this._centerAltitude,i=[t.x,t.y,0,1],a=[t.x,t.y,1,1];e.transformMat4(i,i,this.pixelMatrixInverse),e.transformMat4(a,a,this.pixelMatrixInverse);var o=a[3];e.scale$1(i,i,1/i[3]),e.scale$1(a,a,1/o);var s=i[2],l=a[2];return{p0:i,p1:a,t:s===l?0:(r-s)/(l-s)}}},{key:"screenPointToMercatorRay",value:function(t){var n=[t.x,t.y,0,1],r=[t.x,t.y,1,1];return e.transformMat4(n,n,this.pixelMatrixInverse),e.transformMat4(r,r,this.pixelMatrixInverse),e.scale$1(n,n,1/n[3]),e.scale$1(r,r,1/r[3]),n[2]=e.mercatorZfromAltitude(n[2],this._center.lat)*this.worldSize,r[2]=e.mercatorZfromAltitude(r[2],this._center.lat)*this.worldSize,e.scale$1(n,n,1/this.worldSize),e.scale$1(r,r,1/this.worldSize),new e.Ray([n[0],n[1],n[2]],e.normalize([],e.sub([],r,n)))}},{key:"rayIntersectionCoordinate",value:function(t){var n=t.p0,r=t.p1,i=t.t,a=e.mercatorZfromAltitude(n[2],this._center.lat),o=e.mercatorZfromAltitude(r[2],this._center.lat);return new e.MercatorCoordinate(e.number(n[0],r[0],i)/this.worldSize,e.number(n[1],r[1],i)/this.worldSize,e.number(a,o,i))}},{key:"pointCoordinate",value:function(t){var n=this.horizonLineFromTop(!1),r=new e.Point(t.x,Math.max(n,t.y));return this.rayIntersectionCoordinate(this.pointRayIntersection(r))}},{key:"pointCoordinate3D",value:function(t){if(!this.elevation)return this.pointCoordinate(t);var n=this.elevation,r=this.elevation.pointCoordinate(t);if(r)return new e.MercatorCoordinate(r[0],r[1],r[2]);var i=0,a=this.horizonLineFromTop();if(t.y>a)return this.pointCoordinate(t);for(var o=.02*a,s=t.clone(),l=0;l<10&&a-i>o;l++){s.y=e.number(i,a,.66);var u=n.pointCoordinate(s);u?(a=s.y,r=u):i=s.y}return r?new e.MercatorCoordinate(r[0],r[1],r[2]):this.pointCoordinate(t)}},{key:"isPointAboveHorizon",value:function(e){if(this.elevation)return!this.elevation.pointCoordinate(e);var t=this.horizonLineFromTop();return e.y<t}},{key:"_coordinatePoint",value:function(t,n){var r=n&&this.elevation?this.elevation.getAtPoint(t,this._centerAltitude):this._centerAltitude,i=[t.x*this.worldSize,t.y*this.worldSize,r+t.toAltitude(),1];return e.transformMat4(i,i,this.pixelMatrix),i[3]>0?new e.Point(i[0]/i[3],i[1]/i[3]):new e.Point(Number.MAX_VALUE,Number.MAX_VALUE)}},{key:"getBounds",value:function(){return this._terrainEnabled()?this._getBounds3D():(new e.LngLatBounds).extend(this.pointLocation(new e.Point(0,0))).extend(this.pointLocation(new e.Point(this.width,0))).extend(this.pointLocation(new e.Point(this.width,this.height))).extend(this.pointLocation(new e.Point(0,this.height)))}},{key:"_getBounds3D",value:function(){var t=this,n=this.elevation,r=n.visibleDemTiles.reduce((function(e,t){if(t.dem){var n=t.dem.tree;e.min=Math.min(e.min,n.minimums[0]),e.max=Math.max(e.max,n.maximums[0])}return e}),{min:Number.MAX_VALUE,max:0});r.min*=n.exaggeration(),r.max*=n.exaggeration();var i=this.horizonLineFromTop();return[new e.Point(0,i),new e.Point(this.width,i),new e.Point(this.width,this.height),new e.Point(0,this.height)].reduce((function(e,n){return e.extend(t.coordinateLocation(t.rayIntersectionCoordinate(t.pointRayIntersection(n,r.min)))).extend(t.coordinateLocation(t.rayIntersectionCoordinate(t.pointRayIntersection(n,r.max))))}),new e.LngLatBounds)}},{key:"horizonLineFromTop",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,n=this.height/2-.97*t;return e?Math.max(0,n):n}},{key:"getMaxBounds",value:function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new e.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}},{key:"setMaxBounds",value:function(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"calculatePosMatrix",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=t.key,i=n?this._alignedPosMatrixCache:this._posMatrixCache;if(i[r])return i[r];var a=t.canonical,o=this.worldSize/this.zoomScale(a.z),s=a.x+Math.pow(2,a.z)*t.wrap,l=e.identity(new Float64Array(16));return e.translate(l,l,[s*o,a.y*o,0]),e.scale(l,l,[o/e.EXTENT,o/e.EXTENT,1]),e.multiply(l,n?this.alignedProjMatrix:this.projMatrix,l),i[r]=new Float32Array(l),i[r]}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"recenterOnTerrain",value:function(){if(this._elevation){var t=this._elevation;this._updateCameraState();var n=this._camera.position,r=this._camera.forward();if(!(n.z<=0||r[2]>=0)){var i=e.mercatorZfromAltitude(1,this._center.lat);n[2]/=i,r[2]/=i,e.normalize(r,r);var a=t.raycast(n,r,t.exaggeration());if(a){var o=e.scaleAndAdd([],n,r,a),s=new e.MercatorCoordinate(o[0],o[1],e.mercatorZfromAltitude(o[2],e.latFromMercatorY(o[1]))),l=this._camera.position,u=s.z+e.length([s.x-l[0],s.y-l[1],s.z-l[2]]);this._cameraZoom=this._zoomFromMercatorZ(u),this._centerAltitude=s.toAltitude(),this._center=s.toLngLat(),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}}}},{key:"_constrainCameraAltitude",value:function(){if(this._elevation){var t=this._elevation;this._updateCameraState();var n=t.getAtPoint(this._camera.mercatorPosition),r=this._minimumHeightOverTerrain()*Math.cos(e.degToRad(this._maxPitch)),i=e.mercatorZfromAltitude(n,this._center.lat),a=this._camera.position[2]-i;if(a<r){var o=e.MercatorCoordinate.fromLngLat(this._center,this._centerAltitude),s=this._camera.mercatorPosition,l=[o.x-s.x,o.y-s.y,o.z-s.z],u=e.length(l);l[2]-=r-a;var c=e.length(l);if(0===c)return;e.scale$2(l,l,u/c),this._camera.position=[o.x-l[0],o.y-l[1],o.z-l[2]],this._camera.orientation=fr(l,this._camera.up()),this._updateStateFromCamera()}}}},{key:"_constrain",value:function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var t,n,r,i,a=-90,o=90,s=-180,l=180,u=this.size,c=this._unmodified;if(this.latRange){var h=this.latRange;a=e.mercatorYfromLat(h[1])*this.worldSize,t=(o=e.mercatorYfromLat(h[0])*this.worldSize)-a<u.y?u.y/(o-a):0}if(this.lngRange){var f=this.lngRange;s=e.mercatorXfromLng(f[0])*this.worldSize,n=(l=e.mercatorXfromLng(f[1])*this.worldSize)-s<u.x?u.x/(l-s):0}var d=this.point,p=Math.max(n||0,t||0);if(p)return this.center=this.unproject(new e.Point(n?(l+s)/2:d.x,t?(o+a)/2:d.y)),this.zoom+=this.scaleZoom(p),this._unmodified=c,void(this._constraining=!1);if(this.latRange){var m=d.y,v=u.y/2;m-v<a&&(i=a+v),m+v>o&&(i=o-v)}if(this.lngRange){var y=d.x,g=u.x/2;y-g<s&&(r=s+g),y+g>l&&(r=l-g)}void 0===r&&void 0===i||(this.center=this.unproject(new e.Point(void 0!==r?r:d.x,void 0!==i?i:d.y))),this._constrainCameraAltitude(),this._unmodified=c,this._constraining=!1}}},{key:"_minZoomForBounds",value:function(){var t=this,n=function(e,n){return Math.log2(e/(t.tileSize*Math.abs(n[1]-n[0])))},r=0;if(this.latRange){var i=this.latRange;r=n(this.height,[e.mercatorYfromLat(i[0]),e.mercatorYfromLat(i[1])])}var a=0;if(this.lngRange){var o=this.lngRange;a=n(this.width,[e.mercatorXfromLng(o[0]),e.mercatorXfromLng(o[1])])}return Math.max(r,a)}},{key:"_maxCameraBoundsDistance",value:function(){return this._mercatorZfromZoom(this._minZoomForBounds())}},{key:"_calcMatrices",value:function(){if(this.height){var t=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var n=e.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;this._updateCameraState();var r=Math.PI/2+this._pitch,i=this.fovAboveCenter,a=this._camera.position[2]*this.worldSize/Math.cos(this._pitch),o=Math.sin(i)*a/Math.sin(e.clamp(Math.PI-r-i,.01,Math.PI-.01)),s=this.point,l=s.x,u=s.y,c=1.01*(Math.cos(Math.PI/2-this._pitch)*o+a),h=this.height/50,f=this._camera.getWorldToCamera(this.worldSize,n),d=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,h,c);d[8]=2*-t.x/this.width,d[9]=2*t.y/this.height;var p=e.mul([],d,f);this.mercatorMatrix=e.scale([],p,[this.worldSize,this.worldSize,this.worldSize/n]),this.projMatrix=p,this.invProjMatrix=e.invert(new Float64Array(16),this.projMatrix);var m=new Float32Array(16);e.identity(m),e.scale(m,m,[1,-1,1]),e.rotateX(m,m,this._pitch),e.rotateZ(m,m,this.angle);var v=e.perspective(new Float32Array(16),this._fov,this.width/this.height,h,c);v[8]=2*-t.x/this.width,v[9]=2*t.y/this.height,this.skyboxMatrix=e.multiply(m,v,m);var y=this.width%2/2,g=this.height%2/2,_=Math.cos(this.angle),b=Math.sin(this.angle),x=l-Math.round(l)+_*y+b*g,w=u-Math.round(u)+_*g+b*y,E=new Float64Array(p);if(e.translate(E,E,[x>.5?x-1:x,w>.5?w-1:w,0]),this.alignedProjMatrix=E,p=e.create(),e.scale(p,p,[this.width/2,-this.height/2,1]),e.translate(p,p,[1,-1,0]),this.labelPlaneMatrix=p,p=e.create(),e.scale(p,p,[1,-1,1]),e.translate(p,p,[-1,-1,0]),e.scale(p,p,[2/this.width,2/this.height,1]),this.glCoordMatrix=p,this.pixelMatrix=e.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(p=e.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=p,this._posMatrixCache={},this._alignedPosMatrixCache={}}}},{key:"_updateCameraState",value:function(){if(this.height){this._camera.setPitchBearing(this._pitch,this.angle);var t=this._camera.forward(),n=this.cameraToCenterDistance,r=this.point,i=this._mercatorZfromZoom(this._cameraZoom?this._cameraZoom:this._zoom)-e.mercatorZfromAltitude(this._centerAltitude,this.center.lat),a=this.cameraToCenterDistance/i;this._camera.position=[r.x/this.worldSize-t[0]*n/a,r.y/this.worldSize-t[1]*n/a,e.mercatorZfromAltitude(this._centerAltitude,this._center.lat)+-t[2]*n/a]}}},{key:"_translateCameraConstrained",value:function(t){var n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),r=t[2],i=1;r>0&&(i=Math.min((n-this._camera.position[2])/r,1)),this._camera.position=e.scaleAndAdd([],this._camera.position,t,i),this._updateStateFromCamera()}},{key:"_updateStateFromCamera",value:function(){var t=this._camera.position,n=this._camera.forward(),r=this._camera.getPitchBearing(),i=r.pitch,a=r.bearing,o=e.mercatorZfromAltitude(this._centerAltitude,this.center.lat),s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.degToRad(this._maxPitch)),l=Math.max((t[2]-o)/Math.cos(i),s),u=this._zoomFromMercatorZ(l);e.scaleAndAdd(t,t,n,l),this._pitch=e.clamp(i,e.degToRad(this.minPitch),e.degToRad(this.maxPitch)),this.angle=e.wrap(a,-Math.PI,Math.PI),this._setZoom(e.clamp(u,this._minZoom,this._maxZoom)),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._center=new e.MercatorCoordinate(t[0],t[1],t[2]).toLngLat(),this._unmodified=!1,this._constrain(),this._calcMatrices()}},{key:"_worldSizeFromZoom",value:function(e){return Math.pow(2,e)*this.tileSize}},{key:"_mercatorZfromZoom",value:function(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}},{key:"_minimumHeightOverTerrain",value:function(){var e=Math.min((null!=this._cameraZoom?this._cameraZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(e)}},{key:"_zoomFromMercatorZ",value:function(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}},{key:"_terrainEnabled",value:function(){return!!this._elevation}},{key:"isHorizonVisibleForPoints",value:function(t,n){for(var r=Math.min(t.x,n.x),i=Math.max(t.x,n.x),a=Math.min(t.y,n.y),o=Math.max(t.y,n.y),s=[new e.Point(r,a),new e.Point(i,o),new e.Point(r,o),new e.Point(i,a)],l=this._renderWorldCopies?-3:0,u=this._renderWorldCopies?4:1,c=0,h=s;c<h.length;c++){var f=h[c],d=this.pointRayIntersection(f);if(d.t<0)return!0;var p=this.rayIntersectionCoordinate(d);if(p.x<l||p.y<0||p.x>u||p.y>1)return!0}return!1}},{key:"isHorizonVisible",value:function(){return this.pitch+e.radToDeg(this.fovAboveCenter)>88||this.isHorizonVisibleForPoints(new e.Point(0,0),new e.Point(this.width,this.height))}},{key:"zoomDeltaToMovement",value:function(t,n){var r=e.length(e.sub([],this._camera.position,t)),i=this._zoomFromMercatorZ(r)+n;return r-this._mercatorZfromZoom(i)}},{key:"getCameraPoint",value:function(){var t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.Point(0,t))}},{key:"elevation",get:function(){return this._elevation},set:function(e){this._elevation!==e&&(this._elevation=e,e?this._updateCenterElevation()&&this._updateCameraOnTerrain():(this._cameraZoom=null,this._centerAltitude=0),this._calcMatrices())}},{key:"minZoom",get:function(){return this._minZoom},set:function(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}},{key:"minPitch",get:function(){return this._minPitch},set:function(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new e.Point(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(t){var n=-e.wrap(t,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=e.create$2(),e.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(t){var n=e.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(e){var t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._terrainEnabled()&&this._updateCameraOnTerrain(),this._constrain(),this._calcMatrices())}},{key:"center",get:function(){return this._center},set:function(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCenterElevation()?this._updateCameraOnTerrain():this._cameraZoom=null:this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}},{key:"padding",get:function(){return this._edgeInsets.toJSON()},set:function(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}},{key:"centerPoint",get:function(){return this._edgeInsets.getCenter(this.width,this.height)}},{key:"fovAboveCenter",get:function(){return this._fov*(.5+this.centerOffset.y/this.height)}},{key:"unmodified",get:function(){return this._unmodified}},{key:"point",get:function(){return this.project(this.center)}}]),t}(),vr=function(){function t(n){v(this,t),this._hashName=n&&encodeURIComponent(n),e.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(e,t){var n=!1,r=null,i=function t(){r=null,n&&(e(),r=setTimeout(t,300),n=!1)};return function(){return n=!0,r||i(),r}}(this._updateHashUnthrottled.bind(this))}return y(t,[{key:"addTo",value:function(t){return this._map=t,e.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}},{key:"remove",value:function(){return e.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}},{key:"getHashString",value:function(t){var n=this._map.getCenter(),r=Math.round(100*this._map.getZoom())/100,i=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),a=Math.pow(10,i),o=Math.round(n.lng*a)/a,s=Math.round(n.lat*a)/a,l=this._map.getBearing(),u=this._map.getPitch(),c="";if(c+=t?"/".concat(o,"/").concat(s,"/").concat(r):"".concat(r,"/").concat(s,"/").concat(o),(l||u)&&(c+="/".concat(Math.round(10*l)/10)),u&&(c+="/".concat(Math.round(u))),this._hashName){var h=this._hashName,f=!1,d=e.window.location.hash.slice(1).split("&").map((function(e){var t=e.split("=")[0];return t===h?(f=!0,"".concat(t,"=").concat(c)):e})).filter((function(e){return e}));return f||d.push("".concat(h,"=").concat(c)),"#".concat(d.join("&"))}return"#".concat(c)}},{key:"_getCurrentHash",value:function(){var t,n=this,r=e.window.location.hash.replace("#","");return this._hashName?(r.split("&").map((function(e){return e.split("=")})).forEach((function(e){e[0]===n._hashName&&(t=e)})),(t&&t[1]||"").split("/")):r.split("/")}},{key:"_onHashChange",value:function(){var e=this._getCurrentHash();if(e.length>=3&&!e.some((function(e){return isNaN(e)}))){var t=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(e[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:t,pitch:+(e[4]||0)}),!0}return!1}},{key:"_updateHashUnthrottled",value:function(){var t=e.window.location.href.replace(/(#.+)?$/,this.getHashString());e.window.history.replaceState(e.window.history.state,null,t)}}]),t}(),yr={linearity:.3,easing:e.bezier(0,0,.3,1)},gr=e.extend({deceleration:2500,maxSpeed:1400},yr),_r=e.extend({deceleration:20,maxSpeed:1400},yr),br=e.extend({deceleration:1e3,maxSpeed:360},yr),xr=e.extend({deceleration:1e3,maxSpeed:90},yr),wr=function(){function t(e){v(this,t),this._map=e,this.clear()}return y(t,[{key:"clear",value:function(){this._inertiaBuffer=[]}},{key:"record",value:function(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.browser.now(),settings:t})}},{key:"_drainInertiaBuffer",value:function(){for(var t=this._inertiaBuffer,n=e.browser.now();t.length>0&&n-t[0].time>160;)t.shift()}},{key:"_onMoveEnd",value:function(t){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){var n,r={zoom:0,bearing:0,pitch:0,pan:new e.Point(0,0),pinchAround:void 0,around:void 0},i=f(this._inertiaBuffer);try{for(i.s();!(n=i.n()).done;){var a=n.value.settings;r.zoom+=a.zoomDelta||0,r.bearing+=a.bearingDelta||0,r.pitch+=a.pitchDelta||0,a.panDelta&&r.pan._add(a.panDelta),a.around&&(r.around=a.around),a.pinchAround&&(r.pinchAround=a.pinchAround)}}catch(p){i.e(p)}finally{i.f()}var o=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(r.pan.mag()){var l=Sr(r.pan.mag(),o,e.extend({},gr,t||{}));s.offset=r.pan.mult(l.amount/r.pan.mag()),s.center=this._map.transform.center,Er(s,l)}if(r.zoom){var u=Sr(r.zoom,o,_r);s.zoom=this._map.transform.zoom+u.amount,Er(s,u)}if(r.bearing){var c=Sr(r.bearing,o,br);s.bearing=this._map.transform.bearing+e.clamp(c.amount,-179,179),Er(s,c)}if(r.pitch){var h=Sr(r.pitch,o,xr);s.pitch=this._map.transform.pitch+h.amount,Er(s,h)}if(s.zoom||s.bearing){var d=void 0===r.pinchAround?r.around:r.pinchAround;s.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),e.extend(s,{noMoveStart:!0})}}}]),t}();function Er(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function Sr(t,n,r){var i=r.maxSpeed,a=r.linearity,o=r.deceleration,s=e.clamp(t*a/(n/1e3),-i,i),l=Math.abs(s)/(o*a);return{easing:r.easing,duration:1e3*l,amount:s*(l/2)}}var Tr=function(t){p(r,t);var n=m(r);function r(t,i,a){var o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};v(this,r);var l=d.mousePos(i.getCanvasContainer(),a),u=i.unproject(l);return(o=n.call(this,t,e.extend({point:l,lngLat:u,originalEvent:a},s)))._defaultPrevented=!1,o.target=i,o}return y(r,[{key:"preventDefault",value:function(){this._defaultPrevented=!0}},{key:"defaultPrevented",get:function(){return this._defaultPrevented}}]),r}(e.Event),kr=function(t){p(r,t);var n=m(r);function r(t,i,a){var o;v(this,r);var s="touchend"===t?a.changedTouches:a.touches,l=d.touchPos(i.getCanvasContainer(),s),u=l.map((function(e){return i.unproject(e)})),c=l.reduce((function(e,t,n,r){return e.add(t.div(r.length))}),new e.Point(0,0));return(o=n.call(this,t,{points:l,point:c,lngLats:u,lngLat:i.unproject(c),originalEvent:a}))._defaultPrevented=!1,o}return y(r,[{key:"preventDefault",value:function(){this._defaultPrevented=!0}},{key:"defaultPrevented",get:function(){return this._defaultPrevented}}]),r}(e.Event),Mr=function(e){p(n,e);var t=m(n);function n(e,r,i){var a;return v(this,n),(a=t.call(this,e,{originalEvent:i}))._defaultPrevented=!1,a}return y(n,[{key:"preventDefault",value:function(){this._defaultPrevented=!0}},{key:"defaultPrevented",get:function(){return this._defaultPrevented}}]),n}(e.Event),Cr=function(){function e(t,n){v(this,e),this._map=t,this._clickTolerance=n.clickTolerance}return y(e,[{key:"reset",value:function(){delete this._mousedownPos}},{key:"wheel",value:function(e){return this._firePreventable(new Mr(e.type,this._map,e))}},{key:"mousedown",value:function(e,t){return this._mousedownPos=t,this._firePreventable(new Tr(e.type,this._map,e))}},{key:"mouseup",value:function(e){this._map.fire(new Tr(e.type,this._map,e))}},{key:"click",value:function(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||this._map.fire(new Tr(e.type,this._map,e))}},{key:"dblclick",value:function(e){return this._firePreventable(new Tr(e.type,this._map,e))}},{key:"mouseover",value:function(e){this._map.fire(new Tr(e.type,this._map,e))}},{key:"mouseout",value:function(e){this._map.fire(new Tr(e.type,this._map,e))}},{key:"touchstart",value:function(e){return this._firePreventable(new kr(e.type,this._map,e))}},{key:"touchmove",value:function(e){this._map.fire(new kr(e.type,this._map,e))}},{key:"touchend",value:function(e){this._map.fire(new kr(e.type,this._map,e))}},{key:"touchcancel",value:function(e){this._map.fire(new kr(e.type,this._map,e))}},{key:"_firePreventable",value:function(e){if(this._map.fire(e),e.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){}},{key:"disable",value:function(){}}]),e}(),Ar=function(){function e(t){v(this,e),this._map=t}return y(e,[{key:"reset",value:function(){this._delayContextMenu=!1,delete this._contextMenuEvent}},{key:"mousemove",value:function(e){this._map.fire(new Tr(e.type,this._map,e))}},{key:"mousedown",value:function(){this._delayContextMenu=!0}},{key:"mouseup",value:function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Tr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}},{key:"contextmenu",value:function(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new Tr(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){}},{key:"disable",value:function(){}}]),e}(),Ir=function(){function t(e,n){v(this,t),this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}return y(t,[{key:"isEnabled",value:function(){return!!this._enabled}},{key:"isActive",value:function(){return!!this._active}},{key:"enable",value:function(){this.isEnabled()||(this._enabled=!0)}},{key:"disable",value:function(){this.isEnabled()&&(this._enabled=!1)}},{key:"mousedown",value:function(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(d.disableDrag(),this._startPos=this._lastPos=t,this._active=!0)}},{key:"mousemoveWindow",value:function(e,t){if(this._active){var n=t;if(!(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)){var r=this._startPos;this._lastPos=n,this._box||(this._box=d.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));var i=Math.min(r.x,n.x),a=Math.max(r.x,n.x),o=Math.min(r.y,n.y),s=Math.max(r.y,n.y);d.setTransform(this._box,"translate(".concat(i,"px,").concat(o,"px)")),this._box.style.width="".concat(a-i,"px"),this._box.style.height="".concat(s-o,"px")}}}},{key:"mouseupWindow",value:function(t,n){var r=this;if(this._active&&0===t.button){var i=this._startPos,a=n;if(this.reset(),d.suppressClick(),i.x!==a.x||i.y!==a.y)return this._map.fire(new e.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:function(e){return e.fitScreenCoordinates(i,a,r._map.getBearing(),{linear:!1})}};this._fireEvent("boxzoomcancel",t)}}},{key:"keydown",value:function(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}},{key:"reset",value:function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(d.remove(this._box),this._box=null),d.enableDrag(),delete this._startPos,delete this._lastPos}},{key:"_fireEvent",value:function(t,n){return this._map.fire(new e.Event(t,{originalEvent:n}))}}]),t}();function Pr(e,t){for(var n={},r=0;r<e.length;r++)n[e[r].identifier]=t[r];return n}var Rr=function(){function t(e){v(this,t),this.reset(),this.numTouches=e.numTouches}return y(t,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(t,n,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),r.length===this.numTouches&&(this.centroid=function(t){var n,r=new e.Point(0,0),i=f(t);try{for(i.s();!(n=i.n()).done;){var a=n.value;r._add(a)}}catch(o){i.e(o)}finally{i.f()}return r.div(t.length)}(n),this.touches=Pr(r,n)))}},{key:"touchmove",value:function(e,t,n){if(!this.aborted&&this.centroid){var r=Pr(n,t);for(var i in this.touches){var a=this.touches[i],o=r[i];(!o||o.dist(a)>30)&&(this.aborted=!0)}}}},{key:"touchend",value:function(e,t,n){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}}}]),t}(),Lr=function(){function e(t){v(this,e),this.singleTap=new Rr(t),this.numTaps=t.numTaps,this.reset()}return y(e,[{key:"reset",value:function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(e,t,n){this.singleTap.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this.singleTap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this.singleTap.touchend(e,t,n);if(r){var i=e.timeStamp-this.lastTime<500,a=!this.lastTap||this.lastTap.dist(r)<30;if(i&&a||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}]),e}(),Or=function(){function e(){v(this,e),this._zoomIn=new Lr({numTouches:1,numTaps:2}),this._zoomOut=new Lr({numTouches:2,numTaps:1}),this.reset()}return y(e,[{key:"reset",value:function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}},{key:"touchstart",value:function(e,t,n){this._zoomIn.touchstart(e,t,n),this._zoomOut.touchstart(e,t,n)}},{key:"touchmove",value:function(e,t,n){this._zoomIn.touchmove(e,t,n),this._zoomOut.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){var r=this,i=this._zoomIn.touchend(e,t,n),a=this._zoomOut.touchend(e,t,n);return i?(this._active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(i)},{originalEvent:e})}}):a?(this._active=!0,e.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(t){return t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(a)},{originalEvent:e})}}):void 0}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"isActive",value:function(){return this._active}}]),e}(),Dr={0:1,2:2},Nr=function(){function e(t){v(this,e),this.reset(),this._clickTolerance=t.clickTolerance||1}return y(e,[{key:"reset",value:function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}},{key:"_correctButton",value:function(e,t){return!1}},{key:"_move",value:function(e,t){return{}}},{key:"mousedown",value:function(e,t){if(!this._lastPoint){var n=d.mouseButton(e);this._correctButton(e,n)&&(this._lastPoint=t,this._eventButton=n)}}},{key:"mousemoveWindow",value:function(e,t){var n=this._lastPoint;if(n)if(e.preventDefault(),function(e,t){var n=Dr[t];return void 0===e.buttons||(e.buttons&n)!==n}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(n,t)}},{key:"mouseupWindow",value:function(e){this._lastPoint&&d.mouseButton(e)===this._eventButton&&(this._moved&&d.suppressClick(),this.reset())}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"isActive",value:function(){return this._active}}]),e}(),zr=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"mousedown",value:function(e,t){o(s(n.prototype),"mousedown",this).call(this,e,t),this._lastPoint&&(this._active=!0)}},{key:"_correctButton",value:function(e,t){return 0===t&&!e.ctrlKey}},{key:"_move",value:function(e,t){return{around:t,panDelta:t.sub(e)}}}]),n}(Nr),Fr=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"_move",value:function(e,t){var n=.8*(t.x-e.x);if(n)return this._active=!0,{bearingDelta:n}}},{key:"contextmenu",value:function(e){e.preventDefault()}}]),n}(Nr),Br=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"_correctButton",value:function(e,t){return 0===t&&e.ctrlKey||2===t}},{key:"_move",value:function(e,t){var n=-.5*(t.y-e.y);if(n)return this._active=!0,{pitchDelta:n}}},{key:"contextmenu",value:function(e){e.preventDefault()}}]),n}(Nr),Ur=function(){function t(e){v(this,t),this._minTouches=1,this._clickTolerance=e.clickTolerance||1,this.reset()}return y(t,[{key:"reset",value:function(){this._active=!1,this._touches={},this._sum=new e.Point(0,0)}},{key:"touchstart",value:function(e,t,n){return this._calculateTransform(e,t,n)}},{key:"touchmove",value:function(e,t,n){if(this._active&&!(n.length<this._minTouches))return e.preventDefault(),this._calculateTransform(e,t,n)}},{key:"touchend",value:function(e,t,n){this._calculateTransform(e,t,n),this._active&&n.length<this._minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"_calculateTransform",value:function(t,n,r){r.length>0&&(this._active=!0);var i=Pr(r,n),a=new e.Point(0,0),o=new e.Point(0,0),s=0;for(var l in i){var u=i[l],c=this._touches[l];c&&(a._add(u),o._add(u.sub(c)),s++,i[l]=u)}if(this._touches=i,!(s<this._minTouches)&&o.mag()){var h=o.div(s);return this._sum._add(h),this._sum.mag()<this._clickTolerance?void 0:{around:a.div(s),panDelta:h}}}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"isActive",value:function(){return this._active}}]),t}(),jr=function(){function e(){v(this,e),this.reset()}return y(e,[{key:"reset",value:function(){this._active=!1,delete this._firstTwoTouches}},{key:"_start",value:function(e){}},{key:"_move",value:function(e,t,n){return{}}},{key:"touchstart",value:function(e,t,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([t[0],t[1]]))}},{key:"touchmove",value:function(e,t,n){if(this._firstTwoTouches){e.preventDefault();var r=h(this._firstTwoTouches,2),i=r[0],a=r[1],o=Vr(n,t,i),s=Vr(n,t,a);if(o&&s){var l=this._aroundCenter?null:o.add(s).div(2);return this._move([o,s],l,e)}}}},{key:"touchend",value:function(e,t,n){if(this._firstTwoTouches){var r=h(this._firstTwoTouches,2),i=r[0],a=r[1],o=Vr(n,t,i),s=Vr(n,t,a);o&&s||(this._active&&d.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"isActive",value:function(){return this._active}}]),e}();function Vr(e,t,n){for(var r=0;r<e.length;r++)if(e[r].identifier===n)return t[r]}function Hr(e,t){return Math.log(e/t)/Math.LN2}var Gr=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"reset",value:function(){o(s(n.prototype),"reset",this).call(this),delete this._distance,delete this._startDistance}},{key:"_start",value:function(e){this._startDistance=this._distance=e[0].dist(e[1])}},{key:"_move",value:function(e,t){var n=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Hr(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Hr(this._distance,n),pinchAround:t}}}]),n}(jr);function Wr(e,t){return 180*e.angleWith(t)/Math.PI}var qr=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"reset",value:function(){o(s(n.prototype),"reset",this).call(this),delete this._minDiameter,delete this._startVector,delete this._vector}},{key:"_start",value:function(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}},{key:"_move",value:function(e,t){var n=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Wr(this._vector,n),pinchAround:t}}},{key:"_isBelowThreshold",value:function(e){this._minDiameter=Math.min(this._minDiameter,e.mag());var t=25/(Math.PI*this._minDiameter)*360,n=Wr(e,this._startVector);return Math.abs(n)<t}}]),n}(jr);function Xr(e){return Math.abs(e.y)>Math.abs(e.x)}var Zr=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return y(n,[{key:"reset",value:function(){o(s(n.prototype),"reset",this).call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints}},{key:"_start",value:function(e){this._lastPoints=e,Xr(e[0].sub(e[1]))&&(this._valid=!1)}},{key:"_move",value:function(e,t,n){var r=e[0].sub(this._lastPoints[0]),i=e[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(r,i,n.timeStamp),this._valid)return this._lastPoints=e,this._active=!0,{pitchDelta:(r.y+i.y)/2*-.5}}},{key:"gestureBeginsVertically",value:function(e,t,n){if(void 0!==this._valid)return this._valid;var r=e.mag()>=2,i=t.mag()>=2;if(r||i){if(!r||!i)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;var a=e.y>0==t.y>0;return Xr(e)&&Xr(t)&&a}}}]),n}(jr),Kr={panStep:100,bearingStep:15,pitchStep:10},Yr=function(){function e(){v(this,e);var t=Kr;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}return y(e,[{key:"reset",value:function(){this._active=!1}},{key:"keydown",value:function(e){var t=this;if(!(e.altKey||e.ctrlKey||e.metaKey)){var n=0,r=0,i=0,a=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),a=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),a=1);break;case 38:e.shiftKey?i=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?i=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(r=0,i=0),{cameraAnimation:function(s){var l=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:Jr,zoom:n?Math.round(l)+n*(e.shiftKey?2:1):l,bearing:s.getBearing()+r*t._bearingStep,pitch:s.getPitch()+i*t._pitchStep,offset:[-a*t._panStep,-o*t._panStep],center:s.getCenter()},{originalEvent:e})}}}}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"isActive",value:function(){return this._active}},{key:"disableRotation",value:function(){this._rotationDisabled=!0}},{key:"enableRotation",value:function(){this._rotationDisabled=!1}}]),e}();function Jr(e){return e*(2-e)}var Qr=function(){function t(n,r){v(this,t),this._map=n,this._el=n.getCanvasContainer(),this._handler=r,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,e.bindAll(["_onTimeout"],this)}return y(t,[{key:"setZoomRate",value:function(e){this._defaultZoomRate=e}},{key:"setWheelZoomRate",value:function(e){this._wheelZoomRate=e}},{key:"isEnabled",value:function(){return!!this._enabled}},{key:"isActive",value:function(){return!!this._active||void 0!==this._finishTimeout}},{key:"isZooming",value:function(){return!!this._zooming}},{key:"enable",value:function(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=e&&"center"===e.around)}},{key:"disable",value:function(){this.isEnabled()&&(this._enabled=!1)}},{key:"wheel",value:function(t){if(this.isEnabled()){var n=t.deltaMode===e.window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,r=e.browser.now(),i=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==n&&n%4.000244140625==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(i*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),t.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=t,this._delta-=n,this._active||this._start(t)),t.preventDefault()}}},{key:"_onTimeout",value:function(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}},{key:"_start",value:function(e){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var t=d.mousePos(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}}},{key:"renderFrame",value:function(){var t=this;if(this._frameId&&(this._frameId=null,this.isActive())){var n=this._map.transform,r=function(){return n._terrainEnabled()?n.computeZoomRelativeTo(t._aroundCoord):n.zoom};if(0!==this._delta){var i="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,a=2/(1+Math.exp(-Math.abs(this._delta*i)));this._delta<0&&0!==a&&(a=1/a);var o=r(),s=Math.pow(2,o),l="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):s;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(l*a))),"wheel"===this._type&&(this._startZoom=r(),this._easing=this._smoothOutEasing(200)),this._delta=0}var u,c="number"==typeof this._targetZoom?this._targetZoom:r(),h=this._startZoom,f=this._easing,d=!1;if("wheel"===this._type&&h&&f){var p=Math.min((e.browser.now()-this._lastWheelEventTime)/200,1),m=f(p);u=e.number(h,c,m),p<1?this._frameId||(this._frameId=!0):d=!0}else u=c,d=!0;return this._active=!0,d&&(this._active=!1,this._finishTimeout=setTimeout((function(){t._zooming=!1,t._handler._triggerRenderFrame(),delete t._targetZoom,delete t._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!d,zoomDelta:u-r(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}}},{key:"_smoothOutEasing",value:function(t){var n=e.ease;if(this._prevEase){var r=this._prevEase,i=(e.browser.now()-r.start)/r.duration,a=r.easing(i+.01)-r.easing(i),o=.27/Math.sqrt(a*a+1e-4)*.01,s=Math.sqrt(.0729-o*o);n=e.bezier(o,s,.25,1)}return this._prevEase={start:e.browser.now(),duration:t,easing:n},n}},{key:"reset",value:function(){this._active=!1}}]),t}(),$r=function(){function e(t,n){v(this,e),this._clickZoom=t,this._tapZoom=n}return y(e,[{key:"enable",value:function(){this._clickZoom.enable(),this._tapZoom.enable()}},{key:"disable",value:function(){this._clickZoom.disable(),this._tapZoom.disable()}},{key:"isEnabled",value:function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}},{key:"isActive",value:function(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}]),e}(),ei=function(){function e(){v(this,e),this.reset()}return y(e,[{key:"reset",value:function(){this._active=!1}},{key:"dblclick",value:function(e,t){return e.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(e.shiftKey?-1:1),around:n.unproject(t)},{originalEvent:e})}}}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"isActive",value:function(){return this._active}}]),e}(),ti=function(){function e(){v(this,e),this._tap=new Lr({numTouches:1,numTaps:1}),this.reset()}return y(e,[{key:"reset",value:function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}},{key:"touchstart",value:function(e,t,n){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=t[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(e,t,n))}},{key:"touchmove",value:function(e,t,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;var r=t[0],i=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(e,t,n)}},{key:"touchend",value:function(e,t,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(e,t,n)&&(this._tapTime=e.timeStamp)}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this._enabled=!0}},{key:"disable",value:function(){this._enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this._enabled}},{key:"isActive",value:function(){return this._active}}]),e}(),ni=function(){function e(t,n,r){v(this,e),this._el=t,this._mousePan=n,this._touchPan=r}return y(e,[{key:"enable",value:function(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}},{key:"disable",value:function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}},{key:"isEnabled",value:function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}},{key:"isActive",value:function(){return this._mousePan.isActive()||this._touchPan.isActive()}}]),e}(),ri=function(){function e(t,n,r){v(this,e),this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=n,this._mousePitch=r}return y(e,[{key:"enable",value:function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}},{key:"disable",value:function(){this._mouseRotate.disable(),this._mousePitch.disable()}},{key:"isEnabled",value:function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}},{key:"isActive",value:function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}]),e}(),ii=function(){function e(t,n,r,i){v(this,e),this._el=t,this._touchZoom=n,this._touchRotate=r,this._tapDragZoom=i,this._rotationDisabled=!1,this._enabled=!0}return y(e,[{key:"enable",value:function(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}},{key:"disable",value:function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this._rotationDisabled=!0,this._touchRotate.disable()}},{key:"enableRotation",value:function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}]),e}(),ai=function(e){return e.zoom||e.drag||e.pitch||e.rotate},oi=function(e){p(n,e);var t=m(n);function n(){return v(this,n),t.apply(this,arguments)}return n}(e.Event),si=function(){function t(){v(this,t),this.constants=[1,1,.01],this.radius=0}return y(t,[{key:"setup",value:function(t,n){var r=e.sub([],n,t);this.radius=e.length(r[2]<0?e.div([],r,this.constants):[r[0],r[1],0])}},{key:"projectRay",value:function(t){e.div(t,t,this.constants),e.normalize(t,t),e.mul$1(t,t,this.constants);var n=e.scale$2([],t,this.radius);if(n[2]>0){var r=e.scale$2([],[0,0,1],e.dot(n,[0,0,1])),i=e.scale$2([],e.normalize([],[n[0],n[1],0]),this.radius),a=e.add([],n,e.scale$2([],e.sub([],e.add([],i,r),n),2));n[0]=a[0],n[1]=a[1]}return n}}]),t}();function li(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}var ui=function(){function t(n,r){v(this,t),this._map=n,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new wr(n),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new si,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),e.bindAll(["handleEvent","handleWindowEvent"],this);var i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[e.window.document,"mousemove",{capture:!0}],[e.window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[e.window,"blur",void 0]];var a,o=f(this._listeners);try{for(o.s();!(a=o.n()).done;){var s=h(a.value,3),l=s[0],u=s[1],c=s[2];d.addEventListener(l,u,l===e.window.document?this.handleWindowEvent:this.handleEvent,c)}}catch(p){o.e(p)}finally{o.f()}}return y(t,[{key:"destroy",value:function(){var t,n=f(this._listeners);try{for(n.s();!(t=n.n()).done;){var r=h(t.value,3),i=r[0],a=r[1],o=r[2];d.removeEventListener(i,a,i===e.window.document?this.handleWindowEvent:this.handleEvent,o)}}catch(s){n.e(s)}finally{n.f()}}},{key:"_addDefaultHandlers",value:function(e){var t=this._map,n=t.getCanvasContainer();this._add("mapEvent",new Cr(t,e));var r=t.boxZoom=new Ir(t,e);this._add("boxZoom",r);var i=new Or,a=new ei;t.doubleClickZoom=new $r(a,i),this._add("tapZoom",i),this._add("clickZoom",a);var o=new ti;this._add("tapDragZoom",o);var s=t.touchPitch=new Zr;this._add("touchPitch",s);var l=new Fr(e),u=new Br(e);t.dragRotate=new ri(e,l,u),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",u,["mouseRotate"]);var c=new zr(e),h=new Ur(e);t.dragPan=new ni(n,c,h),this._add("mousePan",c),this._add("touchPan",h,["touchZoom","touchRotate"]);var f=new qr,d=new Gr;t.touchZoomRotate=new ii(n,d,f,o),this._add("touchRotate",f,["touchPan","touchZoom"]),this._add("touchZoom",d,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ar(t));var p=t.scrollZoom=new Qr(t,this);this._add("scrollZoom",p,["mousePan"]);var m=t.keyboard=new Yr;this._add("keyboard",m);for(var v=0,y=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];v<y.length;v++){var g=y[v];e.interactive&&e[g]&&t[g].enable(e[g])}}},{key:"_add",value:function(e,t,n){this._handlers.push({handlerName:e,handler:t,allowed:n}),this._handlersById[e]=t}},{key:"stop",value:function(e){if(!this._updatingCamera){var t,n=f(this._handlers);try{for(n.s();!(t=n.n()).done;)t.value.handler.reset()}catch(r){n.e(r)}finally{n.f()}this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}},{key:"isActive",value:function(){var e,t=f(this._handlers);try{for(t.s();!(e=t.n()).done;)if(e.value.handler.isActive())return!0}catch(n){t.e(n)}finally{t.f()}return!1}},{key:"isZooming",value:function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this._eventsInProgress.rotate}},{key:"isMoving",value:function(){return Boolean(ai(this._eventsInProgress))||this.isZooming()}},{key:"_blockedByActive",value:function(e,t,n){for(var r in e)if(r!==n&&(!t||t.indexOf(r)<0))return!0;return!1}},{key:"handleWindowEvent",value:function(e){this.handleEvent(e,"".concat(e.type,"Window"))}},{key:"_getMapTouches",value:function(e){var t,n=[],r=f(e);try{for(r.s();!(t=r.n()).done;){var i=t.value;this._el.contains(i.target)&&n.push(i)}}catch(a){r.e(a)}finally{r.f()}return n}},{key:"handleEvent",value:function(e,t){if("blur"!==e.type){this._updatingCamera=!0;var n,r="renderFrame"===e.type?void 0:e,i={needsRenderFrame:!1},a={},o={},s=e.touches?this._getMapTouches(e.touches):void 0,l=s?d.touchPos(this._el,s):d.mousePos(this._el,e),u=f(this._handlers);try{for(u.s();!(n=u.n()).done;){var c=n.value,h=c.handlerName,p=c.handler,m=c.allowed;if(p.isEnabled()){var v=void 0;this._blockedByActive(o,m,h)?p.reset():p[t||e.type]&&(v=p[t||e.type](e,l,s),this.mergeHandlerResult(i,a,v,h,r),v&&v.needsRenderFrame&&this._triggerRenderFrame()),(v||p.isActive())&&(o[h]=p)}}}catch(b){u.e(b)}finally{u.f()}var y={};for(var g in this._previousActiveHandlers)o[g]||(y[g]=r);this._previousActiveHandlers=o,(Object.keys(y).length||li(i))&&(this._changes.push([i,a,y]),this._triggerRenderFrame()),(Object.keys(o).length||li(i))&&this._map._stop(!0),this._updatingCamera=!1;var _=i.cameraAnimation;_&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],_(this._map))}else this.stop(!0)}},{key:"mergeHandlerResult",value:function(t,n,r,i,a){if(r){e.extend(t,r);var o={handlerName:i,originalEvent:r.originalEvent||a};void 0!==r.zoomDelta&&(n.zoom=o),void 0!==r.panDelta&&(n.drag=o),void 0!==r.pitchDelta&&(n.pitch=o),void 0!==r.bearingDelta&&(n.rotate=o)}}},{key:"_applyChanges",value:function(){var t,n={},r={},i={},a=f(this._changes);try{for(a.s();!(t=a.n()).done;){var o=h(t.value,3),s=o[0],l=o[1],u=o[2];s.panDelta&&(n.panDelta=(n.panDelta||new e.Point(0,0))._add(s.panDelta)),s.zoomDelta&&(n.zoomDelta=(n.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(n.bearingDelta=(n.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(n.pitchDelta=(n.pitchDelta||0)+s.pitchDelta),void 0!==s.around&&(n.around=s.around),void 0!==s.aroundCoord&&(n.aroundCoord=s.aroundCoord),void 0!==s.pinchAround&&(n.pinchAround=s.pinchAround),s.noInertia&&(n.noInertia=s.noInertia),e.extend(r,l),e.extend(i,u)}}catch(c){a.e(c)}finally{a.f()}this._updateMapTransform(n,r,i),this._changes=[]}},{key:"_updateMapTransform",value:function(t,n,r){var i=this,a=this._map,o=a.transform,s=function(e){return[e.x,e.y,e.z]};if(function(e){var t=i._eventsInProgress.drag;return t&&!i._handlersById[t.handlerName].isActive()}()&&!li(t)){var l=o.zoom;o.cameraElevationReference="sea",o.recenterOnTerrain(),o.cameraElevationReference="ground",l!==o.zoom&&this._map._update(!0)}if(!li(t))return this._fireEvents(n,r,!0);var u=t.panDelta,c=t.zoomDelta,h=t.bearingDelta,f=t.pitchDelta,d=t.around,p=t.aroundCoord,m=t.pinchAround;void 0!==m&&(d=m),n.drag&&!i._eventsInProgress.drag&&d&&(this._dragOrigin=s(o.pointCoordinate3D(d)),this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",a._stop(!0),d=d||a.transform.centerPoint,h&&(o.bearing+=h),f&&(o.pitch+=f),o._updateCameraState();var v=[0,0,0];if(u){var y=o.screenPointToMercatorRay(d),g=o.screenPointToMercatorRay(d.sub(u)),_=this._trackingEllipsoid.projectRay(y.dir),b=this._trackingEllipsoid.projectRay(g.dir);v[0]=b[0]-_[0],v[1]=b[1]-_[1]}var x=o.zoom,w=[0,0,0];if(c){var E=s(p||o.pointCoordinate3D(d)),S={dir:e.normalize([],e.sub([],E,o._camera.position))},T=o.screenPointToMercatorRay(o.centerPoint);if(S.dir[2]<0){var k=e.altitudeFromMercatorZ(E[2],E[1]),M=o.rayIntersectionCoordinate(o.pointRayIntersection(o.centerPoint,k)),C=o.zoomDeltaToMovement(s(M),c)*(T.dir[2]/S.dir[2]);e.scale$2(w,S.dir,C)}else if(o._terrainEnabled()){var A=o.zoomDeltaToMovement(E,c);e.scale$2(w,S.dir,A)}}var I=e.add(v,v,w);o._translateCameraConstrained(I),c&&Math.abs(o.zoom-x)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(n,r,!0)}},{key:"_fireEvents",value:function(t,n,r){var i=this,a=ai(this._eventsInProgress),o=ai(t),s={};for(var l in t){var u=t[l].originalEvent;this._eventsInProgress[l]||(s["".concat(l,"start")]=u),this._eventsInProgress[l]=t[l]}for(var c in!a&&o&&this._fireEvent("movestart",o.originalEvent),s)this._fireEvent(c,s[c]);for(var h in o&&this._fireEvent("move",o.originalEvent),t){var f=t[h].originalEvent;this._fireEvent(h,f)}var d,p={};for(var m in this._eventsInProgress){var v=this._eventsInProgress[m],y=v.handlerName,g=v.originalEvent;this._handlersById[y].isActive()||(delete this._eventsInProgress[m],d=n[y]||g,p["".concat(m,"end")]=d)}for(var _ in p)this._fireEvent(_,p[_]);var b=ai(this._eventsInProgress);if(r&&(a||o)&&!b){this._updatingCamera=!0;var x=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),w=function(e){return 0!==e&&-i._bearingSnap<e&&e<i._bearingSnap};x?(w(x.bearing||this._map.getBearing())&&(x.bearing=0),this._map.easeTo(x,{originalEvent:d})):(this._map.fire(new e.Event("moveend",{originalEvent:d})),w(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}},{key:"_fireEvent",value:function(t,n){this._map.fire(new e.Event(t,n?{originalEvent:n}:{}))}},{key:"_requestFrame",value:function(){var e=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add((function(t){delete e._frameId,e.handleEvent(new oi("renderFrame",{timeStamp:t})),e._applyChanges()}))}},{key:"_triggerRenderFrame",value:function(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}]),t}(),ci=function(t){p(r,t);var n=m(r);function r(t,a){var o;return v(this,r),(o=n.call(this))._moving=!1,o._zooming=!1,o.transform=t,o._bearingSnap=a.bearingSnap,e.bindAll(["_renderFrameCallback"],i(o)),o}return y(r,[{key:"getCenter",value:function(){return new e.LngLat(this.transform.center.lng,this.transform.center.lat)}},{key:"setCenter",value:function(e,t){return this.jumpTo({center:e},t)}},{key:"panBy",value:function(t,n,r){return t=e.Point.convert(t).mult(-1),this.panTo(this.transform.center,e.extend({offset:t},n),r)}},{key:"panTo",value:function(t,n,r){return this.easeTo(e.extend({center:t},n),r)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"setZoom",value:function(e,t){return this.jumpTo({zoom:e},t),this}},{key:"zoomTo",value:function(t,n,r){return this.easeTo(e.extend({zoom:t},n),r)}},{key:"zoomIn",value:function(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}},{key:"zoomOut",value:function(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"setBearing",value:function(e,t){return this.jumpTo({bearing:e},t),this}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(e,t){return this.jumpTo({padding:e},t),this}},{key:"rotateTo",value:function(t,n,r){return this.easeTo(e.extend({bearing:t},n),r)}},{key:"resetNorth",value:function(t,n){return this.rotateTo(0,e.extend({duration:1e3},t),n),this}},{key:"resetNorthPitch",value:function(t,n){return this.easeTo(e.extend({bearing:0,pitch:0,duration:1e3},t),n),this}},{key:"snapToNorth",value:function(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setPitch",value:function(e,t){return this.jumpTo({pitch:e},t),this}},{key:"cameraForBounds",value:function(t,n){t=e.LngLatBounds.convert(t);var r=n&&n.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),r,n)}},{key:"_extendCameraOptions",value:function(t){var n={top:0,bottom:0,right:0,left:0};if("number"==typeof(t=e.extend({padding:n,offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding){var r=t.padding;t.padding={top:r,bottom:r,right:r,left:r}}return t.padding=e.extend(n,t.padding),t}},{key:"_cameraForBoxAndBearing",value:function(t,n,r,i){var a=this._extendCameraOptions(i),o=this.transform,s=o.padding,l=o.project(e.LngLat.convert(t)),u=o.project(e.LngLat.convert(n)),c=l.rotate(-e.degToRad(r)),h=u.rotate(-e.degToRad(r)),f=new e.Point(Math.max(c.x,h.x),Math.max(c.y,h.y)),d=new e.Point(Math.min(c.x,h.x),Math.min(c.y,h.y)),p=f.sub(d),m=(o.width-(s.left+s.right+a.padding.left+a.padding.right))/p.x,v=(o.height-(s.top+s.bottom+a.padding.top+a.padding.bottom))/p.y;if(!(v<0||m<0)){var y=Math.min(o.scaleZoom(o.scale*Math.min(m,v)),a.maxZoom),g="number"==typeof a.offset.x?new e.Point(a.offset.x,a.offset.y):e.Point.convert(a.offset),_=new e.Point((a.padding.left-a.padding.right)/2,(a.padding.top-a.padding.bottom)/2).rotate(r*Math.PI/180),b=g.add(_).mult(o.scale/o.zoomScale(y));return{center:o.unproject(l.add(u).div(2).sub(b)),zoom:y,bearing:r}}e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}},{key:"_cameraForBox",value:function(t,n,r,i,a){var o=this._extendCameraOptions(a);r=r||0,i=i||0,t=e.LngLat.convert(t),n=e.LngLat.convert(n);var s=this.transform.clone();s.padding=o.padding;var l=this.getFreeCameraOptions(),u=new e.LngLat(.5*(t.lng+n.lng),.5*(t.lat+n.lat)),c=.5*(r+i);if(!(s._camera.position[2]<e.mercatorZfromAltitude(c,u.lat))){l.lookAtPoint(u),s.setFreeCameraOptions(l);var h,f,d=e.MercatorCoordinate.fromLngLat(t),p=e.MercatorCoordinate.fromLngLat(n),m=s.pointRayIntersection(s.centerPoint,c),v=[(h=s.rayIntersectionCoordinate(m)).x,h.y,h.z],y=s.screenPointToMercatorRay(s.centerPoint),g=0;do{var _=Math.floor(s.zoom),b=1<<_,x=Math.min(b*d.x,b*p.x),w=Math.min(b*d.y,b*p.y),E=Math.max(b*d.x,b*p.x),S=Math.max(b*d.y,b*p.y),T=new e.Aabb([x,w,r],[E,S,i]),k=e.Frustum.fromInvProjectionMatrix(s.invProjMatrix,s.worldSize,_);if(2!==T.intersects(k)){f&&(s._camera.position=e.scaleAndAdd([],s._camera.position,y.dir,-f),s._updateStateFromCamera());break}var M=e.sub([],s._camera.position,v);f=.5*e.length(M),s._camera.position=e.scaleAndAdd([],s._camera.position,y.dir,f);try{s._updateStateFromCamera()}catch(t){return void e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++g<10);return{center:s.center,zoom:s.zoom,bearing:s.bearing,pitch:s.pitch}}e.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}},{key:"fitBounds",value:function(e,t,n){return this._fitInternal(this.cameraForBounds(e,t),t,n)}},{key:"_raycastElevationBox",value:function(t,n){var r=this.transform.elevation;if(r){var i=new e.Point(t.x,n.y),a=new e.Point(n.x,t.y),o=r.pointCoordinate(t);if(o){var s=r.pointCoordinate(n);if(s){var l=r.pointCoordinate(i);if(l){var u=r.pointCoordinate(a);if(u){var c=new e.MercatorCoordinate(o[0],o[1]).toLngLat(),h=new e.MercatorCoordinate(s[0],s[1]).toLngLat(),f=new e.MercatorCoordinate(l[0],l[1]).toLngLat(),d=new e.MercatorCoordinate(u[0],u[1]).toLngLat(),p=Math.min(c.lng,Math.min(h.lng,Math.min(f.lng,d.lng))),m=Math.min(c.lat,Math.min(h.lat,Math.min(f.lat,d.lat))),v=Math.max(c.lng,Math.max(h.lng,Math.max(f.lng,d.lng))),y=Math.max(c.lat,Math.max(h.lat,Math.max(f.lat,d.lat))),g=Math.min(o[3],Math.min(s[3],Math.min(l[3],u[3]))),_=Math.max(o[3],Math.max(s[3],Math.max(l[3],u[3])));return{minLngLat:new e.LngLat(p,m),maxLngLat:new e.LngLat(v,y),minAltitude:g,maxAltitude:_}}}}}}}},{key:"fitScreenCoordinates",value:function(t,n,r,i,a){var o,s,l,u,c=e.Point.convert(t),h=e.Point.convert(n),f=this._raycastElevationBox(c,h);if(f)o=f.minLngLat,s=f.maxLngLat,l=f.minAltitude,u=f.maxAltitude;else{if(this.transform.isHorizonVisibleForPoints(c,h))return this;o=this.transform.pointLocation(c),s=this.transform.pointLocation(h)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(e.Point.convert(t)),this.transform.pointLocation(e.Point.convert(n)),r,i):this._cameraForBox(o,s,l,u,i),i,a)}},{key:"_fitInternal",value:function(t,n,r){return t?(delete(n=e.extend(t,n)).padding,n.linear?this.easeTo(n,r):this.flyTo(n,r)):this}},{key:"jumpTo",value:function(t,n){this.stop();var r=this.transform,i=!1,a=!1,o=!1;return"zoom"in t&&r.zoom!==+t.zoom&&(i=!0,r.zoom=+t.zoom),void 0!==t.center&&(r.center=e.LngLat.convert(t.center)),"bearing"in t&&r.bearing!==+t.bearing&&(a=!0,r.bearing=+t.bearing),"pitch"in t&&r.pitch!==+t.pitch&&(o=!0,r.pitch=+t.pitch),null==t.padding||r.isPaddingEqual(t.padding)||(r.padding=t.padding),this.fire(new e.Event("movestart",n)).fire(new e.Event("move",n)),i&&this.fire(new e.Event("zoomstart",n)).fire(new e.Event("zoom",n)).fire(new e.Event("zoomend",n)),a&&this.fire(new e.Event("rotatestart",n)).fire(new e.Event("rotate",n)).fire(new e.Event("rotateend",n)),o&&this.fire(new e.Event("pitchstart",n)).fire(new e.Event("pitch",n)).fire(new e.Event("pitchend",n)),this.fire(new e.Event("moveend",n))}},{key:"getFreeCameraOptions",value:function(){return this.transform.getFreeCameraOptions()}},{key:"setFreeCameraOptions",value:function(t,n){this.stop();var r=this.transform,i=r.zoom,a=r.pitch,o=r.bearing;r.setFreeCameraOptions(t);var s=i!==r.zoom,l=a!==r.pitch,u=o!==r.bearing;return this.fire(new e.Event("movestart",n)).fire(new e.Event("move",n)),s&&this.fire(new e.Event("zoomstart",n)).fire(new e.Event("zoom",n)).fire(new e.Event("zoomend",n)),u&&this.fire(new e.Event("rotatestart",n)).fire(new e.Event("rotate",n)).fire(new e.Event("rotateend",n)),l&&this.fire(new e.Event("pitchstart",n)).fire(new e.Event("pitch",n)).fire(new e.Event("pitchend",n)),this.fire(new e.Event("moveend",n)),this}},{key:"easeTo",value:function(t,n){var r=this;this._stop(!1,t.easeId),(!1===(t=e.extend({offset:[0,0],duration:500,easing:e.ease},t)).animate||!t.essential&&e.browser.prefersReducedMotion)&&(t.duration=0);var i=this.transform,a=this.getZoom(),o=this.getBearing(),s=this.getPitch(),l=this.getPadding(),u="zoom"in t?+t.zoom:a,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,h="pitch"in t?+t.pitch:s,f="padding"in t?t.padding:i.padding,d=e.Point.convert(t.offset),p=i.centerPoint.add(d),m=i.pointLocation(p),v=e.LngLat.convert(t.center||m);this._normalizeCenter(v);var y,g,_=i.project(m),b=i.project(v).sub(_),x=i.zoomScale(u-a);t.around&&(y=e.LngLat.convert(t.around),g=i.locationPoint(y));var w={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||u!==a,this._rotating=this._rotating||o!==c,this._pitching=this._pitching||h!==s,this._padding=!i.isPaddingEqual(f),this._easeId=t.easeId,this._prepareEase(n,t.noMoveStart,w),this._ease((function(t){if(r._zooming&&(i.zoom=e.number(a,u,t)),r._rotating&&(i.bearing=e.number(o,c,t)),r._pitching&&(i.pitch=e.number(s,h,t)),r._padding&&(i.interpolatePadding(l,f,t),p=i.centerPoint.add(d)),y)i.setLocationAtPoint(y,g);else{var m=i.zoomScale(i.zoom-a),v=u>a?Math.min(2,x):Math.max(.5,x),w=Math.pow(v,1-t),E=i.unproject(_.add(b.mult(t*w)).mult(m));i.setLocationAtPoint(i.renderWorldCopies?E.wrap():E,p)}r._fireMoveEvents(n)}),(function(e){i.recenterOnTerrain(),r._afterEase(n,e)}),t),this}},{key:"_prepareEase",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._moving=!0,this.transform.cameraElevationReference="sea",n||r.moving||this.fire(new e.Event("movestart",t)),this._zooming&&!r.zooming&&this.fire(new e.Event("zoomstart",t)),this._rotating&&!r.rotating&&this.fire(new e.Event("rotatestart",t)),this._pitching&&!r.pitching&&this.fire(new e.Event("pitchstart",t))}},{key:"_fireMoveEvents",value:function(t){this.fire(new e.Event("move",t)),this._zooming&&this.fire(new e.Event("zoom",t)),this._rotating&&this.fire(new e.Event("rotate",t)),this._pitching&&this.fire(new e.Event("pitch",t))}},{key:"_afterEase",value:function(t,n){if(!this._easeId||!n||this._easeId!==n){delete this._easeId,this.transform.cameraElevationReference="ground";var r=this._zooming,i=this._rotating,a=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new e.Event("zoomend",t)),i&&this.fire(new e.Event("rotateend",t)),a&&this.fire(new e.Event("pitchend",t)),this.fire(new e.Event("moveend",t))}}},{key:"flyTo",value:function(t,n){var r=this;if(!t.essential&&e.browser.prefersReducedMotion){var i=e.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,n)}this.stop(),t=e.extend({offset:[0,0],speed:1.2,curve:1.42,easing:e.ease},t);var a=this.transform,o=this.getZoom(),s=this.getBearing(),l=this.getPitch(),u=this.getPadding(),c="zoom"in t?e.clamp(+t.zoom,a.minZoom,a.maxZoom):o,h="bearing"in t?this._normalizeBearing(t.bearing,s):s,f="pitch"in t?+t.pitch:l,d="padding"in t?t.padding:a.padding,p=a.zoomScale(c-o),m=e.Point.convert(t.offset),v=a.centerPoint.add(m),y=a.pointLocation(v),g=e.LngLat.convert(t.center||y);this._normalizeCenter(g);var _=a.project(y),b=a.project(g).sub(_),x=t.curve,w=Math.max(a.width,a.height),E=w/p,S=b.mag();if("minZoom"in t){var T=e.clamp(Math.min(t.minZoom,o,c),a.minZoom,a.maxZoom),k=w/a.zoomScale(T-o);x=Math.sqrt(k/S*2)}var M=x*x;function C(e){var t=(E*E-w*w+(e?-1:1)*M*M*S*S)/(2*(e?E:w)*M*S);return Math.log(Math.sqrt(t*t+1)-t)}function A(e){return(Math.exp(e)-Math.exp(-e))/2}function I(e){return(Math.exp(e)+Math.exp(-e))/2}var P=C(0),R=function(e){return I(P)/I(P+x*e)},L=function(e){return w*((I(P)*(A(t=P+x*e)/I(t))-A(P))/M)/S;var t},O=(C(1)-P)/x;if(Math.abs(S)<1e-6||!isFinite(O)){if(Math.abs(w-E)<1e-6)return this.easeTo(t,n);var D=E<w?-1:1;O=Math.abs(Math.log(E/w))/x,L=function(){return 0},R=function(e){return Math.exp(D*x*e)}}return t.duration="duration"in t?+t.duration:1e3*O/("screenSpeed"in t?+t.screenSpeed/x:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=s!==h,this._pitching=f!==l,this._padding=!a.isPaddingEqual(d),this._prepareEase(n,!1),this._ease((function(t){var i=t*O,p=1/R(i);a.zoom=1===t?c:o+a.scaleZoom(p),r._rotating&&(a.bearing=e.number(s,h,t)),r._pitching&&(a.pitch=e.number(l,f,t)),r._padding&&(a.interpolatePadding(u,d,t),v=a.centerPoint.add(m));var y=1===t?g:a.unproject(_.add(b.mult(L(i))).mult(p));a.setLocationAtPoint(a.renderWorldCopies?y.wrap():y,v),a._updateCenterElevation(),r._fireMoveEvents(n)}),(function(){return r._afterEase(n)}),t),this}},{key:"isEasing",value:function(){return!!this._easeFrameId}},{key:"stop",value:function(){return this._stop()}},{key:"_stop",value:function(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var n=this._onEaseEnd;delete this._onEaseEnd,n.call(this,t)}if(!e){var r=this.handlers;r&&r.stop(!1)}return this}},{key:"_ease",value:function(t,n,r){!1===r.animate||0===r.duration?(t(1),n()):(this._easeStart=e.browser.now(),this._easeOptions=r,this._onEaseFrame=t,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}},{key:"_renderFrameCallback",value:function(){var t=Math.min((e.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}},{key:"_normalizeBearing",value:function(t,n){t=e.wrap(t,-180,180);var r=Math.abs(t-n);return Math.abs(t-360-n)<r&&(t-=360),Math.abs(t+360-n)<r&&(t+=360),t}},{key:"_normalizeCenter",value:function(e){var t=this.transform;if(t.renderWorldCopies&&!t.lngRange){var n=e.lng-t.center.lng;e.lng+=n>180?-360:n<-180?360:0}}}]),r}(e.Evented),hi=function(){function t(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};v(this,t),this.options=n,e.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}return y(t,[{key:"getDefaultPosition",value:function(){return"bottom-right"}},{key:"onAdd",value:function(e){var t=this.options&&this.options.compact;return this._map=e,this._container=d.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=d.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=d.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}},{key:"onRemove",value:function(){d.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}},{key:"_setElementTitle",value:function(e,t){var n=this._map._getUIString("AttributionControl.".concat(t));e.title=n,e.setAttribute("aria-label",n)}},{key:"_toggleAttribution",value:function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))}},{key:"_updateEditLink",value:function(){var t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));var n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.config.ACCESS_TOKEN}];if(t){var r=n.reduce((function(e,t,r){return t.value&&(e+="".concat(t.key,"=").concat(t.value).concat(r<n.length-1?"&":"")),e}),"?");t.href="".concat(e.config.FEEDBACK_URL,"/").concat(r).concat(this._map._hash?this._map._hash.getHashString(!0):""),t.rel="noopener nofollow",this._setElementTitle(t,"MapFeedback")}}},{key:"_updateData",value:function(e){!e||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}},{key:"_updateAttributions",value:function(){if(this._map.style){var e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map((function(e){return"string"!=typeof e?"":e}))):"string"==typeof this.options.customAttribution&&e.push(this.options.customAttribution)),this._map.style.stylesheet){var t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}var n=this._map.style._sourceCaches;for(var r in n){var i=n[r];if(i.used){var a=i.getSource();a.attribution&&e.indexOf(a.attribution)<0&&e.push(a.attribution)}}e.sort((function(e,t){return e.length-t.length}));var o=(e=e.filter((function(t,n){for(var r=n+1;r<e.length;r++)if(e[r].indexOf(t)>=0)return!1;return!0}))).join(" | ");o!==this._attribHTML&&(this._attribHTML=o,e.length?(this._innerContainer.innerHTML=o,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}}},{key:"_updateCompact",value:function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}]),t}(),fi=function(){function t(){v(this,t),e.bindAll(["_updateLogo"],this),e.bindAll(["_updateCompact"],this)}return y(t,[{key:"onAdd",value:function(e){this._map=e,this._container=d.create("div","mapboxgl-ctrl");var t=d.create("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}},{key:"onRemove",value:function(){d.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}},{key:"getDefaultPosition",value:function(){return"bottom-left"}},{key:"_updateLogo",value:function(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}},{key:"_logoRequired",value:function(){if(this._map.style){var e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(var t in e){var n=e[t].getSource();if(n.hasOwnProperty("mapbox_logo")&&!n.mapbox_logo)return!1}return!0}}},{key:"_updateCompact",value:function(){var e=this._container.children;if(e.length){var t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}]),t}(),di=function(){function e(){v(this,e),this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}return y(e,[{key:"add",value:function(e){var t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}},{key:"remove",value:function(e){var t,n=this._currentlyRunning,r=n?this._queue.concat(n):this._queue,i=f(r);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.id===e)return void(a.cancelled=!0)}}catch(o){i.e(o)}finally{i.f()}}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this._currentlyRunning=this._queue;this._queue=[];var n,r=f(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.cancelled&&(i.callback(e),this._cleared))break}}catch(a){r.e(a)}finally{r.f()}this._cleared=!1,this._currentlyRunning=!1}},{key:"clear",value:function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}]),e}(),pi={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},mi=e.window,vi=mi.HTMLImageElement,yi=mi.HTMLElement,gi=mi.ImageBitmap,_i={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function bi(e){e.parentNode&&e.parentNode.removeChild(e)}var xi={showCompass:!0,showZoom:!0,visualizePitch:!1},wi=function(){function t(n,r){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];v(this,t),this._clickTolerance=10,this.element=r,this.mouseRotate=new Fr({clickTolerance:n.dragRotate._mouseRotate._clickTolerance}),this.map=n,i&&(this.mousePitch=new Br({clickTolerance:n.dragRotate._mousePitch._clickTolerance})),e.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),d.addEventListener(r,"mousedown",this.mousedown),d.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),d.addEventListener(r,"touchmove",this.touchmove),d.addEventListener(r,"touchend",this.touchend),d.addEventListener(r,"touchcancel",this.reset)}return y(t,[{key:"down",value:function(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),d.disableDrag()}},{key:"move",value:function(e,t){var n=this.map,r=this.mouseRotate.mousemoveWindow(e,t);if(r&&r.bearingDelta&&n.setBearing(n.getBearing()+r.bearingDelta),this.mousePitch){var i=this.mousePitch.mousemoveWindow(e,t);i&&i.pitchDelta&&n.setPitch(n.getPitch()+i.pitchDelta)}}},{key:"off",value:function(){var e=this.element;d.removeEventListener(e,"mousedown",this.mousedown),d.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),d.removeEventListener(e,"touchmove",this.touchmove),d.removeEventListener(e,"touchend",this.touchend),d.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}},{key:"offTemp",value:function(){d.enableDrag(),d.removeEventListener(e.window,"mousemove",this.mousemove),d.removeEventListener(e.window,"mouseup",this.mouseup)}},{key:"mousedown",value:function(t){this.down(e.extend({},t,{ctrlKey:!0,preventDefault:function(){return t.preventDefault()}}),d.mousePos(this.element,t)),d.addEventListener(e.window,"mousemove",this.mousemove),d.addEventListener(e.window,"mouseup",this.mouseup)}},{key:"mousemove",value:function(e){this.move(e,d.mousePos(this.element,e))}},{key:"mouseup",value:function(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}},{key:"touchstart",value:function(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=d.touchPos(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return e.preventDefault()}},this._startPos))}},{key:"touchmove",value:function(e){1!==e.targetTouches.length?this.reset():(this._lastPos=d.touchPos(this.element,e.targetTouches)[0],this.move({preventDefault:function(){return e.preventDefault()}},this._lastPos))}},{key:"touchend",value:function(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}},{key:"reset",value:function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}]),t}();function Ei(t,n,r){if(t=new e.LngLat(t.lng,t.lat),n){var i=new e.LngLat(t.lng-360,t.lat),a=new e.LngLat(t.lng+360,t.lat),o=360*Math.ceil(Math.abs(t.lng-r.center.lng)/360),s=r.locationPoint(t).distSqr(n),l=n.x<0||n.y<0||n.x>r.width||n.y>r.height;r.locationPoint(i).distSqr(n)<s&&(l||Math.abs(i.lng-r.center.lng)<o)?t=i:r.locationPoint(a).distSqr(n)<s&&(l||Math.abs(a.lng-r.center.lng)<o)&&(t=a)}for(;Math.abs(t.lng-r.center.lng)>180;){var u=r.locationPoint(t);if(u.x>=0&&u.y>=0&&u.x<=r.width&&u.y<=r.height)break;t.lng>r.center.lng?t.lng-=360:t.lng+=360}return t}var Si={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ti(e,t,n){var r=e.classList;for(var i in Si)r.remove("mapboxgl-".concat(n,"-anchor-").concat(i));r.add("mapboxgl-".concat(n,"-anchor-").concat(t))}var ki,Mi=function(t){p(r,t);var n=m(r);function r(t,a){var o;if(v(this,r),o=n.call(this),(t instanceof e.window.HTMLElement||a)&&(t=e.extend({element:t},a)),e.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],i(o)),o._anchor=t&&t.anchor||"center",o._color=t&&t.color||"#3FB1CE",o._scale=t&&t.scale||1,o._draggable=t&&t.draggable||!1,o._clickTolerance=t&&t.clickTolerance||0,o._isDragging=!1,o._state="inactive",o._rotation=t&&t.rotation||0,o._rotationAlignment=t&&t.rotationAlignment||"auto",o._pitchAlignment=t&&t.pitchAlignment&&"auto"!==t.pitchAlignment?t.pitchAlignment:o._rotationAlignment,t&&t.element)o._element=t.element,o._offset=e.Point.convert(t&&t.offset||[0,0]);else{o._defaultMarker=!0,o._element=d.create("div"),o._element.setAttribute("aria-label","Map marker");var s=d.createNS("http://www.w3.org/2000/svg","svg"),u=41,c=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height","".concat(u,"px")),s.setAttributeNS(null,"width","".concat(c,"px")),s.setAttributeNS(null,"viewBox","0 0 ".concat(c," ").concat(u));var h=d.createNS("http://www.w3.org/2000/svg","g");h.setAttributeNS(null,"stroke","none"),h.setAttributeNS(null,"stroke-width","1"),h.setAttributeNS(null,"fill","none"),h.setAttributeNS(null,"fill-rule","evenodd");var f=d.createNS("http://www.w3.org/2000/svg","g");f.setAttributeNS(null,"fill-rule","nonzero");var p=d.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"transform","translate(3.0, 29.0)"),p.setAttributeNS(null,"fill","#000000");for(var m=0,y=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];m<y.length;m++){var g=y[m],_=d.createNS("http://www.w3.org/2000/svg","ellipse");_.setAttributeNS(null,"opacity","0.04"),_.setAttributeNS(null,"cx","10.5"),_.setAttributeNS(null,"cy","5.80029008"),_.setAttributeNS(null,"rx",g.rx),_.setAttributeNS(null,"ry",g.ry),p.appendChild(_)}var b=d.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill",o._color);var x=d.createNS("http://www.w3.org/2000/svg","path");x.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),b.appendChild(x);var w=d.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"opacity","0.25"),w.setAttributeNS(null,"fill","#000000");var E=d.createNS("http://www.w3.org/2000/svg","path");E.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),w.appendChild(E);var S=d.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"transform","translate(6.0, 7.0)"),S.setAttributeNS(null,"fill","#FFFFFF");var T=d.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"transform","translate(8.0, 8.0)");var k=d.createNS("http://www.w3.org/2000/svg","circle");k.setAttributeNS(null,"fill","#000000"),k.setAttributeNS(null,"opacity","0.25"),k.setAttributeNS(null,"cx","5.5"),k.setAttributeNS(null,"cy","5.5"),k.setAttributeNS(null,"r","5.4999962");var M=d.createNS("http://www.w3.org/2000/svg","circle");M.setAttributeNS(null,"fill","#FFFFFF"),M.setAttributeNS(null,"cx","5.5"),M.setAttributeNS(null,"cy","5.5"),M.setAttributeNS(null,"r","5.4999962"),T.appendChild(k),T.appendChild(M),f.appendChild(p),f.appendChild(b),f.appendChild(w),f.appendChild(S),f.appendChild(T),s.appendChild(f),s.setAttributeNS(null,"height","".concat(u*o._scale,"px")),s.setAttributeNS(null,"width","".concat(c*o._scale,"px")),o._element.appendChild(s),o._offset=e.Point.convert(t&&t.offset||[0,-14])}return o._element.classList.add("mapboxgl-marker"),o._element.addEventListener("dragstart",(function(e){e.preventDefault()})),o._element.addEventListener("mousedown",(function(e){e.preventDefault()})),Ti(o._element,o._anchor,"marker"),o._popup=null,l(o)}return y(r,[{key:"addTo",value:function(e){return this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}},{key:"remove",value:function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),d.remove(this._element),this._popup&&this._popup.remove(),this}},{key:"getLngLat",value:function(){return this._lngLat}},{key:"setLngLat",value:function(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}},{key:"getElement",value:function(){return this._element}},{key:"setPopup",value:function(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){var t=38.1,n=13.5,r=Math.sqrt(Math.pow(n,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[r,-1*(t-n+r)],"bottom-right":[-r,-1*(t-n+r)],left:[n,-1*(t-n)],right:[-n,-1*(t-n)]}:this._offset}this._popup=e,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}},{key:"_onKeyPress",value:function(e){var t=e.code,n=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==n&&13!==n||this.togglePopup()}},{key:"_onMapClick",value:function(e){var t=e.originalEvent.target,n=this._element;this._popup&&(t===n||n.contains(t))&&this.togglePopup()}},{key:"getPopup",value:function(){return this._popup}},{key:"togglePopup",value:function(){var e=this._popup;return e?(e.isOpen()?e.remove():e.addTo(this._map),this):this}},{key:"_updateOcclusion",value:function(){this._occlusionTimer||(this._occlusionTimer=setTimeout(this._onOcclusionTimer.bind(this),60))}},{key:"_onOcclusionTimer",value:function(){var e=this._map.transform,t=this._pos?this._pos.sub(this._transformedOffset()):null;if(t&&t.x>=0&&t.x<e.width&&t.y>=0&&t.y<e.height){var n=this._map.unproject(t),r=this._map.getFreeCameraOptions();if(r.position){var i=r.position.toLngLat(),a=i.distanceTo(n),o=i.distanceTo(this._lngLat);this._element.classList.toggle("mapboxgl-marker-occluded",a<.9*o)}}this._occlusionTimer=null}},{key:"_update",value:function(e){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Ei(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._transformedOffset()),this._map.transform.elevation&&this._updateOcclusion();var t="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?t="rotateZ(".concat(this._rotation,"deg)"):"map"===this._rotationAlignment&&(t="rotateZ(".concat(this._rotation-this._map.getBearing(),"deg)"));var n="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?n="rotateX(0deg)":"map"===this._pitchAlignment&&(n="rotateX(".concat(this._map.getPitch(),"deg)")),e&&"moveend"!==e.type||(this._pos=this._pos.round()),d.setTransform(this._element,"".concat(Si[this._anchor]," translate(").concat(this._pos.x,"px, ").concat(this._pos.y,"px) ").concat(n," ").concat(t))}}},{key:"_transformedOffset",value:function(){if(!this._defaultMarker)return this._offset;var e=this._map.transform,t=this._offset.mult(this._scale);return"map"===this._rotationAlignment&&t._rotate(e.angle),"map"===this._pitchAlignment&&(t.y*=Math.cos(e._pitch)),t}},{key:"getOffset",value:function(){return this._offset}},{key:"setOffset",value:function(t){return this._offset=e.Point.convert(t),this._update(),this}},{key:"_onMove",value:function(t){if(!this._isDragging){var n=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=n}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.Event("dragstart"))),this.fire(new e.Event("drag")))}},{key:"_onUp",value:function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new e.Event("dragend")),this._state="inactive"}},{key:"_addDragHandler",value:function(e){this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(this._pos).add(this._transformedOffset()),this._pointerdownPos=e.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}},{key:"setDraggable",value:function(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}},{key:"isDraggable",value:function(){return this._draggable}},{key:"setRotation",value:function(e){return this._rotation=e||0,this._update(),this}},{key:"getRotation",value:function(){return this._rotation}},{key:"setRotationAlignment",value:function(e){return this._rotationAlignment=e||"auto",this._update(),this}},{key:"getRotationAlignment",value:function(){return this._rotationAlignment}},{key:"setPitchAlignment",value:function(e){return this._pitchAlignment=e&&"auto"!==e?e:this._rotationAlignment,this._update(),this}},{key:"getPitchAlignment",value:function(){return this._pitchAlignment}}]),r}(e.Evented),Ci={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Ai=0,Ii=!1,Pi={maxWidth:100,unit:"metric"};function Ri(e,t,n){var r=n&&n.maxWidth||100,i=e._container.clientHeight/2,a=e.unproject([0,i]),o=e.unproject([r,i]),s=a.distanceTo(o);if(n&&"imperial"===n.unit){var l=3.2808*s;l>5280?Li(t,r,l/5280,e._getUIString("ScaleControl.Miles")):Li(t,r,l,e._getUIString("ScaleControl.Feet"))}else n&&"nautical"===n.unit?Li(t,r,s/1852,e._getUIString("ScaleControl.NauticalMiles")):s>=1e3?Li(t,r,s/1e3,e._getUIString("ScaleControl.Kilometers")):Li(t,r,s,e._getUIString("ScaleControl.Meters"))}function Li(e,t,n,r){var i=function(e){var t=Math.pow(10,"".concat(Math.floor(e)).length-1),n=e/t;return t*(n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(e){var t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(n))}(n);e.style.width="".concat(t*(i/n),"px"),e.innerHTML="".concat(i,"&nbsp;").concat(r)}var Oi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Di=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Ni={version:e.version,supported:t,setRTLTextPlugin:e.setRTLTextPlugin,getRTLTextPluginStatus:e.getRTLTextPluginStatus,Map:function(n){p(c,n);var u=m(c);function c(t){var n;if(v(this,c),null!=(t=e.extend({},_i,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if((n=u.call(this,new mr(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t))._interactive=t.interactive,n._maxTileCacheSize=t.maxTileCacheSize,n._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,n._preserveDrawingBuffer=t.preserveDrawingBuffer,n._antialias=t.antialias,n._trackResize=t.trackResize,n._bearingSnap=t.bearingSnap,n._refreshExpiredTiles=t.refreshExpiredTiles,n._fadeDuration=t.fadeDuration,n._isInitialLoad=!0,n._crossSourceCollisions=t.crossSourceCollisions,n._crossFadingFactor=1,n._collectResourceTiming=t.collectResourceTiming,n._renderTaskQueue=new di,n._controls=[],n._mapId=e.uniqueId(),n._locale=e.extend({},pi,t.locale),n._clickTolerance=t.clickTolerance,n._requestManager=new e.RequestManager(t.transformRequest,t.accessToken),"string"==typeof t.container){if(n._container=e.window.document.getElementById(t.container),!n._container)throw new Error("Container '".concat(t.container,"' not found."))}else{if(!(t.container instanceof yi))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");n._container=t.container}if(t.maxBounds&&n.setMaxBounds(t.maxBounds),e.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],i(n)),n._setupContainer(),n._setupPainter(),void 0===n.painter)throw new Error("Failed to initialize WebGL.");return n.on("move",(function(){return n._update(!1)})),n.on("moveend",(function(){return n._update(!1)})),n.on("zoom",(function(){return n._update(!0)})),void 0!==e.window&&(e.window.addEventListener("online",n._onWindowOnline,!1),e.window.addEventListener("resize",n._onWindowResize,!1),e.window.addEventListener("orientationchange",n._onWindowResize,!1)),n.handlers=new ui(i(n),t),n._hash=t.hash&&new vr("string"==typeof t.hash&&t.hash||void 0).addTo(i(n)),n._hash&&n._hash._onHashChange()||(n.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(n.resize(),n.fitBounds(t.bounds,e.extend({},t.fitBoundsOptions,{duration:0})))),n.resize(),n._localIdeographFontFamily=t.localIdeographFontFamily,t.style&&n.setStyle(t.style,{localIdeographFontFamily:t.localIdeographFontFamily}),t.attributionControl&&n.addControl(new hi({customAttribution:t.customAttribution})),n._logoControl=new fi,n.addControl(n._logoControl,t.logoPosition),n.on("style.load",(function(){n.transform.unmodified&&n.jumpTo(n.style.stylesheet)})),n.on("data",(function(t){n._update("style"===t.dataType),n.fire(new e.Event("".concat(t.dataType,"data"),t))})),n.on("dataloading",(function(t){n.fire(new e.Event("".concat(t.dataType,"dataloading"),t))})),l(n)}return y(c,[{key:"_getMapId",value:function(){return this._mapId}},{key:"addControl",value:function(t,n){if(void 0===n&&(n=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var r=t.onAdd(this);this._controls.push(t);var i=this._controlPositions[n];return-1!==n.indexOf("bottom")?i.insertBefore(r,i.firstChild):i.appendChild(r),this}},{key:"removeControl",value:function(t){if(!t||!t.onRemove)return this.fire(new e.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var n=this._controls.indexOf(t);return n>-1&&this._controls.splice(n,1),t.onRemove(this),this}},{key:"hasControl",value:function(e){return this._controls.indexOf(e)>-1}},{key:"resize",value:function(t){var n=this._containerDimensions(),r=n[0],i=n[1];this._resizeCanvas(r,i),this.transform.resize(r,i),this.painter.resize(r,i);var a=!this._moving;return a&&(this.stop(),this.fire(new e.Event("movestart",t)).fire(new e.Event("move",t))),this.fire(new e.Event("resize",t)),a&&this.fire(new e.Event("moveend",t)),this}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(t){return this.transform.setMaxBounds(e.LngLatBounds.convert(t)),this._update()}},{key:"setMinZoom",value:function(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e&&this.setZoom(e),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e&&this.setZoom(e),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e&&this.setPitch(e),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(e){if((e=null==e?85:e)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e&&this.setPitch(e),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(e){return this.transform.renderWorldCopies=e,this._update()}},{key:"project",value:function(t){return this.transform.locationPoint3D(e.LngLat.convert(t))}},{key:"unproject",value:function(t){return this.transform.pointLocation3D(e.Point.convert(t))}},{key:"isMoving",value:function(){return this._moving||this.handlers&&this.handlers.isMoving()}},{key:"isZooming",value:function(){return this._zooming||this.handlers&&this.handlers.isZooming()}},{key:"isRotating",value:function(){return this._rotating||this.handlers&&this.handlers.isRotating()}},{key:"_createDelegatedListener",value:function(e,t,n){var i=this;if("mouseenter"===e||"mouseover"===e){var a=!1,o=function(r){var o=i.getLayer(t)?i.queryRenderedFeatures(r.point,{layers:[t]}):[];o.length?a||(a=!0,n.call(i,new Tr(e,i,r.originalEvent,{features:o}))):a=!1};return{layer:t,listener:n,delegates:{mousemove:o,mouseout:function(){a=!1}}}}if("mouseleave"===e||"mouseout"===e){var s=!1,l=function(r){(i.getLayer(t)?i.queryRenderedFeatures(r.point,{layers:[t]}):[]).length?s=!0:s&&(s=!1,n.call(i,new Tr(e,i,r.originalEvent)))},u=function(t){s&&(s=!1,n.call(i,new Tr(e,i,t.originalEvent)))};return{layer:t,listener:n,delegates:{mousemove:l,mouseout:u}}}var c=function(e){var r=i.getLayer(t)?i.queryRenderedFeatures(e.point,{layers:[t]}):[];r.length&&(e.features=r,n.call(i,e),delete e.features)};return{layer:t,listener:n,delegates:r({},e,c)}}},{key:"on",value:function(e,t,n){if(void 0===n)return o(s(c.prototype),"on",this).call(this,e,t);var r=this._createDelegatedListener(e,t,n);for(var i in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(r),r.delegates)this.on(i,r.delegates[i]);return this}},{key:"once",value:function(e,t,n){if(void 0===n)return o(s(c.prototype),"once",this).call(this,e,t);var r=this._createDelegatedListener(e,t,n);for(var i in r.delegates)this.once(i,r.delegates[i]);return this}},{key:"off",value:function(e,t,n){var r=this;return void 0===n?o(s(c.prototype),"off",this).call(this,e,t):(this._delegatedListeners&&this._delegatedListeners[e]&&function(i){for(var a=r._delegatedListeners[e],o=0;o<a.length;o++){var s=a[o];if(s.layer===t&&s.listener===n){for(var l in s.delegates)r.off(l,s.delegates[l]);return a.splice(o,1),r}}}(),this)}},{key:"queryRenderedFeatures",value:function(t,n){return this.style?(void 0!==n||void 0===t||t instanceof e.Point||Array.isArray(t)||(n=t,t=void 0),this.style.queryRenderedFeatures(t=t||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}},{key:"querySourceFeatures",value:function(e,t){return this.style.querySourceFeatures(e,t)}},{key:"setStyle",value:function(t,n){return!1!==(n=e.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&t?(this._diffStyle(t,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(t,n))}},{key:"_getUIString",value:function(e){var t=this._locale[e];if(null==t)throw new Error("Missing UI string '".concat(e,"'"));return t}},{key:"_updateStyle",value:function(e,t){return this.style&&(this.style.setEventedParent(null),this.style._remove(),delete this.style),e&&(this.style=new ot(this,t||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof e?this.style.loadURL(e):this.style.loadJSON(e)),this._updateTerrain(),this}},{key:"_lazyInitEmptyStyle",value:function(){this.style||(this.style=new ot(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}},{key:"_diffStyle",value:function(t,n){var r=this;if("string"==typeof t){var i=this._requestManager.normalizeStyleURL(t),a=this._requestManager.transformRequest(i,e.ResourceType.Style);e.getJSON(a,(function(t,i){t?r.fire(new e.ErrorEvent(t)):i&&r._updateDiff(i,n)}))}else"object"==typeof t&&this._updateDiff(t,n)}},{key:"_updateDiff",value:function(t,n){try{this.style.setState(t)&&this._update(!0)}catch(a){e.warnOnce("Unable to perform style diff: ".concat(a.message||a.error||a,".  Rebuilding the style from scratch.")),this._updateStyle(t,n)}}},{key:"getStyle",value:function(){if(this.style)return this.style.serialize()}},{key:"isStyleLoaded",value:function(){return this.style?this.style.loaded():e.warnOnce("There is no style added to the map.")}},{key:"addSource",value:function(e,t){return this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)}},{key:"isSourceLoaded",value:function(t){var n=this.style&&this.style._getSourceCaches(t);if(0!==n.length)return n.every((function(e){return e.loaded()}));this.fire(new e.ErrorEvent(new Error("There is no source with ID '".concat(t,"'"))))}},{key:"areTilesLoaded",value:function(){var e=this.style&&this.style._sourceCaches;for(var t in e){var n=e[t]._tiles;for(var r in n){var i=n[r];if("loaded"!==i.state&&"errored"!==i.state)return!1}}return!0}},{key:"addSourceType",value:function(e,t,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,n)}},{key:"removeSource",value:function(e){return this.style.removeSource(e),this._updateTerrain(),this._update(!0)}},{key:"getSource",value:function(e){return this.style.getSource(e)}},{key:"addImage",value:function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.pixelRatio,a=void 0===i?1:i,o=r.sdf,s=void 0!==o&&o,l=r.stretchX,u=r.stretchY,c=r.content;if(this._lazyInitEmptyStyle(),n instanceof vi||gi&&n instanceof gi){var h=e.browser.getImageData(n),f=h.width,d=h.height,p=h.data;this.style.addImage(t,{data:new e.RGBAImage({width:f,height:d},p),pixelRatio:a,stretchX:l,stretchY:u,content:c,sdf:s,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var m=n.width,v=n.height,y=n.data,g=n;this.style.addImage(t,{data:new e.RGBAImage({width:m,height:v},new Uint8Array(y)),pixelRatio:a,stretchX:l,stretchY:u,content:c,sdf:s,version:0,userImage:g}),g.onAdd&&g.onAdd(this,t)}}},{key:"updateImage",value:function(t,n){var r=this.style.getImage(t);if(!r)return this.fire(new e.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var i=n instanceof vi||gi&&n instanceof gi?e.browser.getImageData(n):n,a=i.width,o=i.height,s=i.data;return void 0===a||void 0===o?this.fire(new e.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):a!==r.data.width||o!==r.data.height?this.fire(new e.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(r.data.replace(s,!(n instanceof vi||gi&&n instanceof gi)),void this.style.updateImage(t,r))}},{key:"hasImage",value:function(t){return t?!!this.style.getImage(t):(this.fire(new e.ErrorEvent(new Error("Missing required image id"))),!1)}},{key:"removeImage",value:function(e){this.style.removeImage(e)}},{key:"loadImage",value:function(t,n){e.getImage(this._requestManager.transformRequest(t,e.ResourceType.Image),n)}},{key:"listImages",value:function(){return this.style.listImages()}},{key:"addLayer",value:function(e,t){return this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)}},{key:"moveLayer",value:function(e,t){return this.style.moveLayer(e,t),this._update(!0)}},{key:"removeLayer",value:function(e){return this.style.removeLayer(e),this._update(!0)}},{key:"getLayer",value:function(e){return this.style.getLayer(e)}},{key:"setLayerZoomRange",value:function(e,t,n){return this.style.setLayerZoomRange(e,t,n),this._update(!0)}},{key:"setFilter",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.style.setFilter(e,t,n),this._update(!0)}},{key:"getFilter",value:function(e){return this.style.getFilter(e)}},{key:"setPaintProperty",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.style.setPaintProperty(e,t,n,r),this._update(!0)}},{key:"getPaintProperty",value:function(e,t){return this.style.getPaintProperty(e,t)}},{key:"setLayoutProperty",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.style.setLayoutProperty(e,t,n,r),this._update(!0)}},{key:"getLayoutProperty",value:function(e,t){return this.style.getLayoutProperty(e,t)}},{key:"setLight",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this._lazyInitEmptyStyle(),this.style.setLight(e,t),this._update(!0)}},{key:"getLight",value:function(){return this.style.getLight()}},{key:"setTerrain",value:function(e){return this._lazyInitEmptyStyle(),this.style.setTerrain(e),this._update(!0)}},{key:"setFeatureState",value:function(e,t){return this.style.setFeatureState(e,t),this._update()}},{key:"removeFeatureState",value:function(e,t){return this.style.removeFeatureState(e,t),this._update()}},{key:"getFeatureState",value:function(e){return this.style.getFeatureState(e)}},{key:"getContainer",value:function(){return this._container}},{key:"getCanvasContainer",value:function(){return this._canvasContainer}},{key:"getCanvas",value:function(){return this._canvas}},{key:"_containerDimensions",value:function(){var e=0,t=0;return this._container&&(e=this._container.clientWidth||400,t=this._container.clientHeight||300),[e,t]}},{key:"_detectMissingCSS",value:function(){"rgb(250, 128, 114)"!==e.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}},{key:"_setupContainer",value:function(){var e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=d.create("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();var t=this._canvasContainer=d.create("div","mapboxgl-canvas-container",e);this._interactive&&t.classList.add("mapboxgl-interactive"),this._canvas=d.create("canvas","mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var n=this._containerDimensions();this._resizeCanvas(n[0],n[1]);var r=this._controlContainer=d.create("div","mapboxgl-control-container",e),i=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(e){i[e]=d.create("div","mapboxgl-ctrl-".concat(e),r)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}},{key:"_resizeCanvas",value:function(t,n){var r=e.browser.devicePixelRatio||1;this._canvas.width=r*t,this._canvas.height=r*n,this._canvas.style.width="".concat(t,"px"),this._canvas.style.height="".concat(n,"px")}},{key:"_setupPainter",value:function(){var n=this,r=e.extend({},t.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",r)||this._canvas.getContext("experimental-webgl",r);i?(this.painter=new ar(i,this.transform),this.on("data",(function(e){"source"===e.dataType&&n.painter.setTileLoadedFlag(!0)})),e.webpSupported.testSupport(i)):this.fire(new e.ErrorEvent(new Error("Failed to initialize WebGL")))}},{key:"_contextLost",value:function(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.Event("webglcontextlost",{originalEvent:t}))}},{key:"_contextRestored",value:function(t){this._setupPainter(),this.resize(),this._update(),this.fire(new e.Event("webglcontextrestored",{originalEvent:t}))}},{key:"_onMapScroll",value:function(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}},{key:"loaded",value:function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}},{key:"_update",value:function(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}},{key:"_requestRenderFrame",value:function(e){return this._update(),this._renderTaskQueue.add(e)}},{key:"_cancelRenderFrame",value:function(e){this._renderTaskQueue.remove(e)}},{key:"_render",value:function(t){var n,r=this,i=0,a=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(n=a.createQueryEXT(),a.beginQueryEXT(a.TIME_ELAPSED_EXT,n),i=e.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(t),!this._removed){var o=!1,s=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;var l=this.transform.zoom,u=e.browser.now();this.style.zoomHistory.update(l,u);var c=new e.EvaluationParameters(l,{now:u,fadeDuration:s,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),h=c.crossFadingFactor();1===h&&h===this._crossFadingFactor||(o=!0,this._crossFadingFactor=h),this.style.update(c)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this._updateTerrain(),this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new e.Event("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var f=e.browser.now()-i;a.endQueryEXT(a.TIME_ELAPSED_EXT,n),setTimeout((function(){var t=a.getQueryObjectEXT(n,a.QUERY_RESULT_EXT)/1e6;a.deleteQueryEXT(n),r.fire(new e.Event("gpu-timing-frame",{cpuTime:f,gpuTime:t}))}),50)}if(this.listens("gpu-timing-layer")){var d=this.painter.collectGpuTimers();setTimeout((function(){var t=r.painter.queryGpuTimers(d);r.fire(new e.Event("gpu-timing-layer",{layerTimes:t}))}),50)}var p=this._sourcesDirty||this._styleDirty||this._placementDirty;if(p||this._repaint)this.triggerRepaint();else if(this._triggerFrame(!1),!this.isMoving()&&this.loaded()&&(this.fire(new e.Event("idle")),this._isInitialLoad&&this._authenticate(),this._isInitialLoad=!1,this.speedIndexTiming)){var m=this._calculateSpeedIndex();this.fire(new e.Event("speedindexcompleted",{speedIndex:m})),this.speedIndexTiming=!1}return!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0),this}}},{key:"_authenticate",value:function(){var t=this;e.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(function(n){if(n&&(n.message===e.AUTH_ERR_MSG||401===n.status)){console.error("Error: A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/"),e.browser.setErrorState();var r=t.painter.context.gl;t._logoControl instanceof fi&&t._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT)}})),e.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(function(){}))}},{key:"_updateTerrain",value:function(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}},{key:"_calculateSpeedIndex",value:function(){var e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());var n=this.painter.context.gl,r=n.createFramebuffer();function i(e){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);var t=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,t),t}return n.bindFramebuffer(n.FRAMEBUFFER,r),this._canvasPixelComparison(i(e),t.canvasCopies.map(i),t.timeStamps)}},{key:"_canvasPixelComparison",value:function(e,t,n){for(var r=n[1]-n[0],i=e.length/4,a=0;a<t.length;a++){for(var o=t[a],s=0,l=0;l<o.length;l+=4)o[l]===e[l]&&o[l+1]===e[l+1]&&o[l+2]===e[l+2]&&o[l+3]===e[l+3]&&(s+=1);r+=(n[a+2]-n[a+1])*(1-s/i)}return r}},{key:"remove",value:function(){this._hash&&this._hash.remove();var t,n=f(this._controls);try{for(n.s();!(t=n.n()).done;)t.value.onRemove(this)}catch(i){n.e(i)}finally{n.f()}this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==e.window&&(e.window.removeEventListener("resize",this._onWindowResize,!1),e.window.removeEventListener("orientationchange",this._onWindowResize,!1),e.window.removeEventListener("online",this._onWindowOnline,!1));var r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),bi(this._canvasContainer),bi(this._controlContainer),bi(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new e.Event("remove"))}},{key:"triggerRepaint",value:function(){this._triggerFrame(!0)}},{key:"_triggerFrame",value:function(t){var n=this;this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.browser.frame((function(e){var t=!!n._renderNextFrame;n._frame=null,n._renderNextFrame=null,t&&n._render(e)})))}},{key:"_onWindowOnline",value:function(){this._update()}},{key:"_onWindowResize",value:function(e){this._trackResize&&this.resize({originalEvent:e})._update()}},{key:"_setCacheLimits",value:function(t,n){e.setCacheLimits(t,n)}},{key:"showTileBoundaries",get:function(){return!!this._showTileBoundaries},set:function(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}},{key:"speedIndexTiming",get:function(){return!!this._speedIndexTiming},set:function(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}},{key:"showPadding",get:function(){return!!this._showPadding},set:function(e){this._showPadding!==e&&(this._showPadding=e,this._update())}},{key:"showCollisionBoxes",get:function(){return!!this._showCollisionBoxes},set:function(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,e?this.style._generateCollisionBoxes():this._update())}},{key:"showOverdrawInspector",get:function(){return!!this._showOverdrawInspector},set:function(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}},{key:"repaint",get:function(){return!!this._repaint},set:function(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}},{key:"vertices",get:function(){return!!this._vertices},set:function(e){this._vertices=e,this._update()}},{key:"version",get:function(){return e.version}}]),c}(ci),NavigationControl:function(){function t(n){var r=this;v(this,t),this.options=e.extend({},xi,n),this._container=d.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(e){return e.preventDefault()})),this.options.showZoom&&(e.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(function(e){return r._map.zoomIn({},{originalEvent:e})})),d.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(function(e){return r._map.zoomOut({},{originalEvent:e})})),d.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(e.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(function(e){r.options.visualizePitch?r._map.resetNorthPitch({},{originalEvent:e}):r._map.resetNorth({},{originalEvent:e})})),this._compassIcon=d.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))}return y(t,[{key:"_updateZoomButtons",value:function(){var e=this._map.getZoom(),t=e===this._map.getMaxZoom(),n=e===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}},{key:"_rotateCompassArrow",value:function(){var e=this.options.visualizePitch?"scale(".concat(1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5),") rotateX(").concat(this._map.transform.pitch,"deg) rotateZ(").concat(this._map.transform.angle*(180/Math.PI),"deg)"):"rotate(".concat(this._map.transform.angle*(180/Math.PI),"deg)");this._compassIcon.style.transform=e}},{key:"onAdd",value:function(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wi(this._map,this._compass,this.options.visualizePitch)),this._container}},{key:"onRemove",value:function(){d.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}},{key:"_createButton",value:function(e,t){var n=d.create("button",e,this._container);return n.type="button",n.addEventListener("click",t),n}},{key:"_setButtonTitle",value:function(e,t){var n=this._map._getUIString("NavigationControl.".concat(t));e.title=n,e.setAttribute("aria-label",n)}}]),t}(),GeolocateControl:function(t){p(r,t);var n=m(r);function r(t){var a;return v(this,r),(a=n.call(this)).options=e.extend({},Ci,t),e.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],i(a)),a}return y(r,[{key:"onAdd",value:function(t){var n;return this._map=t,this._container=d.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,void 0!==ki?n(ki):void 0!==e.window.navigator.permissions?e.window.navigator.permissions.query({name:"geolocation"}).then((function(e){ki="denied"!==e.state,n(ki)})):(ki=!!e.window.navigator.geolocation,n(ki)),this._container}},{key:"onRemove",value:function(){void 0!==this._geolocationWatchID&&(e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),d.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Ai=0,Ii=!1}},{key:"_isOutOfMapMaxBounds",value:function(e){var t=this._map.getMaxBounds(),n=e.coords;return t&&(n.longitude<t.getWest()||n.longitude>t.getEast()||n.latitude<t.getSouth()||n.latitude>t.getNorth())}},{key:"_setErrorState",value:function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}},{key:"_onSuccess",value:function(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.Event("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("geolocate",t)),this._finish()}}},{key:"_updateCamera",value:function(t){var n=new e.LngLat(t.coords.longitude,t.coords.latitude),r=t.coords.accuracy,i=this._map.getBearing(),a=e.extend({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(r),a,{geolocateSource:!0})}},{key:"_updateMarker",value:function(t){if(t){var n=new e.LngLat(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}},{key:"_updateCircleRadius",value:function(){var e=this._map._container.clientHeight/2,t=this._map.unproject([0,e]),n=this._map.unproject([1,e]),r=t.distanceTo(n),i=Math.ceil(2*this._accuracy/r);this._circleElement.style.width="".concat(i,"px"),this._circleElement.style.height="".concat(i,"px")}},{key:"_onZoom",value:function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}},{key:"_onError",value:function(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&Ii)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new e.Event("error",t)),this._finish()}}},{key:"_finish",value:function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}},{key:"_setupUI",value:function(t){var n=this;if(this._container.addEventListener("contextmenu",(function(e){return e.preventDefault()})),this._geolocateButton=d.create("button","mapboxgl-ctrl-geolocate",this._container),d.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===t){e.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=r,this._geolocateButton.setAttribute("aria-label",r)}else{var i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=d.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Mi(this._dotElement),this._circleElement=d.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Mi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(t){t.geolocateSource||"ACTIVE_LOCK"!==n._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(n._watchState="BACKGROUND",n._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),n._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),n.fire(new e.Event("trackuserlocationend")))}))}},{key:"trigger",value:function(){if(!this._setup)return e.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ai--,Ii=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Ai>1?(t={maximumAge:6e5,timeout:0},Ii=!0):(t=this.options.positionOptions,Ii=!1),this._geolocationWatchID=e.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,t)}}else e.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}},{key:"_clearWatch",value:function(){e.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}}]),r}(e.Evented),AttributionControl:hi,ScaleControl:function(){function t(n){v(this,t),this.options=e.extend({},Pi,n),e.bindAll(["_onMove","setUnit"],this)}return y(t,[{key:"getDefaultPosition",value:function(){return"bottom-left"}},{key:"_onMove",value:function(){Ri(this._map,this._container,this.options)}},{key:"onAdd",value:function(e){return this._map=e,this._container=d.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}},{key:"onRemove",value:function(){d.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},{key:"setUnit",value:function(e){this.options.unit=e,Ri(this._map,this._container,this.options)}}]),t}(),FullscreenControl:function(){function t(n){v(this,t),this._fullscreen=!1,n&&n.container&&(n.container instanceof e.window.HTMLElement?this._container=n.container:e.warnOnce("Full screen control 'container' must be a DOM element.")),e.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in e.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in e.window.document&&(this._fullscreenchange="webkitfullscreenchange")}return y(t,[{key:"onAdd",value:function(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=d.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}},{key:"onRemove",value:function(){d.remove(this._controlContainer),this._map=null,e.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}},{key:"_checkFullscreenSupport",value:function(){return!(!e.window.document.fullscreenEnabled&&!e.window.document.webkitFullscreenEnabled)}},{key:"_setupUI",value:function(){var t=this._fullscreenButton=d.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);d.create("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden",!0),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),e.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}},{key:"_updateTitle",value:function(){var e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.title=e}},{key:"_getTitle",value:function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}},{key:"_isFullscreen",value:function(){return this._fullscreen}},{key:"_changeIcon",value:function(){(e.window.document.fullscreenElement||e.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}},{key:"_onClickFullscreen",value:function(){this._isFullscreen()?e.window.document.exitFullscreen?e.window.document.exitFullscreen():e.window.document.webkitCancelFullScreen&&e.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}}]),t}(),Popup:function(t){p(r,t);var n=m(r);function r(t){var a;return v(this,r),(a=n.call(this)).options=e.extend(Object.create(Oi),t),e.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],i(a)),a}return y(r,[{key:"addTo",value:function(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new e.Event("open")),this}},{key:"isOpen",value:function(){return!!this._map}},{key:"remove",value:function(){return this._content&&d.remove(this._content),this._container&&(d.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new e.Event("close")),this}},{key:"getLngLat",value:function(){return this._lngLat}},{key:"setLngLat",value:function(t){return this._lngLat=e.LngLat.convert(t),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}},{key:"trackPointer",value:function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this}},{key:"getElement",value:function(){return this._container}},{key:"setText",value:function(t){return this.setDOMContent(e.window.document.createTextNode(t))}},{key:"setHTML",value:function(t){var n,r=e.window.document.createDocumentFragment(),i=e.window.document.createElement("body");for(i.innerHTML=t;n=i.firstChild;)r.appendChild(n);return this.setDOMContent(r)}},{key:"getMaxWidth",value:function(){return this._container&&this._container.style.maxWidth}},{key:"setMaxWidth",value:function(e){return this.options.maxWidth=e,this._update(),this}},{key:"setDOMContent",value:function(e){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=d.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(e),this._createCloseButton(),this._update(),this._focusFirstElement(),this}},{key:"addClassName",value:function(e){this._container&&this._container.classList.add(e)}},{key:"removeClassName",value:function(e){this._container&&this._container.classList.remove(e)}},{key:"setOffset",value:function(e){return this.options.offset=e,this._update(),this}},{key:"toggleClassName",value:function(e){if(this._container)return this._container.classList.toggle(e)}},{key:"_createCloseButton",value:function(){this.options.closeButton&&(this._closeButton=d.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}},{key:"_onMouseUp",value:function(e){this._update(e.point)}},{key:"_onMouseMove",value:function(e){this._update(e.point)}},{key:"_onDrag",value:function(e){this._update(e.point)}},{key:"_update",value:function(t){var n=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=d.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=d.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((function(e){return n._container.classList.add(e)})),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Ei(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||t)){var r=this._pos=this._trackPointer&&t?t:this._map.project(this._lngLat),i=this.options.anchor,a=function t(n){if(n){if("number"==typeof n){var r=Math.round(Math.sqrt(.5*Math.pow(n,2)));return{center:new e.Point(0,0),top:new e.Point(0,n),"top-left":new e.Point(r,r),"top-right":new e.Point(-r,r),bottom:new e.Point(0,-n),"bottom-left":new e.Point(r,-r),"bottom-right":new e.Point(-r,-r),left:new e.Point(n,0),right:new e.Point(-n,0)}}if(n instanceof e.Point||Array.isArray(n)){var i=e.Point.convert(n);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:e.Point.convert(n.center||[0,0]),top:e.Point.convert(n.top||[0,0]),"top-left":e.Point.convert(n["top-left"]||[0,0]),"top-right":e.Point.convert(n["top-right"]||[0,0]),bottom:e.Point.convert(n.bottom||[0,0]),"bottom-left":e.Point.convert(n["bottom-left"]||[0,0]),"bottom-right":e.Point.convert(n["bottom-right"]||[0,0]),left:e.Point.convert(n.left||[0,0]),right:e.Point.convert(n.right||[0,0])}}return t(new e.Point(0,0))}(this.options.offset);if(!i){var o,s=this._container.offsetWidth,l=this._container.offsetHeight;o=r.y+a.bottom.y<l?["top"]:r.y>this._map.transform.height-l?["bottom"]:[],r.x<s/2?o.push("left"):r.x>this._map.transform.width-s/2&&o.push("right"),i=0===o.length?"bottom":o.join("-")}var u=r.add(a[i]).round();d.setTransform(this._container,"".concat(Si[i]," translate(").concat(u.x,"px,").concat(u.y,"px)")),Ti(this._container,i,"popup")}}},{key:"_focusFirstElement",value:function(){if(this.options.focusAfterOpen&&this._container){var e=this._container.querySelector(Di);e&&e.focus()}}},{key:"_onClose",value:function(){this.remove()}}]),r}(e.Evented),Marker:Mi,Style:ot,LngLat:e.LngLat,LngLatBounds:e.LngLatBounds,Point:e.Point,MercatorCoordinate:e.MercatorCoordinate,FreeCameraOptions:dr,Evented:e.Evented,config:e.config,prewarm:function(){ne().acquire(ee)},clearPrewarmedResources:function(){var e=$;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(ee),$=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return e.config.ACCESS_TOKEN},set accessToken(t){e.config.ACCESS_TOKEN=t},get baseApiUrl(){return e.config.API_URL},set baseApiUrl(t){e.config.API_URL=t},get workerCount(){return te.workerCount},set workerCount(e){te.workerCount=e},get maxParallelImageRequests(){return e.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.config.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage:function(t){e.clearTileCache(t)},workerUrl:"",workerClass:null,setNow:e.browser.setNow,restoreNow:e.browser.restoreNow};return Ni})),n}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return l})),n.d(t,"c",(function(){return s}));var r=n(6),i=n(0),a=function(){function e(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}return e.prototype.setInstantiationMode=function(e){return this.instantiationMode=e,this},e.prototype.setMultipleInstances=function(e){return this.multipleInstances=e,this},e.prototype.setServiceProps=function(e){return this.serviceProps=e,this},e}(),o="[DEFAULT]",s=function(){function e(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map}return e.prototype.get=function(e){void 0===e&&(e=o);var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var n=new i.a;this.instancesDeferred.set(t,n);try{var r=this.getOrInitializeService(t);r&&n.resolve(r)}catch(a){}}return this.instancesDeferred.get(t).promise},e.prototype.getImmediate=function(e){var t=Object(r.a)({identifier:o,optional:!1},e),n=t.identifier,i=t.optional,a=this.normalizeInstanceIdentifier(n);try{var s=this.getOrInitializeService(a);if(!s){if(i)return null;throw Error("Service "+this.name+" is not available")}return s}catch(l){if(i)return null;throw l}},e.prototype.getComponent=function(){return this.component},e.prototype.setComponent=function(e){var t,n;if(e.name!==this.name)throw Error("Mismatching Component "+e.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=e,function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService(o)}catch(f){}try{for(var i=Object(r.g)(this.instancesDeferred.entries()),a=i.next();!a.done;a=i.next()){var s=Object(r.e)(a.value,2),l=s[0],u=s[1],c=this.normalizeInstanceIdentifier(l);try{var h=this.getOrInitializeService(c);u.resolve(h)}catch(f){}}}catch(d){t={error:d}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.clearInstance=function(e){void 0===e&&(e=o),this.instancesDeferred.delete(e),this.instances.delete(e)},e.prototype.delete=function(){return Object(r.b)(this,void 0,void 0,(function(){var e;return Object(r.d)(this,(function(t){switch(t.label){case 0:return e=Array.from(this.instances.values()),[4,Promise.all(Object(r.f)(e.filter((function(e){return"INTERNAL"in e})).map((function(e){return e.INTERNAL.delete()})),e.filter((function(e){return"_delete"in e})).map((function(e){return e._delete()}))))];case 1:return t.sent(),[2]}}))}))},e.prototype.isComponentSet=function(){return null!=this.component},e.prototype.getOrInitializeService=function(e){var t=this.instances.get(e);return!t&&this.component&&(t=this.component.instanceFactory(this.container,function(e){return e===o?void 0:e}(e)),this.instances.set(e,t)),t||null},e.prototype.normalizeInstanceIdentifier=function(e){return this.component?this.component.multipleInstances?e:o:e},e}();var l=function(){function e(e){this.name=e,this.providers=new Map}return e.prototype.addComponent=function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component "+e.name+" has already been registered with "+this.name);t.setComponent(e)},e.prototype.addOrOverwriteComponent=function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)},e.prototype.getProvider=function(e){if(this.providers.has(e))return this.providers.get(e);var t=new s(e,this);return this.providers.set(e,t),t},e.prototype.getProviders=function(){return Array.from(this.providers.values())},e}()},function(e,t,n){e.exports=n(68)},function(e,t,n){"use strict";function r(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,i++)r[i]=a[o];return r}var i;n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return h})),n.d(t,"c",(function(){return f})),n.d(t,"d",(function(){return d}));var a,o=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(a||(a={}));var s={debug:a.DEBUG,verbose:a.VERBOSE,info:a.INFO,warn:a.WARN,error:a.ERROR,silent:a.SILENT},l=a.INFO,u=((i={})[a.DEBUG]="log",i[a.VERBOSE]="log",i[a.INFO]="info",i[a.WARN]="warn",i[a.ERROR]="error",i),c=function(e,t){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!(t<e.logLevel)){var a=(new Date).toISOString(),o=u[t];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+t+")");console[o].apply(console,r(["["+a+"]  "+e.name+":"],n))}},h=function(){function e(e){this.name=e,this._logLevel=l,this._logHandler=c,this._userLogHandler=null,o.push(this)}return Object.defineProperty(e.prototype,"logLevel",{get:function(){return this._logLevel},set:function(e){if(!(e in a))throw new TypeError('Invalid value "'+e+'" assigned to `logLevel`');this._logLevel=e},enumerable:!1,configurable:!0}),e.prototype.setLogLevel=function(e){this._logLevel="string"===typeof e?s[e]:e},Object.defineProperty(e.prototype,"logHandler",{get:function(){return this._logHandler},set:function(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e},enumerable:!1,configurable:!0}),e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,a.DEBUG],e)),this._logHandler.apply(this,r([this,a.DEBUG],e))},e.prototype.log=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,a.VERBOSE],e)),this._logHandler.apply(this,r([this,a.VERBOSE],e))},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,a.INFO],e)),this._logHandler.apply(this,r([this,a.INFO],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,a.WARN],e)),this._logHandler.apply(this,r([this,a.WARN],e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._userLogHandler&&this._userLogHandler.apply(this,r([this,a.ERROR],e)),this._logHandler.apply(this,r([this,a.ERROR],e))},e}();function f(e){o.forEach((function(t){t.setLogLevel(e)}))}function d(e,t){for(var n=function(n){var r=null;t&&t.level&&(r=s[t.level]),n.userLogHandler=null===e?null:function(t,n){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var s=i.map((function(e){if(null==e)return null;if("string"===typeof e)return e;if("number"===typeof e||"boolean"===typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(t){return null}})).filter((function(e){return e})).join(" ");n>=(null!==r&&void 0!==r?r:t.logLevel)&&e({level:a[n].toLowerCase(),message:s,args:i,type:t.name})}},r=0,i=o;r<i.length;r++){n(i[r])}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(35);function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(l){i=!0,a=l}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}}(e,t)||Object(r.a)(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(64)},function(e,t,n){"use strict";function r(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(29);var i=n(53),a=n(33);function o(e){return function(e){if(Array.isArray(e))return Object(r.a)(e)}(e)||Object(i.a)(e)||Object(a.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},function(e,t,n){"use strict";var r=n(7);n.d(t,"a",(function(){return r.a}));r.a.registerVersion("firebase","8.2.5","app")},function(e,t,n){"use strict";function r(e){return(r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e,t,n,r,i,a,o){try{var s=e[a](o),l=s.value}catch(u){return void n(u)}s.done?t(l):Promise.resolve(l).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){r(o,i,a,s,l,"next",e)}function l(e){r(o,i,a,s,l,"throw",e)}s(void 0)}))}}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";function r(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,"a",(function(){return r}))},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var r=n(47);e.exports=function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(2),i=function(){function e(e){r.D.call(this,e),this.dracoLoader=null,this.ddsLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register((function(e){return new s(e)})),this.register((function(e){return new u(e)})),this.register((function(e){return new c(e)})),this.register((function(e){return new l(e)})),this.register((function(e){return new a(e)})),this.register((function(e){return new h(e)}))}function t(){var e={};return{get:function(t){return e[t]},add:function(t,n){e[t]=n},remove:function(t){delete e[t]},removeAll:function(){e={}}}}e.prototype=Object.assign(Object.create(r.D.prototype),{constructor:e,load:function(e,t,n,i){var a,o=this;a=""!==this.resourcePath?this.resourcePath:""!==this.path?this.path:r.E.extractUrlBase(e),this.manager.itemStart(e);var s=function(t){i?i(t):console.error(t),o.manager.itemError(e),o.manager.itemEnd(e)},l=new r.n(this.manager);l.setPath(this.path),l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,(function(n){try{o.parse(n,a,(function(n){t(n),o.manager.itemEnd(e)}),s)}catch(r){s(r)}}),n,s)},setDRACOLoader:function(e){return this.dracoLoader=e,this},setDDSLoader:function(e){return this.ddsLoader=e,this},setKTX2Loader:function(e){return this.ktx2Loader=e,this},setMeshoptDecoder:function(e){return this.meshoptDecoder=e,this},register:function(e){return-1===this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.push(e),this},unregister:function(e){return-1!==this.pluginCallbacks.indexOf(e)&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this},parse:function(e,t,a,s){var l,u={},c={};if("string"===typeof e)l=e;else if(r.E.decodeText(new Uint8Array(e,0,4))===f){try{u[n.KHR_BINARY_GLTF]=new m(e)}catch(E){return void(s&&s(E))}l=u[n.KHR_BINARY_GLTF].content}else l=r.E.decodeText(new Uint8Array(e));var h=JSON.parse(l);if(void 0===h.asset||h.asset.version[0]<2)s&&s(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));else{var d=new W(h,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});d.fileLoader.setRequestHeader(this.requestHeader);for(var p=0;p<this.pluginCallbacks.length;p++){var g=this.pluginCallbacks[p](d);c[g.name]=g,u[g.name]=!0}if(h.extensionsUsed)for(p=0;p<h.extensionsUsed.length;++p){var x=h.extensionsUsed[p],w=h.extensionsRequired||[];switch(x){case n.KHR_MATERIALS_UNLIT:u[x]=new o;break;case n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:u[x]=new _;break;case n.KHR_DRACO_MESH_COMPRESSION:u[x]=new v(h,this.dracoLoader);break;case n.MSFT_TEXTURE_DDS:u[x]=new i(this.ddsLoader);break;case n.KHR_TEXTURE_TRANSFORM:u[x]=new y;break;case n.KHR_MESH_QUANTIZATION:u[x]=new b;break;default:w.indexOf(x)>=0&&void 0===c[x]&&console.warn('THREE.GLTFLoader: Unknown extension "'+x+'".')}}d.setExtensions(u),d.setPlugins(c),d.parse(a,s)}}});var n={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",MSFT_TEXTURE_DDS:"MSFT_texture_dds"};function i(e){if(!e)throw new Error("THREE.GLTFLoader: Attempting to load .dds texture without importing DDSLoader");this.name=n.MSFT_TEXTURE_DDS,this.ddsLoader=e}function a(e){this.parser=e,this.name=n.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}function o(){this.name=n.KHR_MATERIALS_UNLIT}function s(e){this.parser=e,this.name=n.KHR_MATERIALS_CLEARCOAT}function l(e){this.parser=e,this.name=n.KHR_MATERIALS_TRANSMISSION}function u(e){this.parser=e,this.name=n.KHR_TEXTURE_BASISU}function c(e){this.parser=e,this.name=n.EXT_TEXTURE_WEBP,this.isSupported=null}function h(e){this.name=n.EXT_MESHOPT_COMPRESSION,this.parser=e}a.prototype._markDefs=function(){for(var e=this.parser,t=this.parser.json.nodes||[],n=0,r=t.length;n<r;n++){var i=t[n];i.extensions&&i.extensions[this.name]&&void 0!==i.extensions[this.name].light&&e._addNodeRef(this.cache,i.extensions[this.name].light)}},a.prototype._loadLight=function(e){var t=this.parser,n="light:"+e,i=t.cache.get(n);if(i)return i;var a,o=t.json,s=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e],l=new r.k(16777215);void 0!==s.color&&l.fromArray(s.color);var u=void 0!==s.range?s.range:0;switch(s.type){case"directional":(a=new r.l(l)).target.position.set(0,0,-1),a.add(a.target);break;case"point":(a=new r.U(l)).distance=u;break;case"spot":(a=new r.fb(l)).distance=u,s.spot=s.spot||{},s.spot.innerConeAngle=void 0!==s.spot.innerConeAngle?s.spot.innerConeAngle:0,s.spot.outerConeAngle=void 0!==s.spot.outerConeAngle?s.spot.outerConeAngle:Math.PI/4,a.angle=s.spot.outerConeAngle,a.penumbra=1-s.spot.innerConeAngle/s.spot.outerConeAngle,a.target.position.set(0,0,-1),a.add(a.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+s.type)}return a.position.set(0,0,0),a.decay=2,void 0!==s.intensity&&(a.intensity=s.intensity),a.name=t.createUniqueName(s.name||"light_"+e),i=Promise.resolve(a),t.cache.add(n,i),i},a.prototype.createNodeAttachment=function(e){var t=this,n=this.parser,r=n.json.nodes[e],i=(r.extensions&&r.extensions[this.name]||{}).light;return void 0===i?null:this._loadLight(i).then((function(e){return n._getNodeRef(t.cache,i,e)}))},o.prototype.getMaterialType=function(){return r.J},o.prototype.extendParams=function(e,t,n){var i=[];e.color=new r.k(1,1,1),e.opacity=1;var a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){var o=a.baseColorFactor;e.color.fromArray(o),e.opacity=o[3]}void 0!==a.baseColorTexture&&i.push(n.assignTexture(e,"map",a.baseColorTexture))}return Promise.all(i)},s.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?r.K:null},s.prototype.extendMaterialParams=function(e,t){var n=this.parser,i=n.json.materials[e];if(!i.extensions||!i.extensions[this.name])return Promise.resolve();var a=[],o=i.extensions[this.name];if(void 0!==o.clearcoatFactor&&(t.clearcoat=o.clearcoatFactor),void 0!==o.clearcoatTexture&&a.push(n.assignTexture(t,"clearcoatMap",o.clearcoatTexture)),void 0!==o.clearcoatRoughnessFactor&&(t.clearcoatRoughness=o.clearcoatRoughnessFactor),void 0!==o.clearcoatRoughnessTexture&&a.push(n.assignTexture(t,"clearcoatRoughnessMap",o.clearcoatRoughnessTexture)),void 0!==o.clearcoatNormalTexture&&(a.push(n.assignTexture(t,"clearcoatNormalMap",o.clearcoatNormalTexture)),void 0!==o.clearcoatNormalTexture.scale)){var s=o.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new r.kb(s,-s)}return Promise.all(a)},l.prototype.getMaterialType=function(e){var t=this.parser.json.materials[e];return t.extensions&&t.extensions[this.name]?r.K:null},l.prototype.extendMaterialParams=function(e,t){var n=this.parser,r=n.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();var i=[],a=r.extensions[this.name];return void 0!==a.transmissionFactor&&(t.transmission=a.transmissionFactor),void 0!==a.transmissionTexture&&i.push(n.assignTexture(t,"transmissionMap",a.transmissionTexture)),Promise.all(i)},u.prototype.loadTexture=function(e){var t=this.parser,n=t.json,r=n.textures[e];if(!r.extensions||!r.extensions[this.name])return null;var i=r.extensions[this.name],a=n.images[i.source],o=t.options.ktx2Loader;if(!o){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,a,o)},c.prototype.loadTexture=function(e){var t=this.name,n=this.parser,r=n.json,i=r.textures[e];if(!i.extensions||!i.extensions[t])return null;var a=i.extensions[t],o=r.images[a.source],s=o.uri?n.options.manager.getHandler(o.uri):n.textureLoader;return this.detectSupport().then((function(i){if(i)return n.loadTextureImage(e,o,s);if(r.extensionsRequired&&r.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return n.loadTexture(e)}))},c.prototype.detectSupport=function(){return this.isSupported||(this.isSupported=new Promise((function(e){var t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(1===t.height)}}))),this.isSupported},h.prototype.loadBufferView=function(e){var t=this.parser.json,n=t.bufferViews[e];if(n.extensions&&n.extensions[this.name]){var r=n.extensions[this.name],i=this.parser.getDependency("buffer",r.buffer),a=this.parser.options.meshoptDecoder;if(!a||!a.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,a.ready]).then((function(e){var t=r.byteOffset||0,n=r.byteLength||0,i=r.count,o=r.byteStride,s=new ArrayBuffer(i*o),l=new Uint8Array(e[0],t,n);return a.decodeGltfBuffer(new Uint8Array(s),i,o,l,r.mode,r.filter),s}))}return null};var f="glTF",d=1313821514,p=5130562;function m(e){this.name=n.KHR_BINARY_GLTF,this.content=null,this.body=null;var t=new DataView(e,0,12);if(this.header={magic:r.E.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==f)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");for(var i=this.header.length-12,a=new DataView(e,12),o=0;o<i;){var s=a.getUint32(o,!0);o+=4;var l=a.getUint32(o,!0);if(o+=4,l===d){var u=new Uint8Array(e,12+o,s);this.content=r.E.decodeText(u)}else if(l===p){var c=12+o;this.body=e.slice(c,c+s)}o+=s}if(null===this.content)throw new Error("THREE.GLTFLoader: JSON content not found.")}function v(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=n.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}function y(){this.name=n.KHR_TEXTURE_TRANSFORM}function g(e){r.L.call(this),this.isGLTFSpecularGlossinessMaterial=!0;var t=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),n=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),i=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),a=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),o=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.specularRoughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.specularRoughness += geometryRoughness;","material.specularRoughness = min( material.specularRoughness, 1.0 );","material.specularColor = specularFactor;"].join("\n"),s={specular:{value:(new r.k).setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=s,this.onBeforeCompile=function(e){for(var r in s)e.uniforms[r]=s[r];e.fragmentShader=e.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",n).replace("#include <roughnessmap_fragment>",i).replace("#include <metalnessmap_fragment>",a).replace("#include <lights_physical_fragment>",o)},Object.defineProperties(this,{specular:{get:function(){return s.specular.value},set:function(e){s.specular.value=e}},specularMap:{get:function(){return s.specularMap.value},set:function(e){s.specularMap.value=e,e?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return s.glossiness.value},set:function(e){s.glossiness.value=e}},glossinessMap:{get:function(){return s.glossinessMap.value},set:function(e){s.glossinessMap.value=e,e?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}function _(){return{name:n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function(){return g},extendParams:function(e,t,n){var i=t.extensions[this.name];e.color=new r.k(1,1,1),e.opacity=1;var a=[];if(Array.isArray(i.diffuseFactor)){var o=i.diffuseFactor;e.color.fromArray(o),e.opacity=o[3]}if(void 0!==i.diffuseTexture&&a.push(n.assignTexture(e,"map",i.diffuseTexture)),e.emissive=new r.k(0,0,0),e.glossiness=void 0!==i.glossinessFactor?i.glossinessFactor:1,e.specular=new r.k(1,1,1),Array.isArray(i.specularFactor)&&e.specular.fromArray(i.specularFactor),void 0!==i.specularGlossinessTexture){var s=i.specularGlossinessTexture;a.push(n.assignTexture(e,"glossinessMap",s)),a.push(n.assignTexture(e,"specularMap",s))}return Promise.all(a)},createMaterial:function(e){var t=new g(e);return t.fog=!0,t.color=e.color,t.map=void 0===e.map?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=void 0===e.aoMap?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=1,t.emissiveMap=void 0===e.emissiveMap?null:e.emissiveMap,t.bumpMap=void 0===e.bumpMap?null:e.bumpMap,t.bumpScale=1,t.normalMap=void 0===e.normalMap?null:e.normalMap,t.normalMapType=r.gb,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=void 0===e.specularMap?null:e.specularMap,t.specular=e.specular,t.glossinessMap=void 0===e.glossinessMap?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=void 0===e.envMap?null:e.envMap,t.envMapIntensity=1,t.refractionRatio=.98,t}}}function b(){this.name=n.KHR_MESH_QUANTIZATION}function x(e,t,n,i){r.t.call(this,e,t,n,i)}v.prototype.decodePrimitive=function(e,t){var n=this.json,r=this.dracoLoader,i=e.extensions[this.name].bufferView,a=e.extensions[this.name].attributes,o={},s={},l={};for(var u in a){var c=L[u]||u.toLowerCase();o[c]=a[u]}for(u in e.attributes){c=L[u]||u.toLowerCase();if(void 0!==a[u]){var h=n.accessors[e.attributes[u]],f=A[h.componentType];l[c]=f,s[c]=!0===h.normalized}}return t.getDependency("bufferView",i).then((function(e){return new Promise((function(t){r.decodeDracoFile(e,(function(e){for(var n in e.attributes){var r=e.attributes[n],i=s[n];void 0!==i&&(r.normalized=i)}t(e)}),o,l)}))}))},y.prototype.extendTexture=function(e,t){return e=e.clone(),void 0!==t.offset&&e.offset.fromArray(t.offset),void 0!==t.rotation&&(e.rotation=t.rotation),void 0!==t.scale&&e.repeat.fromArray(t.scale),void 0!==t.texCoord&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),e.needsUpdate=!0,e},g.prototype=Object.create(r.L.prototype),g.prototype.constructor=g,g.prototype.copy=function(e){return r.L.prototype.copy.call(this,e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this},x.prototype=Object.create(r.t.prototype),x.prototype.constructor=x,x.prototype.copySampleValue_=function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,i=e*r*3+r,a=0;a!==r;a++)t[a]=n[i+a];return t},x.prototype.beforeStart_=x.prototype.copySampleValue_,x.prototype.afterEnd_=x.prototype.copySampleValue_,x.prototype.interpolate_=function(e,t,n,r){for(var i=this.resultBuffer,a=this.sampleValues,o=this.valueSize,s=2*o,l=3*o,u=r-t,c=(n-t)/u,h=c*c,f=h*c,d=e*l,p=d-l,m=-2*f+3*h,v=f-h,y=1-m,g=v-h+c,_=0;_!==o;_++){var b=a[p+_+o],x=a[p+_+s]*u,w=a[d+_+o],E=a[d+_]*u;i[_]=y*b+g*x+m*w+v*E}return i};var w=0,E=1,S=2,T=3,k=4,M=5,C=6,A={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},I={9728:r.N,9729:r.A,9984:r.P,9985:r.C,9986:r.O,9987:r.B},P={33071:r.i,33648:r.M,10497:r.ab},R={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},L={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},O={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},D={CUBICSPLINE:void 0,LINEAR:r.v,STEP:r.u},N="OPAQUE",z="MASK",F="BLEND";function B(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}function U(e,t,n){for(var r in n.extensions)void 0===e[r]&&(t.userData.gltfExtensions=t.userData.gltfExtensions||{},t.userData.gltfExtensions[r]=n.extensions[r])}function j(e,t){void 0!==t.extras&&("object"===typeof t.extras?Object.assign(e.userData,t.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+t.extras))}function V(e,t){if(e.updateMorphTargets(),void 0!==t.weights)for(var n=0,r=t.weights.length;n<r;n++)e.morphTargetInfluences[n]=t.weights[n];if(t.extras&&Array.isArray(t.extras.targetNames)){var i=t.extras.targetNames;if(e.morphTargetInfluences.length===i.length){e.morphTargetDictionary={};for(n=0,r=i.length;n<r;n++)e.morphTargetDictionary[i[n]]=n}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function H(e){var t=e.extensions&&e.extensions[n.KHR_DRACO_MESH_COMPRESSION];return t?"draco:"+t.bufferView+":"+t.indices+":"+G(t.attributes):e.indices+":"+G(e.attributes)+":"+e.mode}function G(e){for(var t="",n=Object.keys(e).sort(),r=0,i=n.length;r<i;r++)t+=n[r]+":"+e[n[r]]+";";return t}function W(e,n){this.json=e||{},this.extensions={},this.plugins={},this.options=n||{},this.cache=new t,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.nodeNamesUsed={},"undefined"!==typeof createImageBitmap&&!1===/Firefox/.test(navigator.userAgent)?this.textureLoader=new r.q(this.options.manager):this.textureLoader=new r.hb(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.fileLoader=new r.n(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),"use-credentials"===this.options.crossOrigin&&this.fileLoader.setWithCredentials(!0)}function q(e,t,n){var i=t.attributes,a=[];function o(t,r){return n.getDependency("accessor",t).then((function(t){e.setAttribute(r,t)}))}for(var s in i){var l=L[s]||s.toLowerCase();l in e.attributes||a.push(o(i[s],l))}if(void 0!==t.indices&&!e.index){var u=n.getDependency("accessor",t.indices).then((function(t){e.setIndex(t)}));a.push(u)}return j(e,t),function(e,t,n){var i=t.attributes,a=new r.d;if(void 0!==i.POSITION){var o=(d=n.json.accessors[i.POSITION]).min,s=d.max;if(void 0!==o&&void 0!==s){a.set(new r.lb(o[0],o[1],o[2]),new r.lb(s[0],s[1],s[2]));var l=t.targets;if(void 0!==l){for(var u=new r.lb,c=new r.lb,h=0,f=l.length;h<f;h++){var d,p=l[h];if(void 0!==p.POSITION)o=(d=n.json.accessors[p.POSITION]).min,s=d.max,void 0!==o&&void 0!==s?(c.setX(Math.max(Math.abs(o[0]),Math.abs(s[0]))),c.setY(Math.max(Math.abs(o[1]),Math.abs(s[1]))),c.setZ(Math.max(Math.abs(o[2]),Math.abs(s[2]))),u.max(c)):console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}a.expandByVector(u)}e.boundingBox=a;var m=new r.eb;a.getCenter(m.center),m.radius=a.min.distanceTo(a.max)/2,e.boundingSphere=m}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}(e,t,n),Promise.all(a).then((function(){return void 0!==t.targets?function(e,t,n){for(var r=!1,i=!1,a=0,o=t.length;a<o&&(void 0!==(u=t[a]).POSITION&&(r=!0),void 0!==u.NORMAL&&(i=!0),!r||!i);a++);if(!r&&!i)return Promise.resolve(e);var s=[],l=[];for(a=0,o=t.length;a<o;a++){var u=t[a];if(r){var c=void 0!==u.POSITION?n.getDependency("accessor",u.POSITION):e.attributes.position;s.push(c)}i&&(c=void 0!==u.NORMAL?n.getDependency("accessor",u.NORMAL):e.attributes.normal,l.push(c))}return Promise.all([Promise.all(s),Promise.all(l)]).then((function(t){var n=t[0],a=t[1];return r&&(e.morphAttributes.position=n),i&&(e.morphAttributes.normal=a),e.morphTargetsRelative=!0,e}))}(e,t.targets,n):e}))}function X(e,t){var n=e.getIndex();if(null===n){var i=[],a=e.getAttribute("position");if(void 0===a)return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),e;for(var o=0;o<a.count;o++)i.push(o);e.setIndex(i),n=e.getIndex()}var s=n.count-2,l=[];if(t===r.ib)for(o=1;o<=s;o++)l.push(n.getX(0)),l.push(n.getX(o)),l.push(n.getX(o+1));else for(o=0;o<s;o++)o%2===0?(l.push(n.getX(o)),l.push(n.getX(o+1)),l.push(n.getX(o+2))):(l.push(n.getX(o+2)),l.push(n.getX(o+1)),l.push(n.getX(o)));l.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");var u=e.clone();return u.setIndex(l),u}return W.prototype.setExtensions=function(e){this.extensions=e},W.prototype.setPlugins=function(e){this.plugins=e},W.prototype.parse=function(e,t){var n=this,r=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll((function(e){return e._markDefs&&e._markDefs()})),Promise.all([this.getDependencies("scene"),this.getDependencies("animation"),this.getDependencies("camera")]).then((function(t){var a={scene:t[0][r.scene||0],scenes:t[0],animations:t[1],cameras:t[2],asset:r.asset,parser:n,userData:{}};U(i,a,r),j(a,r),e(a)})).catch(t)},W.prototype._markDefs=function(){for(var e=this.json.nodes||[],t=this.json.skins||[],n=this.json.meshes||[],r=0,i=t.length;r<i;r++)for(var a=t[r].joints,o=0,s=a.length;o<s;o++)e[a[o]].isBone=!0;for(var l=0,u=e.length;l<u;l++){var c=e[l];void 0!==c.mesh&&(this._addNodeRef(this.meshCache,c.mesh),void 0!==c.skin&&(n[c.mesh].isSkinnedMesh=!0)),void 0!==c.camera&&this._addNodeRef(this.cameraCache,c.camera)}},W.prototype._addNodeRef=function(e,t){void 0!==t&&(void 0===e.refs[t]&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)},W.prototype._getNodeRef=function(e,t,n){if(e.refs[t]<=1)return n;var r=n.clone();return r.name+="_instance_"+e.uses[t]++,r},W.prototype._invokeOne=function(e){var t=Object.values(this.plugins);t.push(this);for(var n=0;n<t.length;n++){var r=e(t[n]);if(r)return r}},W.prototype._invokeAll=function(e){var t=Object.values(this.plugins);t.unshift(this);for(var n=[],r=0;r<t.length;r++){var i=e(t[r]);i&&n.push(i)}return n},W.prototype.getDependency=function(e,t){var n=e+":"+t,r=this.cache.get(n);if(!r){switch(e){case"scene":r=this.loadScene(t);break;case"node":r=this.loadNode(t);break;case"mesh":r=this._invokeOne((function(e){return e.loadMesh&&e.loadMesh(t)}));break;case"accessor":r=this.loadAccessor(t);break;case"bufferView":r=this._invokeOne((function(e){return e.loadBufferView&&e.loadBufferView(t)}));break;case"buffer":r=this.loadBuffer(t);break;case"material":r=this._invokeOne((function(e){return e.loadMaterial&&e.loadMaterial(t)}));break;case"texture":r=this._invokeOne((function(e){return e.loadTexture&&e.loadTexture(t)}));break;case"skin":r=this.loadSkin(t);break;case"animation":r=this.loadAnimation(t);break;case"camera":r=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(n,r)}return r},W.prototype.getDependencies=function(e){var t=this.cache.get(e);if(!t){var n=this,r=this.json[e+("mesh"===e?"es":"s")]||[];t=Promise.all(r.map((function(t,r){return n.getDependency(e,r)}))),this.cache.add(e,t)}return t},W.prototype.loadBuffer=function(e){var t=this.json.buffers[e],r=this.fileLoader;if(t.type&&"arraybuffer"!==t.type)throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(void 0===t.uri&&0===e)return Promise.resolve(this.extensions[n.KHR_BINARY_GLTF].body);var i=this.options;return new Promise((function(e,n){r.load(B(t.uri,i.path),e,void 0,(function(){n(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))}))}))},W.prototype.loadBufferView=function(e){var t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then((function(e){var n=t.byteLength||0,r=t.byteOffset||0;return e.slice(r,r+n)}))},W.prototype.loadAccessor=function(e){var t=this,n=this.json,i=this.json.accessors[e];if(void 0===i.bufferView&&void 0===i.sparse)return Promise.resolve(null);var a=[];return void 0!==i.bufferView?a.push(this.getDependency("bufferView",i.bufferView)):a.push(null),void 0!==i.sparse&&(a.push(this.getDependency("bufferView",i.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",i.sparse.values.bufferView))),Promise.all(a).then((function(e){var a,o,s=e[0],l=R[i.type],u=A[i.componentType],c=u.BYTES_PER_ELEMENT,h=c*l,f=i.byteOffset||0,d=void 0!==i.bufferView?n.bufferViews[i.bufferView].byteStride:void 0,p=!0===i.normalized;if(d&&d!==h){var m=Math.floor(f/d),v="InterleavedBuffer:"+i.bufferView+":"+i.componentType+":"+m+":"+i.count,y=t.cache.get(v);y||(a=new u(s,m*d,i.count*d/c),y=new r.r(a,d/c),t.cache.add(v,y)),o=new r.s(y,l,f%d/c,p)}else a=null===s?new u(i.count*l):new u(s,f,i.count*l),o=new r.e(a,l,p);if(void 0!==i.sparse){var g=R.SCALAR,_=A[i.sparse.indices.componentType],b=i.sparse.indices.byteOffset||0,x=i.sparse.values.byteOffset||0,w=new _(e[1],b,i.sparse.count*g),E=new u(e[2],x,i.sparse.count*l);null!==s&&(o=new r.e(o.array.slice(),o.itemSize,o.normalized));for(var S=0,T=w.length;S<T;S++){var k=w[S];if(o.setX(k,E[S*l]),l>=2&&o.setY(k,E[S*l+1]),l>=3&&o.setZ(k,E[S*l+2]),l>=4&&o.setW(k,E[S*l+3]),l>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return o}))},W.prototype.loadTexture=function(e){var t,r,i=this.json,a=this.options,o=i.textures[e],s=o.extensions||{};return(t=s[n.MSFT_TEXTURE_DDS]?i.images[s[n.MSFT_TEXTURE_DDS].source]:i.images[o.source]).uri&&(r=a.manager.getHandler(t.uri)),r||(r=s[n.MSFT_TEXTURE_DDS]?this.extensions[n.MSFT_TEXTURE_DDS].ddsLoader:this.textureLoader),this.loadTextureImage(e,t,r)},W.prototype.loadTextureImage=function(e,t,n){var i=this,a=this.json,o=this.options,s=a.textures[e],l=self.URL||self.webkitURL,u=t.uri,c=!1,h=!0;return"image/jpeg"===t.mimeType&&(h=!1),void 0!==t.bufferView&&(u=i.getDependency("bufferView",t.bufferView).then((function(e){if("image/png"===t.mimeType){var n=new DataView(e,25,1).getUint8(0,!1);h=6===n||4===n||3===n}c=!0;var r=new Blob([e],{type:t.mimeType});return u=l.createObjectURL(r)}))),Promise.resolve(u).then((function(e){return new Promise((function(t,i){var a=t;!0===n.isImageBitmapLoader&&(a=function(e){t(new r.h(e))}),n.load(B(e,o.path),a,void 0,i)}))})).then((function(t){!0===c&&l.revokeObjectURL(u),t.flipY=!1,s.name&&(t.name=s.name),h||(t.format=r.Z);var n=(a.samplers||{})[s.sampler]||{};return t.magFilter=I[n.magFilter]||r.A,t.minFilter=I[n.minFilter]||r.B,t.wrapS=P[n.wrapS]||r.ab,t.wrapT=P[n.wrapT]||r.ab,i.associations.set(t,{type:"textures",index:e}),t}))},W.prototype.assignTexture=function(e,t,r){var i=this;return this.getDependency("texture",r.index).then((function(a){if(void 0===r.texCoord||0==r.texCoord||"aoMap"===t&&1==r.texCoord||console.warn("THREE.GLTFLoader: Custom UV set "+r.texCoord+" for texture "+t+" not yet supported."),i.extensions[n.KHR_TEXTURE_TRANSFORM]){var o=void 0!==r.extensions?r.extensions[n.KHR_TEXTURE_TRANSFORM]:void 0;if(o){var s=i.associations.get(a);a=i.extensions[n.KHR_TEXTURE_TRANSFORM].extendTexture(a,o),i.associations.set(a,s)}}e[t]=a}))},W.prototype.assignFinalMaterial=function(e){var t=e.geometry,n=e.material,i=void 0!==t.attributes.tangent,a=void 0!==t.attributes.color,o=void 0===t.attributes.normal,s=!0===e.isSkinnedMesh,l=Object.keys(t.morphAttributes).length>0,u=l&&void 0!==t.morphAttributes.normal;if(e.isPoints){var c="PointsMaterial:"+n.uuid,h=this.cache.get(c);h||(h=new r.W,r.F.prototype.copy.call(h,n),h.color.copy(n.color),h.map=n.map,h.sizeAttenuation=!1,this.cache.add(c,h)),n=h}else if(e.isLine){c="LineBasicMaterial:"+n.uuid;var f=this.cache.get(c);f||(f=new r.x,r.F.prototype.copy.call(f,n),f.color.copy(n.color),this.cache.add(c,f)),n=f}if(i||a||o||s||l){c="ClonedMaterial:"+n.uuid+":";n.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),s&&(c+="skinning:"),i&&(c+="vertex-tangents:"),a&&(c+="vertex-colors:"),o&&(c+="flat-shading:"),l&&(c+="morph-targets:"),u&&(c+="morph-normals:");var d=this.cache.get(c);d||(d=n.clone(),s&&(d.skinning=!0),a&&(d.vertexColors=!0),o&&(d.flatShading=!0),l&&(d.morphTargets=!0),u&&(d.morphNormals=!0),i&&(d.vertexTangents=!0,d.normalScale&&(d.normalScale.y*=-1),d.clearcoatNormalScale&&(d.clearcoatNormalScale.y*=-1)),this.cache.add(c,d),this.associations.set(d,this.associations.get(n))),n=d}n.aoMap&&void 0===t.attributes.uv2&&void 0!==t.attributes.uv&&t.setAttribute("uv2",t.attributes.uv),e.material=n},W.prototype.getMaterialType=function(){return r.L},W.prototype.loadMaterial=function(e){var t,i=this,a=this.json,o=this.extensions,s=a.materials[e],l={},u=s.extensions||{},c=[];if(u[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var h=o[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];t=h.getMaterialType(),c.push(h.extendParams(l,s,i))}else if(u[n.KHR_MATERIALS_UNLIT]){var f=o[n.KHR_MATERIALS_UNLIT];t=f.getMaterialType(),c.push(f.extendParams(l,s,i))}else{var d=s.pbrMetallicRoughness||{};if(l.color=new r.k(1,1,1),l.opacity=1,Array.isArray(d.baseColorFactor)){var p=d.baseColorFactor;l.color.fromArray(p),l.opacity=p[3]}void 0!==d.baseColorTexture&&c.push(i.assignTexture(l,"map",d.baseColorTexture)),l.metalness=void 0!==d.metallicFactor?d.metallicFactor:1,l.roughness=void 0!==d.roughnessFactor?d.roughnessFactor:1,void 0!==d.metallicRoughnessTexture&&(c.push(i.assignTexture(l,"metalnessMap",d.metallicRoughnessTexture)),c.push(i.assignTexture(l,"roughnessMap",d.metallicRoughnessTexture))),t=this._invokeOne((function(t){return t.getMaterialType&&t.getMaterialType(e)})),c.push(Promise.all(this._invokeAll((function(t){return t.extendMaterialParams&&t.extendMaterialParams(e,l)}))))}!0===s.doubleSided&&(l.side=r.m);var m=s.alphaMode||N;return m===F?(l.transparent=!0,l.depthWrite=!1):(l.transparent=!1,m===z&&(l.alphaTest=void 0!==s.alphaCutoff?s.alphaCutoff:.5)),void 0!==s.normalTexture&&t!==r.J&&(c.push(i.assignTexture(l,"normalMap",s.normalTexture)),l.normalScale=new r.kb(1,-1),void 0!==s.normalTexture.scale&&l.normalScale.set(s.normalTexture.scale,-s.normalTexture.scale)),void 0!==s.occlusionTexture&&t!==r.J&&(c.push(i.assignTexture(l,"aoMap",s.occlusionTexture)),void 0!==s.occlusionTexture.strength&&(l.aoMapIntensity=s.occlusionTexture.strength)),void 0!==s.emissiveFactor&&t!==r.J&&(l.emissive=(new r.k).fromArray(s.emissiveFactor)),void 0!==s.emissiveTexture&&t!==r.J&&c.push(i.assignTexture(l,"emissiveMap",s.emissiveTexture)),Promise.all(c).then((function(){var a;return a=t===g?o[n.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(l):new t(l),s.name&&(a.name=s.name),a.map&&(a.map.encoding=r.ob),a.emissiveMap&&(a.emissiveMap.encoding=r.ob),j(a,s),i.associations.set(a,{type:"materials",index:e}),s.extensions&&U(o,a,s),a}))},W.prototype.createUniqueName=function(e){for(var t=r.X.sanitizeNodeName(e||""),n=t,i=1;this.nodeNamesUsed[n];++i)n=t+"_"+i;return this.nodeNamesUsed[n]=!0,n},W.prototype.loadGeometries=function(e){var t=this,i=this.extensions,a=this.primitiveCache;function o(e){return i[n.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(e,t).then((function(n){return q(n,e,t)}))}for(var s=[],l=0,u=e.length;l<u;l++){var c,h=e[l],f=H(h),d=a[f];if(d)s.push(d.promise);else c=h.extensions&&h.extensions[n.KHR_DRACO_MESH_COMPRESSION]?o(h):q(new r.f,h,t),a[f]={primitive:h,promise:c},s.push(c)}return Promise.all(s)},W.prototype.loadMesh=function(e){for(var t,n=this,i=this.json,a=this.extensions,o=i.meshes[e],s=o.primitives,l=[],u=0,c=s.length;u<c;u++){var h=void 0===s[u].material?(void 0===(t=this.cache).DefaultMaterial&&(t.DefaultMaterial=new r.L({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:r.o})),t.DefaultMaterial):this.getDependency("material",s[u].material);l.push(h)}return l.push(n.loadGeometries(s)),Promise.all(l).then((function(t){for(var i=t.slice(0,t.length-1),l=t[t.length-1],u=[],c=0,h=l.length;c<h;c++){var f,d=l[c],p=s[c],m=i[c];if(p.mode===k||p.mode===M||p.mode===C||void 0===p.mode)f=!0===o.isSkinnedMesh?new r.db(d,m):new r.I(d,m),!0===m.isMeshStandardMaterial&&m.side===r.m&&null!==d.getIndex()&&!0===d.hasAttribute("position")&&!0===d.hasAttribute("normal")&&!0===d.hasAttribute("uv")&&!1===d.hasAttribute("tangent")&&(d.computeTangents(),m.vertexTangents=!0),!0!==f.isSkinnedMesh||f.geometry.attributes.skinWeight.normalized||f.normalizeSkinWeights(),p.mode===M?f.geometry=X(f.geometry,r.jb):p.mode===C&&(f.geometry=X(f.geometry,r.ib));else if(p.mode===E)f=new r.z(d,m);else if(p.mode===T)f=new r.w(d,m);else if(p.mode===S)f=new r.y(d,m);else{if(p.mode!==w)throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);f=new r.V(d,m)}Object.keys(f.geometry.morphAttributes).length>0&&V(f,o),f.name=n.createUniqueName(o.name||"mesh_"+e),j(f,o),p.extensions&&U(a,f,p),n.assignFinalMaterial(f),u.push(f)}if(1===u.length)return u[0];var v=new r.p;for(c=0,h=u.length;c<h;c++)v.add(u[c]);return v}))},W.prototype.loadCamera=function(e){var t,n=this.json.cameras[e],i=n[n.type];if(i)return"perspective"===n.type?t=new r.T(r.G.radToDeg(i.yfov),i.aspectRatio||1,i.znear||1,i.zfar||2e6):"orthographic"===n.type&&(t=new r.S(-i.xmag,i.xmag,i.ymag,-i.ymag,i.znear,i.zfar)),n.name&&(t.name=this.createUniqueName(n.name)),j(t,n),Promise.resolve(t);console.warn("THREE.GLTFLoader: Missing camera parameters.")},W.prototype.loadSkin=function(e){var t=this.json.skins[e],n={joints:t.joints};return void 0===t.inverseBindMatrices?Promise.resolve(n):this.getDependency("accessor",t.inverseBindMatrices).then((function(e){return n.inverseBindMatrices=e,n}))},W.prototype.loadAnimation=function(e){for(var t=this.json.animations[e],n=[],i=[],a=[],o=[],s=[],l=0,u=t.channels.length;l<u;l++){var c=t.channels[l],h=t.samplers[c.sampler],f=c.target,d=void 0!==f.node?f.node:f.id,p=void 0!==t.parameters?t.parameters[h.input]:h.input,m=void 0!==t.parameters?t.parameters[h.output]:h.output;n.push(this.getDependency("node",d)),i.push(this.getDependency("accessor",p)),a.push(this.getDependency("accessor",m)),o.push(h),s.push(f)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(a),Promise.all(o),Promise.all(s)]).then((function(n){for(var i=n[0],a=n[1],o=n[2],s=n[3],l=n[4],u=[],c=0,h=i.length;c<h;c++){var f=i[c],d=a[c],p=o[c],m=s[c],v=l[c];if(void 0!==f){var y;switch(f.updateMatrix(),f.matrixAutoUpdate=!0,O[v.path]){case O.weights:y=r.Q;break;case O.rotation:y=r.Y;break;case O.position:case O.scale:default:y=r.mb}var g=f.name?f.name:f.uuid,_=void 0!==m.interpolation?D[m.interpolation]:r.v,b=[];O[v.path]===O.weights?f.traverse((function(e){!0===e.isMesh&&e.morphTargetInfluences&&b.push(e.name?e.name:e.uuid)})):b.push(g);var w=p.array;if(p.normalized){var E;if(w.constructor===Int8Array)E=1/127;else if(w.constructor===Uint8Array)E=1/255;else if(w.constructor==Int16Array)E=1/32767;else{if(w.constructor!==Uint16Array)throw new Error("THREE.GLTFLoader: Unsupported output accessor component type.");E=1/65535}for(var S=new Float32Array(w.length),T=0,k=w.length;T<k;T++)S[T]=w[T]*E;w=S}for(T=0,k=b.length;T<k;T++){var M=new y(b[T]+"."+O[v.path],d.array,w,_);"CUBICSPLINE"===m.interpolation&&(M.createInterpolant=function(e){return new x(this.times,this.values,this.getValueSize()/3,e)},M.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),u.push(M)}}}var C=t.name?t.name:"animation_"+e;return new r.a(C,void 0,u)}))},W.prototype.loadNode=function(e){var t=this.json,n=this.extensions,i=this,a=t.nodes[e],o=a.name?i.createUniqueName(a.name):"";return function(){var t=[];return void 0!==a.mesh&&t.push(i.getDependency("mesh",a.mesh).then((function(e){var t=i._getNodeRef(i.meshCache,a.mesh,e);return void 0!==a.weights&&t.traverse((function(e){if(e.isMesh)for(var t=0,n=a.weights.length;t<n;t++)e.morphTargetInfluences[t]=a.weights[t]})),t}))),void 0!==a.camera&&t.push(i.getDependency("camera",a.camera).then((function(e){return i._getNodeRef(i.cameraCache,a.camera,e)}))),i._invokeAll((function(t){return t.createNodeAttachment&&t.createNodeAttachment(e)})).forEach((function(e){t.push(e)})),Promise.all(t)}().then((function(t){var s;if((s=!0===a.isBone?new r.c:t.length>1?new r.p:1===t.length?t[0]:new r.R)!==t[0])for(var l=0,u=t.length;l<u;l++)s.add(t[l]);if(a.name&&(s.userData.name=a.name,s.name=o),j(s,a),a.extensions&&U(n,s,a),void 0!==a.matrix){var c=new r.H;c.fromArray(a.matrix),s.applyMatrix4(c)}else void 0!==a.translation&&s.position.fromArray(a.translation),void 0!==a.rotation&&s.quaternion.fromArray(a.rotation),void 0!==a.scale&&s.scale.fromArray(a.scale);return i.associations.set(s,{type:"nodes",index:e}),s}))},W.prototype.loadScene=function(){function e(t,n,i,a){var o=i.nodes[t];return a.getDependency("node",t).then((function(e){return void 0===o.skin?e:a.getDependency("skin",o.skin).then((function(e){for(var n=[],r=0,i=(t=e).joints.length;r<i;r++)n.push(a.getDependency("node",t.joints[r]));return Promise.all(n)})).then((function(n){return e.traverse((function(e){if(e.isMesh){for(var i=[],a=[],o=0,s=n.length;o<s;o++){var l=n[o];if(l){i.push(l);var u=new r.H;void 0!==t.inverseBindMatrices&&u.fromArray(t.inverseBindMatrices.array,16*o),a.push(u)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[o])}e.bind(new r.cb(i,a),e.matrixWorld)}})),e}));var t})).then((function(t){n.add(t);var r=[];if(o.children)for(var s=o.children,l=0,u=s.length;l<u;l++){var c=s[l];r.push(e(c,t,i,a))}return Promise.all(r)}))}return function(t){var n=this.json,i=this.extensions,a=this.json.scenes[t],o=new r.p;a.name&&(o.name=this.createUniqueName(a.name)),j(o,a),a.extensions&&U(i,o,a);for(var s=a.nodes||[],l=[],u=0,c=s.length;u<c;u++)l.push(e(s[u],o,n,this));return Promise.all(l).then((function(){return o}))}}(),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(29);function i(e,t){if(e){if("string"===typeof e)return Object(r.a)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Object(r.a)(e,t):void 0}}},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=n(8),a=n(118),o=n(3),s=["xs","sm","md","lg","xl"];function l(e){var t=e.values,n=void 0===t?{xs:0,sm:600,md:960,lg:1280,xl:1920}:t,r=e.unit,a=void 0===r?"px":r,l=e.step,u=void 0===l?5:l,c=Object(i.a)(e,["values","unit","step"]);function h(e){var t="number"===typeof n[e]?n[e]:e;return"@media (min-width:".concat(t).concat(a,")")}function f(e,t){var r=s.indexOf(t);return r===s.length-1?h(e):"@media (min-width:".concat("number"===typeof n[e]?n[e]:e).concat(a,") and ")+"(max-width:".concat((-1!==r&&"number"===typeof n[s[r+1]]?n[s[r+1]]:t)-u/100).concat(a,")")}return Object(o.a)({keys:s,values:n,up:h,down:function(e){var t=s.indexOf(e)+1,r=n[s[t]];return t===s.length?h("xs"):"@media (max-width:".concat(("number"===typeof r&&t>0?r:e)-u/100).concat(a,")")},between:f,only:function(e){return f(e,e)},width:function(e){return n[e]}},c)}function u(e,t,n){var i;return Object(o.a)({gutters:function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(o.a)({paddingLeft:t(2),paddingRight:t(2)},n,r({},e.up("sm"),Object(o.a)({paddingLeft:t(3),paddingRight:t(3)},n[e.up("sm")])))},toolbar:(i={minHeight:56},r(i,"".concat(e.up("xs")," and (orientation: landscape)"),{minHeight:48}),r(i,e.up("sm"),{minHeight:64}),i)},n)}var c=n(58),h={black:"#000",white:"#fff"},f={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#d5d5d5",A200:"#aaaaaa",A400:"#303030",A700:"#616161"},d={50:"#e8eaf6",100:"#c5cae9",200:"#9fa8da",300:"#7986cb",400:"#5c6bc0",500:"#3f51b5",600:"#3949ab",700:"#303f9f",800:"#283593",900:"#1a237e",A100:"#8c9eff",A200:"#536dfe",A400:"#3d5afe",A700:"#304ffe"},p={50:"#fce4ec",100:"#f8bbd0",200:"#f48fb1",300:"#f06292",400:"#ec407a",500:"#e91e63",600:"#d81b60",700:"#c2185b",800:"#ad1457",900:"#880e4f",A100:"#ff80ab",A200:"#ff4081",A400:"#f50057",A700:"#c51162"},m={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},v={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},y={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},g={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},_=n(11),b={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.54)",disabled:"rgba(0, 0, 0, 0.38)",hint:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:h.white,default:f[50]},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},x={text:{primary:h.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",hint:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:f[800],default:"#303030"},action:{active:h.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function w(e,t,n,r){var i=r.light||r,a=r.dark||1.5*r;e[t]||(e.hasOwnProperty(n)?e[t]=e[n]:"light"===t?e.light=Object(_.d)(e.main,i):"dark"===t&&(e.dark=Object(_.a)(e.main,a)))}function E(e){var t=e.primary,n=void 0===t?{light:d[300],main:d[500],dark:d[700]}:t,r=e.secondary,s=void 0===r?{light:p.A200,main:p.A400,dark:p.A700}:r,l=e.error,u=void 0===l?{light:m[300],main:m[500],dark:m[700]}:l,E=e.warning,S=void 0===E?{light:v[300],main:v[500],dark:v[700]}:E,T=e.info,k=void 0===T?{light:y[300],main:y[500],dark:y[700]}:T,M=e.success,C=void 0===M?{light:g[300],main:g[500],dark:g[700]}:M,A=e.type,I=void 0===A?"light":A,P=e.contrastThreshold,R=void 0===P?3:P,L=e.tonalOffset,O=void 0===L?.2:L,D=Object(i.a)(e,["primary","secondary","error","warning","info","success","type","contrastThreshold","tonalOffset"]);function N(e){return Object(_.c)(e,x.text.primary)>=R?x.text.primary:b.text.primary}var z=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:300,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:700;if(!(e=Object(o.a)({},e)).main&&e[t]&&(e.main=e[t]),!e.main)throw new Error(Object(c.a)(4,t));if("string"!==typeof e.main)throw new Error(Object(c.a)(5,JSON.stringify(e.main)));return w(e,"light",n,O),w(e,"dark",r,O),e.contrastText||(e.contrastText=N(e.main)),e},F={dark:x,light:b};return Object(a.a)(Object(o.a)({common:h,type:I,primary:z(n),secondary:z(s,"A400","A200","A700"),error:z(u),warning:z(S),info:z(k),success:z(C),grey:f,contrastThreshold:R,getContrastText:N,augmentColor:z,tonalOffset:O},F[I]),D)}function S(e){return Math.round(1e5*e)/1e5}var T={textTransform:"uppercase"},k='"Roboto", "Helvetica", "Arial", sans-serif';function M(e,t){var n="function"===typeof t?t(e):t,r=n.fontFamily,s=void 0===r?k:r,l=n.fontSize,u=void 0===l?14:l,c=n.fontWeightLight,h=void 0===c?300:c,f=n.fontWeightRegular,d=void 0===f?400:f,p=n.fontWeightMedium,m=void 0===p?500:p,v=n.fontWeightBold,y=void 0===v?700:v,g=n.htmlFontSize,_=void 0===g?16:g,b=n.allVariants,x=n.pxToRem,w=Object(i.a)(n,["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"]);var E=u/14,M=x||function(e){return"".concat(e/_*E,"rem")},C=function(e,t,n,r,i){return Object(o.a)({fontFamily:s,fontWeight:e,fontSize:M(t),lineHeight:n},s===k?{letterSpacing:"".concat(S(r/t),"em")}:{},i,b)},A={h1:C(h,96,1.167,-1.5),h2:C(h,60,1.2,-.5),h3:C(d,48,1.167,0),h4:C(d,34,1.235,.25),h5:C(d,24,1.334,0),h6:C(m,20,1.6,.15),subtitle1:C(d,16,1.75,.15),subtitle2:C(m,14,1.57,.1),body1:C(d,16,1.5,.15),body2:C(d,14,1.43,.15),button:C(m,14,1.75,.4,T),caption:C(d,12,1.66,.4),overline:C(d,12,2.66,1,T)};return Object(a.a)(Object(o.a)({htmlFontSize:_,pxToRem:M,round:S,fontFamily:s,fontSize:u,fontWeightLight:h,fontWeightRegular:d,fontWeightMedium:m,fontWeightBold:y},A),w,{clone:!1})}function C(){return["".concat(arguments.length<=0?void 0:arguments[0],"px ").concat(arguments.length<=1?void 0:arguments[1],"px ").concat(arguments.length<=2?void 0:arguments[2],"px ").concat(arguments.length<=3?void 0:arguments[3],"px rgba(0,0,0,").concat(.2,")"),"".concat(arguments.length<=4?void 0:arguments[4],"px ").concat(arguments.length<=5?void 0:arguments[5],"px ").concat(arguments.length<=6?void 0:arguments[6],"px ").concat(arguments.length<=7?void 0:arguments[7],"px rgba(0,0,0,").concat(.14,")"),"".concat(arguments.length<=8?void 0:arguments[8],"px ").concat(arguments.length<=9?void 0:arguments[9],"px ").concat(arguments.length<=10?void 0:arguments[10],"px ").concat(arguments.length<=11?void 0:arguments[11],"px rgba(0,0,0,").concat(.12,")")].join(",")}var A=["none",C(0,2,1,-1,0,1,1,0,0,1,3,0),C(0,3,1,-2,0,2,2,0,0,1,5,0),C(0,3,3,-2,0,3,4,0,0,1,8,0),C(0,2,4,-1,0,4,5,0,0,1,10,0),C(0,3,5,-1,0,5,8,0,0,1,14,0),C(0,3,5,-1,0,6,10,0,0,1,18,0),C(0,4,5,-2,0,7,10,1,0,2,16,1),C(0,5,5,-3,0,8,10,1,0,3,14,2),C(0,5,6,-3,0,9,12,1,0,3,16,2),C(0,6,6,-3,0,10,14,1,0,4,18,3),C(0,6,7,-4,0,11,15,1,0,4,20,3),C(0,7,8,-4,0,12,17,2,0,5,22,4),C(0,7,8,-4,0,13,19,2,0,5,24,4),C(0,7,9,-4,0,14,21,2,0,5,26,4),C(0,8,9,-5,0,15,22,2,0,6,28,5),C(0,8,10,-5,0,16,24,2,0,6,30,5),C(0,8,11,-5,0,17,26,2,0,6,32,5),C(0,9,11,-5,0,18,28,2,0,7,34,6),C(0,9,12,-6,0,19,29,2,0,7,36,6),C(0,10,13,-6,0,20,31,3,0,8,38,7),C(0,10,13,-6,0,21,33,3,0,8,40,7),C(0,10,14,-6,0,22,35,3,0,8,42,7),C(0,11,14,-7,0,23,36,3,0,9,44,8),C(0,11,15,-7,0,24,38,3,0,9,46,8)],I={borderRadius:4},P=n(36),R=(n(23),n(25));n(14);var L=function(e,t){return t?Object(a.a)(e,t,{clone:!1}):e},O={xs:0,sm:600,md:960,lg:1280,xl:1920},D={keys:["xs","sm","md","lg","xl"],up:function(e){return"@media (min-width:".concat(O[e],"px)")}};var N={m:"margin",p:"padding"},z={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},F={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},B=function(e){var t={};return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}((function(e){if(e.length>2){if(!F[e])return[e];e=F[e]}var t=e.split(""),n=Object(P.a)(t,2),r=n[0],i=n[1],a=N[r],o=z[i]||"";return Array.isArray(o)?o.map((function(e){return a+e})):[a+o]})),U=["m","mt","mr","mb","ml","mx","my","p","pt","pr","pb","pl","px","py","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY"];function j(e){var t=e.spacing||8;return"number"===typeof t?function(e){return t*e}:Array.isArray(t)?function(e){return t[e]}:"function"===typeof t?t:function(){}}function V(e,t){return function(n){return e.reduce((function(e,r){return e[r]=function(e,t){if("string"===typeof t||null==t)return t;var n=e(Math.abs(t));return t>=0?n:"number"===typeof n?-n:"-".concat(n)}(t,n),e}),{})}}function H(e){var t=j(e.theme);return Object.keys(e).map((function(n){if(-1===U.indexOf(n))return null;var r=V(B(n),t),i=e[n];return function(e,t,n){if(Array.isArray(t)){var r=e.theme.breakpoints||D;return t.reduce((function(e,i,a){return e[r.up(r.keys[a])]=n(t[a]),e}),{})}if("object"===Object(R.a)(t)){var i=e.theme.breakpoints||D;return Object.keys(t).reduce((function(e,r){return e[i.up(r)]=n(t[r]),e}),{})}return n(t)}(e,i,r)})).reduce(L,{})}H.propTypes={},H.filterProps=U;function G(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;if(e.mui)return e;var t=j({spacing:e}),n=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return 0===n.length?t(1):1===n.length?t(n[0]):n.map((function(e){if("string"===typeof e)return e;var n=t(e);return"number"===typeof n?"".concat(n,"px"):n})).join(" ")};return Object.defineProperty(n,"unit",{get:function(){return e}}),n.mui=!0,n}var W={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},q={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function X(e){return"".concat(Math.round(e),"ms")}var Z={easing:W,duration:q,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["all"],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.duration,r=void 0===n?q.standard:n,a=t.easing,o=void 0===a?W.easeInOut:a,s=t.delay,l=void 0===s?0:s;Object(i.a)(t,["duration","easing","delay"]);return(Array.isArray(e)?e:[e]).map((function(e){return"".concat(e," ").concat("string"===typeof r?r:X(r)," ").concat(o," ").concat("string"===typeof l?l:X(l))})).join(",")},getAutoHeightDuration:function(e){if(!e)return 0;var t=e/36;return Math.round(10*(4+15*Math.pow(t,.25)+t/5))}},K={mobileStepper:1e3,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500};var Y=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.breakpoints,n=void 0===t?{}:t,r=e.mixins,o=void 0===r?{}:r,s=e.palette,c=void 0===s?{}:s,h=e.spacing,f=e.typography,d=void 0===f?{}:f,p=Object(i.a)(e,["breakpoints","mixins","palette","spacing","typography"]),m=E(c),v=l(n),y=G(h),g=Object(a.a)({breakpoints:v,direction:"ltr",mixins:u(v,y,o),overrides:{},palette:m,props:{},shadows:A,typography:M(m,d),spacing:y,shape:I,transitions:Z,zIndex:K},p),_=arguments.length,b=new Array(_>1?_-1:0),x=1;x<_;x++)b[x-1]=arguments[x];return g=b.reduce((function(e,t){return Object(a.a)(e,t)}),g)}();t.a=Y},function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function i(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}}n.d(t,"a",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(54);var i=n(33),a=n(55);function o(e,t){return Object(r.a)(e)||function(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(l){i=!0,a=l}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}}(e,t)||Object(i.a)(e,t)||Object(a.a)()}},function(e,t,n){"use strict";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;function o(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(i){return!1}}()?Object.assign:function(e,t){for(var n,s,l=o(e),u=1;u<arguments.length;u++){for(var c in n=Object(arguments[u]))i.call(n,c)&&(l[c]=n[c]);if(r){s=r(n);for(var h=0;h<s.length;h++)a.call(n,s[h])&&(l[s[h]]=n[s[h]])}}return l}},function(e,t){function n(t,r){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,r)}e.exports=n},,,function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t,n){var r=n(38),i=n(43);function a(t,n,o){return i()?e.exports=a=Reflect.construct:e.exports=a=function(e,t,n){var i=[null];i.push.apply(i,t);var a=new(Function.bind.apply(e,i));return n&&r(a,n.prototype),a},a.apply(null,arguments)}e.exports=a},function(e,t){e.exports=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}},function(e,t,n){var r=n(73),i=n(41);e.exports=function(e,t){return!t||"object"!==r(t)&&"function"!==typeof t?i(e):t}},function(e,t){e.exports=function(e){if(Array.isArray(e))return e}},function(e,t){e.exports=function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}},function(e,t){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"===typeof window&&(n=window)}e.exports=n},function(e,t){var n={utf8:{stringToBytes:function(e){return n.bin.stringToBytes(unescape(encodeURIComponent(e)))},bytesToString:function(e){return decodeURIComponent(escape(n.bin.bytesToString(e)))}},bin:{stringToBytes:function(e){for(var t=[],n=0;n<e.length;n++)t.push(255&e.charCodeAt(n));return t},bytesToString:function(e){for(var t=[],n=0;n<e.length;n++)t.push(String.fromCharCode(e[n]));return t.join("")}}};e.exports=n},function(e,t,n){"use strict";e.exports=n(98)},function(e,t,n){!function(){var t=n(94),r=n(50).utf8,i=n(95),a=n(50).bin,o=function e(n,o){n.constructor==String?n=o&&"binary"===o.encoding?a.stringToBytes(n):r.stringToBytes(n):i(n)?n=Array.prototype.slice.call(n,0):Array.isArray(n)||n.constructor===Uint8Array||(n=n.toString());for(var s=t.bytesToWords(n),l=8*n.length,u=1732584193,c=-271733879,h=-1732584194,f=271733878,d=0;d<s.length;d++)s[d]=16711935&(s[d]<<8|s[d]>>>24)|4278255360&(s[d]<<24|s[d]>>>8);s[l>>>5]|=128<<l%32,s[14+(l+64>>>9<<4)]=l;var p=e._ff,m=e._gg,v=e._hh,y=e._ii;for(d=0;d<s.length;d+=16){var g=u,_=c,b=h,x=f;u=p(u,c,h,f,s[d+0],7,-680876936),f=p(f,u,c,h,s[d+1],12,-389564586),h=p(h,f,u,c,s[d+2],17,606105819),c=p(c,h,f,u,s[d+3],22,-1044525330),u=p(u,c,h,f,s[d+4],7,-176418897),f=p(f,u,c,h,s[d+5],12,1200080426),h=p(h,f,u,c,s[d+6],17,-1473231341),c=p(c,h,f,u,s[d+7],22,-45705983),u=p(u,c,h,f,s[d+8],7,1770035416),f=p(f,u,c,h,s[d+9],12,-1958414417),h=p(h,f,u,c,s[d+10],17,-42063),c=p(c,h,f,u,s[d+11],22,-1990404162),u=p(u,c,h,f,s[d+12],7,1804603682),f=p(f,u,c,h,s[d+13],12,-40341101),h=p(h,f,u,c,s[d+14],17,-1502002290),u=m(u,c=p(c,h,f,u,s[d+15],22,1236535329),h,f,s[d+1],5,-165796510),f=m(f,u,c,h,s[d+6],9,-1069501632),h=m(h,f,u,c,s[d+11],14,643717713),c=m(c,h,f,u,s[d+0],20,-373897302),u=m(u,c,h,f,s[d+5],5,-701558691),f=m(f,u,c,h,s[d+10],9,38016083),h=m(h,f,u,c,s[d+15],14,-660478335),c=m(c,h,f,u,s[d+4],20,-405537848),u=m(u,c,h,f,s[d+9],5,568446438),f=m(f,u,c,h,s[d+14],9,-1019803690),h=m(h,f,u,c,s[d+3],14,-187363961),c=m(c,h,f,u,s[d+8],20,1163531501),u=m(u,c,h,f,s[d+13],5,-1444681467),f=m(f,u,c,h,s[d+2],9,-51403784),h=m(h,f,u,c,s[d+7],14,1735328473),u=v(u,c=m(c,h,f,u,s[d+12],20,-1926607734),h,f,s[d+5],4,-378558),f=v(f,u,c,h,s[d+8],11,-2022574463),h=v(h,f,u,c,s[d+11],16,1839030562),c=v(c,h,f,u,s[d+14],23,-35309556),u=v(u,c,h,f,s[d+1],4,-1530992060),f=v(f,u,c,h,s[d+4],11,1272893353),h=v(h,f,u,c,s[d+7],16,-155497632),c=v(c,h,f,u,s[d+10],23,-1094730640),u=v(u,c,h,f,s[d+13],4,681279174),f=v(f,u,c,h,s[d+0],11,-358537222),h=v(h,f,u,c,s[d+3],16,-722521979),c=v(c,h,f,u,s[d+6],23,76029189),u=v(u,c,h,f,s[d+9],4,-640364487),f=v(f,u,c,h,s[d+12],11,-421815835),h=v(h,f,u,c,s[d+15],16,530742520),u=y(u,c=v(c,h,f,u,s[d+2],23,-995338651),h,f,s[d+0],6,-198630844),f=y(f,u,c,h,s[d+7],10,1126891415),h=y(h,f,u,c,s[d+14],15,-1416354905),c=y(c,h,f,u,s[d+5],21,-57434055),u=y(u,c,h,f,s[d+12],6,1700485571),f=y(f,u,c,h,s[d+3],10,-1894986606),h=y(h,f,u,c,s[d+10],15,-1051523),c=y(c,h,f,u,s[d+1],21,-2054922799),u=y(u,c,h,f,s[d+8],6,1873313359),f=y(f,u,c,h,s[d+15],10,-30611744),h=y(h,f,u,c,s[d+6],15,-1560198380),c=y(c,h,f,u,s[d+13],21,1309151649),u=y(u,c,h,f,s[d+4],6,-145523070),f=y(f,u,c,h,s[d+11],10,-1120210379),h=y(h,f,u,c,s[d+2],15,718787259),c=y(c,h,f,u,s[d+9],21,-343485551),u=u+g>>>0,c=c+_>>>0,h=h+b>>>0,f=f+x>>>0}return t.endian([u,c,h,f])};o._ff=function(e,t,n,r,i,a,o){var s=e+(t&n|~t&r)+(i>>>0)+o;return(s<<a|s>>>32-a)+t},o._gg=function(e,t,n,r,i,a,o){var s=e+(t&r|n&~r)+(i>>>0)+o;return(s<<a|s>>>32-a)+t},o._hh=function(e,t,n,r,i,a,o){var s=e+(t^n^r)+(i>>>0)+o;return(s<<a|s>>>32-a)+t},o._ii=function(e,t,n,r,i,a,o){var s=e+(n^(t|~r))+(i>>>0)+o;return(s<<a|s>>>32-a)+t},o._blocksize=16,o._digestsize=16,e.exports=function(e,n){if(void 0===e||null===e)throw new Error("Illegal argument "+e);var r=t.wordsToBytes(o(e,n));return n&&n.asBytes?r:n&&n.asString?a.bytesToString(r):t.bytesToHex(r)}}()},function(e,t,n){"use strict";function r(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(e){if(Array.isArray(e))return e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";var r=n(51),i={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},a={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function l(e){return r.isMemo(e)?o:s[e.$$typeof]||i}s[r.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[r.Memo]=o;var u=Object.defineProperty,c=Object.getOwnPropertyNames,h=Object.getOwnPropertySymbols,f=Object.getOwnPropertyDescriptor,d=Object.getPrototypeOf,p=Object.prototype;e.exports=function e(t,n,r){if("string"!==typeof n){if(p){var i=d(n);i&&i!==p&&e(t,i,r)}var o=c(n);h&&(o=o.concat(h(n)));for(var s=l(t),m=l(n),v=0;v<o.length;++v){var y=o[v];if(!a[y]&&(!r||!r[y])&&(!m||!m[y])&&(!s||!s[y])){var g=f(n,y);try{u(t,y,g)}catch(_){}}}}return t}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(1),i=r.createContext();var a=i;function o(){return r.useContext(a)}},function(e,t,n){"use strict";function r(e){for(var t="https://material-ui.com/production-error/?code="+e,n=1;n<arguments.length;n+=1)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified Material-UI error #"+e+"; visit "+t+" for the full message."}n.d(t,"a",(function(){return r}))},,,,function(e,t,n){"use strict";n(37);var r=n(1),i=60103;if(t.Fragment=60107,"function"===typeof Symbol&&Symbol.for){var a=Symbol.for;i=a("react.element"),t.Fragment=a("react.fragment")}var o=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s=Object.prototype.hasOwnProperty,l={key:!0,ref:!0,__self:!0,__source:!0};function u(e,t,n){var r,a={},u=null,c=null;for(r in void 0!==n&&(u=""+n),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(c=t.ref),t)s.call(t,r)&&!l.hasOwnProperty(r)&&(a[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===a[r]&&(a[r]=t[r]);return{$$typeof:i,type:e,key:u,ref:c,props:a,_owner:o.current}}t.jsx=u,t.jsxs=u},function(e,t,n){"use strict";var r=n(37),i=60103,a=60106;t.Fragment=60107,t.StrictMode=60108,t.Profiler=60114;var o=60109,s=60110,l=60112;t.Suspense=60113;var u=60115,c=60116;if("function"===typeof Symbol&&Symbol.for){var h=Symbol.for;i=h("react.element"),a=h("react.portal"),t.Fragment=h("react.fragment"),t.StrictMode=h("react.strict_mode"),t.Profiler=h("react.profiler"),o=h("react.provider"),s=h("react.context"),l=h("react.forward_ref"),t.Suspense=h("react.suspense"),u=h("react.memo"),c=h("react.lazy")}var f="function"===typeof Symbol&&Symbol.iterator;function d(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m={};function v(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}function y(){}function g(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}v.prototype.isReactComponent={},v.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error(d(85));this.updater.enqueueSetState(this,e,t,"setState")},v.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=v.prototype;var _=g.prototype=new y;_.constructor=g,r(_,v.prototype),_.isPureReactComponent=!0;var b={current:null},x=Object.prototype.hasOwnProperty,w={key:!0,ref:!0,__self:!0,__source:!0};function E(e,t,n){var r,a={},o=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)x.call(t,r)&&!w.hasOwnProperty(r)&&(a[r]=t[r]);var l=arguments.length-2;if(1===l)a.children=n;else if(1<l){for(var u=Array(l),c=0;c<l;c++)u[c]=arguments[c+2];a.children=u}if(e&&e.defaultProps)for(r in l=e.defaultProps)void 0===a[r]&&(a[r]=l[r]);return{$$typeof:i,type:e,key:o,ref:s,props:a,_owner:b.current}}function S(e){return"object"===typeof e&&null!==e&&e.$$typeof===i}var T=/\/+/g;function k(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function M(e,t,n,r,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case i:case a:l=!0}}if(l)return o=o(l=e),e=""===r?"."+k(l,0):r,Array.isArray(o)?(n="",null!=e&&(n=e.replace(T,"$&/")+"/"),M(o,t,n,"",(function(e){return e}))):null!=o&&(S(o)&&(o=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,n+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(T,"$&/")+"/")+e)),t.push(o)),1;if(l=0,r=""===r?".":r+":",Array.isArray(e))for(var u=0;u<e.length;u++){var c=r+k(s=e[u],u);l+=M(s,t,n,c,o)}else if("function"===typeof(c=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=f&&e[f]||e["@@iterator"])?e:null}(e)))for(e=c.call(e),u=0;!(s=e.next()).done;)l+=M(s=s.value,t,n,c=r+k(s,u++),o);else if("object"===s)throw t=""+e,Error(d(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return l}function C(e,t,n){if(null==e)return e;var r=[],i=0;return M(e,r,"","",(function(e){return t.call(n,e,i++)})),r}function A(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var I={current:null};function P(){var e=I.current;if(null===e)throw Error(d(321));return e}var R={ReactCurrentDispatcher:I,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:b,IsSomeRendererActing:{current:!1},assign:r};t.Children={map:C,forEach:function(e,t,n){C(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return C(e,(function(){t++})),t},toArray:function(e){return C(e,(function(e){return e}))||[]},only:function(e){if(!S(e))throw Error(d(143));return e}},t.Component=v,t.PureComponent=g,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=R,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error(d(267,e));var a=r({},e.props),o=e.key,s=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,l=b.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(c in t)x.call(t,c)&&!w.hasOwnProperty(c)&&(a[c]=void 0===t[c]&&void 0!==u?u[c]:t[c])}var c=arguments.length-2;if(1===c)a.children=n;else if(1<c){u=Array(c);for(var h=0;h<c;h++)u[h]=arguments[h+2];a.children=u}return{$$typeof:i,type:e.type,key:o,ref:s,props:a,_owner:l}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:s,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=E,t.createFactory=function(e){var t=E.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=S,t.lazy=function(e){return{$$typeof:c,_payload:{_status:-1,_result:e},_init:A}},t.memo=function(e,t){return{$$typeof:u,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return P().useCallback(e,t)},t.useContext=function(e,t){return P().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return P().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return P().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return P().useLayoutEffect(e,t)},t.useMemo=function(e,t){return P().useMemo(e,t)},t.useReducer=function(e,t,n){return P().useReducer(e,t,n)},t.useRef=function(e){return P().useRef(e)},t.useState=function(e){return P().useState(e)},t.version="17.0.1"},function(e,t,n){"use strict";var r=n(1),i=n(37),a=n(65);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!r)throw Error(o(227));var s=new Set,l={};function u(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(l[e]=t,e=0;e<t.length;e++)s.add(t[e])}var h=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d=Object.prototype.hasOwnProperty,p={},m={};function v(e,t,n,r,i,a,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a,this.removeEmptyString=o}var y={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){y[e]=new v(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];y[t]=new v(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){y[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){y[e]=new v(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){y[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){y[e]=new v(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){y[e]=new v(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){y[e]=new v(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){y[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)}));var g=/[\-:]([a-z])/g;function _(e){return e[1].toUpperCase()}function b(e,t,n,r){var i=y.hasOwnProperty(t)?y[t]:null;(null!==i?0===i.type:!r&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!d.call(m,e)||!d.call(p,e)&&(f.test(e)?m[e]=!0:(p[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(g,_);y[t]=new v(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(g,_);y[t]=new v(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(g,_);y[t]=new v(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){y[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)})),y.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){y[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,w=60103,E=60106,S=60107,T=60108,k=60114,M=60109,C=60110,A=60112,I=60113,P=60120,R=60115,L=60116,O=60121,D=60128,N=60129,z=60130,F=60131;if("function"===typeof Symbol&&Symbol.for){var B=Symbol.for;w=B("react.element"),E=B("react.portal"),S=B("react.fragment"),T=B("react.strict_mode"),k=B("react.profiler"),M=B("react.provider"),C=B("react.context"),A=B("react.forward_ref"),I=B("react.suspense"),P=B("react.suspense_list"),R=B("react.memo"),L=B("react.lazy"),O=B("react.block"),B("react.scope"),D=B("react.opaque.id"),N=B("react.debug_trace_mode"),z=B("react.offscreen"),F=B("react.legacy_hidden")}var U,j="function"===typeof Symbol&&Symbol.iterator;function V(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=j&&e[j]||e["@@iterator"])?e:null}function H(e){if(void 0===U)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);U=t&&t[1]||""}return"\n"+U+e}var G=!1;function W(e,t){if(!e||G)return"";G=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(l){var r=l}Reflect.construct(e,[],t)}else{try{t.call()}catch(l){r=l}e.call(t.prototype)}else{try{throw Error()}catch(l){r=l}e()}}catch(l){if(l&&r&&"string"===typeof l.stack){for(var i=l.stack.split("\n"),a=r.stack.split("\n"),o=i.length-1,s=a.length-1;1<=o&&0<=s&&i[o]!==a[s];)s--;for(;1<=o&&0<=s;o--,s--)if(i[o]!==a[s]){if(1!==o||1!==s)do{if(o--,0>--s||i[o]!==a[s])return"\n"+i[o].replace(" at new "," at ")}while(1<=o&&0<=s);break}}}finally{G=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?H(e):""}function q(e){switch(e.tag){case 5:return H(e.type);case 16:return H("Lazy");case 13:return H("Suspense");case 19:return H("SuspenseList");case 0:case 2:case 15:return e=W(e.type,!1);case 11:return e=W(e.type.render,!1);case 22:return e=W(e.type._render,!1);case 1:return e=W(e.type,!0);default:return""}}function X(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case S:return"Fragment";case E:return"Portal";case k:return"Profiler";case T:return"StrictMode";case I:return"Suspense";case P:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case C:return(e.displayName||"Context")+".Consumer";case M:return(e._context.displayName||"Context")+".Provider";case A:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case R:return X(e.type);case O:return X(e._render);case L:t=e._payload,e=e._init;try{return X(e(t))}catch(n){}}return null}function Z(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function K(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Y(e){e._valueTracker||(e._valueTracker=function(e){var t=K(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function J(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=K(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Q(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function $(e,t){var n=t.checked;return i({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function ee(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=Z(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function te(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function ne(e,t){te(e,t);var n=Z(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ie(e,t.type,n):t.hasOwnProperty("defaultValue")&&ie(e,t.type,Z(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function re(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ie(e,t,n){"number"===t&&Q(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function ae(e,t){return e=i({children:void 0},t),(t=function(e){var t="";return r.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function oe(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+Z(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function se(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return i({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function le(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:Z(n)}}function ue(e,t){var n=Z(t.value),r=Z(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function ce(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var he="http://www.w3.org/1999/xhtml",fe="http://www.w3.org/2000/svg";function de(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function pe(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?de(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var me,ve,ye=(ve=function(e,t){if(e.namespaceURI!==fe||"innerHTML"in e)e.innerHTML=t;else{for((me=me||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=me.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return ve(e,t)}))}:ve);function ge(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var _e={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},be=["Webkit","ms","Moz","O"];function xe(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||_e.hasOwnProperty(e)&&_e[e]?(""+t).trim():t+"px"}function we(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=xe(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(_e).forEach((function(e){be.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),_e[t]=_e[e]}))}));var Ee=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Se(e,t){if(t){if(Ee[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function Te(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function ke(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Me=null,Ce=null,Ae=null;function Ie(e){if(e=ei(e)){if("function"!==typeof Me)throw Error(o(280));var t=e.stateNode;t&&(t=ni(t),Me(e.stateNode,e.type,t))}}function Pe(e){Ce?Ae?Ae.push(e):Ae=[e]:Ce=e}function Re(){if(Ce){var e=Ce,t=Ae;if(Ae=Ce=null,Ie(e),t)for(e=0;e<t.length;e++)Ie(t[e])}}function Le(e,t){return e(t)}function Oe(e,t,n,r,i){return e(t,n,r,i)}function De(){}var Ne=Le,ze=!1,Fe=!1;function Be(){null===Ce&&null===Ae||(De(),Re())}function Ue(e,t){var n=e.stateNode;if(null===n)return null;var r=ni(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}var je=!1;if(h)try{var Ve={};Object.defineProperty(Ve,"passive",{get:function(){je=!0}}),window.addEventListener("test",Ve,Ve),window.removeEventListener("test",Ve,Ve)}catch(ve){je=!1}function He(e,t,n,r,i,a,o,s,l){var u=Array.prototype.slice.call(arguments,3);try{t.apply(n,u)}catch(c){this.onError(c)}}var Ge=!1,We=null,qe=!1,Xe=null,Ze={onError:function(e){Ge=!0,We=e}};function Ke(e,t,n,r,i,a,o,s,l){Ge=!1,We=null,He.apply(Ze,arguments)}function Ye(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(1026&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Je(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Qe(e){if(Ye(e)!==e)throw Error(o(188))}function $e(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ye(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(r=i.return)){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return Qe(i),e;if(a===r)return Qe(i),t;a=a.sibling}throw Error(o(188))}if(n.return!==r.return)n=i,r=a;else{for(var s=!1,l=i.child;l;){if(l===n){s=!0,n=i,r=a;break}if(l===r){s=!0,r=i,n=a;break}l=l.sibling}if(!s){for(l=a.child;l;){if(l===n){s=!0,n=a,r=i;break}if(l===r){s=!0,r=a,n=i;break}l=l.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function et(e,t){for(var n=e.alternate;null!==t;){if(t===e||t===n)return!0;t=t.return}return!1}var tt,nt,rt,it,at=!1,ot=[],st=null,lt=null,ut=null,ct=new Map,ht=new Map,ft=[],dt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function pt(e,t,n,r,i){return{blockedOn:e,domEventName:t,eventSystemFlags:16|n,nativeEvent:i,targetContainers:[r]}}function mt(e,t){switch(e){case"focusin":case"focusout":st=null;break;case"dragenter":case"dragleave":lt=null;break;case"mouseover":case"mouseout":ut=null;break;case"pointerover":case"pointerout":ct.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ht.delete(t.pointerId)}}function vt(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e=pt(t,n,r,i,a),null!==t&&(null!==(t=ei(t))&&nt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function yt(e){var t=$r(e.target);if(null!==t){var n=Ye(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Je(n)))return e.blockedOn=t,void it(e.lanePriority,(function(){a.unstable_runWithPriority(e.priority,(function(){rt(n)}))}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function gt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=$t(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ei(n))&&nt(t),e.blockedOn=n,!1;t.shift()}return!0}function _t(e,t,n){gt(e)&&n.delete(t)}function bt(){for(at=!1;0<ot.length;){var e=ot[0];if(null!==e.blockedOn){null!==(e=ei(e.blockedOn))&&tt(e);break}for(var t=e.targetContainers;0<t.length;){var n=$t(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n){e.blockedOn=n;break}t.shift()}null===e.blockedOn&&ot.shift()}null!==st&&gt(st)&&(st=null),null!==lt&&gt(lt)&&(lt=null),null!==ut&&gt(ut)&&(ut=null),ct.forEach(_t),ht.forEach(_t)}function xt(e,t){e.blockedOn===t&&(e.blockedOn=null,at||(at=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,bt)))}function wt(e){function t(t){return xt(t,e)}if(0<ot.length){xt(ot[0],e);for(var n=1;n<ot.length;n++){var r=ot[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==st&&xt(st,e),null!==lt&&xt(lt,e),null!==ut&&xt(ut,e),ct.forEach(t),ht.forEach(t),n=0;n<ft.length;n++)(r=ft[n]).blockedOn===e&&(r.blockedOn=null);for(;0<ft.length&&null===(n=ft[0]).blockedOn;)yt(n),null===n.blockedOn&&ft.shift()}function Et(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var St={animationend:Et("Animation","AnimationEnd"),animationiteration:Et("Animation","AnimationIteration"),animationstart:Et("Animation","AnimationStart"),transitionend:Et("Transition","TransitionEnd")},Tt={},kt={};function Mt(e){if(Tt[e])return Tt[e];if(!St[e])return e;var t,n=St[e];for(t in n)if(n.hasOwnProperty(t)&&t in kt)return Tt[e]=n[t];return e}h&&(kt=document.createElement("div").style,"AnimationEvent"in window||(delete St.animationend.animation,delete St.animationiteration.animation,delete St.animationstart.animation),"TransitionEvent"in window||delete St.transitionend.transition);var Ct=Mt("animationend"),At=Mt("animationiteration"),It=Mt("animationstart"),Pt=Mt("transitionend"),Rt=new Map,Lt=new Map,Ot=["abort","abort",Ct,"animationEnd",At,"animationIteration",It,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Pt,"transitionEnd","waiting","waiting"];function Dt(e,t){for(var n=0;n<e.length;n+=2){var r=e[n],i=e[n+1];i="on"+(i[0].toUpperCase()+i.slice(1)),Lt.set(r,t),Rt.set(r,i),u(i,[r])}}(0,a.unstable_now)();var Nt=8;function zt(e){if(0!==(1&e))return Nt=15,1;if(0!==(2&e))return Nt=14,2;if(0!==(4&e))return Nt=13,4;var t=24&e;return 0!==t?(Nt=12,t):0!==(32&e)?(Nt=11,32):0!==(t=192&e)?(Nt=10,t):0!==(256&e)?(Nt=9,256):0!==(t=3584&e)?(Nt=8,t):0!==(4096&e)?(Nt=7,4096):0!==(t=4186112&e)?(Nt=6,t):0!==(t=62914560&e)?(Nt=5,t):67108864&e?(Nt=4,67108864):0!==(134217728&e)?(Nt=3,134217728):0!==(t=805306368&e)?(Nt=2,t):0!==(1073741824&e)?(Nt=1,1073741824):(Nt=8,e)}function Ft(e,t){var n=e.pendingLanes;if(0===n)return Nt=0;var r=0,i=0,a=e.expiredLanes,o=e.suspendedLanes,s=e.pingedLanes;if(0!==a)r=a,i=Nt=15;else if(0!==(a=134217727&n)){var l=a&~o;0!==l?(r=zt(l),i=Nt):0!==(s&=a)&&(r=zt(s),i=Nt)}else 0!==(a=n&~o)?(r=zt(a),i=Nt):0!==s&&(r=zt(s),i=Nt);if(0===r)return 0;if(r=n&((0>(r=31-Gt(r))?0:1<<r)<<1)-1,0!==t&&t!==r&&0===(t&o)){if(zt(t),i<=Nt)return t;Nt=i}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)i=1<<(n=31-Gt(t)),r|=e[n],t&=~i;return r}function Bt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Ut(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=jt(24&~t))?Ut(10,t):e;case 10:return 0===(e=jt(192&~t))?Ut(8,t):e;case 8:return 0===(e=jt(3584&~t))&&(0===(e=jt(4186112&~t))&&(e=512)),e;case 2:return 0===(t=jt(805306368&~t))&&(t=268435456),t}throw Error(o(358,e))}function jt(e){return e&-e}function Vt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Ht(e,t,n){e.pendingLanes|=t;var r=t-1;e.suspendedLanes&=r,e.pingedLanes&=r,(e=e.eventTimes)[t=31-Gt(t)]=n}var Gt=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(Wt(e)/qt|0)|0},Wt=Math.log,qt=Math.LN2;var Xt=a.unstable_UserBlockingPriority,Zt=a.unstable_runWithPriority,Kt=!0;function Yt(e,t,n,r){ze||De();var i=Qt,a=ze;ze=!0;try{Oe(i,e,t,n,r)}finally{(ze=a)||Be()}}function Jt(e,t,n,r){Zt(Xt,Qt.bind(null,e,t,n,r))}function Qt(e,t,n,r){var i;if(Kt)if((i=0===(4&t))&&0<ot.length&&-1<dt.indexOf(e))e=pt(null,e,t,n,r),ot.push(e);else{var a=$t(e,t,n,r);if(null===a)i&&mt(e,r);else{if(i){if(-1<dt.indexOf(e))return e=pt(a,e,t,n,r),void ot.push(e);if(function(e,t,n,r,i){switch(t){case"focusin":return st=vt(st,e,t,n,r,i),!0;case"dragenter":return lt=vt(lt,e,t,n,r,i),!0;case"mouseover":return ut=vt(ut,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return ct.set(a,vt(ct.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,ht.set(a,vt(ht.get(a)||null,e,t,n,r,i)),!0}return!1}(a,e,t,n,r))return;mt(e,r)}Rr(e,t,r,null,n)}}}function $t(e,t,n,r){var i=ke(r);if(null!==(i=$r(i))){var a=Ye(i);if(null===a)i=null;else{var o=a.tag;if(13===o){if(null!==(i=Je(a)))return i;i=null}else if(3===o){if(a.stateNode.hydrate)return 3===a.tag?a.stateNode.containerInfo:null;i=null}else a!==i&&(i=null)}}return Rr(e,t,r,i,n),null}var en=null,tn=null,nn=null;function rn(){if(nn)return nn;var e,t,n=tn,r=n.length,i="value"in en?en.value:en.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[a-t];t++);return nn=i.slice(e,1<t?1-t:void 0)}function an(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function on(){return!0}function sn(){return!1}function ln(e){function t(t,n,r,i,a){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=i,this.target=a,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?on:sn,this.isPropagationStopped=sn,this}return i(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=on)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=on)},persist:function(){},isPersistent:on}),t}var un,cn,hn,fn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},dn=ln(fn),pn=i({},fn,{view:0,detail:0}),mn=ln(pn),vn=i({},pn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==hn&&(hn&&"mousemove"===e.type?(un=e.screenX-hn.screenX,cn=e.screenY-hn.screenY):cn=un=0,hn=e),un)},movementY:function(e){return"movementY"in e?e.movementY:cn}}),yn=ln(vn),gn=ln(i({},vn,{dataTransfer:0})),_n=ln(i({},pn,{relatedTarget:0})),bn=ln(i({},fn,{animationName:0,elapsedTime:0,pseudoElement:0})),xn=ln(i({},fn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),wn=ln(i({},fn,{data:0})),En={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Sn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Tn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Tn[e])&&!!t[e]}function Mn(){return kn}var Cn=ln(i({},pn,{key:function(e){if(e.key){var t=En[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=an(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Sn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mn,charCode:function(e){return"keypress"===e.type?an(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?an(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),An=ln(i({},vn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),In=ln(i({},pn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mn})),Pn=ln(i({},fn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=ln(i({},vn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Ln=[9,13,27,32],On=h&&"CompositionEvent"in window,Dn=null;h&&"documentMode"in document&&(Dn=document.documentMode);var Nn=h&&"TextEvent"in window&&!Dn,zn=h&&(!On||Dn&&8<Dn&&11>=Dn),Fn=String.fromCharCode(32),Bn=!1;function Un(e,t){switch(e){case"keyup":return-1!==Ln.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function jn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Vn=!1;var Hn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Hn[e.type]:"textarea"===t}function Wn(e,t,n,r){Pe(r),0<(t=Or(t,"onChange")).length&&(n=new dn("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var qn=null,Xn=null;function Zn(e){kr(e,0)}function Kn(e){if(J(ti(e)))return e}function Yn(e,t){if("change"===e)return t}var Jn=!1;if(h){var Qn;if(h){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}Qn=$n}else Qn=!1;Jn=Qn&&(!document.documentMode||9<document.documentMode)}function tr(){qn&&(qn.detachEvent("onpropertychange",nr),Xn=qn=null)}function nr(e){if("value"===e.propertyName&&Kn(Xn)){var t=[];if(Wn(t,Xn,e,ke(e)),e=Zn,ze)e(t);else{ze=!0;try{Le(e,t)}finally{ze=!1,Be()}}}}function rr(e,t,n){"focusin"===e?(tr(),Xn=n,(qn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ir(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Kn(Xn)}function ar(e,t){if("click"===e)return Kn(t)}function or(e,t){if("input"===e||"change"===e)return Kn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},lr=Object.prototype.hasOwnProperty;function ur(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!lr.call(t,n[r])||!sr(e[n[r]],t[n[r]]))return!1;return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function hr(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function fr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?fr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function dr(){for(var e=window,t=Q();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=Q((e=t.contentWindow).document)}return t}function pr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var mr=h&&"documentMode"in document&&11>=document.documentMode,vr=null,yr=null,gr=null,_r=!1;function br(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;_r||null==vr||vr!==Q(r)||("selectionStart"in(r=vr)&&pr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},gr&&ur(gr,r)||(gr=r,0<(r=Or(yr,"onSelect")).length&&(t=new dn("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=vr)))}Dt("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Dt("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Dt(Ot,2);for(var xr="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),wr=0;wr<xr.length;wr++)Lt.set(xr[wr],0);c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Er="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Sr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Er));function Tr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,i,a,s,l,u){if(Ke.apply(this,arguments),Ge){if(!Ge)throw Error(o(198));var c=We;Ge=!1,We=null,qe||(qe=!0,Xe=c)}}(r,t,void 0,e),e.currentTarget=null}function kr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],i=r.event;r=r.listeners;e:{var a=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],l=s.instance,u=s.currentTarget;if(s=s.listener,l!==a&&i.isPropagationStopped())break e;Tr(i,s,u),a=l}else for(o=0;o<r.length;o++){if(l=(s=r[o]).instance,u=s.currentTarget,s=s.listener,l!==a&&i.isPropagationStopped())break e;Tr(i,s,u),a=l}}}if(qe)throw e=Xe,qe=!1,Xe=null,e}function Mr(e,t){var n=ri(t),r=e+"__bubble";n.has(r)||(Pr(t,e,2,!1),n.add(r))}var Cr="_reactListening"+Math.random().toString(36).slice(2);function Ar(e){e[Cr]||(e[Cr]=!0,s.forEach((function(t){Sr.has(t)||Ir(t,!1,e,null),Ir(t,!0,e,null)})))}function Ir(e,t,n,r){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,a=n;if("selectionchange"===e&&9!==n.nodeType&&(a=n.ownerDocument),null!==r&&!t&&Sr.has(e)){if("scroll"!==e)return;i|=2,a=r}var o=ri(a),s=e+"__"+(t?"capture":"bubble");o.has(s)||(t&&(i|=4),Pr(a,e,i,t),o.add(s))}function Pr(e,t,n,r){var i=Lt.get(t);switch(void 0===i?2:i){case 0:i=Yt;break;case 1:i=Jt;break;default:i=Qt}n=i.bind(null,t,n,e),i=void 0,!je||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),r?void 0!==i?e.addEventListener(t,n,{capture:!0,passive:i}):e.addEventListener(t,n,!0):void 0!==i?e.addEventListener(t,n,{passive:i}):e.addEventListener(t,n,!1)}function Rr(e,t,n,r,i){var a=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===o)for(o=r.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;o=o.return}for(;null!==s;){if(null===(o=$r(s)))return;if(5===(l=o.tag)||6===l){r=a=o;continue e}s=s.parentNode}}r=r.return}!function(e,t,n){if(Fe)return e(t,n);Fe=!0;try{Ne(e,t,n)}finally{Fe=!1,Be()}}((function(){var r=a,i=ke(n),o=[];e:{var s=Rt.get(e);if(void 0!==s){var l=dn,u=e;switch(e){case"keypress":if(0===an(n))break e;case"keydown":case"keyup":l=Cn;break;case"focusin":u="focus",l=_n;break;case"focusout":u="blur",l=_n;break;case"beforeblur":case"afterblur":l=_n;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=yn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=gn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=In;break;case Ct:case At:case It:l=bn;break;case Pt:l=Pn;break;case"scroll":l=mn;break;case"wheel":l=Rn;break;case"copy":case"cut":case"paste":l=xn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=An}var c=0!==(4&t),h=!c&&"scroll"===e,f=c?null!==s?s+"Capture":null:s;c=[];for(var d,p=r;null!==p;){var m=(d=p).stateNode;if(5===d.tag&&null!==m&&(d=m,null!==f&&(null!=(m=Ue(p,f))&&c.push(Lr(p,m,d)))),h)break;p=p.return}0<c.length&&(s=new l(s,u,null,n,i),o.push({event:s,listeners:c}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||0!==(16&t)||!(u=n.relatedTarget||n.fromElement)||!$r(u)&&!u[Jr])&&(l||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=r,null!==(u=(u=n.relatedTarget||n.toElement)?$r(u):null)&&(u!==(h=Ye(u))||5!==u.tag&&6!==u.tag)&&(u=null)):(l=null,u=r),l!==u)){if(c=yn,m="onMouseLeave",f="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(c=An,m="onPointerLeave",f="onPointerEnter",p="pointer"),h=null==l?s:ti(l),d=null==u?s:ti(u),(s=new c(m,p+"leave",l,n,i)).target=h,s.relatedTarget=d,m=null,$r(i)===r&&((c=new c(f,p+"enter",u,n,i)).target=d,c.relatedTarget=h,m=c),h=m,l&&u)e:{for(f=u,p=0,d=c=l;d;d=Dr(d))p++;for(d=0,m=f;m;m=Dr(m))d++;for(;0<p-d;)c=Dr(c),p--;for(;0<d-p;)f=Dr(f),d--;for(;p--;){if(c===f||null!==f&&c===f.alternate)break e;c=Dr(c),f=Dr(f)}c=null}else c=null;null!==l&&Nr(o,s,l,c,!1),null!==u&&null!==h&&Nr(o,h,u,c,!0)}if("select"===(l=(s=r?ti(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var v=Yn;else if(Gn(s))if(Jn)v=or;else{v=ir;var y=rr}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(v=ar);switch(v&&(v=v(e,r))?Wn(o,v,n,i):(y&&y(e,s,r),"focusout"===e&&(y=s._wrapperState)&&y.controlled&&"number"===s.type&&ie(s,"number",s.value)),y=r?ti(r):window,e){case"focusin":(Gn(y)||"true"===y.contentEditable)&&(vr=y,yr=r,gr=null);break;case"focusout":gr=yr=vr=null;break;case"mousedown":_r=!0;break;case"contextmenu":case"mouseup":case"dragend":_r=!1,br(o,n,i);break;case"selectionchange":if(mr)break;case"keydown":case"keyup":br(o,n,i)}var g;if(On)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else Vn?Un(e,n)&&(_="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(_="onCompositionStart");_&&(zn&&"ko"!==n.locale&&(Vn||"onCompositionStart"!==_?"onCompositionEnd"===_&&Vn&&(g=rn()):(tn="value"in(en=i)?en.value:en.textContent,Vn=!0)),0<(y=Or(r,_)).length&&(_=new wn(_,e,null,n,i),o.push({event:_,listeners:y}),g?_.data=g:null!==(g=jn(n))&&(_.data=g))),(g=Nn?function(e,t){switch(e){case"compositionend":return jn(t);case"keypress":return 32!==t.which?null:(Bn=!0,Fn);case"textInput":return(e=t.data)===Fn&&Bn?null:e;default:return null}}(e,n):function(e,t){if(Vn)return"compositionend"===e||!On&&Un(e,t)?(e=rn(),nn=tn=en=null,Vn=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return zn&&"ko"!==t.locale?null:t.data;default:return null}}(e,n))&&(0<(r=Or(r,"onBeforeInput")).length&&(i=new wn("onBeforeInput","beforeinput",null,n,i),o.push({event:i,listeners:r}),i.data=g))}kr(o,t)}))}function Lr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Or(e,t){for(var n=t+"Capture",r=[];null!==e;){var i=e,a=i.stateNode;5===i.tag&&null!==a&&(i=a,null!=(a=Ue(e,n))&&r.unshift(Lr(e,a,i)),null!=(a=Ue(e,t))&&r.push(Lr(e,a,i))),e=e.return}return r}function Dr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Nr(e,t,n,r,i){for(var a=t._reactName,o=[];null!==n&&n!==r;){var s=n,l=s.alternate,u=s.stateNode;if(null!==l&&l===r)break;5===s.tag&&null!==u&&(s=u,i?null!=(l=Ue(n,a))&&o.unshift(Lr(n,l,s)):i||null!=(l=Ue(n,a))&&o.push(Lr(n,l,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}function zr(){}var Fr=null,Br=null;function Ur(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function jr(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var Vr="function"===typeof setTimeout?setTimeout:void 0,Hr="function"===typeof clearTimeout?clearTimeout:void 0;function Gr(e){1===e.nodeType?e.textContent="":9===e.nodeType&&(null!=(e=e.body)&&(e.textContent=""))}function Wr(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function qr(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var Xr=0;var Zr=Math.random().toString(36).slice(2),Kr="__reactFiber$"+Zr,Yr="__reactProps$"+Zr,Jr="__reactContainer$"+Zr,Qr="__reactEvents$"+Zr;function $r(e){var t=e[Kr];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Jr]||n[Kr]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=qr(e);null!==e;){if(n=e[Kr])return n;e=qr(e)}return t}n=(e=n).parentNode}return null}function ei(e){return!(e=e[Kr]||e[Jr])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ti(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function ni(e){return e[Yr]||null}function ri(e){var t=e[Qr];return void 0===t&&(t=e[Qr]=new Set),t}var ii=[],ai=-1;function oi(e){return{current:e}}function si(e){0>ai||(e.current=ii[ai],ii[ai]=null,ai--)}function li(e,t){ai++,ii[ai]=e.current,e.current=t}var ui={},ci=oi(ui),hi=oi(!1),fi=ui;function di(e,t){var n=e.type.contextTypes;if(!n)return ui;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function pi(e){return null!==(e=e.childContextTypes)&&void 0!==e}function mi(){si(hi),si(ci)}function vi(e,t,n){if(ci.current!==ui)throw Error(o(168));li(ci,t),li(hi,n)}function yi(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in e))throw Error(o(108,X(t)||"Unknown",a));return i({},n,r)}function gi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ui,fi=ci.current,li(ci,e),li(hi,hi.current),!0}function _i(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=yi(e,t,fi),r.__reactInternalMemoizedMergedChildContext=e,si(hi),si(ci),li(ci,e)):si(hi),li(hi,n)}var bi=null,xi=null,wi=a.unstable_runWithPriority,Ei=a.unstable_scheduleCallback,Si=a.unstable_cancelCallback,Ti=a.unstable_shouldYield,ki=a.unstable_requestPaint,Mi=a.unstable_now,Ci=a.unstable_getCurrentPriorityLevel,Ai=a.unstable_ImmediatePriority,Ii=a.unstable_UserBlockingPriority,Pi=a.unstable_NormalPriority,Ri=a.unstable_LowPriority,Li=a.unstable_IdlePriority,Oi={},Di=void 0!==ki?ki:function(){},Ni=null,zi=null,Fi=!1,Bi=Mi(),Ui=1e4>Bi?Mi:function(){return Mi()-Bi};function ji(){switch(Ci()){case Ai:return 99;case Ii:return 98;case Pi:return 97;case Ri:return 96;case Li:return 95;default:throw Error(o(332))}}function Vi(e){switch(e){case 99:return Ai;case 98:return Ii;case 97:return Pi;case 96:return Ri;case 95:return Li;default:throw Error(o(332))}}function Hi(e,t){return e=Vi(e),wi(e,t)}function Gi(e,t,n){return e=Vi(e),Ei(e,t,n)}function Wi(){if(null!==zi){var e=zi;zi=null,Si(e)}qi()}function qi(){if(!Fi&&null!==Ni){Fi=!0;var e=0;try{var t=Ni;Hi(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),Ni=null}catch(n){throw null!==Ni&&(Ni=Ni.slice(e+1)),Ei(Ai,Wi),n}finally{Fi=!1}}}var Xi=x.ReactCurrentBatchConfig;function Zi(e,t){if(e&&e.defaultProps){for(var n in t=i({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var Ki=oi(null),Yi=null,Ji=null,Qi=null;function $i(){Qi=Ji=Yi=null}function ea(e){var t=Ki.current;si(Ki),e.type._context._currentValue=t}function ta(e,t){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)===t){if(null===n||(n.childLanes&t)===t)break;n.childLanes|=t}else e.childLanes|=t,null!==n&&(n.childLanes|=t);e=e.return}}function na(e,t){Yi=e,Qi=Ji=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(Oo=!0),e.firstContext=null)}function ra(e,t){if(Qi!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||(Qi=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Ji){if(null===Yi)throw Error(o(308));Ji=t,Yi.dependencies={lanes:0,firstContext:t,responders:null}}else Ji=Ji.next=t;return e._currentValue}var ia=!1;function aa(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function oa(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function sa(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function la(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function ua(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var i=null,a=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===a?i=a=o:a=a.next=o,n=n.next}while(null!==n);null===a?i=a=t:a=a.next=t}else i=a=t;return n={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:a,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function ca(e,t,n,r){var a=e.updateQueue;ia=!1;var o=a.firstBaseUpdate,s=a.lastBaseUpdate,l=a.shared.pending;if(null!==l){a.shared.pending=null;var u=l,c=u.next;u.next=null,null===s?o=c:s.next=c,s=u;var h=e.alternate;if(null!==h){var f=(h=h.updateQueue).lastBaseUpdate;f!==s&&(null===f?h.firstBaseUpdate=c:f.next=c,h.lastBaseUpdate=u)}}if(null!==o){for(f=a.baseState,s=0,h=c=u=null;;){l=o.lane;var d=o.eventTime;if((r&l)===l){null!==h&&(h=h.next={eventTime:d,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var p=e,m=o;switch(l=t,d=n,m.tag){case 1:if("function"===typeof(p=m.payload)){f=p.call(d,f,l);break e}f=p;break e;case 3:p.flags=-4097&p.flags|64;case 0:if(null===(l="function"===typeof(p=m.payload)?p.call(d,f,l):p)||void 0===l)break e;f=i({},f,l);break e;case 2:ia=!0}}null!==o.callback&&(e.flags|=32,null===(l=a.effects)?a.effects=[o]:l.push(o))}else d={eventTime:d,lane:l,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===h?(c=h=d,u=f):h=h.next=d,s|=l;if(null===(o=o.next)){if(null===(l=a.shared.pending))break;o=l.next,l.next=null,a.lastBaseUpdate=l,a.shared.pending=null}}null===h&&(u=f),a.baseState=u,a.firstBaseUpdate=c,a.lastBaseUpdate=h,Fs|=s,e.lanes=s,e.memoizedState=f}}function ha(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=n,"function"!==typeof i)throw Error(o(191,i));i.call(r)}}}var fa=(new r.Component).refs;function da(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:i({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var pa={isMounted:function(e){return!!(e=e._reactInternals)&&Ye(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ul(),i=cl(e),a=sa(r,i);a.payload=t,void 0!==n&&null!==n&&(a.callback=n),la(e,a),hl(e,i,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ul(),i=cl(e),a=sa(r,i);a.tag=1,a.payload=t,void 0!==n&&null!==n&&(a.callback=n),la(e,a),hl(e,i,r)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ul(),r=cl(e),i=sa(n,r);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),la(e,i),hl(e,r,n)}};function ma(e,t,n,r,i,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!ur(n,r)||!ur(i,a))}function va(e,t,n){var r=!1,i=ui,a=t.contextType;return"object"===typeof a&&null!==a?a=ra(a):(i=pi(t)?fi:ci.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?di(e,i):ui),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=pa,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function ya(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&pa.enqueueReplaceState(t,t.state,null)}function ga(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=fa,aa(e);var a=t.contextType;"object"===typeof a&&null!==a?i.context=ra(a):(a=pi(t)?fi:ci.current,i.context=di(e,a)),ca(e,n,i,r),i.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(da(e,t,a,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&pa.enqueueReplaceState(i,i.state,null),ca(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4)}var _a=Array.isArray;function ba(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:((t=function(e){var t=r.refs;t===fa&&(t=r.refs={}),null===e?delete t[i]:t[i]=e})._stringRef=i,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function xa(e,t){if("textarea"!==e.type)throw Error(o(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function wa(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.flags=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Hl(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags=2,n):r:(t.flags=2,n):n}function s(t){return e&&null===t.alternate&&(t.flags=2),t}function l(e,t,n,r){return null===t||6!==t.tag?((t=Xl(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function u(e,t,n,r){return null!==t&&t.elementType===n.type?((r=i(t,n.props)).ref=ba(e,t,n),r.return=e,r):((r=Gl(n.type,n.key,n.props,null,e.mode,r)).ref=ba(e,t,n),r.return=e,r)}function c(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Zl(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function h(e,t,n,r,a){return null===t||7!==t.tag?((t=Wl(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function f(e,t,n){if("string"===typeof t||"number"===typeof t)return(t=Xl(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case w:return(n=Gl(t.type,t.key,t.props,null,e.mode,n)).ref=ba(e,null,t),n.return=e,n;case E:return(t=Zl(t,e.mode,n)).return=e,t}if(_a(t)||V(t))return(t=Wl(t,e.mode,n,null)).return=e,t;xa(e,t)}return null}function d(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n||"number"===typeof n)return null!==i?null:l(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case w:return n.key===i?n.type===S?h(e,t,n.props.children,r,i):u(e,t,n,r):null;case E:return n.key===i?c(e,t,n,r):null}if(_a(n)||V(n))return null!==i?null:h(e,t,n,r,null);xa(e,n)}return null}function p(e,t,n,r,i){if("string"===typeof r||"number"===typeof r)return l(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case w:return e=e.get(null===r.key?n:r.key)||null,r.type===S?h(t,e,r.props.children,i,r.key):u(t,e,r,i);case E:return c(t,e=e.get(null===r.key?n:r.key)||null,r,i)}if(_a(r)||V(r))return h(t,e=e.get(n)||null,r,i,null);xa(t,r)}return null}function m(i,o,s,l){for(var u=null,c=null,h=o,m=o=0,v=null;null!==h&&m<s.length;m++){h.index>m?(v=h,h=null):v=h.sibling;var y=d(i,h,s[m],l);if(null===y){null===h&&(h=v);break}e&&h&&null===y.alternate&&t(i,h),o=a(y,o,m),null===c?u=y:c.sibling=y,c=y,h=v}if(m===s.length)return n(i,h),u;if(null===h){for(;m<s.length;m++)null!==(h=f(i,s[m],l))&&(o=a(h,o,m),null===c?u=h:c.sibling=h,c=h);return u}for(h=r(i,h);m<s.length;m++)null!==(v=p(h,i,m,s[m],l))&&(e&&null!==v.alternate&&h.delete(null===v.key?m:v.key),o=a(v,o,m),null===c?u=v:c.sibling=v,c=v);return e&&h.forEach((function(e){return t(i,e)})),u}function v(i,s,l,u){var c=V(l);if("function"!==typeof c)throw Error(o(150));if(null==(l=c.call(l)))throw Error(o(151));for(var h=c=null,m=s,v=s=0,y=null,g=l.next();null!==m&&!g.done;v++,g=l.next()){m.index>v?(y=m,m=null):y=m.sibling;var _=d(i,m,g.value,u);if(null===_){null===m&&(m=y);break}e&&m&&null===_.alternate&&t(i,m),s=a(_,s,v),null===h?c=_:h.sibling=_,h=_,m=y}if(g.done)return n(i,m),c;if(null===m){for(;!g.done;v++,g=l.next())null!==(g=f(i,g.value,u))&&(s=a(g,s,v),null===h?c=g:h.sibling=g,h=g);return c}for(m=r(i,m);!g.done;v++,g=l.next())null!==(g=p(m,i,v,g.value,u))&&(e&&null!==g.alternate&&m.delete(null===g.key?v:g.key),s=a(g,s,v),null===h?c=g:h.sibling=g,h=g);return e&&m.forEach((function(e){return t(i,e)})),c}return function(e,r,a,l){var u="object"===typeof a&&null!==a&&a.type===S&&null===a.key;u&&(a=a.props.children);var c="object"===typeof a&&null!==a;if(c)switch(a.$$typeof){case w:e:{for(c=a.key,u=r;null!==u;){if(u.key===c){switch(u.tag){case 7:if(a.type===S){n(e,u.sibling),(r=i(u,a.props.children)).return=e,e=r;break e}break;default:if(u.elementType===a.type){n(e,u.sibling),(r=i(u,a.props)).ref=ba(e,u,a),r.return=e,e=r;break e}}n(e,u);break}t(e,u),u=u.sibling}a.type===S?((r=Wl(a.props.children,e.mode,l,a.key)).return=e,e=r):((l=Gl(a.type,a.key,a.props,null,e.mode,l)).ref=ba(e,r,a),l.return=e,e=l)}return s(e);case E:e:{for(u=a.key;null!==r;){if(r.key===u){if(4===r.tag&&r.stateNode.containerInfo===a.containerInfo&&r.stateNode.implementation===a.implementation){n(e,r.sibling),(r=i(r,a.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=Zl(a,e.mode,l)).return=e,e=r}return s(e)}if("string"===typeof a||"number"===typeof a)return a=""+a,null!==r&&6===r.tag?(n(e,r.sibling),(r=i(r,a)).return=e,e=r):(n(e,r),(r=Xl(a,e.mode,l)).return=e,e=r),s(e);if(_a(a))return m(e,r,a,l);if(V(a))return v(e,r,a,l);if(c&&xa(e,a),"undefined"===typeof a&&!u)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(o(152,X(e.type)||"Component"))}return n(e,r)}}var Ea=wa(!0),Sa=wa(!1),Ta={},ka=oi(Ta),Ma=oi(Ta),Ca=oi(Ta);function Aa(e){if(e===Ta)throw Error(o(174));return e}function Ia(e,t){switch(li(Ca,t),li(Ma,e),li(ka,Ta),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:pe(null,"");break;default:t=pe(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}si(ka),li(ka,t)}function Pa(){si(ka),si(Ma),si(Ca)}function Ra(e){Aa(Ca.current);var t=Aa(ka.current),n=pe(t,e.type);t!==n&&(li(Ma,e),li(ka,n))}function La(e){Ma.current===e&&(si(ka),si(Ma))}var Oa=oi(0);function Da(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Na=null,za=null,Fa=!1;function Ba(e,t){var n=jl(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Ua(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function ja(e){if(Fa){var t=za;if(t){var n=t;if(!Ua(e,t)){if(!(t=Wr(n.nextSibling))||!Ua(e,t))return e.flags=-1025&e.flags|2,Fa=!1,void(Na=e);Ba(Na,n)}Na=e,za=Wr(t.firstChild)}else e.flags=-1025&e.flags|2,Fa=!1,Na=e}}function Va(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Na=e}function Ha(e){if(e!==Na)return!1;if(!Fa)return Va(e),Fa=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!jr(t,e.memoizedProps))for(t=za;t;)Ba(e,t),t=Wr(t.nextSibling);if(Va(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){za=Wr(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}za=null}}else za=Na?Wr(e.stateNode.nextSibling):null;return!0}function Ga(){za=Na=null,Fa=!1}var Wa=[];function qa(){for(var e=0;e<Wa.length;e++)Wa[e]._workInProgressVersionPrimary=null;Wa.length=0}var Xa=x.ReactCurrentDispatcher,Za=x.ReactCurrentBatchConfig,Ka=0,Ya=null,Ja=null,Qa=null,$a=!1,eo=!1;function to(){throw Error(o(321))}function no(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function ro(e,t,n,r,i,a){if(Ka=a,Ya=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Xa.current=null===e||null===e.memoizedState?Io:Po,e=n(r,i),eo){a=0;do{if(eo=!1,!(25>a))throw Error(o(301));a+=1,Qa=Ja=null,t.updateQueue=null,Xa.current=Ro,e=n(r,i)}while(eo)}if(Xa.current=Ao,t=null!==Ja&&null!==Ja.next,Ka=0,Qa=Ja=Ya=null,$a=!1,t)throw Error(o(300));return e}function io(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Qa?Ya.memoizedState=Qa=e:Qa=Qa.next=e,Qa}function ao(){if(null===Ja){var e=Ya.alternate;e=null!==e?e.memoizedState:null}else e=Ja.next;var t=null===Qa?Ya.memoizedState:Qa.next;if(null!==t)Qa=t,Ja=e;else{if(null===e)throw Error(o(310));e={memoizedState:(Ja=e).memoizedState,baseState:Ja.baseState,baseQueue:Ja.baseQueue,queue:Ja.queue,next:null},null===Qa?Ya.memoizedState=Qa=e:Qa=Qa.next=e}return Qa}function oo(e,t){return"function"===typeof t?t(e):t}function so(e){var t=ao(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=Ja,i=r.baseQueue,a=n.pending;if(null!==a){if(null!==i){var s=i.next;i.next=a.next,a.next=s}r.baseQueue=i=a,n.pending=null}if(null!==i){i=i.next,r=r.baseState;var l=s=a=null,u=i;do{var c=u.lane;if((Ka&c)===c)null!==l&&(l=l.next={lane:0,action:u.action,eagerReducer:u.eagerReducer,eagerState:u.eagerState,next:null}),r=u.eagerReducer===e?u.eagerState:e(r,u.action);else{var h={lane:c,action:u.action,eagerReducer:u.eagerReducer,eagerState:u.eagerState,next:null};null===l?(s=l=h,a=r):l=l.next=h,Ya.lanes|=c,Fs|=c}u=u.next}while(null!==u&&u!==i);null===l?a=r:l.next=s,sr(r,t.memoizedState)||(Oo=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=l,n.lastRenderedState=r}return[t.memoizedState,n.dispatch]}function lo(e){var t=ao(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{a=e(a,s.action),s=s.next}while(s!==i);sr(a,t.memoizedState)||(Oo=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function uo(e,t,n){var r=t._getVersion;r=r(t._source);var i=t._workInProgressVersionPrimary;if(null!==i?e=i===r:(e=e.mutableReadLanes,(e=(Ka&e)===e)&&(t._workInProgressVersionPrimary=r,Wa.push(t))),e)return n(t._source);throw Wa.push(t),Error(o(350))}function co(e,t,n,r){var i=Is;if(null===i)throw Error(o(349));var a=t._getVersion,s=a(t._source),l=Xa.current,u=l.useState((function(){return uo(i,t,n)})),c=u[1],h=u[0];u=Qa;var f=e.memoizedState,d=f.refs,p=d.getSnapshot,m=f.source;f=f.subscribe;var v=Ya;return e.memoizedState={refs:d,source:t,subscribe:r},l.useEffect((function(){d.getSnapshot=n,d.setSnapshot=c;var e=a(t._source);if(!sr(s,e)){e=n(t._source),sr(h,e)||(c(e),e=cl(v),i.mutableReadLanes|=e&i.pendingLanes),e=i.mutableReadLanes,i.entangledLanes|=e;for(var r=i.entanglements,o=e;0<o;){var l=31-Gt(o),u=1<<l;r[l]|=e,o&=~u}}}),[n,t,r]),l.useEffect((function(){return r(t._source,(function(){var e=d.getSnapshot,n=d.setSnapshot;try{n(e(t._source));var r=cl(v);i.mutableReadLanes|=r&i.pendingLanes}catch(a){n((function(){throw a}))}}))}),[t,r]),sr(p,n)&&sr(m,t)&&sr(f,r)||((e={pending:null,dispatch:null,lastRenderedReducer:oo,lastRenderedState:h}).dispatch=c=Co.bind(null,Ya,e),u.queue=e,u.baseQueue=null,h=uo(i,t,n),u.memoizedState=u.baseState=h),h}function ho(e,t,n){return co(ao(),e,t,n)}function fo(e){var t=io();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:oo,lastRenderedState:e}).dispatch=Co.bind(null,Ya,e),[t.memoizedState,e]}function po(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=Ya.updateQueue)?(t={lastEffect:null},Ya.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function mo(e){return e={current:e},io().memoizedState=e}function vo(){return ao().memoizedState}function yo(e,t,n,r){var i=io();Ya.flags|=e,i.memoizedState=po(1|t,n,void 0,void 0===r?null:r)}function go(e,t,n,r){var i=ao();r=void 0===r?null:r;var a=void 0;if(null!==Ja){var o=Ja.memoizedState;if(a=o.destroy,null!==r&&no(r,o.deps))return void po(t,n,a,r)}Ya.flags|=e,i.memoizedState=po(1|t,n,a,r)}function _o(e,t){return yo(516,4,e,t)}function bo(e,t){return go(516,4,e,t)}function xo(e,t){return go(4,2,e,t)}function wo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Eo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,go(4,2,wo.bind(null,t,e),n)}function So(){}function To(e,t){var n=ao();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&no(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function ko(e,t){var n=ao();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&no(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Mo(e,t){var n=ji();Hi(98>n?98:n,(function(){e(!0)})),Hi(97<n?97:n,(function(){var n=Za.transition;Za.transition=1;try{e(!1),t()}finally{Za.transition=n}}))}function Co(e,t,n){var r=ul(),i=cl(e),a={lane:i,action:n,eagerReducer:null,eagerState:null,next:null},o=t.pending;if(null===o?a.next=a:(a.next=o.next,o.next=a),t.pending=a,o=e.alternate,e===Ya||null!==o&&o===Ya)eo=$a=!0;else{if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var s=t.lastRenderedState,l=o(s,n);if(a.eagerReducer=o,a.eagerState=l,sr(l,s))return}catch(u){}hl(e,i,r)}}var Ao={readContext:ra,useCallback:to,useContext:to,useEffect:to,useImperativeHandle:to,useLayoutEffect:to,useMemo:to,useReducer:to,useRef:to,useState:to,useDebugValue:to,useDeferredValue:to,useTransition:to,useMutableSource:to,useOpaqueIdentifier:to,unstable_isNewReconciler:!1},Io={readContext:ra,useCallback:function(e,t){return io().memoizedState=[e,void 0===t?null:t],e},useContext:ra,useEffect:_o,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,yo(4,2,wo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return yo(4,2,e,t)},useMemo:function(e,t){var n=io();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=io();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Co.bind(null,Ya,e),[r.memoizedState,e]},useRef:mo,useState:fo,useDebugValue:So,useDeferredValue:function(e){var t=fo(e),n=t[0],r=t[1];return _o((function(){var t=Za.transition;Za.transition=1;try{r(e)}finally{Za.transition=t}}),[e]),n},useTransition:function(){var e=fo(!1),t=e[0];return mo(e=Mo.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,n){var r=io();return r.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:n},co(r,e,t,n)},useOpaqueIdentifier:function(){if(Fa){var e=!1,t=function(e){return{$$typeof:D,toString:e,valueOf:e}}((function(){throw e||(e=!0,n("r:"+(Xr++).toString(36))),Error(o(355))})),n=fo(t)[1];return 0===(2&Ya.mode)&&(Ya.flags|=516,po(5,(function(){n("r:"+(Xr++).toString(36))}),void 0,null)),t}return fo(t="r:"+(Xr++).toString(36)),t},unstable_isNewReconciler:!1},Po={readContext:ra,useCallback:To,useContext:ra,useEffect:bo,useImperativeHandle:Eo,useLayoutEffect:xo,useMemo:ko,useReducer:so,useRef:vo,useState:function(){return so(oo)},useDebugValue:So,useDeferredValue:function(e){var t=so(oo),n=t[0],r=t[1];return bo((function(){var t=Za.transition;Za.transition=1;try{r(e)}finally{Za.transition=t}}),[e]),n},useTransition:function(){var e=so(oo)[0];return[vo().current,e]},useMutableSource:ho,useOpaqueIdentifier:function(){return so(oo)[0]},unstable_isNewReconciler:!1},Ro={readContext:ra,useCallback:To,useContext:ra,useEffect:bo,useImperativeHandle:Eo,useLayoutEffect:xo,useMemo:ko,useReducer:lo,useRef:vo,useState:function(){return lo(oo)},useDebugValue:So,useDeferredValue:function(e){var t=lo(oo),n=t[0],r=t[1];return bo((function(){var t=Za.transition;Za.transition=1;try{r(e)}finally{Za.transition=t}}),[e]),n},useTransition:function(){var e=lo(oo)[0];return[vo().current,e]},useMutableSource:ho,useOpaqueIdentifier:function(){return lo(oo)[0]},unstable_isNewReconciler:!1},Lo=x.ReactCurrentOwner,Oo=!1;function Do(e,t,n,r){t.child=null===e?Sa(t,null,n,r):Ea(t,e.child,n,r)}function No(e,t,n,r,i){n=n.render;var a=t.ref;return na(t,i),r=ro(e,t,n,r,a,i),null===e||Oo?(t.flags|=1,Do(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,ns(e,t,i))}function zo(e,t,n,r,i,a){if(null===e){var o=n.type;return"function"!==typeof o||Vl(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Gl(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Fo(e,t,o,r,i,a))}return o=e.child,0===(i&a)&&(i=o.memoizedProps,(n=null!==(n=n.compare)?n:ur)(i,r)&&e.ref===t.ref)?ns(e,t,a):(t.flags|=1,(e=Hl(o,r)).ref=t.ref,e.return=t,t.child=e)}function Fo(e,t,n,r,i,a){if(null!==e&&ur(e.memoizedProps,r)&&e.ref===t.ref){if(Oo=!1,0===(a&i))return t.lanes=e.lanes,ns(e,t,a);0!==(16384&e.flags)&&(Oo=!0)}return jo(e,t,n,r,a)}function Bo(e,t,n){var r=t.pendingProps,i=r.children,a=null!==e?e.memoizedState:null;if("hidden"===r.mode||"unstable-defer-without-hiding"===r.mode)if(0===(4&t.mode))t.memoizedState={baseLanes:0},_l(t,n);else{if(0===(1073741824&n))return e=null!==a?a.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},_l(t,e),null;t.memoizedState={baseLanes:0},_l(t,null!==a?a.baseLanes:n)}else null!==a?(r=a.baseLanes|n,t.memoizedState=null):r=n,_l(t,r);return Do(e,t,i,n),t.child}function Uo(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=128)}function jo(e,t,n,r,i){var a=pi(n)?fi:ci.current;return a=di(t,a),na(t,i),n=ro(e,t,n,r,a,i),null===e||Oo?(t.flags|=1,Do(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~i,ns(e,t,i))}function Vo(e,t,n,r,i){if(pi(n)){var a=!0;gi(t)}else a=!1;if(na(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),va(t,n,r),ga(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var l=o.context,u=n.contextType;"object"===typeof u&&null!==u?u=ra(u):u=di(t,u=pi(n)?fi:ci.current);var c=n.getDerivedStateFromProps,h="function"===typeof c||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||l!==u)&&ya(t,o,r,u),ia=!1;var f=t.memoizedState;o.state=f,ca(t,r,o,i),l=t.memoizedState,s!==r||f!==l||hi.current||ia?("function"===typeof c&&(da(t,n,c,r),l=t.memoizedState),(s=ia||ma(t,n,s,r,f,l,u))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4)):("function"===typeof o.componentDidMount&&(t.flags|=4),t.memoizedProps=r,t.memoizedState=l),o.props=r,o.state=l,o.context=u,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4),r=!1)}else{o=t.stateNode,oa(e,t),s=t.memoizedProps,u=t.type===t.elementType?s:Zi(t.type,s),o.props=u,h=t.pendingProps,f=o.context,"object"===typeof(l=n.contextType)&&null!==l?l=ra(l):l=di(t,l=pi(n)?fi:ci.current);var d=n.getDerivedStateFromProps;(c="function"===typeof d||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||f!==l)&&ya(t,o,r,l),ia=!1,f=t.memoizedState,o.state=f,ca(t,r,o,i);var p=t.memoizedState;s!==h||f!==p||hi.current||ia?("function"===typeof d&&(da(t,n,d,r),p=t.memoizedState),(u=ia||ma(t,n,u,r,f,p,l))?(c||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,l),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,l)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=256),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=l,r=u):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=256),r=!1)}return Ho(e,t,n,r,a,i)}function Ho(e,t,n,r,i,a){Uo(e,t);var o=0!==(64&t.flags);if(!r&&!o)return i&&_i(t,n,!1),ns(e,t,a);r=t.stateNode,Lo.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=Ea(t,e.child,null,a),t.child=Ea(t,null,s,a)):Do(e,t,s,a),t.memoizedState=r.state,i&&_i(t,n,!0),t.child}function Go(e){var t=e.stateNode;t.pendingContext?vi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&vi(0,t.context,!1),Ia(e,t.containerInfo)}var Wo,qo,Xo,Zo={dehydrated:null,retryLane:0};function Ko(e,t,n){var r,i=t.pendingProps,a=Oa.current,o=!1;return(r=0!==(64&t.flags))||(r=(null===e||null!==e.memoizedState)&&0!==(2&a)),r?(o=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===i.fallback||!0===i.unstable_avoidThisFallback||(a|=1),li(Oa,1&a),null===e?(void 0!==i.fallback&&ja(t),e=i.children,a=i.fallback,o?(e=Yo(t,e,a,n),t.child.memoizedState={baseLanes:n},t.memoizedState=Zo,e):"number"===typeof i.unstable_expectedLoadTime?(e=Yo(t,e,a,n),t.child.memoizedState={baseLanes:n},t.memoizedState=Zo,t.lanes=33554432,e):((n=ql({mode:"visible",children:e},t.mode,n,null)).return=t,t.child=n)):(e.memoizedState,o?(i=Qo(e,t,i.children,i.fallback,n),o=t.child,a=e.child.memoizedState,o.memoizedState=null===a?{baseLanes:n}:{baseLanes:a.baseLanes|n},o.childLanes=e.childLanes&~n,t.memoizedState=Zo,i):(n=Jo(e,t,i.children,n),t.memoizedState=null,n))}function Yo(e,t,n,r){var i=e.mode,a=e.child;return t={mode:"hidden",children:t},0===(2&i)&&null!==a?(a.childLanes=0,a.pendingProps=t):a=ql(t,i,0,null),n=Wl(n,i,r,null),a.return=e,n.return=e,a.sibling=n,e.child=a,n}function Jo(e,t,n,r){var i=e.child;return e=i.sibling,n=Hl(i,{mode:"visible",children:n}),0===(2&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=n}function Qo(e,t,n,r,i){var a=t.mode,o=e.child;e=o.sibling;var s={mode:"hidden",children:n};return 0===(2&a)&&t.child!==o?((n=t.child).childLanes=0,n.pendingProps=s,null!==(o=n.lastEffect)?(t.firstEffect=n.firstEffect,t.lastEffect=o,o.nextEffect=null):t.firstEffect=t.lastEffect=null):n=Hl(o,s),null!==e?r=Hl(e,r):(r=Wl(r,a,i,null)).flags|=2,r.return=t,n.return=t,n.sibling=r,t.child=n,r}function $o(e,t){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),ta(e.return,t)}function es(e,t,n,r,i,a){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:i,lastEffect:a}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=i,o.lastEffect=a)}function ts(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(Do(e,t,r.children,n),0!==(2&(r=Oa.current)))r=1&r|2,t.flags|=64;else{if(null!==e&&0!==(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&$o(e,n);else if(19===e.tag)$o(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(li(Oa,r),0===(2&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===Da(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),es(t,!1,i,n,a,t.lastEffect);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Da(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}es(t,!0,n,null,a,t.lastEffect);break;case"together":es(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function ns(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Fs|=t.lanes,0!==(n&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Hl(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Hl(e,e.pendingProps)).return=t;n.sibling=null}return t.child}return null}function rs(e,t){if(!Fa)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function is(e,t,n){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return pi(t.type)&&mi(),null;case 3:return Pa(),si(hi),si(ci),qa(),(r=t.stateNode).pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(Ha(t)?t.flags|=4:r.hydrate||(t.flags|=256)),null;case 5:La(t);var a=Aa(Ca.current);if(n=t.type,null!==e&&null!=t.stateNode)qo(e,t,n,r),e.ref!==t.ref&&(t.flags|=128);else{if(!r){if(null===t.stateNode)throw Error(o(166));return null}if(e=Aa(ka.current),Ha(t)){r=t.stateNode,n=t.type;var s=t.memoizedProps;switch(r[Kr]=t,r[Yr]=s,n){case"dialog":Mr("cancel",r),Mr("close",r);break;case"iframe":case"object":case"embed":Mr("load",r);break;case"video":case"audio":for(e=0;e<Er.length;e++)Mr(Er[e],r);break;case"source":Mr("error",r);break;case"img":case"image":case"link":Mr("error",r),Mr("load",r);break;case"details":Mr("toggle",r);break;case"input":ee(r,s),Mr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Mr("invalid",r);break;case"textarea":le(r,s),Mr("invalid",r)}for(var u in Se(n,s),e=null,s)s.hasOwnProperty(u)&&(a=s[u],"children"===u?"string"===typeof a?r.textContent!==a&&(e=["children",a]):"number"===typeof a&&r.textContent!==""+a&&(e=["children",""+a]):l.hasOwnProperty(u)&&null!=a&&"onScroll"===u&&Mr("scroll",r));switch(n){case"input":Y(r),re(r,s,!0);break;case"textarea":Y(r),ce(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=zr)}r=e,t.updateQueue=r,null!==r&&(t.flags|=4)}else{switch(u=9===a.nodeType?a:a.ownerDocument,e===he&&(e=de(n)),e===he?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[Kr]=t,e[Yr]=r,Wo(e,t),t.stateNode=e,u=Te(n,r),n){case"dialog":Mr("cancel",e),Mr("close",e),a=r;break;case"iframe":case"object":case"embed":Mr("load",e),a=r;break;case"video":case"audio":for(a=0;a<Er.length;a++)Mr(Er[a],e);a=r;break;case"source":Mr("error",e),a=r;break;case"img":case"image":case"link":Mr("error",e),Mr("load",e),a=r;break;case"details":Mr("toggle",e),a=r;break;case"input":ee(e,r),a=$(e,r),Mr("invalid",e);break;case"option":a=ae(e,r);break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=i({},r,{value:void 0}),Mr("invalid",e);break;case"textarea":le(e,r),a=se(e,r),Mr("invalid",e);break;default:a=r}Se(n,a);var c=a;for(s in c)if(c.hasOwnProperty(s)){var h=c[s];"style"===s?we(e,h):"dangerouslySetInnerHTML"===s?null!=(h=h?h.__html:void 0)&&ye(e,h):"children"===s?"string"===typeof h?("textarea"!==n||""!==h)&&ge(e,h):"number"===typeof h&&ge(e,""+h):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(l.hasOwnProperty(s)?null!=h&&"onScroll"===s&&Mr("scroll",e):null!=h&&b(e,s,h,u))}switch(n){case"input":Y(e),re(e,r,!1);break;case"textarea":Y(e),ce(e);break;case"option":null!=r.value&&e.setAttribute("value",""+Z(r.value));break;case"select":e.multiple=!!r.multiple,null!=(s=r.value)?oe(e,!!r.multiple,s,!1):null!=r.defaultValue&&oe(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof a.onClick&&(e.onclick=zr)}Ur(n,r)&&(t.flags|=4)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)Xo(0,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));n=Aa(Ca.current),Aa(ka.current),Ha(t)?(r=t.stateNode,n=t.memoizedProps,r[Kr]=t,r.nodeValue!==n&&(t.flags|=4)):((r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[Kr]=t,t.stateNode=r)}return null;case 13:return si(Oa),r=t.memoizedState,0!==(64&t.flags)?(t.lanes=n,t):(r=null!==r,n=!1,null===e?void 0!==t.memoizedProps.fallback&&Ha(t):n=null!==e.memoizedState,r&&!n&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&Oa.current)?0===Ds&&(Ds=3):(0!==Ds&&3!==Ds||(Ds=4),null===Is||0===(134217727&Fs)&&0===(134217727&Bs)||ml(Is,Rs))),(r||n)&&(t.flags|=4),null);case 4:return Pa(),null===e&&Ar(t.stateNode.containerInfo),null;case 10:return ea(t),null;case 17:return pi(t.type)&&mi(),null;case 19:if(si(Oa),null===(r=t.memoizedState))return null;if(s=0!==(64&t.flags),null===(u=r.rendering))if(s)rs(r,!1);else{if(0!==Ds||null!==e&&0!==(64&e.flags))for(e=t.child;null!==e;){if(null!==(u=Da(e))){for(t.flags|=64,rs(r,!1),null!==(s=u.updateQueue)&&(t.updateQueue=s,t.flags|=4),null===r.lastEffect&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=n,n=t.child;null!==n;)e=r,(s=n).flags&=2,s.nextEffect=null,s.firstEffect=null,s.lastEffect=null,null===(u=s.alternate)?(s.childLanes=0,s.lanes=e,s.child=null,s.memoizedProps=null,s.memoizedState=null,s.updateQueue=null,s.dependencies=null,s.stateNode=null):(s.childLanes=u.childLanes,s.lanes=u.lanes,s.child=u.child,s.memoizedProps=u.memoizedProps,s.memoizedState=u.memoizedState,s.updateQueue=u.updateQueue,s.type=u.type,e=u.dependencies,s.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return li(Oa,1&Oa.current|2),t.child}e=e.sibling}null!==r.tail&&Ui()>Hs&&(t.flags|=64,s=!0,rs(r,!1),t.lanes=33554432)}else{if(!s)if(null!==(e=Da(u))){if(t.flags|=64,s=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),rs(r,!0),null===r.tail&&"hidden"===r.tailMode&&!u.alternate&&!Fa)return null!==(t=t.lastEffect=r.lastEffect)&&(t.nextEffect=null),null}else 2*Ui()-r.renderingStartTime>Hs&&1073741824!==n&&(t.flags|=64,s=!0,rs(r,!1),t.lanes=33554432);r.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=r.last)?n.sibling=u:t.child=u,r.last=u)}return null!==r.tail?(n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=Ui(),n.sibling=null,t=Oa.current,li(Oa,s?1&t|2:1&t),n):null;case 23:case 24:return bl(),null!==e&&null!==e.memoizedState!==(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==r.mode&&(t.flags|=4),null}throw Error(o(156,t.tag))}function as(e){switch(e.tag){case 1:pi(e.type)&&mi();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(Pa(),si(hi),si(ci),qa(),0!==(64&(t=e.flags)))throw Error(o(285));return e.flags=-4097&t|64,e;case 5:return La(e),null;case 13:return si(Oa),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return si(Oa),null;case 4:return Pa(),null;case 10:return ea(e),null;case 23:case 24:return bl(),null;default:return null}}function os(e,t){try{var n="",r=t;do{n+=q(r),r=r.return}while(r);var i=n}catch(a){i="\nError generating stack: "+a.message+"\n"+a.stack}return{value:e,source:t,stack:i}}function ss(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}Wo=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},qo=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,Aa(ka.current);var o,s=null;switch(n){case"input":a=$(e,a),r=$(e,r),s=[];break;case"option":a=ae(e,a),r=ae(e,r),s=[];break;case"select":a=i({},a,{value:void 0}),r=i({},r,{value:void 0}),s=[];break;case"textarea":a=se(e,a),r=se(e,r),s=[];break;default:"function"!==typeof a.onClick&&"function"===typeof r.onClick&&(e.onclick=zr)}for(h in Se(n,r),n=null,a)if(!r.hasOwnProperty(h)&&a.hasOwnProperty(h)&&null!=a[h])if("style"===h){var u=a[h];for(o in u)u.hasOwnProperty(o)&&(n||(n={}),n[o]="")}else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(l.hasOwnProperty(h)?s||(s=[]):(s=s||[]).push(h,null));for(h in r){var c=r[h];if(u=null!=a?a[h]:void 0,r.hasOwnProperty(h)&&c!==u&&(null!=c||null!=u))if("style"===h)if(u){for(o in u)!u.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(n||(n={}),n[o]="");for(o in c)c.hasOwnProperty(o)&&u[o]!==c[o]&&(n||(n={}),n[o]=c[o])}else n||(s||(s=[]),s.push(h,n)),n=c;else"dangerouslySetInnerHTML"===h?(c=c?c.__html:void 0,u=u?u.__html:void 0,null!=c&&u!==c&&(s=s||[]).push(h,c)):"children"===h?"string"!==typeof c&&"number"!==typeof c||(s=s||[]).push(h,""+c):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(l.hasOwnProperty(h)?(null!=c&&"onScroll"===h&&Mr("scroll",e),s||u===c||(s=[])):"object"===typeof c&&null!==c&&c.$$typeof===D?c.toString():(s=s||[]).push(h,c))}n&&(s=s||[]).push("style",n);var h=s;(t.updateQueue=h)&&(t.flags|=4)}},Xo=function(e,t,n,r){n!==r&&(t.flags|=4)};var ls="function"===typeof WeakMap?WeakMap:Map;function us(e,t,n){(n=sa(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Xs||(Xs=!0,Zs=r),ss(0,t)},n}function cs(e,t,n){(n=sa(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return ss(0,t),r(i)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){"function"!==typeof r&&(null===Ks?Ks=new Set([this]):Ks.add(this),ss(0,t));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}var hs="function"===typeof WeakSet?WeakSet:Set;function fs(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(n){zl(e,n)}else t.current=null}function ds(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.flags&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:Zi(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(256&t.flags&&Gr(t.stateNode.containerInfo));case 5:case 6:case 4:case 17:return}throw Error(o(163))}function ps(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3===(3&e.tag)){var r=e.create;e.destroy=r()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=n.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var i=e;r=i.next,0!==(4&(i=i.tag))&&0!==(1&i)&&(Ol(n,e),Ll(n,e)),e=r}while(e!==t)}return;case 1:return e=n.stateNode,4&n.flags&&(null===t?e.componentDidMount():(r=n.elementType===n.type?t.memoizedProps:Zi(n.type,t.memoizedProps),e.componentDidUpdate(r,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=n.updateQueue)&&ha(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}ha(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.flags&&Ur(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&wt(n)))));case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(o(163))}function ms(e,t){for(var n=e;;){if(5===n.tag){var r=n.stateNode;if(t)"function"===typeof(r=r.style).setProperty?r.setProperty("display","none","important"):r.display="none";else{r=n.stateNode;var i=n.memoizedProps.style;i=void 0!==i&&null!==i&&i.hasOwnProperty("display")?i.display:null,r.style.display=xe("display",i)}}else if(6===n.tag)n.stateNode.nodeValue=t?"":n.memoizedProps;else if((23!==n.tag&&24!==n.tag||null===n.memoizedState||n===e)&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===e)break;for(;null===n.sibling;){if(null===n.return||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}}function vs(e,t){if(xi&&"function"===typeof xi.onCommitFiberUnmount)try{xi.onCommitFiberUnmount(bi,t)}catch(a){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var n=e=e.next;do{var r=n,i=r.destroy;if(r=r.tag,void 0!==i)if(0!==(4&r))Ol(t,n);else{r=t;try{i()}catch(a){zl(r,a)}}n=n.next}while(n!==e)}break;case 1:if(fs(t),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(a){zl(t,a)}break;case 5:fs(t);break;case 4:ws(e,t)}}function ys(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function gs(e){return 5===e.tag||3===e.tag||4===e.tag}function _s(e){e:{for(var t=e.return;null!==t;){if(gs(t))break e;t=t.return}throw Error(o(160))}var n=t;switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(o(161))}16&n.flags&&(ge(t,""),n.flags&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||gs(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.flags)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.flags)){n=n.stateNode;break e}}r?bs(e,n,t):xs(e,n,t)}function bs(e,t,n){var r=e.tag,i=5===r||6===r;if(i)e=i?e.stateNode:e.stateNode.instance,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=zr));else if(4!==r&&null!==(e=e.child))for(bs(e,t,n),e=e.sibling;null!==e;)bs(e,t,n),e=e.sibling}function xs(e,t,n){var r=e.tag,i=5===r||6===r;if(i)e=i?e.stateNode:e.stateNode.instance,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(xs(e,t,n),e=e.sibling;null!==e;)xs(e,t,n),e=e.sibling}function ws(e,t){for(var n,r,i=t,a=!1;;){if(!a){a=i.return;e:for(;;){if(null===a)throw Error(o(160));switch(n=a.stateNode,a.tag){case 5:r=!1;break e;case 3:case 4:n=n.containerInfo,r=!0;break e}a=a.return}a=!0}if(5===i.tag||6===i.tag){e:for(var s=e,l=i,u=l;;)if(vs(s,u),null!==u.child&&4!==u.tag)u.child.return=u,u=u.child;else{if(u===l)break e;for(;null===u.sibling;){if(null===u.return||u.return===l)break e;u=u.return}u.sibling.return=u.return,u=u.sibling}r?(s=n,l=i.stateNode,8===s.nodeType?s.parentNode.removeChild(l):s.removeChild(l)):n.removeChild(i.stateNode)}else if(4===i.tag){if(null!==i.child){n=i.stateNode.containerInfo,r=!0,i.child.return=i,i=i.child;continue}}else if(vs(e,i),null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;4===(i=i.return).tag&&(a=!1)}i.sibling.return=i.return,i=i.sibling}}function Es(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var r=n=n.next;do{3===(3&r.tag)&&(e=r.destroy,r.destroy=void 0,void 0!==e&&e()),r=r.next}while(r!==n)}return;case 1:return;case 5:if(null!=(n=t.stateNode)){r=t.memoizedProps;var i=null!==e?e.memoizedProps:r;e=t.type;var a=t.updateQueue;if(t.updateQueue=null,null!==a){for(n[Yr]=r,"input"===e&&"radio"===r.type&&null!=r.name&&te(n,r),Te(e,i),t=Te(e,r),i=0;i<a.length;i+=2){var s=a[i],l=a[i+1];"style"===s?we(n,l):"dangerouslySetInnerHTML"===s?ye(n,l):"children"===s?ge(n,l):b(n,s,l,t)}switch(e){case"input":ne(n,r);break;case"textarea":ue(n,r);break;case"select":e=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(a=r.value)?oe(n,!!r.multiple,a,!1):e!==!!r.multiple&&(null!=r.defaultValue?oe(n,!!r.multiple,r.defaultValue,!0):oe(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(o(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((n=t.stateNode).hydrate&&(n.hydrate=!1,wt(n.containerInfo)));case 12:return;case 13:return null!==t.memoizedState&&(Vs=Ui(),ms(t.child,!0)),void Ss(t);case 19:return void Ss(t);case 17:return;case 23:case 24:return void ms(t,null!==t.memoizedState)}throw Error(o(163))}function Ss(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new hs),t.forEach((function(t){var r=Bl.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function Ts(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&(null!==(t=t.memoizedState)&&null===t.dehydrated)}var ks=Math.ceil,Ms=x.ReactCurrentDispatcher,Cs=x.ReactCurrentOwner,As=0,Is=null,Ps=null,Rs=0,Ls=0,Os=oi(0),Ds=0,Ns=null,zs=0,Fs=0,Bs=0,Us=0,js=null,Vs=0,Hs=1/0;function Gs(){Hs=Ui()+500}var Ws,qs=null,Xs=!1,Zs=null,Ks=null,Ys=!1,Js=null,Qs=90,$s=[],el=[],tl=null,nl=0,rl=null,il=-1,al=0,ol=0,sl=null,ll=!1;function ul(){return 0!==(48&As)?Ui():-1!==il?il:il=Ui()}function cl(e){if(0===(2&(e=e.mode)))return 1;if(0===(4&e))return 99===ji()?1:2;if(0===al&&(al=zs),0!==Xi.transition){0!==ol&&(ol=null!==js?js.pendingLanes:0),e=al;var t=4186112&~ol;return 0===(t&=-t)&&(0===(t=(e=4186112&~e)&-e)&&(t=8192)),t}return e=ji(),0!==(4&As)&&98===e?e=Ut(12,al):e=Ut(e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),al),e}function hl(e,t,n){if(50<nl)throw nl=0,rl=null,Error(o(185));if(null===(e=fl(e,t)))return null;Ht(e,t,n),e===Is&&(Bs|=t,4===Ds&&ml(e,Rs));var r=ji();1===t?0!==(8&As)&&0===(48&As)?vl(e):(dl(e,n),0===As&&(Gs(),Wi())):(0===(4&As)||98!==r&&99!==r||(null===tl?tl=new Set([e]):tl.add(e)),dl(e,n)),js=e}function fl(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function dl(e,t){for(var n=e.callbackNode,r=e.suspendedLanes,i=e.pingedLanes,a=e.expirationTimes,s=e.pendingLanes;0<s;){var l=31-Gt(s),u=1<<l,c=a[l];if(-1===c){if(0===(u&r)||0!==(u&i)){c=t,zt(u);var h=Nt;a[l]=10<=h?c+250:6<=h?c+5e3:-1}}else c<=t&&(e.expiredLanes|=u);s&=~u}if(r=Ft(e,e===Is?Rs:0),t=Nt,0===r)null!==n&&(n!==Oi&&Si(n),e.callbackNode=null,e.callbackPriority=0);else{if(null!==n){if(e.callbackPriority===t)return;n!==Oi&&Si(n)}15===t?(n=vl.bind(null,e),null===Ni?(Ni=[n],zi=Ei(Ai,qi)):Ni.push(n),n=Oi):14===t?n=Gi(99,vl.bind(null,e)):n=Gi(n=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(o(358,e))}}(t),pl.bind(null,e)),e.callbackPriority=t,e.callbackNode=n}}function pl(e){if(il=-1,ol=al=0,0!==(48&As))throw Error(o(327));var t=e.callbackNode;if(Rl()&&e.callbackNode!==t)return null;var n=Ft(e,e===Is?Rs:0);if(0===n)return null;var r=n,i=As;As|=16;var a=El();for(Is===e&&Rs===r||(Gs(),xl(e,r));;)try{kl();break}catch(l){wl(e,l)}if($i(),Ms.current=a,As=i,null!==Ps?r=0:(Is=null,Rs=0,r=Ds),0!==(zs&Bs))xl(e,0);else if(0!==r){if(2===r&&(As|=64,e.hydrate&&(e.hydrate=!1,Gr(e.containerInfo)),0!==(n=Bt(e))&&(r=Sl(e,n))),1===r)throw t=Ns,xl(e,0),ml(e,n),dl(e,Ui()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=n,r){case 0:case 1:throw Error(o(345));case 2:Al(e);break;case 3:if(ml(e,n),(62914560&n)===n&&10<(r=Vs+500-Ui())){if(0!==Ft(e,0))break;if(((i=e.suspendedLanes)&n)!==n){ul(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=Vr(Al.bind(null,e),r);break}Al(e);break;case 4:if(ml(e,n),(4186112&n)===n)break;for(r=e.eventTimes,i=-1;0<n;){var s=31-Gt(n);a=1<<s,(s=r[s])>i&&(i=s),n&=~a}if(n=i,10<(n=(120>(n=Ui()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*ks(n/1960))-n)){e.timeoutHandle=Vr(Al.bind(null,e),n);break}Al(e);break;case 5:Al(e);break;default:throw Error(o(329))}}return dl(e,Ui()),e.callbackNode===t?pl.bind(null,e):null}function ml(e,t){for(t&=~Us,t&=~Bs,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Gt(t),r=1<<n;e[n]=-1,t&=~r}}function vl(e){if(0!==(48&As))throw Error(o(327));if(Rl(),e===Is&&0!==(e.expiredLanes&Rs)){var t=Rs,n=Sl(e,t);0!==(zs&Bs)&&(n=Sl(e,t=Ft(e,t)))}else n=Sl(e,t=Ft(e,0));if(0!==e.tag&&2===n&&(As|=64,e.hydrate&&(e.hydrate=!1,Gr(e.containerInfo)),0!==(t=Bt(e))&&(n=Sl(e,t))),1===n)throw n=Ns,xl(e,0),ml(e,t),dl(e,Ui()),n;return e.finishedWork=e.current.alternate,e.finishedLanes=t,Al(e),dl(e,Ui()),null}function yl(e,t){var n=As;As|=1;try{return e(t)}finally{0===(As=n)&&(Gs(),Wi())}}function gl(e,t){var n=As;As&=-2,As|=8;try{return e(t)}finally{0===(As=n)&&(Gs(),Wi())}}function _l(e,t){li(Os,Ls),Ls|=t,zs|=t}function bl(){Ls=Os.current,si(Os)}function xl(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,Hr(n)),null!==Ps)for(n=Ps.return;null!==n;){var r=n;switch(r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&mi();break;case 3:Pa(),si(hi),si(ci),qa();break;case 5:La(r);break;case 4:Pa();break;case 13:case 19:si(Oa);break;case 10:ea(r);break;case 23:case 24:bl()}n=n.return}Is=e,Ps=Hl(e.current,null),Rs=Ls=zs=t,Ds=0,Ns=null,Us=Bs=Fs=0}function wl(e,t){for(;;){var n=Ps;try{if($i(),Xa.current=Ao,$a){for(var r=Ya.memoizedState;null!==r;){var i=r.queue;null!==i&&(i.pending=null),r=r.next}$a=!1}if(Ka=0,Qa=Ja=Ya=null,eo=!1,Cs.current=null,null===n||null===n.return){Ds=1,Ns=t,Ps=null;break}e:{var a=e,o=n.return,s=n,l=t;if(t=Rs,s.flags|=2048,s.firstEffect=s.lastEffect=null,null!==l&&"object"===typeof l&&"function"===typeof l.then){var u=l;if(0===(2&s.mode)){var c=s.alternate;c?(s.updateQueue=c.updateQueue,s.memoizedState=c.memoizedState,s.lanes=c.lanes):(s.updateQueue=null,s.memoizedState=null)}var h=0!==(1&Oa.current),f=o;do{var d;if(d=13===f.tag){var p=f.memoizedState;if(null!==p)d=null!==p.dehydrated;else{var m=f.memoizedProps;d=void 0!==m.fallback&&(!0!==m.unstable_avoidThisFallback||!h)}}if(d){var v=f.updateQueue;if(null===v){var y=new Set;y.add(u),f.updateQueue=y}else v.add(u);if(0===(2&f.mode)){if(f.flags|=64,s.flags|=16384,s.flags&=-2981,1===s.tag)if(null===s.alternate)s.tag=17;else{var g=sa(-1,1);g.tag=2,la(s,g)}s.lanes|=1;break e}l=void 0,s=t;var _=a.pingCache;if(null===_?(_=a.pingCache=new ls,l=new Set,_.set(u,l)):void 0===(l=_.get(u))&&(l=new Set,_.set(u,l)),!l.has(s)){l.add(s);var b=Fl.bind(null,a,u,s);u.then(b,b)}f.flags|=4096,f.lanes=t;break e}f=f.return}while(null!==f);l=Error((X(s.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==Ds&&(Ds=2),l=os(l,s),f=o;do{switch(f.tag){case 3:a=l,f.flags|=4096,t&=-t,f.lanes|=t,ua(f,us(0,a,t));break e;case 1:a=l;var x=f.type,w=f.stateNode;if(0===(64&f.flags)&&("function"===typeof x.getDerivedStateFromError||null!==w&&"function"===typeof w.componentDidCatch&&(null===Ks||!Ks.has(w)))){f.flags|=4096,t&=-t,f.lanes|=t,ua(f,cs(f,a,t));break e}}f=f.return}while(null!==f)}Cl(n)}catch(E){t=E,Ps===n&&null!==n&&(Ps=n=n.return);continue}break}}function El(){var e=Ms.current;return Ms.current=Ao,null===e?Ao:e}function Sl(e,t){var n=As;As|=16;var r=El();for(Is===e&&Rs===t||xl(e,t);;)try{Tl();break}catch(i){wl(e,i)}if($i(),As=n,Ms.current=r,null!==Ps)throw Error(o(261));return Is=null,Rs=0,Ds}function Tl(){for(;null!==Ps;)Ml(Ps)}function kl(){for(;null!==Ps&&!Ti();)Ml(Ps)}function Ml(e){var t=Ws(e.alternate,e,Ls);e.memoizedProps=e.pendingProps,null===t?Cl(e):Ps=t,Cs.current=null}function Cl(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(2048&t.flags)){if(null!==(n=is(n,t,Ls)))return void(Ps=n);if(24!==(n=t).tag&&23!==n.tag||null===n.memoizedState||0!==(1073741824&Ls)||0===(4&n.mode)){for(var r=0,i=n.child;null!==i;)r|=i.lanes|i.childLanes,i=i.sibling;n.childLanes=r}null!==e&&0===(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(n=as(t)))return n.flags&=2047,void(Ps=n);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(Ps=t);Ps=t=e}while(null!==t);0===Ds&&(Ds=5)}function Al(e){var t=ji();return Hi(99,Il.bind(null,e,t)),null}function Il(e,t){do{Rl()}while(null!==Js);if(0!==(48&As))throw Error(o(327));var n=e.finishedWork;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(o(177));e.callbackNode=null;var r=n.lanes|n.childLanes,i=r,a=e.pendingLanes&~i;e.pendingLanes=i,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=i,e.mutableReadLanes&=i,e.entangledLanes&=i,i=e.entanglements;for(var s=e.eventTimes,l=e.expirationTimes;0<a;){var u=31-Gt(a),c=1<<u;i[u]=0,s[u]=-1,l[u]=-1,a&=~c}if(null!==tl&&0===(24&r)&&tl.has(e)&&tl.delete(e),e===Is&&(Ps=Is=null,Rs=0),1<n.flags?null!==n.lastEffect?(n.lastEffect.nextEffect=n,r=n.firstEffect):r=n:r=n.firstEffect,null!==r){if(i=As,As|=32,Cs.current=null,Fr=Kt,pr(s=dr())){if("selectionStart"in s)l={start:s.selectionStart,end:s.selectionEnd};else e:if(l=(l=s.ownerDocument)&&l.defaultView||window,(c=l.getSelection&&l.getSelection())&&0!==c.rangeCount){l=c.anchorNode,a=c.anchorOffset,u=c.focusNode,c=c.focusOffset;try{l.nodeType,u.nodeType}catch(k){l=null;break e}var h=0,f=-1,d=-1,p=0,m=0,v=s,y=null;t:for(;;){for(var g;v!==l||0!==a&&3!==v.nodeType||(f=h+a),v!==u||0!==c&&3!==v.nodeType||(d=h+c),3===v.nodeType&&(h+=v.nodeValue.length),null!==(g=v.firstChild);)y=v,v=g;for(;;){if(v===s)break t;if(y===l&&++p===a&&(f=h),y===u&&++m===c&&(d=h),null!==(g=v.nextSibling))break;y=(v=y).parentNode}v=g}l=-1===f||-1===d?null:{start:f,end:d}}else l=null;l=l||{start:0,end:0}}else l=null;Br={focusedElem:s,selectionRange:l},Kt=!1,sl=null,ll=!1,qs=r;do{try{Pl()}catch(k){if(null===qs)throw Error(o(330));zl(qs,k),qs=qs.nextEffect}}while(null!==qs);sl=null,qs=r;do{try{for(s=e;null!==qs;){var _=qs.flags;if(16&_&&ge(qs.stateNode,""),128&_){var b=qs.alternate;if(null!==b){var x=b.ref;null!==x&&("function"===typeof x?x(null):x.current=null)}}switch(1038&_){case 2:_s(qs),qs.flags&=-3;break;case 6:_s(qs),qs.flags&=-3,Es(qs.alternate,qs);break;case 1024:qs.flags&=-1025;break;case 1028:qs.flags&=-1025,Es(qs.alternate,qs);break;case 4:Es(qs.alternate,qs);break;case 8:ws(s,l=qs);var w=l.alternate;ys(l),null!==w&&ys(w)}qs=qs.nextEffect}}catch(k){if(null===qs)throw Error(o(330));zl(qs,k),qs=qs.nextEffect}}while(null!==qs);if(x=Br,b=dr(),_=x.focusedElem,s=x.selectionRange,b!==_&&_&&_.ownerDocument&&fr(_.ownerDocument.documentElement,_)){null!==s&&pr(_)&&(b=s.start,void 0===(x=s.end)&&(x=b),"selectionStart"in _?(_.selectionStart=b,_.selectionEnd=Math.min(x,_.value.length)):(x=(b=_.ownerDocument||document)&&b.defaultView||window).getSelection&&(x=x.getSelection(),l=_.textContent.length,w=Math.min(s.start,l),s=void 0===s.end?w:Math.min(s.end,l),!x.extend&&w>s&&(l=s,s=w,w=l),l=hr(_,w),a=hr(_,s),l&&a&&(1!==x.rangeCount||x.anchorNode!==l.node||x.anchorOffset!==l.offset||x.focusNode!==a.node||x.focusOffset!==a.offset)&&((b=b.createRange()).setStart(l.node,l.offset),x.removeAllRanges(),w>s?(x.addRange(b),x.extend(a.node,a.offset)):(b.setEnd(a.node,a.offset),x.addRange(b))))),b=[];for(x=_;x=x.parentNode;)1===x.nodeType&&b.push({element:x,left:x.scrollLeft,top:x.scrollTop});for("function"===typeof _.focus&&_.focus(),_=0;_<b.length;_++)(x=b[_]).element.scrollLeft=x.left,x.element.scrollTop=x.top}Kt=!!Fr,Br=Fr=null,e.current=n,qs=r;do{try{for(_=e;null!==qs;){var E=qs.flags;if(36&E&&ps(_,qs.alternate,qs),128&E){b=void 0;var S=qs.ref;if(null!==S){var T=qs.stateNode;switch(qs.tag){case 5:b=T;break;default:b=T}"function"===typeof S?S(b):S.current=b}}qs=qs.nextEffect}}catch(k){if(null===qs)throw Error(o(330));zl(qs,k),qs=qs.nextEffect}}while(null!==qs);qs=null,Di(),As=i}else e.current=n;if(Ys)Ys=!1,Js=e,Qs=t;else for(qs=r;null!==qs;)t=qs.nextEffect,qs.nextEffect=null,8&qs.flags&&((E=qs).sibling=null,E.stateNode=null),qs=t;if(0===(r=e.pendingLanes)&&(Ks=null),1===r?e===rl?nl++:(nl=0,rl=e):nl=0,n=n.stateNode,xi&&"function"===typeof xi.onCommitFiberRoot)try{xi.onCommitFiberRoot(bi,n,void 0,64===(64&n.current.flags))}catch(k){}if(dl(e,Ui()),Xs)throw Xs=!1,e=Zs,Zs=null,e;return 0!==(8&As)||Wi(),null}function Pl(){for(;null!==qs;){var e=qs.alternate;ll||null===sl||(0!==(8&qs.flags)?et(qs,sl)&&(ll=!0):13===qs.tag&&Ts(e,qs)&&et(qs,sl)&&(ll=!0));var t=qs.flags;0!==(256&t)&&ds(e,qs),0===(512&t)||Ys||(Ys=!0,Gi(97,(function(){return Rl(),null}))),qs=qs.nextEffect}}function Rl(){if(90!==Qs){var e=97<Qs?97:Qs;return Qs=90,Hi(e,Dl)}return!1}function Ll(e,t){$s.push(t,e),Ys||(Ys=!0,Gi(97,(function(){return Rl(),null})))}function Ol(e,t){el.push(t,e),Ys||(Ys=!0,Gi(97,(function(){return Rl(),null})))}function Dl(){if(null===Js)return!1;var e=Js;if(Js=null,0!==(48&As))throw Error(o(331));var t=As;As|=32;var n=el;el=[];for(var r=0;r<n.length;r+=2){var i=n[r],a=n[r+1],s=i.destroy;if(i.destroy=void 0,"function"===typeof s)try{s()}catch(u){if(null===a)throw Error(o(330));zl(a,u)}}for(n=$s,$s=[],r=0;r<n.length;r+=2){i=n[r],a=n[r+1];try{var l=i.create;i.destroy=l()}catch(u){if(null===a)throw Error(o(330));zl(a,u)}}for(l=e.current.firstEffect;null!==l;)e=l.nextEffect,l.nextEffect=null,8&l.flags&&(l.sibling=null,l.stateNode=null),l=e;return As=t,Wi(),!0}function Nl(e,t,n){la(e,t=us(0,t=os(n,t),1)),t=ul(),null!==(e=fl(e,1))&&(Ht(e,1,t),dl(e,t))}function zl(e,t){if(3===e.tag)Nl(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){Nl(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"===typeof n.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Ks||!Ks.has(r))){var i=cs(n,e=os(t,e),1);if(la(n,i),i=ul(),null!==(n=fl(n,1)))Ht(n,1,i),dl(n,i);else if("function"===typeof r.componentDidCatch&&(null===Ks||!Ks.has(r)))try{r.componentDidCatch(t,e)}catch(a){}break}}n=n.return}}function Fl(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ul(),e.pingedLanes|=e.suspendedLanes&n,Is===e&&(Rs&n)===n&&(4===Ds||3===Ds&&(62914560&Rs)===Rs&&500>Ui()-Vs?xl(e,0):Us|=n),dl(e,t)}function Bl(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(0===(2&(t=e.mode))?t=1:0===(4&t)?t=99===ji()?1:2:(0===al&&(al=zs),0===(t=jt(62914560&~al))&&(t=4194304))),n=ul(),null!==(e=fl(e,t))&&(Ht(e,t,n),dl(e,n))}function Ul(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function jl(e,t,n,r){return new Ul(e,t,n,r)}function Vl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Hl(e,t){var n=e.alternate;return null===n?((n=jl(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Gl(e,t,n,r,i,a){var s=2;if(r=e,"function"===typeof e)Vl(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case S:return Wl(n.children,i,a,t);case N:s=8,i|=16;break;case T:s=8,i|=1;break;case k:return(e=jl(12,n,t,8|i)).elementType=k,e.type=k,e.lanes=a,e;case I:return(e=jl(13,n,t,i)).type=I,e.elementType=I,e.lanes=a,e;case P:return(e=jl(19,n,t,i)).elementType=P,e.lanes=a,e;case z:return ql(n,i,a,t);case F:return(e=jl(24,n,t,i)).elementType=F,e.lanes=a,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case M:s=10;break e;case C:s=9;break e;case A:s=11;break e;case R:s=14;break e;case L:s=16,r=null;break e;case O:s=22;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=jl(s,n,t,i)).elementType=e,t.type=r,t.lanes=a,t}function Wl(e,t,n,r){return(e=jl(7,e,r,t)).lanes=n,e}function ql(e,t,n,r){return(e=jl(23,e,r,t)).elementType=z,e.lanes=n,e}function Xl(e,t,n){return(e=jl(6,e,null,t)).lanes=n,e}function Zl(e,t,n){return(t=jl(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Kl(e,t,n){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=Vt(0),this.expirationTimes=Vt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Vt(0),this.mutableSourceEagerHydrationData=null}function Yl(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:E,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function Jl(e,t,n,r){var i=t.current,a=ul(),s=cl(i);e:if(n){t:{if(Ye(n=n._reactInternals)!==n||1!==n.tag)throw Error(o(170));var l=n;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(pi(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(null!==l);throw Error(o(171))}if(1===n.tag){var u=n.type;if(pi(u)){n=yi(n,u,l);break e}}n=l}else n=ui;return null===t.context?t.context=n:t.pendingContext=n,(t=sa(a,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),la(i,t),hl(i,s,a),s}function Ql(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function $l(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function eu(e,t){$l(e,t),(e=e.alternate)&&$l(e,t)}function tu(e,t,n){var r=null!=n&&null!=n.hydrationOptions&&n.hydrationOptions.mutableSources||null;if(n=new Kl(e,t,null!=n&&!0===n.hydrate),t=jl(3,null,null,2===t?7:1===t?3:0),n.current=t,t.stateNode=n,aa(t),e[Jr]=n.current,Ar(8===e.nodeType?e.parentNode:e),r)for(e=0;e<r.length;e++){var i=(t=r[e])._getVersion;i=i(t._source),null==n.mutableSourceEagerHydrationData?n.mutableSourceEagerHydrationData=[t,i]:n.mutableSourceEagerHydrationData.push(t,i)}this._internalRoot=n}function nu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function ru(e,t,n,r,i){var a=n._reactRootContainer;if(a){var o=a._internalRoot;if("function"===typeof i){var s=i;i=function(){var e=Ql(o);s.call(e)}}Jl(t,o,e,i)}else{if(a=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new tu(e,0,t?{hydrate:!0}:void 0)}(n,r),o=a._internalRoot,"function"===typeof i){var l=i;i=function(){var e=Ql(o);l.call(e)}}gl((function(){Jl(t,o,e,i)}))}return Ql(o)}function iu(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!nu(t))throw Error(o(200));return Yl(e,t,null,n)}Ws=function(e,t,n){var r=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||hi.current)Oo=!0;else{if(0===(n&r)){switch(Oo=!1,t.tag){case 3:Go(t),Ga();break;case 5:Ra(t);break;case 1:pi(t.type)&&gi(t);break;case 4:Ia(t,t.stateNode.containerInfo);break;case 10:r=t.memoizedProps.value;var i=t.type._context;li(Ki,i._currentValue),i._currentValue=r;break;case 13:if(null!==t.memoizedState)return 0!==(n&t.child.childLanes)?Ko(e,t,n):(li(Oa,1&Oa.current),null!==(t=ns(e,t,n))?t.sibling:null);li(Oa,1&Oa.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(64&e.flags)){if(r)return ts(e,t,n);t.flags|=64}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),li(Oa,Oa.current),r)break;return null;case 23:case 24:return t.lanes=0,Bo(e,t,n)}return ns(e,t,n)}Oo=0!==(16384&e.flags)}else Oo=!1;switch(t.lanes=0,t.tag){case 2:if(r=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=di(t,ci.current),na(t,n),i=ro(null,t,r,e,i,n),t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,pi(r)){var a=!0;gi(t)}else a=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,aa(t);var s=r.getDerivedStateFromProps;"function"===typeof s&&da(t,r,s,e),i.updater=pa,t.stateNode=i,i._reactInternals=t,ga(t,r,e,n),t=Ho(null,t,r,!0,a,n)}else t.tag=0,Do(null,t,i,n),t=t.child;return t;case 16:i=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,i=(a=i._init)(i._payload),t.type=i,a=t.tag=function(e){if("function"===typeof e)return Vl(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===A)return 11;if(e===R)return 14}return 2}(i),e=Zi(i,e),a){case 0:t=jo(null,t,i,e,n);break e;case 1:t=Vo(null,t,i,e,n);break e;case 11:t=No(null,t,i,e,n);break e;case 14:t=zo(null,t,i,Zi(i.type,e),r,n);break e}throw Error(o(306,i,""))}return t;case 0:return r=t.type,i=t.pendingProps,jo(e,t,r,i=t.elementType===r?i:Zi(r,i),n);case 1:return r=t.type,i=t.pendingProps,Vo(e,t,r,i=t.elementType===r?i:Zi(r,i),n);case 3:if(Go(t),r=t.updateQueue,null===e||null===r)throw Error(o(282));if(r=t.pendingProps,i=null!==(i=t.memoizedState)?i.element:null,oa(e,t),ca(t,r,null,n),(r=t.memoizedState.element)===i)Ga(),t=ns(e,t,n);else{if((a=(i=t.stateNode).hydrate)&&(za=Wr(t.stateNode.containerInfo.firstChild),Na=t,a=Fa=!0),a){if(null!=(e=i.mutableSourceEagerHydrationData))for(i=0;i<e.length;i+=2)(a=e[i])._workInProgressVersionPrimary=e[i+1],Wa.push(a);for(n=Sa(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|1024,n=n.sibling}else Do(e,t,r,n),Ga();t=t.child}return t;case 5:return Ra(t),null===e&&ja(t),r=t.type,i=t.pendingProps,a=null!==e?e.memoizedProps:null,s=i.children,jr(r,i)?s=null:null!==a&&jr(r,a)&&(t.flags|=16),Uo(e,t),Do(e,t,s,n),t.child;case 6:return null===e&&ja(t),null;case 13:return Ko(e,t,n);case 4:return Ia(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Ea(t,null,r,n):Do(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,No(e,t,r,i=t.elementType===r?i:Zi(r,i),n);case 7:return Do(e,t,t.pendingProps,n),t.child;case 8:case 12:return Do(e,t,t.pendingProps.children,n),t.child;case 10:e:{r=t.type._context,i=t.pendingProps,s=t.memoizedProps,a=i.value;var l=t.type._context;if(li(Ki,l._currentValue),l._currentValue=a,null!==s)if(l=s.value,0===(a=sr(l,a)?0:0|("function"===typeof r._calculateChangedBits?r._calculateChangedBits(l,a):1073741823))){if(s.children===i.children&&!hi.current){t=ns(e,t,n);break e}}else for(null!==(l=t.child)&&(l.return=t);null!==l;){var u=l.dependencies;if(null!==u){s=l.child;for(var c=u.firstContext;null!==c;){if(c.context===r&&0!==(c.observedBits&a)){1===l.tag&&((c=sa(-1,n&-n)).tag=2,la(l,c)),l.lanes|=n,null!==(c=l.alternate)&&(c.lanes|=n),ta(l.return,n),u.lanes|=n;break}c=c.next}}else s=10===l.tag&&l.type===t.type?null:l.child;if(null!==s)s.return=l;else for(s=l;null!==s;){if(s===t){s=null;break}if(null!==(l=s.sibling)){l.return=s.return,s=l;break}s=s.return}l=s}Do(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=(a=t.pendingProps).children,na(t,n),r=r(i=ra(i,a.unstable_observedBits)),t.flags|=1,Do(e,t,r,n),t.child;case 14:return a=Zi(i=t.type,t.pendingProps),zo(e,t,i,a=Zi(i.type,a),r,n);case 15:return Fo(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Zi(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,pi(r)?(e=!0,gi(t)):e=!1,na(t,n),va(t,r,i),ga(t,r,i,n),Ho(null,t,r,!0,e,n);case 19:return ts(e,t,n);case 23:case 24:return Bo(e,t,n)}throw Error(o(156,t.tag))},tu.prototype.render=function(e){Jl(e,this._internalRoot,null,null)},tu.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;Jl(null,e,null,(function(){t[Jr]=null}))},tt=function(e){13===e.tag&&(hl(e,4,ul()),eu(e,4))},nt=function(e){13===e.tag&&(hl(e,67108864,ul()),eu(e,67108864))},rt=function(e){if(13===e.tag){var t=ul(),n=cl(e);hl(e,n,t),eu(e,n)}},it=function(e,t){return t()},Me=function(e,t,n){switch(t){case"input":if(ne(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=ni(r);if(!i)throw Error(o(90));J(r),ne(r,i)}}}break;case"textarea":ue(e,n);break;case"select":null!=(t=n.value)&&oe(e,!!n.multiple,t,!1)}},Le=yl,Oe=function(e,t,n,r,i){var a=As;As|=4;try{return Hi(98,e.bind(null,t,n,r,i))}finally{0===(As=a)&&(Gs(),Wi())}},De=function(){0===(49&As)&&(function(){if(null!==tl){var e=tl;tl=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,dl(e,Ui())}))}Wi()}(),Rl())},Ne=function(e,t){var n=As;As|=2;try{return e(t)}finally{0===(As=n)&&(Gs(),Wi())}};var au={Events:[ei,ti,ni,Pe,Re,Rl,{current:!1}]},ou={findFiberByHostInstance:$r,bundleType:0,version:"17.0.1",rendererPackageName:"react-dom"},su={bundleType:ou.bundleType,version:ou.version,rendererPackageName:ou.rendererPackageName,rendererConfig:ou.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=$e(e))?null:e.stateNode},findFiberByHostInstance:ou.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var lu=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lu.isDisabled&&lu.supportsFiber)try{bi=lu.inject(su),xi=lu}catch(ve){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=au,t.createPortal=iu,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw Error(o(268,Object.keys(e)))}return e=null===(e=$e(t))?null:e.stateNode},t.flushSync=function(e,t){var n=As;if(0!==(48&n))return e(t);As|=1;try{if(e)return Hi(99,e.bind(null,t))}finally{As=n,Wi()}},t.hydrate=function(e,t,n){if(!nu(t))throw Error(o(200));return ru(null,e,t,!0,n)},t.render=function(e,t,n){if(!nu(t))throw Error(o(200));return ru(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!nu(e))throw Error(o(40));return!!e._reactRootContainer&&(gl((function(){ru(null,null,e,!1,(function(){e._reactRootContainer=null,e[Jr]=null}))})),!0)},t.unstable_batchedUpdates=yl,t.unstable_createPortal=function(e,t){return iu(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!nu(n))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return ru(e,t,n,!1,r)},t.version="17.0.1"},function(e,t,n){"use strict";e.exports=n(66)},function(e,t,n){"use strict";var r,i,a,o;if("object"===typeof performance&&"function"===typeof performance.now){var s=performance;t.unstable_now=function(){return s.now()}}else{var l=Date,u=l.now();t.unstable_now=function(){return l.now()-u}}if("undefined"===typeof window||"function"!==typeof MessageChannel){var c=null,h=null,f=function e(){if(null!==c)try{var n=t.unstable_now();c(!0,n),c=null}catch(r){throw setTimeout(e,0),r}};r=function(e){null!==c?setTimeout(r,0,e):(c=e,setTimeout(f,0))},i=function(e,t){h=setTimeout(e,t)},a=function(){clearTimeout(h)},t.unstable_shouldYield=function(){return!1},o=t.unstable_forceFrameRate=function(){}}else{var d=window.setTimeout,p=window.clearTimeout;if("undefined"!==typeof console){var m=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!==typeof m&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var v=!1,y=null,g=-1,_=5,b=0;t.unstable_shouldYield=function(){return t.unstable_now()>=b},o=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_=0<e?Math.floor(1e3/e):5};var x=new MessageChannel,w=x.port2;x.port1.onmessage=function(){if(null!==y){var e=t.unstable_now();b=e+_;try{y(!0,e)?w.postMessage(null):(v=!1,y=null)}catch(n){throw w.postMessage(null),n}}else v=!1},r=function(e){y=e,v||(v=!0,w.postMessage(null))},i=function(e,n){g=d((function(){e(t.unstable_now())}),n)},a=function(){p(g),g=-1}}function E(e,t){var n=e.length;e.push(t);e:for(;;){var r=n-1>>>1,i=e[r];if(!(void 0!==i&&0<k(i,t)))break e;e[r]=t,e[n]=i,n=r}}function S(e){return void 0===(e=e[0])?null:e}function T(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length;r<i;){var a=2*(r+1)-1,o=e[a],s=a+1,l=e[s];if(void 0!==o&&0>k(o,n))void 0!==l&&0>k(l,o)?(e[r]=l,e[s]=n,r=s):(e[r]=o,e[a]=n,r=a);else{if(!(void 0!==l&&0>k(l,n)))break e;e[r]=l,e[s]=n,r=s}}}return t}return null}function k(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var M=[],C=[],A=1,I=null,P=3,R=!1,L=!1,O=!1;function D(e){for(var t=S(C);null!==t;){if(null===t.callback)T(C);else{if(!(t.startTime<=e))break;T(C),t.sortIndex=t.expirationTime,E(M,t)}t=S(C)}}function N(e){if(O=!1,D(e),!L)if(null!==S(M))L=!0,r(z);else{var t=S(C);null!==t&&i(N,t.startTime-e)}}function z(e,n){L=!1,O&&(O=!1,a()),R=!0;var r=P;try{for(D(n),I=S(M);null!==I&&(!(I.expirationTime>n)||e&&!t.unstable_shouldYield());){var o=I.callback;if("function"===typeof o){I.callback=null,P=I.priorityLevel;var s=o(I.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?I.callback=s:I===S(M)&&T(M),D(n)}else T(M);I=S(M)}if(null!==I)var l=!0;else{var u=S(C);null!==u&&i(N,u.startTime-n),l=!1}return l}finally{I=null,P=r,R=!1}}var F=o;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){L||R||(L=!0,r(z))},t.unstable_getCurrentPriorityLevel=function(){return P},t.unstable_getFirstCallbackNode=function(){return S(M)},t.unstable_next=function(e){switch(P){case 1:case 2:case 3:var t=3;break;default:t=P}var n=P;P=t;try{return e()}finally{P=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=F,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=P;P=e;try{return t()}finally{P=n}},t.unstable_scheduleCallback=function(e,n,o){var s=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?s+o:s:o=s,e){case 1:var l=-1;break;case 2:l=250;break;case 5:l=1073741823;break;case 4:l=1e4;break;default:l=5e3}return e={id:A++,callback:n,priorityLevel:e,startTime:o,expirationTime:l=o+l,sortIndex:-1},o>s?(e.sortIndex=o,E(C,e),null===S(M)&&e===S(C)&&(O?a():O=!0,i(N,o-s))):(e.sortIndex=l,E(M,e),L||R||(L=!0,r(z))),e},t.unstable_wrapCallback=function(e){var t=P;return function(){var n=P;P=t;try{return e.apply(this,arguments)}finally{P=n}}}},,function(e,t,n){var r=function(e){"use strict";var t,n=Object.prototype,r=n.hasOwnProperty,i="function"===typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",o=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(P){l=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var i=t&&t.prototype instanceof v?t:v,a=Object.create(i.prototype),o=new C(r||[]);return a._invoke=function(e,t,n){var r=h;return function(i,a){if(r===d)throw new Error("Generator is already running");if(r===p){if("throw"===i)throw a;return I()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=T(o,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(r===h)throw r=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r=d;var l=c(e,t,n);if("normal"===l.type){if(r=n.done?p:f,l.arg===m)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r=p,n.method="throw",n.arg=l.arg)}}}(e,n,o),a}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(P){return{type:"throw",arg:P}}}e.wrap=u;var h="suspendedStart",f="suspendedYield",d="executing",p="completed",m={};function v(){}function y(){}function g(){}var _={};_[a]=function(){return this};var b=Object.getPrototypeOf,x=b&&b(b(A([])));x&&x!==n&&r.call(x,a)&&(_=x);var w=g.prototype=v.prototype=Object.create(_);function E(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function S(e,t){function n(i,a,o,s){var l=c(e[i],e,a);if("throw"!==l.type){var u=l.arg,h=u.value;return h&&"object"===typeof h&&r.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,o,s)}),(function(e){n("throw",e,o,s)})):t.resolve(h).then((function(e){u.value=e,o(u)}),(function(e){return n("throw",e,o,s)}))}s(l.arg)}var i;this._invoke=function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}}function T(e,n){var r=e.iterator[n.method];if(r===t){if(n.delegate=null,"throw"===n.method){if(e.iterator.return&&(n.method="return",n.arg=t,T(e,n),"throw"===n.method))return m;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var i=c(r,e.iterator,n.arg);if("throw"===i.type)return n.method="throw",n.arg=i.arg,n.delegate=null,m;var a=i.arg;return a?a.done?(n[e.resultName]=a.value,n.next=e.nextLoc,"return"!==n.method&&(n.method="next",n.arg=t),n.delegate=null,m):a:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,m)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function A(e){if(e){var n=e[a];if(n)return n.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var i=-1,o=function n(){for(;++i<e.length;)if(r.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return o.next=o}}return{next:I}}function I(){return{value:t,done:!0}}return y.prototype=w.constructor=g,g.constructor=y,y.displayName=l(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===y||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,g):(e.__proto__=g,l(e,s,"GeneratorFunction")),e.prototype=Object.create(w),e},e.awrap=function(e){return{__await:e}},E(S.prototype),S.prototype[o]=function(){return this},e.AsyncIterator=S,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var o=new S(u(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},E(w),l(w,s,"Generator"),w[a]=function(){return this},w.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=A,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(M),!e)for(var n in this)"t"===n.charAt(0)&&r.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function i(r,i){return s.type="throw",s.arg=e,n.next=r,i&&(n.method="next",n.arg=t),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var l=r.call(o,"catchLoc"),u=r.call(o,"finallyLoc");if(l&&u){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,m):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),M(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;M(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,n,r){return this.delegate={iterator:A(e),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=t),m}},e}(e.exports);try{regeneratorRuntime=r}catch(i){Function("r","regeneratorRuntime = r")(r)}},,function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){var r=n(72);function i(t,n,a){return"undefined"!==typeof Reflect&&Reflect.get?e.exports=i=Reflect.get:e.exports=i=function(e,t,n){var i=r(e,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(n):a.value}},i(t,n,a||t)}e.exports=i},function(e,t,n){var r=n(30);e.exports=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=r(e)););return e}},function(e,t){function n(t){return"function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?e.exports=n=function(e){return typeof e}:e.exports=n=function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(t)}e.exports=n},function(e,t,n){var r=n(45),i=n(46),a=n(31),o=n(48);e.exports=function(e){return r(e)||i(e)||a(e)||o()}},function(e,t,n){var r=n(76),i=n(46),a=n(31),o=n(77);e.exports=function(e){return r(e)||i(e)||a(e)||o()}},function(e,t,n){var r=n(47);e.exports=function(e){if(Array.isArray(e))return r(e)}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}},function(e,t,n){var r=n(45),i=n(79),a=n(31),o=n(48);e.exports=function(e,t){return r(e)||i(e,t)||a(e,t)||o()}},function(e,t){e.exports=function(e,t){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(l){i=!0,a=l}finally{try{r||null==s.return||s.return()}finally{if(i)throw a}}return n}}},function(e,t,n){var r=n(31);e.exports=function(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=r(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,l=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return s=e.done,e},e:function(e){l=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(l)throw o}}}}},function(e,t,n){var r=n(30),i=n(38),a=n(82),o=n(42);function s(t){var n="function"===typeof Map?new Map:void 0;return e.exports=s=function(e){if(null===e||!a(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof n){if(n.has(e))return n.get(e);n.set(e,t)}function t(){return o(e,arguments,r(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),i(t,e)},s(t)}e.exports=s},function(e,t){e.exports=function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}},function(e,t,n){var r=n(38);e.exports=function(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&r(e,t)}},function(e,t,n){var r=n(30),i=n(43),a=n(44);e.exports=function(e){var t=i();return function(){var n,i=r(e);if(t){var o=r(this).constructor;n=Reflect.construct(i,arguments,o)}else n=i.apply(this,arguments);return a(this,n)}}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}},function(e,t,n){},function(e,t,n){"use strict";n(89)},function(e,t,n){"use strict";(function(e,t){var r=n(7),i=n(6),a=n(0),o=n(19),s=n(17),l=function(){function e(e){this.domStorage_=e,this.prefix_="firebase:"}return e.prototype.set=function(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),Object(a.A)(t))},e.prototype.get=function(e){var t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:Object(a.u)(t)},e.prototype.remove=function(e){this.domStorage_.removeItem(this.prefixedName_(e))},e.prototype.prefixedName_=function(e){return this.prefix_+e},e.prototype.toString=function(){return this.domStorage_.toString()},e}(),u=function(){function e(){this.cache_={},this.isInMemoryStorage=!0}return e.prototype.set=function(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t},e.prototype.get=function(e){return Object(a.h)(this.cache_,e)?this.cache_[e]:null},e.prototype.remove=function(e){delete this.cache_[e]},e}(),c=function(e){try{if("undefined"!==typeof window&&"undefined"!==typeof window[e]){var t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new l(t)}}catch(n){}return new u},h=c("localStorage"),f=c("sessionStorage"),d=new o.b("@firebase/database"),p=function(){var e=1;return function(){return e++}}(),m=function(e){var t=Object(a.z)(e),n=new a.c;n.update(t);var r=n.digest();return a.f.encodeByteArray(r)},v=function e(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r="",i=0;i<t.length;i++){var o=t[i];Array.isArray(o)||o&&"object"===typeof o&&"number"===typeof o.length?r+=e.apply(null,o):r+="object"===typeof o?Object(a.A)(o):o,r+=" "}return r},y=null,g=!0,_=function(e,t){Object(a.d)(!t||!0===e||!1===e,"Can't turn on custom loggers persistently."),!0===e?(d.logLevel=o.a.VERBOSE,y=d.log.bind(d),t&&f.set("logging_enabled",!0)):"function"===typeof e?y=e:(y=null,f.remove("logging_enabled"))},b=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(!0===g&&(g=!1,null===y&&!0===f.get("logging_enabled")&&_(!0)),y){var n=v.apply(null,e);y(n)}},x=function(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];b.apply(void 0,Object(i.f)([e],t))}},w=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE INTERNAL ERROR: "+v.apply(void 0,Object(i.f)(e));d.error(n)},E=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE FATAL ERROR: "+v.apply(void 0,Object(i.f)(e));throw d.error(n),new Error(n)},S=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="FIREBASE WARNING: "+v.apply(void 0,Object(i.f)(e));d.warn(n)},T=function(e){return"number"===typeof e&&(e!==e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},k="[MIN_NAME]",M="[MAX_NAME]",C=function(e,t){if(e===t)return 0;if(e===k||t===M)return-1;if(t===k||e===M)return 1;var n=F(e),r=F(t);return null!==n?null!==r?n-r===0?e.length-t.length:n-r:-1:null!==r?1:e<t?-1:1},A=function(e,t){return e===t?0:e<t?-1:1},I=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+Object(a.A)(t))},P=function e(t){if("object"!==typeof t||null===t)return Object(a.A)(t);var n=[];for(var r in t)n.push(r);n.sort();for(var i="{",o=0;o<n.length;o++)0!==o&&(i+=","),i+=Object(a.A)(n[o]),i+=":",i+=e(t[n[o]]);return i+="}"},R=function(e,t){var n=e.length;if(n<=t)return[e];for(var r=[],i=0;i<n;i+=t)i+t>n?r.push(e.substring(i,n)):r.push(e.substring(i,i+t));return r};function L(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}var O=function(e){Object(a.d)(!T(e),"Invalid JSON number");var t,n,r,i,o,s=1023;0===e?(n=0,r=0,t=1/e===-1/0?1:0):(t=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(n=(i=Math.min(Math.floor(Math.log(e)/Math.LN2),s))+s,r=Math.round(e*Math.pow(2,52-i)-Math.pow(2,52))):(n=0,r=Math.round(e/Math.pow(2,-1074))));var l=[];for(o=52;o;o-=1)l.push(r%2?1:0),r=Math.floor(r/2);for(o=11;o;o-=1)l.push(n%2?1:0),n=Math.floor(n/2);l.push(t?1:0),l.reverse();var u=l.join(""),c="";for(o=0;o<64;o+=8){var h=parseInt(u.substr(o,8),2).toString(16);1===h.length&&(h="0"+h),c+=h}return c.toLowerCase()},D=new RegExp("^-?(0*)\\d{1,10}$"),N=-2147483648,z=2147483647,F=function(e){if(D.test(e)){var t=Number(e);if(t>=N&&t<=z)return t}return null},B=function(e){try{e()}catch(t){setTimeout((function(){var e=t.stack||"";throw S("Exception was thrown by user callback.",e),t}),Math.floor(0))}},U=function(e,t){var n=setTimeout(e,t);return"object"===typeof n&&n.unref&&n.unref(),n},j=function(){function e(e,t){if(void 0===t){this.pieces_=e.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}return Object.defineProperty(e,"Empty",{get:function(){return new e("")},enumerable:!1,configurable:!0}),e.prototype.getFront=function(){return this.pieceNum_>=this.pieces_.length?null:this.pieces_[this.pieceNum_]},e.prototype.getLength=function(){return this.pieces_.length-this.pieceNum_},e.prototype.popFront=function(){var t=this.pieceNum_;return t<this.pieces_.length&&t++,new e(this.pieces_,t)},e.prototype.getBack=function(){return this.pieceNum_<this.pieces_.length?this.pieces_[this.pieces_.length-1]:null},e.prototype.toString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"},e.prototype.toUrlEncodedString=function(){for(var e="",t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+encodeURIComponent(String(this.pieces_[t])));return e||"/"},e.prototype.slice=function(e){return void 0===e&&(e=0),this.pieces_.slice(this.pieceNum_+e)},e.prototype.parent=function(){if(this.pieceNum_>=this.pieces_.length)return null;for(var t=[],n=this.pieceNum_;n<this.pieces_.length-1;n++)t.push(this.pieces_[n]);return new e(t,0)},e.prototype.child=function(t){for(var n=[],r=this.pieceNum_;r<this.pieces_.length;r++)n.push(this.pieces_[r]);if(t instanceof e)for(r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);else{var i=t.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new e(n,0)},e.prototype.isEmpty=function(){return this.pieceNum_>=this.pieces_.length},e.relativePath=function(t,n){var r=t.getFront(),i=n.getFront();if(null===r)return n;if(r===i)return e.relativePath(t.popFront(),n.popFront());throw new Error("INTERNAL ERROR: innerPath ("+n+") is not within outerPath ("+t+")")},e.comparePaths=function(e,t){for(var n=e.slice(),r=t.slice(),i=0;i<n.length&&i<r.length;i++){var a=C(n[i],r[i]);if(0!==a)return a}return n.length===r.length?0:n.length<r.length?-1:1},e.prototype.equals=function(e){if(this.getLength()!==e.getLength())return!1;for(var t=this.pieceNum_,n=e.pieceNum_;t<=this.pieces_.length;t++,n++)if(this.pieces_[t]!==e.pieces_[n])return!1;return!0},e.prototype.contains=function(e){var t=this.pieceNum_,n=e.pieceNum_;if(this.getLength()>e.getLength())return!1;for(;t<this.pieces_.length;){if(this.pieces_[t]!==e.pieces_[n])return!1;++t,++n}return!0},e}(),V=function(){function e(e,t){this.errorPrefix_=t,this.parts_=e.slice(),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Object(a.y)(this.parts_[n]);this.checkValid_()}return Object.defineProperty(e,"MAX_PATH_DEPTH",{get:function(){return 32},enumerable:!1,configurable:!0}),Object.defineProperty(e,"MAX_PATH_LENGTH_BYTES",{get:function(){return 768},enumerable:!1,configurable:!0}),e.prototype.push=function(e){this.parts_.length>0&&(this.byteLength_+=1),this.parts_.push(e),this.byteLength_+=Object(a.y)(e),this.checkValid_()},e.prototype.pop=function(){var e=this.parts_.pop();this.byteLength_-=Object(a.y)(e),this.parts_.length>0&&(this.byteLength_-=1)},e.prototype.checkValid_=function(){if(this.byteLength_>e.MAX_PATH_LENGTH_BYTES)throw new Error(this.errorPrefix_+"has a key path longer than "+e.MAX_PATH_LENGTH_BYTES+" bytes ("+this.byteLength_+").");if(this.parts_.length>e.MAX_PATH_DEPTH)throw new Error(this.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+e.MAX_PATH_DEPTH+") or object contains a cycle "+this.toErrorString())},e.prototype.toErrorString=function(){return 0===this.parts_.length?"":"in property '"+this.parts_.join(".")+"'"},e}(),H="5",G=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,W="websocket",q="long_polling",X=function(){function e(e,t,n,r,i,a,o){void 0===i&&(i=!1),void 0===a&&(a=""),void 0===o&&(o=!1),this.secure=t,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=a,this.includeNamespaceInQueryParams=o,this.host=e.toLowerCase(),this.domain=this.host.substr(this.host.indexOf(".")+1),this.internalHost=h.get("host:"+e)||this.host}return e.prototype.needsQueryParam=function(){return this.host!==this.internalHost||this.isCustomHost()||this.includeNamespaceInQueryParams},e.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},e.prototype.isDemoHost=function(){return"firebaseio-demo.com"===this.domain},e.prototype.isCustomHost=function(){return"firebaseio.com"!==this.domain&&"firebaseio-demo.com"!==this.domain},e.prototype.updateHost=function(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&h.set("host:"+this.host,this.internalHost))},e.prototype.connectionURL=function(e,t){var n;if(Object(a.d)("string"===typeof e,"typeof type must == string"),Object(a.d)("object"===typeof t,"typeof params must == object"),e===W)n=(this.secure?"wss://":"ws://")+this.internalHost+"/.ws?";else{if(e!==q)throw new Error("Unknown connection type: "+e);n=(this.secure?"https://":"http://")+this.internalHost+"/.lp?"}this.needsQueryParam()&&(t.ns=this.namespace);var r=[];return L(t,(function(e,t){r.push(e+"="+t)})),n+r.join("&")},e.prototype.toString=function(){var e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e},e.prototype.toURLString=function(){var e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?"?ns="+this.namespace:"";return""+e+this.host+"/"+t},e}();var Z,K,Y=function(e,t){var n=J(e),r=n.namespace;"firebase.com"===n.domain&&E(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||E("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!==typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&S("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");var i="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new X(n.host,n.secure,r,t,i,"",r!==n.subdomain),path:new j(n.pathString)}},J=function(e){var t="",n="",r="",a="",o="",s=!0,l="https",u=443;if("string"===typeof e){var c=e.indexOf("//");c>=0&&(l=e.substring(0,c-1),e=e.substring(c+2));var h=e.indexOf("/");-1===h&&(h=e.length);var f=e.indexOf("?");-1===f&&(f=e.length),t=e.substring(0,Math.min(h,f)),h<f&&(a=function(e){for(var t="",n=e.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(a){}t+="/"+i}return t}(e.substring(h,f)));var d=function(e){var t,n,r={};"?"===e.charAt(0)&&(e=e.substring(1));try{for(var a=Object(i.g)(e.split("&")),o=a.next();!o.done;o=a.next()){var s=o.value;if(0!==s.length){var l=s.split("=");2===l.length?r[decodeURIComponent(l[0])]=decodeURIComponent(l[1]):S("Invalid query segment '"+s+"' in query '"+e+"'")}}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return r}(e.substring(Math.min(e.length,f)));(c=t.indexOf(":"))>=0?(s="https"===l||"wss"===l,u=parseInt(t.substring(c+1),10)):c=t.length;var p=t.slice(0,c);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{var m=t.indexOf(".");r=t.substring(0,m).toLowerCase(),n=t.substring(m+1),o=r}"ns"in d&&(o=d.ns)}return{host:t,port:u,domain:n,subdomain:r,secure:s,scheme:l,pathString:a,namespace:o}},Q=/[\[\].#$\/\u0000-\u001F\u007F]/,$=/[\[\].#$\u0000-\u001F\u007F]/,ee=10485760,te=function(e){return"string"===typeof e&&0!==e.length&&!Q.test(e)},ne=function(e){return"string"===typeof e&&0!==e.length&&!$.test(e)},re=function(e){return null===e||"string"===typeof e||"number"===typeof e&&!T(e)||e&&"object"===typeof e&&Object(a.h)(e,".sv")},ie=function(e,t,n,r,i){i&&void 0===n||ae(Object(a.l)(e,t,i),n,r)},ae=function e(t,n,r){var i=r instanceof j?new V(r,t):r;if(void 0===n)throw new Error(t+"contains undefined "+i.toErrorString());if("function"===typeof n)throw new Error(t+"contains a function "+i.toErrorString()+" with contents = "+n.toString());if(T(n))throw new Error(t+"contains "+n.toString()+" "+i.toErrorString());if("string"===typeof n&&n.length>ee/3&&Object(a.y)(n)>ee)throw new Error(t+"contains a string greater than "+"10485760 utf8 bytes "+i.toErrorString()+" ('"+n.substring(0,50)+"...')");if(n&&"object"===typeof n){var o=!1,s=!1;if(L(n,(function(n,r){if(".value"===n)o=!0;else if(".priority"!==n&&".sv"!==n&&(s=!0,!te(n)))throw new Error(t+" contains an invalid key ("+n+") "+i.toErrorString()+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');i.push(n),e(t,r,i),i.pop()})),o&&s)throw new Error(t+' contains ".value" child '+i.toErrorString()+" in addition to actual children.")}},oe=function(e,t,n,r,i){if(!i||void 0!==n){var o=Object(a.l)(e,t,i);if(!n||"object"!==typeof n||Array.isArray(n))throw new Error(o+" must be an object containing the children to replace.");var s=[];L(n,(function(e,t){var n=new j(e);if(ae(o,t,r.child(n)),".priority"===n.getBack()&&!re(t))throw new Error(o+"contains an invalid value for '"+n.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(n)})),function(e,t){var n,r;for(n=0;n<t.length;n++)for(var i=(r=t[n]).slice(),a=0;a<i.length;a++)if(".priority"===i[a]&&a===i.length-1);else if(!te(i[a]))throw new Error(e+"contains an invalid key ("+i[a]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');t.sort(j.comparePaths);var o=null;for(n=0;n<t.length;n++){if(r=t[n],null!==o&&o.contains(r))throw new Error(e+"contains a path "+o.toString()+" that is ancestor of another path "+r.toString());o=r}}(o,s)}},se=function(e,t,n,r){if(!r||void 0!==n){if(T(n))throw new Error(Object(a.l)(e,t,r)+"is "+n.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!re(n))throw new Error(Object(a.l)(e,t,r)+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},le=function(e,t,n,r){if(!r||void 0!==n)switch(n){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Object(a.l)(e,t,r)+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},ue=function(e,t,n,r){if((!r||void 0!==n)&&!te(n))throw new Error(Object(a.l)(e,t,r)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},ce=function(e,t,n,r){if((!r||void 0!==n)&&!ne(n))throw new Error(Object(a.l)(e,t,r)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},he=function(e,t,n,r){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),ce(e,t,n,r)},fe=function(e,t){if(".info"===t.getFront())throw new Error(e+" failed = Can't modify data under /.info/")},de=function(e,t,n){var r=n.path.toString();if("string"!==typeof n.repoInfo.host||0===n.repoInfo.host.length||!te(n.repoInfo.namespace)&&"localhost"!==n.repoInfo.host.split(":")[0]||0!==r.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),ne(e)}(r))throw new Error(Object(a.l)(e,t,!1)+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},pe=function(e,t,n,r){if((!r||void 0!==n)&&"boolean"!==typeof n)throw new Error(Object(a.l)(e,t,r)+"must be a boolean.")},me=function(){function e(e,t){this.repo_=e,this.path_=t}return e.prototype.cancel=function(e){Object(a.B)("OnDisconnect.cancel",0,1,arguments.length),Object(a.C)("OnDisconnect.cancel",1,e,!0);var t=new a.a;return this.repo_.onDisconnectCancel(this.path_,t.wrapCallback(e)),t.promise},e.prototype.remove=function(e){Object(a.B)("OnDisconnect.remove",0,1,arguments.length),fe("OnDisconnect.remove",this.path_),Object(a.C)("OnDisconnect.remove",1,e,!0);var t=new a.a;return this.repo_.onDisconnectSet(this.path_,null,t.wrapCallback(e)),t.promise},e.prototype.set=function(e,t){Object(a.B)("OnDisconnect.set",1,2,arguments.length),fe("OnDisconnect.set",this.path_),ie("OnDisconnect.set",1,e,this.path_,!1),Object(a.C)("OnDisconnect.set",2,t,!0);var n=new a.a;return this.repo_.onDisconnectSet(this.path_,e,n.wrapCallback(t)),n.promise},e.prototype.setWithPriority=function(e,t,n){Object(a.B)("OnDisconnect.setWithPriority",2,3,arguments.length),fe("OnDisconnect.setWithPriority",this.path_),ie("OnDisconnect.setWithPriority",1,e,this.path_,!1),se("OnDisconnect.setWithPriority",2,t,!1),Object(a.C)("OnDisconnect.setWithPriority",3,n,!0);var r=new a.a;return this.repo_.onDisconnectSetWithPriority(this.path_,e,t,r.wrapCallback(n)),r.promise},e.prototype.update=function(e,t){if(Object(a.B)("OnDisconnect.update",1,2,arguments.length),fe("OnDisconnect.update",this.path_),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,S("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}oe("OnDisconnect.update",1,e,this.path_,!1),Object(a.C)("OnDisconnect.update",2,t,!0);var i=new a.a;return this.repo_.onDisconnectUpdate(this.path_,e,i.wrapCallback(t)),i.promise},e}(),ve=function(){function e(e,t){this.committed=e,this.snapshot=t}return e.prototype.toJSON=function(){return Object(a.B)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},e}(),ye="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",ge=function(){var e=0,t=[];return function(n){var r,i=n===e;e=n;var o=new Array(8);for(r=7;r>=0;r--)o[r]=ye.charAt(n%64),n=Math.floor(n/64);Object(a.d)(0===n,"Cannot push at time == 0");var s=o.join("");if(i){for(r=11;r>=0&&63===t[r];r--)t[r]=0;t[r]++}else for(r=0;r<12;r++)t[r]=Math.floor(64*Math.random());for(r=0;r<12;r++)s+=ye.charAt(t[r]);return Object(a.d)(20===s.length,"nextPushId: Length should be 20."),s}}(),_e=function(){function e(e,t){this.name=e,this.node=t}return e.Wrap=function(t,n){return new e(t,n)},e}(),be=function(){function e(){}return e.prototype.getCompare=function(){return this.compare.bind(this)},e.prototype.indexedValueChanged=function(e,t){var n=new _e(k,e),r=new _e(k,t);return 0!==this.compare(n,r)},e.prototype.minPost=function(){return _e.MIN},e}(),xe=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.c)(t,e),Object.defineProperty(t,"__EMPTY_NODE",{get:function(){return Z},set:function(e){Z=e},enumerable:!1,configurable:!0}),t.prototype.compare=function(e,t){return C(e.name,t.name)},t.prototype.isDefinedOn=function(e){throw Object(a.e)("KeyIndex.isDefinedOn not expected to be called.")},t.prototype.indexedValueChanged=function(e,t){return!1},t.prototype.minPost=function(){return _e.MIN},t.prototype.maxPost=function(){return new _e(M,Z)},t.prototype.makePost=function(e,t){return Object(a.d)("string"===typeof e,"KeyIndex indexValue must always be a string."),new _e(e,Z)},t.prototype.toString=function(){return".key"},t}(be),we=new xe;var Ee,Se,Te,ke=function(e){return"number"===typeof e?"number:"+O(e):"string:"+e},Me=function(e){if(e.isLeafNode()){var t=e.val();Object(a.d)("string"===typeof t||"number"===typeof t||"object"===typeof t&&Object(a.h)(t,".sv"),"Priority must be a string or number.")}else Object(a.d)(e===K||e.isEmpty(),"priority of unexpected type.");Object(a.d)(e===K||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Ce=function(){function e(t,n){void 0===n&&(n=e.__childrenNodeConstructor.EMPTY_NODE),this.value_=t,this.priorityNode_=n,this.lazyHash_=null,Object(a.d)(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Me(this.priorityNode_)}return Object.defineProperty(e,"__childrenNodeConstructor",{get:function(){return Ee},set:function(e){Ee=e},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!0},e.prototype.getPriority=function(){return this.priorityNode_},e.prototype.updatePriority=function(t){return new e(this.value_,t)},e.prototype.getImmediateChild=function(t){return".priority"===t?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.getChild=function(t){return t.isEmpty()?this:".priority"===t.getFront()?this.priorityNode_:e.__childrenNodeConstructor.EMPTY_NODE},e.prototype.hasChild=function(){return!1},e.prototype.getPredecessorChildName=function(e,t){return null},e.prototype.updateImmediateChild=function(t,n){return".priority"===t?this.updatePriority(n):n.isEmpty()&&".priority"!==t?this:e.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,n).updatePriority(this.priorityNode_)},e.prototype.updateChild=function(t,n){var r=t.getFront();return null===r?n:n.isEmpty()&&".priority"!==r?this:(Object(a.d)(".priority"!==r||1===t.getLength(),".priority must be the last token in a path"),this.updateImmediateChild(r,e.__childrenNodeConstructor.EMPTY_NODE.updateChild(t.popFront(),n)))},e.prototype.isEmpty=function(){return!1},e.prototype.numChildren=function(){return 0},e.prototype.forEachChild=function(e,t){return!1},e.prototype.val=function(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.priorityNode_.isEmpty()||(e+="priority:"+ke(this.priorityNode_.val())+":");var t=typeof this.value_;e+=t+":",e+="number"===t?O(this.value_):this.value_,this.lazyHash_=m(e)}return this.lazyHash_},e.prototype.getValue=function(){return this.value_},e.prototype.compareTo=function(t){return t===e.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof e.__childrenNodeConstructor?-1:(Object(a.d)(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))},e.prototype.compareToLeafNode_=function(t){var n=typeof t.value_,r=typeof this.value_,i=e.VALUE_TYPE_ORDER.indexOf(n),o=e.VALUE_TYPE_ORDER.indexOf(r);return Object(a.d)(i>=0,"Unknown leaf type: "+n),Object(a.d)(o>=0,"Unknown leaf type: "+r),i===o?"object"===r?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-i},e.prototype.withIndex=function(){return this},e.prototype.isIndexed=function(){return!0},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode()){var t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1},e.VALUE_TYPE_ORDER=["object","boolean","number","string"],e}();var Ae,Ie,Pe=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.c)(t,e),t.prototype.compare=function(e,t){var n=e.node.getPriority(),r=t.node.getPriority(),i=n.compareTo(r);return 0===i?C(e.name,t.name):i},t.prototype.isDefinedOn=function(e){return!e.getPriority().isEmpty()},t.prototype.indexedValueChanged=function(e,t){return!e.getPriority().equals(t.getPriority())},t.prototype.minPost=function(){return _e.MIN},t.prototype.maxPost=function(){return new _e(M,new Ce("[PRIORITY-POST]",Te))},t.prototype.makePost=function(e,t){var n=Se(e);return new _e(t,new Ce("[PRIORITY-POST]",n))},t.prototype.toString=function(){return".priority"},t}(be)),Re=function(){function e(e,t,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var a=1;!e.isEmpty();)if(e=e,a=t?n(e.key,t):1,r&&(a*=-1),a<0)e=this.isReverse_?e.left:e.right;else{if(0===a){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}return e.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e},e.prototype.hasNext=function(){return this.nodeStack_.length>0},e.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}},e}(),Le=function(){function e(t,n,r,i,a){this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:De.EMPTY_NODE,this.right=null!=a?a:De.EMPTY_NODE}return e.prototype.copy=function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)},e.prototype.count=function(){return this.left.count()+1+this.right.count()},e.prototype.isEmpty=function(){return!1},e.prototype.inorderTraversal=function(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)},e.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},e.prototype.minKey=function(){return this.min_().key},e.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},e.prototype.insert=function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp_()},e.prototype.removeMin_=function(){if(this.left.isEmpty())return De.EMPTY_NODE;var e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),(e=e.copy(null,null,null,e.left.removeMin_(),null)).fixUp_()},e.prototype.remove=function(e,t){var n,r;if(t(e,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return De.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()},e.prototype.isRed_=function(){return this.color},e.prototype.fixUp_=function(){var e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e},e.prototype.moveRedLeft_=function(){var e=this.colorFlip_();return e.right.left.isRed_()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight_())).rotateLeft_()).colorFlip_()),e},e.prototype.moveRedRight_=function(){var e=this.colorFlip_();return e.left.left.isRed_()&&(e=(e=e.rotateRight_()).colorFlip_()),e},e.prototype.rotateLeft_=function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)},e.prototype.rotateRight_=function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)},e.prototype.colorFlip_=function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)},e.prototype.checkMaxDepth_=function(){var e=this.check_();return Math.pow(2,e)<=this.count()+1},e.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)},e.RED=!0,e.BLACK=!1,e}(),Oe=function(){function e(){}return e.prototype.copy=function(e,t,n,r,i){return this},e.prototype.insert=function(e,t,n){return new Le(e,t,null)},e.prototype.remove=function(e,t){return this},e.prototype.count=function(){return 0},e.prototype.isEmpty=function(){return!0},e.prototype.inorderTraversal=function(e){return!1},e.prototype.reverseTraversal=function(e){return!1},e.prototype.minKey=function(){return null},e.prototype.maxKey=function(){return null},e.prototype.check_=function(){return 0},e.prototype.isRed_=function(){return!1},e}(),De=function(){function e(t,n){void 0===n&&(n=e.EMPTY_NODE),this.comparator_=t,this.root_=n}return e.prototype.insert=function(t,n){return new e(this.comparator_,this.root_.insert(t,n,this.comparator_).copy(null,null,Le.BLACK,null,null))},e.prototype.remove=function(t){return new e(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,Le.BLACK,null,null))},e.prototype.get=function(e){for(var t,n=this.root_;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key)))return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null},e.prototype.getPredecessorKey=function(e){for(var t,n=this.root_,r=null;!n.isEmpty();){if(0===(t=this.comparator_(e,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},e.prototype.isEmpty=function(){return this.root_.isEmpty()},e.prototype.count=function(){return this.root_.count()},e.prototype.minKey=function(){return this.root_.minKey()},e.prototype.maxKey=function(){return this.root_.maxKey()},e.prototype.inorderTraversal=function(e){return this.root_.inorderTraversal(e)},e.prototype.reverseTraversal=function(e){return this.root_.reverseTraversal(e)},e.prototype.getIterator=function(e){return new Re(this.root_,null,this.comparator_,!1,e)},e.prototype.getIteratorFrom=function(e,t){return new Re(this.root_,e,this.comparator_,!1,t)},e.prototype.getReverseIteratorFrom=function(e,t){return new Re(this.root_,e,this.comparator_,!0,t)},e.prototype.getReverseIterator=function(e){return new Re(this.root_,null,this.comparator_,!0,e)},e.EMPTY_NODE=new Oe,e}(),Ne=Math.log(2),ze=function(){function e(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Ne,10)),this.current_=this.count-1;var n,r=(n=this.count,parseInt(Array(n+1).join("1"),2));this.bits_=e+1&r}return e.prototype.nextBitIsOne=function(){var e=!(this.bits_&1<<this.current_);return this.current_--,e},e}(),Fe=function(e,t,n,r){e.sort(t);var i=function t(r,i){var a,o,s=i-r;if(0===s)return null;if(1===s)return a=e[r],o=n?n(a):a,new Le(o,a.node,Le.BLACK,null,null);var l=parseInt(s/2,10)+r,u=t(r,l),c=t(l+1,i);return a=e[l],o=n?n(a):a,new Le(o,a.node,Le.BLACK,u,c)},a=function(t){for(var r=null,a=null,o=e.length,s=function(t,r){var a=o-t,s=o;o-=t;var u=i(a+1,s),c=e[a],h=n?n(c):c;l(new Le(h,c.node,r,null,u))},l=function(e){r?(r.left=e,r=e):(a=e,r=e)},u=0;u<t.count;++u){var c=t.nextBitIsOne(),h=Math.pow(2,t.count-(u+1));c?s(h,Le.BLACK):(s(h,Le.BLACK),s(h,Le.RED))}return a}(new ze(e.length));return new De(r||t,a)},Be={},Ue=function(){function e(e,t){this.indexes_=e,this.indexSet_=t}return Object.defineProperty(e,"Default",{get:function(){return Object(a.d)(Be&&Pe,"ChildrenNode.ts has not been loaded"),Ae=Ae||new e({".priority":Be},{".priority":Pe})},enumerable:!1,configurable:!0}),e.prototype.get=function(e){var t=Object(a.x)(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof De?t:null},e.prototype.hasIndex=function(e){return Object(a.h)(this.indexSet_,e.toString())},e.prototype.addIndex=function(t,n){Object(a.d)(t!==we,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,o=[],s=!1,l=n.getIterator(_e.Wrap),u=l.getNext();u;)s=s||t.isDefinedOn(u.node),o.push(u),u=l.getNext();r=s?Fe(o,t.getCompare()):Be;var c=t.toString(),h=Object(i.a)({},this.indexSet_);h[c]=t;var f=Object(i.a)({},this.indexes_);return f[c]=r,new e(f,h)},e.prototype.addToIndexes=function(t,n){var r=this;return new e(Object(a.v)(this.indexes_,(function(e,i){var o=Object(a.x)(r.indexSet_,i);if(Object(a.d)(o,"Missing index implementation for "+i),e===Be){if(o.isDefinedOn(t.node)){for(var s=[],l=n.getIterator(_e.Wrap),u=l.getNext();u;)u.name!==t.name&&s.push(u),u=l.getNext();return s.push(t),Fe(s,o.getCompare())}return Be}var c=n.get(t.name),h=e;return c&&(h=h.remove(new _e(t.name,c))),h.insert(t,t.node)})),this.indexSet_)},e.prototype.removeFromIndexes=function(t,n){return new e(Object(a.v)(this.indexes_,(function(e){if(e===Be)return e;var r=n.get(t.name);return r?e.remove(new _e(t.name,r)):e})),this.indexSet_)},e}();function je(e,t){return C(e.name,t.name)}function Ve(e,t){return C(e,t)}var He=function(){function e(e,t,n){this.children_=e,this.priorityNode_=t,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Me(this.priorityNode_),this.children_.isEmpty()&&Object(a.d)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(e,"EMPTY_NODE",{get:function(){return Ie||(Ie=new e(new De(Ve),null,Ue.Default))},enumerable:!1,configurable:!0}),e.prototype.isLeafNode=function(){return!1},e.prototype.getPriority=function(){return this.priorityNode_||Ie},e.prototype.updatePriority=function(t){return this.children_.isEmpty()?this:new e(this.children_,t,this.indexMap_)},e.prototype.getImmediateChild=function(e){if(".priority"===e)return this.getPriority();var t=this.children_.get(e);return null===t?Ie:t},e.prototype.getChild=function(e){var t=e.getFront();return null===t?this:this.getImmediateChild(t).getChild(e.popFront())},e.prototype.hasChild=function(e){return null!==this.children_.get(e)},e.prototype.updateImmediateChild=function(t,n){if(Object(a.d)(n,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(n);var r=new _e(t,n),i=void 0,o=void 0;n.isEmpty()?(i=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(r,this.children_)):(i=this.children_.insert(t,n),o=this.indexMap_.addToIndexes(r,this.children_));var s=i.isEmpty()?Ie:this.priorityNode_;return new e(i,s,o)},e.prototype.updateChild=function(e,t){var n=e.getFront();if(null===n)return t;Object(a.d)(".priority"!==e.getFront()||1===e.getLength(),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(e.popFront(),t);return this.updateImmediateChild(n,r)},e.prototype.isEmpty=function(){return this.children_.isEmpty()},e.prototype.numChildren=function(){return this.children_.count()},e.prototype.val=function(t){if(this.isEmpty())return null;var n={},r=0,i=0,a=!0;if(this.forEachChild(Pe,(function(o,s){n[o]=s.val(t),r++,a&&e.INTEGER_REGEXP_.test(o)?i=Math.max(i,Number(o)):a=!1})),!t&&a&&i<2*r){var o=[];for(var s in n)o[s]=n[s];return o}return t&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},e.prototype.hash=function(){if(null===this.lazyHash_){var e="";this.getPriority().isEmpty()||(e+="priority:"+ke(this.getPriority().val())+":"),this.forEachChild(Pe,(function(t,n){var r=n.hash();""!==r&&(e+=":"+t+":"+r)})),this.lazyHash_=""===e?"":m(e)}return this.lazyHash_},e.prototype.getPredecessorChildName=function(e,t,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new _e(e,t));return i?i.name:null}return this.children_.getPredecessorKey(e)},e.prototype.getFirstChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.minKey();return n&&n.name}return this.children_.minKey()},e.prototype.getFirstChild=function(e){var t=this.getFirstChildName(e);return t?new _e(t,this.children_.get(t)):null},e.prototype.getLastChildName=function(e){var t=this.resolveIndex_(e);if(t){var n=t.maxKey();return n&&n.name}return this.children_.maxKey()},e.prototype.getLastChild=function(e){var t=this.getLastChildName(e);return t?new _e(t,this.children_.get(t)):null},e.prototype.forEachChild=function(e,t){var n=this.resolveIndex_(e);return n?n.inorderTraversal((function(e){return t(e.name,e.node)})):this.children_.inorderTraversal(t)},e.prototype.getIterator=function(e){return this.getIteratorFrom(e.minPost(),e)},e.prototype.getIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getIteratorFrom(e.name,_e.Wrap),i=r.peek();null!=i&&t.compare(i,e)<0;)r.getNext(),i=r.peek();return r},e.prototype.getReverseIterator=function(e){return this.getReverseIteratorFrom(e.maxPost(),e)},e.prototype.getReverseIteratorFrom=function(e,t){var n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(function(e){return e}));for(var r=this.children_.getReverseIteratorFrom(e.name,_e.Wrap),i=r.peek();null!=i&&t.compare(i,e)>0;)r.getNext(),i=r.peek();return r},e.prototype.compareTo=function(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Ge?-1:0},e.prototype.withIndex=function(t){if(t===we||this.indexMap_.hasIndex(t))return this;var n=this.indexMap_.addIndex(t,this.children_);return new e(this.children_,this.priorityNode_,n)},e.prototype.isIndexed=function(e){return e===we||this.indexMap_.hasIndex(e)},e.prototype.equals=function(e){if(e===this)return!0;if(e.isLeafNode())return!1;var t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){for(var n=this.getIterator(Pe),r=t.getIterator(Pe),i=n.getNext(),a=r.getNext();i&&a;){if(i.name!==a.name||!i.node.equals(a.node))return!1;i=n.getNext(),a=r.getNext()}return null===i&&null===a}return!1}return!1},e.prototype.resolveIndex_=function(e){return e===we?null:this.indexMap_.get(e.toString())},e.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,e}(),Ge=new(function(e){function t(){return e.call(this,new De(Ve),He.EMPTY_NODE,Ue.Default)||this}return Object(i.c)(t,e),t.prototype.compareTo=function(e){return e===this?0:1},t.prototype.equals=function(e){return e===this},t.prototype.getPriority=function(){return this},t.prototype.getImmediateChild=function(e){return He.EMPTY_NODE},t.prototype.isEmpty=function(){return!1},t}(He));Object.defineProperties(_e,{MIN:{value:new _e(k,He.EMPTY_NODE)},MAX:{value:new _e(M,Ge)}}),xe.__EMPTY_NODE=He.EMPTY_NODE,Ce.__childrenNodeConstructor=He,K=Ge,function(e){Te=e}(Ge);function We(e,t){if(void 0===t&&(t=null),null===e)return He.EMPTY_NODE;if("object"===typeof e&&".priority"in e&&(t=e[".priority"]),Object(a.d)(null===t||"string"===typeof t||"number"===typeof t||"object"===typeof t&&".sv"in t,"Invalid priority type found: "+typeof t),"object"===typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!==typeof e||".sv"in e)return new Ce(e,We(t));if(e instanceof Array){var n=He.EMPTY_NODE;return L(e,(function(t,r){if(Object(a.h)(e,t)&&"."!==t.substring(0,1)){var i=We(r);!i.isLeafNode()&&i.isEmpty()||(n=n.updateImmediateChild(t,i))}})),n.updatePriority(We(t))}var r=[],i=!1;if(L(e,(function(e,t){if("."!==e.substring(0,1)){var n=We(t);n.isEmpty()||(i=i||!n.getPriority().isEmpty(),r.push(new _e(e,n)))}})),0===r.length)return He.EMPTY_NODE;var o=Fe(r,je,(function(e){return e.name}),Ve);if(i){var s=Fe(r,Pe.getCompare());return new He(o,We(t),new Ue({".priority":s},{".priority":Pe}))}return new He(o,We(t),Ue.Default)}!function(e){Se=e}(We);var qe,Xe=new(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Object(i.c)(t,e),t.prototype.compare=function(e,t){var n=e.node.compareTo(t.node);return 0===n?C(e.name,t.name):n},t.prototype.isDefinedOn=function(e){return!0},t.prototype.indexedValueChanged=function(e,t){return!e.equals(t)},t.prototype.minPost=function(){return _e.MIN},t.prototype.maxPost=function(){return _e.MAX},t.prototype.makePost=function(e,t){var n=We(e);return new _e(t,n)},t.prototype.toString=function(){return".value"},t}(be)),Ze=function(e){function t(t){var n=e.call(this)||this;return n.indexPath_=t,Object(a.d)(!t.isEmpty()&&".priority"!==t.getFront(),"Can't create PathIndex with empty path or .priority key"),n}return Object(i.c)(t,e),t.prototype.extractChild=function(e){return e.getChild(this.indexPath_)},t.prototype.isDefinedOn=function(e){return!e.getChild(this.indexPath_).isEmpty()},t.prototype.compare=function(e,t){var n=this.extractChild(e.node),r=this.extractChild(t.node),i=n.compareTo(r);return 0===i?C(e.name,t.name):i},t.prototype.makePost=function(e,t){var n=We(e),r=He.EMPTY_NODE.updateChild(this.indexPath_,n);return new _e(t,r)},t.prototype.maxPost=function(){var e=He.EMPTY_NODE.updateChild(this.indexPath_,Ge);return new _e(M,e)},t.prototype.toString=function(){return this.indexPath_.slice().join("/")},t}(be),Ke=function(){function e(e,t,n){this.node_=e,this.ref_=t,this.index_=n}return e.prototype.val=function(){return Object(a.B)("DataSnapshot.val",0,0,arguments.length),this.node_.val()},e.prototype.exportVal=function(){return Object(a.B)("DataSnapshot.exportVal",0,0,arguments.length),this.node_.val(!0)},e.prototype.toJSON=function(){return Object(a.B)("DataSnapshot.toJSON",0,1,arguments.length),this.exportVal()},e.prototype.exists=function(){return Object(a.B)("DataSnapshot.exists",0,0,arguments.length),!this.node_.isEmpty()},e.prototype.child=function(t){Object(a.B)("DataSnapshot.child",0,1,arguments.length),t=String(t),ce("DataSnapshot.child",1,t,!1);var n=new j(t),r=this.ref_.child(n);return new e(this.node_.getChild(n),r,Pe)},e.prototype.hasChild=function(e){Object(a.B)("DataSnapshot.hasChild",1,1,arguments.length),ce("DataSnapshot.hasChild",1,e,!1);var t=new j(e);return!this.node_.getChild(t).isEmpty()},e.prototype.getPriority=function(){return Object(a.B)("DataSnapshot.getPriority",0,0,arguments.length),this.node_.getPriority().val()},e.prototype.forEach=function(t){var n=this;if(Object(a.B)("DataSnapshot.forEach",1,1,arguments.length),Object(a.C)("DataSnapshot.forEach",1,t,!1),this.node_.isLeafNode())return!1;var r=this.node_;return!!r.forEachChild(this.index_,(function(r,i){return t(new e(i,n.ref_.child(r),Pe))}))},e.prototype.hasChildren=function(){return Object(a.B)("DataSnapshot.hasChildren",0,0,arguments.length),!this.node_.isLeafNode()&&!this.node_.isEmpty()},Object.defineProperty(e.prototype,"key",{get:function(){return this.ref_.getKey()},enumerable:!1,configurable:!0}),e.prototype.numChildren=function(){return Object(a.B)("DataSnapshot.numChildren",0,0,arguments.length),this.node_.numChildren()},e.prototype.getRef=function(){return Object(a.B)("DataSnapshot.ref",0,0,arguments.length),this.ref_},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),Ye=function(){function e(e,t,n,r){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=r}return e.prototype.getPath=function(){var e=this.snapshot.getRef();return"value"===this.eventType?e.path:e.getParent().path},e.prototype.getEventType=function(){return this.eventType},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Object(a.A)(this.snapshot.exportVal())},e}(),Je=function(){function e(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}return e.prototype.getPath=function(){return this.path},e.prototype.getEventType=function(){return"cancel"},e.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},e.prototype.toString=function(){return this.path.toString()+":cancel"},e}(),Qe=function(){function e(e,t,n){this.callback_=e,this.cancelCallback_=t,this.context_=n}return e.prototype.respondsTo=function(e){return"value"===e},e.prototype.createEvent=function(e,t){var n=t.getQueryParams().getIndex();return new Ye("value",this,new Ke(e.snapshotNode,t.getRef(),n))},e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){Object(a.d)(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var r=this.callback_;return function(){r.call(t,e.snapshot)}},e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new Je(this,e,t):null},e.prototype.matches=function(t){return t instanceof e&&(!t.callback_||!this.callback_||t.callback_===this.callback_&&t.context_===this.context_)},e.prototype.hasAnyCallback=function(){return null!==this.callback_},e}(),$e=function(){function e(e,t,n){this.callbacks_=e,this.cancelCallback_=t,this.context_=n}return e.prototype.respondsTo=function(e){var t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,Object(a.h)(this.callbacks_,t)},e.prototype.createCancelEvent=function(e,t){return this.cancelCallback_?new Je(this,e,t):null},e.prototype.createEvent=function(e,t){Object(a.d)(null!=e.childName,"Child events should have a childName.");var n=t.getRef().child(e.childName),r=t.getQueryParams().getIndex();return new Ye(e.type,this,new Ke(e.snapshotNode,n,r),e.prevName)},e.prototype.getEventRunner=function(e){var t=this.context_;if("cancel"===e.getEventType()){Object(a.d)(this.cancelCallback_,"Raising a cancel event on a listener with no cancel callback");var n=this.cancelCallback_;return function(){n.call(t,e.error)}}var r=this.callbacks_[e.eventType];return function(){r.call(t,e.snapshot,e.prevName)}},e.prototype.matches=function(t){var n=this;if(t instanceof e){if(!this.callbacks_||!t.callbacks_)return!0;if(this.context_===t.context_){var r=Object.keys(t.callbacks_),i=Object.keys(this.callbacks_),a=r.length;if(a===i.length){if(1===a){var o=r[0],s=i[0];return s===o&&(!t.callbacks_[o]||!this.callbacks_[s]||t.callbacks_[o]===this.callbacks_[s])}return i.every((function(e){return t.callbacks_[e]===n.callbacks_[e]}))}}}return!1},e.prototype.hasAnyCallback=function(){return null!==this.callbacks_},e}(),et=function(){function e(e,t,n,r){this.repo=e,this.path=t,this.queryParams_=n,this.orderByCalled_=r}return Object.defineProperty(e,"__referenceConstructor",{get:function(){return Object(a.d)(qe,"Reference.ts has not been loaded"),qe},set:function(e){qe=e},enumerable:!1,configurable:!0}),e.validateQueryEndpoints_=function(e){var t=null,n=null;if(e.hasStart()&&(t=e.getIndexStartValue()),e.hasEnd()&&(n=e.getIndexEndValue()),e.getIndex()===we){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",i="Query: When ordering by key, the argument passed to startAt(), endAt(),or equalTo() must be a string.";if(e.hasStart()){var o=e.getIndexStartName();if(!(o===k||e.hasStartAfter()&&o===M))throw new Error(r);if("string"!==typeof t)throw new Error(i)}if(e.hasEnd()){var s=e.getIndexEndName();if(!(s===M||e.hasEndBefore()&&s===k))throw new Error(r);if("string"!==typeof n)throw new Error(i)}}else if(e.getIndex()===Pe){if(null!=t&&!re(t)||null!=n&&!re(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), endAt(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Object(a.d)(e.getIndex()instanceof Ze||e.getIndex()===Xe,"unknown index type."),null!=t&&"object"===typeof t||null!=n&&"object"===typeof n)throw new Error("Query: First argument passed to startAt(), endAt(), or equalTo() cannot be an object.")},e.validateLimit_=function(e){if(e.hasStart()&&e.hasEnd()&&e.hasLimit()&&!e.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), endAt(), and limit(). Use limitToFirst() or limitToLast() instead.")},e.prototype.validateNoPreviousOrderByCall_=function(e){if(!0===this.orderByCalled_)throw new Error(e+": You can't combine multiple orderBy calls.")},e.prototype.getQueryParams=function(){return this.queryParams_},e.prototype.getRef=function(){return Object(a.B)("Query.ref",0,0,arguments.length),new e.__referenceConstructor(this.repo,this.path)},e.prototype.on=function(t,n,r,i){Object(a.B)("Query.on",2,4,arguments.length),le("Query.on",1,t,!1),Object(a.C)("Query.on",2,n,!1);var o=e.getCancelAndContextArgs_("Query.on",r,i);if("value"===t)this.onValueEvent(n,o.cancel,o.context);else{var s={};s[t]=n,this.onChildEvent(s,o.cancel,o.context)}return n},e.prototype.onValueEvent=function(e,t,n){var r=new Qe(e,t||null,n||null);this.repo.addEventCallbackForQuery(this,r)},e.prototype.onChildEvent=function(e,t,n){var r=new $e(e,t,n);this.repo.addEventCallbackForQuery(this,r)},e.prototype.off=function(e,t,n){Object(a.B)("Query.off",0,3,arguments.length),le("Query.off",1,e,!0),Object(a.C)("Query.off",2,t,!0),Object(a.D)("Query.off",3,n,!0);var r=null,i=null;if("value"===e){var o=t||null;r=new Qe(o,null,n||null)}else e&&(t&&((i={})[e]=t),r=new $e(i,null,n||null));this.repo.removeEventCallbackForQuery(this,r)},e.prototype.get=function(){return this.repo.getValue(this)},e.prototype.once=function(t,n,r,i){var o=this;Object(a.B)("Query.once",1,4,arguments.length),le("Query.once",1,t,!1),Object(a.C)("Query.once",2,n,!0);var s=e.getCancelAndContextArgs_("Query.once",r,i),l=!0,u=new a.a;u.promise.catch((function(){}));var c=function e(r){l&&(l=!1,o.off(t,e),n&&n.bind(s.context)(r),u.resolve(r))};return this.on(t,c,(function(e){o.off(t,c),s.cancel&&s.cancel.bind(s.context)(e),u.reject(e)})),u.promise},e.prototype.limitToFirst=function(t){if(Object(a.B)("Query.limitToFirst",1,1,arguments.length),"number"!==typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToFirst: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToFirst: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,this.queryParams_.limitToFirst(t),this.orderByCalled_)},e.prototype.limitToLast=function(t){if(Object(a.B)("Query.limitToLast",1,1,arguments.length),"number"!==typeof t||Math.floor(t)!==t||t<=0)throw new Error("Query.limitToLast: First argument must be a positive integer.");if(this.queryParams_.hasLimit())throw new Error("Query.limitToLast: Limit was already set (by another call to limit, limitToFirst, or limitToLast).");return new e(this.repo,this.path,this.queryParams_.limitToLast(t),this.orderByCalled_)},e.prototype.orderByChild=function(t){if(Object(a.B)("Query.orderByChild",1,1,arguments.length),"$key"===t)throw new Error('Query.orderByChild: "$key" is invalid.  Use Query.orderByKey() instead.');if("$priority"===t)throw new Error('Query.orderByChild: "$priority" is invalid.  Use Query.orderByPriority() instead.');if("$value"===t)throw new Error('Query.orderByChild: "$value" is invalid.  Use Query.orderByValue() instead.');ce("Query.orderByChild",1,t,!1),this.validateNoPreviousOrderByCall_("Query.orderByChild");var n=new j(t);if(n.isEmpty())throw new Error("Query.orderByChild: cannot pass in empty path.  Use Query.orderByValue() instead.");var r=new Ze(n),i=this.queryParams_.orderBy(r);return e.validateQueryEndpoints_(i),new e(this.repo,this.path,i,!0)},e.prototype.orderByKey=function(){Object(a.B)("Query.orderByKey",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByKey");var t=this.queryParams_.orderBy(we);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.orderByPriority=function(){Object(a.B)("Query.orderByPriority",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByPriority");var t=this.queryParams_.orderBy(Pe);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.orderByValue=function(){Object(a.B)("Query.orderByValue",0,0,arguments.length),this.validateNoPreviousOrderByCall_("Query.orderByValue");var t=this.queryParams_.orderBy(Xe);return e.validateQueryEndpoints_(t),new e(this.repo,this.path,t,!0)},e.prototype.startAt=function(t,n){void 0===t&&(t=null),Object(a.B)("Query.startAt",0,2,arguments.length),ie("Query.startAt",1,t,this.path,!0),ue("Query.startAt",2,n,!0);var r=this.queryParams_.startAt(t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAt: Starting point was already set (by another call to startAt or equalTo).");return void 0===t&&(t=null,n=null),new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.startAfter=function(t,n){void 0===t&&(t=null),Object(a.B)("Query.startAfter",0,2,arguments.length),ie("Query.startAfter",1,t,this.path,!1),ue("Query.startAfter",2,n,!0);var r=this.queryParams_.startAfter(t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasStart())throw new Error("Query.startAfter: Starting point was already set (by another call to startAt, startAfter or equalTo).");return new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.endAt=function(t,n){void 0===t&&(t=null),Object(a.B)("Query.endAt",0,2,arguments.length),ie("Query.endAt",1,t,this.path,!0),ue("Query.endAt",2,n,!0);var r=this.queryParams_.endAt(t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endAt: Ending point was already set (by another call to endAt, endBefore, or equalTo).");return new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.endBefore=function(t,n){void 0===t&&(t=null),Object(a.B)("Query.endBefore",0,2,arguments.length),ie("Query.endBefore",1,t,this.path,!1),ue("Query.endBefore",2,n,!0);var r=this.queryParams_.endBefore(t,n);if(e.validateLimit_(r),e.validateQueryEndpoints_(r),this.queryParams_.hasEnd())throw new Error("Query.endBefore: Ending point was already set (by another call to endAt, endBefore, or equalTo).");return new e(this.repo,this.path,r,this.orderByCalled_)},e.prototype.equalTo=function(e,t){if(Object(a.B)("Query.equalTo",1,2,arguments.length),ie("Query.equalTo",1,e,this.path,!1),ue("Query.equalTo",2,t,!0),this.queryParams_.hasStart())throw new Error("Query.equalTo: Starting point was already set (by another call to startAt or equalTo).");if(this.queryParams_.hasEnd())throw new Error("Query.equalTo: Ending point was already set (by another call to endAt or equalTo).");return this.startAt(e,t).endAt(e,t)},e.prototype.toString=function(){return Object(a.B)("Query.toString",0,0,arguments.length),this.repo.toString()+this.path.toUrlEncodedString()},e.prototype.toJSON=function(){return Object(a.B)("Query.toJSON",0,1,arguments.length),this.toString()},e.prototype.queryObject=function(){return this.queryParams_.getQueryObject()},e.prototype.queryIdentifier=function(){var e=this.queryObject(),t=P(e);return"{}"===t?"default":t},e.prototype.isEqual=function(t){if(Object(a.B)("Query.isEqual",1,1,arguments.length),!(t instanceof e)){var n="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(n)}var r=this.repo===t.repo,i=this.path.equals(t.path),o=this.queryIdentifier()===t.queryIdentifier();return r&&i&&o},e.getCancelAndContextArgs_=function(e,t,n){var r={cancel:null,context:null};if(t&&n)r.cancel=t,Object(a.C)(e,3,r.cancel,!0),r.context=n,Object(a.D)(e,4,r.context,!0);else if(t)if("object"===typeof t&&null!==t)r.context=t;else{if("function"!==typeof t)throw new Error(Object(a.l)(e,3,!0)+" must either be a cancel callback or a context object.");r.cancel=t}return r},Object.defineProperty(e.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),e}(),tt=function(){function e(e){this.node_=e}return e.prototype.getImmediateChild=function(t){return new e(this.node_.getImmediateChild(t))},e.prototype.node=function(){return this.node_},e}(),nt=function(){function e(e,t){this.syncTree_=e,this.path_=t}return e.prototype.getImmediateChild=function(t){var n=this.path_.child(t);return new e(this.syncTree_,n)},e.prototype.node=function(){return this.syncTree_.calcCompleteEventCache(this.path_)},e}(),rt=function(e,t,n){return e&&"object"===typeof e?(Object(a.d)(".sv"in e,"Unexpected leaf node or priority contents"),"string"===typeof e[".sv"]?it(e[".sv"],t,n):"object"===typeof e[".sv"]?at(e[".sv"],t):void Object(a.d)(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},it=function(e,t,n){switch(e){case"timestamp":return n.timestamp;default:Object(a.d)(!1,"Unexpected server value: "+e)}},at=function(e,t,n){e.hasOwnProperty("increment")||Object(a.d)(!1,"Unexpected server value: "+JSON.stringify(e,null,2));var r=e.increment;"number"!==typeof r&&Object(a.d)(!1,"Unexpected increment value: "+r);var i=t.node();if(Object(a.d)(null!==i&&"undefined"!==typeof i,"Expected ChildrenNode.EMPTY_NODE for nulls"),!i.isLeafNode())return r;var o=i.getValue();return"number"!==typeof o?r:o+r},ot=function(e,t,n,r){return lt(t,new nt(n,e),r)},st=function(e,t,n){return lt(e,new tt(t),n)};function lt(e,t,n){var r,i=e.getPriority().val(),a=rt(i,t.getImmediateChild(".priority"),n);if(e.isLeafNode()){var o=e,s=rt(o.getValue(),t,n);return s!==o.getValue()||a!==o.getPriority().val()?new Ce(s,We(a)):e}var l=e;return r=l,a!==l.getPriority().val()&&(r=r.updatePriority(new Ce(a))),l.forEachChild(Pe,(function(e,i){var a=lt(i,t.getImmediateChild(e),n);a!==i&&(r=r.updateImmediateChild(e,a))})),r}var ut,ct=function(){function e(){this.value=null,this.children=new Map}return e.prototype.find=function(e){if(null!=this.value)return this.value.getChild(e);if(!e.isEmpty()&&this.children.size>0){var t=e.getFront();return e=e.popFront(),this.children.has(t)?this.children.get(t).find(e):null}return null},e.prototype.remember=function(t,n){if(t.isEmpty())this.value=n,this.children.clear();else if(null!==this.value)this.value=this.value.updateChild(t,n);else{var r=t.getFront();this.children.has(r)||this.children.set(r,new e);var i=this.children.get(r);t=t.popFront(),i.remember(t,n)}},e.prototype.forget=function(e){if(e.isEmpty())return this.value=null,this.children.clear(),!0;if(null!==this.value){if(this.value.isLeafNode())return!1;var t=this.value;this.value=null;var n=this;return t.forEachChild(Pe,(function(e,t){n.remember(new j(e),t)})),this.forget(e)}if(this.children.size>0){var r=e.getFront();if(e=e.popFront(),this.children.has(r))this.children.get(r).forget(e)&&this.children.delete(r);return 0===this.children.size}return!0},e.prototype.forEachTree=function(e,t){null!==this.value?t(e,this.value):this.forEachChild((function(n,r){var i=new j(e.toString()+"/"+n);r.forEachTree(i,t)}))},e.prototype.forEachChild=function(e){this.children.forEach((function(t,n){e(n,t)}))},e}();!function(e){e[e.OVERWRITE=0]="OVERWRITE",e[e.MERGE=1]="MERGE",e[e.ACK_USER_WRITE=2]="ACK_USER_WRITE",e[e.LISTEN_COMPLETE=3]="LISTEN_COMPLETE"}(ut||(ut={}));var ht,ft,dt=function(){function e(e,t,n,r){this.fromUser=e,this.fromServer=t,this.queryId=n,this.tagged=r,Object(a.d)(!r||t,"Tagged queries must be from server.")}return e.User=new e(!0,!1,null,!1),e.Server=new e(!1,!0,null,!1),e.forServerTaggedQuery=function(t){return new e(!1,!0,t,!0)},e}(),pt=function(){function e(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=ut.ACK_USER_WRITE,this.source=dt.User}return e.prototype.operationForChild=function(t){if(this.path.isEmpty()){if(null!=this.affectedTree.value)return Object(a.d)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new j(t));return new e(j.Empty,n,this.revert)}return Object(a.d)(this.path.getFront()===t,"operationForChild called for unrelated child."),new e(this.path.popFront(),this.affectedTree,this.revert)},e}(),mt=function(){function e(e,t){void 0===t&&(ht||(ht=new De(A)),t=ht),this.value=e,this.children=t}return e.fromObject=function(t){var n=e.Empty;return L(t,(function(e,t){n=n.set(new j(e),t)})),n},e.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},e.prototype.findRootMostMatchingPathAndValue=function(e,t){if(null!=this.value&&t(this.value))return{path:j.Empty,value:this.value};if(e.isEmpty())return null;var n=e.getFront(),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(e.popFront(),t);return null!=i?{path:new j(n).child(i.path),value:i.value}:null}return null},e.prototype.findRootMostValueAndPath=function(e){return this.findRootMostMatchingPathAndValue(e,(function(){return!0}))},e.prototype.subtree=function(t){if(t.isEmpty())return this;var n=t.getFront(),r=this.children.get(n);return null!==r?r.subtree(t.popFront()):e.Empty},e.prototype.set=function(t,n){if(t.isEmpty())return new e(n,this.children);var r=t.getFront(),i=(this.children.get(r)||e.Empty).set(t.popFront(),n),a=this.children.insert(r,i);return new e(this.value,a)},e.prototype.remove=function(t){if(t.isEmpty())return this.children.isEmpty()?e.Empty:new e(null,this.children);var n=t.getFront(),r=this.children.get(n);if(r){var i=r.remove(t.popFront()),a=void 0;return a=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&a.isEmpty()?e.Empty:new e(this.value,a)}return this},e.prototype.get=function(e){if(e.isEmpty())return this.value;var t=e.getFront(),n=this.children.get(t);return n?n.get(e.popFront()):null},e.prototype.setTree=function(t,n){if(t.isEmpty())return n;var r=t.getFront(),i=(this.children.get(r)||e.Empty).setTree(t.popFront(),n),a=void 0;return a=i.isEmpty()?this.children.remove(r):this.children.insert(r,i),new e(this.value,a)},e.prototype.fold=function(e){return this.fold_(j.Empty,e)},e.prototype.fold_=function(e,t){var n={};return this.children.inorderTraversal((function(r,i){n[r]=i.fold_(e.child(r),t)})),t(e,this.value,n)},e.prototype.findOnPath=function(e,t){return this.findOnPath_(e,j.Empty,t)},e.prototype.findOnPath_=function(e,t,n){var r=!!this.value&&n(t,this.value);if(r)return r;if(e.isEmpty())return null;var i=e.getFront(),a=this.children.get(i);return a?a.findOnPath_(e.popFront(),t.child(i),n):null},e.prototype.foreachOnPath=function(e,t){return this.foreachOnPath_(e,j.Empty,t)},e.prototype.foreachOnPath_=function(t,n,r){if(t.isEmpty())return this;this.value&&r(n,this.value);var i=t.getFront(),a=this.children.get(i);return a?a.foreachOnPath_(t.popFront(),n.child(i),r):e.Empty},e.prototype.foreach=function(e){this.foreach_(j.Empty,e)},e.prototype.foreach_=function(e,t){this.children.inorderTraversal((function(n,r){r.foreach_(e.child(n),t)})),this.value&&t(e,this.value)},e.prototype.foreachChild=function(e){this.children.inorderTraversal((function(t,n){n.value&&e(t,n.value)}))},e.Empty=new e(null),e}(),vt=function(){function e(e,t){this.source=e,this.path=t,this.type=ut.LISTEN_COMPLETE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,j.Empty):new e(this.source,this.path.popFront())},e}(),yt=function(){function e(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=ut.OVERWRITE}return e.prototype.operationForChild=function(t){return this.path.isEmpty()?new e(this.source,j.Empty,this.snap.getImmediateChild(t)):new e(this.source,this.path.popFront(),this.snap)},e}(),gt=function(){function e(e,t,n){this.source=e,this.path=t,this.children=n,this.type=ut.MERGE}return e.prototype.operationForChild=function(t){if(this.path.isEmpty()){var n=this.children.subtree(new j(t));return n.isEmpty()?null:n.value?new yt(this.source,j.Empty,n.value):new e(this.source,j.Empty,n)}return Object(a.d)(this.path.getFront()===t,"Can't get a merge for a child not on the path of the operation"),new e(this.source,this.path.popFront(),this.children)},e.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},e}(),_t=function(){function e(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}return e.prototype.isFullyInitialized=function(){return this.fullyInitialized_},e.prototype.isFiltered=function(){return this.filtered_},e.prototype.isCompleteForPath=function(e){if(e.isEmpty())return this.isFullyInitialized()&&!this.filtered_;var t=e.getFront();return this.isCompleteForChild(t)},e.prototype.isCompleteForChild=function(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)},e.prototype.getNode=function(){return this.node_},e}(),bt=function(){function e(e,t){this.eventCache_=e,this.serverCache_=t}return e.prototype.updateEventSnap=function(t,n,r){return new e(new _t(t,n,r),this.serverCache_)},e.prototype.updateServerSnap=function(t,n,r){return new e(this.eventCache_,new _t(t,n,r))},e.prototype.getEventCache=function(){return this.eventCache_},e.prototype.getCompleteEventSnap=function(){return this.eventCache_.isFullyInitialized()?this.eventCache_.getNode():null},e.prototype.getServerCache=function(){return this.serverCache_},e.prototype.getCompleteServerSnap=function(){return this.serverCache_.isFullyInitialized()?this.serverCache_.getNode():null},e.Empty=new e(new _t(He.EMPTY_NODE,!1,!1),new _t(He.EMPTY_NODE,!1,!1)),e}(),xt=function(){function e(e,t,n,r,i){this.type=e,this.snapshotNode=t,this.childName=n,this.oldSnap=r,this.prevName=i}return e.valueChange=function(t){return new e(e.VALUE,t)},e.childAddedChange=function(t,n){return new e(e.CHILD_ADDED,n,t)},e.childRemovedChange=function(t,n){return new e(e.CHILD_REMOVED,n,t)},e.childChangedChange=function(t,n,r){return new e(e.CHILD_CHANGED,n,t,r)},e.childMovedChange=function(t,n){return new e(e.CHILD_MOVED,n,t)},e.CHILD_ADDED="child_added",e.CHILD_REMOVED="child_removed",e.CHILD_CHANGED="child_changed",e.CHILD_MOVED="child_moved",e.VALUE="value",e}(),wt=function(){function e(e){this.index_=e}return e.prototype.updateChild=function(e,t,n,r,i,o){Object(a.d)(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");var s=e.getImmediateChild(t);return s.getChild(r).equals(n.getChild(r))&&s.isEmpty()===n.isEmpty()?e:(null!=o&&(n.isEmpty()?e.hasChild(t)?o.trackChildChange(xt.childRemovedChange(t,s)):Object(a.d)(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):s.isEmpty()?o.trackChildChange(xt.childAddedChange(t,n)):o.trackChildChange(xt.childChangedChange(t,n,s))),e.isLeafNode()&&n.isEmpty()?e:e.updateImmediateChild(t,n).withIndex(this.index_))},e.prototype.updateFullNode=function(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(Pe,(function(e,r){t.hasChild(e)||n.trackChildChange(xt.childRemovedChange(e,r))})),t.isLeafNode()||t.forEachChild(Pe,(function(t,r){if(e.hasChild(t)){var i=e.getImmediateChild(t);i.equals(r)||n.trackChildChange(xt.childChangedChange(t,r,i))}else n.trackChildChange(xt.childAddedChange(t,r))}))),t.withIndex(this.index_)},e.prototype.updatePriority=function(e,t){return e.isEmpty()?He.EMPTY_NODE:e.updatePriority(t)},e.prototype.filtersNodes=function(){return!1},e.prototype.getIndexedFilter=function(){return this},e.prototype.getIndex=function(){return this.index_},e}(),Et=function(){function e(){this.changeMap=new Map}return e.prototype.trackChildChange=function(e){var t=e.type,n=e.childName;Object(a.d)(t===xt.CHILD_ADDED||t===xt.CHILD_CHANGED||t===xt.CHILD_REMOVED,"Only child changes supported for tracking"),Object(a.d)(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var i=r.type;if(t===xt.CHILD_ADDED&&i===xt.CHILD_REMOVED)this.changeMap.set(n,xt.childChangedChange(n,e.snapshotNode,r.snapshotNode));else if(t===xt.CHILD_REMOVED&&i===xt.CHILD_ADDED)this.changeMap.delete(n);else if(t===xt.CHILD_REMOVED&&i===xt.CHILD_CHANGED)this.changeMap.set(n,xt.childRemovedChange(n,r.oldSnap));else if(t===xt.CHILD_CHANGED&&i===xt.CHILD_ADDED)this.changeMap.set(n,xt.childAddedChange(n,e.snapshotNode));else{if(t!==xt.CHILD_CHANGED||i!==xt.CHILD_CHANGED)throw Object(a.e)("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(n,xt.childChangedChange(n,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,e)},e.prototype.getChanges=function(){return Array.from(this.changeMap.values())},e}(),St=new(function(){function e(){}return e.prototype.getCompleteChild=function(e){return null},e.prototype.getChildAfterChild=function(e,t,n){return null},e}()),Tt=function(){function e(e,t,n){void 0===n&&(n=null),this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}return e.prototype.getCompleteChild=function(e){var t=this.viewCache_.getEventCache();if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);var n=null!=this.optCompleteServerCache_?new _t(this.optCompleteServerCache_,!0,!1):this.viewCache_.getServerCache();return this.writes_.calcCompleteChild(e,n)},e.prototype.getChildAfterChild=function(e,t,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:this.viewCache_.getCompleteServerSnap(),i=this.writes_.calcIndexedSlice(r,t,1,n,e);return 0===i.length?null:i[0]},e}(),kt=function(e,t){this.viewCache=e,this.changes=t},Mt=function(){function e(e){this.filter_=e}return e.prototype.assertIndexed=function(e){Object(a.d)(e.getEventCache().getNode().isIndexed(this.filter_.getIndex()),"Event snap not indexed"),Object(a.d)(e.getServerCache().getNode().isIndexed(this.filter_.getIndex()),"Server snap not indexed")},e.prototype.applyOperation=function(t,n,r,i){var o,s,l=new Et;if(n.type===ut.OVERWRITE){var u=n;u.source.fromUser?o=this.applyUserOverwrite_(t,u.path,u.snap,r,i,l):(Object(a.d)(u.source.fromServer,"Unknown source."),s=u.source.tagged||t.getServerCache().isFiltered()&&!u.path.isEmpty(),o=this.applyServerOverwrite_(t,u.path,u.snap,r,i,s,l))}else if(n.type===ut.MERGE){var c=n;c.source.fromUser?o=this.applyUserMerge_(t,c.path,c.children,r,i,l):(Object(a.d)(c.source.fromServer,"Unknown source."),s=c.source.tagged||t.getServerCache().isFiltered(),o=this.applyServerMerge_(t,c.path,c.children,r,i,s,l))}else if(n.type===ut.ACK_USER_WRITE){var h=n;o=h.revert?this.revertUserWrite_(t,h.path,r,i,l):this.ackUserWrite_(t,h.path,h.affectedTree,r,i,l)}else{if(n.type!==ut.LISTEN_COMPLETE)throw Object(a.e)("Unknown operation type: "+n.type);o=this.listenComplete_(t,n.path,r,l)}var f=l.getChanges();return e.maybeAddValueEvent_(t,o,f),new kt(o,f)},e.maybeAddValueEvent_=function(e,t,n){var r=t.getEventCache();if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),a=e.getCompleteEventSnap();(n.length>0||!e.getEventCache().isFullyInitialized()||i&&!r.getNode().equals(a)||!r.getNode().getPriority().equals(a.getPriority()))&&n.push(xt.valueChange(t.getCompleteEventSnap()))}},e.prototype.generateEventCacheAfterServerEvent_=function(e,t,n,r,i){var o=e.getEventCache();if(null!=n.shadowingWrite(t))return e;var s=void 0,l=void 0;if(t.isEmpty())if(Object(a.d)(e.getServerCache().isFullyInitialized(),"If change path is empty, we must have complete server data"),e.getServerCache().isFiltered()){var u=e.getCompleteServerSnap(),c=u instanceof He?u:He.EMPTY_NODE,h=n.calcCompleteEventChildren(c);s=this.filter_.updateFullNode(e.getEventCache().getNode(),h,i)}else{var f=n.calcCompleteEventCache(e.getCompleteServerSnap());s=this.filter_.updateFullNode(e.getEventCache().getNode(),f,i)}else{var d=t.getFront();if(".priority"===d){Object(a.d)(1===t.getLength(),"Can't have a priority with additional path components");var p=o.getNode();l=e.getServerCache().getNode();var m=n.calcEventCacheAfterServerOverwrite(t,p,l);s=null!=m?this.filter_.updatePriority(p,m):o.getNode()}else{var v=t.popFront(),y=void 0;if(o.isCompleteForChild(d)){l=e.getServerCache().getNode();var g=n.calcEventCacheAfterServerOverwrite(t,o.getNode(),l);y=null!=g?o.getNode().getImmediateChild(d).updateChild(v,g):o.getNode().getImmediateChild(d)}else y=n.calcCompleteChild(d,e.getServerCache());s=null!=y?this.filter_.updateChild(o.getNode(),d,y,v,r,i):o.getNode()}}return e.updateEventSnap(s,o.isFullyInitialized()||t.isEmpty(),this.filter_.filtersNodes())},e.prototype.applyServerOverwrite_=function(e,t,n,r,i,a,o){var s,l=e.getServerCache(),u=a?this.filter_:this.filter_.getIndexedFilter();if(t.isEmpty())s=u.updateFullNode(l.getNode(),n,null);else if(u.filtersNodes()&&!l.isFiltered()){var c=l.getNode().updateChild(t,n);s=u.updateFullNode(l.getNode(),c,null)}else{var h=t.getFront();if(!l.isCompleteForPath(t)&&t.getLength()>1)return e;var f=t.popFront(),d=l.getNode().getImmediateChild(h).updateChild(f,n);s=".priority"===h?u.updatePriority(l.getNode(),d):u.updateChild(l.getNode(),h,d,f,St,null)}var p=e.updateServerSnap(s,l.isFullyInitialized()||t.isEmpty(),u.filtersNodes()),m=new Tt(r,p,i);return this.generateEventCacheAfterServerEvent_(p,t,r,m,o)},e.prototype.applyUserOverwrite_=function(e,t,n,r,i,a){var o,s,l=e.getEventCache(),u=new Tt(r,e,i);if(t.isEmpty())s=this.filter_.updateFullNode(e.getEventCache().getNode(),n,a),o=e.updateEventSnap(s,!0,this.filter_.filtersNodes());else{var c=t.getFront();if(".priority"===c)s=this.filter_.updatePriority(e.getEventCache().getNode(),n),o=e.updateEventSnap(s,l.isFullyInitialized(),l.isFiltered());else{var h=t.popFront(),f=l.getNode().getImmediateChild(c),d=void 0;if(h.isEmpty())d=n;else{var p=u.getCompleteChild(c);d=null!=p?".priority"===h.getBack()&&p.getChild(h.parent()).isEmpty()?p:p.updateChild(h,n):He.EMPTY_NODE}if(f.equals(d))o=e;else{var m=this.filter_.updateChild(l.getNode(),c,d,h,u,a);o=e.updateEventSnap(m,l.isFullyInitialized(),this.filter_.filtersNodes())}}}return o},e.cacheHasChild_=function(e,t){return e.getEventCache().isCompleteForChild(t)},e.prototype.applyUserMerge_=function(t,n,r,i,a,o){var s=this,l=t;return r.foreach((function(r,u){var c=n.child(r);e.cacheHasChild_(t,c.getFront())&&(l=s.applyUserOverwrite_(l,c,u,i,a,o))})),r.foreach((function(r,u){var c=n.child(r);e.cacheHasChild_(t,c.getFront())||(l=s.applyUserOverwrite_(l,c,u,i,a,o))})),l},e.prototype.applyMerge_=function(e,t){return t.foreach((function(t,n){e=e.updateChild(t,n)})),e},e.prototype.applyServerMerge_=function(e,t,n,r,i,a,o){var s=this;if(e.getServerCache().getNode().isEmpty()&&!e.getServerCache().isFullyInitialized())return e;var l,u=e;l=t.isEmpty()?n:mt.Empty.setTree(t,n);var c=e.getServerCache().getNode();return l.children.inorderTraversal((function(t,n){if(c.hasChild(t)){var l=e.getServerCache().getNode().getImmediateChild(t),h=s.applyMerge_(l,n);u=s.applyServerOverwrite_(u,new j(t),h,r,i,a,o)}})),l.children.inorderTraversal((function(t,n){var l=!e.getServerCache().isCompleteForChild(t)&&null==n.value;if(!c.hasChild(t)&&!l){var h=e.getServerCache().getNode().getImmediateChild(t),f=s.applyMerge_(h,n);u=s.applyServerOverwrite_(u,new j(t),f,r,i,a,o)}})),u},e.prototype.ackUserWrite_=function(e,t,n,r,i,a){if(null!=r.shadowingWrite(t))return e;var o=e.getServerCache().isFiltered(),s=e.getServerCache();if(null!=n.value){if(t.isEmpty()&&s.isFullyInitialized()||s.isCompleteForPath(t))return this.applyServerOverwrite_(e,t,s.getNode().getChild(t),r,i,o,a);if(t.isEmpty()){var l=mt.Empty;return s.getNode().forEachChild(we,(function(e,t){l=l.set(new j(e),t)})),this.applyServerMerge_(e,t,l,r,i,o,a)}return e}var u=mt.Empty;return n.foreach((function(e,n){var r=t.child(e);s.isCompleteForPath(r)&&(u=u.set(e,s.getNode().getChild(r)))})),this.applyServerMerge_(e,t,u,r,i,o,a)},e.prototype.listenComplete_=function(e,t,n,r){var i=e.getServerCache(),a=e.updateServerSnap(i.getNode(),i.isFullyInitialized()||t.isEmpty(),i.isFiltered());return this.generateEventCacheAfterServerEvent_(a,t,n,St,r)},e.prototype.revertUserWrite_=function(e,t,n,r,i){var o;if(null!=n.shadowingWrite(t))return e;var s=new Tt(n,e,r),l=e.getEventCache().getNode(),u=void 0;if(t.isEmpty()||".priority"===t.getFront()){var c=void 0;if(e.getServerCache().isFullyInitialized())c=n.calcCompleteEventCache(e.getCompleteServerSnap());else{var h=e.getServerCache().getNode();Object(a.d)(h instanceof He,"serverChildren would be complete if leaf node"),c=n.calcCompleteEventChildren(h)}c=c,u=this.filter_.updateFullNode(l,c,i)}else{var f=t.getFront(),d=n.calcCompleteChild(f,e.getServerCache());null==d&&e.getServerCache().isCompleteForChild(f)&&(d=l.getImmediateChild(f)),(u=null!=d?this.filter_.updateChild(l,f,d,t.popFront(),s,i):e.getEventCache().getNode().hasChild(f)?this.filter_.updateChild(l,f,He.EMPTY_NODE,t.popFront(),s,i):l).isEmpty()&&e.getServerCache().isFullyInitialized()&&(o=n.calcCompleteEventCache(e.getCompleteServerSnap())).isLeafNode()&&(u=this.filter_.updateFullNode(u,o,i))}return o=e.getServerCache().isFullyInitialized()||null!=n.shadowingWrite(j.Empty),e.updateEventSnap(u,o,this.filter_.filtersNodes())},e}(),Ct=function(){function e(e){this.query_=e,this.index_=this.query_.getQueryParams().getIndex()}return e.prototype.generateEventsForChanges=function(e,t,n){var r=this,i=[],a=[];return e.forEach((function(e){e.type===xt.CHILD_CHANGED&&r.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&a.push(xt.childMovedChange(e.childName,e.snapshotNode))})),this.generateEventsForType_(i,xt.CHILD_REMOVED,e,n,t),this.generateEventsForType_(i,xt.CHILD_ADDED,e,n,t),this.generateEventsForType_(i,xt.CHILD_MOVED,a,n,t),this.generateEventsForType_(i,xt.CHILD_CHANGED,e,n,t),this.generateEventsForType_(i,xt.VALUE,e,n,t),i},e.prototype.generateEventsForType_=function(e,t,n,r,i){var a=this,o=n.filter((function(e){return e.type===t}));o.sort(this.compareChanges_.bind(this)),o.forEach((function(t){var n=a.materializeSingleChange_(t,i);r.forEach((function(r){r.respondsTo(t.type)&&e.push(r.createEvent(n,a.query_))}))}))},e.prototype.materializeSingleChange_=function(e,t){return"value"===e.type||"child_removed"===e.type||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,this.index_)),e},e.prototype.compareChanges_=function(e,t){if(null==e.childName||null==t.childName)throw Object(a.e)("Should only compare child_ events.");var n=new _e(e.childName,e.snapshotNode),r=new _e(t.childName,t.snapshotNode);return this.index_.compare(n,r)},e}(),At=function(){function e(e,t){this.query_=e,this.eventRegistrations_=[];var n=this.query_.getQueryParams(),r=new wt(n.getIndex()),i=n.getNodeFilter();this.processor_=new Mt(i);var a=t.getServerCache(),o=t.getEventCache(),s=r.updateFullNode(He.EMPTY_NODE,a.getNode(),null),l=i.updateFullNode(He.EMPTY_NODE,o.getNode(),null),u=new _t(s,a.isFullyInitialized(),r.filtersNodes()),c=new _t(l,o.isFullyInitialized(),i.filtersNodes());this.viewCache_=new bt(c,u),this.eventGenerator_=new Ct(this.query_)}return e.prototype.getQuery=function(){return this.query_},e.prototype.getServerCache=function(){return this.viewCache_.getServerCache().getNode()},e.prototype.getCompleteServerCache=function(e){var t=this.viewCache_.getCompleteServerSnap();return t&&(this.query_.getQueryParams().loadsAllData()||!e.isEmpty()&&!t.getImmediateChild(e.getFront()).isEmpty())?t.getChild(e):null},e.prototype.isEmpty=function(){return 0===this.eventRegistrations_.length},e.prototype.addEventRegistration=function(e){this.eventRegistrations_.push(e)},e.prototype.removeEventRegistration=function(e,t){var n=[];if(t){Object(a.d)(null==e,"A cancel should cancel all event registrations.");var r=this.query_.path;this.eventRegistrations_.forEach((function(e){t=t;var i=e.createCancelEvent(t,r);i&&n.push(i)}))}if(e){for(var i=[],o=0;o<this.eventRegistrations_.length;++o){var s=this.eventRegistrations_[o];if(s.matches(e)){if(e.hasAnyCallback()){i=i.concat(this.eventRegistrations_.slice(o+1));break}}else i.push(s)}this.eventRegistrations_=i}else this.eventRegistrations_=[];return n},e.prototype.applyOperation=function(e,t,n){e.type===ut.MERGE&&null!==e.source.queryId&&(Object(a.d)(this.viewCache_.getCompleteServerSnap(),"We should always have a full cache before handling merges"),Object(a.d)(this.viewCache_.getCompleteEventSnap(),"Missing event cache, even though we have a server cache"));var r=this.viewCache_,i=this.processor_.applyOperation(r,e,t,n);return this.processor_.assertIndexed(i.viewCache),Object(a.d)(i.viewCache.getServerCache().isFullyInitialized()||!r.getServerCache().isFullyInitialized(),"Once a server snap is complete, it should never go back"),this.viewCache_=i.viewCache,this.generateEventsForChanges_(i.changes,i.viewCache.getEventCache().getNode(),null)},e.prototype.getInitialEvents=function(e){var t=this.viewCache_.getEventCache(),n=[];t.getNode().isLeafNode()||t.getNode().forEachChild(Pe,(function(e,t){n.push(xt.childAddedChange(e,t))}));return t.isFullyInitialized()&&n.push(xt.valueChange(t.getNode())),this.generateEventsForChanges_(n,t.getNode(),e)},e.prototype.generateEventsForChanges_=function(e,t,n){var r=n?[n]:this.eventRegistrations_;return this.eventGenerator_.generateEventsForChanges(e,t,r)},e}(),It=function(){function e(){this.views=new Map}return Object.defineProperty(e,"__referenceConstructor",{get:function(){return Object(a.d)(ft,"Reference.ts has not been loaded"),ft},set:function(e){Object(a.d)(!ft,"__referenceConstructor has already been defined"),ft=e},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return 0===this.views.size},e.prototype.applyOperation=function(e,t,n){var r,o,s=e.source.queryId;if(null!==s){var l=this.views.get(s);return Object(a.d)(null!=l,"SyncTree gave us an op for an invalid query."),l.applyOperation(e,t,n)}var u=[];try{for(var c=Object(i.g)(this.views.values()),h=c.next();!h.done;h=c.next()){l=h.value;u=u.concat(l.applyOperation(e,t,n))}}catch(f){r={error:f}}finally{try{h&&!h.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}return u},e.prototype.addEventRegistration=function(e,t,n,r,i){var a=e.queryIdentifier(),o=this.views.get(a);if(!o){var s=n.calcCompleteEventCache(i?r:null),l=!1;s?l=!0:r instanceof He?(s=n.calcCompleteEventChildren(r),l=!1):(s=He.EMPTY_NODE,l=!1);var u=new bt(new _t(s,l,!1),new _t(r,i,!1));o=new At(e,u),this.views.set(a,o)}return o.addEventRegistration(t),o.getInitialEvents(t)},e.prototype.removeEventRegistration=function(t,n,r){var a,o,s=t.queryIdentifier(),l=[],u=[],c=this.hasCompleteView();if("default"===s)try{for(var h=Object(i.g)(this.views.entries()),f=h.next();!f.done;f=h.next()){var d=Object(i.e)(f.value,2),p=d[0],m=d[1];u=u.concat(m.removeEventRegistration(n,r)),m.isEmpty()&&(this.views.delete(p),m.getQuery().getQueryParams().loadsAllData()||l.push(m.getQuery()))}}catch(v){a={error:v}}finally{try{f&&!f.done&&(o=h.return)&&o.call(h)}finally{if(a)throw a.error}}else(m=this.views.get(s))&&(u=u.concat(m.removeEventRegistration(n,r)),m.isEmpty()&&(this.views.delete(s),m.getQuery().getQueryParams().loadsAllData()||l.push(m.getQuery())));return c&&!this.hasCompleteView()&&l.push(new e.__referenceConstructor(t.repo,t.path)),{removed:l,events:u}},e.prototype.getQueryViews=function(){var e,t,n=[];try{for(var r=Object(i.g)(this.views.values()),a=r.next();!a.done;a=r.next()){var o=a.value;o.getQuery().getQueryParams().loadsAllData()||n.push(o)}}catch(s){e={error:s}}finally{try{a&&!a.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return n},e.prototype.getCompleteServerCache=function(e){var t,n,r=null;try{for(var a=Object(i.g)(this.views.values()),o=a.next();!o.done;o=a.next()){var s=o.value;r=r||s.getCompleteServerCache(e)}}catch(l){t={error:l}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return r},e.prototype.viewForQuery=function(e){if(e.getQueryParams().loadsAllData())return this.getCompleteView();var t=e.queryIdentifier();return this.views.get(t)},e.prototype.viewExistsForQuery=function(e){return null!=this.viewForQuery(e)},e.prototype.hasCompleteView=function(){return null!=this.getCompleteView()},e.prototype.getCompleteView=function(){var e,t;try{for(var n=Object(i.g)(this.views.values()),r=n.next();!r.done;r=n.next()){var a=r.value;if(a.getQuery().getQueryParams().loadsAllData())return a}}catch(o){e={error:o}}finally{try{r&&!r.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}return null},e}(),Pt=function(){function e(e){this.writeTree_=e}return e.prototype.addWrite=function(t,n){if(t.isEmpty())return new e(new mt(n));var r=this.writeTree_.findRootMostValueAndPath(t);if(null!=r){var i=r.path,a=r.value,o=j.relativePath(i,t);return a=a.updateChild(o,n),new e(this.writeTree_.set(i,a))}var s=new mt(n);return new e(this.writeTree_.setTree(t,s))},e.prototype.addWrites=function(e,t){var n=this;return L(t,(function(t,r){n=n.addWrite(e.child(t),r)})),n},e.prototype.removeWrite=function(t){return t.isEmpty()?e.Empty:new e(this.writeTree_.setTree(t,mt.Empty))},e.prototype.hasCompleteWrite=function(e){return null!=this.getCompleteNode(e)},e.prototype.getCompleteNode=function(e){var t=this.writeTree_.findRootMostValueAndPath(e);return null!=t?this.writeTree_.get(t.path).getChild(j.relativePath(t.path,e)):null},e.prototype.getCompleteChildren=function(){var e=[],t=this.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(Pe,(function(t,n){e.push(new _e(t,n))})):this.writeTree_.children.inorderTraversal((function(t,n){null!=n.value&&e.push(new _e(t,n.value))})),e},e.prototype.childCompoundWrite=function(t){if(t.isEmpty())return this;var n=this.getCompleteNode(t);return new e(null!=n?new mt(n):this.writeTree_.subtree(t))},e.prototype.isEmpty=function(){return this.writeTree_.isEmpty()},e.prototype.apply=function(e){return Rt(j.Empty,this.writeTree_,e)},e.Empty=new e(new mt(null)),e}();function Rt(e,t,n){if(null!=t.value)return n.updateChild(e,t.value);var r=null;return t.children.inorderTraversal((function(t,i){".priority"===t?(Object(a.d)(null!==i.value,"Priority writes must always be leaf nodes"),r=i.value):n=Rt(e.child(t),i,n)})),n.getChild(e).isEmpty()||null===r||(n=n.updateChild(e.child(".priority"),r)),n}var Lt=function(){function e(){this.visibleWrites_=Pt.Empty,this.allWrites_=[],this.lastWriteId_=-1}return e.prototype.childWrites=function(e){return new Ot(e,this)},e.prototype.addOverwrite=function(e,t,n,r){Object(a.d)(n>this.lastWriteId_,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),this.allWrites_.push({path:e,snap:t,writeId:n,visible:r}),r&&(this.visibleWrites_=this.visibleWrites_.addWrite(e,t)),this.lastWriteId_=n},e.prototype.addMerge=function(e,t,n){Object(a.d)(n>this.lastWriteId_,"Stacking an older merge on top of newer ones"),this.allWrites_.push({path:e,children:t,writeId:n,visible:!0}),this.visibleWrites_=this.visibleWrites_.addWrites(e,t),this.lastWriteId_=n},e.prototype.getWrite=function(e){for(var t=0;t<this.allWrites_.length;t++){var n=this.allWrites_[t];if(n.writeId===e)return n}return null},e.prototype.removeWrite=function(e){var t=this,n=this.allWrites_.findIndex((function(t){return t.writeId===e}));Object(a.d)(n>=0,"removeWrite called with nonexistent writeId.");var r=this.allWrites_[n];this.allWrites_.splice(n,1);for(var i=r.visible,o=!1,s=this.allWrites_.length-1;i&&s>=0;){var l=this.allWrites_[s];l.visible&&(s>=n&&this.recordContainsPath_(l,r.path)?i=!1:r.path.contains(l.path)&&(o=!0)),s--}if(i){if(o)return this.resetTree_(),!0;r.snap?this.visibleWrites_=this.visibleWrites_.removeWrite(r.path):L(r.children,(function(e){t.visibleWrites_=t.visibleWrites_.removeWrite(r.path.child(e))}));return!0}return!1},e.prototype.getCompleteWriteData=function(e){return this.visibleWrites_.getCompleteNode(e)},e.prototype.calcCompleteEventCache=function(t,n,r,i){if(r||i){var a=this.visibleWrites_.childCompoundWrite(t);if(!i&&a.isEmpty())return n;if(i||null!=n||a.hasCompleteWrite(j.Empty)){var o=e.layerTree_(this.allWrites_,(function(e){return(e.visible||i)&&(!r||!~r.indexOf(e.writeId))&&(e.path.contains(t)||t.contains(e.path))}),t);u=n||He.EMPTY_NODE;return o.apply(u)}return null}var s=this.visibleWrites_.getCompleteNode(t);if(null!=s)return s;var l=this.visibleWrites_.childCompoundWrite(t);if(l.isEmpty())return n;if(null!=n||l.hasCompleteWrite(j.Empty)){var u=n||He.EMPTY_NODE;return l.apply(u)}return null},e.prototype.calcCompleteEventChildren=function(e,t){var n=He.EMPTY_NODE,r=this.visibleWrites_.getCompleteNode(e);if(r)return r.isLeafNode()||r.forEachChild(Pe,(function(e,t){n=n.updateImmediateChild(e,t)})),n;if(t){var i=this.visibleWrites_.childCompoundWrite(e);return t.forEachChild(Pe,(function(e,t){var r=i.childCompoundWrite(new j(e)).apply(t);n=n.updateImmediateChild(e,r)})),i.getCompleteChildren().forEach((function(e){n=n.updateImmediateChild(e.name,e.node)})),n}return this.visibleWrites_.childCompoundWrite(e).getCompleteChildren().forEach((function(e){n=n.updateImmediateChild(e.name,e.node)})),n},e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,n,r){Object(a.d)(n||r,"Either existingEventSnap or existingServerSnap must exist");var i=e.child(t);if(this.visibleWrites_.hasCompleteWrite(i))return null;var o=this.visibleWrites_.childCompoundWrite(i);return o.isEmpty()?r.getChild(t):o.apply(r.getChild(t))},e.prototype.calcCompleteChild=function(e,t,n){var r=e.child(t),i=this.visibleWrites_.getCompleteNode(r);return null!=i?i:n.isCompleteForChild(t)?this.visibleWrites_.childCompoundWrite(r).apply(n.getNode().getImmediateChild(t)):null},e.prototype.shadowingWrite=function(e){return this.visibleWrites_.getCompleteNode(e)},e.prototype.calcIndexedSlice=function(e,t,n,r,i,a){var o,s=this.visibleWrites_.childCompoundWrite(e),l=s.getCompleteNode(j.Empty);if(null!=l)o=l;else{if(null==t)return[];o=s.apply(t)}if((o=o.withIndex(a)).isEmpty()||o.isLeafNode())return[];for(var u=[],c=a.getCompare(),h=i?o.getReverseIteratorFrom(n,a):o.getIteratorFrom(n,a),f=h.getNext();f&&u.length<r;)0!==c(f,n)&&u.push(f),f=h.getNext();return u},e.prototype.recordContainsPath_=function(e,t){if(e.snap)return e.path.contains(t);for(var n in e.children)if(e.children.hasOwnProperty(n)&&e.path.child(n).contains(t))return!0;return!1},e.prototype.resetTree_=function(){this.visibleWrites_=e.layerTree_(this.allWrites_,e.DefaultFilter_,j.Empty),this.allWrites_.length>0?this.lastWriteId_=this.allWrites_[this.allWrites_.length-1].writeId:this.lastWriteId_=-1},e.DefaultFilter_=function(e){return e.visible},e.layerTree_=function(e,t,n){for(var r=Pt.Empty,i=0;i<e.length;++i){var o=e[i];if(t(o)){var s=o.path,l=void 0;if(o.snap)n.contains(s)?(l=j.relativePath(n,s),r=r.addWrite(l,o.snap)):s.contains(n)&&(l=j.relativePath(s,n),r=r.addWrite(j.Empty,o.snap.getChild(l)));else{if(!o.children)throw Object(a.e)("WriteRecord should have .snap or .children");if(n.contains(s))l=j.relativePath(n,s),r=r.addWrites(l,o.children);else if(s.contains(n))if((l=j.relativePath(s,n)).isEmpty())r=r.addWrites(j.Empty,o.children);else{var u=Object(a.x)(o.children,l.getFront());if(u){var c=u.getChild(l.popFront());r=r.addWrite(j.Empty,c)}}}}}return r},e}(),Ot=function(){function e(e,t){this.treePath_=e,this.writeTree_=t}return e.prototype.calcCompleteEventCache=function(e,t,n){return this.writeTree_.calcCompleteEventCache(this.treePath_,e,t,n)},e.prototype.calcCompleteEventChildren=function(e){return this.writeTree_.calcCompleteEventChildren(this.treePath_,e)},e.prototype.calcEventCacheAfterServerOverwrite=function(e,t,n){return this.writeTree_.calcEventCacheAfterServerOverwrite(this.treePath_,e,t,n)},e.prototype.shadowingWrite=function(e){return this.writeTree_.shadowingWrite(this.treePath_.child(e))},e.prototype.calcIndexedSlice=function(e,t,n,r,i){return this.writeTree_.calcIndexedSlice(this.treePath_,e,t,n,r,i)},e.prototype.calcCompleteChild=function(e,t){return this.writeTree_.calcCompleteChild(this.treePath_,e,t)},e.prototype.child=function(t){return new e(this.treePath_.child(t),this.writeTree_)},e}(),Dt=function(){function e(e){this.listenProvider_=e,this.syncPointTree_=mt.Empty,this.pendingWriteTree_=new Lt,this.tagToQueryMap=new Map,this.queryToTagMap=new Map}return e.prototype.applyUserOverwrite=function(e,t,n,r){return this.pendingWriteTree_.addOverwrite(e,t,n,r),r?this.applyOperationToSyncPoints_(new yt(dt.User,e,t)):[]},e.prototype.applyUserMerge=function(e,t,n){this.pendingWriteTree_.addMerge(e,t,n);var r=mt.fromObject(t);return this.applyOperationToSyncPoints_(new gt(dt.User,e,r))},e.prototype.ackUserWrite=function(e,t){void 0===t&&(t=!1);var n=this.pendingWriteTree_.getWrite(e);if(this.pendingWriteTree_.removeWrite(e)){var r=mt.Empty;return null!=n.snap?r=r.set(j.Empty,!0):L(n.children,(function(e,t){r=r.set(new j(e),t)})),this.applyOperationToSyncPoints_(new pt(n.path,r,t))}return[]},e.prototype.applyServerOverwrite=function(e,t){return this.applyOperationToSyncPoints_(new yt(dt.Server,e,t))},e.prototype.applyServerMerge=function(e,t){var n=mt.fromObject(t);return this.applyOperationToSyncPoints_(new gt(dt.Server,e,n))},e.prototype.applyListenComplete=function(e){return this.applyOperationToSyncPoints_(new vt(dt.Server,e))},e.prototype.applyTaggedQueryOverwrite=function(t,n,r){var i=this.queryKeyForTag_(r);if(null!=i){var a=e.parseQueryKey_(i),o=a.path,s=a.queryId,l=j.relativePath(o,t),u=new yt(dt.forServerTaggedQuery(s),l,n);return this.applyTaggedOperation_(o,u)}return[]},e.prototype.applyTaggedQueryMerge=function(t,n,r){var i=this.queryKeyForTag_(r);if(i){var a=e.parseQueryKey_(i),o=a.path,s=a.queryId,l=j.relativePath(o,t),u=mt.fromObject(n),c=new gt(dt.forServerTaggedQuery(s),l,u);return this.applyTaggedOperation_(o,c)}return[]},e.prototype.applyTaggedListenComplete=function(t,n){var r=this.queryKeyForTag_(n);if(r){var i=e.parseQueryKey_(r),a=i.path,o=i.queryId,s=j.relativePath(a,t),l=new vt(dt.forServerTaggedQuery(o),s);return this.applyTaggedOperation_(a,l)}return[]},e.prototype.addEventRegistration=function(t,n){var r=t.path,i=null,o=!1;this.syncPointTree_.foreachOnPath(r,(function(e,t){var n=j.relativePath(e,r);i=i||t.getCompleteServerCache(n),o=o||t.hasCompleteView()}));var s,l=this.syncPointTree_.get(r);(l?(o=o||l.hasCompleteView(),i=i||l.getCompleteServerCache(j.Empty)):(l=new It,this.syncPointTree_=this.syncPointTree_.set(r,l)),null!=i)?s=!0:(s=!1,i=He.EMPTY_NODE,this.syncPointTree_.subtree(r).foreachChild((function(e,t){var n=t.getCompleteServerCache(j.Empty);n&&(i=i.updateImmediateChild(e,n))})));var u=l.viewExistsForQuery(t);if(!u&&!t.getQueryParams().loadsAllData()){var c=e.makeQueryKey_(t);Object(a.d)(!this.queryToTagMap.has(c),"View does not exist, but we have a tag");var h=e.getNextQueryTag_();this.queryToTagMap.set(c,h),this.tagToQueryMap.set(h,c)}var f=this.pendingWriteTree_.childWrites(r),d=l.addEventRegistration(t,n,f,i,s);if(!u&&!o){var p=l.viewForQuery(t);d=d.concat(this.setupListener_(t,p))}return d},e.prototype.removeEventRegistration=function(t,n,r){var i=this,a=t.path,o=this.syncPointTree_.get(a),s=[];if(o&&("default"===t.queryIdentifier()||o.viewExistsForQuery(t))){var l=o.removeEventRegistration(t,n,r);o.isEmpty()&&(this.syncPointTree_=this.syncPointTree_.remove(a));var u=l.removed;s=l.events;var c=-1!==u.findIndex((function(e){return e.getQueryParams().loadsAllData()})),h=this.syncPointTree_.findOnPath(a,(function(e,t){return t.hasCompleteView()}));if(c&&!h){var f=this.syncPointTree_.subtree(a);if(!f.isEmpty())for(var d=this.collectDistinctViewsForSubTree_(f),p=0;p<d.length;++p){var m=d[p],v=m.getQuery(),y=this.createListenerForView_(m);this.listenProvider_.startListening(e.queryForListening_(v),this.tagForQuery_(v),y.hashFn,y.onComplete)}}if(!h&&u.length>0&&!r)if(c){this.listenProvider_.stopListening(e.queryForListening_(t),null)}else u.forEach((function(t){var n=i.queryToTagMap.get(e.makeQueryKey_(t));i.listenProvider_.stopListening(e.queryForListening_(t),n)}));this.removeTags_(u)}return s},e.prototype.calcCompleteEventCache=function(e,t){var n=this.pendingWriteTree_,r=this.syncPointTree_.findOnPath(e,(function(t,n){var r=j.relativePath(t,e),i=n.getCompleteServerCache(r);if(i)return i}));return n.calcCompleteEventCache(e,r,t,!0)},e.prototype.collectDistinctViewsForSubTree_=function(e){return e.fold((function(e,t,n){if(t&&t.hasCompleteView())return[t.getCompleteView()];var r=[];return t&&(r=t.getQueryViews()),L(n,(function(e,t){r=r.concat(t)})),r}))},e.prototype.removeTags_=function(t){for(var n=0;n<t.length;++n){var r=t[n];if(!r.getQueryParams().loadsAllData()){var i=e.makeQueryKey_(r),a=this.queryToTagMap.get(i);this.queryToTagMap.delete(i),this.tagToQueryMap.delete(a)}}},e.queryForListening_=function(e){return e.getQueryParams().loadsAllData()&&!e.getQueryParams().isDefault()?e.getRef():e},e.prototype.setupListener_=function(t,n){var r=t.path,i=this.tagForQuery_(t),o=this.createListenerForView_(n),s=this.listenProvider_.startListening(e.queryForListening_(t),i,o.hashFn,o.onComplete),l=this.syncPointTree_.subtree(r);if(i)Object(a.d)(!l.value.hasCompleteView(),"If we're adding a query, it shouldn't be shadowed");else for(var u=l.fold((function(e,t,n){if(!e.isEmpty()&&t&&t.hasCompleteView())return[t.getCompleteView().getQuery()];var r=[];return t&&(r=r.concat(t.getQueryViews().map((function(e){return e.getQuery()})))),L(n,(function(e,t){r=r.concat(t)})),r})),c=0;c<u.length;++c){var h=u[c];this.listenProvider_.stopListening(e.queryForListening_(h),this.tagForQuery_(h))}return s},e.prototype.createListenerForView_=function(e){var t=this,n=e.getQuery(),r=this.tagForQuery_(n);return{hashFn:function(){return(e.getServerCache()||He.EMPTY_NODE).hash()},onComplete:function(e){if("ok"===e)return r?t.applyTaggedListenComplete(n.path,r):t.applyListenComplete(n.path);var i=function(e,t){var n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");var r=new Error(e+" at "+t.path.toString()+": "+n);return r.code=e.toUpperCase(),r}(e,n);return t.removeEventRegistration(n,null,i)}}},e.makeQueryKey_=function(e){return e.path.toString()+"$"+e.queryIdentifier()},e.parseQueryKey_=function(e){var t=e.indexOf("$");return Object(a.d)(-1!==t&&t<e.length-1,"Bad queryKey."),{queryId:e.substr(t+1),path:new j(e.substr(0,t))}},e.prototype.queryKeyForTag_=function(e){return this.tagToQueryMap.get(e)},e.prototype.tagForQuery_=function(t){var n=e.makeQueryKey_(t);return this.queryToTagMap.get(n)},e.getNextQueryTag_=function(){return e.nextQueryTag_++},e.prototype.applyTaggedOperation_=function(e,t){var n=this.syncPointTree_.get(e);Object(a.d)(n,"Missing sync point for query tag that we're tracking");var r=this.pendingWriteTree_.childWrites(e);return n.applyOperation(t,r,null)},e.prototype.applyOperationToSyncPoints_=function(e){return this.applyOperationHelper_(e,this.syncPointTree_,null,this.pendingWriteTree_.childWrites(j.Empty))},e.prototype.applyOperationHelper_=function(e,t,n,r){if(e.path.isEmpty())return this.applyOperationDescendantsHelper_(e,t,n,r);var i=t.get(j.Empty);null==n&&null!=i&&(n=i.getCompleteServerCache(j.Empty));var a=[],o=e.path.getFront(),s=e.operationForChild(o),l=t.children.get(o);if(l&&s){var u=n?n.getImmediateChild(o):null,c=r.child(o);a=a.concat(this.applyOperationHelper_(s,l,u,c))}return i&&(a=a.concat(i.applyOperation(e,r,n))),a},e.prototype.applyOperationDescendantsHelper_=function(e,t,n,r){var i=this,a=t.get(j.Empty);null==n&&null!=a&&(n=a.getCompleteServerCache(j.Empty));var o=[];return t.children.inorderTraversal((function(t,a){var s=n?n.getImmediateChild(t):null,l=r.child(t),u=e.operationForChild(t);u&&(o=o.concat(i.applyOperationDescendantsHelper_(u,a,s,l)))})),a&&(o=o.concat(a.applyOperation(e,r,n))),o},e.nextQueryTag_=1,e}(),Nt=function(){function e(){this.rootNode_=He.EMPTY_NODE}return e.prototype.getNode=function(e){return this.rootNode_.getChild(e)},e.prototype.updateSnapshot=function(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)},e}(),zt=function(){function e(){this.counters_={}}return e.prototype.incrementCounter=function(e,t){void 0===t&&(t=1),Object(a.h)(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t},e.prototype.get=function(){return Object(a.j)(this.counters_)},e}(),Ft=function(){function e(){}return e.getCollection=function(e){var t=e.toString();return this.collections_[t]||(this.collections_[t]=new zt),this.collections_[t]},e.getOrCreateReporter=function(e,t){var n=e.toString();return this.reporters_[n]||(this.reporters_[n]=t()),this.reporters_[n]},e.collections_={},e.reporters_={},e}(),Bt=function(){function e(e){this.collection_=e,this.last_=null}return e.prototype.get=function(){var e=this.collection_.get(),t=Object(i.a)({},e);return this.last_&&L(this.last_,(function(e,n){t[e]=t[e]-n})),this.last_=e,t},e}(),Ut=function(){function e(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Bt(e);var n=1e4+2e4*Math.random();U(this.reportStats_.bind(this),Math.floor(n))}return e.prototype.includeStat=function(e){this.statsToReport_[e]=!0},e.prototype.reportStats_=function(){var e=this,t=this.statsListener_.get(),n={},r=!1;L(t,(function(t,i){i>0&&Object(a.h)(e.statsToReport_,t)&&(n[t]=i,r=!0)})),r&&this.server_.reportStats(n),U(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},e}(),jt=function(){function e(){this.eventLists_=[],this.recursionDepth_=0}return e.prototype.queueEvents=function(e){for(var t=null,n=0;n<e.length;n++){var r=e[n],i=r.getPath();null===t||i.equals(t.getPath())||(this.eventLists_.push(t),t=null),null===t&&(t=new Vt(i)),t.add(r)}t&&this.eventLists_.push(t)},e.prototype.raiseEventsAtPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_((function(t){return t.equals(e)}))},e.prototype.raiseEventsForChangedPath=function(e,t){this.queueEvents(t),this.raiseQueuedEventsMatchingPredicate_((function(t){return t.contains(e)||e.contains(t)}))},e.prototype.raiseQueuedEventsMatchingPredicate_=function(e){this.recursionDepth_++;for(var t=!0,n=0;n<this.eventLists_.length;n++){var r=this.eventLists_[n];if(r)e(r.getPath())?(this.eventLists_[n].raise(),this.eventLists_[n]=null):t=!1}t&&(this.eventLists_=[]),this.recursionDepth_--},e}(),Vt=function(){function e(e){this.path_=e,this.events_=[]}return e.prototype.add=function(e){this.events_.push(e)},e.prototype.raise=function(){for(var e=0;e<this.events_.length;e++){var t=this.events_[e];if(null!==t){this.events_[e]=null;var n=t.getEventRunner();y&&b("event: "+t.toString()),B(n)}}},e.prototype.getPath=function(){return this.path_},e}(),Ht=function(){function e(e){this.allowedEvents_=e,this.listeners_={},Object(a.d)(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}return e.prototype.trigger=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(Array.isArray(this.listeners_[e]))for(var r=Object(i.f)(this.listeners_[e]),a=0;a<r.length;a++)r[a].callback.apply(r[a].context,t)},e.prototype.on=function(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});var r=this.getInitialEvent(e);r&&t.apply(n,r)},e.prototype.off=function(e,t,n){this.validateEventType_(e);for(var r=this.listeners_[e]||[],i=0;i<r.length;i++)if(r[i].callback===t&&(!n||n===r[i].context))return void r.splice(i,1)},e.prototype.validateEventType_=function(e){Object(a.d)(this.allowedEvents_.find((function(t){return t===e})),"Unknown event: "+e)},e}(),Gt=function(e){function t(){var t,n,r=e.call(this,["visible"])||this;return"undefined"!==typeof document&&"undefined"!==typeof document.addEventListener&&("undefined"!==typeof document.hidden?(n="visibilitychange",t="hidden"):"undefined"!==typeof document.mozHidden?(n="mozvisibilitychange",t="mozHidden"):"undefined"!==typeof document.msHidden?(n="msvisibilitychange",t="msHidden"):"undefined"!==typeof document.webkitHidden&&(n="webkitvisibilitychange",t="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,(function(){var e=!document[t];e!==r.visible_&&(r.visible_=e,r.trigger("visible",e))}),!1),r}return Object(i.c)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return Object(a.d)("visible"===e,"Unknown event type: "+e),[this.visible_]},t}(Ht),Wt=function(e){function t(){var t=e.call(this,["online"])||this;return t.online_=!0,"undefined"===typeof window||"undefined"===typeof window.addEventListener||Object(a.p)()||(window.addEventListener("online",(function(){t.online_||(t.online_=!0,t.trigger("online",!0))}),!1),window.addEventListener("offline",(function(){t.online_&&(t.online_=!1,t.trigger("online",!1))}),!1)),t}return Object(i.c)(t,e),t.getInstance=function(){return new t},t.prototype.getInitialEvent=function(e){return Object(a.d)("online"===e,"Unknown event type: "+e),[this.online_]},t.prototype.currentlyOnline=function(){return this.online_},t}(Ht),qt=function(){function e(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return e.prototype.closeAfter=function(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},e.prototype.handleResponse=function(e,t){var n=this;this.pendingResponses[e]=t;for(var r=function(){var e=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var t=function(t){e[t]&&B((function(){n.onMessage_(e[t])}))},r=0;r<e.length;++r)t(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum];){if("break"===r())break}},e}(),Xt="start",Zt="close",Kt=function(){function e(e,t,n,r,i){this.connId=e,this.repoInfo=t,this.applicationId=n,this.transportSessionId=r,this.lastSessionId=i,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=x(e),this.stats_=Ft.getCollection(t),this.urlFn=function(e){return t.connectionURL(q,e)}}return e.prototype.open=function(e,t){var n=this;this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new qt(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if(Object(a.r)()||"complete"===document.readyState)e();else{var t=!1,n=function n(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(function(){"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((function(){if(!n.isClosed_){n.scriptTagHolder=new Yt((function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Object(i.e)(e,5),a=r[0],o=r[1],s=r[2];r[3],r[4];if(n.incrementIncomingBytes_(e),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,a===Xt)n.id=o,n.password=s;else{if(a!==Zt)throw new Error("Unrecognized command received: "+a);o?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(o,(function(){n.onClosed_()}))):n.onClosed_()}}),(function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=Object(i.e)(e,2),a=r[0],o=r[1];n.incrementIncomingBytes_(e),n.myPacketOrderer.handleResponse(a,o)}),(function(){n.onClosed_()}),n.urlFn);var e={start:"t"};e.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=n.scriptTagHolder.uniqueCallbackIdentifier),e.v=H,n.transportSessionId&&(e.s=n.transportSessionId),n.lastSessionId&&(e.ls=n.lastSessionId),n.applicationId&&(e.p=n.applicationId),"undefined"!==typeof location&&location.hostname&&G.test(location.hostname)&&(e.r="f");var t=n.urlFn(e);n.log_("Connecting via long-poll to "+t),n.scriptTagHolder.addTag(t,(function(){}))}}))},e.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},e.forceAllow=function(){e.forceAllow_=!0},e.forceDisallow=function(){e.forceDisallow_=!0},e.isAvailable=function(){return!Object(a.r)()&&(!!e.forceAllow_||!e.forceDisallow_&&"undefined"!==typeof document&&null!=document.createElement&&!("object"===typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))&&!("object"===typeof Windows&&"object"===typeof Windows.UI))},e.prototype.markConnectionHealthy=function(){},e.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},e.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},e.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},e.prototype.send=function(e){var t=Object(a.A)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);for(var n=Object(a.g)(t),r=R(n,1840),i=0;i<r.length;i++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[i]),this.curSegmentNum++},e.prototype.addDisconnectPingFrame=function(e,t){if(!Object(a.r)()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},e.prototype.incrementIncomingBytes_=function(e){var t=Object(a.A)(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)},e}(),Yt=function(){function e(t,n,r,i){if(this.onDisconnect=r,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Object(a.r)())this.commandCB=t,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=p(),window["pLPCommand"+this.uniqueCallbackIdentifier]=t,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=e.createIFrame_();var o="";if(this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length))o='<script>document.domain="'+document.domain+'";<\/script>';var s="<html><body>"+o+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(s),this.myIFrame.doc.close()}catch(l){b("frame writing exception"),l.stack&&b(l.stack),b(l)}}}return e.createIFrame_=function(){var e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||b("No IE domain setting required")}catch(n){var t=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+t+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e},e.prototype.close=function(){var e=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((function(){null!==e.myIFrame&&(document.body.removeChild(e.myIFrame),e.myIFrame=null)}),Math.floor(0)));var t=this.onDisconnect;t&&(this.onDisconnect=null,t())},e.prototype.startLongPoll=function(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););},e.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;for(var t=this.urlFn(e),n="",r=0;this.pendingSegs.length>0;){if(!(this.pendingSegs[0].d.length+30+n.length<=1870))break;var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1},e.prototype.enqueueSegment=function(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()},e.prototype.addLongPollTag_=function(e,t){var n=this;this.outstandingRequests.add(t);var r=function(){n.outstandingRequests.delete(t),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(e,(function(){clearTimeout(i),r()}))},e.prototype.addTag=function(e,t){var n=this;Object(a.r)()?this.doNodeLongPoll(e,t):setTimeout((function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=e,r.onload=r.onreadystatechange=function(){var e=r.readyState;e&&"loaded"!==e&&"complete"!==e||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),t())},r.onerror=function(){b("Long-poll script failed to load: "+e),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(i){}}),Math.floor(1))},e}(),Jt="";function Qt(e){Jt=e}var $t=null;"undefined"!==typeof MozWebSocket?$t=MozWebSocket:"undefined"!==typeof WebSocket&&($t=WebSocket);var en=function(){function t(e,n,r,i,a){this.connId=e,this.applicationId=r,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=x(this.connId),this.stats_=Ft.getCollection(n),this.connURL=t.connectionURL_(n,i,a),this.nodeAdmin=n.nodeAdmin}return t.connectionURL_=function(e,t,n){var r={};return r.v=H,!Object(a.r)()&&"undefined"!==typeof location&&location.hostname&&G.test(location.hostname)&&(r.r="f"),t&&(r.s=t),n&&(r.ls=n),e.connectionURL(W,r)},t.prototype.open=function(t,n){var r=this;this.onDisconnect=n,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,h.set("previous_websocket_failure",!0);try{if(Object(a.r)()){var i=this.nodeAdmin?"AdminNode":"Node",o={headers:{"User-Agent":"Firebase/5/"+Jt+"/"+e.platform+"/"+i,"X-Firebase-GMPID":this.applicationId||""}},s=Object({NODE_ENV:"production",PUBLIC_URL:"/tokyo-survival-pub",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_FIREBASE_API_KEY:"AIzaSyBMgLpqdddgG5plQhhTFN3KmNwMtCquK6s",REACT_APP_FIREBASE_APP_ID:"1:953032005701:web:df56c5e173995c61a3ab2c",REACT_APP_FIREBASE_AUTH_DOMAIN:"tokyo-survival.firebaseapp.com",REACT_APP_FIREBASE_DATABASE_URL:"https://tokyo-survival-default-rtdb.firebaseio.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"953032005701",REACT_APP_FIREBASE_PROJECT_ID:"tokyo-survival",REACT_APP_FIREBASE_STORAGE_BUCKET:"tokyo-survival.appspot.com",REACT_APP_MAPBOX_ACCESS_TOKEN:"pk.eyJ1IjoiaGlzYXlhbiIsImEiOiJja2wwODR2d2gzOGF0MnFxbmJjbGFneWpxIn0.a0Dl2YtxhvWoXDsJK_THSg"}),l=0===this.connURL.indexOf("wss://")?s.HTTPS_PROXY||s.https_proxy:s.HTTP_PROXY||s.http_proxy;l&&(o.proxy={origin:l}),this.mySock=new $t(this.connURL,[],o)}else{o={headers:{"X-Firebase-GMPID":this.applicationId||""}};this.mySock=new $t(this.connURL,[],o)}}catch(c){this.log_("Error instantiating WebSocket.");var u=c.message||c.data;return u&&this.log_(u),void this.onClosed_()}this.mySock.onopen=function(){r.log_("Websocket connected."),r.everConnected_=!0},this.mySock.onclose=function(){r.log_("Websocket connection was disconnected."),r.mySock=null,r.onClosed_()},this.mySock.onmessage=function(e){r.handleIncomingFrame(e)},this.mySock.onerror=function(e){r.log_("WebSocket error.  Closing connection.");var t=e.message||e.data;t&&r.log_(t),r.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1;if("undefined"!==typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==$t&&!t.forceDisallow_},t.previouslyFailed=function(){return h.isInMemoryStorage||!0===h.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){h.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(e){if(this.frames.push(e),this.frames.length===this.totalFrames){var t=this.frames.join("");this.frames=null;var n=Object(a.u)(t);this.onMessage(n)}},t.prototype.handleNewFrameCount_=function(e){this.totalFrames=e,this.frames=[]},t.prototype.extractFrameCount_=function(e){if(Object(a.d)(null===this.frames,"We already have a frame buffer"),e.length<=6){var t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e},t.prototype.handleIncomingFrame=function(e){if(null!==this.mySock){var t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{var n=this.extractFrameCount_(t);null!==n&&this.appendFrame_(n)}}},t.prototype.send=function(e){this.resetKeepAlive();var t=Object(a.A)(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);var n=R(t,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var e=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((function(){e.mySock&&e.sendString_("0"),e.resetKeepAlive()}),Math.floor(45e3))},t.prototype.sendString_=function(e){try{this.mySock.send(e)}catch(t){this.log_("Exception thrown from WebSocket.send():",t.message||t.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),tn=function(){function e(e){this.initTransports_(e)}return Object.defineProperty(e,"ALL_TRANSPORTS",{get:function(){return[Kt,en]},enumerable:!1,configurable:!0}),e.prototype.initTransports_=function(t){var n,r,a=en&&en.isAvailable(),o=a&&!en.previouslyFailed();if(t.webSocketOnly&&(a||S("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[en];else{var s=this.transports_=[];try{for(var l=Object(i.g)(e.ALL_TRANSPORTS),u=l.next();!u.done;u=l.next()){var c=u.value;c&&c.isAvailable()&&s.push(c)}}catch(h){n={error:h}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}},e.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},e.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},e}(),nn=function(){function e(e,t,n,r,i,a,o,s){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.onMessage_=r,this.onReady_=i,this.onDisconnect_=a,this.onKill_=o,this.lastSessionId=s,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=x("c:"+this.id+":"),this.transportManager_=new tn(t),this.log_("Connection created"),this.start_()}return e.prototype.start_=function(){var e=this,t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,void 0,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((function(){e.conn_&&e.conn_.open(n,r)}),Math.floor(0));var i=t.healthyTimeout||0;i>0&&(this.healthyTimeout_=U((function(){e.healthyTimeout_=null,e.isHealthy_||(e.conn_&&e.conn_.bytesReceived>102400?(e.log_("Connection exceeded healthy timeout but has received "+e.conn_.bytesReceived+" bytes.  Marking connection healthy."),e.isHealthy_=!0,e.conn_.markConnectionHealthy()):e.conn_&&e.conn_.bytesSent>10240?e.log_("Connection exceeded healthy timeout but has sent "+e.conn_.bytesSent+" bytes.  Leaving connection alive."):(e.log_("Closing unhealthy connection after timeout."),e.close()))}),Math.floor(i)))},e.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},e.prototype.disconnReceiver_=function(e){var t=this;return function(n){e===t.conn_?t.onConnectionLost_(n):e===t.secondaryConn_?(t.log_("Secondary connection lost."),t.onSecondaryConnectionLost_()):t.log_("closing an old connection")}},e.prototype.connReceiver_=function(e){var t=this;return function(n){2!==t.state_&&(e===t.rx_?t.onPrimaryMessageReceived_(n):e===t.secondaryConn_?t.onSecondaryMessageReceived_(n):t.log_("message on old connection"))}},e.prototype.sendRequest=function(e){var t={t:"d",d:e};this.sendData_(t)},e.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},e.prototype.onSecondaryControl_=function(e){if("t"in e){var t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},e.prototype.onSecondaryMessageReceived_=function(e){var t=I("t",e),n=I("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}},e.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},e.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},e.prototype.onPrimaryMessageReceived_=function(e){var t=I("t",e),n=I("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)},e.prototype.onDataMessage_=function(e){this.onPrimaryResponse_(),this.onMessage_(e)},e.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},e.prototype.onControl_=function(e){var t=I("t",e);if("d"in e){var n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?w("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):w("Unknown control packet command: "+t)}},e.prototype.onHandshake_=function(e){var t=e.ts,n=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.updateHost(r),0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),H!==n&&S("Protocol version mismatch detected"),this.tryStartUpgrade_())},e.prototype.tryStartUpgrade_=function(){var e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)},e.prototype.startUpgrade_=function(e){var t=this;this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),U((function(){t.secondaryConn_&&(t.log_("Timed out trying to upgrade."),t.secondaryConn_.close())}),Math.floor(6e4))},e.prototype.onReset_=function(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.updateHost(e),1===this.state_?this.close():(this.closeConnections_(),this.start_())},e.prototype.onConnectionEstablished_=function(e,t){var n=this;this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):U((function(){n.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))},e.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},e.prototype.onSecondaryConnectionLost_=function(){var e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()},e.prototype.onConnectionLost_=function(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(h.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},e.prototype.onConnectionShutdown_=function(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()},e.prototype.sendData_=function(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)},e.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},e.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},e}(),rn=function(){function e(){}return e.prototype.put=function(e,t,n,r){},e.prototype.merge=function(e,t,n,r){},e.prototype.refreshAuthToken=function(e){},e.prototype.onDisconnectPut=function(e,t,n){},e.prototype.onDisconnectMerge=function(e,t,n){},e.prototype.onDisconnectCancel=function(e,t){},e.prototype.reportStats=function(e){},e}(),an=1e3,on=function(e){function t(n,r,i,o,s,l,u){var c=e.call(this)||this;if(c.repoInfo_=n,c.applicationId_=r,c.onDataUpdate_=i,c.onConnectStatus_=o,c.onServerInfoUpdate_=s,c.authTokenProvider_=l,c.authOverride_=u,c.id=t.nextPersistentConnectionId_++,c.log_=x("p:"+c.id+":"),c.interruptReasons_={},c.listens=new Map,c.outstandingPuts_=[],c.outstandingGets_=[],c.outstandingPutCount_=0,c.outstandingGetCount_=0,c.onDisconnectRequestQueue_=[],c.connected_=!1,c.reconnectDelay_=an,c.maxReconnectDelay_=3e5,c.securityDebugCallback_=null,c.lastSessionId=null,c.establishConnectionTimer_=null,c.visible_=!1,c.requestCBHash_={},c.requestNumber_=0,c.realtime_=null,c.authToken_=null,c.forceTokenRefresh_=!1,c.invalidAuthTokenCount_=0,c.firstConnection_=!0,c.lastConnectionAttemptTime_=null,c.lastConnectionEstablishedTime_=null,u&&!Object(a.r)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return c.scheduleConnect_(0),Gt.getInstance().on("visible",c.onVisible_,c),-1===n.host.indexOf("fblocal")&&Wt.getInstance().on("online",c.onOnline_,c),c}return Object(i.c)(t,e),t.prototype.sendRequest=function(e,t,n){var r=++this.requestNumber_,i={r:r,a:e,b:t};this.log_(Object(a.A)(i)),Object(a.d)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(i),n&&(this.requestCBHash_[r]=n)},t.prototype.get=function(e){var t=this,n=new a.a,r={p:e.path.toString(),q:e.queryObject()},i={action:"g",request:r,onComplete:function(e){var i=e.d;"ok"===e.s?(t.onDataUpdate_(r.p,i,!1,null),n.resolve(i)):n.reject(i)}};this.outstandingGets_.push(i),this.outstandingGetCount_++;var o=this.outstandingGets_.length-1;return this.connected_||setTimeout((function(){var e=t.outstandingGets_[o];void 0!==e&&i===e&&(delete t.outstandingGets_[o],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),t.log_("get "+o+" timed out on connection"),n.reject(new Error("Client is offline.")))}),3e3),this.connected_&&this.sendGet_(o),n.promise},t.prototype.listen=function(e,t,n,r){var i=e.queryIdentifier(),o=e.path.toString();this.log_("Listen called for "+o+" "+i),this.listens.has(o)||this.listens.set(o,new Map),Object(a.d)(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"listen() called for non-default but complete query"),Object(a.d)(!this.listens.get(o).has(i),"listen() called twice for same path/queryId.");var s={onComplete:r,hashFn:t,query:e,tag:n};this.listens.get(o).set(i,s),this.connected_&&this.sendListen_(s)},t.prototype.sendGet_=function(e){var t=this,n=this.outstandingGets_[e];this.sendRequest("g",n.request,(function(r){delete t.outstandingGets_[e],t.outstandingGetCount_--,0===t.outstandingGetCount_&&(t.outstandingGets_=[]),n.onComplete&&n.onComplete(r)}))},t.prototype.sendListen_=function(e){var n=this,r=e.query,i=r.path.toString(),a=r.queryIdentifier();this.log_("Listen on "+i+" for "+a);var o={p:i};e.tag&&(o.q=r.queryObject(),o.t=e.tag),o.h=e.hashFn(),this.sendRequest("q",o,(function(o){var s=o.d,l=o.s;t.warnOnListenWarnings_(s,r),(n.listens.get(i)&&n.listens.get(i).get(a))===e&&(n.log_("listen response",o),"ok"!==l&&n.removeListen_(i,a),e.onComplete&&e.onComplete(l,s))}))},t.warnOnListenWarnings_=function(e,t){if(e&&"object"===typeof e&&Object(a.h)(e,"w")){var n=Object(a.x)(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+t.getQueryParams().getIndex().toString()+'"',i=t.path.toString();S("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+i+" to your security rules for better performance.")}}},t.prototype.refreshAuthToken=function(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(function(){})),this.reduceReconnectDelayIfAdminCredential_(e)},t.prototype.reduceReconnectDelayIfAdminCredential_=function(e){(e&&40===e.length||Object(a.m)(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},t.prototype.tryAuth=function(){var e=this;if(this.connected_&&this.authToken_){var t=this.authToken_,n=Object(a.t)(t)?"auth":"gauth",r={cred:t};null===this.authOverride_?r.noauth=!0:"object"===typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,(function(n){var r=n.s,i=n.d||"error";e.authToken_===t&&("ok"===r?e.invalidAuthTokenCount_=0:e.onAuthRevoked_(r,i))}))}},t.prototype.unlisten=function(e,t){var n=e.path.toString(),r=e.queryIdentifier();this.log_("Unlisten called for "+n+" "+r),Object(a.d)(e.getQueryParams().isDefault()||!e.getQueryParams().loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,e.queryObject(),t)},t.prototype.sendUnlisten_=function(e,t,n,r){this.log_("Unlisten on "+e+" for "+t);var i={p:e};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},t.prototype.onDisconnectPut=function(e,t,n){this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})},t.prototype.onDisconnectMerge=function(e,t,n){this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})},t.prototype.onDisconnectCancel=function(e,t){this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})},t.prototype.sendOnDisconnect_=function(e,t,n,r){var i={p:t,d:n};this.log_("onDisconnect "+e,i),this.sendRequest(e,i,(function(e){r&&setTimeout((function(){r(e.s,e.d)}),Math.floor(0))}))},t.prototype.put=function(e,t,n,r){this.putInternal("p",e,t,n,r)},t.prototype.merge=function(e,t,n,r){this.putInternal("m",e,t,n,r)},t.prototype.putInternal=function(e,t,n,r,i){var a={p:t,d:n};void 0!==i&&(a.h=i),this.outstandingPuts_.push({action:e,request:a,onComplete:r}),this.outstandingPutCount_++;var o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)},t.prototype.sendPut_=function(e){var t=this,n=this.outstandingPuts_[e].action,r=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(n,r,(function(r){t.log_(n+" response",r),delete t.outstandingPuts_[e],t.outstandingPutCount_--,0===t.outstandingPutCount_&&(t.outstandingPuts_=[]),i&&i(r.s,r.d)}))},t.prototype.reportStats=function(e){var t=this;if(this.connected_){var n={c:e};this.log_("reportStats",n),this.sendRequest("s",n,(function(e){if("ok"!==e.s){var n=e.d;t.log_("reportStats","Error sending stats: "+n)}}))}},t.prototype.onDataMessage_=function(e){if("r"in e){this.log_("from server: "+Object(a.A)(e));var t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}},t.prototype.onDataPush_=function(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):w("Unrecognized action received from server: "+Object(a.A)(e)+"\nAre you using the latest client?")},t.prototype.onReady_=function(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},t.prototype.scheduleConnect_=function(e){var t=this;Object(a.d)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((function(){t.establishConnectionTimer_=null,t.establishConnection_()}),Math.floor(e))},t.prototype.onVisible_=function(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=an,this.realtime_||this.scheduleConnect_(0)),this.visible_=e},t.prototype.onOnline_=function(e){e?(this.log_("Browser went online."),this.reconnectDelay_=an,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},t.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){if(this.visible_){if(this.lastConnectionEstablishedTime_){(new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=an),this.lastConnectionEstablishedTime_=null}}else this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime();var e=(new Date).getTime()-this.lastConnectionAttemptTime_,t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},t.prototype.establishConnection_=function(){var e=this;if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;var n=this.onDataMessage_.bind(this),r=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),o=this.id+":"+t.nextConnectionId_++,s=this,l=this.lastSessionId,u=!1,c=null,h=function(){c?c.close():(u=!0,i())};this.realtime_={close:h,sendRequest:function(e){Object(a.d)(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(e)}};var f=this.forceTokenRefresh_;this.forceTokenRefresh_=!1,this.authTokenProvider_.getToken(f).then((function(e){u?b("getToken() completed but was canceled"):(b("getToken() completed. Creating connection."),s.authToken_=e&&e.accessToken,c=new nn(o,s.repoInfo_,s.applicationId_,n,r,i,(function(e){S(e+" ("+s.repoInfo_.toString()+")"),s.interrupt("server_kill")}),l))})).then(null,(function(t){s.log_("Failed to get token: "+t),u||(e.repoInfo_.nodeAdmin&&S(t),h())}))}},t.prototype.interrupt=function(e){b("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},t.prototype.resume=function(e){b("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Object(a.o)(this.interruptReasons_)&&(this.reconnectDelay_=an,this.realtime_||this.scheduleConnect_(0))},t.prototype.handleTimestamp_=function(e){var t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})},t.prototype.cancelSentTransactions_=function(){for(var e=0;e<this.outstandingPuts_.length;e++){var t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},t.prototype.onListenRevoked_=function(e,t){var n;n=t?t.map((function(e){return P(e)})).join("$"):"default";var r=this.removeListen_(e,n);r&&r.onComplete&&r.onComplete("permission_denied")},t.prototype.removeListen_=function(e,t){var n,r=new j(e).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(t),i.delete(t),0===i.size&&this.listens.delete(r)}else n=void 0;return n},t.prototype.onAuthRevoked_=function(e,t){b("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},t.prototype.onSecurityDebugPacket_=function(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))},t.prototype.restoreState_=function(){var e,t,n,r;this.tryAuth();try{for(var a=Object(i.g)(this.listens.values()),o=a.next();!o.done;o=a.next()){var s=o.value;try{for(var l=(n=void 0,Object(i.g)(s.values())),u=l.next();!u.done;u=l.next()){var c=u.value;this.sendListen_(c)}}catch(d){n={error:d}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}}catch(p){e={error:p}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}for(var h=0;h<this.outstandingPuts_.length;h++)this.outstandingPuts_[h]&&this.sendPut_(h);for(;this.onDisconnectRequestQueue_.length;){var f=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(f.action,f.pathString,f.data,f.onComplete)}for(h=0;h<this.outstandingGets_.length;h++)this.outstandingGets_[h]&&this.sendGet_(h)},t.prototype.sendConnectStats_=function(){var e={},t="js";Object(a.r)()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+Jt.replace(/\./g,"-")]=1,Object(a.p)()?e["framework.cordova"]=1:Object(a.s)()&&(e["framework.reactnative"]=1),this.reportStats(e)},t.prototype.shouldReconnect_=function(){var e=Wt.getInstance().currentlyOnline();return Object(a.o)(this.interruptReasons_)&&e},t.nextPersistentConnectionId_=0,t.nextConnectionId_=0,t}(rn),sn=function(e){function t(t,n,r){var i=e.call(this)||this;return i.repoInfo_=t,i.onDataUpdate_=n,i.authTokenProvider_=r,i.log_=x("p:rest:"),i.listens_={},i}return Object(i.c)(t,e),t.prototype.reportStats=function(e){throw new Error("Method not implemented.")},t.getListenId_=function(e,t){return void 0!==t?"tag$"+t:(Object(a.d)(e.getQueryParams().isDefault(),"should have a tag if it's not a default query."),e.path.toString())},t.prototype.listen=function(e,n,r,i){var o=this,s=e.path.toString();this.log_("Listen called for "+s+" "+e.queryIdentifier());var l=t.getListenId_(e,r),u={};this.listens_[l]=u;var c=e.getQueryParams().toRestQueryStringParameters();this.restRequest_(s+".json",c,(function(e,t){var n=t;(404===e&&(n=null,e=null),null===e&&o.onDataUpdate_(s,n,!1,r),Object(a.x)(o.listens_,l)===u)&&i(e?401===e?"permission_denied":"rest_error:"+e:"ok",null)}))},t.prototype.unlisten=function(e,n){var r=t.getListenId_(e,n);delete this.listens_[r]},t.prototype.get=function(e){var t=this,n=e.getQueryParams().toRestQueryStringParameters(),r=e.path.toString(),i=new a.a;return this.restRequest_(r+".json",n,(function(e,n){var a=n;404===e&&(a=null,e=null),null===e?(t.onDataUpdate_(r,a,!1,null),i.resolve(a)):i.reject(new Error(a))})),i.promise},t.prototype.refreshAuthToken=function(e){},t.prototype.restRequest_=function(e,t,n){var r=this;void 0===t&&(t={}),t.format="export",this.authTokenProvider_.getToken(!1).then((function(i){var o=i&&i.accessToken;o&&(t.auth=o);var s=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+e+"?ns="+r.repoInfo_.namespace+Object(a.w)(t);r.log_("Sending REST request for "+s);var l=new XMLHttpRequest;l.onreadystatechange=function(){if(n&&4===l.readyState){r.log_("REST Response for "+s+" received. status:",l.status,"response:",l.responseText);var e=null;if(l.status>=200&&l.status<300){try{e=Object(a.u)(l.responseText)}catch(t){S("Failed to parse JSON response for "+s+": "+l.responseText)}n(null,e)}else 401!==l.status&&404!==l.status&&S("Got unsuccessful REST response for "+s+" Status: "+l.status),n(l.status);n=null}},l.open("GET",s,!0),l.send()}))},t}(rn),ln="repo_interrupt",un=function(){function e(e,t,n,r){this.repoInfo_=e,this.forceRestClient_=t,this.app=n,this.authTokenProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new jt,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=new ct,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}return e.prototype.start=function(){var e=this;if(this.stats_=Ft.getCollection(this.repoInfo_),this.forceRestClient_||("object"===typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)this.server_=new sn(this.repoInfo_,this.onDataUpdate_.bind(this),this.authTokenProvider_),setTimeout(this.onConnectStatus_.bind(this,!0),0);else{var t=this.app.options.databaseAuthVariableOverride;if("undefined"!==typeof t&&null!==t){if("object"!==typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Object(a.A)(t)}catch(n){throw new Error("Invalid authOverride provided: "+n)}}this.persistentConnection_=new on(this.repoInfo_,this.app.options.appId,this.onDataUpdate_.bind(this),this.onConnectStatus_.bind(this),this.onServerInfoUpdate_.bind(this),this.authTokenProvider_,t),this.server_=this.persistentConnection_}this.authTokenProvider_.addTokenChangeListener((function(t){e.server_.refreshAuthToken(t)})),this.statsReporter_=Ft.getOrCreateReporter(this.repoInfo_,(function(){return new Ut(e.stats_,e.server_)})),this.transactionsInit_(),this.infoData_=new Nt,this.infoSyncTree_=new Dt({startListening:function(t,n,r,i){var a=[],o=e.infoData_.getNode(t.path);return o.isEmpty()||(a=e.infoSyncTree_.applyServerOverwrite(t.path,o),setTimeout((function(){i("ok")}),0)),a},stopListening:function(){}}),this.updateInfo_("connected",!1),this.serverSyncTree_=new Dt({startListening:function(t,n,r,i){return e.server_.listen(t,r,n,(function(n,r){var a=i(n,r);e.eventQueue_.raiseEventsForChangedPath(t.path,a)})),[]},stopListening:function(t,n){e.server_.unlisten(t,n)}})},e.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},e.prototype.name=function(){return this.repoInfo_.namespace},e.prototype.serverTime=function(){var e=this.infoData_.getNode(new j(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e},e.prototype.generateServerValues=function(){return(e=(e={timestamp:this.serverTime()})||{}).timestamp=e.timestamp||(new Date).getTime(),e;var e},e.prototype.onDataUpdate_=function(e,t,n,r){this.dataUpdateCount++;var i=new j(e);t=this.interceptServerDataCallback_?this.interceptServerDataCallback_(e,t):t;var o=[];if(r)if(n){var s=Object(a.v)(t,(function(e){return We(e)}));o=this.serverSyncTree_.applyTaggedQueryMerge(i,s,r)}else{var l=We(t);o=this.serverSyncTree_.applyTaggedQueryOverwrite(i,l,r)}else if(n){var u=Object(a.v)(t,(function(e){return We(e)}));o=this.serverSyncTree_.applyServerMerge(i,u)}else{var c=We(t);o=this.serverSyncTree_.applyServerOverwrite(i,c)}var h=i;o.length>0&&(h=this.rerunTransactions_(i)),this.eventQueue_.raiseEventsForChangedPath(h,o)},e.prototype.interceptServerData_=function(e){this.interceptServerDataCallback_=e},e.prototype.onConnectStatus_=function(e){this.updateInfo_("connected",e),!1===e&&this.runOnDisconnectEvents_()},e.prototype.onServerInfoUpdate_=function(e){var t=this;L(e,(function(e,n){t.updateInfo_(e,n)}))},e.prototype.updateInfo_=function(e,t){var n=new j("/.info/"+e),r=We(t);this.infoData_.updateSnapshot(n,r);var i=this.infoSyncTree_.applyServerOverwrite(n,r);this.eventQueue_.raiseEventsForChangedPath(n,i)},e.prototype.getNextWriteId_=function(){return this.nextWriteId_++},e.prototype.getValue=function(e){var t=this,n=this.serverSyncTree_.calcCompleteEventCache(e.path);return n.isEmpty()?this.server_.get(e).then((function(n){var r=We(n),i=t.serverSyncTree_.applyServerOverwrite(e.path,r);return t.eventQueue_.raiseEventsAtPath(e.path,i),Promise.resolve(new Ke(r,e.getRef(),e.getQueryParams().getIndex()))}),(function(n){return t.log_("get for query "+Object(a.A)(e)+" failed: "+n),Promise.reject(new Error(n))})):Promise.resolve(new Ke(n,e.getRef(),e.getQueryParams().getIndex()))},e.prototype.setWithPriority=function(e,t,n,r){var i=this;this.log_("set",{path:e.toString(),value:t,priority:n});var a=this.generateServerValues(),o=We(t,n),s=this.serverSyncTree_.calcCompleteEventCache(e),l=st(o,s,a),u=this.getNextWriteId_(),c=this.serverSyncTree_.applyUserOverwrite(e,l,u,!0);this.eventQueue_.queueEvents(c),this.server_.put(e.toString(),o.val(!0),(function(t,n){var a="ok"===t;a||S("set at "+e+" failed: "+t);var o=i.serverSyncTree_.ackUserWrite(u,!a);i.eventQueue_.raiseEventsForChangedPath(e,o),i.callOnCompleteCallback(r,t,n)}));var h=this.abortTransactions_(e);this.rerunTransactions_(h),this.eventQueue_.raiseEventsForChangedPath(h,[])},e.prototype.update=function(e,t,n){var r=this;this.log_("update",{path:e.toString(),value:t});var i=!0,a=this.generateServerValues(),o={};if(L(t,(function(t,n){i=!1,o[t]=ot(e.child(t),We(n),r.serverSyncTree_,a)})),i)b("update() called with empty data.  Don't do anything."),this.callOnCompleteCallback(n,"ok");else{var s=this.getNextWriteId_(),l=this.serverSyncTree_.applyUserMerge(e,o,s);this.eventQueue_.queueEvents(l),this.server_.merge(e.toString(),t,(function(t,i){var a="ok"===t;a||S("update at "+e+" failed: "+t);var o=r.serverSyncTree_.ackUserWrite(s,!a),l=o.length>0?r.rerunTransactions_(e):e;r.eventQueue_.raiseEventsForChangedPath(l,o),r.callOnCompleteCallback(n,t,i)})),L(t,(function(t){var n=r.abortTransactions_(e.child(t));r.rerunTransactions_(n)})),this.eventQueue_.raiseEventsForChangedPath(e,[])}},e.prototype.runOnDisconnectEvents_=function(){var e=this;this.log_("onDisconnectEvents");var t=this.generateServerValues(),n=new ct;this.onDisconnect_.forEachTree(j.Empty,(function(r,i){var a=ot(r,i,e.serverSyncTree_,t);n.remember(r,a)}));var r=[];n.forEachTree(j.Empty,(function(t,n){r=r.concat(e.serverSyncTree_.applyServerOverwrite(t,n));var i=e.abortTransactions_(t);e.rerunTransactions_(i)})),this.onDisconnect_=new ct,this.eventQueue_.raiseEventsForChangedPath(j.Empty,r)},e.prototype.onDisconnectCancel=function(e,t){var n=this;this.server_.onDisconnectCancel(e.toString(),(function(r,i){"ok"===r&&n.onDisconnect_.forget(e),n.callOnCompleteCallback(t,r,i)}))},e.prototype.onDisconnectSet=function(e,t,n){var r=this,i=We(t);this.server_.onDisconnectPut(e.toString(),i.val(!0),(function(t,a){"ok"===t&&r.onDisconnect_.remember(e,i),r.callOnCompleteCallback(n,t,a)}))},e.prototype.onDisconnectSetWithPriority=function(e,t,n,r){var i=this,a=We(t,n);this.server_.onDisconnectPut(e.toString(),a.val(!0),(function(t,n){"ok"===t&&i.onDisconnect_.remember(e,a),i.callOnCompleteCallback(r,t,n)}))},e.prototype.onDisconnectUpdate=function(e,t,n){var r=this;if(Object(a.o)(t))return b("onDisconnect().update() called with empty data.  Don't do anything."),void this.callOnCompleteCallback(n,"ok");this.server_.onDisconnectMerge(e.toString(),t,(function(i,a){"ok"===i&&L(t,(function(t,n){var i=We(n);r.onDisconnect_.remember(e.child(t),i)})),r.callOnCompleteCallback(n,i,a)}))},e.prototype.addEventCallbackForQuery=function(e,t){var n;n=".info"===e.path.getFront()?this.infoSyncTree_.addEventRegistration(e,t):this.serverSyncTree_.addEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,n)},e.prototype.removeEventCallbackForQuery=function(e,t){var n;n=".info"===e.path.getFront()?this.infoSyncTree_.removeEventRegistration(e,t):this.serverSyncTree_.removeEventRegistration(e,t),this.eventQueue_.raiseEventsAtPath(e.path,n)},e.prototype.interrupt=function(){this.persistentConnection_&&this.persistentConnection_.interrupt(ln)},e.prototype.resume=function(){this.persistentConnection_&&this.persistentConnection_.resume(ln)},e.prototype.stats=function(e){if(void 0===e&&(e=!1),"undefined"!==typeof console){var t;e?(this.statsListener_||(this.statsListener_=new Bt(this.stats_)),t=this.statsListener_.get()):t=this.stats_.get();var n=Object.keys(t).reduce((function(e,t){return Math.max(t.length,e)}),0);L(t,(function(e,t){for(var r=e,i=e.length;i<n+2;i++)r+=" ";console.log(r+t)}))}},e.prototype.statsIncrementCounter=function(e){this.stats_.incrementCounter(e),this.statsReporter_.includeStat(e)},e.prototype.log_=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n="";this.persistentConnection_&&(n=this.persistentConnection_.id+":"),b.apply(void 0,Object(i.f)([n],e))},e.prototype.callOnCompleteCallback=function(e,t,n){e&&B((function(){if("ok"===t)e(null);else{var r=(t||"error").toUpperCase(),i=r;n&&(i+=": "+n);var a=new Error(i);a.code=r,e(a)}}))},Object.defineProperty(e.prototype,"database",{get:function(){return this.__database||(this.__database=new xn(this))},enumerable:!1,configurable:!0}),e}(),cn=function(){function e(t){this.indexedFilter_=new wt(t.getIndex()),this.index_=t.getIndex(),this.startPost_=e.getStartPost_(t),this.endPost_=e.getEndPost_(t)}return e.prototype.getStartPost=function(){return this.startPost_},e.prototype.getEndPost=function(){return this.endPost_},e.prototype.matches=function(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0},e.prototype.updateChild=function(e,t,n,r,i,a){return this.matches(new _e(t,n))||(n=He.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,r,i,a)},e.prototype.updateFullNode=function(e,t,n){t.isLeafNode()&&(t=He.EMPTY_NODE);var r=t.withIndex(this.index_);r=r.updatePriority(He.EMPTY_NODE);var i=this;return t.forEachChild(Pe,(function(e,t){i.matches(new _e(e,t))||(r=r.updateImmediateChild(e,He.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.indexedFilter_},e.prototype.getIndex=function(){return this.index_},e.getStartPost_=function(e){if(e.hasStart()){var t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()},e.getEndPost_=function(e){if(e.hasEnd()){var t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()},e}(),hn=function(){function e(e){this.rangedFilter_=new cn(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}return e.prototype.updateChild=function(e,t,n,r,i,a){return this.rangedFilter_.matches(new _e(t,n))||(n=He.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,r,i,a):this.fullLimitUpdateChild_(e,t,n,i,a)},e.prototype.updateFullNode=function(e,t,n){var r;if(t.isLeafNode()||t.isEmpty())r=He.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){r=He.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var a=0;i.hasNext()&&a<this.limit_;){var o=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),o)<=0:this.index_.compare(o,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(o.name,o.node),a++}}else{r=(r=t.withIndex(this.index_)).updatePriority(He.EMPTY_NODE);var s=void 0,l=void 0,u=void 0;i=void 0;if(this.reverse_){i=r.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),l=this.rangedFilter_.getStartPost();var c=this.index_.getCompare();u=function(e,t){return c(t,e)}}else i=r.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),l=this.rangedFilter_.getEndPost(),u=this.index_.getCompare();a=0;for(var h=!1;i.hasNext();){o=i.getNext();!h&&u(s,o)<=0&&(h=!0),h&&a<this.limit_&&u(o,l)<=0?a++:r=r.updateImmediateChild(o.name,He.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,n)},e.prototype.updatePriority=function(e,t){return e},e.prototype.filtersNodes=function(){return!0},e.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},e.prototype.getIndex=function(){return this.index_},e.prototype.fullLimitUpdateChild_=function(e,t,n,r,i){var o;if(this.reverse_){var s=this.index_.getCompare();o=function(e,t){return s(t,e)}}else o=this.index_.getCompare();var l=e;Object(a.d)(l.numChildren()===this.limit_,"");var u=new _e(t,n),c=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),h=this.rangedFilter_.matches(u);if(l.hasChild(t)){for(var f=l.getImmediateChild(t),d=r.getChildAfterChild(this.index_,c,this.reverse_);null!=d&&(d.name===t||l.hasChild(d.name));)d=r.getChildAfterChild(this.index_,d,this.reverse_);var p=null==d?1:o(d,u);if(h&&!n.isEmpty()&&p>=0)return null!=i&&i.trackChildChange(xt.childChangedChange(t,n,f)),l.updateImmediateChild(t,n);null!=i&&i.trackChildChange(xt.childRemovedChange(t,f));var m=l.updateImmediateChild(t,He.EMPTY_NODE);return null!=d&&this.rangedFilter_.matches(d)?(null!=i&&i.trackChildChange(xt.childAddedChange(d.name,d.node)),m.updateImmediateChild(d.name,d.node)):m}return n.isEmpty()?e:h&&o(c,u)>=0?(null!=i&&(i.trackChildChange(xt.childRemovedChange(c.name,c.node)),i.trackChildChange(xt.childAddedChange(t,n))),l.updateImmediateChild(t,n).updateImmediateChild(c.name,He.EMPTY_NODE)):e},e}(),fn=function(){function e(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Pe}return e.prototype.hasStart=function(){return this.startSet_},e.prototype.hasStartAfter=function(){return this.startAfterSet_},e.prototype.hasEndBefore=function(){return this.endBeforeSet_},e.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:this.viewFrom_===e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT},e.prototype.getIndexStartValue=function(){return Object(a.d)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},e.prototype.getIndexStartName=function(){return Object(a.d)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:k},e.prototype.hasEnd=function(){return this.endSet_},e.prototype.getIndexEndValue=function(){return Object(a.d)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},e.prototype.getIndexEndName=function(){return Object(a.d)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:M},e.prototype.hasLimit=function(){return this.limitSet_},e.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},e.prototype.getLimit=function(){return Object(a.d)(this.limitSet_,"Only valid if limit has been set"),this.limit_},e.prototype.getIndex=function(){return this.index_},e.prototype.copy_=function(){var t=new e;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t},e.prototype.limit=function(e){var t=this.copy_();return t.limitSet_=!0,t.limit_=e,t.viewFrom_="",t},e.prototype.limitToFirst=function(t){var n=this.copy_();return n.limitSet_=!0,n.limit_=t,n.viewFrom_=e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_LEFT,n},e.prototype.limitToLast=function(t){var n=this.copy_();return n.limitSet_=!0,n.limit_=t,n.viewFrom_=e.WIRE_PROTOCOL_CONSTANTS_.VIEW_FROM_RIGHT,n},e.prototype.startAt=function(e,t){var n=this.copy_();return n.startSet_=!0,void 0===e&&(e=null),n.indexStartValue_=e,null!=t?(n.startNameSet_=!0,n.indexStartName_=t):(n.startNameSet_=!1,n.indexStartName_=""),n},e.prototype.startAfter=function(e,t){var n;n=null==t?M:function(e){if("2147483647"===e)return"-";var t=F(e);if(null!=t)return""+(t+1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);if(n.length<786)return n.push("-"),n.join("");for(var i=n.length-1;i>=0&&"z"===n[i];)i--;if(-1===i)return M;var a=n[i],o=ye.charAt(ye.indexOf(a)+1);return n[i]=o,n.slice(0,i+1).join("")}(t);var r=this.startAt(e,n);return r.startAfterSet_=!0,r},e.prototype.endAt=function(e,t){var n=this.copy_();return n.endSet_=!0,void 0===e&&(e=null),n.indexEndValue_=e,void 0!==t?(n.endNameSet_=!0,n.indexEndName_=t):(n.endNameSet_=!1,n.indexEndName_=""),n},e.prototype.endBefore=function(e,t){var n;n=null==t?k:function(e){if("-2147483648"===e)return k;var t=F(e);if(null!=t)return""+(t-1);for(var n=new Array(e.length),r=0;r<n.length;r++)n[r]=e.charAt(r);return"-"===n[n.length-1]?1===n.length?"2147483647":(delete n[n.length-1],n.join("")):(n[n.length-1]=ye.charAt(ye.indexOf(n[n.length-1])-1),n.join("")+"z".repeat(786-n.length))}(t);var r=this.endAt(e,n);return r.endBeforeSet_=!0,r},e.prototype.orderBy=function(e){var t=this.copy_();return t.index_=e,t},e.prototype.getQueryObject=function(){var t=e.WIRE_PROTOCOL_CONSTANTS_,n={};if(this.startSet_&&(n[t.INDEX_START_VALUE]=this.indexStartValue_,this.startNameSet_&&(n[t.INDEX_START_NAME]=this.indexStartName_)),this.endSet_&&(n[t.INDEX_END_VALUE]=this.indexEndValue_,this.endNameSet_&&(n[t.INDEX_END_NAME]=this.indexEndName_)),this.limitSet_){n[t.LIMIT]=this.limit_;var r=this.viewFrom_;""===r&&(r=this.isViewFromLeft()?t.VIEW_FROM_LEFT:t.VIEW_FROM_RIGHT),n[t.VIEW_FROM]=r}return this.index_!==Pe&&(n[t.INDEX]=this.index_.toString()),n},e.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},e.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===Pe},e.prototype.getNodeFilter=function(){return this.loadsAllData()?new wt(this.getIndex()):this.hasLimit()?new hn(this):new cn(this)},e.prototype.toRestQueryStringParameters=function(){var t,n=e.REST_QUERY_CONSTANTS_,r={};return this.isDefault()||(this.index_===Pe?t=n.PRIORITY_INDEX:this.index_===Xe?t=n.VALUE_INDEX:this.index_===we?t=n.KEY_INDEX:(Object(a.d)(this.index_ instanceof Ze,"Unrecognized index type!"),t=this.index_.toString()),r[n.ORDER_BY]=Object(a.A)(t),this.startSet_&&(r[n.START_AT]=Object(a.A)(this.indexStartValue_),this.startNameSet_&&(r[n.START_AT]+=","+Object(a.A)(this.indexStartName_))),this.endSet_&&(r[n.END_AT]=Object(a.A)(this.indexEndValue_),this.endNameSet_&&(r[n.END_AT]+=","+Object(a.A)(this.indexEndName_))),this.limitSet_&&(this.isViewFromLeft()?r[n.LIMIT_TO_FIRST]=this.limit_:r[n.LIMIT_TO_LAST]=this.limit_)),r},e.WIRE_PROTOCOL_CONSTANTS_={INDEX_START_VALUE:"sp",INDEX_START_NAME:"sn",INDEX_END_VALUE:"ep",INDEX_END_NAME:"en",LIMIT:"l",VIEW_FROM:"vf",VIEW_FROM_LEFT:"l",VIEW_FROM_RIGHT:"r",INDEX:"i"},e.REST_QUERY_CONSTANTS_={ORDER_BY:"orderBy",PRIORITY_INDEX:"$priority",VALUE_INDEX:"$value",KEY_INDEX:"$key",START_AT:"startAt",END_AT:"endAt",LIMIT_TO_FIRST:"limitToFirst",LIMIT_TO_LAST:"limitToLast"},e.DEFAULT=new e,e}(),dn=function(e){function t(t,n){if(!(t instanceof un))throw new Error("new Reference() no longer supported - use app.database().");return e.call(this,t,n,fn.DEFAULT,!1)||this}return Object(i.c)(t,e),t.prototype.getKey=function(){return Object(a.B)("Reference.key",0,0,arguments.length),this.path.isEmpty()?null:this.path.getBack()},t.prototype.child=function(e){return Object(a.B)("Reference.child",1,1,arguments.length),"number"===typeof e?e=String(e):e instanceof j||(null===this.path.getFront()?he("Reference.child",1,e,!1):ce("Reference.child",1,e,!1)),new t(this.repo,this.path.child(e))},t.prototype.getParent=function(){Object(a.B)("Reference.parent",0,0,arguments.length);var e=this.path.parent();return null===e?null:new t(this.repo,e)},t.prototype.getRoot=function(){Object(a.B)("Reference.root",0,0,arguments.length);for(var e=this;null!==e.getParent();)e=e.getParent();return e},t.prototype.databaseProp=function(){return this.repo.database},t.prototype.set=function(e,t){Object(a.B)("Reference.set",1,2,arguments.length),fe("Reference.set",this.path),ie("Reference.set",1,e,this.path,!1),Object(a.C)("Reference.set",2,t,!0);var n=new a.a;return this.repo.setWithPriority(this.path,e,null,n.wrapCallback(t)),n.promise},t.prototype.update=function(e,t){if(Object(a.B)("Reference.update",1,2,arguments.length),fe("Reference.update",this.path),Array.isArray(e)){for(var n={},r=0;r<e.length;++r)n[""+r]=e[r];e=n,S("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}oe("Reference.update",1,e,this.path,!1),Object(a.C)("Reference.update",2,t,!0);var i=new a.a;return this.repo.update(this.path,e,i.wrapCallback(t)),i.promise},t.prototype.setWithPriority=function(e,t,n){if(Object(a.B)("Reference.setWithPriority",2,3,arguments.length),fe("Reference.setWithPriority",this.path),ie("Reference.setWithPriority",1,e,this.path,!1),se("Reference.setWithPriority",2,t,!1),Object(a.C)("Reference.setWithPriority",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.setWithPriority failed: "+this.getKey()+" is a read-only object.";var r=new a.a;return this.repo.setWithPriority(this.path,e,t,r.wrapCallback(n)),r.promise},t.prototype.remove=function(e){return Object(a.B)("Reference.remove",0,1,arguments.length),fe("Reference.remove",this.path),Object(a.C)("Reference.remove",1,e,!0),this.set(null,e)},t.prototype.transaction=function(e,t,n){if(Object(a.B)("Reference.transaction",1,3,arguments.length),fe("Reference.transaction",this.path),Object(a.C)("Reference.transaction",1,e,!1),Object(a.C)("Reference.transaction",2,t,!0),pe("Reference.transaction",3,n,!0),".length"===this.getKey()||".keys"===this.getKey())throw"Reference.transaction failed: "+this.getKey()+" is a read-only object.";void 0===n&&(n=!0);var r=new a.a;"function"===typeof t&&r.promise.catch((function(){}));var i=function(e,n,i){e?r.reject(e):r.resolve(new ve(n,i)),"function"===typeof t&&t(e,n,i)};return this.repo.startTransaction(this.path,e,i,n),r.promise},t.prototype.setPriority=function(e,t){Object(a.B)("Reference.setPriority",1,2,arguments.length),fe("Reference.setPriority",this.path),se("Reference.setPriority",1,e,!1),Object(a.C)("Reference.setPriority",2,t,!0);var n=new a.a;return this.repo.setWithPriority(this.path.child(".priority"),e,null,n.wrapCallback(t)),n.promise},t.prototype.push=function(e,t){Object(a.B)("Reference.push",0,2,arguments.length),fe("Reference.push",this.path),ie("Reference.push",1,e,this.path,!0),Object(a.C)("Reference.push",2,t,!0);var n,r=this.repo.serverTime(),i=ge(r),o=this.child(i),s=this.child(i);return n=null!=e?o.set(e,t).then((function(){return s})):Promise.resolve(s),o.then=n.then.bind(n),o.catch=n.then.bind(n,void 0),"function"===typeof t&&n.catch((function(){})),o},t.prototype.onDisconnect=function(){return fe("Reference.onDisconnect",this.path),new me(this.repo,this.path)},Object.defineProperty(t.prototype,"database",{get:function(){return this.databaseProp()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),t}(et);et.__referenceConstructor=dn,It.__referenceConstructor=dn;var pn,mn=function(){this.children={},this.childCount=0,this.value=null},vn=function(){function e(e,t,n){void 0===e&&(e=""),void 0===t&&(t=null),void 0===n&&(n=new mn),this.name_=e,this.parent_=t,this.node_=n}return e.prototype.subTree=function(t){for(var n=t instanceof j?t:new j(t),r=this,i=n.getFront();null!==i;){r=new e(i,r,Object(a.x)(r.node_.children,i)||new mn),i=(n=n.popFront()).getFront()}return r},e.prototype.getValue=function(){return this.node_.value},e.prototype.setValue=function(e){Object(a.d)("undefined"!==typeof e,"Cannot set value to undefined"),this.node_.value=e,this.updateParents_()},e.prototype.clear=function(){this.node_.value=null,this.node_.children={},this.node_.childCount=0,this.updateParents_()},e.prototype.hasChildren=function(){return this.node_.childCount>0},e.prototype.isEmpty=function(){return null===this.getValue()&&!this.hasChildren()},e.prototype.forEachChild=function(t){var n=this;L(this.node_.children,(function(r,i){t(new e(r,n,i))}))},e.prototype.forEachDescendant=function(e,t,n){t&&!n&&e(this),this.forEachChild((function(t){t.forEachDescendant(e,!0,n)})),t&&n&&e(this)},e.prototype.forEachAncestor=function(e,t){for(var n=t?this:this.parent();null!==n;){if(e(n))return!0;n=n.parent()}return!1},e.prototype.forEachImmediateDescendantWithValue=function(e){this.forEachChild((function(t){null!==t.getValue()?e(t):t.forEachImmediateDescendantWithValue(e)}))},e.prototype.path=function(){return new j(null===this.parent_?this.name_:this.parent_.path()+"/"+this.name_)},e.prototype.name=function(){return this.name_},e.prototype.parent=function(){return this.parent_},e.prototype.updateParents_=function(){null!==this.parent_&&this.parent_.updateChild_(this.name_,this)},e.prototype.updateChild_=function(e,t){var n=t.isEmpty(),r=Object(a.h)(this.node_.children,e);n&&r?(delete this.node_.children[e],this.node_.childCount--,this.updateParents_()):n||r||(this.node_.children[e]=t.node_,this.node_.childCount++,this.updateParents_())},e}();!function(e){e[e.RUN=0]="RUN",e[e.SENT=1]="SENT",e[e.COMPLETED=2]="COMPLETED",e[e.SENT_NEEDS_ABORT=3]="SENT_NEEDS_ABORT",e[e.NEEDS_ABORT=4]="NEEDS_ABORT"}(pn||(pn={})),un.MAX_TRANSACTION_RETRIES_=25,un.prototype.transactionsInit_=function(){this.transactionQueueTree_=new vn},un.prototype.startTransaction=function(e,t,n,r){this.log_("transaction on "+e);var i=function(){},o=new dn(this,e);o.on("value",i);var s={path:e,update:t,onComplete:n,status:null,order:p(),applyLocally:r,retryCount:0,unwatcher:function(){o.off("value",i)},abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},l=this.getLatestState_(e);s.currentInputSnapshot=l;var u=s.update(l.val());if(void 0===u){if(s.unwatcher(),s.currentOutputSnapshotRaw=null,s.currentOutputSnapshotResolved=null,s.onComplete){var c=new Ke(s.currentInputSnapshot,new dn(this,s.path),Pe);s.onComplete(null,!1,c)}}else{ae("transaction failed: Data returned ",u,s.path),s.status=pn.RUN;var h=this.transactionQueueTree_.subTree(e),f=h.getValue()||[];f.push(s),h.setValue(f);var d=void 0;if("object"===typeof u&&null!==u&&Object(a.h)(u,".priority"))d=Object(a.x)(u,".priority"),Object(a.d)(re(d),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.");else d=(this.serverSyncTree_.calcCompleteEventCache(e)||He.EMPTY_NODE).getPriority().val();d=d;var m=this.generateServerValues(),v=We(u,d),y=st(v,l,m);s.currentOutputSnapshotRaw=v,s.currentOutputSnapshotResolved=y,s.currentWriteId=this.getNextWriteId_();var g=this.serverSyncTree_.applyUserOverwrite(e,y,s.currentWriteId,s.applyLocally);this.eventQueue_.raiseEventsForChangedPath(e,g),this.sendReadyTransactions_()}},un.prototype.getLatestState_=function(e,t){return this.serverSyncTree_.calcCompleteEventCache(e,t)||He.EMPTY_NODE},un.prototype.sendReadyTransactions_=function(e){var t=this;if(void 0===e&&(e=this.transactionQueueTree_),e||this.pruneCompletedTransactionsBelowNode_(e),null!==e.getValue()){var n=this.buildTransactionQueue_(e);Object(a.d)(n.length>0,"Sending zero length transaction queue"),n.every((function(e){return e.status===pn.RUN}))&&this.sendTransactionQueue_(e.path(),n)}else e.hasChildren()&&e.forEachChild((function(e){t.sendReadyTransactions_(e)}))},un.prototype.sendTransactionQueue_=function(e,t){for(var n=this,r=t.map((function(e){return e.currentWriteId})),i=this.getLatestState_(e,r),o=i,s=i.hash(),l=0;l<t.length;l++){var u=t[l];Object(a.d)(u.status===pn.RUN,"tryToSendTransactionQueue_: items in queue should all be run."),u.status=pn.SENT,u.retryCount++;var c=j.relativePath(e,u.path);o=o.updateChild(c,u.currentOutputSnapshotRaw)}var h=o.val(!0),f=e;this.server_.put(f.toString(),h,(function(r){n.log_("transaction put response",{path:f.toString(),status:r});var i=[];if("ok"===r){for(var a=[],o=0;o<t.length;o++){if(t[o].status=pn.COMPLETED,i=i.concat(n.serverSyncTree_.ackUserWrite(t[o].currentWriteId)),t[o].onComplete){var s=t[o].currentOutputSnapshotResolved,l=new dn(n,t[o].path),u=new Ke(s,l,Pe);a.push(t[o].onComplete.bind(null,null,!0,u))}t[o].unwatcher()}n.pruneCompletedTransactionsBelowNode_(n.transactionQueueTree_.subTree(e)),n.sendReadyTransactions_(),n.eventQueue_.raiseEventsForChangedPath(e,i);for(o=0;o<a.length;o++)B(a[o])}else{if("datastale"===r)for(o=0;o<t.length;o++)t[o].status===pn.SENT_NEEDS_ABORT?t[o].status=pn.NEEDS_ABORT:t[o].status=pn.RUN;else{S("transaction at "+f.toString()+" failed: "+r);for(o=0;o<t.length;o++)t[o].status=pn.NEEDS_ABORT,t[o].abortReason=r}n.rerunTransactions_(e)}}),s)},un.prototype.rerunTransactions_=function(e){var t=this.getAncestorTransactionNode_(e),n=t.path(),r=this.buildTransactionQueue_(t);return this.rerunTransactionQueue_(r,n),n},un.prototype.rerunTransactionQueue_=function(e,t){if(0!==e.length){for(var n,r=[],i=[],o=e.filter((function(e){return e.status===pn.RUN})).map((function(e){return e.currentWriteId})),s=0;s<e.length;s++){var l=e[s],u=j.relativePath(t,l.path),c=!1,h=void 0;if(Object(a.d)(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===pn.NEEDS_ABORT)c=!0,h=l.abortReason,i=i.concat(this.serverSyncTree_.ackUserWrite(l.currentWriteId,!0));else if(l.status===pn.RUN)if(l.retryCount>=un.MAX_TRANSACTION_RETRIES_)c=!0,h="maxretry",i=i.concat(this.serverSyncTree_.ackUserWrite(l.currentWriteId,!0));else{var f=this.getLatestState_(l.path,o);l.currentInputSnapshot=f;var d=e[s].update(f.val());if(void 0!==d){ae("transaction failed: Data returned ",d,l.path);var p=We(d);"object"===typeof d&&null!=d&&Object(a.h)(d,".priority")||(p=p.updatePriority(f.getPriority()));var m=l.currentWriteId,v=this.generateServerValues(),y=st(p,f,v);l.currentOutputSnapshotRaw=p,l.currentOutputSnapshotResolved=y,l.currentWriteId=this.getNextWriteId_(),o.splice(o.indexOf(m),1),i=(i=i.concat(this.serverSyncTree_.applyUserOverwrite(l.path,y,l.currentWriteId,l.applyLocally))).concat(this.serverSyncTree_.ackUserWrite(m,!0))}else c=!0,h="nodata",i=i.concat(this.serverSyncTree_.ackUserWrite(l.currentWriteId,!0))}if(this.eventQueue_.raiseEventsForChangedPath(t,i),i=[],c&&(e[s].status=pn.COMPLETED,n=e[s].unwatcher,setTimeout(n,Math.floor(0)),e[s].onComplete))if("nodata"===h){var g=new dn(this,e[s].path),_=e[s].currentInputSnapshot,b=new Ke(_,g,Pe);r.push(e[s].onComplete.bind(null,null,!1,b))}else r.push(e[s].onComplete.bind(null,new Error(h),!1,null))}this.pruneCompletedTransactionsBelowNode_(this.transactionQueueTree_);for(s=0;s<r.length;s++)B(r[s]);this.sendReadyTransactions_()}},un.prototype.getAncestorTransactionNode_=function(e){var t,n=this.transactionQueueTree_;for(t=e.getFront();null!==t&&null===n.getValue();)n=n.subTree(t),t=(e=e.popFront()).getFront();return n},un.prototype.buildTransactionQueue_=function(e){var t=[];return this.aggregateTransactionQueuesForNode_(e,t),t.sort((function(e,t){return e.order-t.order})),t},un.prototype.aggregateTransactionQueuesForNode_=function(e,t){var n=this,r=e.getValue();if(null!==r)for(var i=0;i<r.length;i++)t.push(r[i]);e.forEachChild((function(e){n.aggregateTransactionQueuesForNode_(e,t)}))},un.prototype.pruneCompletedTransactionsBelowNode_=function(e){var t=this,n=e.getValue();if(n){for(var r=0,i=0;i<n.length;i++)n[i].status!==pn.COMPLETED&&(n[r]=n[i],r++);n.length=r,e.setValue(n.length>0?n:null)}e.forEachChild((function(e){t.pruneCompletedTransactionsBelowNode_(e)}))},un.prototype.abortTransactions_=function(e){var t=this,n=this.getAncestorTransactionNode_(e).path(),r=this.transactionQueueTree_.subTree(e);return r.forEachAncestor((function(e){t.abortTransactionsOnNode_(e)})),this.abortTransactionsOnNode_(r),r.forEachDescendant((function(e){t.abortTransactionsOnNode_(e)})),n},un.prototype.abortTransactionsOnNode_=function(e){var t=e.getValue();if(null!==t){for(var n=[],r=[],i=-1,o=0;o<t.length;o++)if(t[o].status===pn.SENT_NEEDS_ABORT);else if(t[o].status===pn.SENT)Object(a.d)(i===o-1,"All SENT items should be at beginning of queue."),i=o,t[o].status=pn.SENT_NEEDS_ABORT,t[o].abortReason="set";else if(Object(a.d)(t[o].status===pn.RUN,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(this.serverSyncTree_.ackUserWrite(t[o].currentWriteId,!0)),t[o].onComplete){n.push(t[o].onComplete.bind(null,new Error("set"),!1,null))}-1===i?e.setValue(null):t.length=i+1,this.eventQueue_.raiseEventsForChangedPath(e.path(),r);for(o=0;o<n.length;o++)B(n[o])}};var yn,gn=function(){function e(e,t){var n=this;this.app_=e,this.authProvider_=t,this.auth_=null,this.auth_=t.getImmediate({optional:!0}),this.auth_||t.get().then((function(e){return n.auth_=e}))}return e.prototype.getToken=function(e){return this.auth_?this.auth_.getToken(e).catch((function(e){return e&&"auth/token-not-initialized"===e.code?(b("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)})):Promise.resolve(null)},e.prototype.addTokenChangeListener=function(e){this.auth_?this.auth_.addAuthTokenListener(e):(setTimeout((function(){return e(null)}),0),this.authProvider_.get().then((function(t){return t.addAuthTokenListener(e)})))},e.prototype.removeTokenChangeListener=function(e){this.authProvider_.get().then((function(t){return t.removeAuthTokenListener(e)}))},e.prototype.notifyForInvalidToken=function(){var e='Provided authentication credentials for the app named "'+this.app_.name+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.app_.options?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.app_.options?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',S(e)},e}(),_n=function(){function e(){}return e.prototype.getToken=function(t){return Promise.resolve({accessToken:e.EMULATOR_AUTH_TOKEN})},e.prototype.addTokenChangeListener=function(t){t(e.EMULATOR_AUTH_TOKEN)},e.prototype.removeTokenChangeListener=function(e){},e.prototype.notifyForInvalidToken=function(){},e.EMULATOR_AUTH_TOKEN="owner",e}(),bn=function(){function t(){this.repos_={},this.useRestClient_=!1}return t.getInstance=function(){return yn||(yn=new t),yn},t.prototype.interrupt=function(){var e,t,n,r;try{for(var a=Object(i.g)(Object.keys(this.repos_)),o=a.next();!o.done;o=a.next()){var s=o.value;try{for(var l=(n=void 0,Object(i.g)(Object.keys(this.repos_[s]))),u=l.next();!u.done;u=l.next()){var c=u.value;this.repos_[s][c].interrupt()}}catch(h){n={error:h}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}}catch(f){e={error:f}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}},t.prototype.resume=function(){var e,t,n,r;try{for(var a=Object(i.g)(Object.keys(this.repos_)),o=a.next();!o.done;o=a.next()){var s=o.value;try{for(var l=(n=void 0,Object(i.g)(Object.keys(this.repos_[s]))),u=l.next();!u.done;u=l.next()){var c=u.value;this.repos_[s][c].resume()}}catch(h){n={error:h}}finally{try{u&&!u.done&&(r=l.return)&&r.call(l)}finally{if(n)throw n.error}}}}catch(f){e={error:f}}finally{try{o&&!o.done&&(t=a.return)&&t.call(a)}finally{if(e)throw e.error}}},t.prototype.applyEmulatorSettings=function(e,t,n){e.repoInfo_=new X(t+":"+n,!1,e.repoInfo_.namespace,e.repoInfo_.webSocketOnly,e.repoInfo_.nodeAdmin,e.repoInfo_.persistenceKey,e.repoInfo_.includeNamespaceInQueryParams),e.repoInfo_.nodeAdmin&&(e.authTokenProvider_=new _n)},t.prototype.databaseFromApp=function(t,n,r,i){var a=r||t.options.databaseURL;void 0===a&&(t.options.projectId||E("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),b("Using default host for project ",t.options.projectId),a=t.options.projectId+"-default-rtdb.firebaseio.com");var o,s=Y(a,i),l=s.repoInfo,u=void 0;"undefined"!==typeof e&&(u=Object({NODE_ENV:"production",PUBLIC_URL:"/tokyo-survival-pub",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_FIREBASE_API_KEY:"AIzaSyBMgLpqdddgG5plQhhTFN3KmNwMtCquK6s",REACT_APP_FIREBASE_APP_ID:"1:953032005701:web:df56c5e173995c61a3ab2c",REACT_APP_FIREBASE_AUTH_DOMAIN:"tokyo-survival.firebaseapp.com",REACT_APP_FIREBASE_DATABASE_URL:"https://tokyo-survival-default-rtdb.firebaseio.com",REACT_APP_FIREBASE_MESSAGING_SENDER_ID:"953032005701",REACT_APP_FIREBASE_PROJECT_ID:"tokyo-survival",REACT_APP_FIREBASE_STORAGE_BUCKET:"tokyo-survival.appspot.com",REACT_APP_MAPBOX_ACCESS_TOKEN:"pk.eyJ1IjoiaGlzYXlhbiIsImEiOiJja2wwODR2d2gzOGF0MnFxbmJjbGFneWpxIn0.a0Dl2YtxhvWoXDsJK_THSg"}).FIREBASE_DATABASE_EMULATOR_HOST),u?(o=!0,a="http://"+u+"?ns="+l.namespace,l=(s=Y(a,i)).repoInfo):o=!s.repoInfo.secure;var c=i&&o?new _n:new gn(t,n);return de("Invalid Firebase Database URL",1,s),s.path.isEmpty()||E("Database URL must point to the root of a Firebase Database (not including a child path)."),this.createRepo(l,t,c).database},t.prototype.deleteRepo=function(e){var t=Object(a.x)(this.repos_,e.app.name);t&&Object(a.x)(t,e.key)===e||E("Database "+e.app.name+"("+e.repoInfo_+") has already been deleted."),e.interrupt(),delete t[e.key]},t.prototype.createRepo=function(e,t,n){var r=Object(a.x)(this.repos_,t.name);r||(r={},this.repos_[t.name]=r);var i=Object(a.x)(r,e.toURLString());return i&&E("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),i=new un(e,this.useRestClient_,t,n),r[e.toURLString()]=i,i},t.prototype.forceRestClient=function(e){this.useRestClient_=e},t}(),xn=function(){function e(e){var t=this;this.repoInternal_=e,this.instanceStarted_=!1,this.INTERNAL={delete:function(){return Object(i.b)(t,void 0,void 0,(function(){return Object(i.d)(this,(function(e){return this.checkDeleted_("delete"),bn.getInstance().deleteRepo(this.repo_),this.repoInternal_=null,this.rootInternal_=null,[2]}))}))}},e instanceof un||E("Don't call new Database() directly - please use firebase.database().")}return Object.defineProperty(e.prototype,"repo_",{get:function(){return this.instanceStarted_||(this.repoInternal_.start(),this.instanceStarted_=!0),this.repoInternal_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root_",{get:function(){return this.rootInternal_||(this.rootInternal_=new dn(this.repo_,j.Empty)),this.rootInternal_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"app",{get:function(){return this.repo_.app},enumerable:!1,configurable:!0}),e.prototype.useEmulator=function(e,t){this.checkDeleted_("useEmulator"),this.instanceStarted_?E("Cannot call useEmulator() after instance has already been initialized."):bn.getInstance().applyEmulatorSettings(this.repoInternal_,e,t)},e.prototype.ref=function(e){return this.checkDeleted_("ref"),Object(a.B)("database.ref",0,1,arguments.length),e instanceof dn?this.refFromURL(e.toString()):void 0!==e?this.root_.child(e):this.root_},e.prototype.refFromURL=function(e){var t="database.refFromURL";this.checkDeleted_(t),Object(a.B)(t,1,1,arguments.length);var n=Y(e,this.repo_.repoInfo_.nodeAdmin);de(t,1,n);var r=n.repoInfo;return this.repo_.repoInfo_.isCustomHost()||r.host===this.repo_.repoInfo_.host||E(t+": Host name does not match the current database: (found "+r.host+" but expected "+this.repo_.repoInfo_.host+")"),this.ref(n.path.toString())},e.prototype.checkDeleted_=function(e){null===this.repoInternal_&&E("Cannot call "+e+" on a deleted database.")},e.prototype.goOffline=function(){Object(a.B)("database.goOffline",0,0,arguments.length),this.checkDeleted_("goOffline"),this.repo_.interrupt()},e.prototype.goOnline=function(){Object(a.B)("database.goOnline",0,0,arguments.length),this.checkDeleted_("goOnline"),this.repo_.resume()},e.ServerValue={TIMESTAMP:{".sv":"timestamp"},increment:function(e){return{".sv":{increment:e}}}},e}();var wn=Object.freeze({__proto__:null,forceLongPolling:function(){en.forceDisallow(),Kt.forceAllow()},forceWebSockets:function(){Kt.forceDisallow()},isWebSocketsAvailable:function(){return en.isAvailable()},setSecurityDebugCallback:function(e,t){e.repo.persistentConnection_.securityDebugCallback_=t},stats:function(e,t){e.repo.stats(t)},statsIncrementCounter:function(e,t){e.repo.statsIncrementCounter(t)},dataUpdateCount:function(e){return e.repo.dataUpdateCount},interceptServerData:function(e,t){return e.repo.interceptServerData_(t)},initStandalone:function(e){var t=e.app,n=e.url,r=e.version,i=e.customAuthImpl,a=e.namespace,o=e.nodeAdmin,l=void 0!==o&&o;Qt(r);var u=new s.c("auth-internal",new s.b("database-standalone"));return u.setComponent(new s.a("auth-internal",(function(){return i}),"PRIVATE")),{instance:bn.getInstance().databaseFromApp(t,u,n,l),namespace:a}}}),En=on;on.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},on.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)};var Sn=nn,Tn=X,kn=Object.freeze({__proto__:null,DataConnection:En,RealTimeConnection:Sn,hijackHash:function(e){var t=on.prototype.put;return on.prototype.put=function(n,r,i,a){void 0!==a&&(a=e()),t.call(this,n,r,i,a)},function(){on.prototype.put=t}},ConnectionTarget:Tn,queryIdentifier:function(e){return e.queryIdentifier()},forceRestClient:function(e){bn.getInstance().forceRestClient(e)}}),Mn=xn.ServerValue;!function(e){Qt(e.SDK_VERSION);var n=e.INTERNAL.registerComponent(new s.a("database",(function(e,t){var n=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal");return bn.getInstance().databaseFromApp(n,r,t)}),"PUBLIC").setServiceProps({Reference:dn,Query:et,Database:xn,DataSnapshot:Ke,enableLogging:_,INTERNAL:wn,ServerValue:Mn,TEST_ACCESS:kn}).setMultipleInstances(!0));e.registerVersion("@firebase/database","0.9.1"),Object(a.r)()&&(t.exports=n)}(r.a)}).call(this,n(90),n(91)(e))},function(e,t){var n,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"===typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"===typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var l,u=[],c=!1,h=-1;function f(){c&&l&&(c=!1,l.length?u=l.concat(u):h=-1,u.length&&d())}function d(){if(!c){var e=s(f);c=!0;for(var t=u.length;t;){for(l=u,u=[];++h<t;)l&&l[h].run();h=-1,t=u.length}l=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||c||s(d)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t){e.exports=function(e){if(!e.webpackPolyfill){var t=Object.create(e);t.children||(t.children=[]),Object.defineProperty(t,"loaded",{enumerable:!0,get:function(){return t.l}}),Object.defineProperty(t,"id",{enumerable:!0,get:function(){return t.i}}),Object.defineProperty(t,"exports",{enumerable:!0}),t.webpackPolyfill=1}return t}},function(e,t,n){"use strict";n(93)},function(e,t,n){"use strict";(function(e){var t=n(7);(function(){var n,r="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){e!=Array.prototype&&e!=Object.prototype&&(e[t]=n.value)};var i=function(t){t=["object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof e&&e,t];for(var n=0;n<t.length;++n){var r=t[n];if(r&&r.Math==Math)return r}return globalThis}(this);function a(e){var t=0;return function(){return t<e.length?{done:!1,value:e[t++]}:{done:!0}}}function o(e){var t="undefined"!=typeof Symbol&&Symbol.iterator&&e[Symbol.iterator];return t?t.call(e):{next:a(e)}}!function(e,t){if(t){var n=i;e=e.split(".");for(var a=0;a<e.length-1;a++){var o=e[a];o in n||(n[o]={}),n=n[o]}(t=t(a=n[e=e[e.length-1]]))!=a&&null!=t&&r(n,e,{configurable:!0,writable:!0,value:t})}}("Promise",(function(e){function t(e){this.b=0,this.c=void 0,this.a=[];var t=this.f();try{e(t.resolve,t.reject)}catch(n){t.reject(n)}}function n(){this.a=null}function r(e){return e instanceof t?e:new t((function(t){t(e)}))}if(e)return e;n.prototype.b=function(e){if(null==this.a){this.a=[];var t=this;this.c((function(){t.g()}))}this.a.push(e)};var a=i.setTimeout;n.prototype.c=function(e){a(e,0)},n.prototype.g=function(){for(;this.a&&this.a.length;){var e=this.a;this.a=[];for(var t=0;t<e.length;++t){var n=e[t];e[t]=null;try{n()}catch(r){this.f(r)}}}this.a=null},n.prototype.f=function(e){this.c((function(){throw e}))},t.prototype.f=function(){function e(e){return function(r){n||(n=!0,e.call(t,r))}}var t=this,n=!1;return{resolve:e(this.m),reject:e(this.g)}},t.prototype.m=function(e){if(e===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(e instanceof t)this.s(e);else{e:switch(typeof e){case"object":var n=null!=e;break e;case"function":n=!0;break e;default:n=!1}n?this.v(e):this.h(e)}},t.prototype.v=function(e){var t=void 0;try{t=e.then}catch(n){return void this.g(n)}"function"==typeof t?this.u(t,e):this.h(e)},t.prototype.g=function(e){this.i(2,e)},t.prototype.h=function(e){this.i(1,e)},t.prototype.i=function(e,t){if(0!=this.b)throw Error("Cannot settle("+e+", "+t+"): Promise already settled in state"+this.b);this.b=e,this.c=t,this.l()},t.prototype.l=function(){if(null!=this.a){for(var e=0;e<this.a.length;++e)s.b(this.a[e]);this.a=null}};var s=new n;return t.prototype.s=function(e){var t=this.f();e.Qa(t.resolve,t.reject)},t.prototype.u=function(e,t){var n=this.f();try{e.call(t,n.resolve,n.reject)}catch(r){n.reject(r)}},t.prototype.then=function(e,n){function r(e,t){return"function"==typeof e?function(t){try{i(e(t))}catch(n){a(n)}}:t}var i,a,o=new t((function(e,t){i=e,a=t}));return this.Qa(r(e,i),r(n,a)),o},t.prototype.catch=function(e){return this.then(void 0,e)},t.prototype.Qa=function(e,t){function n(){switch(r.b){case 1:e(r.c);break;case 2:t(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?s.b(n):this.a.push(n)},t.resolve=r,t.reject=function(e){return new t((function(t,n){n(e)}))},t.race=function(e){return new t((function(t,n){for(var i=o(e),a=i.next();!a.done;a=i.next())r(a.value).Qa(t,n)}))},t.all=function(e){var n=o(e),i=n.next();return i.done?r([]):new t((function(e,t){function a(t){return function(n){o[t]=n,0==--s&&e(o)}}var o=[],s=0;do{o.push(void 0),s++,r(i.value).Qa(a(o.length-1),t),i=n.next()}while(!i.done)}))},t}));var s=s||{},l=this||self,u=/^[\w+/_-]+[=]{0,2}$/,c=null;function h(e){return(e=e.querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&u.test(e)?e:""}function f(){}function d(e){var t=typeof e;return"object"!=t?t:e?Array.isArray(e)?"array":t:"null"}function p(e){var t=d(e);return"array"==t||"object"==t&&"number"==typeof e.length}function m(e){return"function"==d(e)}function v(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function y(e){return Object.prototype.hasOwnProperty.call(e,g)&&e[g]||(e[g]=++_)}var g="closure_uid_"+(1e9*Math.random()>>>0),_=0;function b(e,t,n){return e.call.apply(e.bind,arguments)}function x(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function w(e,t,n){return(w=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?b:x).apply(null,arguments)}function E(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}var S=Date.now;function T(e,t){function n(){}n.prototype=t.prototype,e.ab=t.prototype,e.prototype=new n,e.prototype.constructor=e}function k(e){return e}function M(e,t,n){this.code=I+e,this.message=t||P[e]||"",this.a=n||null}function C(e){var t=e&&e.code;return t?new M(t.substring(I.length),e.message,e.serverResponse):null}T(M,Error),M.prototype.w=function(){var e={code:this.code,message:this.message};return this.a&&(e.serverResponse=this.a),e},M.prototype.toJSON=function(){return this.w()};var A,I="auth/",P={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-change-needs-verification":"Multi-factor users must always have a verified email.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-multi-factor-session":"The request does not contain a valid proof of first factor successful sign-in.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","multi-factor-info-not-found":"The user does not have a second factor matching the identifier provided.","multi-factor-auth-required":"Proof of ownership of a second factor is required to complete sign-in.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-multi-factor-info":"No second factor identifier is provided.","missing-multi-factor-session":"The request is missing proof of first factor successful sign-in.","missing-or-invalid-nonce":"The request does not contain a valid nonce. This can occur if the SHA-256 hash of the provided raw nonce does not match the hashed nonce in the ID token payload.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","second-factor-already-in-use":"The second factor is already enrolled on this account.","maximum-second-factor-count-exceeded":"The maximum allowed number of second factors on a user has been exceeded.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-first-factor":"Enrolling a second factor or signing in with a multi-factor account requires sign-in with a supported first factor.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","unverified-email":"The operation requires a verified email.","user-cancelled":"The user did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."},R={ld:{Ta:"https://staging-identitytoolkit.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",Za:"https://staging-securetoken.sandbox.googleapis.com/v1/token",Wa:"https://staging-identitytoolkit.sandbox.googleapis.com/v2/",id:"b"},sd:{Ta:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",Za:"https://securetoken.googleapis.com/v1/token",Wa:"https://identitytoolkit.googleapis.com/v2/",id:"p"},ud:{Ta:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",Za:"https://staging-securetoken.sandbox.googleapis.com/v1/token",Wa:"https://staging-identitytoolkit.sandbox.googleapis.com/v2/",id:"s"},vd:{Ta:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",Za:"https://test-securetoken.sandbox.googleapis.com/v1/token",Wa:"https://test-identitytoolkit.sandbox.googleapis.com/v2/",id:"t"}};function L(e){for(var t in R)if(R[t].id===e)return{firebaseEndpoint:(e=R[t]).Ta,secureTokenEndpoint:e.Za,identityPlatformEndpoint:e.Wa};return null}function O(e){if(!e)return!1;try{return!!e.$goog_Thenable}catch(t){return!1}}function D(e){if(Error.captureStackTrace)Error.captureStackTrace(this,D);else{var t=Error().stack;t&&(this.stack=t)}e&&(this.message=String(e))}function N(e,t){for(var n="",r=(e=e.split("%s")).length-1,i=0;i<r;i++)n+=e[i]+(i<t.length?t[i]:"%s");D.call(this,n+e[r])}function z(e,t){throw new N("Failure"+(e?": "+e:""),Array.prototype.slice.call(arguments,1))}function F(e,t){this.c=e,this.f=t,this.b=0,this.a=null}function B(e,t){e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}function U(){this.b=this.a=null}A=L("__EID__")?"__EID__":void 0,T(D,Error),D.prototype.name="CustomError",T(N,D),N.prototype.name="AssertionError",F.prototype.get=function(){if(0<this.b){this.b--;var e=this.a;this.a=e.next,e.next=null}else e=this.c();return e};var j=new F((function(){return new H}),(function(e){e.reset()}));function V(){var e=bt,t=null;return e.a&&(t=e.a,e.a=e.a.next,e.a||(e.b=null),t.next=null),t}function H(){this.next=this.b=this.a=null}U.prototype.add=function(e,t){var n=j.get();n.set(e,t),this.b?this.b.next=n:this.a=n,this.b=n},H.prototype.set=function(e,t){this.a=e,this.b=t,this.next=null},H.prototype.reset=function(){this.next=this.b=this.a=null};var G=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"===typeof e)return"string"!==typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1},W=Array.prototype.forEach?function(e,t,n){Array.prototype.forEach.call(e,t,n)}:function(e,t,n){for(var r=e.length,i="string"===typeof e?e.split(""):e,a=0;a<r;a++)a in i&&t.call(n,i[a],a,e)};var q=Array.prototype.filter?function(e,t){return Array.prototype.filter.call(e,t,void 0)}:function(e,t){for(var n=e.length,r=[],i=0,a="string"===typeof e?e.split(""):e,o=0;o<n;o++)if(o in a){var s=a[o];t.call(void 0,s,o,e)&&(r[i++]=s)}return r},X=Array.prototype.map?function(e,t){return Array.prototype.map.call(e,t,void 0)}:function(e,t){for(var n=e.length,r=Array(n),i="string"===typeof e?e.split(""):e,a=0;a<n;a++)a in i&&(r[a]=t.call(void 0,i[a],a,e));return r},Z=Array.prototype.some?function(e,t){return Array.prototype.some.call(e,t,void 0)}:function(e,t){for(var n=e.length,r="string"===typeof e?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e))return!0;return!1};function K(e,t){return 0<=G(e,t)}function Y(e,t){var n;return(n=0<=(t=G(e,t)))&&Array.prototype.splice.call(e,t,1),n}function J(e,t){!function(e,t){for(var n="string"===typeof e?e.split(""):e,r=e.length-1;0<=r;--r)r in n&&t.call(void 0,n[r],r,e)}(e,(function(n,r){t.call(void 0,n,r,e)&&1==Array.prototype.splice.call(e,r,1).length&&0}))}function Q(e){return Array.prototype.concat.apply([],arguments)}function $(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}var ee,te=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]},ne=/&/g,re=/</g,ie=/>/g,ae=/"/g,oe=/'/g,se=/\x00/g,le=/[\x00&<>"']/;function ue(e,t){return-1!=e.indexOf(t)}function ce(e,t){return e<t?-1:e>t?1:0}e:{var he=l.navigator;if(he){var fe=he.userAgent;if(fe){ee=fe;break e}}ee=""}function de(e){return ue(ee,e)}function pe(e,t){for(var n in e)t.call(void 0,e[n],n,e)}function me(e){for(var t in e)return!1;return!0}function ve(e){var t,n={};for(t in e)n[t]=e[t];return n}var ye="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ge(e,t){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])e[n]=r[n];for(var a=0;a<ye.length;a++)n=ye[a],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function _e(e,t){e:{try{var n=e&&e.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||l).Element&&r.Location){var i=r;break e}}catch(o){}i=null}if(i&&"undefined"!=typeof i[t]&&(!e||!(e instanceof i[t])&&(e instanceof i.Location||e instanceof i.Element))){if(v(e))try{var a=e.constructor.displayName||e.constructor.name||Object.prototype.toString.call(e)}catch(o){a="<object could not be stringified>"}else a=void 0===e?"undefined":null===e?"null":typeof e;z("Argument is not a %s (or a non-Element, non-Location mock); got: %s",t,a)}}function be(e,t){this.a=e===Se&&t||"",this.b=Ee}function xe(e){return e instanceof be&&e.constructor===be&&e.b===Ee?e.a:(z("expected object of type Const, got '"+e+"'"),"type_error:Const")}be.prototype.sa=!0,be.prototype.ra=function(){return this.a},be.prototype.toString=function(){return"Const{"+this.a+"}"};var we,Ee={},Se={};function Te(){if(void 0===we){var e=null,t=l.trustedTypes;if(t&&t.createPolicy){try{e=t.createPolicy("goog#html",{createHTML:k,createScript:k,createScriptURL:k})}catch(n){l.console&&l.console.error(n.message)}we=e}else we=e}return we}function ke(e,t){this.a=t===Pe?e:""}function Me(e){return e instanceof ke&&e.constructor===ke?e.a:(z("expected object of type TrustedResourceUrl, got '"+e+"' of type "+d(e)),"type_error:TrustedResourceUrl")}function Ce(e,t){var n=xe(e);if(!Ie.test(n))throw Error("Invalid TrustedResourceUrl format: "+n);return function(e){var t=Te();return new ke(e=t?t.createScriptURL(e):e,Pe)}(e=n.replace(Ae,(function(e,r){if(!Object.prototype.hasOwnProperty.call(t,r))throw Error('Found marker, "'+r+'", in format string, "'+n+'", but no valid label mapping found in args: '+JSON.stringify(t));return(e=t[r])instanceof be?xe(e):encodeURIComponent(String(e))})))}ke.prototype.sa=!0,ke.prototype.ra=function(){return this.a.toString()},ke.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var Ae=/%{(\w+)}/g,Ie=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^/\\]|[^:/\\%]+\/|[^:/\\%]*[?#]|about:blank#)/i,Pe={};function Re(e,t){this.a=t===Be?e:""}function Le(e){return e instanceof Re&&e.constructor===Re?e.a:(z("expected object of type SafeUrl, got '"+e+"' of type "+d(e)),"type_error:SafeUrl")}Re.prototype.sa=!0,Re.prototype.ra=function(){return this.a.toString()},Re.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var Oe=/^(?:audio\/(?:3gpp2|3gpp|aac|L16|midi|mp3|mp4|mpeg|oga|ogg|opus|x-m4a|x-matroska|x-wav|wav|webm)|font\/\w+|image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp|x-icon)|text\/csv|video\/(?:mpeg|mp4|ogg|webm|quicktime|x-matroska))(?:;\w+=(?:\w+|"[\w;,= ]+"))*$/i,De=/^data:(.*);base64,[a-z0-9+\/]+=*$/i,Ne=/^(?:(?:https?|mailto|ftp):|[^:/?#]*(?:[/?#]|$))/i;function ze(e){if(e instanceof Re)return e;if(e="object"==typeof e&&e.sa?e.ra():String(e),Ne.test(e))e=new Re(e,Be);else{var t=(e=(e=String(e)).replace(/(%0A|%0D)/g,"")).match(De);e=t&&Oe.test(t[1])?new Re(e,Be):null}return e}function Fe(e){return e instanceof Re?e:(e="object"==typeof e&&e.sa?e.ra():String(e),Ne.test(e)||(e="about:invalid#zClosurez"),new Re(e,Be))}var Be={},Ue=new Re("about:invalid#zClosurez",Be);function je(e,t,n){this.a=n===Ve?e:""}je.prototype.sa=!0,je.prototype.ra=function(){return this.a.toString()},je.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var Ve={};function He(e,t,n,r){return e=e instanceof Re?e:Fe(e),t=t||l,n=n instanceof be?xe(n):n||"",t.open(Le(e),n,r,void 0)}function Ge(e,t){for(var n=e.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function We(e){return le.test(e)&&(-1!=e.indexOf("&")&&(e=e.replace(ne,"&amp;")),-1!=e.indexOf("<")&&(e=e.replace(re,"&lt;")),-1!=e.indexOf(">")&&(e=e.replace(ie,"&gt;")),-1!=e.indexOf('"')&&(e=e.replace(ae,"&quot;")),-1!=e.indexOf("'")&&(e=e.replace(oe,"&#39;")),-1!=e.indexOf("\0")&&(e=e.replace(se,"&#0;"))),e}function qe(e){return qe[" "](e),e}qe[" "]=f;var Xe,Ze=de("Opera"),Ke=de("Trident")||de("MSIE"),Ye=de("Edge"),Je=Ye||Ke,Qe=de("Gecko")&&!(ue(ee.toLowerCase(),"webkit")&&!de("Edge"))&&!(de("Trident")||de("MSIE"))&&!de("Edge"),$e=ue(ee.toLowerCase(),"webkit")&&!de("Edge");function et(){var e=l.document;return e?e.documentMode:void 0}e:{var tt="",nt=function(){var e=ee;return Qe?/rv:([^\);]+)(\)|;)/.exec(e):Ye?/Edge\/([\d\.]+)/.exec(e):Ke?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):$e?/WebKit\/(\S+)/.exec(e):Ze?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(nt&&(tt=nt?nt[1]:""),Ke){var rt=et();if(null!=rt&&rt>parseFloat(tt)){Xe=String(rt);break e}}Xe=tt}var it,at={};function ot(e){return function(e,t){var n=at;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=t(e)}(e,(function(){for(var t=0,n=te(String(Xe)).split("."),r=te(String(e)).split("."),i=Math.max(n.length,r.length),a=0;0==t&&a<i;a++){var o=n[a]||"",s=r[a]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=ce(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||ce(0==o[2].length,0==s[2].length)||ce(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}))}if(l.document&&Ke){var st=et();it=st||(parseInt(Xe,10)||void 0)}else it=void 0;var lt=it;try{new self.OffscreenCanvas(0,0).getContext("2d")}catch(ho){}var ut=!Ke||9<=Number(lt);function ct(e){var t=document;return"string"===typeof e?t.getElementById(e):e}function ht(e,t){pe(t,(function(t,n){t&&"object"==typeof t&&t.sa&&(t=t.ra()),"style"==n?e.style.cssText=t:"class"==n?e.className=t:"for"==n?e.htmlFor=t:pt.hasOwnProperty(n)?e.setAttribute(pt[n],t):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?e.setAttribute(n,t):e[n]=t}))}var ft,dt,pt={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function mt(e,t,n){function r(n){n&&t.appendChild("string"===typeof n?e.createTextNode(n):n)}for(var i=2;i<n.length;i++){var a=n[i];if(!p(a)||v(a)&&0<a.nodeType)r(a);else{e:{if(a&&"number"==typeof a.length){if(v(a)){var o="function"==typeof a.item||"string"==typeof a.item;break e}if(m(a)){o="function"==typeof a.item;break e}}o=!1}W(o?$(a):a,r)}}}function vt(e,t){return t=String(t),"application/xhtml+xml"===e.contentType&&(t=t.toLowerCase()),e.createElement(t)}function yt(e){l.setTimeout((function(){throw e}),0)}function gt(e,t){dt||function(){if(l.Promise&&l.Promise.resolve){var e=l.Promise.resolve(void 0);dt=function(){e.then(xt)}}else dt=function(){var e=xt;!m(l.setImmediate)||l.Window&&l.Window.prototype&&!de("Edge")&&l.Window.prototype.setImmediate==l.setImmediate?(ft||(ft=function(){var e=l.MessageChannel;if("undefined"===typeof e&&"undefined"!==typeof window&&window.postMessage&&window.addEventListener&&!de("Presto")&&(e=function(){var e=vt(document,"IFRAME");e.style.display="none",document.documentElement.appendChild(e);var t=e.contentWindow;(e=t.document).open(),e.close();var n="callImmediate"+Math.random(),r="file:"==t.location.protocol?"*":t.location.protocol+"//"+t.location.host;e=w((function(e){"*"!=r&&e.origin!=r||e.data!=n||this.port1.onmessage()}),this),t.addEventListener("message",e,!1),this.port1={},this.port2={postMessage:function(){t.postMessage(n,r)}}}),"undefined"!==typeof e&&!de("Trident")&&!de("MSIE")){var t=new e,n={},r=n;return t.port1.onmessage=function(){if(void 0!==n.next){var e=(n=n.next).Gb;n.Gb=null,e()}},function(e){r.next={Gb:e},r=r.next,t.port2.postMessage(0)}}return function(e){l.setTimeout(e,0)}}()),ft(e)):l.setImmediate(e)}}(),_t||(dt(),_t=!0),bt.add(e,t)}var _t=!1,bt=new U;function xt(){for(var e;e=V();){try{e.a.call(e.b)}catch(t){yt(t)}B(j,e)}_t=!1}function wt(e,t){if(this.a=Et,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,e!=f)try{var n=this;e.call(t,(function(e){Nt(n,St,e)}),(function(e){if(!(e instanceof Ht))try{if(e instanceof Error)throw e;throw Error("Promise rejected.")}catch(t){}Nt(n,Tt,e)}))}catch(r){Nt(this,Tt,r)}}var Et=0,St=2,Tt=3;function kt(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}kt.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Mt=new F((function(){return new kt}),(function(e){e.reset()}));function Ct(e,t,n){var r=Mt.get();return r.g=e,r.b=t,r.f=n,r}function At(e){if(e instanceof wt)return e;var t=new wt(f);return Nt(t,St,e),t}function It(e){return new wt((function(t,n){n(e)}))}function Pt(e,t,n){zt(e,t,n,null)||gt(E(t,e))}function Rt(e){return new wt((function(t){var n=e.length,r=[];if(n)for(var i=function(e,i,a){n--,r[e]=i?{Pb:!0,value:a}:{Pb:!1,reason:a},0==n&&t(r)},a=0;a<e.length;a++)Pt(e[a],E(i,a,!0),E(i,a,!1));else t(r)}))}function Lt(e,t){if(e.a==Et)if(e.c){var n=e.c;if(n.b){for(var r=0,i=null,a=null,o=n.b;o&&(o.c||(r++,o.a==e&&(i=o),!(i&&1<r)));o=o.next)i||(a=o);i&&(n.a==Et&&1==r?Lt(n,t):(a?((r=a).next==n.f&&(n.f=r),r.next=r.next.next):Bt(n),Ut(n,i,Tt,t)))}e.c=null}else Nt(e,Tt,t)}function Ot(e,t){e.b||e.a!=St&&e.a!=Tt||Ft(e),e.f?e.f.next=t:e.b=t,e.f=t}function Dt(e,t,n,r){var i=Ct(null,null,null);return i.a=new wt((function(e,a){i.g=t?function(n){try{var i=t.call(r,n);e(i)}catch(o){a(o)}}:e,i.b=n?function(t){try{var i=n.call(r,t);void 0===i&&t instanceof Ht?a(t):e(i)}catch(o){a(o)}}:a})),i.a.c=e,Ot(e,i),i.a}function Nt(e,t,n){e.a==Et&&(e===n&&(t=Tt,n=new TypeError("Promise cannot resolve to itself")),e.a=1,zt(n,e.$c,e.ad,e)||(e.i=n,e.a=t,e.c=null,Ft(e),t!=Tt||n instanceof Ht||function(e,t){e.g=!0,gt((function(){e.g&&Vt.call(null,t)}))}(e,n)))}function zt(e,t,n,r){if(e instanceof wt)return Ot(e,Ct(t||f,n||null,r)),!0;if(O(e))return e.then(t,n,r),!0;if(v(e))try{var i=e.then;if(m(i))return function(e,t,n,r,i){function a(e){s||(s=!0,r.call(i,e))}function o(e){s||(s=!0,n.call(i,e))}var s=!1;try{t.call(e,o,a)}catch(l){a(l)}}(e,i,t,n,r),!0}catch(a){return n.call(r,a),!0}return!1}function Ft(e){e.h||(e.h=!0,gt(e.gc,e))}function Bt(e){var t=null;return e.b&&(t=e.b,e.b=t.next,t.next=null),e.b||(e.f=null),t}function Ut(e,t,n,r){if(n==Tt&&t.b&&!t.c)for(;e&&e.g;e=e.c)e.g=!1;if(t.a)t.a.c=null,jt(t,n,r);else try{t.c?t.g.call(t.f):jt(t,n,r)}catch(i){Vt.call(null,i)}B(Mt,t)}function jt(e,t,n){t==St?e.g.call(e.f,n):e.b&&e.b.call(e.f,n)}wt.prototype.then=function(e,t,n){return Dt(this,m(e)?e:null,m(t)?t:null,n)},wt.prototype.$goog_Thenable=!0,(n=wt.prototype).oa=function(e,t){return(e=Ct(e,e,t)).c=!0,Ot(this,e),this},n.o=function(e,t){return Dt(this,null,e,t)},n.cancel=function(e){if(this.a==Et){var t=new Ht(e);gt((function(){Lt(this,t)}),this)}},n.$c=function(e){this.a=Et,Nt(this,St,e)},n.ad=function(e){this.a=Et,Nt(this,Tt,e)},n.gc=function(){for(var e;e=Bt(this);)Ut(this,e,this.a,this.i);this.h=!1};var Vt=yt;function Ht(e){D.call(this,e)}function Gt(){0!=Wt&&(qt[y(this)]=this),this.xa=this.xa,this.pa=this.pa}T(Ht,D),Ht.prototype.name="cancel";var Wt=0,qt={};function Xt(e){if(!e.xa&&(e.xa=!0,e.Da(),0!=Wt)){var t=y(e);if(0!=Wt&&e.pa&&0<e.pa.length)throw Error(e+" did not empty its onDisposeCallbacks queue. This probably means it overrode dispose() or disposeInternal() without calling the superclass' method.");delete qt[t]}}Gt.prototype.xa=!1,Gt.prototype.Da=function(){if(this.pa)for(;this.pa.length;)this.pa.shift()()};var Zt=Object.freeze||function(e){return e},Kt=!Ke||9<=Number(lt),Yt=Ke&&!ot("9"),Jt=function(){if(!l.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{l.addEventListener("test",f,t),l.removeEventListener("test",f,t)}catch(n){}return e}();function Qt(e,t){this.type=e,this.b=this.target=t,this.defaultPrevented=!1}function $t(e,t){if(Qt.call(this,e?e.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.b=t,t=e.relatedTarget){if(Qe){e:{try{qe(t.nodeName);var i=!0;break e}catch(a){}i=!1}i||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:en[e.pointerType]||"",this.a=e,e.defaultPrevented&&this.preventDefault()}}Qt.prototype.preventDefault=function(){this.defaultPrevented=!0},T($t,Qt);var en=Zt({2:"touch",3:"pen",4:"mouse"});$t.prototype.preventDefault=function(){$t.ab.preventDefault.call(this);var e=this.a;if(e.preventDefault)e.preventDefault();else if(e.returnValue=!1,Yt)try{(e.ctrlKey||112<=e.keyCode&&123>=e.keyCode)&&(e.keyCode=-1)}catch(t){}},$t.prototype.g=function(){return this.a};var tn="closure_listenable_"+(1e6*Math.random()|0),nn=0;function rn(e,t,n,r,i){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.Va=i,this.key=++nn,this.va=this.Pa=!1}function an(e){e.va=!0,e.listener=null,e.proxy=null,e.src=null,e.Va=null}function on(e){this.src=e,this.a={},this.b=0}function sn(e,t){var n=t.type;n in e.a&&Y(e.a[n],t)&&(an(t),0==e.a[n].length&&(delete e.a[n],e.b--))}function ln(e,t,n,r){for(var i=0;i<e.length;++i){var a=e[i];if(!a.va&&a.listener==t&&a.capture==!!n&&a.Va==r)return i}return-1}on.prototype.add=function(e,t,n,r,i){var a=e.toString();(e=this.a[a])||(e=this.a[a]=[],this.b++);var o=ln(e,t,r,i);return-1<o?(t=e[o],n||(t.Pa=!1)):((t=new rn(t,this.src,a,!!r,i)).Pa=n,e.push(t)),t};var un="closure_lm_"+(1e6*Math.random()|0),cn={};function hn(e,t,n,r,i){if(r&&r.once)dn(e,t,n,r,i);else if(Array.isArray(t))for(var a=0;a<t.length;a++)hn(e,t[a],n,r,i);else n=wn(n),e&&e[tn]?Sn(e,t,n,v(r)?!!r.capture:!!r,i):fn(e,t,n,!1,r,i)}function fn(e,t,n,r,i,a){if(!t)throw Error("Invalid event type");var o=v(i)?!!i.capture:!!i,s=bn(e);if(s||(e[un]=s=new on(e)),!(n=s.add(t,n,r,o,a)).proxy){if(r=function(){var e=_n,t=Kt?function(n){return e.call(t.src,t.listener,n)}:function(n){if(!(n=e.call(t.src,t.listener,n)))return n};return t}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)Jt||(i=o),void 0===i&&(i=!1),e.addEventListener(t.toString(),r,i);else if(e.attachEvent)e.attachEvent(vn(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}0}}function dn(e,t,n,r,i){if(Array.isArray(t))for(var a=0;a<t.length;a++)dn(e,t[a],n,r,i);else n=wn(n),e&&e[tn]?Tn(e,t,n,v(r)?!!r.capture:!!r,i):fn(e,t,n,!0,r,i)}function pn(e,t,n,r,i){if(Array.isArray(t))for(var a=0;a<t.length;a++)pn(e,t[a],n,r,i);else r=v(r)?!!r.capture:!!r,n=wn(n),e&&e[tn]?(e=e.v,(t=String(t).toString())in e.a&&(-1<(n=ln(a=e.a[t],n,r,i))&&(an(a[n]),Array.prototype.splice.call(a,n,1),0==a.length&&(delete e.a[t],e.b--)))):e&&(e=bn(e))&&(t=e.a[t.toString()],e=-1,t&&(e=ln(t,n,r,i)),(n=-1<e?t[e]:null)&&mn(n))}function mn(e){if("number"!==typeof e&&e&&!e.va){var t=e.src;if(t&&t[tn])sn(t.v,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(vn(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=bn(t))?(sn(n,e),0==n.b&&(n.src=null,t[un]=null)):an(e)}}}function vn(e){return e in cn?cn[e]:cn[e]="on"+e}function yn(e,t,n,r){var i=!0;if((e=bn(e))&&(t=e.a[t.toString()]))for(t=t.concat(),e=0;e<t.length;e++){var a=t[e];a&&a.capture==n&&!a.va&&(a=gn(a,r),i=i&&!1!==a)}return i}function gn(e,t){var n=e.listener,r=e.Va||e.src;return e.Pa&&mn(e),n.call(r,t)}function _n(e,t){if(e.va)return!0;if(!Kt){if(!t)e:{t=["window","event"];for(var n=l,r=0;r<t.length;r++)if(null==(n=n[t[r]])){t=null;break e}t=n}if(t=new $t(r=t,this),n=!0,!(0>r.keyCode||void 0!=r.returnValue)){e:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break e}catch(o){i=!0}(i||void 0==r.returnValue)&&(r.returnValue=!0)}for(r=[],i=t.b;i;i=i.parentNode)r.push(i);for(e=e.type,i=r.length-1;0<=i;i--){t.b=r[i];var a=yn(r[i],e,!0,t);n=n&&a}for(i=0;i<r.length;i++)t.b=r[i],a=yn(r[i],e,!1,t),n=n&&a}return n}return gn(e,new $t(t,this))}function bn(e){return(e=e[un])instanceof on?e:null}var xn="__closure_events_fn_"+(1e9*Math.random()>>>0);function wn(e){return m(e)?e:(e[xn]||(e[xn]=function(t){return e.handleEvent(t)}),e[xn])}function En(){Gt.call(this),this.v=new on(this),this.ac=this,this.gb=null}function Sn(e,t,n,r,i){e.v.add(String(t),n,!1,r,i)}function Tn(e,t,n,r,i){e.v.add(String(t),n,!0,r,i)}function kn(e,t,n,r){if(!(t=e.v.a[String(t)]))return!0;t=t.concat();for(var i=!0,a=0;a<t.length;++a){var o=t[a];if(o&&!o.va&&o.capture==n){var s=o.listener,l=o.Va||o.src;o.Pa&&sn(e.v,o),i=!1!==s.call(l,r)&&i}}return i&&!r.defaultPrevented}function Mn(e,t,n){if(m(e))n&&(e=w(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=w(e.handleEvent,e)}return 2147483647<Number(t)?-1:l.setTimeout(e,t||0)}function Cn(e){var t=null;return new wt((function(n,r){-1==(t=Mn((function(){n(void 0)}),e))&&r(Error("Failed to schedule timer."))})).o((function(e){throw l.clearTimeout(t),e}))}function An(e){if(e.W&&"function"==typeof e.W)return e.W();if("string"===typeof e)return e.split("");if(p(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}function In(e){if(e.Y&&"function"==typeof e.Y)return e.Y();if(!e.W||"function"!=typeof e.W){if(p(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(var r in t=[],n=0,e)t[n++]=r;return t}}function Pn(e,t){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(e)if(e instanceof Pn)for(n=e.Y(),r=0;r<n.length;r++)this.set(n[r],e.get(n[r]));else for(r in e)this.set(r,e[r])}function Rn(e){if(e.c!=e.a.length){for(var t=0,n=0;t<e.a.length;){var r=e.a[t];Ln(e.b,r)&&(e.a[n++]=r),t++}e.a.length=n}if(e.c!=e.a.length){var i={};for(n=t=0;t<e.a.length;)Ln(i,r=e.a[t])||(e.a[n++]=r,i[r]=1),t++;e.a.length=n}}function Ln(e,t){return Object.prototype.hasOwnProperty.call(e,t)}T(En,Gt),En.prototype[tn]=!0,En.prototype.addEventListener=function(e,t,n,r){hn(this,e,t,n,r)},En.prototype.removeEventListener=function(e,t,n,r){pn(this,e,t,n,r)},En.prototype.dispatchEvent=function(e){var t,n=this.gb;if(n)for(t=[];n;n=n.gb)t.push(n);n=this.ac;var r=e.type||e;if("string"===typeof e)e=new Qt(e,n);else if(e instanceof Qt)e.target=e.target||n;else{var i=e;ge(e=new Qt(r,n),i)}if(i=!0,t)for(var a=t.length-1;0<=a;a--){var o=e.b=t[a];i=kn(o,r,!0,e)&&i}if(i=kn(o=e.b=n,r,!0,e)&&i,i=kn(o,r,!1,e)&&i,t)for(a=0;a<t.length;a++)i=kn(o=e.b=t[a],r,!1,e)&&i;return i},En.prototype.Da=function(){if(En.ab.Da.call(this),this.v){var e,t=this.v;for(e in t.a){for(var n=t.a[e],r=0;r<n.length;r++)an(n[r]);delete t.a[e],t.b--}}this.gb=null},(n=Pn.prototype).W=function(){Rn(this);for(var e=[],t=0;t<this.a.length;t++)e.push(this.b[this.a[t]]);return e},n.Y=function(){return Rn(this),this.a.concat()},n.clear=function(){this.b={},this.c=this.a.length=0},n.get=function(e,t){return Ln(this.b,e)?this.b[e]:t},n.set=function(e,t){Ln(this.b,e)||(this.c++,this.a.push(e)),this.b[e]=t},n.forEach=function(e,t){for(var n=this.Y(),r=0;r<n.length;r++){var i=n[r],a=this.get(i);e.call(t,a,i,this)}};var On=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Dn(e,t){var n;this.a=this.l=this.c="",this.g=null,this.h=this.f="",this.i=!1,e instanceof Dn?(this.i=void 0!==t?t:e.i,Nn(this,e.c),this.l=e.l,this.a=e.a,zn(this,e.g),this.f=e.f,Fn(this,rr(e.b)),this.h=e.h):e&&(n=String(e).match(On))?(this.i=!!t,Nn(this,n[1]||"",!0),this.l=Hn(n[2]||""),this.a=Hn(n[3]||"",!0),zn(this,n[4]),this.f=Hn(n[5]||"",!0),Fn(this,n[6]||"",!0),this.h=Hn(n[7]||"")):(this.i=!!t,this.b=new Jn(null,this.i))}function Nn(e,t,n){e.c=n?Hn(t,!0):t,e.c&&(e.c=e.c.replace(/:$/,""))}function zn(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.g=t}else e.g=null}function Fn(e,t,n){t instanceof Jn?(e.b=t,function(e,t){t&&!e.f&&(Qn(e),e.c=null,e.a.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(er(this,t),nr(this,n,e))}),e)),e.f=t}(e.b,e.i)):(n||(t=Gn(t,Kn)),e.b=new Jn(t,e.i))}function Bn(e,t,n){e.b.set(t,n)}function Un(e,t){return e.b.get(t)}function jn(e){return e instanceof Dn?new Dn(e):new Dn(e,void 0)}function Vn(e,t,n,r){var i=new Dn(null,void 0);return e&&Nn(i,e),t&&(i.a=t),n&&zn(i,n),r&&(i.f=r),i}function Hn(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function Gn(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,Wn),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function Wn(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Dn.prototype.toString=function(){var e=[],t=this.c;t&&e.push(Gn(t,qn,!0),":");var n=this.a;return(n||"file"==t)&&(e.push("//"),(t=this.l)&&e.push(Gn(t,qn,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.g)&&e.push(":",String(n))),(n=this.f)&&(this.a&&"/"!=n.charAt(0)&&e.push("/"),e.push(Gn(n,"/"==n.charAt(0)?Zn:Xn,!0))),(n=this.b.toString())&&e.push("?",n),(n=this.h)&&e.push("#",Gn(n,Yn)),e.join("")},Dn.prototype.resolve=function(e){var t=new Dn(this),n=!!e.c;n?Nn(t,e.c):n=!!e.l,n?t.l=e.l:n=!!e.a,n?t.a=e.a:n=null!=e.g;var r=e.f;if(n)zn(t,e.g);else if(n=!!e.f){if("/"!=r.charAt(0))if(this.a&&!this.f)r="/"+r;else{var i=t.f.lastIndexOf("/");-1!=i&&(r=t.f.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(ue(i,"./")||ue(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var a=[],o=0;o<i.length;){var s=i[o++];"."==s?r&&o==i.length&&a.push(""):".."==s?((1<a.length||1==a.length&&""!=a[0])&&a.pop(),r&&o==i.length&&a.push("")):(a.push(s),r=!0)}r=a.join("/")}else r=i}return n?t.f=r:n=""!==e.b.toString(),n?Fn(t,rr(e.b)):n=!!e.h,n&&(t.h=e.h),t};var qn=/[#\/\?@]/g,Xn=/[#\?:]/g,Zn=/[#\?]/g,Kn=/[#\?@]/g,Yn=/#/g;function Jn(e,t){this.b=this.a=null,this.c=e||null,this.f=!!t}function Qn(e){e.a||(e.a=new Pn,e.b=0,e.c&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),i=null;if(0<=r){var a=e[n].substring(0,r);i=e[n].substring(r+1)}else a=e[n];t(a,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(e.c,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function $n(e){var t=In(e);if("undefined"==typeof t)throw Error("Keys are undefined");var n=new Jn(null,void 0);e=An(e);for(var r=0;r<t.length;r++){var i=t[r],a=e[r];Array.isArray(a)?nr(n,i,a):n.add(i,a)}return n}function er(e,t){Qn(e),t=ir(e,t),Ln(e.a.b,t)&&(e.c=null,e.b-=e.a.get(t).length,Ln((e=e.a).b,t)&&(delete e.b[t],e.c--,e.a.length>2*e.c&&Rn(e)))}function tr(e,t){return Qn(e),t=ir(e,t),Ln(e.a.b,t)}function nr(e,t,n){er(e,t),0<n.length&&(e.c=null,e.a.set(ir(e,t),$(n)),e.b+=n.length)}function rr(e){var t=new Jn;return t.c=e.c,e.a&&(t.a=new Pn(e.a),t.b=e.b),t}function ir(e,t){return t=String(t),e.f&&(t=t.toLowerCase()),t}function ar(e){var t=[];return sr(new or,e,t),t.join("")}function or(){}function sr(e,t,n){if(null==t)n.push("null");else{if("object"==typeof t){if(Array.isArray(t)){var r=t;t=r.length,n.push("[");for(var i="",a=0;a<t;a++)n.push(i),sr(e,r[a],n),i=",";return void n.push("]")}if(!(t instanceof String||t instanceof Number||t instanceof Boolean)){for(r in n.push("{"),i="",t)Object.prototype.hasOwnProperty.call(t,r)&&("function"!=typeof(a=t[r])&&(n.push(i),cr(r,n),n.push(":"),sr(e,a,n),i=","));return void n.push("}")}t=t.valueOf()}switch(typeof t){case"string":cr(t,n);break;case"number":n.push(isFinite(t)&&!isNaN(t)?String(t):"null");break;case"boolean":n.push(String(t));break;case"function":n.push("null");break;default:throw Error("Unknown type: "+typeof t)}}}(n=Jn.prototype).add=function(e,t){Qn(this),this.c=null,e=ir(this,e);var n=this.a.get(e);return n||this.a.set(e,n=[]),n.push(t),this.b+=1,this},n.clear=function(){this.a=this.c=null,this.b=0},n.forEach=function(e,t){Qn(this),this.a.forEach((function(n,r){W(n,(function(n){e.call(t,n,r,this)}),this)}),this)},n.Y=function(){Qn(this);for(var e=this.a.W(),t=this.a.Y(),n=[],r=0;r<t.length;r++)for(var i=e[r],a=0;a<i.length;a++)n.push(t[r]);return n},n.W=function(e){Qn(this);var t=[];if("string"===typeof e)tr(this,e)&&(t=Q(t,this.a.get(ir(this,e))));else{e=this.a.W();for(var n=0;n<e.length;n++)t=Q(t,e[n])}return t},n.set=function(e,t){return Qn(this),this.c=null,tr(this,e=ir(this,e))&&(this.b-=this.a.get(e).length),this.a.set(e,[t]),this.b+=1,this},n.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},n.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var e=[],t=this.a.Y(),n=0;n<t.length;n++){var r=t[n],i=encodeURIComponent(String(r));r=this.W(r);for(var a=0;a<r.length;a++){var o=i;""!==r[a]&&(o+="="+encodeURIComponent(String(r[a]))),e.push(o)}}return this.c=e.join("&")};var lr={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},ur=/\uffff/.test("\uffff")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function cr(e,t){t.push('"',e.replace(ur,(function(e){var t=lr[e];return t||(t="\\u"+(65536|e.charCodeAt(0)).toString(16).substr(1),lr[e]=t),t})),'"')}function hr(){var e=Pr();return Ke&&!!lt&&11==lt||/Edge\/\d+/.test(e)}function fr(){return l.window&&l.window.location.href||self&&self.location&&self.location.href||""}function dr(e,t){t=t||l.window;var n="about:blank";e&&(n=Le(ze(e)||Ue)),t.location.href=n}function pr(e,t){var n,r=[];for(n in e)n in t?typeof e[n]!=typeof t[n]?r.push(n):"object"==typeof e[n]&&null!=e[n]&&null!=t[n]?0<pr(e[n],t[n]).length&&r.push(n):e[n]!==t[n]&&r.push(n):r.push(n);for(n in t)n in e||r.push(n);return r}function mr(e){return!!((e=(e||Pr()).toLowerCase()).match(/android/)||e.match(/webos/)||e.match(/iphone|ipad|ipod/)||e.match(/blackberry/)||e.match(/windows phone/)||e.match(/iemobile/))}function vr(e){e=e||l.window;try{e.close()}catch(t){}}function yr(e,t,n){var r=Math.floor(1e9*Math.random()).toString();t=t||500,n=n||600;var i=(window.screen.availHeight-n)/2,a=(window.screen.availWidth-t)/2;for(o in t={width:t,height:n,top:0<i?i:0,left:0<a?a:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=Pr().toLowerCase(),r&&(t.target=r,ue(n,"crios/")&&(t.target="_blank")),Cr(Pr())==kr&&(e=e||"http://localhost",t.scrollbars=!0),n=e||"",(e=t)||(e={}),r=window,t=n instanceof Re?n:ze("undefined"!=typeof n.href?n.href:String(n))||Ue,n=e.target||n.target,i=[],e)switch(o){case"width":case"height":case"top":case"left":i.push(o+"="+e[o]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(o+"="+(e[o]?1:0))}var o=i.join(",");if((de("iPhone")&&!de("iPod")&&!de("iPad")||de("iPad")||de("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(_e(o=vt(document,"A"),"HTMLAnchorElement"),t=t instanceof Re?t:Fe(t),o.href=Le(t),o.setAttribute("target",n),e.noreferrer&&o.setAttribute("rel","noreferrer"),(e=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),o.dispatchEvent(e),o={}):e.noreferrer?(o=He("",r,n,o),e=Le(t),o&&(Je&&ue(e,";")&&(e="'"+e.replace(/'/g,"%27")+"'"),o.opener=null,e='<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+We(e)+'">',e=new je(e=(r=Te())?r.createHTML(e):e,null,Ve),r=o.document)&&(r.write(function(e){return e instanceof je&&e.constructor===je?e.a:(z("expected object of type SafeHtml, got '"+e+"' of type "+d(e)),"type_error:SafeHtml")}(e)),r.close())):(o=He(t,r,n,o))&&e.noopener&&(o.opener=null),o)try{o.focus()}catch(s){}return o}var gr=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,_r=/^[^@]+@[^@]+$/;function br(){var e=null;return new wt((function(t){"complete"==l.document.readyState?t():(e=function(){t()},dn(window,"load",e))})).o((function(t){throw pn(window,"load",e),t}))}function xr(e){return e=e||Pr(),!("file:"!==Nr()&&"ionic:"!==Nr()||!e.toLowerCase().match(/iphone|ipad|ipod|android/))}function wr(){var e=l.window;try{return!(!e||e==e.top)}catch(t){return!1}}function Er(){return"undefined"!==typeof l.WorkerGlobalScope&&"function"===typeof l.importScripts}function Sr(){return t.a.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":t.a.INTERNAL.hasOwnProperty("node")?"Node":Er()?"Worker":"Browser"}function Tr(){var e=Sr();return"ReactNative"===e||"Node"===e}var kr="Firefox",Mr="Chrome";function Cr(e){var t=e.toLowerCase();return ue(t,"opera/")||ue(t,"opr/")||ue(t,"opios/")?"Opera":ue(t,"iemobile")?"IEMobile":ue(t,"msie")||ue(t,"trident/")?"IE":ue(t,"edge/")?"Edge":ue(t,"firefox/")?kr:ue(t,"silk/")?"Silk":ue(t,"blackberry")?"Blackberry":ue(t,"webos")?"Webos":!ue(t,"safari/")||ue(t,"chrome/")||ue(t,"crios/")||ue(t,"android")?!ue(t,"chrome/")&&!ue(t,"crios/")||ue(t,"edge/")?ue(t,"android")?"Android":(e=e.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==e.length?e[1]:"Other":Mr:"Safari"}var Ar={md:"FirebaseCore-web",od:"FirebaseUI-web"};function Ir(e,t){t=t||[];var n,r=[],i={};for(n in Ar)i[Ar[n]]=!0;for(n=0;n<t.length;n++)"undefined"!==typeof i[t[n]]&&(delete i[t[n]],r.push(t[n]));return r.sort(),(t=r).length||(t=["FirebaseCore-web"]),"Browser"===(r=Sr())?r=Cr(i=Pr()):"Worker"===r&&(r=Cr(i=Pr())+"-"+r),r+"/JsCore/"+e+"/"+t.join(",")}function Pr(){return l.navigator&&l.navigator.userAgent||""}function Rr(e,t){e=e.split("."),t=t||l;for(var n=0;n<e.length&&"object"==typeof t&&null!=t;n++)t=t[e[n]];return n!=e.length&&(t=void 0),t}function Lr(){try{var e=l.localStorage,t=jr();if(e)return e.setItem(t,"1"),e.removeItem(t),!hr()||!!l.indexedDB}catch(n){return Er()&&!!l.indexedDB}return!1}function Or(){return(Dr()||"chrome-extension:"===Nr()||xr())&&!Tr()&&Lr()&&!Er()}function Dr(){return"http:"===Nr()||"https:"===Nr()}function Nr(){return l.location&&l.location.protocol||null}function zr(e){return!mr(e=e||Pr())&&Cr(e)!=kr}function Fr(e){return"undefined"===typeof e?null:ar(e)}function Br(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&null!==e[t]&&void 0!==e[t]&&(n[t]=e[t]);return n}function Ur(e){if(null!==e)return JSON.parse(e)}function jr(e){return e||Math.floor(1e9*Math.random()).toString()}function Vr(e){return"Safari"!=Cr(e=e||Pr())&&!e.toLowerCase().match(/iphone|ipad|ipod/)}function Hr(){var e=l.___jsl;if(e&&e.H)for(var t in e.H)if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=e.H[t].L.concat(),e.CP)for(var n=0;n<e.CP.length;n++)e.CP[n]=null}function Gr(e,t){if(e>t)throw Error("Short delay should be less than long delay!");this.a=e,this.c=t,e=Pr(),t=Sr(),this.b=mr(e)||"ReactNative"===t}function Wr(){var e=l.document;return!e||"undefined"===typeof e.visibilityState||"visible"==e.visibilityState}function qr(e){try{var t=new Date(parseInt(e,10));if(!isNaN(t.getTime())&&!/[^0-9]/.test(e))return t.toUTCString()}catch(n){}return null}function Xr(){return!(!Rr("fireauth.oauthhelper",l)&&!Rr("fireauth.iframe",l))}Gr.prototype.get=function(){var e=l.navigator;return!e||"boolean"!==typeof e.onLine||!Dr()&&"chrome-extension:"!==Nr()&&"undefined"===typeof e.connection||e.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Zr,Kr={};function Yr(e){Kr[e]||(Kr[e]=!0,"undefined"!==typeof console&&"function"===typeof console.warn&&console.warn(e))}try{var Jr={};Object.defineProperty(Jr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Jr,"abcd",{configurable:!0,enumerable:!0,value:2}),Zr=2==Jr.abcd}catch(ho){Zr=!1}function Qr(e,t,n){Zr?Object.defineProperty(e,t,{configurable:!0,enumerable:!0,value:n}):e[t]=n}function $r(e,t){if(t)for(var n in t)t.hasOwnProperty(n)&&Qr(e,n,t[n])}function ei(e){var t={};return $r(t,e),t}function ti(e){var t=e;if("object"==typeof e&&null!=e)for(var n in t="length"in e?[]:{},e)Qr(t,n,ti(e[n]));return t}function ni(e){var t=e&&(e[si]?"phone":null);if(!(t&&e&&e[oi]))throw new M("internal-error","Internal assert: invalid MultiFactorInfo object");Qr(this,"uid",e[oi]),Qr(this,"displayName",e[ii]||null);var n=null;e[ai]&&(n=new Date(e[ai]).toUTCString()),Qr(this,"enrollmentTime",n),Qr(this,"factorId",t)}function ri(e){try{var t=new li(e)}catch(n){t=null}return t}ni.prototype.w=function(){return{uid:this.uid,displayName:this.displayName,factorId:this.factorId,enrollmentTime:this.enrollmentTime}};var ii="displayName",ai="enrolledAt",oi="mfaEnrollmentId",si="phoneInfo";function li(e){ni.call(this,e),Qr(this,"phoneNumber",e[si])}function ui(e){var t={},n=e[di],r=e[mi],i=e[vi];if(e=ri(e[pi]),!i||i!=hi&&i!=fi&&!n||i==fi&&!r||i==ci&&!e)throw Error("Invalid checkActionCode response!");i==fi?(t[gi]=n||null,t[bi]=n||null,t[yi]=r):(t[gi]=r||null,t[bi]=r||null,t[yi]=n||null),t[_i]=e||null,Qr(this,wi,i),Qr(this,xi,ti(t))}T(li,ni),li.prototype.w=function(){var e=li.ab.w.call(this);return e.phoneNumber=this.phoneNumber,e};var ci="REVERT_SECOND_FACTOR_ADDITION",hi="EMAIL_SIGNIN",fi="VERIFY_AND_CHANGE_EMAIL",di="email",pi="mfaInfo",mi="newEmail",vi="requestType",yi="email",gi="fromEmail",_i="multiFactorInfo",bi="previousEmail",xi="data",wi="operation";function Ei(e){var t=Un(e=jn(e),Si)||null,n=Un(e,Ti)||null,r=Un(e,Ci)||null;if(r=r&&Ii[r]||null,!t||!n||!r)throw new M("argument-error",Si+", "+Ti+"and "+Ci+" are required in a valid action code URL.");$r(this,{apiKey:t,operation:r,code:n,continueUrl:Un(e,ki)||null,languageCode:Un(e,Mi)||null,tenantId:Un(e,Ai)||null})}var Si="apiKey",Ti="oobCode",ki="continueUrl",Mi="languageCode",Ci="mode",Ai="tenantId",Ii={recoverEmail:"RECOVER_EMAIL",resetPassword:"PASSWORD_RESET",revertSecondFactorAddition:ci,signIn:hi,verifyAndChangeEmail:fi,verifyEmail:"VERIFY_EMAIL"};function Pi(e){try{return new Ei(e)}catch(t){return null}}function Ri(e){var t=e[zi];if("undefined"===typeof t)throw new M("missing-continue-uri");if("string"!==typeof t||"string"===typeof t&&!t.length)throw new M("invalid-continue-uri");this.h=t,this.b=this.a=null,this.g=!1;var n=e[Li];if(n&&"object"===typeof n){t=n[Ui];var r=n[Fi];if(n=n[Bi],"string"===typeof t&&t.length){if(this.a=t,"undefined"!==typeof r&&"boolean"!==typeof r)throw new M("argument-error",Fi+" property must be a boolean when specified.");if(this.g=!!r,"undefined"!==typeof n&&("string"!==typeof n||"string"===typeof n&&!n.length))throw new M("argument-error",Bi+" property must be a non empty string when specified.");this.b=n||null}else{if("undefined"!==typeof t)throw new M("argument-error",Ui+" property must be a non empty string when specified.");if("undefined"!==typeof r||"undefined"!==typeof n)throw new M("missing-android-pkg-name")}}else if("undefined"!==typeof n)throw new M("argument-error",Li+" property must be a non null object when specified.");if(this.f=null,(t=e[Ni])&&"object"===typeof t){if("string"===typeof(t=t[ji])&&t.length)this.f=t;else if("undefined"!==typeof t)throw new M("argument-error",ji+" property must be a non empty string when specified.")}else if("undefined"!==typeof t)throw new M("argument-error",Ni+" property must be a non null object when specified.");if("undefined"!==typeof(t=e[Di])&&"boolean"!==typeof t)throw new M("argument-error",Di+" property must be a boolean when specified.");if(this.c=!!t,"undefined"!==typeof(e=e[Oi])&&("string"!==typeof e||"string"===typeof e&&!e.length))throw new M("argument-error",Oi+" property must be a non empty string when specified.");this.i=e||null}var Li="android",Oi="dynamicLinkDomain",Di="handleCodeInApp",Ni="iOS",zi="url",Fi="installApp",Bi="minimumVersion",Ui="packageName",ji="bundleId";function Vi(e){var t={};for(var n in t.continueUrl=e.h,t.canHandleCodeInApp=e.c,(t.androidPackageName=e.a)&&(t.androidMinimumVersion=e.b,t.androidInstallApp=e.g),t.iOSBundleId=e.f,t.dynamicLinkDomain=e.i,t)null===t[n]&&delete t[n];return t}var Hi=null;function Gi(e){var t="";return function(e,t){function n(t){for(;r<e.length;){var n=e.charAt(r++),i=Hi[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return t}!function(){if(!Hi){Hi={};for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),t=["+/=","+/","-_=","-_.","-_"],n=0;5>n;n++)for(var r=e.concat(t[n].split("")),i=0;i<r.length;i++){var a=r[i];void 0===Hi[a]&&(Hi[a]=i)}}}();for(var r=0;;){var i=n(-1),a=n(0),o=n(64),s=n(64);if(64===s&&-1===i)break;t(i<<2|a>>4),64!=o&&(t(a<<4&240|o>>2),64!=s&&t(o<<6&192|s))}}(e,(function(e){t+=String.fromCharCode(e)})),t}function Wi(e){var t=Xi(e);if(!(t&&t.sub&&t.iss&&t.aud&&t.exp))throw Error("Invalid JWT");this.h=e,this.a=t.exp,this.i=t.sub,e=Date.now()/1e3,this.g=t.iat||(e>this.a?this.a:e),this.b=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.f=t.firebase&&t.firebase.tenant||null,this.c=!!t.is_anonymous||"anonymous"==this.b}function qi(e){try{return new Wi(e)}catch(t){return null}}function Xi(e){if(!e)return null;if(3!=(e=e.split(".")).length)return null;for(var t=(4-(e=e[1]).length%4)%4,n=0;n<t;n++)e+=".";try{return JSON.parse(Gi(e))}catch(r){}return null}Wi.prototype.T=function(){return this.f},Wi.prototype.l=function(){return this.c},Wi.prototype.toString=function(){return this.h};var Zi="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),Ki=["client_id","response_type","scope","redirect_uri","state"],Yi={nd:{Ja:"locale",ua:700,ta:600,fa:"facebook.com",Xa:Ki},pd:{Ja:null,ua:500,ta:750,fa:"github.com",Xa:Ki},qd:{Ja:"hl",ua:515,ta:680,fa:"google.com",Xa:Ki},wd:{Ja:"lang",ua:485,ta:705,fa:"twitter.com",Xa:Zi},kd:{Ja:"locale",ua:640,ta:600,fa:"apple.com",Xa:[]}};function Ji(e){for(var t in Yi)if(Yi[t].fa==e)return Yi[t];return null}function Qi(e){var t={};t["facebook.com"]=ra,t["google.com"]=aa,t["github.com"]=ia,t["twitter.com"]=oa;var n=e&&e[ea];try{if(n)return t[n]?new t[n](e):new na(e);if("undefined"!==typeof e[$i])return new ta(e)}catch(r){}return null}var $i="idToken",ea="providerId";function ta(e){var t=e[ea];if(!t&&e[$i]){var n=qi(e[$i]);n&&n.b&&(t=n.b)}if(!t)throw Error("Invalid additional user info!");"anonymous"!=t&&"custom"!=t||(t=null),n=!1,"undefined"!==typeof e.isNewUser?n=!!e.isNewUser:"identitytoolkit#SignupNewUserResponse"===e.kind&&(n=!0),Qr(this,"providerId",t),Qr(this,"isNewUser",n)}function na(e){ta.call(this,e),Qr(this,"profile",ti((e=Ur(e.rawUserInfo||"{}"))||{}))}function ra(e){if(na.call(this,e),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function ia(e){if(na.call(this,e),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Qr(this,"username",this.profile&&this.profile.login||null)}function aa(e){if(na.call(this,e),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function oa(e){if(na.call(this,e),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Qr(this,"username",e.screenName||null)}function sa(e){var t=jn(e),n=Un(t,"link"),r=Un(jn(n),"link");return t=Un(t,"deep_link_id"),Un(jn(t),"link")||t||r||n||e}function la(e,t){if(!e&&!t)throw new M("internal-error","Internal assert: no raw session string available");if(e&&t)throw new M("internal-error","Internal assert: unable to determine the session type");this.a=e||null,this.b=t||null,this.type=this.a?ua:ca}T(na,ta),T(ra,na),T(ia,na),T(aa,na),T(oa,na);var ua="enroll",ca="signin";function ha(){}function fa(e,t){return e.then((function(e){if(e[ns]){var n=qi(e[ns]);if(!n||t!=n.i)throw new M("user-mismatch");return e}throw new M("user-mismatch")})).o((function(e){throw e&&e.code&&e.code==I+"user-not-found"?new M("user-mismatch"):e}))}function da(e,t){if(!t)throw new M("internal-error","failed to construct a credential");this.a=t,Qr(this,"providerId",e),Qr(this,"signInMethod",e)}function pa(e){return{pendingToken:e.a,requestUri:"http://localhost"}}function ma(e){if(e&&e.providerId&&e.signInMethod&&0==e.providerId.indexOf("saml.")&&e.pendingToken)try{return new da(e.providerId,e.pendingToken)}catch(t){}return null}function va(e,t,n){if(this.a=null,t.idToken||t.accessToken)t.idToken&&Qr(this,"idToken",t.idToken),t.accessToken&&Qr(this,"accessToken",t.accessToken),t.nonce&&!t.pendingToken&&Qr(this,"nonce",t.nonce),t.pendingToken&&(this.a=t.pendingToken);else{if(!t.oauthToken||!t.oauthTokenSecret)throw new M("internal-error","failed to construct a credential");Qr(this,"accessToken",t.oauthToken),Qr(this,"secret",t.oauthTokenSecret)}Qr(this,"providerId",e),Qr(this,"signInMethod",n)}function ya(e){var t={};return e.idToken&&(t.id_token=e.idToken),e.accessToken&&(t.access_token=e.accessToken),e.secret&&(t.oauth_token_secret=e.secret),t.providerId=e.providerId,e.nonce&&!e.a&&(t.nonce=e.nonce),t={postBody:$n(t).toString(),requestUri:"http://localhost"},e.a&&(delete t.postBody,t.pendingToken=e.a),t}function ga(e){if(e&&e.providerId&&e.signInMethod){var t={idToken:e.oauthIdToken,accessToken:e.oauthTokenSecret?null:e.oauthAccessToken,oauthTokenSecret:e.oauthTokenSecret,oauthToken:e.oauthTokenSecret&&e.oauthAccessToken,nonce:e.nonce,pendingToken:e.pendingToken};try{return new va(e.providerId,t,e.signInMethod)}catch(n){}}return null}function _a(e,t){this.Qc=t||[],$r(this,{providerId:e,isOAuthProvider:!0}),this.Ib={},this.pb=(Ji(e)||{}).Ja||null,this.ob=null}function ba(e){if("string"!==typeof e||0!=e.indexOf("saml."))throw new M("argument-error",'SAML provider IDs must be prefixed with "saml."');_a.call(this,e,[])}function xa(e){_a.call(this,e,Ki),this.a=[]}function wa(){xa.call(this,"facebook.com")}function Ea(e){if(!e)throw new M("argument-error","credential failed: expected 1 argument (the OAuth access token).");var t=e;return v(e)&&(t=e.accessToken),(new wa).credential({accessToken:t})}function Sa(){xa.call(this,"github.com")}function Ta(e){if(!e)throw new M("argument-error","credential failed: expected 1 argument (the OAuth access token).");var t=e;return v(e)&&(t=e.accessToken),(new Sa).credential({accessToken:t})}function ka(){xa.call(this,"google.com"),this.Ca("profile")}function Ma(e,t){var n=e;return v(e)&&(n=e.idToken,t=e.accessToken),(new ka).credential({idToken:n,accessToken:t})}function Ca(){_a.call(this,"twitter.com",Zi)}function Aa(e,t){var n=e;if(v(n)||(n={oauthToken:e,oauthTokenSecret:t}),!n.oauthToken||!n.oauthTokenSecret)throw new M("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new va("twitter.com",n,"twitter.com")}function Ia(e,t,n){this.a=e,this.f=t,Qr(this,"providerId","password"),Qr(this,"signInMethod",n===Ra.EMAIL_LINK_SIGN_IN_METHOD?Ra.EMAIL_LINK_SIGN_IN_METHOD:Ra.EMAIL_PASSWORD_SIGN_IN_METHOD)}function Pa(e){return e&&e.email&&e.password?new Ia(e.email,e.password,e.signInMethod):null}function Ra(){$r(this,{providerId:"password",isOAuthProvider:!1})}function La(e,t){if(!(t=Oa(t)))throw new M("argument-error","Invalid email link!");return new Ia(e,t.code,Ra.EMAIL_LINK_SIGN_IN_METHOD)}function Oa(e){return(e=Pi(e=sa(e)))&&e.operation===hi?e:null}function Da(e){if(!(e.eb&&e.cb||e.La&&e.ea))throw new M("internal-error");this.a=e,Qr(this,"providerId","phone"),this.fa="phone",Qr(this,"signInMethod","phone")}function Na(e){if(e&&"phone"===e.providerId&&(e.verificationId&&e.verificationCode||e.temporaryProof&&e.phoneNumber)){var t={};return W(["verificationId","verificationCode","temporaryProof","phoneNumber"],(function(n){e[n]&&(t[n]=e[n])})),new Da(t)}return null}function za(e){return e.a.La&&e.a.ea?{temporaryProof:e.a.La,phoneNumber:e.a.ea}:{sessionInfo:e.a.eb,code:e.a.cb}}function Fa(e){try{this.a=e||t.a.auth()}catch(n){throw new M("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}$r(this,{providerId:"phone",isOAuthProvider:!1})}function Ba(e,t){if(!e)throw new M("missing-verification-id");if(!t)throw new M("missing-verification-code");return new Da({eb:e,cb:t})}function Ua(e){if(e.temporaryProof&&e.phoneNumber)return new Da({La:e.temporaryProof,ea:e.phoneNumber});var t=e&&e.providerId;if(!t||"password"===t)return null;var n=e&&e.oauthAccessToken,r=e&&e.oauthTokenSecret,i=e&&e.nonce,a=e&&e.oauthIdToken,o=e&&e.pendingToken;try{switch(t){case"google.com":return Ma(a,n);case"facebook.com":return Ea(n);case"github.com":return Ta(n);case"twitter.com":return Aa(n,r);default:return n||r||a||o?o?0==t.indexOf("saml.")?new da(t,o):new va(t,{pendingToken:o,idToken:e.oauthIdToken,accessToken:e.oauthAccessToken},t):new xa(t).credential({idToken:a,accessToken:n,rawNonce:i}):null}}catch(s){return null}}function ja(e){if(!e.isOAuthProvider)throw new M("invalid-oauth-provider")}function Va(e,t,n,r,i,a,o){if(this.c=e,this.b=t||null,this.g=n||null,this.f=r||null,this.i=a||null,this.h=o||null,this.a=i||null,!this.g&&!this.a)throw new M("invalid-auth-event");if(this.g&&this.a)throw new M("invalid-auth-event");if(this.g&&!this.f)throw new M("invalid-auth-event")}function Ha(e){return(e=e||{}).type?new Va(e.type,e.eventId,e.urlResponse,e.sessionId,e.error&&C(e.error),e.postBody,e.tenantId):null}function Ga(){this.b=null,this.a=[]}la.prototype.Ha=function(){return this.a?At(this.a):At(this.b)},la.prototype.w=function(){return this.type==ua?{multiFactorSession:{idToken:this.a}}:{multiFactorSession:{pendingCredential:this.b}}},ha.prototype.ka=function(){},ha.prototype.b=function(){},ha.prototype.c=function(){},ha.prototype.w=function(){},da.prototype.ka=function(e){return Ss(e,pa(this))},da.prototype.b=function(e,t){var n=pa(this);return n.idToken=t,Ts(e,n)},da.prototype.c=function(e,t){return fa(ks(e,pa(this)),t)},da.prototype.w=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},va.prototype.ka=function(e){return Ss(e,ya(this))},va.prototype.b=function(e,t){var n=ya(this);return n.idToken=t,Ts(e,n)},va.prototype.c=function(e,t){return fa(ks(e,ya(this)),t)},va.prototype.w=function(){var e={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(e.oauthIdToken=this.idToken),this.accessToken&&(e.oauthAccessToken=this.accessToken),this.secret&&(e.oauthTokenSecret=this.secret),this.nonce&&(e.nonce=this.nonce),this.a&&(e.pendingToken=this.a),e},_a.prototype.Ka=function(e){return this.Ib=ve(e),this},T(ba,_a),T(xa,_a),xa.prototype.Ca=function(e){return K(this.a,e)||this.a.push(e),this},xa.prototype.Qb=function(){return $(this.a)},xa.prototype.credential=function(e,t){var n;if(!(n=v(e)?{idToken:e.idToken||null,accessToken:e.accessToken||null,nonce:e.rawNonce||null}:{idToken:e||null,accessToken:t||null}).idToken&&!n.accessToken)throw new M("argument-error","credential failed: must provide the ID token and/or the access token.");return new va(this.providerId,n,this.providerId)},T(wa,xa),Qr(wa,"PROVIDER_ID","facebook.com"),Qr(wa,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),T(Sa,xa),Qr(Sa,"PROVIDER_ID","github.com"),Qr(Sa,"GITHUB_SIGN_IN_METHOD","github.com"),T(ka,xa),Qr(ka,"PROVIDER_ID","google.com"),Qr(ka,"GOOGLE_SIGN_IN_METHOD","google.com"),T(Ca,_a),Qr(Ca,"PROVIDER_ID","twitter.com"),Qr(Ca,"TWITTER_SIGN_IN_METHOD","twitter.com"),Ia.prototype.ka=function(e){return this.signInMethod==Ra.EMAIL_LINK_SIGN_IN_METHOD?sl(e,Os,{email:this.a,oobCode:this.f}):sl(e,nl,{email:this.a,password:this.f})},Ia.prototype.b=function(e,t){return this.signInMethod==Ra.EMAIL_LINK_SIGN_IN_METHOD?sl(e,Ds,{idToken:t,email:this.a,oobCode:this.f}):sl(e,Zs,{idToken:t,email:this.a,password:this.f})},Ia.prototype.c=function(e,t){return fa(this.ka(e),t)},Ia.prototype.w=function(){return{email:this.a,password:this.f,signInMethod:this.signInMethod}},$r(Ra,{PROVIDER_ID:"password"}),$r(Ra,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),$r(Ra,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),Da.prototype.ka=function(e){return e.fb(za(this))},Da.prototype.b=function(e,t){var n=za(this);return n.idToken=t,sl(e,il,n)},Da.prototype.c=function(e,t){var n=za(this);return n.operation="REAUTH",fa(e=sl(e,al,n),t)},Da.prototype.w=function(){var e={providerId:"phone"};return this.a.eb&&(e.verificationId=this.a.eb),this.a.cb&&(e.verificationCode=this.a.cb),this.a.La&&(e.temporaryProof=this.a.La),this.a.ea&&(e.phoneNumber=this.a.ea),e},Fa.prototype.fb=function(e,t){var n=this.a.a;return At(t.verify()).then((function(r){if("string"!==typeof r)throw new M("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(t.type){case"recaptcha":var i=v(e)?e.session:null,a=v(e)?e.phoneNumber:e;return(i&&i.type==ua?i.Ha().then((function(e){return function(e,t){return sl(e,Ys,t).then((function(e){return e.phoneSessionInfo.sessionInfo}))}(n,{idToken:e,phoneEnrollmentInfo:{phoneNumber:a,recaptchaToken:r}})})):i&&i.type==ca?i.Ha().then((function(t){return function(e,t){return sl(e,Js,t).then((function(e){return e.phoneResponseInfo.sessionInfo}))}(n,{mfaPendingCredential:t,mfaEnrollmentId:e.multiFactorHint&&e.multiFactorHint.uid||e.multiFactorUid,phoneSignInInfo:{recaptchaToken:r}})})):function(e,t){return sl(e,qs,t)}(n,{phoneNumber:a,recaptchaToken:r})).then((function(e){return"function"===typeof t.reset&&t.reset(),e}),(function(e){throw"function"===typeof t.reset&&t.reset(),e}));default:throw new M("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}}))},$r(Fa,{PROVIDER_ID:"phone"}),$r(Fa,{PHONE_SIGN_IN_METHOD:"phone"}),Va.prototype.getUid=function(){var e=[];return e.push(this.c),this.b&&e.push(this.b),this.f&&e.push(this.f),this.h&&e.push(this.h),e.join("-")},Va.prototype.T=function(){return this.h},Va.prototype.w=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.i,tenantId:this.h,error:this.a&&this.a.w()}};var Wa,qa=null;function Xa(e){var t="unauthorized-domain",n=void 0,r=jn(e);e=r.a,"chrome-extension"==(r=r.c)?n=Ge("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",e):"http"==r||"https"==r?n=Ge("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",e):t="operation-not-supported-in-this-environment",M.call(this,t,n)}function Za(e,t,n){M.call(this,e,n),(e=t||{}).Jb&&Qr(this,"email",e.Jb),e.ea&&Qr(this,"phoneNumber",e.ea),e.credential&&Qr(this,"credential",e.credential),e.Zb&&Qr(this,"tenantId",e.Zb)}function Ka(e){if(e.code){var t=e.code||"";0==t.indexOf(I)&&(t=t.substring(I.length));var n={credential:Ua(e),Zb:e.tenantId};if(e.email)n.Jb=e.email;else if(e.phoneNumber)n.ea=e.phoneNumber;else if(!n.credential)return new M(t,e.message||void 0);return new Za(t,n,e.message)}return null}function Ya(){}function Ja(e){return e.c||(e.c=e.b())}function Qa(){}function $a(e){if(!e.f&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var t=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<t.length;n++){var r=t[n];try{return new ActiveXObject(r),e.f=r}catch(i){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return e.f}function eo(){}function to(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=w(this.qc,this),this.a.onerror=w(this.Sb,this),this.a.onprogress=w(this.rc,this),this.a.ontimeout=w(this.vc,this)}function no(e,t){e.readyState=t,e.onreadystatechange&&e.onreadystatechange()}function ro(e,t,n){this.reset(e,t,n,void 0,void 0)}T(Xa,M),T(Za,M),Za.prototype.w=function(){var e={code:this.code,message:this.message};this.email&&(e.email=this.email),this.phoneNumber&&(e.phoneNumber=this.phoneNumber),this.tenantId&&(e.tenantId=this.tenantId);var t=this.credential&&this.credential.w();return t&&ge(e,t),e},Za.prototype.toJSON=function(){return this.w()},Ya.prototype.c=null,T(Qa,Ya),Qa.prototype.a=function(){var e=$a(this);return e?new ActiveXObject(e):new XMLHttpRequest},Qa.prototype.b=function(){var e={};return $a(this)&&(e[0]=!0,e[1]=!0),e},Wa=new Qa,T(eo,Ya),eo.prototype.a=function(){var e=new XMLHttpRequest;if("withCredentials"in e)return e;if("undefined"!=typeof XDomainRequest)return new to;throw Error("Unsupported browser")},eo.prototype.b=function(){return{}},(n=to.prototype).open=function(e,t,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(e,t)},n.send=function(e){if(e){if("string"!=typeof e)throw Error("Only string data is supported");this.a.send(e)}else this.a.send()},n.abort=function(){this.a.abort()},n.setRequestHeader=function(){},n.getResponseHeader=function(e){return"content-type"==e.toLowerCase()?this.a.contentType:""},n.qc=function(){this.status=200,this.response=this.responseText=this.a.responseText,no(this,4)},n.Sb=function(){this.status=500,this.response=this.responseText="",no(this,4)},n.vc=function(){this.Sb()},n.rc=function(){this.status=200,no(this,1)},n.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},ro.prototype.a=null;function io(e){this.f=e,this.b=this.c=this.a=null}function ao(e,t){this.name=e,this.value=t}ro.prototype.reset=function(e,t,n,r,i){"number"==typeof i||0,r||S(),delete this.a},ao.prototype.toString=function(){return this.name};var oo=new ao("SEVERE",1e3),so=new ao("WARNING",900),lo=new ao("CONFIG",700),uo=new ao("FINE",500);function co(e){return e.c?e.c:e.a?co(e.a):(z("Root logger has no level set."),null)}io.prototype.log=function(e,t,n){if(e.value>=co(this).value)for(m(t)&&(t=t()),e=new ro(e,String(t),this.f),n&&(e.a=n),n=this;n;)n=n.a};var ho,fo={},po=null;function mo(e){var t;if(po||(po=new io(""),fo[""]=po,po.c=lo),!(t=fo[e])){t=new io(e);var n=e.lastIndexOf("."),r=e.substr(n+1);(n=mo(e.substr(0,n))).b||(n.b={}),n.b[r]=t,t.a=n,fo[e]=t}return t}function vo(e,t){e&&e.log(uo,t,void 0)}function yo(e){this.f=e}function go(e){En.call(this),this.u=e,this.h=void 0,this.readyState=_o,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.l=new Headers,this.b=null,this.s="GET",this.f="",this.a=!1,this.i=mo("goog.net.FetchXmlHttp"),this.m=this.c=this.g=null}T(yo,Ya),yo.prototype.a=function(){return new go(this.f)},yo.prototype.b=(ho={},function(){return ho}),T(go,En);var _o=0;function bo(e){e.c.read().then(e.pc.bind(e)).catch(e.Ua.bind(e))}function xo(e){e.readyState=4,e.g=null,e.c=null,e.m=null,wo(e)}function wo(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Eo(e){En.call(this),this.headers=new Pn,this.D=e||null,this.c=!1,this.C=this.a=null,this.h=this.R=this.l="",this.f=this.O=this.i=this.J=!1,this.g=0,this.s=null,this.m=So,this.u=this.S=!1}(n=go.prototype).open=function(e,t){if(this.readyState!=_o)throw this.abort(),Error("Error reopening a connection");this.s=e,this.f=t,this.readyState=1,wo(this)},n.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var t={headers:this.l,method:this.s,credentials:this.h,cache:void 0};e&&(t.body=e),this.u.fetch(new Request(this.f,t)).then(this.uc.bind(this),this.Ua.bind(this))},n.abort=function(){this.response=this.responseText="",this.l=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,xo(this)),this.readyState=_o},n.uc=function(e){this.a&&(this.g=e,this.b||(this.status=this.g.status,this.statusText=this.g.statusText,this.b=e.headers,this.readyState=2,wo(this)),this.a&&(this.readyState=3,wo(this),this.a&&("arraybuffer"===this.responseType?e.arrayBuffer().then(this.sc.bind(this),this.Ua.bind(this)):"undefined"!==typeof l.ReadableStream&&"body"in e?(this.response=this.responseText="",this.c=e.body.getReader(),this.m=new TextDecoder,bo(this)):e.text().then(this.tc.bind(this),this.Ua.bind(this)))))},n.pc=function(e){if(this.a){var t=this.m.decode(e.value?e.value:new Uint8Array(0),{stream:!e.done});t&&(this.response=this.responseText+=t),e.done?xo(this):wo(this),3==this.readyState&&bo(this)}},n.tc=function(e){this.a&&(this.response=this.responseText=e,xo(this))},n.sc=function(e){this.a&&(this.response=e,xo(this))},n.Ua=function(e){var t=this.i;t&&t.log(so,"Failed to fetch url "+this.f,e instanceof Error?e:Error(e)),this.a&&xo(this)},n.setRequestHeader=function(e,t){this.l.append(e,t)},n.getResponseHeader=function(e){return this.b?this.b.get(e.toLowerCase())||"":((e=this.i)&&e.log(so,"Attempting to get response header but no headers have been received for url: "+this.f,void 0),"")},n.getAllResponseHeaders=function(){if(!this.b){var e=this.i;return e&&e.log(so,"Attempting to get all response headers but no headers have been received for url: "+this.f,void 0),""}e=[];for(var t=this.b.entries(),n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(go.prototype,"withCredentials",{get:function(){return"include"===this.h},set:function(e){this.h=e?"include":"same-origin"}}),T(Eo,En);var So="";Eo.prototype.b=mo("goog.net.XhrIo");var To=/^https?$/i,ko=["POST","PUT"];function Mo(e,t,n,r,i){if(e.a)throw Error("[goog.net.XhrIo] Object is active with another request="+e.l+"; newUri="+t);n=n?n.toUpperCase():"GET",e.l=t,e.h="",e.R=n,e.J=!1,e.c=!0,e.a=e.D?e.D.a():Wa.a(),e.C=e.D?Ja(e.D):Ja(Wa),e.a.onreadystatechange=w(e.Vb,e);try{vo(e.b,No(e,"Opening Xhr")),e.O=!0,e.a.open(n,String(t),!0),e.O=!1}catch(o){return vo(e.b,No(e,"Error opening Xhr: "+o.message)),void Ao(e,o)}t=r||"";var a=new Pn(e.headers);i&&function(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(p(e)||"string"===typeof e)W(e,t,void 0);else for(var n=In(e),r=An(e),i=r.length,a=0;a<i;a++)t.call(void 0,r[a],n&&n[a],e)}(i,(function(e,t){a.set(t,e)})),i=function(e){e:{for(var t=Co,n=e.length,r="string"===typeof e?e.split(""):e,i=0;i<n;i++)if(i in r&&t.call(void 0,r[i],i,e)){t=i;break e}t=-1}return 0>t?null:"string"===typeof e?e.charAt(t):e[t]}(a.Y()),r=l.FormData&&t instanceof l.FormData,!K(ko,n)||i||r||a.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),a.forEach((function(e,t){this.a.setRequestHeader(t,e)}),e),e.m&&(e.a.responseType=e.m),"withCredentials"in e.a&&e.a.withCredentials!==e.S&&(e.a.withCredentials=e.S);try{Lo(e),0<e.g&&(e.u=function(e){return Ke&&ot(9)&&"number"===typeof e.timeout&&void 0!==e.ontimeout}(e.a),vo(e.b,No(e,"Will abort after "+e.g+"ms if incomplete, xhr2 "+e.u)),e.u?(e.a.timeout=e.g,e.a.ontimeout=w(e.Ma,e)):e.s=Mn(e.Ma,e.g,e)),vo(e.b,No(e,"Sending request")),e.i=!0,e.a.send(t),e.i=!1}catch(o){vo(e.b,No(e,"Send error: "+o.message)),Ao(e,o)}}function Co(e){return"content-type"==e.toLowerCase()}function Ao(e,t){e.c=!1,e.a&&(e.f=!0,e.a.abort(),e.f=!1),e.h=t,Io(e),Ro(e)}function Io(e){e.J||(e.J=!0,e.dispatchEvent("complete"),e.dispatchEvent("error"))}function Po(e){if(e.c&&"undefined"!=typeof s)if(e.C[1]&&4==Oo(e)&&2==Do(e))vo(e.b,No(e,"Local request error detected and ignored"));else if(e.i&&4==Oo(e))Mn(e.Vb,0,e);else if(e.dispatchEvent("readystatechange"),4==Oo(e)){vo(e.b,No(e,"Request complete")),e.c=!1;try{var t,n=Do(e);e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break e;default:r=!1}if(!(t=r)){var i;if(i=0===n){var a=String(e.l).match(On)[1]||null;if(!a&&l.self&&l.self.location){var o=l.self.location.protocol;a=o.substr(0,o.length-1)}i=!To.test(a?a.toLowerCase():"")}t=i}if(t)e.dispatchEvent("complete"),e.dispatchEvent("success");else{try{var u=2<Oo(e)?e.a.statusText:""}catch(c){vo(e.b,"Can not get status: "+c.message),u=""}e.h=u+" ["+Do(e)+"]",Io(e)}}finally{Ro(e)}}}function Ro(e,t){if(e.a){Lo(e);var n=e.a,r=e.C[0]?f:null;e.a=null,e.C=null,t||e.dispatchEvent("ready");try{n.onreadystatechange=r}catch(i){(e=e.b)&&e.log(oo,"Problem encountered resetting onreadystatechange: "+i.message,void 0)}}}function Lo(e){e.a&&e.u&&(e.a.ontimeout=null),e.s&&(l.clearTimeout(e.s),e.s=null)}function Oo(e){return e.a?e.a.readyState:0}function Do(e){try{return 2<Oo(e)?e.a.status:-1}catch(t){return-1}}function No(e,t){return t+" ["+e.R+" "+e.l+" "+Do(e)+"]"}function zo(e){var t=Zo;this.g=[],this.u=t,this.s=e||null,this.f=this.a=!1,this.c=void 0,this.v=this.C=this.i=!1,this.h=0,this.b=null,this.l=0}function Fo(e,t,n){e.a=!0,e.c=n,e.f=!t,Vo(e)}function Bo(e){if(e.a){if(!e.v)throw new Ho(e);e.v=!1}}function Uo(e,t,n,r){e.g.push([t,n,r]),e.a&&Vo(e)}function jo(e){return Z(e.g,(function(e){return m(e[1])}))}function Vo(e){if(e.h&&e.a&&jo(e)){var t=e.h,n=qo[t];n&&(l.clearTimeout(n.a),delete qo[t]),e.h=0}e.b&&(e.b.l--,delete e.b),t=e.c;for(var r=n=!1;e.g.length&&!e.i;){var i=e.g.shift(),a=i[0],o=i[1];if(i=i[2],a=e.f?o:a)try{var s=a.call(i||e.s,t);void 0!==s&&(e.f=e.f&&(s==t||s instanceof Error),e.c=t=s),(O(t)||"function"===typeof l.Promise&&t instanceof l.Promise)&&(r=!0,e.i=!0)}catch(u){t=u,e.f=!0,jo(e)||(n=!0)}}e.c=t,r&&(s=w(e.m,e,!0),r=w(e.m,e,!1),t instanceof zo?(Uo(t,s,r),t.C=!0):t.then(s,r)),n&&(t=new Wo(t),qo[t.a]=t,e.h=t.a)}function Ho(){D.call(this)}function Go(){D.call(this)}function Wo(e){this.a=l.setTimeout(w(this.c,this),0),this.b=e}(n=Eo.prototype).Ma=function(){"undefined"!=typeof s&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",vo(this.b,No(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},n.abort=function(){this.a&&this.c&&(vo(this.b,No(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Ro(this))},n.Da=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),Ro(this,!0)),Eo.ab.Da.call(this)},n.Vb=function(){this.xa||(this.O||this.i||this.f?Po(this):this.Jc())},n.Jc=function(){Po(this)},n.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case So:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var e=this.b;return e&&e.log(oo,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(t){return vo(this.b,"Can not get response: "+t.message),null}},zo.prototype.cancel=function(e){if(this.a)this.c instanceof zo&&this.c.cancel();else{if(this.b){var t=this.b;delete this.b,e?t.cancel(e):(t.l--,0>=t.l&&t.cancel())}this.u?this.u.call(this.s,this):this.v=!0,this.a||(e=new Go(this),Bo(this),Fo(this,!1,e))}},zo.prototype.m=function(e,t){this.i=!1,Fo(this,e,t)},zo.prototype.then=function(e,t,n){var r,i,a=new wt((function(e,t){r=e,i=t}));return Uo(this,r,(function(e){e instanceof Go?a.cancel():i(e)})),a.then(e,t,n)},zo.prototype.$goog_Thenable=!0,T(Ho,D),Ho.prototype.message="Deferred has already fired",Ho.prototype.name="AlreadyCalledError",T(Go,D),Go.prototype.message="Deferred was canceled",Go.prototype.name="CanceledError",Wo.prototype.c=function(){throw delete qo[this.a],this.b};var qo={};function Xo(e){var t={},n=t.document||document,r=Me(e).toString(),i=vt(document,"SCRIPT"),a={Wb:i,Ma:void 0},o=new zo(a),s=null,u=null!=t.timeout?t.timeout:5e3;return 0<u&&(s=window.setTimeout((function(){Ko(i,!0);var e=new Qo(Jo,"Timeout reached for loading script "+r);Bo(o),Fo(o,!1,e)}),u),a.Ma=s),i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(Ko(i,t.xd||!1,s),Bo(o),Fo(o,!0,null))},i.onerror=function(){Ko(i,!0,s);var e=new Qo(Yo,"Error while loading script "+r);Bo(o),Fo(o,!1,e)},ge(a=t.attributes||{},{type:"text/javascript",charset:"UTF-8"}),ht(i,a),function(e,t){_e(e,"HTMLScriptElement"),e.src=Me(t),(t=e.ownerDocument&&e.ownerDocument.defaultView)&&t!=l?t=h(t.document):(null===c&&(c=h(l.document)),t=c),t&&e.setAttribute("nonce",t)}(i,e),function(e){var t;return(t=(e||document).getElementsByTagName("HEAD"))&&0!=t.length?t[0]:e.documentElement}(n).appendChild(i),o}function Zo(){if(this&&this.Wb){var e=this.Wb;e&&"SCRIPT"==e.tagName&&Ko(e,!0,this.Ma)}}function Ko(e,t,n){null!=n&&l.clearTimeout(n),e.onload=f,e.onerror=f,e.onreadystatechange=f,t&&window.setTimeout((function(){e&&e.parentNode&&e.parentNode.removeChild(e)}),0)}var Yo=0,Jo=1;function Qo(e,t){var n="Jsloader error (code #"+e+")";t&&(n+=": "+t),D.call(this,n),this.code=e}function $o(e){this.f=e}function es(e,n,r){if(this.c=e,e=n||{},this.l=e.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.m=e.secureTokenTimeout||rs,this.g=ve(e.secureTokenHeaders||is),this.h=e.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.i=e.identityPlatformEndpoint||"https://identitytoolkit.googleapis.com/v2/",this.v=e.firebaseTimeout||as,this.a=ve(e.firebaseHeaders||os),r&&(this.a["X-Client-Version"]=r,this.g["X-Client-Version"]=r),r="Node"==Sr(),!(r=l.XMLHttpRequest||r&&t.a.INTERNAL.node&&t.a.INTERNAL.node.XMLHttpRequest)&&!Er())throw new M("internal-error","The XMLHttpRequest compatibility library was not found.");this.f=void 0,Er()?this.f=new yo(self):Tr()?this.f=new $o(r):this.f=new eo,this.b=null}T(Qo,D),T($o,Ya),$o.prototype.a=function(){return new this.f},$o.prototype.b=function(){return{}};var ts,ns="idToken",rs=new Gr(3e4,6e4),is={"Content-Type":"application/x-www-form-urlencoded"},as=new Gr(3e4,6e4),os={"Content-Type":"application/json"};function ss(e,t){t?e.a["X-Firebase-Locale"]=t:delete e.a["X-Firebase-Locale"]}function ls(e,t){t&&(e.l=us("https://securetoken.googleapis.com/v1/token",t),e.h=us("https://www.googleapis.com/identitytoolkit/v3/relyingparty/",t),e.i=us("https://identitytoolkit.googleapis.com/v2/",t))}function us(e,t){return e=jn(e),t=jn(t.url),e.f=e.a+e.f,Nn(e,t.c),e.a=t.a,zn(e,t.g),e.toString()}function cs(e,t){t?(e.a["X-Client-Version"]=t,e.g["X-Client-Version"]=t):(delete e.a["X-Client-Version"],delete e.g["X-Client-Version"])}function hs(e,t,n,r,i,a,o){(function(){var e=Pr();return!((e=Cr(e)!=Mr?null:(e=e.match(/\sChrome\/(\d+)/i))&&2==e.length?parseInt(e[1],10):null)&&30>e)&&(!Ke||!lt||9<lt)})()||Er()?e=w(e.u,e):(ts||(ts=new wt((function(e,t){!function(e,t){if(((window.gapi||{}).client||{}).request)e();else{l[ds]=function(){((window.gapi||{}).client||{}).request?e():t(Error("CORS_UNSUPPORTED"))},function(e,t){Uo(e,null,t,void 0)}(Xo(Ce(fs,{onload:ds})),(function(){t(Error("CORS_UNSUPPORTED"))}))}}(e,t)}))),e=w(e.s,e)),e(t,n,r,i,a,o)}es.prototype.T=function(){return this.b},es.prototype.u=function(e,t,n,r,i,a){if(Er()&&("undefined"===typeof l.fetch||"undefined"===typeof l.Headers||"undefined"===typeof l.Request))throw new M("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var o=new Eo(this.f);if(a){o.g=Math.max(0,a);var s=setTimeout((function(){o.dispatchEvent("timeout")}),a)}Sn(o,"complete",(function(){s&&clearTimeout(s);var e=null;try{e=JSON.parse(function(e){try{return e.a?e.a.responseText:""}catch(t){return vo(e.b,"Can not get responseText: "+t.message),""}}(this))||null}catch(n){e=null}t&&t(e)})),Tn(o,"ready",(function(){s&&clearTimeout(s),Xt(this)})),Tn(o,"timeout",(function(){s&&clearTimeout(s),Xt(this),t&&t(null)})),Mo(o,e,n,r,i)};var fs=new be(Se,"https://apis.google.com/js/client.js?onload=%{onload}"),ds="__fcb"+Math.floor(1e6*Math.random()).toString();function ps(e,t,n,r,i,a,o){var s=jn(t+n);Bn(s,"key",e.c),o&&Bn(s,"cb",S().toString());var l="GET"==r;if(l)for(var u in i)i.hasOwnProperty(u)&&Bn(s,u,i[u]);return new wt((function(t,n){hs(e,s.toString(),(function(e){e?e.error?n(ul(e,a||{})):t(e):n(new M("network-request-failed"))}),r,l?void 0:ar(Br(i)),e.a,e.v.get())}))}function ms(e){if("string"!==typeof(e=e.email)||!_r.test(e))throw new M("invalid-email")}function vs(e){"email"in e&&ms(e)}function ys(e){if(!e[ns]){if(e.mfaPendingCredential)throw new M("multi-factor-auth-required",null,ve(e));throw new M("internal-error")}}function gs(e){if(e.phoneNumber||e.temporaryProof){if(!e.phoneNumber||!e.temporaryProof)throw new M("internal-error")}else{if(!e.sessionInfo)throw new M("missing-verification-id");if(!e.code)throw new M("missing-verification-code")}}es.prototype.s=function(e,t,n,r,i){var a=this;ts.then((function(){window.gapi.client.setApiKey(a.c);var o=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:e,method:n,body:r,headers:i,authType:"none",callback:function(e){window.gapi.auth.setToken(o),t&&t(e)}})})).o((function(e){t&&t({error:{message:e&&e.message||"CORS_UNSUPPORTED"}})}))},es.prototype.zb=function(){return sl(this,Ks,{})},es.prototype.Bb=function(e,t){return sl(this,Xs,{idToken:e,email:t})},es.prototype.Cb=function(e,t){return sl(this,Zs,{idToken:e,password:t})};var _s={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function bs(e){if(!e.phoneVerificationInfo)throw new M("internal-error");if(!e.phoneVerificationInfo.sessionInfo)throw new M("missing-verification-id");if(!e.phoneVerificationInfo.code)throw new M("missing-verification-code")}function xs(e){if(!e.requestUri||!e.sessionId&&!e.postBody&&!e.pendingToken)throw new M("internal-error")}function ws(e,t){return t.oauthIdToken&&t.providerId&&0==t.providerId.indexOf("oidc.")&&!t.pendingToken&&(e.sessionId?t.nonce=e.sessionId:e.postBody&&(tr(e=new Jn(e.postBody),"nonce")&&(t.nonce=e.get("nonce")))),t}function Es(e){var t=null;if(e.needConfirmation?(e.code="account-exists-with-different-credential",t=Ka(e)):"FEDERATED_USER_ID_ALREADY_LINKED"==e.errorMessage?(e.code="credential-already-in-use",t=Ka(e)):"EMAIL_EXISTS"==e.errorMessage?(e.code="email-already-in-use",t=Ka(e)):e.errorMessage&&(t=ll(e.errorMessage)),t)throw t;ys(e)}function Ss(e,t){return t.returnIdpCredential=!0,sl(e,Qs,t)}function Ts(e,t){return t.returnIdpCredential=!0,sl(e,el,t)}function ks(e,t){return t.returnIdpCredential=!0,t.autoCreate=!1,sl(e,$s,t)}function Ms(e){if(!e.oobCode)throw new M("invalid-action-code")}(n=es.prototype).Db=function(e,t){var n={idToken:e},r=[];return pe(_s,(function(e,i){var a=t[i];null===a?r.push(e):i in t&&(n[i]=a)})),r.length&&(n.deleteAttribute=r),sl(this,Xs,n)},n.vb=function(e,t){return ge(e={requestType:"PASSWORD_RESET",email:e},t),sl(this,Vs,e)},n.wb=function(e,t){return ge(e={requestType:"EMAIL_SIGNIN",email:e},t),sl(this,Bs,e)},n.ub=function(e,t){return ge(e={requestType:"VERIFY_EMAIL",idToken:e},t),sl(this,Us,e)},n.Eb=function(e,t,n){return ge(e={requestType:"VERIFY_AND_CHANGE_EMAIL",idToken:e,newEmail:t},n),sl(this,js,e)},n.fb=function(e){return sl(this,rl,e)},n.nb=function(e,t){return sl(this,Ws,{oobCode:e,newPassword:t})},n.Ra=function(e){return sl(this,As,{oobCode:e})},n.jb=function(e){return sl(this,Cs,{oobCode:e})};var Cs={endpoint:"setAccountInfo",A:Ms,Z:"email",B:!0},As={endpoint:"resetPassword",A:Ms,G:function(e){var t=e.requestType;if(!t||!e.email&&"EMAIL_SIGNIN"!=t&&"VERIFY_AND_CHANGE_EMAIL"!=t)throw new M("internal-error")},B:!0},Is={endpoint:"signupNewUser",A:function(e){if(ms(e),!e.password)throw new M("weak-password")},G:ys,V:!0,B:!0},Ps={endpoint:"createAuthUri",B:!0},Rs={endpoint:"deleteAccount",N:["idToken"]},Ls={endpoint:"setAccountInfo",N:["idToken","deleteProvider"],A:function(e){if(!Array.isArray(e.deleteProvider))throw new M("internal-error")}},Os={endpoint:"emailLinkSignin",N:["email","oobCode"],A:ms,G:ys,V:!0,B:!0},Ds={endpoint:"emailLinkSignin",N:["idToken","email","oobCode"],A:ms,G:ys,V:!0},Ns={endpoint:"accounts/mfaEnrollment:finalize",N:["idToken","phoneVerificationInfo"],A:bs,G:ys,B:!0,Na:!0},zs={endpoint:"accounts/mfaSignIn:finalize",N:["mfaPendingCredential","phoneVerificationInfo"],A:bs,G:ys,B:!0,Na:!0},Fs={endpoint:"getAccountInfo"},Bs={endpoint:"getOobConfirmationCode",N:["requestType"],A:function(e){if("EMAIL_SIGNIN"!=e.requestType)throw new M("internal-error");ms(e)},Z:"email",B:!0},Us={endpoint:"getOobConfirmationCode",N:["idToken","requestType"],A:function(e){if("VERIFY_EMAIL"!=e.requestType)throw new M("internal-error")},Z:"email",B:!0},js={endpoint:"getOobConfirmationCode",N:["idToken","newEmail","requestType"],A:function(e){if("VERIFY_AND_CHANGE_EMAIL"!=e.requestType)throw new M("internal-error")},Z:"email",B:!0},Vs={endpoint:"getOobConfirmationCode",N:["requestType"],A:function(e){if("PASSWORD_RESET"!=e.requestType)throw new M("internal-error");ms(e)},Z:"email",B:!0},Hs={lb:!0,endpoint:"getProjectConfig",Ub:"GET"},Gs={lb:!0,endpoint:"getRecaptchaParam",Ub:"GET",G:function(e){if(!e.recaptchaSiteKey)throw new M("internal-error")}},Ws={endpoint:"resetPassword",A:Ms,Z:"email",B:!0},qs={endpoint:"sendVerificationCode",N:["phoneNumber","recaptchaToken"],Z:"sessionInfo",B:!0},Xs={endpoint:"setAccountInfo",N:["idToken"],A:vs,V:!0},Zs={endpoint:"setAccountInfo",N:["idToken"],A:function(e){if(vs(e),!e.password)throw new M("weak-password")},G:ys,V:!0},Ks={endpoint:"signupNewUser",G:ys,V:!0,B:!0},Ys={endpoint:"accounts/mfaEnrollment:start",N:["idToken","phoneEnrollmentInfo"],A:function(e){if(!e.phoneEnrollmentInfo)throw new M("internal-error");if(!e.phoneEnrollmentInfo.phoneNumber)throw new M("missing-phone-number");if(!e.phoneEnrollmentInfo.recaptchaToken)throw new M("missing-app-credential")},G:function(e){if(!e.phoneSessionInfo||!e.phoneSessionInfo.sessionInfo)throw new M("internal-error")},B:!0,Na:!0},Js={endpoint:"accounts/mfaSignIn:start",N:["mfaPendingCredential","mfaEnrollmentId","phoneSignInInfo"],A:function(e){if(!e.phoneSignInInfo||!e.phoneSignInInfo.recaptchaToken)throw new M("missing-app-credential")},G:function(e){if(!e.phoneResponseInfo||!e.phoneResponseInfo.sessionInfo)throw new M("internal-error")},B:!0,Na:!0},Qs={endpoint:"verifyAssertion",A:xs,Ya:ws,G:Es,V:!0,B:!0},$s={endpoint:"verifyAssertion",A:xs,Ya:ws,G:function(e){if(e.errorMessage&&"USER_NOT_FOUND"==e.errorMessage)throw new M("user-not-found");if(e.errorMessage)throw ll(e.errorMessage);ys(e)},V:!0,B:!0},el={endpoint:"verifyAssertion",A:function(e){if(xs(e),!e.idToken)throw new M("internal-error")},Ya:ws,G:Es,V:!0},tl={endpoint:"verifyCustomToken",A:function(e){if(!e.token)throw new M("invalid-custom-token")},G:ys,V:!0,B:!0},nl={endpoint:"verifyPassword",A:function(e){if(ms(e),!e.password)throw new M("wrong-password")},G:ys,V:!0,B:!0},rl={endpoint:"verifyPhoneNumber",A:gs,G:ys,B:!0},il={endpoint:"verifyPhoneNumber",A:function(e){if(!e.idToken)throw new M("internal-error");gs(e)},G:function(e){if(e.temporaryProof)throw e.code="credential-already-in-use",Ka(e);ys(e)}},al={Hb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",A:gs,G:ys,B:!0},ol={endpoint:"accounts/mfaEnrollment:withdraw",N:["idToken","mfaEnrollmentId"],G:function(e){if(!!e[ns]^!!e.refreshToken)throw new M("internal-error")},B:!0,Na:!0};function sl(e,t,n){if(!function(e,t){if(!t||!t.length)return!0;if(!e)return!1;for(var n=0;n<t.length;n++){var r=e[t[n]];if(void 0===r||null===r||""===r)return!1}return!0}(n,t.N))return It(new M("internal-error"));var r,i=!!t.Na,a=t.Ub||"POST";return At(n).then(t.A).then((function(){return t.V&&(n.returnSecureToken=!0),t.B&&e.b&&"undefined"===typeof n.tenantId&&(n.tenantId=e.b),ps(e,i?e.i:e.h,t.endpoint,a,n,t.Hb,t.lb||!1)})).then((function(e){return r=e,t.Ya?t.Ya(n,r):r})).then(t.G).then((function(){if(!t.Z)return r;if(!(t.Z in r))throw new M("internal-error");return r[t.Z]}))}function ll(e){return ul({error:{errors:[{message:e}],code:400,message:e}})}function ul(e,t){var n=(e.error&&e.error.errors&&e.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new M(r[n]):null)return n;for(var i in n=e.error&&e.error.message||"",ge(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",UNSUPPORTED_TENANT_OPERATION:"unsupported-tenant-operation",INVALID_TENANT_ID:"invalid-tenant-id",TENANT_ID_MISMATCH:"tenant-id-mismatch",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",EMAIL_CHANGE_NEEDS_VERIFICATION:"email-change-needs-verification",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",UNSUPPORTED_FIRST_FACTOR:"unsupported-first-factor",UNVERIFIED_EMAIL:"unverified-email"},t||{}),t=(t=n.match(/^[^\s]+\s*:\s*([\s\S]*)$/))&&1<t.length?t[1]:void 0,r)if(0===n.indexOf(i))return new M(r[i],t);return!t&&e&&(t=Fr(e)),new M("internal-error",t)}function cl(e){this.b=e,this.a=null,this.rb=function(e){return(pl||(pl=new wt((function(e,t){function n(){Hr(),Rr("gapi.load")("gapi.iframes",{callback:e,ontimeout:function(){Hr(),t(Error("Network Error"))},timeout:fl.get()})}if(Rr("gapi.iframes.Iframe"))e();else if(Rr("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();l[r]=function(){Rr("gapi.load")?n():t(Error("Network Error"))},At(Xo(r=Ce(hl,{onload:r}))).o((function(){t(Error("Network Error"))}))}})).o((function(e){throw pl=null,e})))).then((function(){return new wt((function(t,n){Rr("gapi.iframes.getContext")().open({where:document.body,url:e.b,messageHandlersFilter:Rr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},(function(r){function i(){clearTimeout(a),t()}e.a=r,e.a.restyle({setHideOnLeave:!1});var a=setTimeout((function(){n(Error("Network Error"))}),dl.get());r.ping(i).then(i,(function(){n(Error("Network Error"))}))}))}))}))}(this)}var hl=new be(Se,"https://apis.google.com/js/api.js?onload=%{onload}"),fl=new Gr(3e4,6e4),dl=new Gr(5e3,15e3),pl=null;function ml(e,t,n,r){this.l=e,this.h=t,this.i=n,this.g=r,this.f=null,this.g?e=Vn((e=jn(this.g.url)).c,e.a,e.g,"/emulator/auth/iframe"):e=Vn("https",this.l,null,"/__/auth/iframe"),this.a=e,Bn(this.a,"apiKey",this.h),Bn(this.a,"appName",this.i),this.b=null,this.c=[]}function vl(e,t,n,r,i,a){this.u=e,this.s=t,this.c=n,this.m=r,this.v=a,this.i=this.g=this.l=null,this.a=i,this.h=this.f=null}function yl(e){try{return t.a.app(e).auth().Ga()}catch(n){return[]}}function gl(e,t,n,r,i,a){this.s=e,this.g=t,this.b=n,this.f=a,this.c=r||null,this.i=i||null,this.l=this.u=this.C=null,this.h=[],this.m=this.a=null}function _l(e){var t=fr();return function(e){return sl(e,Hs,{}).then((function(e){return e.authorizedDomains||[]}))}(e).then((function(e){e:{var n=jn(t),r=n.c;n=n.a;for(var i=0;i<e.length;i++){var a=e[i],o=n,s=r;if(0==a.indexOf("chrome-extension://")?o=jn(a).a==o&&"chrome-extension"==s:"http"!=s&&"https"!=s?o=!1:gr.test(a)?o=o==a:(a=a.split(".").join("\\."),o=new RegExp("^(.+\\."+a+"|"+a+")$","i").test(o)),o){e=!0;break e}}e=!1}if(!e)throw new Xa(fr())}))}function bl(e){return e.m||(e.m=br().then((function(){if(!e.u){var t=e.c,n=e.i,r=yl(e.b),i=new ml(e.s,e.g,e.b,e.f);i.f=t,i.b=n,i.c=$(r||[]),e.u=i.toString()}e.v=new cl(e.u),function(e){if(!e.v)throw Error("IfcHandler must be initialized!");!function(e,t){e.rb.then((function(){e.a.register("authEvent",t,Rr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))}))}(e.v,(function(t){var n={};if(t&&t.authEvent){var r=!1;for(t=Ha(t.authEvent),n=0;n<e.h.length;n++)r=e.h[n](t)||r;return(n={}).status=r?"ACK":"ERROR",At(n)}return n.status="ERROR",At(n)}))}(e)}))),e.m}function xl(e){return e.l||(e.C=e.c?Ir(e.c,yl(e.b)):null,e.l=new es(e.g,L(e.i),e.C),e.f&&ls(e.l,e.f)),e.l}function wl(e,t,n,r,i,a,o,s,l,u,c,h){return(e=new vl(e,t,n,r,i,h)).l=a,e.g=o,e.i=s,e.b=ve(l||null),e.f=u,e.yb(c).toString()}function El(e){if(this.a=e||t.a.INTERNAL.reactNative&&t.a.INTERNAL.reactNative.AsyncStorage,!this.a)throw new M("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Sl(e){this.b=e,this.a={},this.f=w(this.c,this)}ml.prototype.toString=function(){return this.f?Bn(this.a,"v",this.f):er(this.a.b,"v"),this.b?Bn(this.a,"eid",this.b):er(this.a.b,"eid"),this.c.length?Bn(this.a,"fw",this.c.join(",")):er(this.a.b,"fw"),this.a.toString()},vl.prototype.yb=function(e){return this.h=e,this},vl.prototype.toString=function(){if(this.v){var e=jn(this.v.url);e=Vn(e.c,e.a,e.g,"/emulator/auth/handler")}else e=Vn("https",this.u,null,"/__/auth/handler");if(Bn(e,"apiKey",this.s),Bn(e,"appName",this.c),Bn(e,"authType",this.m),this.a.isOAuthProvider){var n=this.a;try{var r=t.a.app(this.c).auth().la()}catch(l){r=null}for(var i in n.ob=r,Bn(e,"providerId",this.a.providerId),n=Br((r=this.a).Ib))n[i]=n[i].toString();i=r.Qc,n=ve(n);for(var a=0;a<i.length;a++){var o=i[a];o in n&&delete n[o]}r.pb&&r.ob&&!n[r.pb]&&(n[r.pb]=r.ob),me(n)||Bn(e,"customParameters",Fr(n))}if("function"===typeof this.a.Qb&&((r=this.a.Qb()).length&&Bn(e,"scopes",r.join(","))),this.l?Bn(e,"redirectUrl",this.l):er(e.b,"redirectUrl"),this.g?Bn(e,"eventId",this.g):er(e.b,"eventId"),this.i?Bn(e,"v",this.i):er(e.b,"v"),this.b)for(var s in this.b)this.b.hasOwnProperty(s)&&!Un(e,s)&&Bn(e,s,this.b[s]);return this.h?Bn(e,"tid",this.h):er(e.b,"tid"),this.f?Bn(e,"eid",this.f):er(e.b,"eid"),(s=yl(this.c)).length&&Bn(e,"fw",s.join(",")),e.toString()},(n=gl.prototype).Ob=function(e,t,n){var r=new M("popup-closed-by-user"),i=new M("web-storage-unsupported"),a=this,o=!1;return this.ma().then((function(){(function(e){var t={type:"webStorageSupport"};return bl(e).then((function(){return function(e,t){return e.rb.then((function(){return new wt((function(n){e.a.send(t.type,t,n,Rr("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))}))}))}(e.v,t)})).then((function(e){if(e&&e.length&&"undefined"!==typeof e[0].webStorageSupport)return e[0].webStorageSupport;throw Error()}))})(a).then((function(n){n||(e&&vr(e),t(i),o=!0)}))})).o((function(){})).then((function(){if(!o)return function(e){return new wt((function(t){return function n(){Cn(2e3).then((function(){if(e&&!e.closed)return n();t()}))}()}))}(e)})).then((function(){if(!o)return Cn(n).then((function(){t(r)}))}))},n.Xb=function(){var e=Pr();return!zr(e)&&!Vr(e)},n.Tb=function(){return!1},n.Mb=function(e,t,n,r,i,a,o,s){if(!e)return It(new M("popup-blocked"));if(o&&!zr())return this.ma().o((function(t){vr(e),i(t)})),r(),At();this.a||(this.a=_l(xl(this)));var l=this;return this.a.then((function(){var t=l.ma().o((function(t){throw vr(e),i(t),t}));return r(),t})).then((function(){(ja(n),o)||dr(wl(l.s,l.g,l.b,t,n,null,a,l.c,void 0,l.i,s,l.f),e)})).o((function(e){throw"auth/network-request-failed"==e.code&&(l.a=null),e}))},n.Nb=function(e,t,n,r){this.a||(this.a=_l(xl(this)));var i=this;return this.a.then((function(){ja(t),dr(wl(i.s,i.g,i.b,e,t,fr(),n,i.c,void 0,i.i,r,i.f))})).o((function(e){throw"auth/network-request-failed"==e.code&&(i.a=null),e}))},n.ma=function(){var e=this;return bl(this).then((function(){return e.v.rb})).o((function(){throw e.a=null,new M("network-request-failed")}))},n.$b=function(){return!0},n.Ea=function(e){this.h.push(e)},n.Sa=function(e){J(this.h,(function(t){return t==e}))},(n=El.prototype).get=function(e){return At(this.a.getItem(e)).then((function(e){return e&&Ur(e)}))},n.set=function(e,t){return At(this.a.setItem(e,Fr(t)))},n.U=function(e){return At(this.a.removeItem(e))},n.ca=function(){},n.ia=function(){};var Tl,kl=[];function Ml(e,t,n){me(e.a)&&e.b.addEventListener("message",e.f),"undefined"===typeof e.a[t]&&(e.a[t]=[]),e.a[t].push(n)}function Cl(e){this.a=e}function Al(e){this.c=e,this.b=!1,this.a=[]}function Il(e,t,n,r){var i,a,o,s,l=n||{},u=null;if(e.b)return It(Error("connection_unavailable"));var c=r?800:50,h="undefined"!==typeof MessageChannel?new MessageChannel:null;return new wt((function(n,r){h?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),h.port1.start(),o=setTimeout((function(){r(Error("unsupported_event"))}),c),u={messageChannel:h,onMessage:a=function(e){e.data.eventId===i&&("ack"===e.data.status?(clearTimeout(o),s=setTimeout((function(){r(Error("timeout"))}),3e3)):"done"===e.data.status?(clearTimeout(s),"undefined"!==typeof e.data.response?n(e.data.response):r(Error("unknown_error"))):(clearTimeout(o),clearTimeout(s),r(Error("invalid_response"))))}},e.a.push(u),h.port1.addEventListener("message",a),e.c.postMessage({eventType:t,eventId:i,data:l},[h.port2])):r(Error("connection_unavailable"))})).then((function(t){return Pl(e,u),t})).o((function(t){throw Pl(e,u),t}))}function Pl(e,t){if(t){var n=t.messageChannel,r=t.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),J(e.a,(function(e){return e==t}))}}function Rl(){if(!Nl())throw new M("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.m=l.indexedDB,this.type="indexedDB",this.g=this.v=this.f=this.l=null,this.s=!1,this.h=null;var e=this;Er()&&self?(this.v=function(){var e=Er()?self:null;if(W(kl,(function(n){n.b==e&&(t=n)})),!t){var t=new Sl(e);kl.push(t)}return t}(),Ml(this.v,"keyChanged",(function(t,n){return jl(e).then((function(t){return 0<t.length&&W(e.a,(function(e){e(t)})),{keyProcessed:K(t,n.key)}}))})),Ml(this.v,"ping",(function(){return At(["keyChanged"])}))):function(){var e=l.navigator;return e&&e.serviceWorker?At().then((function(){return e.serviceWorker.ready})).then((function(e){return e.active||null})).o((function(){return null})):At(null)}().then((function(t){(e.h=t)&&(e.g=new Al(new Cl(t)),Il(e.g,"ping",null,!0).then((function(t){t[0].fulfilled&&K(t[0].value,"keyChanged")&&(e.s=!0)})).o((function(){})))}))}function Ll(e){return new wt((function(t,n){var r=e.m.open("firebaseLocalStorageDb",1);r.onerror=function(e){try{e.preventDefault()}catch(t){}n(Error(e.target.error))},r.onupgradeneeded=function(e){e=e.target.result;try{e.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},r.onsuccess=function(r){(r=r.target.result).objectStoreNames.contains("firebaseLocalStorage")?t(r):function(e){return new wt((function(t,n){var r=e.m.deleteDatabase("firebaseLocalStorageDb");r.onsuccess=function(){t()},r.onerror=function(e){n(Error(e.target.error))}}))}(e).then((function(){return Ll(e)})).then((function(e){t(e)})).o((function(e){n(e)}))}}))}function Ol(e){return e.i||(e.i=Ll(e)),e.i}function Dl(e,t){var n=0;return new wt((function r(i,a){Ol(e).then(t).then(i).o((function(t){if(!(3<++n))return Ol(e).then((function(t){return t.close(),e.i=void 0,r(i,a)})).o((function(e){a(e)}));a(t)}))}))}function Nl(){try{return!!l.indexedDB}catch(ho){return!1}}function zl(e){return e.objectStore("firebaseLocalStorage")}function Fl(e,t){return e.transaction(["firebaseLocalStorage"],t?"readwrite":"readonly")}function Bl(e){return new wt((function(t,n){e.onsuccess=function(e){e&&e.target?t(e.target.result):t()},e.onerror=function(e){n(e.target.error)}}))}function Ul(e,t){return e.g&&e.h&&function(){var e=l.navigator;return e&&e.serviceWorker&&e.serviceWorker.controller||null}()===e.h?Il(e.g,"keyChanged",{key:t},e.s).then((function(){})).o((function(){})):At()}function jl(e){return Ol(e).then((function(e){var t=zl(Fl(e,!1));return t.getAll?Bl(t.getAll()):new wt((function(e,n){var r=[],i=t.openCursor();i.onsuccess=function(t){(t=t.target.result)?(r.push(t.value),t.continue()):e(r)},i.onerror=function(e){n(e.target.error)}}))})).then((function(t){var n={},r=[];if(0==e.b){for(r=0;r<t.length;r++)n[t[r].fbase_key]=t[r].value;r=pr(e.c,n),e.c=n}return r}))}function Vl(e){e.l&&e.l.cancel("STOP_EVENT"),e.f&&(clearTimeout(e.f),e.f=null)}function Hl(e){var t=this,n=null;this.a=[],this.type="indexedDB",this.c=e,this.b=At().then((function(){if(Nl()){var e=jr(),r="__sak"+e;return Tl||(Tl=new Rl),(n=Tl).set(r,e).then((function(){return n.get(r)})).then((function(t){if(t!==e)throw Error("indexedDB not supported!");return n.U(r)})).then((function(){return n})).o((function(){return t.c}))}return t.c})).then((function(e){return t.type=e.type,e.ca((function(e){W(t.a,(function(t){t(e)}))})),e}))}function Gl(){this.a={},this.type="inMemory"}function Wl(){if(!function(){var e="Node"==Sr();if(!(e=ql()||e&&t.a.INTERNAL.node&&t.a.INTERNAL.node.localStorage))return!1;try{return e.setItem("__sak","1"),e.removeItem("__sak"),!0}catch(n){return!1}}()){if("Node"==Sr())throw new M("internal-error","The LocalStorage compatibility library was not found.");throw new M("web-storage-unsupported")}this.a=ql()||t.a.INTERNAL.node.localStorage,this.type="localStorage"}function ql(){try{var e=l.localStorage,t=jr();return e&&(e.setItem(t,"1"),e.removeItem(t)),e}catch(n){return null}}function Xl(){this.type="nullStorage"}function Zl(){if(!function(){var e="Node"==Sr();if(!(e=Kl()||e&&t.a.INTERNAL.node&&t.a.INTERNAL.node.sessionStorage))return!1;try{return e.setItem("__sak","1"),e.removeItem("__sak"),!0}catch(n){return!1}}()){if("Node"==Sr())throw new M("internal-error","The SessionStorage compatibility library was not found.");throw new M("web-storage-unsupported")}this.a=Kl()||t.a.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function Kl(){try{var e=l.sessionStorage,t=jr();return e&&(e.setItem(t,"1"),e.removeItem(t)),e}catch(n){return null}}function Yl(){var e={};e.Browser=$l,e.Node=eu,e.ReactNative=tu,e.Worker=nu,this.a=e[Sr()]}Sl.prototype.c=function(e){var t=e.data.eventType,n=e.data.eventId,r=this.a[t];if(r&&0<r.length){e.ports[0].postMessage({status:"ack",eventId:n,eventType:t,response:null});var i=[];W(r,(function(t){i.push(At().then((function(){return t(e.origin,e.data.data)})))})),Rt(i).then((function(r){var i=[];W(r,(function(e){i.push({fulfilled:e.Pb,value:e.value,reason:e.reason?e.reason.message:void 0})})),W(i,(function(e){for(var t in e)"undefined"===typeof e[t]&&delete e[t]})),e.ports[0].postMessage({status:"done",eventId:n,eventType:t,response:i})}))}},Cl.prototype.postMessage=function(e,t){this.a.postMessage(e,t)},Al.prototype.close=function(){for(;0<this.a.length;)Pl(this,this.a[0]);this.b=!0},(n=Rl.prototype).set=function(e,t){var n=this,r=!1;return Dl(this,(function(t){return Bl((t=zl(Fl(t,!0))).get(e))})).then((function(i){return Dl(n,(function(a){if(a=zl(Fl(a,!0)),i)return i.value=t,Bl(a.put(i));n.b++,r=!0;var o={};return o.fbase_key=e,o.value=t,Bl(a.add(o))}))})).then((function(){return n.c[e]=t,Ul(n,e)})).oa((function(){r&&n.b--}))},n.get=function(e){return Dl(this,(function(t){return Bl(zl(Fl(t,!1)).get(e))})).then((function(e){return e&&e.value}))},n.U=function(e){var t=this,n=!1;return Dl(this,(function(r){return n=!0,t.b++,Bl(zl(Fl(r,!0)).delete(e))})).then((function(){return delete t.c[e],Ul(t,e)})).oa((function(){n&&t.b--}))},n.ca=function(e){0==this.a.length&&function(e){function t(){e.f=setTimeout((function(){e.l=jl(e).then((function(t){0<t.length&&W(e.a,(function(e){e(t)}))})).then((function(){t()})).o((function(e){"STOP_EVENT"!=e.message&&t()}))}),800)}Vl(e),t()}(this),this.a.push(e)},n.ia=function(e){J(this.a,(function(t){return t==e})),0==this.a.length&&Vl(this)},(n=Hl.prototype).get=function(e){return this.b.then((function(t){return t.get(e)}))},n.set=function(e,t){return this.b.then((function(n){return n.set(e,t)}))},n.U=function(e){return this.b.then((function(t){return t.U(e)}))},n.ca=function(e){this.a.push(e)},n.ia=function(e){J(this.a,(function(t){return t==e}))},(n=Gl.prototype).get=function(e){return At(this.a[e])},n.set=function(e,t){return this.a[e]=t,At()},n.U=function(e){return delete this.a[e],At()},n.ca=function(){},n.ia=function(){},(n=Wl.prototype).get=function(e){var t=this;return At().then((function(){return Ur(t.a.getItem(e))}))},n.set=function(e,t){var n=this;return At().then((function(){var r=Fr(t);null===r?n.U(e):n.a.setItem(e,r)}))},n.U=function(e){var t=this;return At().then((function(){t.a.removeItem(e)}))},n.ca=function(e){l.window&&hn(l.window,"storage",e)},n.ia=function(e){l.window&&pn(l.window,"storage",e)},(n=Xl.prototype).get=function(){return At(null)},n.set=function(){return At()},n.U=function(){return At()},n.ca=function(){},n.ia=function(){},(n=Zl.prototype).get=function(e){var t=this;return At().then((function(){return Ur(t.a.getItem(e))}))},n.set=function(e,t){var n=this;return At().then((function(){var r=Fr(t);null===r?n.U(e):n.a.setItem(e,r)}))},n.U=function(e){var t=this;return At().then((function(){t.a.removeItem(e)}))},n.ca=function(){},n.ia=function(){};var Jl,Ql,$l={F:Wl,bb:Zl},eu={F:Wl,bb:Zl},tu={F:El,bb:Xl},nu={F:Wl,bb:Xl},ru={rd:"local",NONE:"none",td:"session"};function iu(){var e=!(Vr(Pr())||!wr()),t=zr(),n=Lr();this.m=e,this.h=t,this.l=n,this.a={},Jl||(Jl=new Yl),e=Jl;try{this.g=!hr()&&Xr()||!l.indexedDB?new e.a.F:new Hl(Er()?new Gl:new e.a.F)}catch(r){this.g=new Gl,this.h=!0}try{this.i=new e.a.bb}catch(r){this.i=new Gl}this.v=new Gl,this.f=w(this.Yb,this),this.b={}}function au(){return Ql||(Ql=new iu),Ql}function ou(e,t){switch(t){case"session":return e.i;case"none":return e.v;default:return e.g}}function su(e,t){return"firebase:"+e.name+(t?":"+t:"")}function lu(e,t,n){return n=su(t,n),"local"==t.F&&(e.b[n]=null),ou(e,t.F).U(n)}function uu(e){e.c&&(clearInterval(e.c),e.c=null)}function cu(e){this.a=e,this.b=au()}(n=iu.prototype).get=function(e,t){return ou(this,e.F).get(su(e,t))},n.set=function(e,t,n){var r=su(e,n),i=this,a=ou(this,e.F);return a.set(r,t).then((function(){return a.get(r)})).then((function(t){"local"==e.F&&(i.b[r]=t)}))},n.addListener=function(e,t,n){e=su(e,t),this.l&&(this.b[e]=l.localStorage.getItem(e)),me(this.a)&&(ou(this,"local").ca(this.f),this.h||(hr()||!Xr())&&l.indexedDB||!this.l||function(e){uu(e),e.c=setInterval((function(){for(var t in e.a){var n=l.localStorage.getItem(t),r=e.b[t];n!=r&&(e.b[t]=n,n=new $t({type:"storage",key:t,target:window,oldValue:r,newValue:n,a:!0}),e.Yb(n))}}),1e3)}(this)),this.a[e]||(this.a[e]=[]),this.a[e].push(n)},n.removeListener=function(e,t,n){e=su(e,t),this.a[e]&&(J(this.a[e],(function(e){return e==n})),0==this.a[e].length&&delete this.a[e]),me(this.a)&&(ou(this,"local").ia(this.f),uu(this))},n.Yb=function(e){if(e&&e.g){var t=e.a.key;if(null==t)for(var n in this.a){var r=this.b[n];"undefined"===typeof r&&(r=null);var i=l.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.mb(n))}else if(0==t.indexOf("firebase:")&&this.a[t]){if("undefined"!==typeof e.a.a?ou(this,"local").ia(this.f):uu(this),this.m)if(n=l.localStorage.getItem(t),(r=e.a.newValue)!==n)null!==r?l.localStorage.setItem(t,r):l.localStorage.removeItem(t);else if(this.b[t]===r&&"undefined"===typeof e.a.a)return;var a=this;n=function(){"undefined"===typeof e.a.a&&a.b[t]===l.localStorage.getItem(t)||(a.b[t]=l.localStorage.getItem(t),a.mb(t))},Ke&&lt&&10==lt&&l.localStorage.getItem(t)!==e.a.newValue&&e.a.newValue!==e.a.oldValue?setTimeout(n,10):n()}}else W(e,w(this.mb,this))},n.mb=function(e){this.a[e]&&W(this.a[e],(function(e){e()}))};var hu,fu={name:"authEvent",F:"local"};function du(){this.a=au()}function pu(e,t){this.b=mu,this.f=l.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=e,this.h=t,this.l=l.Int32Array?new Int32Array(64):Array(64),void 0===hu&&(hu=l.Int32Array?new Int32Array(wu):wu),this.reset()}T(pu,(function(){this.b=-1}));for(var mu=64,vu=mu-1,yu=[],gu=0;gu<vu;gu++)yu[gu]=0;var _u=Q(128,yu);function bu(e){for(var t=e.f,n=e.l,r=0,i=0;i<t.length;)n[r++]=t[i]<<24|t[i+1]<<16|t[i+2]<<8|t[i+3],i=4*r;for(t=16;64>t;t++){i=0|n[t-15],r=0|n[t-2];var a=(0|n[t-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,o=(0|n[t-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[t]=a+o|0}r=0|e.a[0],i=0|e.a[1];var s=0|e.a[2],l=0|e.a[3],u=0|e.a[4],c=0|e.a[5],h=0|e.a[6];for(a=0|e.a[7],t=0;64>t;t++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;o=(a=a+((u>>>6|u<<26)^(u>>>11|u<<21)^(u>>>25|u<<7))|0)+((o=(o=u&c^~u&h)+(0|hu[t])|0)+(0|n[t])|0)|0,a=h,h=c,c=u,u=l+o|0,l=s,s=i,i=r,r=o+f|0}e.a[0]=e.a[0]+r|0,e.a[1]=e.a[1]+i|0,e.a[2]=e.a[2]+s|0,e.a[3]=e.a[3]+l|0,e.a[4]=e.a[4]+u|0,e.a[5]=e.a[5]+c|0,e.a[6]=e.a[6]+h|0,e.a[7]=e.a[7]+a|0}function xu(e,t,n){void 0===n&&(n=t.length);var r=0,i=e.c;if("string"===typeof t)for(;r<n;)e.f[i++]=t.charCodeAt(r++),i==e.b&&(bu(e),i=0);else{if(!p(t))throw Error("message must be string or array");for(;r<n;){var a=t[r++];if(!("number"==typeof a&&0<=a&&255>=a&&a==(0|a)))throw Error("message must be a byte array");e.f[i++]=a,i==e.b&&(bu(e),i=0)}}e.c=i,e.g+=n}pu.prototype.reset=function(){this.g=this.c=0,this.a=l.Int32Array?new Int32Array(this.h):$(this.h)};var wu=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function Eu(){pu.call(this,8,Su)}T(Eu,pu);var Su=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Tu(e,t,n,r,i,a){this.v=e,this.i=t,this.l=n,this.m=r||null,this.u=i||null,this.s=a,this.h=t+":"+n,this.C=new du,this.g=new cu(this.h),this.f=null,this.b=[],this.a=this.c=null}function ku(e){return new M("invalid-cordova-configuration",e)}function Mu(e){var t=new Eu;xu(t,e),e=[];var n=8*t.g;56>t.c?xu(t,_u,56-t.c):xu(t,_u,t.b-(t.c-56));for(var r=63;56<=r;r--)t.f[r]=255&n,n/=256;for(bu(t),r=n=0;r<t.i;r++)for(var i=24;0<=i;i-=8)e[n++]=t.a[r]>>i&255;return function(e){return X(e,(function(e){return 1<(e=e.toString(16)).length?e:"0"+e})).join("")}(e)}function Cu(e,t){for(var n=0;n<e.b.length;n++)try{e.b[n](t)}catch(r){}}function Au(e){return e.f||(e.f=e.ma().then((function(){return new wt((function(t){e.Ea((function n(r){return t(r),e.Sa(n),!1})),function(e){function t(t){r=!0,i&&i.cancel(),Iu(e).then((function(r){var i=n;if(r&&t&&t.url){var a=null;-1!=(i=sa(t.url)).indexOf("/__/auth/callback")&&(a=(a="object"===typeof(a=Ur(Un(a=jn(i),"firebaseError")||null))?C(a):null)?new Va(r.c,r.b,null,null,a,null,r.T()):new Va(r.c,r.b,i,r.f,null,null,r.T())),i=a||n}Cu(e,i)}))}var n=new Va("unknown",null,null,null,new M("no-auth-event")),r=!1,i=Cn(500).then((function(){return Iu(e).then((function(){r||Cu(e,n)}))})),a=l.handleOpenURL;l.handleOpenURL=function(e){if(0==e.toLowerCase().indexOf(Rr("BuildInfo.packageName",l).toLowerCase()+"://")&&t({url:e}),"function"===typeof a)try{a(e)}catch(n){console.error(n)}},qa||(qa=new Ga),function(e){var t=qa;t.a.push(e),t.b||(t.b=function(e){for(var n=0;n<t.a.length;n++)t.a[n](e)},"function"===typeof(e=Rr("universalLinks.subscribe",l))&&e(null,t.b))}(t)}(e)}))}))),e.f}function Iu(e){var t=null;return function(e){return e.b.get(fu,e.a).then((function(e){return Ha(e)}))}(e.g).then((function(n){return t=n,lu((n=e.g).b,fu,n.a)})).then((function(){return t}))}function Pu(e){this.a=e,this.b=au()}(n=Tu.prototype).ma=function(){return this.Ia?this.Ia:this.Ia=(xr(void 0)?br().then((function(){return new wt((function(e,t){var n=l.document,r=setTimeout((function(){t(Error("Cordova framework is not ready."))}),1e3);n.addEventListener("deviceready",(function(){clearTimeout(r),e()}),!1)}))})):It(Error("Cordova must run in an Android or iOS file scheme."))).then((function(){if("function"!==typeof Rr("universalLinks.subscribe",l))throw ku("cordova-universal-links-plugin-fix is not installed");if("undefined"===typeof Rr("BuildInfo.packageName",l))throw ku("cordova-plugin-buildinfo is not installed");if("function"!==typeof Rr("cordova.plugins.browsertab.openUrl",l))throw ku("cordova-plugin-browsertab is not installed");if("function"!==typeof Rr("cordova.InAppBrowser.open",l))throw ku("cordova-plugin-inappbrowser is not installed")}),(function(){throw new M("cordova-not-ready")}))},n.Ob=function(e,t){return t(new M("operation-not-supported-in-this-environment")),At()},n.Mb=function(){return It(new M("operation-not-supported-in-this-environment"))},n.$b=function(){return!1},n.Xb=function(){return!0},n.Tb=function(){return!0},n.Nb=function(e,t,n,r){if(this.c)return It(new M("redirect-operation-pending"));var i=this,a=l.document,o=null,s=null,u=null,c=null;return this.c=At().then((function(){return ja(t),Au(i)})).then((function(){return function(e,t,n,r,i){var a=function(){for(var e=20,t=[];0<e;)t.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),e--;return t.join("")}(),o=new Va(t,r,null,a,new M("no-auth-event"),null,i),s=Rr("BuildInfo.packageName",l);if("string"!==typeof s)throw new M("invalid-cordova-configuration");var u=Rr("BuildInfo.displayName",l),c={};if(Pr().toLowerCase().match(/iphone|ipad|ipod/))c.ibi=s;else{if(!Pr().toLowerCase().match(/android/))return It(new M("operation-not-supported-in-this-environment"));c.apn=s}u&&(c.appDisplayName=u),a=Mu(a),c.sessionId=a;var h=wl(e.v,e.i,e.l,t,n,null,r,e.m,c,e.u,i,e.s);return e.ma().then((function(){var t=e.h;return e.C.a.set(fu,o.w(),t)})).then((function(){var t=Rr("cordova.plugins.browsertab.isAvailable",l);if("function"!==typeof t)throw new M("invalid-cordova-configuration");var n=null;t((function(t){if(t){if("function"!==typeof(n=Rr("cordova.plugins.browsertab.openUrl",l)))throw new M("invalid-cordova-configuration");n(h)}else{if("function"!==typeof(n=Rr("cordova.InAppBrowser.open",l)))throw new M("invalid-cordova-configuration");t=Pr(),e.a=n(h,t.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||t.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}}))}))}(i,e,t,n,r)})).then((function(){return new wt((function(e,t){s=function(){var t=Rr("cordova.plugins.browsertab.close",l);return e(),"function"===typeof t&&t(),i.a&&"function"===typeof i.a.close&&(i.a.close(),i.a=null),!1},i.Ea(s),u=function(){o||(o=Cn(2e3).then((function(){t(new M("redirect-cancelled-by-user"))})))},c=function(){Wr()&&u()},a.addEventListener("resume",u,!1),Pr().toLowerCase().match(/android/)||a.addEventListener("visibilitychange",c,!1)})).o((function(e){return Iu(i).then((function(){throw e}))}))})).oa((function(){u&&a.removeEventListener("resume",u,!1),c&&a.removeEventListener("visibilitychange",c,!1),o&&o.cancel(),s&&i.Sa(s),i.c=null}))},n.Ea=function(e){this.b.push(e),Au(this).o((function(t){"auth/invalid-cordova-configuration"===t.code&&(t=new Va("unknown",null,null,null,new M("no-auth-event")),e(t))}))},n.Sa=function(e){J(this.b,(function(t){return t==e}))};var Ru={name:"pendingRedirect",F:"session"};function Lu(e){return lu(e.b,Ru,e.a)}function Ou(e,t,n,r){this.i={},this.u=0,this.D=e,this.v=t,this.m=n,this.J=r,this.h=[],this.f=!1,this.l=w(this.s,this),this.b=new Ku,this.C=new ec,this.g=new Pu(Xu(this.v,this.m)),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.C,this.c.linkViaPopup=this.C,this.c.reauthViaPopup=this.C,this.a=Du(this.D,this.v,this.m,A,this.J)}function Du(e,n,r,i,a){var o=t.a.SDK_VERSION||null;return xr()?new Tu(e,n,r,o,i,a):new gl(e,n,r,o,i,a)}function Nu(e){e.f||(e.f=!0,e.a.Ea(e.l));var t=e.a;return e.a.ma().o((function(n){throw e.a==t&&e.reset(),n}))}function zu(e){e.a.Xb()&&Nu(e).o((function(t){var n=new Va("unknown",null,null,null,new M("operation-not-supported-in-this-environment"));Hu(t)&&e.s(n)})),e.a.Tb()||Yu(e.b)}function Fu(e,t){K(e.h,t)||e.h.push(t),e.f||function(e){return e.b.get(Ru,e.a).then((function(e){return"pending"==e}))}(e.g).then((function(t){t?Lu(e.g).then((function(){Nu(e).o((function(t){var n=new Va("unknown",null,null,null,new M("operation-not-supported-in-this-environment"));Hu(t)&&e.s(n)}))})):zu(e)})).o((function(){zu(e)}))}function Bu(e,t){J(e.h,(function(e){return e==t}))}Ou.prototype.reset=function(){this.f=!1,this.a.Sa(this.l),this.a=Du(this.D,this.v,this.m,null,this.J),this.i={}},Ou.prototype.s=function(e){if(!e)throw new M("invalid-auth-event");if(6e5<=S()-this.u&&(this.i={},this.u=0),e&&e.getUid()&&this.i.hasOwnProperty(e.getUid()))return!1;for(var t=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.Fb(e.c,e.b)){(t=this.c[e.c])&&(t.h(e,r),e&&(e.f||e.b)&&(this.i[e.getUid()]=!0,this.u=S())),t=!0;break}}return Yu(this.b),t};var Uu=new Gr(2e3,1e4),ju=new Gr(3e4,6e4);function Vu(e,t,n,r,i,a,o){return e.a.Mb(t,n,r,(function(){e.f||(e.f=!0,e.a.Ea(e.l))}),(function(){e.reset()}),i,a,o)}function Hu(e){return!(!e||"auth/cordova-not-ready"!=e.code)}function Gu(e,t,n,r,i){var a;return function(e){return e.b.set(Ru,"pending",e.a)}(e.g).then((function(){return e.a.Nb(t,n,r,i).o((function(t){if(Hu(t))throw new M("operation-not-supported-in-this-environment");return a=t,Lu(e.g).then((function(){throw a}))})).then((function(){return e.a.$b()?new wt((function(){})):Lu(e.g).then((function(){return e.qa()})).then((function(){})).o((function(){}))}))}))}function Wu(e,t,n,r,i){return e.a.Ob(r,(function(e){t.na(n,null,e,i)}),Uu.get())}Ou.prototype.qa=function(){return this.b.qa()};var qu={};function Xu(e,t,n){return e=e+":"+t,n&&(e=e+":"+n.url),e}function Zu(e,t,n,r){var i=Xu(t,n,r);return qu[i]||(qu[i]=new Ou(e,t,n,r)),qu[i]}function Ku(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function Yu(e){e.g||(e.g=!0,$u(e,!1,null,null))}function Ju(e){e.g&&!e.i&&$u(e,!1,null,null)}function Qu(e,t){if(e.b=function(){return At(t)},e.f.length)for(var n=0;n<e.f.length;n++)e.f[n](t)}function $u(e,t,n,r){t?r?function(e,t){if(e.b=function(){return It(t)},e.c.length)for(var n=0;n<e.c.length;n++)e.c[n](t)}(e,r):Qu(e,n):Qu(e,{user:null}),e.f=[],e.c=[]}function ec(){}function tc(){this.ib=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.ib},set:function(e){this.ib=e},enumerable:!1})}function nc(e,t){this.a=t,Qr(this,"verificationId",e)}function rc(e,t,n,r){return new Fa(e).fb(t,n).then((function(e){return new nc(e,r)}))}function ic(e){var t=Xi(e);if(!(t&&t.exp&&t.auth_time&&t.iat))throw new M("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");$r(this,{token:e,expirationTime:qr(1e3*t.exp),authTime:qr(1e3*t.auth_time),issuedAtTime:qr(1e3*t.iat),signInProvider:t.firebase&&t.firebase.sign_in_provider?t.firebase.sign_in_provider:null,signInSecondFactor:t.firebase&&t.firebase.sign_in_second_factor?t.firebase.sign_in_second_factor:null,claims:t})}function ac(e,t,n){var r=t&&t[sc];if(!r)throw new M("argument-error","Internal assert: Invalid MultiFactorResolver");this.a=e,this.f=ve(t),this.g=n,this.c=new la(null,r),this.b=[];var i=this;W(t[oc]||[],(function(e){(e=ri(e))&&i.b.push(e)})),Qr(this,"auth",this.a),Qr(this,"session",this.c),Qr(this,"hints",this.b)}Ku.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},Ku.prototype.h=function(e,t){if(e){this.reset(),this.g=!0;var n=e.c,r=e.b,i=e.a&&"auth/web-storage-unsupported"==e.a.code,a=e.a&&"auth/operation-not-supported-in-this-environment"==e.a.code;this.i=!(!i&&!a),"unknown"!=n||i||a?e.a?($u(this,!0,null,e.a),At()):t.Fa(n,r)?function(e,t,n){n=n.Fa(t.c,t.b);var r=t.g,i=t.f,a=t.i,o=t.T(),s=!!t.c.match(/Redirect$/);n(r,i,o,a).then((function(t){$u(e,s,t,null)})).o((function(t){$u(e,s,null,t)}))}(this,e,t):It(new M("invalid-auth-event")):($u(this,!1,null,null),At())}else It(new M("invalid-auth-event"))},Ku.prototype.qa=function(){var e=this;return new wt((function(t,n){e.b?e.b().then(t,n):(e.f.push(t),e.c.push(n),function(e){var t=new M("timeout");e.a&&e.a.cancel(),e.a=Cn(ju.get()).then((function(){e.b||(e.g=!0,$u(e,!0,null,t))}))}(e))}))},ec.prototype.h=function(e,t){if(e){var n=e.c,r=e.b;e.a?(t.na(e.c,null,e.a,e.b),At()):t.Fa(n,r)?function(e,t){var n=e.b,r=e.c;t.Fa(r,n)(e.g,e.f,e.T(),e.i).then((function(e){t.na(r,e,null,n)})).o((function(e){t.na(r,null,e,n)}))}(e,t):It(new M("invalid-auth-event"))}else It(new M("invalid-auth-event"))},nc.prototype.confirm=function(e){return e=Ba(this.verificationId,e),this.a(e)};var oc="mfaInfo",sc="mfaPendingCredential";function lc(e,t,n,r){M.call(this,"multi-factor-auth-required",r,t),this.b=new ac(e,t,n),Qr(this,"resolver",this.b)}function uc(e,t,n){if(e&&v(e.serverResponse)&&"auth/multi-factor-auth-required"===e.code)try{return new lc(t,e.serverResponse,n,e.message)}catch(r){}return null}function cc(){}function hc(e){Qr(this,"factorId",e.fa),this.a=e}function fc(e){if(hc.call(this,e),this.a.fa!=Fa.PROVIDER_ID)throw new M("argument-error","firebase.auth.PhoneMultiFactorAssertion requires a valid firebase.auth.PhoneAuthCredential")}function dc(e,t){for(var n in Qt.call(this,e),t)this[n]=t[n]}function pc(e,t){this.a=e,this.b=[],this.c=w(this.yc,this),hn(this.a,"userReloaded",this.c);var n=[];t&&t.multiFactor&&t.multiFactor.enrolledFactors&&W(t.multiFactor.enrolledFactors,(function(e){var t=null,r={};if(e){e.uid&&(r[oi]=e.uid),e.displayName&&(r[ii]=e.displayName),e.enrollmentTime&&(r[ai]=new Date(e.enrollmentTime).toISOString()),e.phoneNumber&&(r[si]=e.phoneNumber);try{t=new li(r)}catch(i){}e=t}else e=null;e&&n.push(e)})),mc(this,n)}function mc(e,t){e.b=t,Qr(e,"enrolledFactors",t)}function vc(e,t,n){if(this.h=e,this.i=t,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function yc(e,t){e.stop(),e.b=Cn(function(e,t){return t?(e.a=e.c,e.g()):(t=e.a,e.a*=2,e.a>e.f&&(e.a=e.f),t)}(e,t)).then((function(){return function(){var e=l.document,t=null;return Wr()||!e?At():new wt((function(n){t=function(){Wr()&&(e.removeEventListener("visibilitychange",t,!1),n())},e.addEventListener("visibilitychange",t,!1)})).o((function(n){throw e.removeEventListener("visibilitychange",t,!1),n}))}()})).then((function(){return e.h()})).then((function(){yc(e,!0)})).o((function(t){e.i(t)&&yc(e,!1)}))}function gc(e){this.f=e,this.b=this.a=null,this.c=Date.now()}function _c(e,t){"undefined"===typeof t&&(e.b?t=(t=e.b).a-t.g:t=0),e.c=Date.now()+1e3*t}function bc(e,t){e.b=qi(t[ns]||""),e.a=t.refreshToken,_c(e,"undefined"!==typeof(t=t.expiresIn)?Number(t):void 0)}function xc(e,t){return function(e,t){return new wt((function(n,r){"refresh_token"==t.grant_type&&t.refresh_token||"authorization_code"==t.grant_type&&t.code?hs(e,e.l+"?key="+encodeURIComponent(e.c),(function(e){e?e.error?r(ul(e)):e.access_token&&e.refresh_token?n(e):r(new M("internal-error")):r(new M("network-request-failed"))}),"POST",$n(t).toString(),e.g,e.m.get()):r(new M("internal-error"))}))}(e.f,t).then((function(t){return e.b=qi(t.access_token),e.a=t.refresh_token,_c(e,t.expires_in),{accessToken:e.b.toString(),refreshToken:e.a}})).o((function(t){throw"auth/user-token-expired"==t.code&&(e.a=null),t}))}function wc(e,t){this.a=e||null,this.b=t||null,$r(this,{lastSignInTime:qr(t||null),creationTime:qr(e||null)})}function Ec(e,t,n,r,i,a){$r(this,{uid:e,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:a||null,providerId:t})}function Sc(e,n,r){this.J=[],this.l=e.apiKey,this.m=e.appName,this.s=e.authDomain||null;var i=t.a.SDK_VERSION?Ir(t.a.SDK_VERSION):null;this.a=new es(this.l,L(A),i),e.emulatorConfig&&ls(this.a,e.emulatorConfig),this.b=new gc(this.a),Rc(this,n[ns]),bc(this.b,n),Qr(this,"refreshToken",this.b.a),Dc(this,r||{}),En.call(this),this.R=!1,this.s&&Or()&&(this.i=Zu(this.s,this.l,this.m)),this.S=[],this.h=null,this.u=function(e){return new vc((function(){return e.I(!0)}),(function(e){return!(!e||"auth/network-request-failed"!=e.code)}),(function(){var t=e.b.c-Date.now()-3e5;return 0<t?t:0}))}(this),this.aa=w(this.hb,this);var a=this;this.ya=null,this.Oa=function(e){a.wa(e.h)},this.ja=null,this.Aa=function(e){ls(a.a,e.c)},this.X=null,this.$=[],this.Ba=function(e){Mc(a,e.f)},this.ba=null,this.O=new pc(this,r),Qr(this,"multiFactor",this.O)}function Tc(e,t){e.ja&&pn(e.ja,"languageCodeChanged",e.Oa),(e.ja=t)&&hn(t,"languageCodeChanged",e.Oa)}function kc(e,t){e.X&&pn(e.X,"emulatorConfigChanged",e.Aa),(e.X=t)&&hn(t,"emulatorConfigChanged",e.Aa)}function Mc(e,n){e.$=n,cs(e.a,t.a.SDK_VERSION?Ir(t.a.SDK_VERSION,e.$):null)}function Cc(e,t){e.ba&&pn(e.ba,"frameworkChanged",e.Ba),(e.ba=t)&&hn(t,"frameworkChanged",e.Ba)}function Ac(e){try{return t.a.app(e.m).auth()}catch(n){throw new M("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+e.m+"'!")}}function Ic(e){e.D||e.u.b||(e.u.start(),pn(e,"tokenChanged",e.aa),hn(e,"tokenChanged",e.aa))}function Pc(e){pn(e,"tokenChanged",e.aa),e.u.stop()}function Rc(e,t){e.za=t,Qr(e,"_lat",t)}function Lc(e){for(var t=[],n=0;n<e.S.length;n++)t.push(e.S[n](e));return Rt(t).then((function(){return e}))}function Oc(e){e.i&&!e.R&&(e.R=!0,Fu(e.i,e))}function Dc(e,t){$r(e,{uid:t.uid,displayName:t.displayName||null,photoURL:t.photoURL||null,email:t.email||null,emailVerified:t.emailVerified||!1,phoneNumber:t.phoneNumber||null,isAnonymous:t.isAnonymous||!1,tenantId:t.tenantId||null,metadata:new wc(t.createdAt,t.lastLoginAt),providerData:[]}),e.a.b=e.tenantId}function Nc(){}function zc(e){return At().then((function(){if(e.D)throw new M("app-deleted")}))}function Fc(e){return X(e.providerData,(function(e){return e.providerId}))}function Bc(e,t){t&&(Uc(e,t.providerId),e.providerData.push(t))}function Uc(e,t){J(e.providerData,(function(e){return e.providerId==t}))}function jc(e,t,n){("uid"!=t||n)&&e.hasOwnProperty(t)&&Qr(e,t,n)}function Vc(e,t){e!=t&&($r(e,{uid:t.uid,displayName:t.displayName,photoURL:t.photoURL,email:t.email,emailVerified:t.emailVerified,phoneNumber:t.phoneNumber,isAnonymous:t.isAnonymous,tenantId:t.tenantId,providerData:[]}),t.metadata?Qr(e,"metadata",function(e){return new wc(e.a,e.b)}(t.metadata)):Qr(e,"metadata",new wc),W(t.providerData,(function(t){Bc(e,t)})),function(e,t){e.b=t.b,e.a=t.a,e.c=t.c}(e.b,t.b),Qr(e,"refreshToken",e.b.a),mc(e.O,t.O.b))}function Hc(e){return e.I().then((function(t){var n=e.isAnonymous;return function(e,t){return sl(e.a,Fs,{idToken:t}).then(w(e.Kc,e))}(e,t).then((function(){return n||jc(e,"isAnonymous",!1),t}))}))}function Gc(e,t){t[ns]&&e.za!=t[ns]&&(bc(e.b,t),e.dispatchEvent(new dc("tokenChanged")),Rc(e,t[ns]),jc(e,"refreshToken",e.b.a))}function Wc(e,t){return Hc(e).then((function(){if(K(Fc(e),t))return Lc(e).then((function(){throw new M("provider-already-linked")}))}))}function qc(e,t,n){return ei({user:e,credential:Ua(t),additionalUserInfo:t=Qi(t),operationType:n})}function Xc(e,t){return Gc(e,t),e.reload().then((function(){return e}))}function Zc(e,n,r,i,a){if(!Or())return It(new M("operation-not-supported-in-this-environment"));if(e.h&&!a)return It(e.h);var o=Ji(r.providerId),s=jr(e.uid+":::"),l=null;(!zr()||wr())&&e.s&&r.isOAuthProvider&&(l=wl(e.s,e.l,e.m,n,r,null,s,t.a.SDK_VERSION||null,null,null,e.tenantId));var u=yr(l,o&&o.ua,o&&o.ta);return i=i().then((function(){if(Yc(e),!a)return e.I().then((function(){}))})).then((function(){return Vu(e.i,u,n,r,s,!!l,e.tenantId)})).then((function(){return new wt((function(t,r){e.na(n,null,new M("cancelled-popup-request"),e.g||null),e.f=t,e.C=r,e.g=s,e.c=Wu(e.i,e,n,u,s)}))})).then((function(e){return u&&vr(u),e?ei(e):null})).o((function(e){throw u&&vr(u),e})),Jc(e,i,a)}function Kc(e,t,n,r,i){if(!Or())return It(new M("operation-not-supported-in-this-environment"));if(e.h&&!i)return It(e.h);var a=null,o=jr(e.uid+":::");return r=r().then((function(){if(Yc(e),!i)return e.I().then((function(){}))})).then((function(){return e.ga=o,Lc(e)})).then((function(t){return e.ha&&(t=(t=e.ha).b.set(eh,e.w(),t.a)),t})).then((function(){return Gu(e.i,t,n,o,e.tenantId)})).o((function(t){if(a=t,e.ha)return th(e.ha);throw a})).then((function(){if(a)throw a})),Jc(e,r,i)}function Yc(e){if(!e.i||!e.R){if(e.i&&!e.R)throw new M("internal-error");throw new M("auth-domain-config-required")}}function Jc(e,t,n){var r=function(e,t,n){return e.h&&!n?(t.cancel(),It(e.h)):t.o((function(t){throw!t||"auth/user-disabled"!=t.code&&"auth/user-token-expired"!=t.code||(e.h||e.dispatchEvent(new dc("userInvalidated")),e.h=t),t}))}(e,t,n);return e.J.push(r),r.oa((function(){Y(e.J,r)})),r.o((function(t){var n=null;throw t&&"auth/multi-factor-auth-required"===t.code&&(n=uc(t.w(),Ac(e),w(e.jc,e))),n||t}))}function Qc(e){if(!e.apiKey)return null;var t={apiKey:e.apiKey,authDomain:e.authDomain,appName:e.appName,emulatorConfig:e.emulatorConfig},n={};if(!e.stsTokenManager||!e.stsTokenManager.accessToken)return null;n[ns]=e.stsTokenManager.accessToken,n.refreshToken=e.stsTokenManager.refreshToken||null;var r=e.stsTokenManager.expirationTime;r&&(n.expiresIn=(r-Date.now())/1e3);var i=new Sc(t,n,e);return e.providerData&&W(e.providerData,(function(e){e&&Bc(i,ei(e))})),e.redirectEventId&&(i.ga=e.redirectEventId),i}function $c(e){this.a=e,this.b=au()}ac.prototype.Rc=function(e){var t=this;return e.sb(this.a.a,this.c).then((function(e){var n=ve(t.f);return delete n[oc],delete n[sc],ge(n,e),t.g(n)}))},T(lc,M),cc.prototype.sb=function(e,t,n){return t.type==ua?function(e,t,n,r){return n.Ha().then((function(n){return n={idToken:n},"undefined"!==typeof r&&(n.displayName=r),ge(n,{phoneVerificationInfo:za(e.a)}),sl(t,Ns,n)}))}(this,e,t,n):function(e,t,n){return n.Ha().then((function(n){return ge(n={mfaPendingCredential:n},{phoneVerificationInfo:za(e.a)}),sl(t,zs,n)}))}(this,e,t)},T(hc,cc),T(fc,hc),T(dc,Qt),(n=pc.prototype).yc=function(e){mc(this,function(e){var t=[];return W(e.mfaInfo||[],(function(e){(e=ri(e))&&t.push(e)})),t}(e.hd))},n.Rb=function(){return this.a.I().then((function(e){return new la(e,null)}))},n.fc=function(e,t){var n=this,r=this.a.a;return this.Rb().then((function(n){return e.sb(r,n,t)})).then((function(e){return Gc(n.a,e),n.a.reload()}))},n.bd=function(e){var t=this,n="string"===typeof e?e:e.uid,r=this.a.a;return this.a.I().then((function(e){return sl(r,ol,{idToken:e,mfaEnrollmentId:n})})).then((function(e){var r=q(t.b,(function(e){return e.uid!=n}));return mc(t,r),Gc(t.a,e),t.a.reload().o((function(e){if("auth/user-token-expired"!=e.code)throw e}))}))},n.w=function(){return{multiFactor:{enrolledFactors:X(this.b,(function(e){return e.w()}))}}},vc.prototype.start=function(){this.a=this.c,yc(this,!0)},vc.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},gc.prototype.w=function(){return{apiKey:this.f.c,refreshToken:this.a,accessToken:this.b&&this.b.toString(),expirationTime:this.c}},gc.prototype.getToken=function(e){return e=!!e,this.b&&!this.a?It(new M("user-token-expired")):e||!this.b||Date.now()>this.c-3e4?this.a?xc(this,{grant_type:"refresh_token",refresh_token:this.a}):At(null):At({accessToken:this.b.toString(),refreshToken:this.a})},wc.prototype.w=function(){return{lastLoginAt:this.b,createdAt:this.a}},T(Sc,En),Sc.prototype.wa=function(e){this.ya=e,ss(this.a,e)},Sc.prototype.la=function(){return this.ya},Sc.prototype.Ga=function(){return $(this.$)},Sc.prototype.hb=function(){this.u.b&&(this.u.stop(),this.u.start())},Qr(Sc.prototype,"providerId","firebase"),(n=Sc.prototype).reload=function(){var e=this;return Jc(this,zc(this).then((function(){return Hc(e).then((function(){return Lc(e)})).then(Nc)})))},n.oc=function(e){return this.I(e).then((function(e){return new ic(e)}))},n.I=function(e){var t=this;return Jc(this,zc(this).then((function(){return t.b.getToken(e)})).then((function(e){if(!e)throw new M("internal-error");return e.accessToken!=t.za&&(Rc(t,e.accessToken),t.dispatchEvent(new dc("tokenChanged"))),jc(t,"refreshToken",e.refreshToken),e.accessToken})))},n.Kc=function(e){if(!(e=e.users)||!e.length)throw new M("internal-error");Dc(this,{uid:(e=e[0]).localId,displayName:e.displayName,photoURL:e.photoUrl,email:e.email,emailVerified:!!e.emailVerified,phoneNumber:e.phoneNumber,lastLoginAt:e.lastLoginAt,createdAt:e.createdAt,tenantId:e.tenantId});for(var t=function(e){return(e=e.providerUserInfo)&&e.length?X(e,(function(e){return new Ec(e.rawId,e.providerId,e.email,e.displayName,e.photoUrl,e.phoneNumber)})):[]}(e),n=0;n<t.length;n++)Bc(this,t[n]);jc(this,"isAnonymous",!(this.email&&e.passwordHash)&&!(this.providerData&&this.providerData.length)),this.dispatchEvent(new dc("userReloaded",{hd:e}))},n.Lc=function(e){return Yr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.tb(e)},n.tb=function(e){var t=this,n=null;return Jc(this,e.c(this.a,this.uid).then((function(e){return Gc(t,e),n=qc(t,e,"reauthenticate"),t.h=null,t.reload()})).then((function(){return n})),!0)},n.Cc=function(e){return Yr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.qb(e)},n.qb=function(e){var t=this,n=null;return Jc(this,Wc(this,e.providerId).then((function(){return t.I()})).then((function(n){return e.b(t.a,n)})).then((function(e){return n=qc(t,e,"link"),Xc(t,e)})).then((function(){return n})))},n.Dc=function(e,t){var n=this;return Jc(this,Wc(this,"phone").then((function(){return rc(Ac(n),e,t,w(n.qb,n))})))},n.Mc=function(e,t){var n=this;return Jc(this,At().then((function(){return rc(Ac(n),e,t,w(n.tb,n))})),!0)},n.Bb=function(e){var t=this;return Jc(this,this.I().then((function(n){return t.a.Bb(n,e)})).then((function(e){return Gc(t,e),t.reload()})))},n.ed=function(e){var t=this;return Jc(this,this.I().then((function(n){return e.b(t.a,n)})).then((function(e){return Gc(t,e),t.reload()})))},n.Cb=function(e){var t=this;return Jc(this,this.I().then((function(n){return t.a.Cb(n,e)})).then((function(e){return Gc(t,e),t.reload()})))},n.Db=function(e){if(void 0===e.displayName&&void 0===e.photoURL)return zc(this);var t=this;return Jc(this,this.I().then((function(n){return t.a.Db(n,{displayName:e.displayName,photoUrl:e.photoURL})})).then((function(e){return Gc(t,e),jc(t,"displayName",e.displayName||null),jc(t,"photoURL",e.photoUrl||null),W(t.providerData,(function(e){"password"===e.providerId&&(Qr(e,"displayName",t.displayName),Qr(e,"photoURL",t.photoURL))})),Lc(t)})).then(Nc))},n.cd=function(e){var t=this;return Jc(this,Hc(this).then((function(n){return K(Fc(t),e)?function(e,t,n){return sl(e,Ls,{idToken:t,deleteProvider:n})}(t.a,n,[e]).then((function(e){var n={};return W(e.providerUserInfo||[],(function(e){n[e.providerId]=!0})),W(Fc(t),(function(e){n[e]||Uc(t,e)})),n[Fa.PROVIDER_ID]||Qr(t,"phoneNumber",null),Lc(t)})):Lc(t).then((function(){throw new M("no-such-provider")}))})))},n.delete=function(){var e=this;return Jc(this,this.I().then((function(t){return sl(e.a,Rs,{idToken:t})})).then((function(){e.dispatchEvent(new dc("userDeleted"))}))).then((function(){for(var t=0;t<e.J.length;t++)e.J[t].cancel("app-deleted");Tc(e,null),kc(e,null),Cc(e,null),e.J=[],e.D=!0,Pc(e),Qr(e,"refreshToken",null),e.i&&Bu(e.i,e)}))},n.Fb=function(e,t){return!!("linkViaPopup"==e&&(this.g||null)==t&&this.f||"reauthViaPopup"==e&&(this.g||null)==t&&this.f||"linkViaRedirect"==e&&(this.ga||null)==t||"reauthViaRedirect"==e&&(this.ga||null)==t)},n.na=function(e,t,n,r){"linkViaPopup"!=e&&"reauthViaPopup"!=e||r!=(this.g||null)||(n&&this.C?this.C(n):t&&!n&&this.f&&this.f(t),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.C)},n.Fa=function(e,t){return"linkViaPopup"==e&&t==(this.g||null)?w(this.Kb,this):"reauthViaPopup"==e&&t==(this.g||null)?w(this.Lb,this):"linkViaRedirect"==e&&(this.ga||null)==t?w(this.Kb,this):"reauthViaRedirect"==e&&(this.ga||null)==t?w(this.Lb,this):null},n.Ec=function(e){var t=this;return Zc(this,"linkViaPopup",e,(function(){return Wc(t,e.providerId).then((function(){return Lc(t)}))}),!1)},n.Nc=function(e){return Zc(this,"reauthViaPopup",e,(function(){return At()}),!0)},n.Fc=function(e){var t=this;return Kc(this,"linkViaRedirect",e,(function(){return Wc(t,e.providerId)}),!1)},n.Oc=function(e){return Kc(this,"reauthViaRedirect",e,(function(){return At()}),!0)},n.Kb=function(e,t,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var a=null;return Jc(this,this.I().then((function(n){return Ts(i.a,{requestUri:e,postBody:r,sessionId:t,idToken:n})})).then((function(e){return a=qc(i,e,"link"),Xc(i,e)})).then((function(){return a})))},n.Lb=function(e,t,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var a=null;return Jc(this,At().then((function(){return fa(ks(i.a,{requestUri:e,sessionId:t,postBody:r,tenantId:n}),i.uid)})).then((function(e){return a=qc(i,e,"reauthenticate"),Gc(i,e),i.h=null,i.reload()})).then((function(){return a})),!0)},n.ub=function(e){var t=this,n=null;return Jc(this,this.I().then((function(t){return n=t,"undefined"===typeof e||me(e)?{}:Vi(new Ri(e))})).then((function(e){return t.a.ub(n,e)})).then((function(e){if(t.email!=e)return t.reload()})).then((function(){})))},n.Eb=function(e,t){var n=this,r=null;return Jc(this,this.I().then((function(e){return r=e,"undefined"===typeof t||me(t)?{}:Vi(new Ri(t))})).then((function(t){return n.a.Eb(r,e,t)})).then((function(e){if(n.email!=e)return n.reload()})).then((function(){})))},n.jc=function(e){var t=null,n=this;return Jc(this,e=fa(At(e),n.uid).then((function(e){return t=qc(n,e,"reauthenticate"),Gc(n,e),n.h=null,n.reload()})).then((function(){return t})),!0)},n.toJSON=function(){return this.w()},n.w=function(){var e={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,tenantId:this.tenantId,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.s,stsTokenManager:this.b.w(),redirectEventId:this.ga||null};return this.metadata&&ge(e,this.metadata.w()),W(this.providerData,(function(t){e.providerData.push(function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}(t))})),ge(e,this.O.w()),e};var eh={name:"redirectUser",F:"session"};function th(e){return lu(e.b,eh,e.a)}function nh(e){this.a=e,this.b=au(),this.c=null,this.f=function(e){var t=ah("local"),n=ah("session"),r=ah("none");return function(e,t,n){var r=su(t,n),i=ou(e,t.F);return e.get(t,n).then((function(a){var o=null;try{o=Ur(l.localStorage.getItem(r))}catch(s){}if(o&&!a)return l.localStorage.removeItem(r),e.set(t,o,n);o&&a&&"localStorage"!=i.type&&l.localStorage.removeItem(r)}))}(e.b,t,e.a).then((function(){return e.b.get(n,e.a)})).then((function(i){return i?n:e.b.get(r,e.a).then((function(n){return n?r:e.b.get(t,e.a).then((function(n){return n?t:e.b.get(ih,e.a).then((function(e){return e?ah(e):t}))}))}))})).then((function(t){return e.c=t,rh(e,t.F)})).o((function(){e.c||(e.c=t)}))}(this),this.b.addListener(ah("local"),this.a,w(this.g,this))}function rh(e,t){var n,r=[];for(n in ru)ru[n]!==t&&r.push(lu(e.b,ah(ru[n]),e.a));return r.push(lu(e.b,ih,e.a)),function(e){return new wt((function(t,n){var r=e.length,i=[];if(r)for(var a=function(e,n){r--,i[e]=n,0==r&&t(i)},o=function(e){n(e)},s=0;s<e.length;s++)Pt(e[s],E(a,s),o);else t(i)}))}(r)}nh.prototype.g=function(){var e=this,t=ah("local");uh(this,(function(){return At().then((function(){return e.c&&"local"!=e.c.F?e.b.get(t,e.a):null})).then((function(n){if(n)return rh(e,"local").then((function(){e.c=t}))}))}))};var ih={name:"persistence",F:"session"};function ah(e){return{name:"authUser",F:e}}function oh(e,t){return uh(e,(function(){return e.b.set(e.c,t.w(),e.a)}))}function sh(e){return uh(e,(function(){return lu(e.b,e.c,e.a)}))}function lh(e,t,n){return uh(e,(function(){return e.b.get(e.c,e.a).then((function(e){return e&&t&&(e.authDomain=t),e&&n&&(e.emulatorConfig=n),Qc(e||{})}))}))}function uh(e,t){return e.f=e.f.then(t,t),e.f}function ch(e){if(this.l=!1,Qr(this,"settings",new tc),Qr(this,"app",e),!_h(this).options||!_h(this).options.apiKey)throw new M("invalid-api-key");e=t.a.SDK_VERSION?Ir(t.a.SDK_VERSION):null,this.a=new es(_h(this).options&&_h(this).options.apiKey,L(A),e),this.R=[],this.s=[],this.O=[],this.hb=t.a.INTERNAL.createSubscribe(w(this.zc,this)),this.X=void 0,this.bc=t.a.INTERNAL.createSubscribe(w(this.Ac,this)),yh(this,null),this.i=new nh(_h(this).options.apiKey+":"+_h(this).name),this.D=new $c(_h(this).options.apiKey+":"+_h(this).name),this.$=Eh(this,function(e){var t=_h(e).options.authDomain,n=function(e){var t=function(e,t){return e.b.get(eh,e.a).then((function(e){return e&&t&&(e.authDomain=t),Qc(e||{})}))}(e.D,_h(e).options.authDomain).then((function(t){return(e.m=t)&&(t.ha=e.D),th(e.D)}));return Eh(e,t)}(e).then((function(){return lh(e.i,t,e.P)})).then((function(t){return t?(t.ha=e.D,e.m&&(e.m.ga||null)==(t.ga||null)?t:t.reload().then((function(){return oh(e.i,t).then((function(){return t}))})).o((function(n){return"auth/network-request-failed"==n.code?t:sh(e.i)}))):null})).then((function(t){yh(e,t||null)}));return Eh(e,n)}(this)),this.h=Eh(this,function(e){return e.$.then((function(){return mh(e)})).o((function(){})).then((function(){if(!e.l)return e.ja()})).o((function(){})).then((function(){if(!e.l){e.ba=!0;var t=e.i;t.b.addListener(ah("local"),t.a,e.ja)}}))}(this)),this.ba=!1,this.ja=w(this.Zc,this),this.Ba=w(this.da,this),this.ya=w(this.mc,this),this.za=w(this.wc,this),this.Aa=w(this.xc,this),this.b=null,function(e){var t=_h(e).options.authDomain,n=_h(e).options.apiKey;t&&Or()&&(e.Oa=e.$.then((function(){if(!e.l){if(e.b=Zu(t,n,_h(e).name,e.P),Fu(e.b,e),bh(e)&&Oc(bh(e)),e.m){Oc(e.m);var r=e.m;r.wa(e.la()),Tc(r,e),Mc(r=e.m,e.J),Cc(r,e),ls((r=e.m).a,e.P),kc(r,e),e.m=null}return e.b}})))}(this),this.INTERNAL={},this.INTERNAL.delete=w(this.delete,this),this.INTERNAL.logFramework=w(this.Gc,this),this.u=0,En.call(this),function(e){Object.defineProperty(e,"lc",{get:function(){return this.la()},set:function(e){this.wa(e)},enumerable:!1}),e.aa=null,Object.defineProperty(e,"ti",{get:function(){return this.T()},set:function(e){this.yb(e)},enumerable:!1}),e.S=null,Object.defineProperty(e,"emulatorConfig",{get:function(){if(this.P){var e=jn(this.P.url);e=ei({protocol:e.c,host:e.a,port:e.g,options:ei({disableWarnings:this.P.ec})})}else e=null;return e},enumerable:!1})}(this),this.J=[],this.P=null}function hh(e){Qt.call(this,"languageCodeChanged"),this.h=e}function fh(e){Qt.call(this,"emulatorConfigChanged"),this.c=e}function dh(e){Qt.call(this,"frameworkChanged"),this.f=e}function ph(e){return e.Oa||It(new M("auth-domain-config-required"))}function mh(e){if(!Or())return It(new M("operation-not-supported-in-this-environment"));var t=ph(e).then((function(){return e.b.qa()})).then((function(e){return e?ei(e):null}));return Eh(e,t)}function vh(e,t){var n={};return n.apiKey=_h(e).options.apiKey,n.authDomain=_h(e).options.authDomain,n.appName=_h(e).name,e.P&&(n.emulatorConfig=e.P),e.$.then((function(){return function(e,t,n,r){var i=new Sc(e,t);return n&&(i.ha=n),r&&Mc(i,r),i.reload().then((function(){return i}))}(n,t,e.D,e.Ga())})).then((function(t){return bh(e)&&t.uid==bh(e).uid?(Vc(bh(e),t),e.da(t)):(yh(e,t),Oc(t),e.da(t))})).then((function(){wh(e)}))}function yh(e,t){bh(e)&&(function(e,t){J(e.S,(function(e){return e==t}))}(bh(e),e.Ba),pn(bh(e),"tokenChanged",e.ya),pn(bh(e),"userDeleted",e.za),pn(bh(e),"userInvalidated",e.Aa),Pc(bh(e))),t&&(t.S.push(e.Ba),hn(t,"tokenChanged",e.ya),hn(t,"userDeleted",e.za),hn(t,"userInvalidated",e.Aa),0<e.u&&Ic(t)),Qr(e,"currentUser",t),t&&(t.wa(e.la()),Tc(t,e),Mc(t,e.J),Cc(t,e),ls(t.a,e.P),kc(t,e))}function gh(e,t){var n=null,r=null;return Eh(e,t.then((function(t){return n=Ua(t),r=Qi(t),vh(e,t)}),(function(t){var n=null;throw t&&"auth/multi-factor-auth-required"===t.code&&(n=uc(t.w(),e,w(e.kc,e))),n||t})).then((function(){return ei({user:bh(e),credential:n,additionalUserInfo:r,operationType:"signIn"})})))}function _h(e){return e.app}function bh(e){return e.currentUser}function xh(e){return bh(e)&&bh(e)._lat||null}function wh(e){if(e.ba){for(var t=0;t<e.s.length;t++)e.s[t]&&e.s[t](xh(e));if(e.X!==e.getUid()&&e.O.length)for(e.X=e.getUid(),t=0;t<e.O.length;t++)e.O[t]&&e.O[t](xh(e))}}function Eh(e,t){return e.R.push(t),t.oa((function(){Y(e.R,t)})),t}function Sh(){}function Th(){this.a={},this.b=1e12}nh.prototype.xb=function(e){var t=null,n=this;return function(e){var t=new M("invalid-persistence-type"),n=new M("unsupported-persistence-type");e:{for(r in ru)if(ru[r]==e){var r=!0;break e}r=!1}if(!r||"string"!==typeof e)throw t;switch(Sr()){case"ReactNative":if("session"===e)throw n;break;case"Node":if("none"!==e)throw n;break;case"Worker":if("session"===e||!Nl()&&"none"!==e)throw n;break;default:if(!Lr()&&"none"!==e)throw n}}(e),uh(this,(function(){return e!=n.c.F?n.b.get(n.c,n.a).then((function(r){return t=r,rh(n,e)})).then((function(){if(n.c=ah(e),t)return n.b.set(n.c,t,n.a)})):At()}))},T(ch,En),T(hh,Qt),T(fh,Qt),T(dh,Qt),(n=ch.prototype).xb=function(e){return Eh(this,e=this.i.xb(e))},n.wa=function(e){this.aa===e||this.l||(this.aa=e,ss(this.a,this.aa),this.dispatchEvent(new hh(this.la())))},n.la=function(){return this.aa},n.fd=function(){var e=l.navigator;this.wa(e&&(e.languages&&e.languages[0]||e.language||e.userLanguage)||null)},n.gd=function(e,t){if(!this.P){if(!/^https?:\/\//.test(e))throw new M("argument-error","Emulator URL must start with a valid scheme (http:// or https://).");(function(e){"undefined"!==typeof console&&"function"===typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),l.document&&!e&&br().then((function(){var e=l.document.createElement("div");e.innerText="Running in emulator mode. Do not use with production credentials.",e.style.position="fixed",e.style.width="100%",e.style.backgroundColor="#ffffff",e.style.border=".1em solid #000000",e.style.color="#ff0000",e.style.bottom="0px",e.style.left="0px",e.style.margin="0px",e.style.zIndex=1e4,e.style.textAlign="center",e.classList.add("firebase-emulator-warning"),l.document.body.appendChild(e)}))})(t=!!t&&!!t.disableWarnings),this.P={url:e,ec:t},this.settings.ib=!0,ls(this.a,this.P),this.dispatchEvent(new fh(this.P))}},n.Gc=function(e){this.J.push(e),cs(this.a,t.a.SDK_VERSION?Ir(t.a.SDK_VERSION,this.J):null),this.dispatchEvent(new dh(this.J))},n.Ga=function(){return $(this.J)},n.yb=function(e){this.S===e||this.l||(this.S=e,this.a.b=this.S)},n.T=function(){return this.S},n.toJSON=function(){return{apiKey:_h(this).options.apiKey,authDomain:_h(this).options.authDomain,appName:_h(this).name,currentUser:bh(this)&&bh(this).w()}},n.Fb=function(e,t){switch(e){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==t&&!!this.f;default:return!1}},n.na=function(e,t,n,r){"signInViaPopup"==e&&this.g==r&&(n&&this.C?this.C(n):t&&!n&&this.f&&this.f(t),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.C)},n.Fa=function(e,t){return"signInViaRedirect"==e||"signInViaPopup"==e&&this.g==t&&this.f?w(this.ic,this):null},n.ic=function(e,t,n,r){var i=this,a={requestUri:e,postBody:r,sessionId:t,tenantId:n};return this.c&&(this.c.cancel(),this.c=null),i.$.then((function(){return gh(i,Ss(i.a,a))}))},n.Xc=function(e){if(!Or())return It(new M("operation-not-supported-in-this-environment"));var n=this,r=Ji(e.providerId),i=jr(),a=null;(!zr()||wr())&&_h(this).options.authDomain&&e.isOAuthProvider&&(a=wl(_h(this).options.authDomain,_h(this).options.apiKey,_h(this).name,"signInViaPopup",e,null,i,t.a.SDK_VERSION||null,null,null,this.T(),this.P));var o=yr(a,r&&r.ua,r&&r.ta);return Eh(this,r=ph(this).then((function(t){return Vu(t,o,"signInViaPopup",e,i,!!a,n.T())})).then((function(){return new wt((function(e,t){n.na("signInViaPopup",null,new M("cancelled-popup-request"),n.g),n.f=e,n.C=t,n.g=i,n.c=Wu(n.b,n,"signInViaPopup",o,i)}))})).then((function(e){return o&&vr(o),e?ei(e):null})).o((function(e){throw o&&vr(o),e})))},n.Yc=function(e){if(!Or())return It(new M("operation-not-supported-in-this-environment"));var t=this;return Eh(this,ph(this).then((function(){return function(e){return uh(e,(function(){return e.b.set(ih,e.c.F,e.a)}))}(t.i)})).then((function(){return Gu(t.b,"signInViaRedirect",e,void 0,t.T())})))},n.qa=function(){var e=this;return mh(this).then((function(t){return e.b&&Ju(e.b.b),t})).o((function(t){throw e.b&&Ju(e.b.b),t}))},n.dd=function(e){if(!e)return It(new M("null-user"));if(this.S!=e.tenantId)return It(new M("tenant-id-mismatch"));var t=this,n={};n.apiKey=_h(this).options.apiKey,n.authDomain=_h(this).options.authDomain,n.appName=_h(this).name;var r=function(e,t,n,r){var i=e.b,a={};return a[ns]=i.b&&i.b.toString(),a.refreshToken=i.a,t=new Sc(t||{apiKey:e.l,authDomain:e.s,appName:e.m},a),n&&(t.ha=n),r&&Mc(t,r),Vc(t,e),t}(e,n,t.D,t.Ga());return Eh(this,this.h.then((function(){if(_h(t).options.apiKey!=e.l)return r.reload()})).then((function(){return bh(t)&&e.uid==bh(t).uid?(Vc(bh(t),e),t.da(e)):(yh(t,r),Oc(r),t.da(r))})).then((function(){wh(t)})))},n.Ab=function(){var e=this;return Eh(this,this.h.then((function(){return e.b&&Ju(e.b.b),bh(e)?(yh(e,null),sh(e.i).then((function(){wh(e)}))):At()})))},n.Zc=function(){var e=this;return lh(this.i,_h(this).options.authDomain).then((function(t){if(!e.l){var n;if(n=bh(e)&&t){n=bh(e).uid;var r=t.uid;n=void 0!==n&&null!==n&&""!==n&&void 0!==r&&null!==r&&""!==r&&n==r}if(n)return Vc(bh(e),t),bh(e).I();(bh(e)||t)&&(yh(e,t),t&&(Oc(t),t.ha=e.D),e.b&&Fu(e.b,e),wh(e))}}))},n.da=function(e){return oh(this.i,e)},n.mc=function(){wh(this),this.da(bh(this))},n.wc=function(){this.Ab()},n.xc=function(){this.Ab()},n.kc=function(e){var t=this;return this.h.then((function(){return gh(t,At(e))}))},n.zc=function(e){var t=this;this.addAuthTokenListener((function(){e.next(bh(t))}))},n.Ac=function(e){var t=this;!function(e,t){e.O.push(t),Eh(e,e.h.then((function(){!e.l&&K(e.O,t)&&e.X!==e.getUid()&&(e.X=e.getUid(),t(xh(e)))})))}(this,(function(){e.next(bh(t))}))},n.Ic=function(e,t,n){var r=this;return this.ba&&Promise.resolve().then((function(){"function"===typeof e?e(bh(r)):"function"===typeof e.next&&e.next(bh(r))})),this.hb(e,t,n)},n.Hc=function(e,t,n){var r=this;return this.ba&&Promise.resolve().then((function(){r.X=r.getUid(),"function"===typeof e?e(bh(r)):"function"===typeof e.next&&e.next(bh(r))})),this.bc(e,t,n)},n.nc=function(e){var t=this;return Eh(this,this.h.then((function(){return bh(t)?bh(t).I(e).then((function(e){return{accessToken:e}})):null})))},n.Tc=function(e){var t=this;return this.h.then((function(){return gh(t,sl(t.a,tl,{token:e}))})).then((function(e){var n=e.user;return jc(n,"isAnonymous",!1),t.da(n),e}))},n.Uc=function(e,t){var n=this;return this.h.then((function(){return gh(n,sl(n.a,nl,{email:e,password:t}))}))},n.dc=function(e,t){var n=this;return this.h.then((function(){return gh(n,sl(n.a,Is,{email:e,password:t}))}))},n.$a=function(e){var t=this;return this.h.then((function(){return gh(t,e.ka(t.a))}))},n.Sc=function(e){return Yr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.$a(e)},n.zb=function(){var e=this;return this.h.then((function(){var t=bh(e);if(t&&t.isAnonymous){var n=ei({providerId:null,isNewUser:!1});return ei({user:t,credential:null,additionalUserInfo:n,operationType:"signIn"})}return gh(e,e.a.zb()).then((function(t){var n=t.user;return jc(n,"isAnonymous",!0),e.da(n),t}))}))},n.getUid=function(){return bh(this)&&bh(this).uid||null},n.cc=function(e){this.addAuthTokenListener(e),this.u++,0<this.u&&bh(this)&&Ic(bh(this))},n.Pc=function(e){var t=this;W(this.s,(function(n){n==e&&t.u--})),0>this.u&&(this.u=0),0==this.u&&bh(this)&&Pc(bh(this)),this.removeAuthTokenListener(e)},n.addAuthTokenListener=function(e){var t=this;this.s.push(e),Eh(this,this.h.then((function(){t.l||K(t.s,e)&&e(xh(t))})))},n.removeAuthTokenListener=function(e){J(this.s,(function(t){return t==e}))},n.delete=function(){this.l=!0;for(var e=0;e<this.R.length;e++)this.R[e].cancel("app-deleted");return this.R=[],this.i&&(e=this.i).b.removeListener(ah("local"),e.a,this.ja),this.b&&(Bu(this.b,this),Ju(this.b.b)),Promise.resolve()},n.hc=function(e){return Eh(this,function(e,t){return sl(e,Ps,{identifier:t,continueUri:Dr()?fr():"http://localhost"}).then((function(e){return e.signinMethods||[]}))}(this.a,e))},n.Bc=function(e){return!!Oa(e)},n.wb=function(e,t){var n=this;return Eh(this,At().then((function(){var e=new Ri(t);if(!e.c)throw new M("argument-error",Di+" must be true when sending sign in link to email");return Vi(e)})).then((function(t){return n.a.wb(e,t)})).then((function(){})))},n.jd=function(e){return this.Ra(e).then((function(e){return e.data.email}))},n.nb=function(e,t){return Eh(this,this.a.nb(e,t).then((function(){})))},n.Ra=function(e){return Eh(this,this.a.Ra(e).then((function(e){return new ui(e)})))},n.jb=function(e){return Eh(this,this.a.jb(e).then((function(){})))},n.vb=function(e,t){var n=this;return Eh(this,At().then((function(){return"undefined"===typeof t||me(t)?{}:Vi(new Ri(t))})).then((function(t){return n.a.vb(e,t)})).then((function(){})))},n.Wc=function(e,t){return Eh(this,rc(this,e,t,w(this.$a,this)))},n.Vc=function(e,t){var n=this;return Eh(this,At().then((function(){var r=t||fr(),i=La(e,r);if(!(r=Oa(r)))throw new M("argument-error","Invalid email link!");if(r.tenantId!==n.T())throw new M("tenant-id-mismatch");return n.$a(i)})))},Sh.prototype.render=function(){},Sh.prototype.reset=function(){},Sh.prototype.getResponse=function(){},Sh.prototype.execute=function(){};var kh=null;function Mh(e,t){return(t=Ch(t))&&e.a[t]||null}function Ch(e){return(e="undefined"===typeof e?1e12:e)?e.toString():null}function Ah(e,t){this.g=!1,this.c=t,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=ct(e);var n=this;this.i=function(){n.execute()},this.h?this.execute():hn(this.f,"click",this.i)}function Ih(e){if(e.g)throw Error("reCAPTCHA mock was already deleted!")}function Ph(){}function Rh(){}Th.prototype.render=function(e,t){return this.a[this.b.toString()]=new Ah(e,t),this.b++},Th.prototype.reset=function(e){var t=Mh(this,e);e=Ch(e),t&&e&&(t.delete(),delete this.a[e])},Th.prototype.getResponse=function(e){return(e=Mh(this,e))?e.getResponse():null},Th.prototype.execute=function(e){(e=Mh(this,e))&&e.execute()},Ah.prototype.getResponse=function(){return Ih(this),this.b},Ah.prototype.execute=function(){Ih(this);var e=this;this.a||(this.a=setTimeout((function(){e.b=function(){for(var e=50,t=[];0<e;)t.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),e--;return t.join("")}();var t=e.c.callback,n=e.c["expired-callback"];if(t)try{t(e.b)}catch(r){}e.a=setTimeout((function(){if(e.a=null,e.b=null,n)try{n()}catch(r){}e.h&&e.execute()}),6e4)}),500))},Ah.prototype.delete=function(){Ih(this),this.g=!0,clearTimeout(this.a),this.a=null,pn(this.f,"click",this.i)},Qr(Ph,"FACTOR_ID","phone"),Rh.prototype.g=function(){return kh||(kh=new Th),At(kh)},Rh.prototype.c=function(){};var Lh=null;function Oh(){this.b=l.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var Dh=new be(Se,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),Nh=new Gr(3e4,6e4);Oh.prototype.g=function(e){var t=this;return new wt((function(n,r){var i=setTimeout((function(){r(new M("network-request-failed"))}),Nh.get());!l.grecaptcha||e!==t.f&&!t.b?(l[t.a]=function(){if(l.grecaptcha){t.f=e;var a=l.grecaptcha.render;l.grecaptcha.render=function(e,n){return e=a(e,n),t.b++,e},clearTimeout(i),n(l.grecaptcha)}else clearTimeout(i),r(new M("internal-error"));delete l[t.a]},At(Xo(Ce(Dh,{onload:t.a,hl:e||""}))).o((function(){clearTimeout(i),r(new M("internal-error","Unable to load external reCAPTCHA dependencies!"))}))):(clearTimeout(i),n(l.grecaptcha))}))},Oh.prototype.c=function(){this.b--};var zh=null;function Fh(e,t,n,r,i,a,o){if(Qr(this,"type","recaptcha"),this.c=this.f=null,this.D=!1,this.v=t,this.g=null,o?(Lh||(Lh=new Rh),o=Lh):(zh||(zh=new Oh),o=zh),this.m=o,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[jh])throw new M("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[Vh],!l.document)throw new M("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!ct(t)||!this.i&&ct(t).hasChildNodes())throw new M("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.s=new es(e,a||null,i||null),this.u=r||function(){return null};var s=this;this.l=[];var u=this.a[Bh];this.a[Bh]=function(e){if(Hh(s,e),"function"===typeof u)u(e);else if("string"===typeof u){var t=Rr(u,l);"function"===typeof t&&t(e)}};var c=this.a[Uh];this.a[Uh]=function(){if(Hh(s,null),"function"===typeof c)c();else if("string"===typeof c){var e=Rr(c,l);"function"===typeof e&&e()}}}var Bh="callback",Uh="expired-callback",jh="sitekey",Vh="size";function Hh(e,t){for(var n=0;n<e.l.length;n++)try{e.l[n](t)}catch(r){}}function Gh(e,t){return e.h.push(t),t.oa((function(){Y(e.h,t)})),t}function Wh(e){if(e.D)throw new M("internal-error","RecaptchaVerifier instance has been destroyed.")}function qh(e,n,r){var i=!1;try{this.b=r||t.a.app()}catch(s){throw new M("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new M("invalid-api-key");r=this.b.options.apiKey;var a=this,o=null;try{o=this.b.auth().Ga()}catch(s){}try{i=this.b.auth().settings.appVerificationDisabledForTesting}catch(s){}o=t.a.SDK_VERSION?Ir(t.a.SDK_VERSION,o):null,Fh.call(this,r,e,n,(function(){try{var e=a.b.auth().la()}catch(t){e=null}return e}),o,L(A),i)}function Xh(e,t,n,r){e:{n=Array.prototype.slice.call(n);for(var i=0,a=!1,o=0;o<t.length;o++)if(t[o].optional)a=!0;else{if(a)throw new M("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(a=t.length,n.length<i||a<n.length)r="Expected "+(i==a?1==i?"1 argument":i+" arguments":i+"-"+a+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(a=t[i].optional&&void 0===n[i],!t[i].M(n[i])&&!a){if(t=t[i],0>i||i>=Zh.length)throw new M("internal-error","Argument validator received an unsupported number of arguments.");n=Zh[i],r=(r?"":n+" argument ")+(t.name?'"'+t.name+'" ':"")+"must be "+t.K+".";break e}r=null}}if(r)throw new M("argument-error",e+" failed: "+r)}(n=Fh.prototype).Ia=function(){var e=this;return this.f?this.f:this.f=Gh(this,At().then((function(){if(Dr()&&!Er())return br();throw new M("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")})).then((function(){return e.m.g(e.u())})).then((function(t){return e.g=t,sl(e.s,Gs,{})})).then((function(t){e.a[jh]=t.recaptchaSiteKey})).o((function(t){throw e.f=null,t})))},n.render=function(){Wh(this);var e=this;return Gh(this,this.Ia().then((function(){if(null===e.c){var t=e.v;if(!e.i){var n=ct(t);t=function(e,t,n){var r=arguments,i=document,a=String(r[0]),o=r[1];if(!ut&&o&&(o.name||o.type)){if(a=["<",a],o.name&&a.push(' name="',We(o.name),'"'),o.type){a.push(' type="',We(o.type),'"');var s={};ge(s,o),delete s.type,o=s}a.push(">"),a=a.join("")}return a=vt(i,a),o&&("string"===typeof o?a.className=o:Array.isArray(o)?a.className=o.join(" "):ht(a,o)),2<r.length&&mt(i,a,r),a}("DIV"),n.appendChild(t)}e.c=e.g.render(t,e.a)}return e.c})))},n.verify=function(){Wh(this);var e=this;return Gh(this,this.render().then((function(t){return new wt((function(n){var r=e.g.getResponse(t);if(r)n(r);else{e.l.push((function t(r){r&&(function(e,t){J(e.l,(function(e){return e==t}))}(e,t),n(r))})),e.i&&e.g.execute(e.c)}}))})))},n.reset=function(){Wh(this),null!==this.c&&this.g.reset(this.c)},n.clear=function(){Wh(this),this.D=!0,this.m.c();for(var e=0;e<this.h.length;e++)this.h[e].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){e=ct(this.v);for(var t;t=e.firstChild;)e.removeChild(t)}},T(qh,Fh);var Zh="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function Kh(e,t){return{name:e||"",K:"a valid string",optional:!!t,M:function(e){return"string"===typeof e}}}function Yh(e,t){return{name:e||"",K:"a boolean",optional:!!t,M:function(e){return"boolean"===typeof e}}}function Jh(e,t){return{name:e||"",K:"a valid object",optional:!!t,M:v}}function Qh(e,t){return{name:e||"",K:"a function",optional:!!t,M:function(e){return"function"===typeof e}}}function $h(e,t){return{name:e||"",K:"null",optional:!!t,M:function(e){return null===e}}}function ef(e){return{name:e?e+"Credential":"credential",K:e?"a valid "+e+" credential":"a valid credential",optional:!1,M:function(t){if(!t)return!1;var n=!e||t.providerId===e;return!(!t.ka||!n)}}}function tf(e,t){return v(e)&&"string"===typeof e.type&&e.type===t&&"function"===typeof e.Ha}function nf(e){return v(e)&&"string"===typeof e.uid}function rf(e,t,n,r){return{name:n||"",K:e.K+" or "+t.K,optional:!!r,M:function(n){return e.M(n)||t.M(n)}}}function af(e,t){for(var n in t){var r=t[n].name;e[r]=lf(r,e[n],t[n].j)}}function of(e,t){for(var n in t){var r=t[n].name;r!==n&&Object.defineProperty(e,r,{get:E((function(e){return this[e]}),n),set:E((function(e,t,n,r){Xh(e,[n],[r],!0),this[t]=r}),r,n,t[n].kb),enumerable:!0})}}function sf(e,t,n,r){e[t]=lf(t,n,r)}function lf(e,t,n){function r(){var e=Array.prototype.slice.call(arguments);return Xh(a,n,e),t.apply(this,e)}if(!n)return t;var i,a=function(e){return(e=e.split("."))[e.length-1]}(e);for(i in t)r[i]=t[i];for(i in t.prototype)r.prototype[i]=t.prototype[i];return r}af(ch.prototype,{jb:{name:"applyActionCode",j:[Kh("code")]},Ra:{name:"checkActionCode",j:[Kh("code")]},nb:{name:"confirmPasswordReset",j:[Kh("code"),Kh("newPassword")]},dc:{name:"createUserWithEmailAndPassword",j:[Kh("email"),Kh("password")]},hc:{name:"fetchSignInMethodsForEmail",j:[Kh("email")]},qa:{name:"getRedirectResult",j:[]},Bc:{name:"isSignInWithEmailLink",j:[Kh("emailLink")]},Hc:{name:"onAuthStateChanged",j:[rf(Jh(),Qh(),"nextOrObserver"),Qh("opt_error",!0),Qh("opt_completed",!0)]},Ic:{name:"onIdTokenChanged",j:[rf(Jh(),Qh(),"nextOrObserver"),Qh("opt_error",!0),Qh("opt_completed",!0)]},vb:{name:"sendPasswordResetEmail",j:[Kh("email"),rf(Jh("opt_actionCodeSettings",!0),$h(null,!0),"opt_actionCodeSettings",!0)]},wb:{name:"sendSignInLinkToEmail",j:[Kh("email"),Jh("actionCodeSettings")]},xb:{name:"setPersistence",j:[Kh("persistence")]},Sc:{name:"signInAndRetrieveDataWithCredential",j:[ef()]},zb:{name:"signInAnonymously",j:[]},$a:{name:"signInWithCredential",j:[ef()]},Tc:{name:"signInWithCustomToken",j:[Kh("token")]},Uc:{name:"signInWithEmailAndPassword",j:[Kh("email"),Kh("password")]},Vc:{name:"signInWithEmailLink",j:[Kh("email"),Kh("emailLink",!0)]},Wc:{name:"signInWithPhoneNumber",j:[Kh("phoneNumber"),{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(e){return!(!e||"string"!==typeof e.type||"function"!==typeof e.verify)}}]},Xc:{name:"signInWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(e){return!!(e&&e.providerId&&e.hasOwnProperty&&e.hasOwnProperty("isOAuthProvider"))}}]},Yc:{name:"signInWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(e){return!!(e&&e.providerId&&e.hasOwnProperty&&e.hasOwnProperty("isOAuthProvider"))}}]},dd:{name:"updateCurrentUser",j:[rf({name:"user",K:"an instance of Firebase User",optional:!1,M:function(e){return!!(e&&e instanceof Sc)}},$h(),"user")]},Ab:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[Kh(null,!0)]},fd:{name:"useDeviceLanguage",j:[]},gd:{name:"useEmulator",j:[Kh("url"),Jh("options",!0)]},jd:{name:"verifyPasswordResetCode",j:[Kh("code")]}}),of(ch.prototype,{lc:{name:"languageCode",kb:rf(Kh(),$h(),"languageCode")},ti:{name:"tenantId",kb:rf(Kh(),$h(),"tenantId")}}),ch.Persistence=ru,ch.Persistence.LOCAL="local",ch.Persistence.SESSION="session",ch.Persistence.NONE="none",af(Sc.prototype,{delete:{name:"delete",j:[]},oc:{name:"getIdTokenResult",j:[Yh("opt_forceRefresh",!0)]},I:{name:"getIdToken",j:[Yh("opt_forceRefresh",!0)]},Cc:{name:"linkAndRetrieveDataWithCredential",j:[ef()]},qb:{name:"linkWithCredential",j:[ef()]},Dc:{name:"linkWithPhoneNumber",j:[Kh("phoneNumber"),{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(e){return!(!e||"string"!==typeof e.type||"function"!==typeof e.verify)}}]},Ec:{name:"linkWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(e){return!!(e&&e.providerId&&e.hasOwnProperty&&e.hasOwnProperty("isOAuthProvider"))}}]},Fc:{name:"linkWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(e){return!!(e&&e.providerId&&e.hasOwnProperty&&e.hasOwnProperty("isOAuthProvider"))}}]},Lc:{name:"reauthenticateAndRetrieveDataWithCredential",j:[ef()]},tb:{name:"reauthenticateWithCredential",j:[ef()]},Mc:{name:"reauthenticateWithPhoneNumber",j:[Kh("phoneNumber"),{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(e){return!(!e||"string"!==typeof e.type||"function"!==typeof e.verify)}}]},Nc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(e){return!!(e&&e.providerId&&e.hasOwnProperty&&e.hasOwnProperty("isOAuthProvider"))}}]},Oc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",K:"a valid Auth provider",optional:!1,M:function(e){return!!(e&&e.providerId&&e.hasOwnProperty&&e.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},ub:{name:"sendEmailVerification",j:[rf(Jh("opt_actionCodeSettings",!0),$h(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[Kh(null,!0)]},cd:{name:"unlink",j:[Kh("provider")]},Bb:{name:"updateEmail",j:[Kh("email")]},Cb:{name:"updatePassword",j:[Kh("password")]},ed:{name:"updatePhoneNumber",j:[ef("phone")]},Db:{name:"updateProfile",j:[Jh("profile")]},Eb:{name:"verifyBeforeUpdateEmail",j:[Kh("email"),rf(Jh("opt_actionCodeSettings",!0),$h(null,!0),"opt_actionCodeSettings",!0)]}}),af(Th.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),af(Sh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),af(wt.prototype,{oa:{name:"finally"},o:{name:"catch"},then:{name:"then"}}),of(tc.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",kb:Yh("appVerificationDisabledForTesting")}}),af(nc.prototype,{confirm:{name:"confirm",j:[Kh("verificationCode")]}}),sf(ha,"fromJSON",(function(e){e="string"===typeof e?JSON.parse(e):e;for(var t,n=[ga,Pa,Na,ma],r=0;r<n.length;r++)if(t=n[r](e))return t;return null}),[rf(Kh(),Jh(),"json")]),sf(Ra,"credential",(function(e,t){return new Ia(e,t)}),[Kh("email"),Kh("password")]),af(Ia.prototype,{w:{name:"toJSON",j:[Kh(null,!0)]}}),af(wa.prototype,{Ca:{name:"addScope",j:[Kh("scope")]},Ka:{name:"setCustomParameters",j:[Jh("customOAuthParameters")]}}),sf(wa,"credential",Ea,[rf(Kh(),Jh(),"token")]),sf(Ra,"credentialWithLink",La,[Kh("email"),Kh("emailLink")]),af(Sa.prototype,{Ca:{name:"addScope",j:[Kh("scope")]},Ka:{name:"setCustomParameters",j:[Jh("customOAuthParameters")]}}),sf(Sa,"credential",Ta,[rf(Kh(),Jh(),"token")]),af(ka.prototype,{Ca:{name:"addScope",j:[Kh("scope")]},Ka:{name:"setCustomParameters",j:[Jh("customOAuthParameters")]}}),sf(ka,"credential",Ma,[rf(Kh(),rf(Jh(),$h()),"idToken"),rf(Kh(),$h(),"accessToken",!0)]),af(Ca.prototype,{Ka:{name:"setCustomParameters",j:[Jh("customOAuthParameters")]}}),sf(Ca,"credential",Aa,[rf(Kh(),Jh(),"token"),Kh("secret",!0)]),af(xa.prototype,{Ca:{name:"addScope",j:[Kh("scope")]},credential:{name:"credential",j:[rf(Kh(),rf(Jh(),$h()),"optionsOrIdToken"),rf(Kh(),$h(),"accessToken",!0)]},Ka:{name:"setCustomParameters",j:[Jh("customOAuthParameters")]}}),af(va.prototype,{w:{name:"toJSON",j:[Kh(null,!0)]}}),af(da.prototype,{w:{name:"toJSON",j:[Kh(null,!0)]}}),sf(Fa,"credential",Ba,[Kh("verificationId"),Kh("verificationCode")]),af(Fa.prototype,{fb:{name:"verifyPhoneNumber",j:[rf(Kh(),{name:"phoneInfoOptions",K:"valid phone info options",optional:!1,M:function(e){return!!e&&(e.session&&e.phoneNumber?tf(e.session,ua)&&"string"===typeof e.phoneNumber:e.session&&e.multiFactorHint?tf(e.session,ca)&&nf(e.multiFactorHint):e.session&&e.multiFactorUid?tf(e.session,ca)&&"string"===typeof e.multiFactorUid:!!e.phoneNumber&&"string"===typeof e.phoneNumber)}},"phoneInfoOptions"),{name:"applicationVerifier",K:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,M:function(e){return!(!e||"string"!==typeof e.type||"function"!==typeof e.verify)}}]}}),af(Da.prototype,{w:{name:"toJSON",j:[Kh(null,!0)]}}),af(M.prototype,{toJSON:{name:"toJSON",j:[Kh(null,!0)]}}),af(Za.prototype,{toJSON:{name:"toJSON",j:[Kh(null,!0)]}}),af(Xa.prototype,{toJSON:{name:"toJSON",j:[Kh(null,!0)]}}),af(lc.prototype,{toJSON:{name:"toJSON",j:[Kh(null,!0)]}}),af(ac.prototype,{Rc:{name:"resolveSignIn",j:[{name:"multiFactorAssertion",K:"a valid multiFactorAssertion",optional:!1,M:function(e){return!!e&&!!e.sb}}]}}),af(pc.prototype,{Rb:{name:"getSession",j:[]},fc:{name:"enroll",j:[{name:"multiFactorAssertion",K:"a valid multiFactorAssertion",optional:!1,M:function(e){return!!e&&!!e.sb}},Kh("displayName",!0)]},bd:{name:"unenroll",j:[rf({name:"multiFactorInfo",K:"a valid multiFactorInfo",optional:!1,M:nf},Kh(),"multiFactorInfoIdentifier")]}}),af(qh.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),sf(Ei,"parseLink",Pi,[Kh("link")]),sf(Ph,"assertion",(function(e){return new fc(e)}),[ef("phone")]),function(){if("undefined"===typeof t.a||!t.a.INTERNAL||!t.a.INTERNAL.registerComponent)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var e={ActionCodeInfo:{Operation:{EMAIL_SIGNIN:hi,PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",REVERT_SECOND_FACTOR_ADDITION:ci,VERIFY_AND_CHANGE_EMAIL:fi,VERIFY_EMAIL:"VERIFY_EMAIL"}},Auth:ch,AuthCredential:ha,Error:M};sf(e,"EmailAuthProvider",Ra,[]),sf(e,"FacebookAuthProvider",wa,[]),sf(e,"GithubAuthProvider",Sa,[]),sf(e,"GoogleAuthProvider",ka,[]),sf(e,"TwitterAuthProvider",Ca,[]),sf(e,"OAuthProvider",xa,[Kh("providerId")]),sf(e,"SAMLAuthProvider",ba,[Kh("providerId")]),sf(e,"PhoneAuthProvider",Fa,[{name:"auth",K:"an instance of Firebase Auth",optional:!0,M:function(e){return!!(e&&e instanceof ch)}}]),sf(e,"RecaptchaVerifier",qh,[rf(Kh(),{name:"",K:"an HTML element",optional:!1,M:function(e){return!!(e&&e instanceof Element)}},"recaptchaContainer"),Jh("recaptchaParameters",!0),{name:"app",K:"an instance of Firebase App",optional:!0,M:function(e){return!!(e&&e instanceof t.a.app.App)}}]),sf(e,"ActionCodeURL",Ei,[]),sf(e,"PhoneMultiFactorGenerator",Ph,[]),t.a.INTERNAL.registerComponent({name:"auth",instanceFactory:function(e){return new ch(e=e.getProvider("app").getImmediate())},multipleInstances:!1,serviceProps:e,instantiationMode:"LAZY",type:"PUBLIC"}),t.a.INTERNAL.registerComponent({name:"auth-internal",instanceFactory:function(e){return{getUid:w((e=e.getProvider("auth").getImmediate()).getUid,e),getToken:w(e.nc,e),addAuthTokenListener:w(e.cc,e),removeAuthTokenListener:w(e.Pc,e)}},multipleInstances:!1,instantiationMode:"LAZY",type:"PRIVATE"}),t.a.registerVersion("@firebase/auth","0.16.2"),t.a.INTERNAL.extendNamespace({User:Sc})}()}).apply("undefined"!==typeof e?e:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})}).call(this,n(49))},function(e,t){!function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n={rotl:function(e,t){return e<<t|e>>>32-t},rotr:function(e,t){return e<<32-t|e>>>t},endian:function(e){if(e.constructor==Number)return 16711935&n.rotl(e,8)|4278255360&n.rotl(e,24);for(var t=0;t<e.length;t++)e[t]=n.endian(e[t]);return e},randomBytes:function(e){for(var t=[];e>0;e--)t.push(Math.floor(256*Math.random()));return t},bytesToWords:function(e){for(var t=[],n=0,r=0;n<e.length;n++,r+=8)t[r>>>5]|=e[n]<<24-r%32;return t},wordsToBytes:function(e){for(var t=[],n=0;n<32*e.length;n+=8)t.push(e[n>>>5]>>>24-n%32&255);return t},bytesToHex:function(e){for(var t=[],n=0;n<e.length;n++)t.push((e[n]>>>4).toString(16)),t.push((15&e[n]).toString(16));return t.join("")},hexToBytes:function(e){for(var t=[],n=0;n<e.length;n+=2)t.push(parseInt(e.substr(n,2),16));return t},bytesToBase64:function(e){for(var n=[],r=0;r<e.length;r+=3)for(var i=e[r]<<16|e[r+1]<<8|e[r+2],a=0;a<4;a++)8*r+6*a<=8*e.length?n.push(t.charAt(i>>>6*(3-a)&63)):n.push("=");return n.join("")},base64ToBytes:function(e){e=e.replace(/[^A-Z0-9+\/]/gi,"");for(var n=[],r=0,i=0;r<e.length;i=++r%4)0!=i&&n.push((t.indexOf(e.charAt(r-1))&Math.pow(2,-2*i+8)-1)<<2*i|t.indexOf(e.charAt(r))>>>6-2*i);return n}};e.exports=n}()},function(e,t){function n(e){return!!e.constructor&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(n(e)||function(e){return"function"===typeof e.readFloatLE&&"function"===typeof e.slice&&n(e.slice(0,0))}(e)||!!e._isBuffer)}},function(e,t,n){"use strict";var r=n(97);function i(){}function a(){}a.resetWarningCache=i,e.exports=function(){function e(e,t,n,i,a,o){if(o!==r){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:i};return n.PropTypes=n,n}},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,n){"use strict";var r="function"===typeof Symbol&&Symbol.for,i=r?Symbol.for("react.element"):60103,a=r?Symbol.for("react.portal"):60106,o=r?Symbol.for("react.fragment"):60107,s=r?Symbol.for("react.strict_mode"):60108,l=r?Symbol.for("react.profiler"):60114,u=r?Symbol.for("react.provider"):60109,c=r?Symbol.for("react.context"):60110,h=r?Symbol.for("react.async_mode"):60111,f=r?Symbol.for("react.concurrent_mode"):60111,d=r?Symbol.for("react.forward_ref"):60112,p=r?Symbol.for("react.suspense"):60113,m=r?Symbol.for("react.suspense_list"):60120,v=r?Symbol.for("react.memo"):60115,y=r?Symbol.for("react.lazy"):60116,g=r?Symbol.for("react.block"):60121,_=r?Symbol.for("react.fundamental"):60117,b=r?Symbol.for("react.responder"):60118,x=r?Symbol.for("react.scope"):60119;function w(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case h:case f:case o:case l:case s:case p:return e;default:switch(e=e&&e.$$typeof){case c:case d:case y:case v:case u:return e;default:return t}}case a:return t}}}function E(e){return w(e)===f}t.AsyncMode=h,t.ConcurrentMode=f,t.ContextConsumer=c,t.ContextProvider=u,t.Element=i,t.ForwardRef=d,t.Fragment=o,t.Lazy=y,t.Memo=v,t.Portal=a,t.Profiler=l,t.StrictMode=s,t.Suspense=p,t.isAsyncMode=function(e){return E(e)||w(e)===h},t.isConcurrentMode=E,t.isContextConsumer=function(e){return w(e)===c},t.isContextProvider=function(e){return w(e)===u},t.isElement=function(e){return"object"===typeof e&&null!==e&&e.$$typeof===i},t.isForwardRef=function(e){return w(e)===d},t.isFragment=function(e){return w(e)===o},t.isLazy=function(e){return w(e)===y},t.isMemo=function(e){return w(e)===v},t.isPortal=function(e){return w(e)===a},t.isProfiler=function(e){return w(e)===l},t.isStrictMode=function(e){return w(e)===s},t.isSuspense=function(e){return w(e)===p},t.isValidElementType=function(e){return"string"===typeof e||"function"===typeof e||e===o||e===f||e===l||e===s||e===p||e===m||"object"===typeof e&&null!==e&&(e.$$typeof===y||e.$$typeof===v||e.$$typeof===u||e.$$typeof===c||e.$$typeof===d||e.$$typeof===_||e.$$typeof===b||e.$$typeof===x||e.$$typeof===g)},t.typeOf=w},,function(e,t,n){"use strict";n.d(t,"a",(function(){return vn}));var r=n(8),i=n(3),a=n(1),o=n.n(a),s="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l="object"===("undefined"===typeof window?"undefined":s(window))&&"object"===("undefined"===typeof document?"undefined":s(document))&&9===document.nodeType;function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function c(e,t,n){return t&&u(e.prototype,t),n&&u(e,n),e}var h=n(27),f=n(28),d=n(22),p={}.constructor;function m(e){if(null==e||"object"!==typeof e)return e;if(Array.isArray(e))return e.map(m);if(e.constructor!==p)return e;var t={};for(var n in e)t[n]=m(e[n]);return t}function v(e,t,n){void 0===e&&(e="unnamed");var r=n.jss,i=m(t),a=r.plugins.onCreateRule(e,i,n);return a||(e[0],null)}var y=function(e,t){for(var n="",r=0;r<e.length&&"!important"!==e[r];r++)n&&(n+=t),n+=e[r];return n},g=function(e,t){if(void 0===t&&(t=!1),!Array.isArray(e))return e;var n="";if(Array.isArray(e[0]))for(var r=0;r<e.length&&"!important"!==e[r];r++)n&&(n+=", "),n+=y(e[r]," ");else n=y(e,", ");return t||"!important"!==e[e.length-1]||(n+=" !important"),n};function _(e,t){for(var n="",r=0;r<t;r++)n+="  ";return n+e}function b(e,t,n){void 0===n&&(n={});var r="";if(!t)return r;var i=n.indent,a=void 0===i?0:i,o=t.fallbacks;if(e&&a++,o)if(Array.isArray(o))for(var s=0;s<o.length;s++){var l=o[s];for(var u in l){var c=l[u];null!=c&&(r&&(r+="\n"),r+=""+_(u+": "+g(c)+";",a))}}else for(var h in o){var f=o[h];null!=f&&(r&&(r+="\n"),r+=""+_(h+": "+g(f)+";",a))}for(var d in t){var p=t[d];null!=p&&"fallbacks"!==d&&(r&&(r+="\n"),r+=""+_(d+": "+g(p)+";",a))}return(r||n.allowEmpty)&&e?(r&&(r="\n"+r+"\n"),_(e+" {"+r,--a)+_("}",a)):r}var x=/([[\].#*$><+~=|^:(),"'`\s])/g,w="undefined"!==typeof CSS&&CSS.escape,E=function(e){return w?w(e):e.replace(x,"\\$1")},S=function(){function e(e,t,n){this.type="style",this.key=void 0,this.isProcessed=!1,this.style=void 0,this.renderer=void 0,this.renderable=void 0,this.options=void 0;var r=n.sheet,i=n.Renderer;this.key=e,this.options=n,this.style=t,r?this.renderer=r.renderer:i&&(this.renderer=new i)}return e.prototype.prop=function(e,t,n){if(void 0===t)return this.style[e];var r=!!n&&n.force;if(!r&&this.style[e]===t)return this;var i=t;n&&!1===n.process||(i=this.options.jss.plugins.onChangeValue(t,e,this));var a=null==i||!1===i,o=e in this.style;if(a&&!o&&!r)return this;var s=a&&o;if(s?delete this.style[e]:this.style[e]=i,this.renderable&&this.renderer)return s?this.renderer.removeProperty(this.renderable,e):this.renderer.setProperty(this.renderable,e,i),this;var l=this.options.sheet;return l&&l.attached,this},e}(),T=function(e){function t(t,n,r){var i;(i=e.call(this,t,n,r)||this).selectorText=void 0,i.id=void 0,i.renderable=void 0;var a=r.selector,o=r.scoped,s=r.sheet,l=r.generateId;return a?i.selectorText=a:!1!==o&&(i.id=l(Object(f.a)(Object(f.a)(i)),s),i.selectorText="."+E(i.id)),i}Object(h.a)(t,e);var n=t.prototype;return n.applyTo=function(e){var t=this.renderer;if(t){var n=this.toJSON();for(var r in n)t.setProperty(e,r,n[r])}return this},n.toJSON=function(){var e={};for(var t in this.style){var n=this.style[t];"object"!==typeof n?e[t]=n:Array.isArray(n)&&(e[t]=g(n))}return e},n.toString=function(e){var t=this.options.sheet,n=!!t&&t.options.link?Object(i.a)({},e,{allowEmpty:!0}):e;return b(this.selectorText,this.style,n)},c(t,[{key:"selector",set:function(e){if(e!==this.selectorText){this.selectorText=e;var t=this.renderer,n=this.renderable;if(n&&t)t.setSelector(n,e)||t.replaceRule(n,this)}},get:function(){return this.selectorText}}]),t}(S),k={onCreateRule:function(e,t,n){return"@"===e[0]||n.parent&&"keyframes"===n.parent.type?null:new T(e,t,n)}},M={indent:1,children:!0},C=/@([\w-]+)/,A=function(){function e(e,t,n){this.type="conditional",this.at=void 0,this.key=void 0,this.query=void 0,this.rules=void 0,this.options=void 0,this.isProcessed=!1,this.renderable=void 0,this.key=e;var r=e.match(C);for(var a in this.at=r?r[1]:"unknown",this.query=n.name||"@"+this.at,this.options=n,this.rules=new Q(Object(i.a)({},n,{parent:this})),t)this.rules.add(a,t[a]);this.rules.process()}var t=e.prototype;return t.getRule=function(e){return this.rules.get(e)},t.indexOf=function(e){return this.rules.indexOf(e)},t.addRule=function(e,t,n){var r=this.rules.add(e,t,n);return r?(this.options.jss.plugins.onProcessRule(r),r):null},t.toString=function(e){if(void 0===e&&(e=M),null==e.indent&&(e.indent=M.indent),null==e.children&&(e.children=M.children),!1===e.children)return this.query+" {}";var t=this.rules.toString(e);return t?this.query+" {\n"+t+"\n}":""},e}(),I=/@media|@supports\s+/,P={onCreateRule:function(e,t,n){return I.test(e)?new A(e,t,n):null}},R={indent:1,children:!0},L=/@keyframes\s+([\w-]+)/,O=function(){function e(e,t,n){this.type="keyframes",this.at="@keyframes",this.key=void 0,this.name=void 0,this.id=void 0,this.rules=void 0,this.options=void 0,this.isProcessed=!1,this.renderable=void 0;var r=e.match(L);r&&r[1]?this.name=r[1]:this.name="noname",this.key=this.type+"-"+this.name,this.options=n;var a=n.scoped,o=n.sheet,s=n.generateId;for(var l in this.id=!1===a?this.name:E(s(this,o)),this.rules=new Q(Object(i.a)({},n,{parent:this})),t)this.rules.add(l,t[l],Object(i.a)({},n,{parent:this}));this.rules.process()}return e.prototype.toString=function(e){if(void 0===e&&(e=R),null==e.indent&&(e.indent=R.indent),null==e.children&&(e.children=R.children),!1===e.children)return this.at+" "+this.id+" {}";var t=this.rules.toString(e);return t&&(t="\n"+t+"\n"),this.at+" "+this.id+" {"+t+"}"},e}(),D=/@keyframes\s+/,N=/\$([\w-]+)/g,z=function(e,t){return"string"===typeof e?e.replace(N,(function(e,n){return n in t?t[n]:e})):e},F=function(e,t,n){var r=e[t],i=z(r,n);i!==r&&(e[t]=i)},B={onCreateRule:function(e,t,n){return"string"===typeof e&&D.test(e)?new O(e,t,n):null},onProcessStyle:function(e,t,n){return"style"===t.type&&n?("animation-name"in e&&F(e,"animation-name",n.keyframes),"animation"in e&&F(e,"animation",n.keyframes),e):e},onChangeValue:function(e,t,n){var r=n.options.sheet;if(!r)return e;switch(t){case"animation":case"animation-name":return z(e,r.keyframes);default:return e}}},U=function(e){function t(){for(var t,n=arguments.length,r=new Array(n),i=0;i<n;i++)r[i]=arguments[i];return(t=e.call.apply(e,[this].concat(r))||this).renderable=void 0,t}return Object(h.a)(t,e),t.prototype.toString=function(e){var t=this.options.sheet,n=!!t&&t.options.link?Object(i.a)({},e,{allowEmpty:!0}):e;return b(this.key,this.style,n)},t}(S),j={onCreateRule:function(e,t,n){return n.parent&&"keyframes"===n.parent.type?new U(e,t,n):null}},V=function(){function e(e,t,n){this.type="font-face",this.at="@font-face",this.key=void 0,this.style=void 0,this.options=void 0,this.isProcessed=!1,this.renderable=void 0,this.key=e,this.style=t,this.options=n}return e.prototype.toString=function(e){if(Array.isArray(this.style)){for(var t="",n=0;n<this.style.length;n++)t+=b(this.at,this.style[n]),this.style[n+1]&&(t+="\n");return t}return b(this.at,this.style,e)},e}(),H=/@font-face/,G={onCreateRule:function(e,t,n){return H.test(e)?new V(e,t,n):null}},W=function(){function e(e,t,n){this.type="viewport",this.at="@viewport",this.key=void 0,this.style=void 0,this.options=void 0,this.isProcessed=!1,this.renderable=void 0,this.key=e,this.style=t,this.options=n}return e.prototype.toString=function(e){return b(this.key,this.style,e)},e}(),q={onCreateRule:function(e,t,n){return"@viewport"===e||"@-ms-viewport"===e?new W(e,t,n):null}},X=function(){function e(e,t,n){this.type="simple",this.key=void 0,this.value=void 0,this.options=void 0,this.isProcessed=!1,this.renderable=void 0,this.key=e,this.value=t,this.options=n}return e.prototype.toString=function(e){if(Array.isArray(this.value)){for(var t="",n=0;n<this.value.length;n++)t+=this.key+" "+this.value[n]+";",this.value[n+1]&&(t+="\n");return t}return this.key+" "+this.value+";"},e}(),Z={"@charset":!0,"@import":!0,"@namespace":!0},K=[k,P,B,j,G,q,{onCreateRule:function(e,t,n){return e in Z?new X(e,t,n):null}}],Y={process:!0},J={force:!0,process:!0},Q=function(){function e(e){this.map={},this.raw={},this.index=[],this.counter=0,this.options=void 0,this.classes=void 0,this.keyframes=void 0,this.options=e,this.classes=e.classes,this.keyframes=e.keyframes}var t=e.prototype;return t.add=function(e,t,n){var r=this.options,a=r.parent,o=r.sheet,s=r.jss,l=r.Renderer,u=r.generateId,c=r.scoped,h=Object(i.a)({classes:this.classes,parent:a,sheet:o,jss:s,Renderer:l,generateId:u,scoped:c,name:e,keyframes:this.keyframes,selector:void 0},n),f=e;e in this.raw&&(f=e+"-d"+this.counter++),this.raw[f]=t,f in this.classes&&(h.selector="."+E(this.classes[f]));var d=v(f,t,h);if(!d)return null;this.register(d);var p=void 0===h.index?this.index.length:h.index;return this.index.splice(p,0,d),d},t.get=function(e){return this.map[e]},t.remove=function(e){this.unregister(e),delete this.raw[e.key],this.index.splice(this.index.indexOf(e),1)},t.indexOf=function(e){return this.index.indexOf(e)},t.process=function(){var e=this.options.jss.plugins;this.index.slice(0).forEach(e.onProcessRule,e)},t.register=function(e){this.map[e.key]=e,e instanceof T?(this.map[e.selector]=e,e.id&&(this.classes[e.key]=e.id)):e instanceof O&&this.keyframes&&(this.keyframes[e.name]=e.id)},t.unregister=function(e){delete this.map[e.key],e instanceof T?(delete this.map[e.selector],delete this.classes[e.key]):e instanceof O&&delete this.keyframes[e.name]},t.update=function(){var e,t,n;if("string"===typeof(arguments.length<=0?void 0:arguments[0])?(e=arguments.length<=0?void 0:arguments[0],t=arguments.length<=1?void 0:arguments[1],n=arguments.length<=2?void 0:arguments[2]):(t=arguments.length<=0?void 0:arguments[0],n=arguments.length<=1?void 0:arguments[1],e=null),e)this.updateOne(this.map[e],t,n);else for(var r=0;r<this.index.length;r++)this.updateOne(this.index[r],t,n)},t.updateOne=function(t,n,r){void 0===r&&(r=Y);var i=this.options,a=i.jss.plugins,o=i.sheet;if(t.rules instanceof e)t.rules.update(n,r);else{var s=t,l=s.style;if(a.onUpdate(n,t,o,r),r.process&&l&&l!==s.style){for(var u in a.onProcessStyle(s.style,s,o),s.style){var c=s.style[u];c!==l[u]&&s.prop(u,c,J)}for(var h in l){var f=s.style[h],d=l[h];null==f&&f!==d&&s.prop(h,null,J)}}}},t.toString=function(e){for(var t="",n=this.options.sheet,r=!!n&&n.options.link,i=0;i<this.index.length;i++){var a=this.index[i].toString(e);(a||r)&&(t&&(t+="\n"),t+=a)}return t},e}(),$=function(){function e(e,t){for(var n in this.options=void 0,this.deployed=void 0,this.attached=void 0,this.rules=void 0,this.renderer=void 0,this.classes=void 0,this.keyframes=void 0,this.queue=void 0,this.attached=!1,this.deployed=!1,this.classes={},this.keyframes={},this.options=Object(i.a)({},t,{sheet:this,parent:this,classes:this.classes,keyframes:this.keyframes}),t.Renderer&&(this.renderer=new t.Renderer(this)),this.rules=new Q(this.options),e)this.rules.add(n,e[n]);this.rules.process()}var t=e.prototype;return t.attach=function(){return this.attached||(this.renderer&&this.renderer.attach(),this.attached=!0,this.deployed||this.deploy()),this},t.detach=function(){return this.attached?(this.renderer&&this.renderer.detach(),this.attached=!1,this):this},t.addRule=function(e,t,n){var r=this.queue;this.attached&&!r&&(this.queue=[]);var i=this.rules.add(e,t,n);return i?(this.options.jss.plugins.onProcessRule(i),this.attached?this.deployed?(r?r.push(i):(this.insertRule(i),this.queue&&(this.queue.forEach(this.insertRule,this),this.queue=void 0)),i):i:(this.deployed=!1,i)):null},t.insertRule=function(e){this.renderer&&this.renderer.insertRule(e)},t.addRules=function(e,t){var n=[];for(var r in e){var i=this.addRule(r,e[r],t);i&&n.push(i)}return n},t.getRule=function(e){return this.rules.get(e)},t.deleteRule=function(e){var t="object"===typeof e?e:this.rules.get(e);return!(!t||this.attached&&!t.renderable)&&(this.rules.remove(t),!(this.attached&&t.renderable&&this.renderer)||this.renderer.deleteRule(t.renderable))},t.indexOf=function(e){return this.rules.indexOf(e)},t.deploy=function(){return this.renderer&&this.renderer.deploy(),this.deployed=!0,this},t.update=function(){var e;return(e=this.rules).update.apply(e,arguments),this},t.updateOne=function(e,t,n){return this.rules.updateOne(e,t,n),this},t.toString=function(e){return this.rules.toString(e)},e}(),ee=function(){function e(){this.plugins={internal:[],external:[]},this.registry=void 0}var t=e.prototype;return t.onCreateRule=function(e,t,n){for(var r=0;r<this.registry.onCreateRule.length;r++){var i=this.registry.onCreateRule[r](e,t,n);if(i)return i}return null},t.onProcessRule=function(e){if(!e.isProcessed){for(var t=e.options.sheet,n=0;n<this.registry.onProcessRule.length;n++)this.registry.onProcessRule[n](e,t);e.style&&this.onProcessStyle(e.style,e,t),e.isProcessed=!0}},t.onProcessStyle=function(e,t,n){for(var r=0;r<this.registry.onProcessStyle.length;r++)t.style=this.registry.onProcessStyle[r](t.style,t,n)},t.onProcessSheet=function(e){for(var t=0;t<this.registry.onProcessSheet.length;t++)this.registry.onProcessSheet[t](e)},t.onUpdate=function(e,t,n,r){for(var i=0;i<this.registry.onUpdate.length;i++)this.registry.onUpdate[i](e,t,n,r)},t.onChangeValue=function(e,t,n){for(var r=e,i=0;i<this.registry.onChangeValue.length;i++)r=this.registry.onChangeValue[i](r,t,n);return r},t.use=function(e,t){void 0===t&&(t={queue:"external"});var n=this.plugins[t.queue];-1===n.indexOf(e)&&(n.push(e),this.registry=[].concat(this.plugins.external,this.plugins.internal).reduce((function(e,t){for(var n in t)n in e&&e[n].push(t[n]);return e}),{onCreateRule:[],onProcessRule:[],onProcessStyle:[],onProcessSheet:[],onChangeValue:[],onUpdate:[]}))},e}(),te=new(function(){function e(){this.registry=[]}var t=e.prototype;return t.add=function(e){var t=this.registry,n=e.options.index;if(-1===t.indexOf(e))if(0===t.length||n>=this.index)t.push(e);else for(var r=0;r<t.length;r++)if(t[r].options.index>n)return void t.splice(r,0,e)},t.reset=function(){this.registry=[]},t.remove=function(e){var t=this.registry.indexOf(e);this.registry.splice(t,1)},t.toString=function(e){for(var t=void 0===e?{}:e,n=t.attached,r=Object(d.a)(t,["attached"]),i="",a=0;a<this.registry.length;a++){var o=this.registry[a];null!=n&&o.attached!==n||(i&&(i+="\n"),i+=o.toString(r))}return i},c(e,[{key:"index",get:function(){return 0===this.registry.length?0:this.registry[this.registry.length-1].options.index}}]),e}()),ne="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")(),re="2f1acc6c3a606b082e5eef5e54414ffb";null==ne[re]&&(ne[re]=0);var ie=ne[re]++,ae=function(e){void 0===e&&(e={});var t=0;return function(n,r){t+=1;var i="",a="";return r&&(r.options.classNamePrefix&&(a=r.options.classNamePrefix),null!=r.options.jss.id&&(i=String(r.options.jss.id))),e.minify?""+(a||"c")+ie+i+t:a+n.key+"-"+ie+(i?"-"+i:"")+"-"+t}},oe=function(e){var t;return function(){return t||(t=e()),t}},se=function(e,t){try{return e.attributeStyleMap?e.attributeStyleMap.get(t):e.style.getPropertyValue(t)}catch(n){return""}},le=function(e,t,n){try{var r=n;if(Array.isArray(n)&&(r=g(n,!0),"!important"===n[n.length-1]))return e.style.setProperty(t,r,"important"),!0;e.attributeStyleMap?e.attributeStyleMap.set(t,r):e.style.setProperty(t,r)}catch(i){return!1}return!0},ue=function(e,t){try{e.attributeStyleMap?e.attributeStyleMap.delete(t):e.style.removeProperty(t)}catch(n){}},ce=function(e,t){return e.selectorText=t,e.selectorText===t},he=oe((function(){return document.querySelector("head")}));function fe(e){var t=te.registry;if(t.length>0){var n=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.attached&&r.options.index>t.index&&r.options.insertionPoint===t.insertionPoint)return r}return null}(t,e);if(n&&n.renderer)return{parent:n.renderer.element.parentNode,node:n.renderer.element};if((n=function(e,t){for(var n=e.length-1;n>=0;n--){var r=e[n];if(r.attached&&r.options.insertionPoint===t.insertionPoint)return r}return null}(t,e))&&n.renderer)return{parent:n.renderer.element.parentNode,node:n.renderer.element.nextSibling}}var r=e.insertionPoint;if(r&&"string"===typeof r){var i=function(e){for(var t=he(),n=0;n<t.childNodes.length;n++){var r=t.childNodes[n];if(8===r.nodeType&&r.nodeValue.trim()===e)return r}return null}(r);if(i)return{parent:i.parentNode,node:i.nextSibling}}return!1}var de=oe((function(){var e=document.querySelector('meta[property="csp-nonce"]');return e?e.getAttribute("content"):null})),pe=function(e,t,n){try{if("insertRule"in e)e.insertRule(t,n);else if("appendRule"in e){e.appendRule(t)}}catch(r){return!1}return e.cssRules[n]},me=function(e,t){var n=e.cssRules.length;return void 0===t||t>n?n:t},ve=function(){function e(e){this.getPropertyValue=se,this.setProperty=le,this.removeProperty=ue,this.setSelector=ce,this.element=void 0,this.sheet=void 0,this.hasInsertedRules=!1,this.cssRules=[],e&&te.add(e),this.sheet=e;var t=this.sheet?this.sheet.options:{},n=t.media,r=t.meta,i=t.element;this.element=i||function(){var e=document.createElement("style");return e.textContent="\n",e}(),this.element.setAttribute("data-jss",""),n&&this.element.setAttribute("media",n),r&&this.element.setAttribute("data-meta",r);var a=de();a&&this.element.setAttribute("nonce",a)}var t=e.prototype;return t.attach=function(){if(!this.element.parentNode&&this.sheet){!function(e,t){var n=t.insertionPoint,r=fe(t);if(!1!==r&&r.parent)r.parent.insertBefore(e,r.node);else if(n&&"number"===typeof n.nodeType){var i=n,a=i.parentNode;a&&a.insertBefore(e,i.nextSibling)}else he().appendChild(e)}(this.element,this.sheet.options);var e=Boolean(this.sheet&&this.sheet.deployed);this.hasInsertedRules&&e&&(this.hasInsertedRules=!1,this.deploy())}},t.detach=function(){if(this.sheet){var e=this.element.parentNode;e&&e.removeChild(this.element),this.sheet.options.link&&(this.cssRules=[],this.element.textContent="\n")}},t.deploy=function(){var e=this.sheet;e&&(e.options.link?this.insertRules(e.rules):this.element.textContent="\n"+e.toString()+"\n")},t.insertRules=function(e,t){for(var n=0;n<e.index.length;n++)this.insertRule(e.index[n],n,t)},t.insertRule=function(e,t,n){if(void 0===n&&(n=this.element.sheet),e.rules){var r=e,i=n;if("conditional"===e.type||"keyframes"===e.type){var a=me(n,t);if(!1===(i=pe(n,r.toString({children:!1}),a)))return!1;this.refCssRule(e,a,i)}return this.insertRules(r.rules,i),i}var o=e.toString();if(!o)return!1;var s=me(n,t),l=pe(n,o,s);return!1!==l&&(this.hasInsertedRules=!0,this.refCssRule(e,s,l),l)},t.refCssRule=function(e,t,n){e.renderable=n,e.options.parent instanceof $&&(this.cssRules[t]=n)},t.deleteRule=function(e){var t=this.element.sheet,n=this.indexOf(e);return-1!==n&&(t.deleteRule(n),this.cssRules.splice(n,1),!0)},t.indexOf=function(e){return this.cssRules.indexOf(e)},t.replaceRule=function(e,t){var n=this.indexOf(e);return-1!==n&&(this.element.sheet.deleteRule(n),this.cssRules.splice(n,1),this.insertRule(t,n))},t.getRules=function(){return this.element.sheet.cssRules},e}(),ye=0,ge=function(){function e(e){this.id=ye++,this.version="10.5.1",this.plugins=new ee,this.options={id:{minify:!1},createGenerateId:ae,Renderer:l?ve:null,plugins:[]},this.generateId=ae({minify:!1});for(var t=0;t<K.length;t++)this.plugins.use(K[t],{queue:"internal"});this.setup(e)}var t=e.prototype;return t.setup=function(e){return void 0===e&&(e={}),e.createGenerateId&&(this.options.createGenerateId=e.createGenerateId),e.id&&(this.options.id=Object(i.a)({},this.options.id,e.id)),(e.createGenerateId||e.id)&&(this.generateId=this.options.createGenerateId(this.options.id)),null!=e.insertionPoint&&(this.options.insertionPoint=e.insertionPoint),"Renderer"in e&&(this.options.Renderer=e.Renderer),e.plugins&&this.use.apply(this,e.plugins),this},t.createStyleSheet=function(e,t){void 0===t&&(t={});var n=t.index;"number"!==typeof n&&(n=0===te.index?0:te.index+1);var r=new $(e,Object(i.a)({},t,{jss:this,generateId:t.generateId||this.generateId,insertionPoint:this.options.insertionPoint,Renderer:this.options.Renderer,index:n}));return this.plugins.onProcessSheet(r),r},t.removeStyleSheet=function(e){return e.detach(),te.remove(e),this},t.createRule=function(e,t,n){if(void 0===t&&(t={}),void 0===n&&(n={}),"object"===typeof e)return this.createRule(void 0,e,t);var r=Object(i.a)({},n,{name:e,jss:this,Renderer:this.options.Renderer});r.generateId||(r.generateId=this.generateId),r.classes||(r.classes={}),r.keyframes||(r.keyframes={});var a=v(e,t,r);return a&&this.plugins.onProcessRule(a),a},t.use=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){e.plugins.use(t)})),this},e}();function _e(e){var t=null;for(var n in e){var r=e[n],i=typeof r;if("function"===i)t||(t={}),t[n]=r;else if("object"===i&&null!==r&&!Array.isArray(r)){var a=_e(r);a&&(t||(t={}),t[n]=a)}}return t}var be="object"===typeof CSS&&null!=CSS&&"number"in CSS,xe=function(e){return new ge(e)};xe();function we(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.baseClasses,n=e.newClasses;e.Component;if(!n)return t;var r=Object(i.a)({},t);return Object.keys(n).forEach((function(e){n[e]&&(r[e]="".concat(t[e]," ").concat(n[e]))})),r}var Ee={set:function(e,t,n,r){var i=e.get(t);i||(i=new Map,e.set(t,i)),i.set(n,r)},get:function(e,t,n){var r=e.get(t);return r?r.get(n):void 0},delete:function(e,t,n){e.get(t).delete(n)}},Se=n(124),Te=(n(14),"function"===typeof Symbol&&Symbol.for?Symbol.for("mui.nested"):"__THEME_NESTED__"),ke=["checked","disabled","error","focused","focusVisible","required","expanded","selected"];var Me=Date.now(),Ce="fnValues"+Me,Ae="fnStyle"+ ++Me,Ie=function(){return{onCreateRule:function(e,t,n){if("function"!==typeof t)return null;var r=v(e,{},n);return r[Ae]=t,r},onProcessStyle:function(e,t){if(Ce in t||Ae in t)return e;var n={};for(var r in e){var i=e[r];"function"===typeof i&&(delete e[r],n[r]=i)}return t[Ce]=n,e},onUpdate:function(e,t,n,r){var i=t,a=i[Ae];a&&(i.style=a(e)||{});var o=i[Ce];if(o)for(var s in o)i.prop(s,o[s](e),r)}}},Pe="@global",Re="@global ",Le=function(){function e(e,t,n){for(var r in this.type="global",this.at=Pe,this.rules=void 0,this.options=void 0,this.key=void 0,this.isProcessed=!1,this.key=e,this.options=n,this.rules=new Q(Object(i.a)({},n,{parent:this})),t)this.rules.add(r,t[r]);this.rules.process()}var t=e.prototype;return t.getRule=function(e){return this.rules.get(e)},t.addRule=function(e,t,n){var r=this.rules.add(e,t,n);return r&&this.options.jss.plugins.onProcessRule(r),r},t.indexOf=function(e){return this.rules.indexOf(e)},t.toString=function(){return this.rules.toString()},e}(),Oe=function(){function e(e,t,n){this.type="global",this.at=Pe,this.options=void 0,this.rule=void 0,this.isProcessed=!1,this.key=void 0,this.key=e,this.options=n;var r=e.substr(Re.length);this.rule=n.jss.createRule(r,t,Object(i.a)({},n,{parent:this}))}return e.prototype.toString=function(e){return this.rule?this.rule.toString(e):""},e}(),De=/\s*,\s*/g;function Ne(e,t){for(var n=e.split(De),r="",i=0;i<n.length;i++)r+=t+" "+n[i].trim(),n[i+1]&&(r+=", ");return r}var ze=function(){return{onCreateRule:function(e,t,n){if(!e)return null;if(e===Pe)return new Le(e,t,n);if("@"===e[0]&&e.substr(0,Re.length)===Re)return new Oe(e,t,n);var r=n.parent;return r&&("global"===r.type||r.options.parent&&"global"===r.options.parent.type)&&(n.scoped=!1),!1===n.scoped&&(n.selector=e),null},onProcessRule:function(e,t){"style"===e.type&&t&&(function(e,t){var n=e.options,r=e.style,a=r?r[Pe]:null;if(a){for(var o in a)t.addRule(o,a[o],Object(i.a)({},n,{selector:Ne(o,e.selector)}));delete r[Pe]}}(e,t),function(e,t){var n=e.options,r=e.style;for(var a in r)if("@"===a[0]&&a.substr(0,Pe.length)===Pe){var o=Ne(a.substr(Pe.length),e.selector);t.addRule(o,r[a],Object(i.a)({},n,{selector:o})),delete r[a]}}(e,t))}}},Fe=/\s*,\s*/g,Be=/&/g,Ue=/\$([\w-]+)/g;var je=function(){function e(e,t){return function(n,r){var i=e.getRule(r)||t&&t.getRule(r);return i?(i=i).selector:r}}function t(e,t){for(var n=t.split(Fe),r=e.split(Fe),i="",a=0;a<n.length;a++)for(var o=n[a],s=0;s<r.length;s++){var l=r[s];i&&(i+=", "),i+=-1!==l.indexOf("&")?l.replace(Be,o):o+" "+l}return i}function n(e,t,n){if(n)return Object(i.a)({},n,{index:n.index+1});var r=e.options.nestingLevel;r=void 0===r?1:r+1;var a=Object(i.a)({},e.options,{nestingLevel:r,index:t.indexOf(e)+1});return delete a.name,a}return{onProcessStyle:function(r,a,o){if("style"!==a.type)return r;var s,l,u=a,c=u.options.parent;for(var h in r){var f=-1!==h.indexOf("&"),d="@"===h[0];if(f||d){if(s=n(u,c,s),f){var p=t(h,u.selector);l||(l=e(c,o)),p=p.replace(Ue,l),c.addRule(p,r[h],Object(i.a)({},s,{selector:p}))}else d&&c.addRule(h,{},s).addRule(u.key,r[h],{selector:u.selector});delete r[h]}}return r}}},Ve=/[A-Z]/g,He=/^ms-/,Ge={};function We(e){return"-"+e.toLowerCase()}var qe=function(e){if(Ge.hasOwnProperty(e))return Ge[e];var t=e.replace(Ve,We);return Ge[e]=He.test(t)?"-"+t:t};function Xe(e){var t={};for(var n in e){t[0===n.indexOf("--")?n:qe(n)]=e[n]}return e.fallbacks&&(Array.isArray(e.fallbacks)?t.fallbacks=e.fallbacks.map(Xe):t.fallbacks=Xe(e.fallbacks)),t}var Ze=function(){return{onProcessStyle:function(e){if(Array.isArray(e)){for(var t=0;t<e.length;t++)e[t]=Xe(e[t]);return e}return Xe(e)},onChangeValue:function(e,t,n){if(0===t.indexOf("--"))return e;var r=qe(t);return t===r?e:(n.prop(r,e),null)}}},Ke=be&&CSS?CSS.px:"px",Ye=be&&CSS?CSS.ms:"ms",Je=be&&CSS?CSS.percent:"%";function Qe(e){var t=/(-[a-z])/g,n=function(e){return e[1].toUpperCase()},r={};for(var i in e)r[i]=e[i],r[i.replace(t,n)]=e[i];return r}var $e=Qe({"animation-delay":Ye,"animation-duration":Ye,"background-position":Ke,"background-position-x":Ke,"background-position-y":Ke,"background-size":Ke,border:Ke,"border-bottom":Ke,"border-bottom-left-radius":Ke,"border-bottom-right-radius":Ke,"border-bottom-width":Ke,"border-left":Ke,"border-left-width":Ke,"border-radius":Ke,"border-right":Ke,"border-right-width":Ke,"border-top":Ke,"border-top-left-radius":Ke,"border-top-right-radius":Ke,"border-top-width":Ke,"border-width":Ke,"border-block":Ke,"border-block-end":Ke,"border-block-end-width":Ke,"border-block-start":Ke,"border-block-start-width":Ke,"border-block-width":Ke,"border-inline":Ke,"border-inline-end":Ke,"border-inline-end-width":Ke,"border-inline-start":Ke,"border-inline-start-width":Ke,"border-inline-width":Ke,"border-start-start-radius":Ke,"border-start-end-radius":Ke,"border-end-start-radius":Ke,"border-end-end-radius":Ke,margin:Ke,"margin-bottom":Ke,"margin-left":Ke,"margin-right":Ke,"margin-top":Ke,"margin-block":Ke,"margin-block-end":Ke,"margin-block-start":Ke,"margin-inline":Ke,"margin-inline-end":Ke,"margin-inline-start":Ke,padding:Ke,"padding-bottom":Ke,"padding-left":Ke,"padding-right":Ke,"padding-top":Ke,"padding-block":Ke,"padding-block-end":Ke,"padding-block-start":Ke,"padding-inline":Ke,"padding-inline-end":Ke,"padding-inline-start":Ke,"mask-position-x":Ke,"mask-position-y":Ke,"mask-size":Ke,height:Ke,width:Ke,"min-height":Ke,"max-height":Ke,"min-width":Ke,"max-width":Ke,bottom:Ke,left:Ke,top:Ke,right:Ke,inset:Ke,"inset-block":Ke,"inset-block-end":Ke,"inset-block-start":Ke,"inset-inline":Ke,"inset-inline-end":Ke,"inset-inline-start":Ke,"box-shadow":Ke,"text-shadow":Ke,"column-gap":Ke,"column-rule":Ke,"column-rule-width":Ke,"column-width":Ke,"font-size":Ke,"font-size-delta":Ke,"letter-spacing":Ke,"text-decoration-thickness":Ke,"text-indent":Ke,"text-stroke":Ke,"text-stroke-width":Ke,"word-spacing":Ke,motion:Ke,"motion-offset":Ke,outline:Ke,"outline-offset":Ke,"outline-width":Ke,perspective:Ke,"perspective-origin-x":Je,"perspective-origin-y":Je,"transform-origin":Je,"transform-origin-x":Je,"transform-origin-y":Je,"transform-origin-z":Je,"transition-delay":Ye,"transition-duration":Ye,"vertical-align":Ke,"flex-basis":Ke,"shape-margin":Ke,size:Ke,gap:Ke,grid:Ke,"grid-gap":Ke,"row-gap":Ke,"grid-row-gap":Ke,"grid-column-gap":Ke,"grid-template-rows":Ke,"grid-template-columns":Ke,"grid-auto-rows":Ke,"grid-auto-columns":Ke,"box-shadow-x":Ke,"box-shadow-y":Ke,"box-shadow-blur":Ke,"box-shadow-spread":Ke,"font-line-height":Ke,"text-shadow-x":Ke,"text-shadow-y":Ke,"text-shadow-blur":Ke});function et(e,t,n){if(null==t)return t;if(Array.isArray(t))for(var r=0;r<t.length;r++)t[r]=et(e,t[r],n);else if("object"===typeof t)if("fallbacks"===e)for(var i in t)t[i]=et(i,t[i],n);else for(var a in t)t[a]=et(e+"-"+a,t[a],n);else if("number"===typeof t&&!Number.isNaN(t)){var o=n[e]||$e[e];return!o||0===t&&o===Ke?t.toString():"function"===typeof o?o(t).toString():""+t+o}return t}var tt=function(e){void 0===e&&(e={});var t=Qe(e);return{onProcessStyle:function(e,n){if("style"!==n.type)return e;for(var r in e)e[r]=et(r,e[r],t);return e},onChangeValue:function(e,n){return et(n,e,t)}}},nt=n(23),rt="",it="",at="",ot="",st=l&&"ontouchstart"in document.documentElement;if(l){var lt={Moz:"-moz-",ms:"-ms-",O:"-o-",Webkit:"-webkit-"},ut=document.createElement("p").style;for(var ct in lt)if(ct+"Transform"in ut){rt=ct,it=lt[ct];break}"Webkit"===rt&&"msHyphens"in ut&&(rt="ms",it=lt.ms,ot="edge"),"Webkit"===rt&&"-apple-trailing-word"in ut&&(at="apple")}var ht=rt,ft=it,dt=at,pt=ot,mt=st;var vt={noPrefill:["appearance"],supportedProperty:function(e){return"appearance"===e&&("ms"===ht?"-webkit-"+e:ft+e)}},yt={noPrefill:["color-adjust"],supportedProperty:function(e){return"color-adjust"===e&&("Webkit"===ht?ft+"print-"+e:e)}},gt=/[-\s]+(.)?/g;function _t(e,t){return t?t.toUpperCase():""}function bt(e){return e.replace(gt,_t)}function xt(e){return bt("-"+e)}var wt,Et={noPrefill:["mask"],supportedProperty:function(e,t){if(!/^mask/.test(e))return!1;if("Webkit"===ht){var n="mask-image";if(bt(n)in t)return e;if(ht+xt(n)in t)return ft+e}return e}},St={noPrefill:["text-orientation"],supportedProperty:function(e){return"text-orientation"===e&&("apple"!==dt||mt?e:ft+e)}},Tt={noPrefill:["transform"],supportedProperty:function(e,t,n){return"transform"===e&&(n.transform?e:ft+e)}},kt={noPrefill:["transition"],supportedProperty:function(e,t,n){return"transition"===e&&(n.transition?e:ft+e)}},Mt={noPrefill:["writing-mode"],supportedProperty:function(e){return"writing-mode"===e&&("Webkit"===ht||"ms"===ht&&"edge"!==pt?ft+e:e)}},Ct={noPrefill:["user-select"],supportedProperty:function(e){return"user-select"===e&&("Moz"===ht||"ms"===ht||"apple"===dt?ft+e:e)}},At={supportedProperty:function(e,t){return!!/^break-/.test(e)&&("Webkit"===ht?"WebkitColumn"+xt(e)in t&&ft+"column-"+e:"Moz"===ht&&("page"+xt(e)in t&&"page-"+e))}},It={supportedProperty:function(e,t){if(!/^(border|margin|padding)-inline/.test(e))return!1;if("Moz"===ht)return e;var n=e.replace("-inline","");return ht+xt(n)in t&&ft+n}},Pt={supportedProperty:function(e,t){return bt(e)in t&&e}},Rt={supportedProperty:function(e,t){var n=xt(e);return"-"===e[0]||"-"===e[0]&&"-"===e[1]?e:ht+n in t?ft+e:"Webkit"!==ht&&"Webkit"+n in t&&"-webkit-"+e}},Lt={supportedProperty:function(e){return"scroll-snap"===e.substring(0,11)&&("ms"===ht?""+ft+e:e)}},Ot={supportedProperty:function(e){return"overscroll-behavior"===e&&("ms"===ht?ft+"scroll-chaining":e)}},Dt={"flex-grow":"flex-positive","flex-shrink":"flex-negative","flex-basis":"flex-preferred-size","justify-content":"flex-pack",order:"flex-order","align-items":"flex-align","align-content":"flex-line-pack"},Nt={supportedProperty:function(e,t){var n=Dt[e];return!!n&&(ht+xt(n)in t&&ft+n)}},zt={flex:"box-flex","flex-grow":"box-flex","flex-direction":["box-orient","box-direction"],order:"box-ordinal-group","align-items":"box-align","flex-flow":["box-orient","box-direction"],"justify-content":"box-pack"},Ft=Object.keys(zt),Bt=function(e){return ft+e},Ut=[vt,yt,Et,St,Tt,kt,Mt,Ct,At,It,Pt,Rt,Lt,Ot,Nt,{supportedProperty:function(e,t,n){var r=n.multiple;if(Ft.indexOf(e)>-1){var i=zt[e];if(!Array.isArray(i))return ht+xt(i)in t&&ft+i;if(!r)return!1;for(var a=0;a<i.length;a++)if(!(ht+xt(i[0])in t))return!1;return i.map(Bt)}return!1}}],jt=Ut.filter((function(e){return e.supportedProperty})).map((function(e){return e.supportedProperty})),Vt=Ut.filter((function(e){return e.noPrefill})).reduce((function(e,t){return e.push.apply(e,Object(nt.a)(t.noPrefill)),e}),[]),Ht={};if(l){wt=document.createElement("p");var Gt=window.getComputedStyle(document.documentElement,"");for(var Wt in Gt)isNaN(Wt)||(Ht[Gt[Wt]]=Gt[Wt]);Vt.forEach((function(e){return delete Ht[e]}))}function qt(e,t){if(void 0===t&&(t={}),!wt)return e;if(null!=Ht[e])return Ht[e];"transition"!==e&&"transform"!==e||(t[e]=e in wt.style);for(var n=0;n<jt.length&&(Ht[e]=jt[n](e,wt.style,t),!Ht[e]);n++);try{wt.style[e]=""}catch(r){return!1}return Ht[e]}var Xt,Zt={},Kt={transition:1,"transition-property":1,"-webkit-transition":1,"-webkit-transition-property":1},Yt=/(^\s*[\w-]+)|, (\s*[\w-]+)(?![^()]*\))/g;function Jt(e,t,n){if("var"===t)return"var";if("all"===t)return"all";if("all"===n)return", all";var r=t?qt(t):", "+qt(n);return r||(t||n)}function Qt(e,t){var n=t;if(!Xt||"content"===e)return t;if("string"!==typeof n||!isNaN(parseInt(n,10)))return n;var r=e+n;if(null!=Zt[r])return Zt[r];try{Xt.style[e]=n}catch(i){return Zt[r]=!1,!1}if(Kt[e])n=n.replace(Yt,Jt);else if(""===Xt.style[e]&&("-ms-flex"===(n=ft+n)&&(Xt.style[e]="-ms-flexbox"),Xt.style[e]=n,""===Xt.style[e]))return Zt[r]=!1,!1;return Xt.style[e]="",Zt[r]=n,Zt[r]}l&&(Xt=document.createElement("p"));var $t=function(){function e(t){for(var n in t){var r=t[n];if("fallbacks"===n&&Array.isArray(r))t[n]=r.map(e);else{var i=!1,a=qt(n);a&&a!==n&&(i=!0);var o=!1,s=Qt(a,g(r));s&&s!==r&&(o=!0),(i||o)&&(i&&delete t[n],t[a||n]=s||r)}}return t}return{onProcessRule:function(e){if("keyframes"===e.type){var t=e;t.at="-"===(n=t.at)[1]||"ms"===ht?n:"@"+ft+"keyframes"+n.substr(10)}var n},onProcessStyle:function(t,n){return"style"!==n.type?t:e(t)},onChangeValue:function(e,t){return Qt(t,g(e))||e}}};var en=function(){var e=function(e,t){return e.length===t.length?e>t?1:-1:e.length-t.length};return{onProcessStyle:function(t,n){if("style"!==n.type)return t;for(var r={},i=Object.keys(t).sort(e),a=0;a<i.length;a++)r[i[a]]=t[i[a]];return r}}};function tn(){return{plugins:[Ie(),ze(),je(),Ze(),tt(),"undefined"===typeof window?null:$t(),en()]}}var nn=xe(tn()),rn={disableGeneration:!1,generateClassName:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.disableGlobal,n=void 0!==t&&t,r=e.productionPrefix,i=void 0===r?"jss":r,a=e.seed,o=void 0===a?"":a,s=""===o?"":"".concat(o,"-"),l=0,u=function(){return l+=1};return function(e,t){var r=t.options.name;if(r&&0===r.indexOf("Mui")&&!t.options.link&&!n){if(-1!==ke.indexOf(e.key))return"Mui-".concat(e.key);var a="".concat(s).concat(r,"-").concat(e.key);return t.options.theme[Te]&&""===o?"".concat(a,"-").concat(u()):a}return"".concat(s).concat(i).concat(u())}}(),jss:nn,sheetsCache:null,sheetsManager:new Map,sheetsRegistry:null},an=o.a.createContext(rn);var on=-1e9;function sn(){return on+=1}n(25);var ln=n(118);function un(e){var t="function"===typeof e;return{create:function(n,r){var a;try{a=t?e(n):e}catch(l){throw l}if(!r||!n.overrides||!n.overrides[r])return a;var o=n.overrides[r],s=Object(i.a)({},a);return Object.keys(o).forEach((function(e){s[e]=Object(ln.a)(s[e],o[e])})),s},options:{}}}var cn={};function hn(e,t,n){var r=e.state;if(e.stylesOptions.disableGeneration)return t||{};r.cacheClasses||(r.cacheClasses={value:null,lastProp:null,lastJSS:{}});var i=!1;return r.classes!==r.cacheClasses.lastJSS&&(r.cacheClasses.lastJSS=r.classes,i=!0),t!==r.cacheClasses.lastProp&&(r.cacheClasses.lastProp=t,i=!0),i&&(r.cacheClasses.value=we({baseClasses:r.cacheClasses.lastJSS,newClasses:t,Component:n})),r.cacheClasses.value}function fn(e,t){var n=e.state,r=e.theme,a=e.stylesOptions,o=e.stylesCreator,s=e.name;if(!a.disableGeneration){var l=Ee.get(a.sheetsManager,o,r);l||(l={refs:0,staticSheet:null,dynamicStyles:null},Ee.set(a.sheetsManager,o,r,l));var u=Object(i.a)({},o.options,a,{theme:r,flip:"boolean"===typeof a.flip?a.flip:"rtl"===r.direction});u.generateId=u.serverGenerateClassName||u.generateClassName;var c=a.sheetsRegistry;if(0===l.refs){var h;a.sheetsCache&&(h=Ee.get(a.sheetsCache,o,r));var f=o.create(r,s);h||((h=a.jss.createStyleSheet(f,Object(i.a)({link:!1},u))).attach(),a.sheetsCache&&Ee.set(a.sheetsCache,o,r,h)),c&&c.add(h),l.staticSheet=h,l.dynamicStyles=_e(f)}if(l.dynamicStyles){var d=a.jss.createStyleSheet(l.dynamicStyles,Object(i.a)({link:!0},u));d.update(t),d.attach(),n.dynamicSheet=d,n.classes=we({baseClasses:l.staticSheet.classes,newClasses:d.classes}),c&&c.add(d)}else n.classes=l.staticSheet.classes;l.refs+=1}}function dn(e,t){var n=e.state;n.dynamicSheet&&n.dynamicSheet.update(t)}function pn(e){var t=e.state,n=e.theme,r=e.stylesOptions,i=e.stylesCreator;if(!r.disableGeneration){var a=Ee.get(r.sheetsManager,i,n);a.refs-=1;var o=r.sheetsRegistry;0===a.refs&&(Ee.delete(r.sheetsManager,i,n),r.jss.removeStyleSheet(a.staticSheet),o&&o.remove(a.staticSheet)),t.dynamicSheet&&(r.jss.removeStyleSheet(t.dynamicSheet),o&&o.remove(t.dynamicSheet))}}function mn(e,t){var n,r=o.a.useRef([]),i=o.a.useMemo((function(){return{}}),t);r.current!==i&&(r.current=i,n=e()),o.a.useEffect((function(){return function(){n&&n()}}),[i])}function vn(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.name,a=t.classNamePrefix,s=t.Component,l=t.defaultTheme,u=void 0===l?cn:l,c=Object(r.a)(t,["name","classNamePrefix","Component","defaultTheme"]),h=un(e),f=n||a||"makeStyles";h.options={index:sn(),name:n,meta:f,classNamePrefix:f};var d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object(Se.a)()||u,r=Object(i.a)({},o.a.useContext(an),c),a=o.a.useRef(),l=o.a.useRef();mn((function(){var i={name:n,state:{},stylesCreator:h,stylesOptions:r,theme:t};return fn(i,e),l.current=!1,a.current=i,function(){pn(i)}}),[t,h]),o.a.useEffect((function(){l.current&&dn(a.current,e),l.current=!0}));var f=hn(a.current,e.classes,s);return f};return d}},function(e,t,n){"use strict";var r=n(3),i=n(8),a=n(1),o=n.n(a),s=(n(14),n(21)),l=n(9);function u(e,t){"function"===typeof e?e(t):e&&(e.current=t)}function c(e,t){return a.useMemo((function(){return null==e&&null==t?null:function(n){u(e,n),u(t,n)}}),[e,t])}var h="undefined"!==typeof window?a.useLayoutEffect:a.useEffect;function f(e){var t=a.useRef(e);return h((function(){t.current=e})),a.useCallback((function(){return t.current.apply(void 0,arguments)}),[])}var d=n(13),p=!0,m=!1,v=null,y={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function g(e){e.metaKey||e.altKey||e.ctrlKey||(p=!0)}function _(){p=!1}function b(){"hidden"===this.visibilityState&&m&&(p=!0)}function x(e){var t=e.target;try{return t.matches(":focus-visible")}catch(n){}return p||function(e){var t=e.type,n=e.tagName;return!("INPUT"!==n||!y[t]||e.readOnly)||"TEXTAREA"===n&&!e.readOnly||!!e.isContentEditable}(t)}function w(){m=!0,window.clearTimeout(v),v=window.setTimeout((function(){m=!1}),100)}function E(){return{isFocusVisible:x,onBlurVisible:w,ref:a.useCallback((function(e){var t,n=s.findDOMNode(e);null!=n&&((t=n.ownerDocument).addEventListener("keydown",g,!0),t.addEventListener("mousedown",_,!0),t.addEventListener("pointerdown",_,!0),t.addEventListener("touchstart",_,!0),t.addEventListener("visibilitychange",b,!0))}),[])}}var S=n(23),T=n(22),k=n(28),M=n(27),C=o.a.createContext(null);function A(e,t){var n=Object.create(null);return e&&a.Children.map(e,(function(e){return e})).forEach((function(e){n[e.key]=function(e){return t&&Object(a.isValidElement)(e)?t(e):e}(e)})),n}function I(e,t,n){return null!=n[t]?n[t]:e.props[t]}function P(e,t,n){var r=A(e.children),i=function(e,t){function n(n){return n in t?t[n]:e[n]}e=e||{},t=t||{};var r,i=Object.create(null),a=[];for(var o in e)o in t?a.length&&(i[o]=a,a=[]):a.push(o);var s={};for(var l in t){if(i[l])for(r=0;r<i[l].length;r++){var u=i[l][r];s[i[l][r]]=n(u)}s[l]=n(l)}for(r=0;r<a.length;r++)s[a[r]]=n(a[r]);return s}(t,r);return Object.keys(i).forEach((function(o){var s=i[o];if(Object(a.isValidElement)(s)){var l=o in t,u=o in r,c=t[o],h=Object(a.isValidElement)(c)&&!c.props.in;!u||l&&!h?u||!l||h?u&&l&&Object(a.isValidElement)(c)&&(i[o]=Object(a.cloneElement)(s,{onExited:n.bind(null,s),in:c.props.in,exit:I(s,"exit",e),enter:I(s,"enter",e)})):i[o]=Object(a.cloneElement)(s,{in:!1}):i[o]=Object(a.cloneElement)(s,{onExited:n.bind(null,s),in:!0,exit:I(s,"exit",e),enter:I(s,"enter",e)})}})),i}var R=Object.values||function(e){return Object.keys(e).map((function(t){return e[t]}))},L=function(e){function t(t,n){var r,i=(r=e.call(this,t,n)||this).handleExited.bind(Object(k.a)(r));return r.state={contextValue:{isMounting:!0},handleExited:i,firstRender:!0},r}Object(M.a)(t,e);var n=t.prototype;return n.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},n.componentWillUnmount=function(){this.mounted=!1},t.getDerivedStateFromProps=function(e,t){var n,r,i=t.children,o=t.handleExited;return{children:t.firstRender?(n=e,r=o,A(n.children,(function(e){return Object(a.cloneElement)(e,{onExited:r.bind(null,e),in:!0,appear:I(e,"appear",n),enter:I(e,"enter",n),exit:I(e,"exit",n)})}))):P(e,i,o),firstRender:!1}},n.handleExited=function(e,t){var n=A(this.props.children);e.key in n||(e.props.onExited&&e.props.onExited(t),this.mounted&&this.setState((function(t){var n=Object(r.a)({},t.children);return delete n[e.key],{children:n}})))},n.render=function(){var e=this.props,t=e.component,n=e.childFactory,r=Object(T.a)(e,["component","childFactory"]),i=this.state.contextValue,a=R(this.state.children).map(n);return delete r.appear,delete r.enter,delete r.exit,null===t?o.a.createElement(C.Provider,{value:i},a):o.a.createElement(C.Provider,{value:i},o.a.createElement(t,r,a))},t}(o.a.Component);L.propTypes={},L.defaultProps={component:"div",childFactory:function(e){return e}};var O=L,D="undefined"===typeof window?a.useEffect:a.useLayoutEffect;var N=function(e){var t=e.classes,n=e.pulsate,r=void 0!==n&&n,i=e.rippleX,o=e.rippleY,s=e.rippleSize,u=e.in,c=e.onExited,h=void 0===c?function(){}:c,d=e.timeout,p=a.useState(!1),m=p[0],v=p[1],y=Object(l.a)(t.ripple,t.rippleVisible,r&&t.ripplePulsate),g={width:s,height:s,top:-s/2+o,left:-s/2+i},_=Object(l.a)(t.child,m&&t.childLeaving,r&&t.childPulsate),b=f(h);return D((function(){if(!u){v(!0);var e=setTimeout(b,d);return function(){clearTimeout(e)}}}),[b,u,d]),a.createElement("span",{className:y,style:g},a.createElement("span",{className:_}))},z=a.forwardRef((function(e,t){var n=e.center,o=void 0!==n&&n,s=e.classes,u=e.className,c=Object(i.a)(e,["center","classes","className"]),h=a.useState([]),f=h[0],d=h[1],p=a.useRef(0),m=a.useRef(null);a.useEffect((function(){m.current&&(m.current(),m.current=null)}),[f]);var v=a.useRef(!1),y=a.useRef(null),g=a.useRef(null),_=a.useRef(null);a.useEffect((function(){return function(){clearTimeout(y.current)}}),[]);var b=a.useCallback((function(e){var t=e.pulsate,n=e.rippleX,r=e.rippleY,i=e.rippleSize,o=e.cb;d((function(e){return[].concat(Object(S.a)(e),[a.createElement(N,{key:p.current,classes:s,timeout:550,pulsate:t,rippleX:n,rippleY:r,rippleSize:i})])})),p.current+=1,m.current=o}),[s]),x=a.useCallback((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=t.pulsate,i=void 0!==r&&r,a=t.center,s=void 0===a?o||t.pulsate:a,l=t.fakeElement,u=void 0!==l&&l;if("mousedown"===e.type&&v.current)v.current=!1;else{"touchstart"===e.type&&(v.current=!0);var c,h,f,d=u?null:_.current,p=d?d.getBoundingClientRect():{width:0,height:0,left:0,top:0};if(s||0===e.clientX&&0===e.clientY||!e.clientX&&!e.touches)c=Math.round(p.width/2),h=Math.round(p.height/2);else{var m=e.touches?e.touches[0]:e,x=m.clientX,w=m.clientY;c=Math.round(x-p.left),h=Math.round(w-p.top)}if(s)(f=Math.sqrt((2*Math.pow(p.width,2)+Math.pow(p.height,2))/3))%2===0&&(f+=1);else{var E=2*Math.max(Math.abs((d?d.clientWidth:0)-c),c)+2,S=2*Math.max(Math.abs((d?d.clientHeight:0)-h),h)+2;f=Math.sqrt(Math.pow(E,2)+Math.pow(S,2))}e.touches?null===g.current&&(g.current=function(){b({pulsate:i,rippleX:c,rippleY:h,rippleSize:f,cb:n})},y.current=setTimeout((function(){g.current&&(g.current(),g.current=null)}),80)):b({pulsate:i,rippleX:c,rippleY:h,rippleSize:f,cb:n})}}),[o,b]),w=a.useCallback((function(){x({},{pulsate:!0})}),[x]),E=a.useCallback((function(e,t){if(clearTimeout(y.current),"touchend"===e.type&&g.current)return e.persist(),g.current(),g.current=null,void(y.current=setTimeout((function(){E(e,t)})));g.current=null,d((function(e){return e.length>0?e.slice(1):e})),m.current=t}),[]);return a.useImperativeHandle(t,(function(){return{pulsate:w,start:x,stop:E}}),[w,x,E]),a.createElement("span",Object(r.a)({className:Object(l.a)(s.root,u),ref:_},c),a.createElement(O,{component:null,exit:!0},f))})),F=Object(d.a)((function(e){return{root:{overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"},ripple:{opacity:0,position:"absolute"},rippleVisible:{opacity:.3,transform:"scale(1)",animation:"$enter ".concat(550,"ms ").concat(e.transitions.easing.easeInOut)},ripplePulsate:{animationDuration:"".concat(e.transitions.duration.shorter,"ms")},child:{opacity:1,display:"block",width:"100%",height:"100%",borderRadius:"50%",backgroundColor:"currentColor"},childLeaving:{opacity:0,animation:"$exit ".concat(550,"ms ").concat(e.transitions.easing.easeInOut)},childPulsate:{position:"absolute",left:0,top:0,animation:"$pulsate 2500ms ".concat(e.transitions.easing.easeInOut," 200ms infinite")},"@keyframes enter":{"0%":{transform:"scale(0)",opacity:.1},"100%":{transform:"scale(1)",opacity:.3}},"@keyframes exit":{"0%":{opacity:1},"100%":{opacity:0}},"@keyframes pulsate":{"0%":{transform:"scale(1)"},"50%":{transform:"scale(0.92)"},"100%":{transform:"scale(1)"}}}}),{flip:!1,name:"MuiTouchRipple"})(a.memo(z)),B=a.forwardRef((function(e,t){var n=e.action,o=e.buttonRef,u=e.centerRipple,h=void 0!==u&&u,d=e.children,p=e.classes,m=e.className,v=e.component,y=void 0===v?"button":v,g=e.disabled,_=void 0!==g&&g,b=e.disableRipple,x=void 0!==b&&b,w=e.disableTouchRipple,S=void 0!==w&&w,T=e.focusRipple,k=void 0!==T&&T,M=e.focusVisibleClassName,C=e.onBlur,A=e.onClick,I=e.onFocus,P=e.onFocusVisible,R=e.onKeyDown,L=e.onKeyUp,O=e.onMouseDown,D=e.onMouseLeave,N=e.onMouseUp,z=e.onTouchEnd,B=e.onTouchMove,U=e.onTouchStart,j=e.onDragLeave,V=e.tabIndex,H=void 0===V?0:V,G=e.TouchRippleProps,W=e.type,q=void 0===W?"button":W,X=Object(i.a)(e,["action","buttonRef","centerRipple","children","classes","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","onBlur","onClick","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","onDragLeave","tabIndex","TouchRippleProps","type"]),Z=a.useRef(null);var K=a.useRef(null),Y=a.useState(!1),J=Y[0],Q=Y[1];_&&J&&Q(!1);var $=E(),ee=$.isFocusVisible,te=$.onBlurVisible,ne=$.ref;function re(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:S;return f((function(r){return t&&t(r),!n&&K.current&&K.current[e](r),!0}))}a.useImperativeHandle(n,(function(){return{focusVisible:function(){Q(!0),Z.current.focus()}}}),[]),a.useEffect((function(){J&&k&&!x&&K.current.pulsate()}),[x,k,J]);var ie=re("start",O),ae=re("stop",j),oe=re("stop",N),se=re("stop",(function(e){J&&e.preventDefault(),D&&D(e)})),le=re("start",U),ue=re("stop",z),ce=re("stop",B),he=re("stop",(function(e){J&&(te(e),Q(!1)),C&&C(e)}),!1),fe=f((function(e){Z.current||(Z.current=e.currentTarget),ee(e)&&(Q(!0),P&&P(e)),I&&I(e)})),de=function(){var e=s.findDOMNode(Z.current);return y&&"button"!==y&&!("A"===e.tagName&&e.href)},pe=a.useRef(!1),me=f((function(e){k&&!pe.current&&J&&K.current&&" "===e.key&&(pe.current=!0,e.persist(),K.current.stop(e,(function(){K.current.start(e)}))),e.target===e.currentTarget&&de()&&" "===e.key&&e.preventDefault(),R&&R(e),e.target===e.currentTarget&&de()&&"Enter"===e.key&&!_&&(e.preventDefault(),A&&A(e))})),ve=f((function(e){k&&" "===e.key&&K.current&&J&&!e.defaultPrevented&&(pe.current=!1,e.persist(),K.current.stop(e,(function(){K.current.pulsate(e)}))),L&&L(e),A&&e.target===e.currentTarget&&de()&&" "===e.key&&!e.defaultPrevented&&A(e)})),ye=y;"button"===ye&&X.href&&(ye="a");var ge={};"button"===ye?(ge.type=q,ge.disabled=_):("a"===ye&&X.href||(ge.role="button"),ge["aria-disabled"]=_);var _e=c(o,t),be=c(ne,Z),xe=c(_e,be),we=a.useState(!1),Ee=we[0],Se=we[1];a.useEffect((function(){Se(!0)}),[]);var Te=Ee&&!x&&!_;return a.createElement(ye,Object(r.a)({className:Object(l.a)(p.root,m,J&&[p.focusVisible,M],_&&p.disabled),onBlur:he,onClick:A,onFocus:fe,onKeyDown:me,onKeyUp:ve,onMouseDown:ie,onMouseLeave:se,onMouseUp:oe,onDragLeave:ae,onTouchEnd:ue,onTouchMove:ce,onTouchStart:le,ref:xe,tabIndex:_?-1:H},ge,X),d,Te?a.createElement(F,Object(r.a)({ref:K,center:h},G)):null)}));t.a=Object(d.a)({root:{display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle","-moz-appearance":"none","-webkit-appearance":"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"},"&$disabled":{pointerEvents:"none",cursor:"default"},"@media print":{colorAdjust:"exact"}},disabled:{},focusVisible:{}},{name:"MuiButtonBase"})(B)},,,,,,,,,,,,,,,,function(e,t,n){"use strict";var r=n(3),i=n(100),a=n(34);t.a=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(i.a)(e,Object(r.a)({defaultTheme:a.a},t))}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(3),i=n(25);function a(e){return e&&"object"===Object(i.a)(e)&&e.constructor===Object}function o(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{clone:!0},i=n.clone?Object(r.a)({},e):e;return a(e)&&a(t)&&Object.keys(t).forEach((function(r){"__proto__"!==r&&(a(t[r])&&r in e?i[r]=o(e[r],t[r],n):i[r]=t[r])})),i}},function(e,t,n){"use strict";var r=n(8),i=n(3),a=n(1),o=(n(14),n(9)),s=n(11),l=n(13),u=n(101),c=n(15),h=a.forwardRef((function(e,t){var n=e.children,s=e.classes,l=e.className,h=e.disabled,f=void 0!==h&&h,d=e.disableFocusRipple,p=void 0!==d&&d,m=e.onChange,v=e.onClick,y=e.selected,g=e.size,_=void 0===g?"medium":g,b=e.value,x=Object(r.a)(e,["children","classes","className","disabled","disableFocusRipple","onChange","onClick","selected","size","value"]);return a.createElement(u.a,Object(i.a)({className:Object(o.a)(s.root,l,f&&s.disabled,y&&s.selected,"medium"!==_&&s["size".concat(Object(c.a)(_))]),disabled:f,focusRipple:!p,ref:t,onClick:function(e){v&&(v(e,b),e.isDefaultPrevented())||m&&m(e,b)},onChange:m,value:b,"aria-pressed":y},x),a.createElement("span",{className:s.label},n))}));t.a=Object(l.a)((function(e){return{root:Object(i.a)({},e.typography.button,{boxSizing:"border-box",borderRadius:e.shape.borderRadius,padding:11,border:"1px solid ".concat(Object(s.b)(e.palette.action.active,.12)),color:Object(s.b)(e.palette.action.active,.38),"&$selected":{color:e.palette.action.active,backgroundColor:Object(s.b)(e.palette.action.active,.12),"&:hover":{backgroundColor:Object(s.b)(e.palette.action.active,.15)},"& + &":{borderLeft:0,marginLeft:0}},"&$disabled":{color:Object(s.b)(e.palette.action.disabled,.12)},"&:hover":{textDecoration:"none",backgroundColor:Object(s.b)(e.palette.text.primary,.05),"@media (hover: none)":{backgroundColor:"transparent"},"&$disabled":{backgroundColor:"transparent"}}}),disabled:{},selected:{},label:{width:"100%",display:"inherit",alignItems:"inherit",justifyContent:"inherit"},sizeSmall:{padding:7,fontSize:e.typography.pxToRem(13)},sizeLarge:{padding:15,fontSize:e.typography.pxToRem(15)}}}),{name:"MuiToggleButton"})(h)},function(e,t,n){"use strict";var r=n(3),i=n(8),a=n(1),o=(n(14),n(9)),s=n(13),l=n(11),u=n(15),c=n(36);var h=n(57),f=n(101),d=a.forwardRef((function(e,t){var n=e.edge,s=void 0!==n&&n,l=e.children,c=e.classes,h=e.className,d=e.color,p=void 0===d?"default":d,m=e.disabled,v=void 0!==m&&m,y=e.disableFocusRipple,g=void 0!==y&&y,_=e.size,b=void 0===_?"medium":_,x=Object(i.a)(e,["edge","children","classes","className","color","disabled","disableFocusRipple","size"]);return a.createElement(f.a,Object(r.a)({className:Object(o.a)(c.root,h,"default"!==p&&c["color".concat(Object(u.a)(p))],v&&c.disabled,"small"===b&&c["size".concat(Object(u.a)(b))],{start:c.edgeStart,end:c.edgeEnd}[s]),centerRipple:!0,focusRipple:!g,disabled:v,ref:t},x),a.createElement("span",{className:c.label},l))})),p=Object(s.a)((function(e){return{root:{textAlign:"center",flex:"0 0 auto",fontSize:e.typography.pxToRem(24),padding:12,borderRadius:"50%",overflow:"visible",color:e.palette.action.active,transition:e.transitions.create("background-color",{duration:e.transitions.duration.shortest}),"&:hover":{backgroundColor:Object(l.b)(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"&$disabled":{backgroundColor:"transparent",color:e.palette.action.disabled}},edgeStart:{marginLeft:-12,"$sizeSmall&":{marginLeft:-3}},edgeEnd:{marginRight:-12,"$sizeSmall&":{marginRight:-3}},colorInherit:{color:"inherit"},colorPrimary:{color:e.palette.primary.main,"&:hover":{backgroundColor:Object(l.b)(e.palette.primary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},colorSecondary:{color:e.palette.secondary.main,"&:hover":{backgroundColor:Object(l.b)(e.palette.secondary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},disabled:{},sizeSmall:{padding:3,fontSize:e.typography.pxToRem(18)},label:{width:"100%",display:"flex",alignItems:"inherit",justifyContent:"inherit"}}}),{name:"MuiIconButton"})(d),m=a.forwardRef((function(e,t){var n=e.autoFocus,s=e.checked,l=e.checkedIcon,u=e.classes,f=e.className,d=e.defaultChecked,m=e.disabled,v=e.icon,y=e.id,g=e.inputProps,_=e.inputRef,b=e.name,x=e.onBlur,w=e.onChange,E=e.onFocus,S=e.readOnly,T=e.required,k=e.tabIndex,M=e.type,C=e.value,A=Object(i.a)(e,["autoFocus","checked","checkedIcon","classes","className","defaultChecked","disabled","icon","id","inputProps","inputRef","name","onBlur","onChange","onFocus","readOnly","required","tabIndex","type","value"]),I=function(e){var t=e.controlled,n=e.default,r=(e.name,e.state,a.useRef(void 0!==t).current),i=a.useState(n),o=i[0],s=i[1];return[r?t:o,a.useCallback((function(e){r||s(e)}),[])]}({controlled:s,default:Boolean(d),name:"SwitchBase",state:"checked"}),P=Object(c.a)(I,2),R=P[0],L=P[1],O=Object(h.a)(),D=m;O&&"undefined"===typeof D&&(D=O.disabled);var N="checkbox"===M||"radio"===M;return a.createElement(p,Object(r.a)({component:"span",className:Object(o.a)(u.root,f,R&&u.checked,D&&u.disabled),disabled:D,tabIndex:null,role:void 0,onFocus:function(e){E&&E(e),O&&O.onFocus&&O.onFocus(e)},onBlur:function(e){x&&x(e),O&&O.onBlur&&O.onBlur(e)},ref:t},A),a.createElement("input",Object(r.a)({autoFocus:n,checked:s,defaultChecked:d,className:u.input,disabled:D,id:N&&y,name:b,onChange:function(e){var t=e.target.checked;L(t),w&&w(e,t)},readOnly:S,ref:_,required:T,tabIndex:k,type:M,value:C},g)),R?l:v)})),v=Object(s.a)({root:{padding:9},checked:{},disabled:{},input:{cursor:"inherit",position:"absolute",opacity:0,width:"100%",height:"100%",top:0,left:0,margin:0,padding:0,zIndex:1}},{name:"PrivateSwitchBase"})(m),y=a.forwardRef((function(e,t){var n=e.classes,s=e.className,l=e.color,c=void 0===l?"secondary":l,h=e.edge,f=void 0!==h&&h,d=e.size,p=void 0===d?"medium":d,m=Object(i.a)(e,["classes","className","color","edge","size"]),y=a.createElement("span",{className:n.thumb});return a.createElement("span",{className:Object(o.a)(n.root,s,{start:n.edgeStart,end:n.edgeEnd}[f],"small"===p&&n["size".concat(Object(u.a)(p))])},a.createElement(v,Object(r.a)({type:"checkbox",icon:y,checkedIcon:y,classes:{root:Object(o.a)(n.switchBase,n["color".concat(Object(u.a)(c))]),input:n.input,checked:n.checked,disabled:n.disabled},ref:t},m)),a.createElement("span",{className:n.track}))}));t.a=Object(s.a)((function(e){return{root:{display:"inline-flex",width:58,height:38,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"}},edgeStart:{marginLeft:-8},edgeEnd:{marginRight:-8},switchBase:{position:"absolute",top:0,left:0,zIndex:1,color:"light"===e.palette.type?e.palette.grey[50]:e.palette.grey[400],transition:e.transitions.create(["left","transform"],{duration:e.transitions.duration.shortest}),"&$checked":{transform:"translateX(20px)"},"&$disabled":{color:"light"===e.palette.type?e.palette.grey[400]:e.palette.grey[800]},"&$checked + $track":{opacity:.5},"&$disabled + $track":{opacity:"light"===e.palette.type?.12:.1}},colorPrimary:{"&$checked":{color:e.palette.primary.main,"&:hover":{backgroundColor:Object(l.b)(e.palette.primary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"&$disabled":{color:"light"===e.palette.type?e.palette.grey[400]:e.palette.grey[800]},"&$checked + $track":{backgroundColor:e.palette.primary.main},"&$disabled + $track":{backgroundColor:"light"===e.palette.type?e.palette.common.black:e.palette.common.white}},colorSecondary:{"&$checked":{color:e.palette.secondary.main,"&:hover":{backgroundColor:Object(l.b)(e.palette.secondary.main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}}},"&$disabled":{color:"light"===e.palette.type?e.palette.grey[400]:e.palette.grey[800]},"&$checked + $track":{backgroundColor:e.palette.secondary.main},"&$disabled + $track":{backgroundColor:"light"===e.palette.type?e.palette.common.black:e.palette.common.white}},sizeSmall:{width:40,height:24,padding:7,"& $thumb":{width:16,height:16},"& $switchBase":{padding:4,"&$checked":{transform:"translateX(16px)"}}},checked:{},disabled:{},input:{left:"-100%",width:"300%"},thumb:{boxShadow:e.shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"},track:{height:"100%",width:"100%",borderRadius:7,zIndex:-1,transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest}),backgroundColor:"light"===e.palette.type?e.palette.common.black:e.palette.common.white,opacity:"light"===e.palette.type?.38:.3}}}),{name:"MuiSwitch"})(y)},function(e,t,n){"use strict";function r(e){return e}n.d(t,"a",(function(){return r}))},function(e,t,n){"use strict";var r=n(3),i=n(8),a=n(1),o=(n(51),n(14),n(9));function s(e,t){return void 0!==t&&void 0!==e&&(Array.isArray(t)?t.indexOf(e)>=0:e===t)}var l=n(13),u=n(15),c=a.forwardRef((function(e,t){var n=e.children,l=e.classes,c=e.className,h=e.exclusive,f=void 0!==h&&h,d=e.onChange,p=e.orientation,m=void 0===p?"horizontal":p,v=e.size,y=void 0===v?"medium":v,g=e.value,_=Object(i.a)(e,["children","classes","className","exclusive","onChange","orientation","size","value"]),b=function(e,t){if(d){var n,r=g&&g.indexOf(t);g&&r>=0?(n=g.slice()).splice(r,1):n=g?g.concat(t):[t],d(e,n)}},x=function(e,t){d&&d(e,g===t?null:t)};return a.createElement("div",Object(r.a)({role:"group",className:Object(o.a)(l.root,c,"vertical"===m&&l.vertical),ref:t},_),a.Children.map(n,(function(e){return a.isValidElement(e)?a.cloneElement(e,{className:Object(o.a)(l.grouped,l["grouped".concat(Object(u.a)(m))],e.props.className),onChange:f?x:b,selected:void 0===e.props.selected?s(e.props.value,g):e.props.selected,size:e.props.size||y}):null})))}));t.a=Object(l.a)((function(e){return{root:{display:"inline-flex",borderRadius:e.shape.borderRadius},vertical:{flexDirection:"column"},grouped:{},groupedHorizontal:{"&:not(:first-child)":{marginLeft:-1,borderLeft:"1px solid transparent",borderTopLeftRadius:0,borderBottomLeftRadius:0},"&:not(:last-child)":{borderTopRightRadius:0,borderBottomRightRadius:0}},groupedVertical:{"&:not(:first-child)":{marginTop:-1,borderTop:"1px solid transparent",borderTopLeftRadius:0,borderTopRightRadius:0},"&:not(:last-child)":{borderBottomLeftRadius:0,borderBottomRightRadius:0}}}}),{name:"MuiToggleButtonGroup"})(c)},function(e,t,n){"use strict";var r=n(3),i=n(8),a=n(1),o=(n(14),n(9)),s=n(57),l=n(13),u=n(15),c={h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",h6:"h6",subtitle1:"h6",subtitle2:"h6",body1:"p",body2:"p"},h=a.forwardRef((function(e,t){var n=e.align,s=void 0===n?"inherit":n,l=e.classes,h=e.className,f=e.color,d=void 0===f?"initial":f,p=e.component,m=e.display,v=void 0===m?"initial":m,y=e.gutterBottom,g=void 0!==y&&y,_=e.noWrap,b=void 0!==_&&_,x=e.paragraph,w=void 0!==x&&x,E=e.variant,S=void 0===E?"body1":E,T=e.variantMapping,k=void 0===T?c:T,M=Object(i.a)(e,["align","classes","className","color","component","display","gutterBottom","noWrap","paragraph","variant","variantMapping"]),C=p||(w?"p":k[S]||c[S])||"span";return a.createElement(C,Object(r.a)({className:Object(o.a)(l.root,h,"inherit"!==S&&l[S],"initial"!==d&&l["color".concat(Object(u.a)(d))],b&&l.noWrap,g&&l.gutterBottom,w&&l.paragraph,"inherit"!==s&&l["align".concat(Object(u.a)(s))],"initial"!==v&&l["display".concat(Object(u.a)(v))]),ref:t},M))})),f=Object(l.a)((function(e){return{root:{margin:0},body2:e.typography.body2,body1:e.typography.body1,caption:e.typography.caption,button:e.typography.button,h1:e.typography.h1,h2:e.typography.h2,h3:e.typography.h3,h4:e.typography.h4,h5:e.typography.h5,h6:e.typography.h6,subtitle1:e.typography.subtitle1,subtitle2:e.typography.subtitle2,overline:e.typography.overline,srOnly:{position:"absolute",height:1,width:1,overflow:"hidden"},alignLeft:{textAlign:"left"},alignCenter:{textAlign:"center"},alignRight:{textAlign:"right"},alignJustify:{textAlign:"justify"},noWrap:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},gutterBottom:{marginBottom:"0.35em"},paragraph:{marginBottom:16},colorInherit:{color:"inherit"},colorPrimary:{color:e.palette.primary.main},colorSecondary:{color:e.palette.secondary.main},colorTextPrimary:{color:e.palette.text.primary},colorTextSecondary:{color:e.palette.text.secondary},colorError:{color:e.palette.error.main},displayInline:{display:"inline"},displayBlock:{display:"block"}}}),{name:"MuiTypography"})(h),d=a.forwardRef((function(e,t){e.checked;var n=e.classes,l=e.className,c=e.control,h=e.disabled,d=(e.inputRef,e.label),p=e.labelPlacement,m=void 0===p?"end":p,v=(e.name,e.onChange,e.value,Object(i.a)(e,["checked","classes","className","control","disabled","inputRef","label","labelPlacement","name","onChange","value"])),y=Object(s.a)(),g=h;"undefined"===typeof g&&"undefined"!==typeof c.props.disabled&&(g=c.props.disabled),"undefined"===typeof g&&y&&(g=y.disabled);var _={disabled:g};return["checked","name","onChange","value","inputRef"].forEach((function(t){"undefined"===typeof c.props[t]&&"undefined"!==typeof e[t]&&(_[t]=e[t])})),a.createElement("label",Object(r.a)({className:Object(o.a)(n.root,l,"end"!==m&&n["labelPlacement".concat(Object(u.a)(m))],g&&n.disabled),ref:t},v),a.cloneElement(c,_),a.createElement(f,{component:"span",className:Object(o.a)(n.label,g&&n.disabled)},d))}));t.a=Object(l.a)((function(e){return{root:{display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,"&$disabled":{cursor:"default"}},labelPlacementStart:{flexDirection:"row-reverse",marginLeft:16,marginRight:-11},labelPlacementTop:{flexDirection:"column-reverse",marginLeft:16},labelPlacementBottom:{flexDirection:"column",marginLeft:16},disabled:{},label:{"&$disabled":{color:e.palette.text.disabled}}}}),{name:"MuiFormControlLabel"})(d)},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(1),i=n.n(r);var a=i.a.createContext(null);function o(){return i.a.useContext(a)}}]]);
//# sourceMappingURL=2.418fc1f1.chunk.js.map