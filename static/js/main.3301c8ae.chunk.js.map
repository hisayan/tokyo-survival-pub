{"version":3,"sources":["firebase.ts","charactor.ts","fire.ts","App.tsx","reportWebVitals.ts","index.tsx"],"names":["firebaseConfig","apiKey","process","authDomain","databaseURL","projectId","storageBucket","messagingSenderId","appId","console","log","firebase","apps","length","initializeApp","db","database","auth","Charactor","lngLat","modelOrigin","modelAltitude","modelRotate","Math","PI","modelAsMercatorCoordinate","modelTransform","clock","THREE","mixer","camera","scene","renderer","map","charactorLayer","id","type","renderingMode","onAdd","gl","directionalLight","position","set","normalize","add","directionalLight2","GLTFLoader","load","gltf","obj","animations","i","animation","action","clipAction","play","canvas","getCanvas","context","antialias","autoClear","render","matrix","rotationX","makeRotationAxis","rotateX","rotationY","rotateY","rotationZ","rotateZ","m","fromArray","l","makeTranslation","translateX","translateY","painter","terrain","getAtPoint","scale","multiply","update","getDelta","projectionMatrix","state","reset","triggerRepaint","this","setLngLat","mapboxgl","MercatorCoordinate","fromLngLat","x","y","translateZ","z","meterInMercatorCoordinateUnits","Fire","layerId","uniqID","myStrong","strong","md5","Date","getTime","toString","floor","random","getUniqueMd5","initPov","accessToken","makeStyles","theme","createStyles","paper","display","border","palette","divider","flexWrap","margin","spacing","StyledToggleButtonGroup","withStyles","grouped","backgroundColor","borderRadius","shape","ToggleButtonGroup","roomName","URLSearchParams","document","location","search","get","window","prompt","replace","pathname","reload","charactor","povRef","ref","followMeRef","fires","App","useState","setUser","useEffect","signInAnonymously","catch","error","code","message","onAuthStateChanged","user","setMap","useReducer","followMe","owner","last_changed","ServerValue","TIMESTAMP","setFollowMe","pov","lng","lat","zoom","pitch","bearing","setPov","directions","mapContainer","useRef","operation","setOperation","Map","container","current","style","center","on","getCenter","getZoom","getPitch","getBearing","addLayer","addSource","setTerrain","source","layout","paint","initializeMap","remove","onClick","e","a","createElement","className","marker","Marker","draggable","addTo","onDragEnd","getLngLat","setPopup","Popup","offset","setHTML","fire","push","off","value","val","jumpTo","FormControlLabel","control","Switch","checked","onChange","label","labelPlacement","event","newOperation","exclusive","aria-label","ToggleButton","toFixed","reportWebVitals","onPerfEntry","Function","then","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.3301c8ae.chunk.js","sourcesContent":["import firebase from \"firebase/app\";\r\nimport \"firebase/database\";\r\n// import \"firebase/firebase-storage\";\r\nimport \"firebase/auth\";\r\n\r\n// import firebase from 'firebase/app';\r\n// import '@firebase/database'\r\n\r\n// firebaseコンソールから取得\r\nconst firebaseConfig = {\r\n    apiKey: process.env.REACT_APP_FIREBASE_API_KEY,\r\n    authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,\r\n    databaseURL: process.env.REACT_APP_FIREBASE_DATABASE_URL,\r\n    projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,\r\n    storageBucket: process.env.REACT_APP_FIREBASE_STORAGE_BUCKET,\r\n    messagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,\r\n    appId: process.env.REACT_APP_FIREBASE_APP_ID,\r\n    // measurementId: process.env.REACT_APP_FIREBASE_MEASUREMENT_ID,\r\n};\r\nconsole.log(firebaseConfig)\r\n\r\n// Initialize Firebase\r\nif (firebase.apps.length === 0) {\r\n    firebase.initializeApp(firebaseConfig);\r\n}\r\n\r\nexport default firebase;\r\n\r\nexport const db = firebase.database();\r\nexport const auth = firebase.auth();\r\n\r\n","import * as THREE from \"three\"\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\r\nimport mapboxgl, { LngLatLike, LngLat, Map, CustomLayerInterface } from 'mapbox-gl';\r\n\r\nclass Charactor {\r\n\r\n    // parameters to ensure the model is georeferenced correctly on the map\r\n    modelOrigin: LngLatLike = [139.6947214379419, 35.679861724509934];\r\n    modelAltitude = 0;\r\n    modelRotate = [Math.PI / 2, 0, 0];\r\n\r\n    // elevation\r\n    // https://github.com/mapbox/mapbox-gl-js/issues/10318\r\n    // elevation\r\n    // https://github.com/mapbox/mapbox-gl-js/issues/10318\r\n    modelAsMercatorCoordinate!: mapboxgl.MercatorCoordinate;\r\n    modelTransform: any = {}\r\n\r\n    public constructor(lngLat: LngLatLike) {\r\n        this.setLngLat(lngLat)\r\n    }\r\n\r\n    public setLngLat(lngLat: LngLatLike) {\r\n        this.modelAsMercatorCoordinate = mapboxgl.MercatorCoordinate.fromLngLat(\r\n            lngLat,\r\n            this.modelAltitude\r\n        );\r\n\r\n        this.modelTransform = {\r\n            translateX: this.modelAsMercatorCoordinate.x,\r\n            translateY: this.modelAsMercatorCoordinate.y,\r\n            translateZ: this.modelAsMercatorCoordinate.z,\r\n            rotateX: this.modelRotate[0],\r\n            rotateY: this.modelRotate[1],\r\n            rotateZ: this.modelRotate[2],\r\n            /* Since our 3D model is in real world meters, a scale transform needs to be\r\n             * applied since the CustomLayerInterface expects units in MercatorCoordinates.\r\n             */\r\n            scale: this.modelAsMercatorCoordinate.meterInMercatorCoordinateUnits() / 100\r\n        };\r\n    }\r\n\r\n    clock = new THREE.Clock();\r\n    mixer?: THREE.AnimationMixer;\r\n    camera?: THREE.Camera;\r\n    scene?: THREE.Scene;\r\n    renderer?: THREE.WebGLRenderer\r\n    map: any;\r\n\r\n    // transformation parameters to position, rotate and scale the 3D model onto the map\r\n\r\n    // configuration of the custom layer for a 3D model per the CustomLayerInterface\r\n    charactorLayer: CustomLayerInterface = {\r\n        id: '3d-model',\r\n        type: 'custom',\r\n        renderingMode: '3d',\r\n        onAdd: (map: any, gl: WebGLRenderingContext) => {\r\n            this.camera = new THREE.Camera();\r\n            this.scene = new THREE.Scene();\r\n\r\n            // create two three.js lights to illuminate the model\r\n            var directionalLight = new THREE.DirectionalLight(0xffffff);\r\n            directionalLight.position.set(0, -70, 100).normalize();\r\n            this.scene.add(directionalLight);\r\n\r\n            var directionalLight2 = new THREE.DirectionalLight(0xffffff);\r\n            directionalLight2.position.set(0, 70, 100).normalize();\r\n            this.scene.add(directionalLight2);\r\n\r\n            // use the three.js GLTF loader to add the 3D model to the three.js scene\r\n            var loader = new GLTFLoader();\r\n\r\n            loader.load(\r\n                // 'https://cdn.glitch.com/378a8eca-f405-469a-b32e-b603069e5372%2Funtitled.glb?v=1584360698775',\r\n                './RunningBoy.glb',\r\n                (gltf: any) => {\r\n                    const obj = gltf.scene;\r\n                    const animations = gltf.animations;\r\n\r\n                    if (animations && animations.length) {\r\n\r\n                        //Animation Mixerインスタンスを生成\r\n                        this.mixer = new THREE.AnimationMixer(obj);\r\n\r\n                        //全てのAnimation Clipに対して\r\n                        for (let i = 0; i < animations.length; i++) {\r\n                            let animation = animations[i];\r\n\r\n                            //Animation Actionを生成\r\n                            let action = this.mixer.clipAction(animation);\r\n\r\n                            //ループ設定（1回のみ）\r\n                            // action.setLoop(THREE.LoopOnce);\r\n\r\n                            //アニメーションの最後のフレームでアニメーションが終了\r\n                            // action.clampWhenFinished = true;\r\n                            console.log('play');\r\n                            //アニメーションを再生\r\n                            action.play();\r\n\r\n\r\n                        }\r\n                    }\r\n                    this.scene?.add(gltf.scene);\r\n                }// .bind(this)\r\n            );\r\n            this.map = map\r\n            this.renderer = new THREE.WebGLRenderer({\r\n                canvas: map.getCanvas(),\r\n                context: gl,\r\n                antialias: true\r\n            })\r\n            this.renderer.autoClear = false;\r\n        },\r\n        render:  (gl: WebGLRenderingContext, matrix: any) => {\r\n            // requestAnimationFrame(() => { this.render(); });\r\n            var rotationX = new THREE.Matrix4().makeRotationAxis(\r\n                new THREE.Vector3(1, 0, 0),\r\n                this.modelTransform.rotateX\r\n            );\r\n            var rotationY = new THREE.Matrix4().makeRotationAxis(\r\n                new THREE.Vector3(0, 1, 0),\r\n                this.modelTransform.rotateY\r\n            );\r\n            var rotationZ = new THREE.Matrix4().makeRotationAxis(\r\n                new THREE.Vector3(0, 0, 1),\r\n                this.modelTransform.rotateZ\r\n            );\r\n\r\n            var m = new THREE.Matrix4().fromArray(matrix);\r\n\r\n            // console.log(map.painter.terrain.getAtPoint(modelAsMercatorCoordinate) * modelTransform.scale * 100)\r\n            var l = new THREE.Matrix4()\r\n                .makeTranslation(\r\n                    this.modelTransform.translateX,\r\n                    this.modelTransform.translateY,\r\n                    // (modelTransform.translateZ?? 0) + 0.000001852\r\n                    this.map.painter.terrain.getAtPoint(this.modelAsMercatorCoordinate) * this.modelTransform.scale * 100\r\n                )\r\n                .scale(\r\n                    new THREE.Vector3(\r\n                        this.modelTransform.scale,\r\n                        - this.modelTransform.scale,\r\n                        this.modelTransform.scale\r\n                    )\r\n                )\r\n                .multiply(rotationX)\r\n                .multiply(rotationY)\r\n                .multiply(rotationZ);\r\n\r\n            if (this.mixer) {\r\n                this.mixer.update(this.clock.getDelta());\r\n            }\r\n            if (this.camera) {\r\n                this.camera.projectionMatrix = m.multiply(l);\r\n            }\r\n            this.renderer?.state.reset();\r\n            this.renderer?.render(this.scene!, this.camera!);\r\n            this.map.triggerRepaint();\r\n        }\r\n    }\r\n}\r\n\r\nexport default Charactor","import * as THREE from \"three\"\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader'\r\nimport mapboxgl, { LngLatLike, LngLat, Map, CustomLayerInterface } from 'mapbox-gl';\r\n\r\nclass Fire {\r\n\r\n    layerId: string\r\n    // parameters to ensure the model is georeferenced correctly on the map\r\n    modelOrigin: LngLatLike = [139.6947214379419, 35.679861724509934];\r\n    modelAltitude = 0;\r\n    modelRotate = [Math.PI / 2, 0, 0];\r\n\r\n    // elevation\r\n    // https://github.com/mapbox/mapbox-gl-js/issues/10318\r\n    // elevation\r\n    // https://github.com/mapbox/mapbox-gl-js/issues/10318\r\n    modelAsMercatorCoordinate!: mapboxgl.MercatorCoordinate;\r\n    modelTransform: any = {}\r\n\r\n    public constructor(lngLat: LngLatLike, layerId: string) {\r\n        this.layerId = layerId\r\n        this.setLngLat(lngLat)\r\n    }\r\n\r\n    public setLngLat(lngLat: LngLatLike) {\r\n        this.modelAsMercatorCoordinate = mapboxgl.MercatorCoordinate.fromLngLat(\r\n            lngLat,\r\n            this.modelAltitude\r\n        );\r\n\r\n        this.modelTransform = {\r\n            translateX: this.modelAsMercatorCoordinate.x,\r\n            translateY: this.modelAsMercatorCoordinate.y,\r\n            translateZ: this.modelAsMercatorCoordinate.z,\r\n            rotateX: this.modelRotate[0],\r\n            rotateY: this.modelRotate[1],\r\n            rotateZ: this.modelRotate[2],\r\n            /* Since our 3D model is in real world meters, a scale transform needs to be\r\n             * applied since the CustomLayerInterface expects units in MercatorCoordinates.\r\n             */\r\n            scale: this.modelAsMercatorCoordinate.meterInMercatorCoordinateUnits() * 100\r\n        };\r\n    }\r\n\r\n    clock = new THREE.Clock();\r\n    mixer?: THREE.AnimationMixer;\r\n    camera?: THREE.Camera;\r\n    scene?: THREE.Scene;\r\n    renderer?: THREE.WebGLRenderer\r\n    map: any;\r\n\r\n    // transformation parameters to position, rotate and scale the 3D model onto the map\r\n\r\n    // configuration of the custom layer for a 3D model per the CustomLayerInterface\r\n    public charactorLayer(): CustomLayerInterface {\r\n        return {\r\n            id: this.layerId,\r\n            type: 'custom',\r\n            renderingMode: '3d',\r\n            onAdd: (map: any, gl: WebGLRenderingContext) => {\r\n                this.camera = new THREE.Camera();\r\n                this.scene = new THREE.Scene();\r\n\r\n                // create two three.js lights to illuminate the model\r\n                var directionalLight = new THREE.DirectionalLight(0xffffff);\r\n                directionalLight.position.set(0, -70, 100).normalize();\r\n                this.scene.add(directionalLight);\r\n\r\n                var directionalLight2 = new THREE.DirectionalLight(0xffffff);\r\n                directionalLight2.position.set(0, 70, 100).normalize();\r\n                this.scene.add(directionalLight2);\r\n\r\n                // use the three.js GLTF loader to add the 3D model to the three.js scene\r\n                var loader = new GLTFLoader();\r\n\r\n                loader.load(\r\n                    // 'https://cdn.glitch.com/378a8eca-f405-469a-b32e-b603069e5372%2Funtitled.glb?v=1584360698775',\r\n                    './fire/scene.gltf',\r\n                    (gltf: any) => {\r\n                        const obj = gltf.scene;\r\n                        const animations = gltf.animations;\r\n\r\n                        if (animations && animations.length) {\r\n\r\n                            //Animation Mixerインスタンスを生成\r\n                            this.mixer = new THREE.AnimationMixer(obj);\r\n\r\n                            //全てのAnimation Clipに対して\r\n                            for (let i = 0; i < animations.length; i++) {\r\n                                let animation = animations[i];\r\n\r\n                                //Animation Actionを生成\r\n                                let action = this.mixer.clipAction(animation);\r\n\r\n                                //ループ設定（1回のみ）\r\n                                // action.setLoop(THREE.LoopOnce);\r\n\r\n                                //アニメーションの最後のフレームでアニメーションが終了\r\n                                // action.clampWhenFinished = true;\r\n                                console.log('play');\r\n                                //アニメーションを再生\r\n                                action.play();\r\n                            }\r\n                        }\r\n                        this.scene?.add(gltf.scene);\r\n                    }// .bind(this)\r\n                );\r\n                this.map = map\r\n                this.renderer = new THREE.WebGLRenderer({\r\n                    canvas: map.getCanvas(),\r\n                    context: gl,\r\n                    antialias: true\r\n                })\r\n                this.renderer.autoClear = false;\r\n            },\r\n            render: (gl: WebGLRenderingContext, matrix: any) => {\r\n                // requestAnimationFrame(() => { this.render(); });\r\n                var rotationX = new THREE.Matrix4().makeRotationAxis(\r\n                    new THREE.Vector3(1, 0, 0),\r\n                    this.modelTransform.rotateX\r\n                );\r\n                var rotationY = new THREE.Matrix4().makeRotationAxis(\r\n                    new THREE.Vector3(0, 1, 0),\r\n                    this.modelTransform.rotateY\r\n                );\r\n                var rotationZ = new THREE.Matrix4().makeRotationAxis(\r\n                    new THREE.Vector3(0, 0, 1),\r\n                    this.modelTransform.rotateZ\r\n                );\r\n\r\n                var m = new THREE.Matrix4().fromArray(matrix);\r\n\r\n                // console.log(map.painter.terrain.getAtPoint(modelAsMercatorCoordinate) * modelTransform.scale * 100)\r\n                var l = new THREE.Matrix4()\r\n                    .makeTranslation(\r\n                        this.modelTransform.translateX,\r\n                        this.modelTransform.translateY,\r\n                        // (modelTransform.translateZ?? 0) + 0.000001852\r\n                        this.map.painter.terrain.getAtPoint(this.modelAsMercatorCoordinate) * this.modelTransform.scale / 100\r\n                    )\r\n                    .scale(\r\n                        new THREE.Vector3(\r\n                            this.modelTransform.scale,\r\n                            - this.modelTransform.scale,\r\n                            this.modelTransform.scale\r\n                        )\r\n                    )\r\n                    .multiply(rotationX)\r\n                    .multiply(rotationY)\r\n                    .multiply(rotationZ);\r\n\r\n                if (this.mixer) {\r\n                    this.mixer.update(this.clock.getDelta());\r\n                }\r\n                if (this.camera) {\r\n                    this.camera.projectionMatrix = m.multiply(l);\r\n                }\r\n                this.renderer?.state.reset();\r\n                this.renderer?.render(this.scene!, this.camera!);\r\n                this.map.triggerRepaint();\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport default Fire","import React, { useState, useRef, useEffect, useReducer } from 'react';\nimport { makeStyles, withStyles, Theme, createStyles } from '@material-ui/core/styles';\n\n// import ReactDOM from 'react-dom';\nimport './App.scss';\nimport mapboxgl, { LngLatLike, Map, TouchPitchHandler } from 'mapbox-gl';\n// import { throws } from 'assert';\nimport 'mapbox-gl/dist/mapbox-gl.css';\n\n// import MapboxDirections from '@mapbox/mapbox-gl-directions/dist/mapbox-gl-directions'\n// import '@mapbox/mapbox-gl-directions/dist/mapbox-gl-directions.css'\n\nimport polyline from '@mapbox/polyline';\nimport { FormControlLabel, Switch } from '@material-ui/core';\nimport firebase, { db, auth } from './firebase'\nimport { SwitchBaseProps } from '@material-ui/core/internal/SwitchBase';\nimport { ToggleButton, ToggleButtonGroup } from '@material-ui/lab';\nimport { geometry } from '@turf/turf';\nimport md5 from 'md5'\nimport Charactor from './charactor';\nimport Fire from './fire';\n\nfunction getUniqueMd5(myStrong?: number): string {\n  let strong = 1000;\n  if (myStrong) strong = myStrong;\n  return md5(\n    new Date().getTime().toString(16) +\n    Math.floor(strong * Math.random()).toString(16)\n  );\n}\n\nconst uniqID = getUniqueMd5()\nconsole.log('uniqID', uniqID)\n\nlet initPov = false\n\nmapboxgl.accessToken = process.env.REACT_APP_MAPBOX_ACCESS_TOKEN;\n\nconst useStyles = makeStyles((theme: Theme) =>\n  createStyles({\n    paper: {\n      display: 'flex',\n      border: `1px solid ${theme.palette.divider}`,\n      flexWrap: 'wrap',\n    },\n    divider: {\n      margin: theme.spacing(1, 0.5),\n    },\n  }),\n);\n\nconst StyledToggleButtonGroup = withStyles((theme) => ({\n  grouped: {\n    backgroundColor: '#fff',\n    margin: theme.spacing(0.5),\n    border: 'none',\n    '&:not(:first-child)': {\n      borderRadius: theme.shape.borderRadius,\n    },\n    '&:first-child': {\n      borderRadius: theme.shape.borderRadius,\n    },\n  },\n}))(ToggleButtonGroup);\n\n\n// const styles: CSSProperties = {\n//   width: '100vw',\n//   height: 'calc(100vh - 80px)',\n//   position: 'absolute',\n// };\n\n// type Coordinate = [number, number]\n// type Coordinates<Coordinate> = [<Coordinate>]\n\nconst params = new URLSearchParams(document.location.search.toString());\nconst roomName = params.get(\"room\")\n\n// const roomName = new URL(document.location.toString()).pathname;\nif (!roomName || roomName == '/') {\n  let roomName = null\n  roomName = window.prompt(\"please input room's name\");\n  // window.location.href = window.location.href + \"/\" + roomName;\n  if (roomName != null) {\n    // window.location.replace(\"/\" + roomName);\n    window.location.replace(window.location.pathname + '?room=' + roomName);\n  } else {\n    window.location.reload();\n  }\n}\n\n// // TODO: キャンセル処理をいれよう\n// https://qiita.com/tminasen/items/03a2e736910e937bb61f\n\nconst povRef = db.ref(roomName + '/pov');\nconst followMeRef = db.ref(roomName + '/followMe');\n\n\n// https://blog.mapbox.com/global-elevation-data-6689f1d0ba65\n// height = -10000 + ((R * 256 * 256 + G * 256 + B) * 0.1)\n\nasync function getElevation(lng: number, lat: number) {\n  // make API request\n  var query = 'https://api.mapbox.com/v4/mapbox.mapbox-terrain-v2/tilequery/' + lng + ',' + lat + '.json?layers=contour&limit=50&access_token=' + mapboxgl.accessToken;\n  console.log(query)\n\n  fetch(query, {\n    method: \"get\"\n  }).then((response) => response.text()).then((data: string) => {\n    // Display the longitude and latitude values\n    // lngDisplay.textContent = lng.toFixed(2);\n    // latDisplay.textContent = lat.toFixed(2);\n    // Get all the returned features\n    let d = JSON.parse(data)\n    var allFeatures = d.features;\n    console.log(allFeatures)\n\n    // Create an empty array to add elevation data to\n    var elevations = [];\n    // For each returned feature, add elevation data to the elevations array\n    for (var i: number = 0; i < allFeatures.length; i++) {\n      elevations.push(allFeatures[i].properties.ele);\n    }\n    // In the elevations array, find the largest value\n    var highestElevation: number = Math.max(...elevations);\n    // Display the largest elevation value\n    console.log(highestElevation)\n    return highestElevation;\n  });\n}\n\nlet charactor: Charactor\nlet fires: Fire[] = []\nlet runaway: LngLatLike[] = []\n\nconst App = () => {\n\n  const [user, setUser] = useState<firebase.User | null>(null)\n\n  useEffect(() => {\n    firebase.auth().signInAnonymously().catch(function (error) {\n      console.log(`${error.code}, ${error.message}`);\n    });\n\n    firebase.auth().onAuthStateChanged(user => {\n      console.log(user)\n      setUser(user);\n    });\n  }, [])\n\n  const [map, setMap] = useState<Map | null>(null)\n\n  // point of view  \n  // const [map, setMap] = useState<Map | null>(null)\n  const [followMe, setFollowMe] = useReducer((followMe: boolean, action: any) => {\n    if (action) {\n      followMeRef.update({ owner: uniqID, last_changed: firebase.database.ServerValue.TIMESTAMP })\n    }\n    return action\n  }, false)\n\n  const [pov, setPov] = useReducer((pov: any, action: any) => {\n    if (followMe) {\n      console.log('followMe update', action)\n      povRef.update(action)\n    }\n    return action\n  },\n    { lng: 139.7, lat: 35.68, zoom: 17, pitch: 85, bearing: 80 });\n\n  const [directions, setDirecrtions] = useReducer((directions: any, action: any) => {\n\n    return action\n  }, {})\n\n  // const [followMe, setFollowMe] = useReducer((f: boolean, action: boolean)=>{\n  //   console.log('reducer', f, action)\n  //   return action\n  // }, false)\n  const mapContainer = useRef<HTMLDivElement>(null)\n  // private db: any = null;\n\n  const [operation, setOperation] = useState('fire');\n\n  useEffect(() => {\n    console.log('useEffect')\n    // const params = new URL(document.location.toString()).searchParams;\n    // let roomName = params.get(\"room_name\");\n    const initializeMap = ({ setMap, mapContainer }: {\n      setMap: any;\n      mapContainer: any;\n    }) => {\n\n      const map = new mapboxgl.Map({\n        container: mapContainer.current !== null ? mapContainer.current : \"\",\n        style: \"mapbox://styles/mapbox/streets-v11\", // stylesheet location\n        center: [pov.lng, pov.lat],\n        zoom: pov.zoom,\n        pitch: pov.pitch,\n        bearing: pov.bearing,\n        antialias: true // どっちでもいいかも\n      })\n\n      map.on('load', () => {\n        // setMap(map);\n        // map.resize();\n\n        // const directions = new MapboxDirections({\n        //   accessToken: mapboxgl.accessToken,\n        //   unit: \"metric\",\n        //   profile: \"mapbox/walking\",\n        //   alternatives: false,\n        //   geometries: \"geojson\",\n        //   controls: { instructions: false },\n        //   flyTo: false\n        // });\n        // map?.addControl(directions, \"top-right\");\n\n        // directions.on('route', (e: any) => {\n        //   console.log(e)\n        // })\n\n        map?.on('move', () => {\n          setPov({\n            lng: map.getCenter().lng,\n            lat: map.getCenter().lat,\n            zoom: map.getZoom(),\n            pitch: map.getPitch(),\n            bearing: map.getBearing(),\n          });\n\n          // 初期値。どうしてじゃ\n          // console.log('move', followMe.toString(), JSON.stringify(pov))\n        });\n\n        charactor = new Charactor({ lng: 139.7, lat: 35.68 })\n        map?.addLayer(charactor.charactorLayer);\n\n        map?.addSource('mapbox-dem', {\n          'type': 'raster-dem',\n          'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',\n          'tileSize': 512,\n          'maxzoom': 14\n        });\n        // add the DEM source as a terrain layer with exaggerated height\n        map?.setTerrain({\n          'source': 'mapbox-dem',\n          'exaggeration': 1.0\n        });\n\n        map?.addSource(\"theRoute\", {\n          type: \"geojson\",\n          // data: {\n          //  type: \"Feature\",\n          // },\n        });\n\n        map?.addLayer({\n          id: \"theRoute\",\n          type: \"line\",\n          source: \"theRoute\",\n          layout: {\n            \"line-join\": \"round\",\n            \"line-cap\": \"round\",\n          },\n          paint: {\n            \"line-color\": \"#cccccc\",\n            \"line-opacity\": 0.5,\n            \"line-width\": 13,\n            \"line-blur\": 0.5,\n          },\n        });\n\n        // add a sky layer that will show when the map is highly pitched\n        map?.addLayer({\n          'id': 'sky',\n          'type': 'sky',\n          'paint': {\n            'sky-type': 'atmosphere',\n            'sky-atmosphere-sun': [0.0, 0.0],\n            'sky-atmosphere-sun-intensity': 15\n          }\n        });\n\n\n      });\n\n      setMap(map)\n    }\n\n    if (!map) initializeMap({ setMap, mapContainer });\n\n    return () => {\n      map?.remove()\n    }\n  }, [map])\n\n  useEffect(() => {\n    const onClick = async (e: any) => {\n      // console.log('click', e.lngLat, await getElevation(e.lngLat.lng, e.lngLat.lat));\n\n      // const routeLine = polyline.encode([[e.lngLat.lng, e.lngLat.lat], [40.7, -120.95], [43.252, -126.453]]);\n      // const lng = e.lngLat.lng;\n      switch (operation) {\n        case 'line':\n\n          var el = document.createElement('div');\n          el.className = 'marker';\n          if (map) {\n            const marker = new mapboxgl.Marker({\n              draggable: true\n            })\n              .setLngLat(e.lngLat)\n              .addTo(map);\n\n            const onDragEnd = () => {\n              var lngLat = marker.getLngLat();\n              console.log(lngLat)\n              // coordinates.style.display = 'block';\n              // coordinates.innerHTML =\n              // 'Longitude: ' + lngLat.lng + '<br />Latitude: ' + lngLat.lat;\n            }\n            marker.on('dragend', onDragEnd);\n            marker.setPopup(new mapboxgl.Popup({ offset: 25 }).setHTML('< h4>remove</h4'));\n          }\n          break\n\n        case 'char':\n\n          charactor.setLngLat(e.lngLat)\n          break\n\n        case 'fire':\n          let fire = new Fire(e.lngLat, \"fire_layer_\" + fires.length)\n          map?.addLayer(fire.charactorLayer());\n          fires.push(fire)\n          break\n      }\n\n\n    }\n    map?.on('click', onClick)\n\n    return () => {\n      map?.off('click', onClick)\n    }\n  }, [map, followMe, operation])\n\n  useEffect(() => {\n    povRef.on(\"value\", (value) => {\n      console.log(\"povRef.on\", value)\n      const pov = value.val();\n      // setPov(pov)\n      if (!followMe && pov && initPov) {\n        map?.jumpTo({ center: [pov.lng, pov.lat], zoom: pov.zoom, pitch: pov.pitch, bearing: pov.bearing });\n      }\n      initPov = true\n    });\n\n    // これはまぁ、こういうかんじかな\n    followMeRef.on(\"value\", (value) => {\n      const fm = value.val()\n      if (fm.owner != uniqID && followMe) {\n        setFollowMe(false)\n      }\n    })\n\n    return () => {\n      povRef.off('value')\n      followMeRef.off('value')\n    }\n  }, [followMe, uniqID, map])\n\n  const syncView = () => {\n    // map?.fitBounds([\n    //   [32.958984, -5.353521],\n    //   [43.50585, 5.615985]\n    // ]);\n    console.log('syncView', followMe.toString())\n\n    // // これを state にもたせるべきか\n    // map?.addSource('route', {\n    //   'type': 'geojson',\n    //   'data': {\n    //     'type': 'Feature',\n    //     'properties': [],\n    //     'geometry': {\n    //       'type': 'LineString',\n    //       'coordinates': [\n    //         [139.7, 35.68],\n    //         [139.71, 35.682],\n    //       ]\n    //     }\n    //   }\n    // })\n\n    // // add a sky layer that will show when the map is highly pitched\n    // map?.addLayer({\n    //   'id': 'route',\n    //   'type': 'line',\n    //   'source': 'route',\n    //   'layout': {\n    //     'line-join': 'round',\n    //     'line-cap': 'round'\n    //   },\n    //   'paint': {\n    //     'line-color': '#800',\n    //     'line-width': 8\n    //   }\n    // });\n\n  }\n\n\n\n  const toggleChecked = (e: React.ChangeEvent<HTMLInputElement>, checked: boolean) => {\n    console.log('toggleChecked')\n    setFollowMe(checked)\n    if (checked) {\n      setPov({\n        lng: map?.getCenter().lng,\n        lat: map?.getCenter().lat,\n        zoom: map?.getZoom(),\n        pitch: map?.getPitch(),\n        bearing: map?.getBearing(),\n      })\n    }\n  }\n\n  const handleOperation = (event: React.MouseEvent<HTMLElement, MouseEvent>, newOperation: string) => {\n    setOperation(newOperation);\n  };\n\n  return (\n    <div>\n      <div className='header'>\n        <button id=\"fit\" onClick={syncView}>sync view</button>\n        <FormControlLabel\n          control={<Switch checked={followMe} onChange={toggleChecked} />}\n          label=\"Follow me\"\n          labelPlacement=\"start\"\n        />\n        {/* <input type=\"text\" value={operation.toString()} /> */}\n        <StyledToggleButtonGroup value={operation} onChange={handleOperation} exclusive aria-label=\"text formatting\">\n          <ToggleButton value=\"line\" aria-label=\"line\">\n            line\n          </ToggleButton>\n          <ToggleButton value=\"fire\" aria-label=\"fire\">\n            fire\n          </ToggleButton>\n          <ToggleButton value=\"char\" aria-label=\"char\">\n            char\n          </ToggleButton>\n        </StyledToggleButtonGroup>\n      </div>\n      <div className='sidebarStyle'>\n        <div>Longitude: {pov.lng.toFixed(4)} | Latitude: {pov.lat.toFixed(4)} | Zoom: {pov.zoom.toFixed(2)} | Pitch: {pov.pitch.toFixed(2)} | Bearing: {pov.bearing.toFixed(2)}</div>\n      </div>\n      <div ref={mapContainer} id=\"mapContainer\" className='mapContainer' />\n    </div>\n  )\n}\n\n\nexport default App;\n","import { ReportHandler } from 'web-vitals';\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.scss';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}